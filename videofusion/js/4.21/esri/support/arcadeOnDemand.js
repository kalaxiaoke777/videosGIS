// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("require exports ../chunks/_rollupPluginBabelHelpers ../geometry ../core/maybe ../geometry/SpatialReference".split(" "),function(A,g,x,t,B,C){function y(){u||(u=x._asyncToGenerator(function*(){const c=yield new Promise(function(b,a){A(["./arcadeUtils"],b,a)});return{arcade:c.arcade,arcadeUtils:c,Dictionary:c.Dictionary,Feature:c.arcadeFeature}})());return u}let u;t=(c,b,a)=>n.create(c,b,a,null,["$feature","$view"]);let n=function(){function c(a,h,e,p,m,f,k,d){this.script=a;this.evaluate=m;
this.fields=Array.isArray(k)?k:k.fields;this._syntaxTree=p;this._arcade=h;this._arcadeDictionary=e;this._arcadeFeature=f;this._spatialReference=d;this._referencesGeometry=h.scriptTouchesGeometry(this._syntaxTree);this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}c.create=function(){var a=x._asyncToGenerator(function*(h,e,p,m,f,k){const {arcade:d,Feature:D,Dictionary:v}=yield y(),w=C.fromJSON(e);e=d.parseScript(h,k);f=f.reduce((l,E)=>({...l,[E]:null}),{});let q=null;B.isSome(m)&&
(q=new v(m),q.immutable=!0,f.$config=null);m=d.scriptUsesGeometryEngine(e)&&d.enableGeometrySupport();k=d.scriptUsesFeatureSet(e)&&d.enableFeatureSetSupport();const z=d.scriptIsAsync(e)&&d.enableAsyncSupport();f={vars:f,spatialReference:w,useAsync:!!z};const r=new v;r.immutable=!1;r.setField("scale",0);const F=d.compileScript(e,f);yield Promise.all([m,k,z]);return new c(h,d,v,e,l=>{"$view"in l&&l.$view&&(r.setField("scale",l.$view.scale),l.$view=r);q&&(l.$config=q);return F({vars:l,spatialReference:w})},
new D,p,w)});return function(h,e,p,m,f,k){return a.apply(this,arguments)}}();var b=c.prototype;b.repurposeFeature=function(a){a.geometry&&!a.geometry.spatialReference&&(a.geometry.spatialReference=this._spatialReference);this._arcadeFeature.repurposeFromGraphicLikeObject(a.geometry,a.attributes,{fields:this.fields});return this._arcadeFeature};b.repurposeAdapter=function(a){this._arcadeFeature.repurposeFromAdapter(a,{fields:this.fields});return this._arcadeFeature};b.createDictionary=function(){return new this._arcadeDictionary};
b.referencesMember=function(a){return this._arcade.referencesMember(this._syntaxTree,a)};b.referencesFunction=function(a){return this._arcade.referencesFunction(this._syntaxTree,a)};b.referencesGeometry=function(){return this._referencesGeometry};b.referencesScale=function(){return this._referencesScale};b.extractFieldLiterals=function(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)};return c}();g.ArcadeExpression=n;g.createDictionaryExpression=(c,b,a,h)=>n.create(c,b,a,h,["$feature",
"$view"]);g.createLabelExpression=(c,b,a)=>n.create(c,b,a,null,["$feature"]);g.createRendererExpression=t;g.createVVExpression=t;g["default"]=n;g.loadArcade=y;Object.defineProperty(g,"__esModule",{value:!0})});