// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/HandleOwner ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ./commonProperties ./sublayerUtils ../../views/support/floorFilterUtils".split(" "),function(d,m,e,q,r,t,f,A,B,C,u,v,w,l){const x={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",
labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};d.ExportImageParameters=function(n){function k(a){a=n.call(this,a)||this;a.floors=null;a.scale=0;return a}m._inheritsLoose(k,n);var p=k.prototype;p.destroy=function(){this.layer=null};p.toJSON=function(){var a=this.layer;a={dpi:a.dpi,format:a.imageFormat,transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&
this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:a={...a,layers:this.layers,layerDefs:this.layerDefs};return a};m._createClass(k,[{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;const a=this.visibleSublayers.map(b=>{const g=l.getLayerFloorFilterClause(this.floors,b);return b.toExportImageJSON(g)});return a.length?JSON.stringify(a):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&w.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}},
{key:"layer",set:function(a){this._get("layer")!==a&&(this._set("layer",a),this.handles.remove("layer"),a&&this.handles.add([a.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),a.on("sublayer-update",b=>this.notifyChange(x[b.propertyName]))],"layer"))}},{key:"layers",get:function(){const a=this.visibleSublayers;return a?a.length?"show:"+a.map(b=>b.id).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var a;const b=!(null==(a=this.floors)||!a.length);a=this.visibleSublayers.filter(g=>
null!=g.definitionExpression||b&&null!=g.floorInfo);return a.length?JSON.stringify(a.reduce((g,c)=>{var h=l.getLayerFloorFilterClause(this.floors,c);h=t.isSome(h)?l.combineFloorsDefinitionExpression(h,c):c.definitionExpression;g[c.id]=h;return g},{})):null}},{key:"version",get:function(){this.commitProperty("layers");this.commitProperty("layerDefs");this.commitProperty("dynamicLayers");this.commitProperty("timeExtent");const a=this.layer;a&&(a.commitProperty("dpi"),a.commitProperty("imageFormat"),
a.commitProperty("imageTransparency"),a.commitProperty("gdbVersion"));return(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){const a=[];if(!this.layer)return a;var b=this.layer.sublayers;const g=c=>{const h=this.scale,y=0===c.minScale||h<=c.minScale,z=0===c.maxScale||h>=c.maxScale;c.visible&&(0===h||y&&z)&&(c.sublayers?c.sublayers.forEach(g):a.unshift(c))};b&&b.forEach(g);b=this._get("visibleSublayers");return!b||b.length!==a.length||b.some((c,h)=>a[h]!==c)?a:b}}]);return k}(r.HandleOwnerMixin(q));
e.__decorate([f.property({readOnly:!0})],d.ExportImageParameters.prototype,"dynamicLayers",null);e.__decorate([f.property()],d.ExportImageParameters.prototype,"floors",void 0);e.__decorate([f.property({readOnly:!0})],d.ExportImageParameters.prototype,"hasDynamicLayers",null);e.__decorate([f.property()],d.ExportImageParameters.prototype,"layer",null);e.__decorate([f.property({readOnly:!0})],d.ExportImageParameters.prototype,"layers",null);e.__decorate([f.property({readOnly:!0})],d.ExportImageParameters.prototype,
"layerDefs",null);e.__decorate([f.property({type:Number})],d.ExportImageParameters.prototype,"scale",void 0);e.__decorate([f.property(v.combinedViewLayerTimeExtentProperty)],d.ExportImageParameters.prototype,"timeExtent",void 0);e.__decorate([f.property({readOnly:!0})],d.ExportImageParameters.prototype,"version",null);e.__decorate([f.property({readOnly:!0})],d.ExportImageParameters.prototype,"visibleSublayers",null);d.ExportImageParameters=e.__decorate([u.subclass("esri.layers.mixins.ExportImageParameters")],
d.ExportImageParameters);Object.defineProperty(d,"__esModule",{value:!0})});