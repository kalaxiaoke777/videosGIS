// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../support/serviceTileInfoProperty ../support/TilemapCache ../../geometry/SpatialReference".split(" "),function(r,l,c,e,q,t,v,n,F,
x,u,M,N){r.ArcGISCachedService=C=>{C=function(L){function V(){var D=L.apply(this,arguments)||this;D.copyright=null;D.minScale=0;D.maxScale=0;D.spatialReference=null;D.tileInfo=null;D.tilemapCache=null;return D}l._inheritsLoose(V,L);var H=V.prototype;H.readMinScale=function(D,S){return null!=S.minLOD&&null!=S.maxLOD?D:0};H.readMaxScale=function(D,S){return null!=S.minLOD&&null!=S.maxLOD?D:0};H.readTilemapCache=function(D,S){return S.capabilities&&-1<S.capabilities.indexOf("Tilemap")?new M.TilemapCache({layer:this}):
null};l._createClass(V,[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return V}(C);c.__decorate([q.property({json:{read:{source:"copyrightText"}}})],C.prototype,"copyright",void 0);c.__decorate([q.property()],C.prototype,"minScale",void 0);c.__decorate([F.reader("service","minScale")],C.prototype,"readMinScale",null);c.__decorate([q.property()],C.prototype,"maxScale",void 0);c.__decorate([F.reader("service","maxScale")],C.prototype,"readMaxScale",null);c.__decorate([q.property({type:N})],
C.prototype,"spatialReference",void 0);c.__decorate([q.property({readOnly:!0})],C.prototype,"supportsBlankTile",null);c.__decorate([q.property(u.serviceTileInfoProperty)],C.prototype,"tileInfo",void 0);c.__decorate([q.property()],C.prototype,"tilemapCache",void 0);c.__decorate([F.reader("service","tilemapCache",["capabilities"])],C.prototype,"readTilemapCache",null);c.__decorate([q.property()],C.prototype,"version",void 0);return C=c.__decorate([x.subclass("esri.layers.mixins.ArcGISCachedService")],
C)};Object.defineProperty(r,"__esModule",{value:!0})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(r,l){function c(q,t,v,n){if(!q)return null;const {minScale:F,maxScale:x,minLOD:u,maxLOD:M}=t;if(null!=u&&null!=M)return n&&n.ignoreMinMaxLOD?l.fromJSON(q):l.fromJSON({...q,lods:q.lods.filter(({level:N})=>null!=N&&N>=u&&N<=M)});if(0!==F&&0!==x){const N=F?Math.round(1E4*F)/1E4:Infinity,C=x?Math.round(1E4*x)/1E4:-Infinity;return l.fromJSON({...q,lods:q.lods.filter(L=>
{L=Math.round(1E4*L.scale)/1E4;return L<=N&&L>=C})})}return l.fromJSON(q)}const e={type:l,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:c}}}}};r.readServiceTileInfo=c;r.serviceTileInfoProperty=e;Object.defineProperty(r,"__esModule",{value:!0})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(r,l,c,e,q,t,v,n,F,x,u,M,N,C,L,V,H,D,S){var I;c=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});e=I=function(B){function y(d){d=B.call(this,d)||this;d.dpi=96;d.format=null;d.origin=null;d.minScale=0;d.maxScale=0;d.size=null;d.spatialReference=null;return d}r._inheritsLoose(y,B);y.create=function(d=
{}){const {resolutionFactor:b=1,scales:g,size:h=256,spatialReference:k=L.WebMercator,numLODs:w=24}=d;if(!H.isValid(k)){d=[];if(g)for(var G=0;G<g.length;G++){var J=g[G];d.push({level:G,scale:J,resolution:J})}else for(G=5E-4,J=w-1;0<=J;J--)d.unshift({level:J,scale:G,resolution:G}),G*=2;return new I({dpi:96,lods:d,origin:new C(0,0,k),size:[h,h],spatialReference:k})}G=H.getInfo(k);d=d.origin?new C({x:d.origin.x,y:d.origin.y,spatialReference:k}):G?new C({x:G.origin[0],y:G.origin[1],spatialReference:k}):
new C({x:0,y:0,spatialReference:k});G=1/(39.37*t.getMetersPerUnitForSR(k)*96);J=[];if(g)for(var U=0;U<g.length;U++){var O=g[U];J.push({level:U,scale:O,resolution:O*G})}else{var P=H.isGeographic(k)?512/h*5.916575275917094E8:256/h*5.91657527591555E8;U=Math.ceil(w/b);J.push({level:0,scale:P,resolution:P*G});for(O=1;O<U;O++)P/=2**b,J.push({level:O,scale:P,resolution:P*G})}return new I({dpi:96,lods:J,origin:d,size:[h,h],spatialReference:k})};var z=y.prototype;z.readOrigin=function(d,b){return C.fromJSON({spatialReference:b.spatialReference,
...d})};z.readSize=function(d,b){return[b.cols,b.rows]};z.writeSize=function(d,b){b.cols=d[0];b.rows=d[1]};z.zoomToScale=function(d){const b=this.scales;if(0>=d)return b[0];if(d>=b.length-1)return b[b.length-1];{const g=Math.floor(d);return b[g]/(b[g]/b[g+1])**(d-g)}};z.scaleToZoom=function(d){const b=this.scales,g=b.length-1;let h=0;for(;h<g;h++){const k=b[h],w=b[h+1];if(k<=d)break;if(w===d)return h+1;if(k>d&&w<d)return h+Math.log(k/d)/Math.log(k/w)}return h};z.snapScale=function(d,b=.95){d=this.scaleToZoom(d);
return d%Math.floor(d)>=b?this.zoomToScale(Math.ceil(d)):this.zoomToScale(Math.floor(d))};z.tileAt=function(d,b,g,h){var k=this.lodAt(d);if(!k)return null;let w;if("number"===typeof b)w=b,b=g;else{if(H.equals(b.spatialReference,this.spatialReference))w=b.x,b=b.y;else{h=D.project(b,this.spatialReference);if(q.isNone(h))return null;w=h.x;b=h.y}h=g}g=k.resolution*this.size[0];k=k.resolution*this.size[1];h||(h={id:null,level:0,row:0,col:0,extent:V.create()});h.level=d;h.row=Math.floor((this.origin.y-
b)/k+.001);h.col=Math.floor((w-this.origin.x)/g+.001);this.updateTileInfo(h);return h};z.updateTileInfo=function(d,b=0){var g=this.lodAt(d.level);g||1!==b||(b=this.lods[this.lods.length-1],b.level<d.level&&(g=b));if(g){var h=d.level-g.level;b=g.resolution*this.size[0]/2**h;g=g.resolution*this.size[1]/2**h;d.id=`${d.level}/${d.row}/${d.col}`;d.extent||(d.extent=V.create());d.extent[0]=this.origin.x+d.col*b;d.extent[1]=this.origin.y-(d.row+1)*g;d.extent[2]=d.extent[0]+b;d.extent[3]=d.extent[1]+g}};
z.upsampleTile=function(d){const b=this._upsampleLevels[d.level];if(!b||-1===b.parentLevel)return!1;d.level=b.parentLevel;d.row=Math.floor(d.row/b.factor+.001);d.col=Math.floor(d.col/b.factor+.001);this.updateTileInfo(d);return!0};z.getTileBounds=function(d,b){var {resolution:g}=this.lodAt(b.level);const h=g*this.size[0];g*=this.size[1];d[0]=this.origin.x+b.col*h;d[1]=this.origin.y-(b.row+1)*g;d[2]=d[0]+h;d[3]=d[1]+g;return d};z.lodAt=function(d){return this._levelToLOD&&this._levelToLOD[d]||null};
z.clone=function(){return I.fromJSON(this.write({}))};z._initializeUpsampleLevels=function(){const d=this.lods;this._upsampleLevels=[];let b=null;for(let g=0;g<d.length;g++){const h=d[g];this._upsampleLevels[h.level]={parentLevel:b?b.level:-1,factor:b?b.resolution/h.resolution:0};b=h}};r._createClass(y,[{key:"isWrappable",get:function(){const {spatialReference:d,origin:b}=this;if(d&&b){const g=H.getInfo(d);return d.isWrappable&&Math.abs(g.origin[0]-b.x)<=g.dx}return!1}},{key:"lods",set:function(d){let b=
0,g=0;const h=[];this._levelToLOD={};d&&(b=-Infinity,g=Infinity,d.forEach(k=>{h.push(k.scale);b=k.scale>b?k.scale:b;g=k.scale<g?k.scale:g;this._levelToLOD[k.level]=k}));this._set("scales",h);this._set("minScale",b);this._set("maxScale",g);this._set("lods",d);this._initializeUpsampleLevels()}}]);return y}(e.JSONSupport);l.__decorate([v.property({type:Number,json:{write:!0}})],e.prototype,"compressionQuality",void 0);l.__decorate([v.property({type:Number,json:{write:!0}})],e.prototype,"dpi",void 0);
l.__decorate([v.property({type:String,json:{read:c.read,write:c.write,origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"format",void 0);l.__decorate([v.property({readOnly:!0})],e.prototype,"isWrappable",null);l.__decorate([v.property({type:C,json:{write:!0}})],e.prototype,"origin",void 0);l.__decorate([u.reader("origin")],e.prototype,"readOrigin",null);l.__decorate([v.property({type:[S],value:null,json:{write:!0}})],e.prototype,"lods",null);l.__decorate([v.property({readOnly:!0})],e.prototype,
"minScale",void 0);l.__decorate([v.property({readOnly:!0})],e.prototype,"maxScale",void 0);l.__decorate([v.property({readOnly:!0})],e.prototype,"scales",void 0);l.__decorate([v.property({cast:B=>Array.isArray(B)?B:"number"===typeof B?[B,B]:[256,256]})],e.prototype,"size",void 0);l.__decorate([u.reader("size",["rows","cols"])],e.prototype,"readSize",null);l.__decorate([N.writer("size",{cols:{type:F.Integer},rows:{type:F.Integer}})],e.prototype,"writeSize",null);l.__decorate([v.property({type:L,json:{write:!0}})],
e.prototype,"spatialReference",void 0);return e=I=l.__decorate([M.subclass("esri.layers.support.TileInfo")],e)})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),function(r,l,c,e,q,t,v,n){var F;c=F=function(x){function u(M){M=x.call(this,M)||
this;M.cols=null;M.level=0;M.levelValue=null;M.resolution=0;M.rows=null;M.scale=0;return M}r._inheritsLoose(u,x);u.prototype.clone=function(){return new F({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return u}(c.JSONSupport);l.__decorate([e.property({type:Number,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0);l.__decorate([e.property({type:t.Integer,
json:{write:!0}})],c.prototype,"level",void 0);l.__decorate([e.property({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0);l.__decorate([e.property({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0);l.__decorate([e.property({type:Number,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"rows",void 0);l.__decorate([e.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);return c=F=l.__decorate([n.subclass("esri.layers.support.LOD")],
c)})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./Tilemap".split(" "),
function(r,l,c,e,q,t,v,n,F,x,u,M,N,C,L,V,H,D,S){var I;const B=n.getLogger("esri.layers.support.TilemapCache");r.TilemapCache=I=function(y){function z(b){b=y.call(this,b)||this;b._handles=new v;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2097152;b.request=e;b._prefetchingEnabled=!0;return b}l._inheritsLoose(z,y);var d=z.prototype;d.initialize=function(){this._tilemapCache=new F(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],
()=>this._initializeTilemapDefinition()),C.init(this,"layer.tileInfo.lods",b=>this._initializeAvailableLevels(b),!0)]);this._initializeTilemapDefinition()};d.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};d.castLevels=function(b){return 2>=b?(B.error("Minimum levels for Tilemap is 3, but got ",b),3):b};d.fetchTilemap=function(b,g,h,k){if(!this._availableLevels[b])return Promise.reject(new t("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`));
const w=this._tmpTilemapDefinition;if(b=this._tilemapFromCache(b,g,h,w))return Promise.resolve(b);const G=k&&k.signal;k={...k,signal:null};return new Promise((J,U)=>{u.onAbort(G,()=>U(u.createAbortError()));const O=S.tilemapDefinitionId(w);let P=this._pendingTilemapRequests[O];if(!P){P=S.Tilemap.fromDefinition(w,k).then(ca=>{this._tilemapCache.put(O,ca,ca.byteSize);return ca});const Q=()=>delete this._pendingTilemapRequests[O];this._pendingTilemapRequests[O]=P;P.then(Q,Q)}P.then(J,U)})};d.getAvailability=
function(b,g,h){return this._availableLevels[b]?(b=this._tilemapFromCache(b,g,h,this._tmpTilemapDefinition))?b.getAvailability(g,h):"unknown":"unavailable"};d.getAvailabilityUpsample=function(b,g,h,k){k.level=b;k.row=g;k.col=h;b=this.layer.tileInfo;for(b.updateTileInfo(k);;)if(g=this.getAvailability(k.level,k.row,k.col),"unavailable"===g){if(!b.upsampleTile(k))return"unavailable"}else return g};d.fetchAvailability=function(b,g,h,k){return this._availableLevels[b]?this.fetchTilemap(b,g,h,k).catch(w=>
w).then(w=>{if(w instanceof S.Tilemap)return w=w.getAvailability(g,h),"unavailable"===w?Promise.reject(new t("tile-map:tile-unavailable","Tile is not available",{level:b,row:g,col:h})):w;if(u.isAbortError(w))throw w;return"unknown"}):Promise.reject(new t("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`))};d.fetchAvailabilityUpsample=function(b,g,h,k,w){k.level=b;k.row=g;k.col=h;const G=this.layer.tileInfo;G.updateTileInfo(k);const J=this.fetchAvailability(b,g,h,w).catch(U=>
{if(u.isAbortError(U))throw U;if(G.upsampleTile(k))return this.fetchAvailabilityUpsample(k.level,k.row,k.col,k);throw U;});this._fetchAvailabilityUpsamplePrefetch(k.id,b,g,h,w,J);return J};d._fetchAvailabilityUpsamplePrefetch=function(){var b=l._asyncToGenerator(function*(g,h,k,w,G,J){if(this._prefetchingEnabled){var U=`prefetch-${g}`;if(!this._handles.has(U)){var O=u.createAbortController();J.then(()=>O.abort(),()=>O.abort());var P=!1;this._handles.add({remove(){P||(P=!0,O.abort())}},U);yield M.waitTicks(10,
O.signal).catch(()=>{});P||(P=!0,this._handles.remove(U));if(!u.isAborted(O))for(g={id:g,level:h,row:k,col:w},G={...G,signal:O.signal},h=this.layer.tileInfo,k=0;I._prefetches.length<I._maxPrefetch&&h.upsampleTile(g);++k){const Q=this.fetchAvailability(g.level,g.row,g.col,G);I._prefetches.push(Q);w=()=>{I._prefetches.removeUnordered(Q)};Q.then(w,w)}}}});return function(g,h,k,w,G,J){return b.apply(this,arguments)}}();d._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var b=this.layer.parsedUrl,
g=b.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:b.path,query:g?N.objectToQuery(g):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};d._tilemapFromCache=function(b,g,h,k){k.level=b;k.row=g-g%this.size;k.col=h-h%this.size;b=S.tilemapDefinitionId(k);return this._tilemapCache.get(b)};d._initializeAvailableLevels=function(b){this._availableLevels={};b&&b.forEach(g=>this._availableLevels[g.level]=
!0)};l._createClass(z,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const b=this;return{get prefetchingEnabled(){return b._prefetchingEnabled},set prefetchingEnabled(g){b._prefetchingEnabled=g},hasTilemap(g,h,k){return!!b._tilemapFromCache(g,h,k,b._tmpTilemapDefinition)}}}}]);return z}(q);r.TilemapCache._maxPrefetch=4;r.TilemapCache._prefetches=new x({initialSize:I._maxPrefetch});c.__decorate([L.property({constructOnly:!0,type:Number})],r.TilemapCache.prototype,"levels",
void 0);c.__decorate([H.cast("levels")],r.TilemapCache.prototype,"castLevels",null);c.__decorate([L.property({readOnly:!0,type:Number})],r.TilemapCache.prototype,"size",null);c.__decorate([L.property({constructOnly:!0,type:Number})],r.TilemapCache.prototype,"cacheByteSize",void 0);c.__decorate([L.property({constructOnly:!0})],r.TilemapCache.prototype,"layer",void 0);c.__decorate([L.property({constructOnly:!0})],r.TilemapCache.prototype,"request",void 0);r.TilemapCache=I=c.__decorate([D.subclass("esri.layers.support.TilemapCache")],
r.TilemapCache);Object.defineProperty(r,"__esModule",{value:!0})})},"esri/layers/support/Tilemap":function(){define(["exports","../../request","../../core/arrayUtils","../../core/Error","../../core/lang"],function(r,l,c,e,q){function t(n){if("vector-tile"===n.service.type)var F=`${n.service.url}/tilemap/${n.level}/${n.row}/${n.col}/${n.width}/${n.height}`;else F=n.service.tileServers,F=`${F&&F.length?F[n.row%F.length]:n.service.url}/tilemap/${n.level}/${n.row}/${n.col}/${n.width}/${n.height}`;(n=
n.service.query)&&(F=`${F}?${n}`);return F}let v=function(){function n(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var F=n.prototype;F.getAvailability=function(x,u){if("unknown"!==this._allAvailability)return this._allAvailability;x=(x-this.location.top)*this.location.width+(u-this.location.left);u=x>>3;const M=this._tileAvailabilityBitSet;return 0>u||u>M.length?"unknown":M[u]&1<<x%8?"available":"unavailable"};F._updateFromData=function(x){let u=
!0,M=!0;const N=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));let C=0;for(let L=0;L<x.length;L++){const V=L%8;x[L]?(M=!1,N[C]|=1<<V):u=!1;7===V&&++C}M?this._allAvailability="unavailable":u?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=N,this.byteSize+=N.length)};n.fromDefinition=function(x,u){const M=x.service.request||l,{row:N,col:C,width:L,height:V}=x,H={query:{f:"json"}};u=u?{...H,...u}:H;return M(t(x),u).then(D=>D.data).catch(D=>
{if(D&&D.details&&422===D.details.httpStatus)return{location:{top:N,left:C,width:L,height:V},valid:!0,data:c.constant(L*V,0)};throw D;}).then(D=>{if(D.location&&(D.location.top!==N||D.location.left!==C||D.location.width!==L||D.location.height!==V))throw new e("tilemap:location-mismatch","Tilemap response for different location than requested",{response:D,definition:{top:N,left:C,width:L,height:V}});return n.fromJSON(D)})};n.fromJSON=function(x){n.validateJSON(x);const u=new n;u.location=Object.freeze(q.clone(x.location));
u._updateFromData(x.data);return Object.freeze(u)};n.validateJSON=function(x){if(!x||!x.location)throw new e("tilemap:missing-location","Location missing from tilemap response");if(!1===x.valid)throw new e("tilemap:invalid","Tilemap response was marked as invalid");if(!x.data)throw new e("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(x.data))throw new e("tilemap:data-mismatch","Data must be an array of numbers");if(x.data.length!==x.location.width*x.location.height)throw new e("tilemap:data-mismatch",
"Number of data items does not match width/height of tilemap");};return n}();r.Tilemap=v;r["default"]=v;r.tilemapDefinitionId=function(n){return`${n.level}/${n.row}/${n.col}/${n.width}/${n.height}`};Object.defineProperty(r,"__esModule",{value:!0})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(r,l,c,e,q,t,v,n,F,x,u,M,N,C,L,V){r.ArcGISMapService=H=>{H=function(D){function S(){var B=D.apply(this,arguments)||this;B.capabilities=void 0;B.copyright=null;B.fullExtent=null;B.legendEnabled=!0;B.spatialReference=null;B.version=null;return B}l._inheritsLoose(S,D);var I=S.prototype;I.readCapabilities=function(B,y){var z=y.capabilities&&y.capabilities.split(",").map(J=>J.toLowerCase().trim());if(!z)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};var d=this.type;B=-1!==z.indexOf("query");const b=-1!==z.indexOf("map"),g=!!y.exportTilesAllowed;z=-1!==z.indexOf("tilemap");const h="tile"!==d&&!!y.supportsDynamicLayers,k="tile"!==d&&(!y.tileInfo||h),w="tile"!==d&&(!y.tileInfo||h);d="tile"!==d;const G=y.cimVersion?v.Version.parse(y.cimVersion).since(1,4):!1;return{operations:{supportsQuery:B,supportsExportMap:b,supportsExportTiles:g,supportsTileMap:z},exportMap:b?{supportsArcadeExpressionForLabeling:G,supportsSublayersChanges:d,
supportsDynamicLayers:h,supportsSublayerVisibility:k,supportsSublayerDefinitionExpression:w}:null,exportTiles:g?{maxExportTilesCount:+y.maxExportTilesCount}:null}};I.readVersion=function(B,y){(B=y.currentVersion)||(B=y.hasOwnProperty("capabilities")||y.hasOwnProperty("tables")?10:y.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return B};I.fetchSublayerInfo=function(){var B=l._asyncToGenerator(function*(y,z){yield this.fetchAllLayersAndTables(z);return this._allLayersAndTablesMap.get(y)});
return function(y,z){return B.apply(this,arguments)}}();I.fetchAllLayersAndTables=function(){var B=l._asyncToGenerator(function*(y){yield this.load(y);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=e(t.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(d=>{this._allLayersAndTablesMap=new Map;for(const b of d.data.layers)this._allLayersAndTablesMap.set(b.id,b);return{result:d.data}},d=>({error:d})));const z=
yield this._allLayersAndTablesPromise;q.throwIfAborted(y);if("result"in z)return z.result;throw z.error;});return function(y){return B.apply(this,arguments)}}();return S}(H);c.__decorate([n.property({readOnly:!0})],H.prototype,"capabilities",void 0);c.__decorate([M.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],H.prototype,"readCapabilities",null);c.__decorate([n.property({json:{read:{source:"copyrightText"}}})],H.prototype,
"copyright",void 0);c.__decorate([n.property({type:C})],H.prototype,"fullExtent",void 0);c.__decorate([n.property(V.id)],H.prototype,"id",void 0);c.__decorate([n.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],H.prototype,"legendEnabled",void 0);c.__decorate([n.property(V.popupEnabled)],H.prototype,"popupEnabled",void 0);c.__decorate([n.property({type:L})],H.prototype,"spatialReference",void 0);c.__decorate([n.property()],
H.prototype,"version",void 0);c.__decorate([M.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],H.prototype,"readVersion",null);return H=c.__decorate([N.subclass("esri.layers.mixins.ArcGISMapService")],H)};Object.defineProperty(r,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(r,l){let c=function(){function e(t,v,n=""){this.major=t;this.minor=v;this._context=n}var q=e.prototype;q.lessThan=function(t,v){return this.major<
t||t===this.major&&this.minor<v};q.since=function(t,v){return!this.lessThan(t,v)};q.validate=function(t){if(this.major!==t.major)throw new l((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t});};q.clone=function(){return new e(this.major,this.minor,this._context)};e.parse=function(t,v=""){const [n,F]=t.split(".");var x=/^\s*\d+\s*$/;if(!n||!n.match||!n.match(x))throw new l((v&&
v+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!F||!F.match||!F.match(x))throw new l((v&&v+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});t=parseInt(n,10);x=parseInt(F,10);return new e(t,x,v)};return e}();r.Version=c;Object.defineProperty(r,"__esModule",{value:!0})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(r,l,c,e,q,t,v,n,F,x,u,M,N,C,L){function V(I,B){const y=[],z={};if(!I)return y;I.forEach(d=>{const b=new C;b.read(d,B);z[b.id]=b;null!=d.parentLayerId&&-1!==d.parentLayerId?(d=z[d.parentLayerId],d.sublayers||(d.sublayers=[]),d.sublayers.unshift(b)):y.unshift(b)});return y}function H(I,B){I&&I.forEach(y=>{B(y);y.sublayers&&y.sublayers.length&&H(y.sublayers,B)})}const D=v.getLogger("esri.layers.TileLayer"),S=e.ofType(C);r.SublayersOwner=I=>{I=function(B){function y(...d){var b=B.call(this,...d)||
this;b.allSublayers=new q({getCollections:()=>[b.sublayers],getChildrenFunction(g){return g.sublayers}});b.sublayersSourceJSON={[2]:{},[3]:{},[4]:{},[5]:{}};b.handles.add(b.watch("sublayers",(g,h)=>b._handleSublayersChange(g,h),!0));return b}l._inheritsLoose(y,B);var z=y.prototype;z.readSublayers=function(d,b){if(b&&d){var {sublayersSourceJSON:g}=this,h=N.nameToId(b.origin);if(!(2>h||(g[h]={context:b,visibleLayers:d.visibleLayers||g[h].visibleLayers,layers:d.layers||g[h].layers},2<h))){this._set("serviceSublayers",
this.createSublayersForOrigin("service").sublayers);var {sublayers:k,origin:w}=this.createSublayersForOrigin("web-document");d=x.getProperties(this);d.setDefaultOrigin(w);this._set("sublayers",new S(k));d.setDefaultOrigin("user")}}};z.findSublayerById=function(d){return this.allSublayers.find(b=>b.id===d)};z.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};z.createSublayersForOrigin=function(d){const b="web-document"===d?N.nameToId("web-map"):N.nameToId(d);
let g=2;d=this.sublayersSourceJSON[2].layers;let h=this.sublayersSourceJSON[2].context,k=null;var w=[3,4,5].filter(Q=>Q<=b);for(var G of w)w=this.sublayersSourceJSON[G],L.isSublayerOverhaul(w.layers)&&(g=G,d=w.layers,h=w.context,w.visibleLayers&&(k={visibleLayers:w.visibleLayers,context:w.context}));G=[3,4,5].filter(Q=>Q>g&&Q<=b);let J=null;for(var U of G){const {layers:Q,visibleLayers:ca,context:Y}=this.sublayersSourceJSON[U];Q&&(J={layers:Q,context:Y});ca&&(k={visibleLayers:ca,context:Y})}U=V(d,
h);const O=new Map,P=new Set;if(J)for(const Q of J.layers)O.set(Q.id,Q);if(k)for(const Q of k.visibleLayers)P.add(Q);H(U,Q=>{J&&Q.read(O.get(Q.id),J.context);k&&Q.read({defaultVisibility:P.has(Q.id)},k.context)});return{origin:N.idToName(g),sublayers:new S({items:U})}};z.read=function(d,b){B.prototype.read.call(this,d,b);this.readSublayers(d,b)};z._handleSublayersChange=function(d,b){b&&(b.forEach(g=>{g.parent=null;g.layer=null}),this.handles.remove("sublayers-owner"));d&&(d.forEach(g=>{g.parent=
this;g.layer=this}),this.handles.add([d.on("after-add",({item:g})=>{g.parent=this;g.layer=this}),d.on("after-remove",({item:g})=>{g.parent=null;g.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(d.on("before-changes",g=>{D.error(new t("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));g.preventDefault()}),"sublayers-owner"))};return y}(I);c.__decorate([n.property({readOnly:!0})],I.prototype,"allSublayers",
void 0);c.__decorate([n.property({readOnly:!0,type:e.ofType(C)})],I.prototype,"serviceSublayers",void 0);c.__decorate([n.property({value:null,type:S,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],I.prototype,"sublayers",void 0);c.__decorate([n.property({readOnly:!0})],I.prototype,"sublayersSourceJSON",void 0);return I=c.__decorate([M.subclass("esri.layers.mixins.SublayersOwner")],I)};r.forEachSublayer=H;Object.defineProperty(r,"__esModule",{value:!0})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ./FeatureType ./Field ./FieldsIndex ./LabelClass ./LayerFloorInfo ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/Query ../../support/popupUtils ../../views/support/floorFilterUtils ../../geometry/Extent".split(" "),
function(r,l,c,e,q,t,v,n,F,x,u,M,N,C,L,V,H,D,S,I,B,y,z,d,b,g,h,k,w,G,J,U,O,P,Q,ca,Y,p,K,W,Z,ba,ja,ea,ra,sa){function ma(T){return T&&"esriSMS"===T.type}function na(T,aa,A){var a;T=this.originIdOf(aa)>=Q.nameToId(A.origin);return{ignoreOrigin:!0,allowNull:T,enabled:A?"map-image"===(null==(a=A.layer)?void 0:a.type)&&(A.writeSublayerStructure||T):!1}}function qa(T,aa,A){var a;return{enabled:A?"tile"===(null==(a=A.layer)?void 0:a.type)&&this._isOverridden(aa):!1}}function da(T,aa,A){return{ignoreOrigin:!0,
enabled:A&&A.writeSublayerStructure||!1}}function ka(T,aa,A){return{ignoreOrigin:!0,enabled:A?A.writeSublayerStructure||this.originIdOf(aa)>=Q.nameToId(A.origin):!1}}var la;const oa=z.getLogger("esri.layers.support.Sublayer");let ta=0;const ha=new Set;ha.add("layer");ha.add("parent");ha.add("loaded");ha.add("loadStatus");ha.add("loadError");ha.add("loadWarnings");e=la=function(T){function aa(a){a=T.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.globalIdField=null;a.legendEnabled=
!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;return a}l._inheritsLoose(aa,T);var A=aa.prototype;A.load=function(){var a=l._asyncToGenerator(function*(f){var m=this;this.addResolvingPromise(l._asyncToGenerator(function*(){var E;if(!m.layer&&!m.url)throw new D("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:m});let R=null;if(!m.layer||2<m.originIdOf("url")||"data-layer"===(null==
(E=m.source)?void 0:E.type))R=(yield L(m.url,{responseType:"json",query:{f:"json"},...f})).data;else{var X;E=m.id;"map-layer"===(null==(X=m.source)?void 0:X.type)&&(E=m.source.mapLayerId);R=yield m.layer.fetchSublayerInfo(E,f)}R&&(m.sourceJSON=R,m.read({layerDefinition:R},{origin:"service"}))})());return this});return function(f){return a.apply(this,arguments)}}();A.readCapabilities=function(a,f){f=f.layerDefinition||f;a=(a=f.capabilities||a)?a.toLowerCase().split(",").map(m=>m.trim()):[];return{exportMap:{supportsModification:!!f.canModifyLayer},
operations:{supportsQuery:-1!==a.indexOf("query")}}};A.readGlobalIdFieldFromService=function(a,f){f=f.layerDefinition||f;if(f.globalIdField)return f.globalIdField;if(f.fields)for(const m of f.fields)if("esriFieldTypeGlobalID"===m.type)return m.name};A.writeLabelingInfo=function(a,f,m,E){a&&a.length&&(f.layerDefinition={drawingInfo:{labelingInfo:a.map(R=>R.write({},E))}})};A.readMinScale=function(a,f){return f.minScale||f.layerDefinition&&f.layerDefinition.minScale||0};A.readMaxScale=function(a,f){return f.maxScale||
f.layerDefinition&&f.layerDefinition.maxScale||0};A.readObjectIdFieldFromService=function(a,f){f=f.layerDefinition||f;if(f.objectIdField)return f.objectIdField;if(f.fields)for(const m of f.fields)if("esriFieldTypeOID"===m.type)return m.name};A.readOpacity=function(a,f){a=f.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};A.writeOpacity=function(a,f,m,E){f.layerDefinition={drawingInfo:{transparency:100-100*a}}};A.writeParent=function(a,f){f.parentLayerId=
this.parent&&this.parent!==this.layer?P.ensureInteger(this.parent.id):-1};A.castSublayers=function(a){return P.ensureType(H.ofType(la),a)};A.writeSublayers=function(a,f,m){this.get("sublayers.length")&&(f[m]=this.sublayers.map(E=>E.id).toArray().reverse())};A.readTypeIdField=function(a,f){f=f.layerDefinition||f;let m=f.typeIdField;m&&f.fields&&(m=m.toLowerCase(),a=f.fields.find(E=>E.name.toLowerCase()===m))&&(m=a.name);return null};A.writeVisible=function(a,f,m,E){f[m]=this.getAtOrigin("defaultVisibility",
"service")||a};A.clone=function(){const {store:a}=k.getProperties(this),f=new la;k.getProperties(f).store=a.clone(ha);this.commitProperty("url");f._lastParsedUrl=this._lastParsedUrl;return f};A.createPopupTemplate=function(a){return ea.createPopupTemplate(this,a)};A.createQuery=function(){return new ja({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};A.createFeatureLayer=function(){var a=l._asyncToGenerator(function*(){var f,m;if(this.hasOwnProperty("sublayers"))return null;const E=
null==(f=this.layer)?void 0:f.parsedUrl;f=new (yield new Promise(function(R,X){r(["../FeatureLayer"],function(fa){R(Object.freeze({__proto__:null,default:fa}))},X)})).default({url:E.path});E&&this.source&&("map-layer"===this.source.type?f.layerId=this.source.mapLayerId:f.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(f.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(f.definitionExpression=this.definitionExpression);this.floorInfo&&(f.floorInfo=B.clone(this.floorInfo));
2<this.originIdOf("labelingInfo")&&(f.labelingInfo=B.clone(this.labelingInfo));0<this.originIdOf("labelsVisible")&&(f.labelsVisible=this.labelsVisible);0<this.originIdOf("legendEnabled")&&(f.legendEnabled=this.legendEnabled);0<this.originIdOf("visible")&&(f.visible=this.visible);0<this.originIdOf("minScale")&&(f.minScale=this.minScale);0<this.originIdOf("maxScale")&&(f.maxScale=this.maxScale);0<this.originIdOf("opacity")&&(f.opacity=this.opacity);0<this.originIdOf("popupTemplate")&&(f.popupTemplate=
B.clone(this.popupTemplate));2<this.originIdOf("renderer")&&(f.renderer=B.clone(this.renderer));"data-layer"===(null==(m=this.source)?void 0:m.type)&&(f.dynamicDataSource=this.source.clone());0<this.originIdOf("title")&&(f.title=this.title);"map-image"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(f.customParameters=this.layer.customParameters);"tile"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(f.customParameters=this.layer.customParameters);return f});return function(){return a.apply(this,
arguments)}}();A.getField=function(a){return this.fieldsIndex.get(a)};A.getFeatureType=function(a){const {typeIdField:f,types:m}=this;if(!f||!a)return null;const E=a.attributes?a.attributes[f]:void 0;if(null==E)return null;let R=null;m.some(X=>{const {id:fa}=X;if(null==fa)return!1;fa.toString()===E.toString()&&(R=X);return!!R});return R};A.getFieldDomain=function(a,f){return(f=this.getFeatureType(f&&f.feature))&&(f=f.domains&&f.domains[a])&&"inherited"!==f.type?f:this._getLayerDomain(a)};A.queryFeatures=
function(){var a=l._asyncToGenerator(function*(f=this.createQuery(),m){var E,R,X,fa;yield this.load();if(!this.get("capabilities.operations.supportsQuery"))throw new D("Sublayer.queryFeatures","this layer doesn't support queries.");const [{executeQuery:ua},{default:va}]=yield Promise.all([new Promise(function(ia,pa){r(["../../rest/query/operations/query"],ia,pa)}),new Promise(function(ia,pa){r(["../../rest/support/FeatureSet"],function(wa){ia(Object.freeze({__proto__:null,default:wa}))},pa)})]);f=
yield ua(this.url,ja.from(f),null!=(E=null==(R=this.layer)?void 0:R.spatialReference)?E:null,{...m,query:{...null==(X=this.layer)?void 0:X.customParameters,token:null==(fa=this.layer)?void 0:fa.apiKey}});E=va.fromJSON(f.data);if(null!=E&&E.features)for(const ia of E.features)ia.sourceLayer=this;return E});return function(){return a.apply(this,arguments)}}();A.toExportImageJSON=function(a){var f;const m={id:this.id,source:(null==(f=this.source)?void 0:f.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};
this.definitionExpression?(a=d.isSome(a)?ra.combineFloorsDefinitionExpression(a,this):this.definitionExpression,m.definitionExpression=a):d.isSome(a)&&(m.definitionExpression=a);const E=["renderer","labelingInfo","opacity","labelsVisible"].reduce((R,X)=>{R[X]=this.originIdOf(X);return R},{});Object.keys(E).some(R=>2<E[R])&&(a=m.drawingInfo={},2<E.renderer&&(a.renderer=this.renderer?this.renderer.toJSON():null),2<E.labelsVisible&&(a.showLabels=this.labelsVisible),this.labelsVisible&&2<E.labelingInfo&&
(a.labelingInfo=this.labelingInfo?this.labelingInfo.map(R=>R.write({},{origin:"service",layer:this.layer})):null,a.showLabels=!0),2<E.opacity&&(a.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(a.renderer));return m};A._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,f=>{f.color||"esriSMSX"!==f.style&&"esriSMSCross"!==f.style||(f.color=f.outline&&f.outline.color?f.outline.color:[0,0,0,0])})};A._forEachSimpleMarkerSymbols=function(a,f){if(a){const m="uniqueValueInfos"in
a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(const E of m)ma(E.symbol)&&f(E.symbol);"symbol"in a&&ma(a.symbol)&&f(a.symbol);"defaultSymbol"in a&&ma(a.defaultSymbol)&&f(a.defaultSymbol)}};A._setAndNotifyLayer=function(a,f){const m=this.layer,E=this._get(a);let R,X;switch(a){case "definitionExpression":case "floorInfo":R="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":R="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":R=
"supportsDynamicLayers",X="supportsModification"}const fa=k.getProperties(this).getDefaultOrigin();if("service"!==fa){if(R&&!1===this.get(`layer.capabilities.exportMap.${R}`)){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${R}'`);return}if(X&&!1===this.get(`capabilities.exportMap.${X}`)){this._logLockedError(a,`capability not available 'capabilities.exportMap.${X}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):
(this._set(a,f),"service"!==fa&&E!==f&&m&&m.emit&&m.emit("sublayer-update",{propertyName:a,target:this}))};A._handleSublayersChange=function(a,f){f&&(f.forEach(m=>{m.parent=null;m.layer=null}),this.handles.removeAll());a&&(a.forEach(m=>{m.parent=this;m.layer=this.layer}),this.handles.add([a.on("after-add",({item:m})=>{m.parent=this;m.layer=this.layer}),a.on("after-remove",({item:m})=>{m.parent=null;m.layer=null}),a.on("before-changes",m=>{const E=this.get("layer.capabilities.exportMap.supportsSublayersChanges");
null==E||E||(oa.error(new D("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),m.preventDefault())})]))};A._logLockedError=function(a,f){oa.error(new D("sublayer:locked",`Property '${a}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:f,sublayer:this,layer:this.layer}))};A._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};l._createClass(aa,[{key:"definitionExpression",
set:function(a){this._setAndNotifyLayer("definitionExpression",a)}},{key:"fieldsIndex",get:function(){return new p(this.fields||[])}},{key:"floorInfo",set:function(a){this._setAndNotifyLayer("floorInfo",a)}},{key:"id",get:function(){const a=this._get("id");return null==a?ta++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",
a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",a)}},{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",a)}},{key:"layer",set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(f=>f.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",
a)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(a){if(a)for(const f of a.getSymbols())if(V.isSymbol3D(f)){oa.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)}},{key:"source",get:function(){return this._get("source")||new ba.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",set:function(a){this._handleSublayersChange(a,this._get("sublayers"));
this._set("sublayers",a)}},{key:"url",get:function(){var a,f;const m=null!=(a=null==(f=this.layer)?void 0:f.parsedUrl)?a:this._lastParsedUrl;a=this.source;if(!m)return null;this._lastParsedUrl=m;if("map-layer"===(null==a?void 0:a.type))return`${m.path}/${a.mapLayerId}`;a={layer:JSON.stringify({source:this.source})};return`${m.path}/dynamicLayer?${g.objectToQuery(a)}`},set:function(a){a?this._override("url",a):this._clearOverride("url")}},{key:"visible",set:function(a){this._setAndNotifyLayer("visible",
a)}}]);return aa}(S.HandleOwnerMixin(b.MultiOriginJSONMixin(I.IdentifiableMixin(y))));e.test={isMapImageLayerOverridePolicy:T=>T===da||T===na,isTileImageLayerOverridePolicy:T=>T===qa};c.__decorate([h.property({readOnly:!0})],e.prototype,"capabilities",void 0);c.__decorate([J.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],e.prototype,"readCapabilities",null);c.__decorate([h.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",
write:{overridePolicy:na}}})],e.prototype,"definitionExpression",null);c.__decorate([h.property({type:[Y],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],e.prototype,"fields",void 0);c.__decorate([h.property({readOnly:!0})],e.prototype,"fieldsIndex",null);c.__decorate([h.property({type:W,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:na},origins:{"web-scene":{read:!1,write:!1}}}})],
e.prototype,"floorInfo",null);c.__decorate([h.property({type:sa,json:{read:{source:"layerDefinition.extent"}}})],e.prototype,"fullExtent",void 0);c.__decorate([h.property({type:String})],e.prototype,"globalIdField",void 0);c.__decorate([J.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],e.prototype,"readGlobalIdFieldFromService",null);c.__decorate([h.property({type:P.Integer,json:{write:{ignoreOrigin:!0}}})],e.prototype,"id",null);c.__decorate([h.property({value:null,
type:[K],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:da}}})],e.prototype,"labelingInfo",null);c.__decorate([O.writer("labelingInfo")],e.prototype,"writeLabelingInfo",null);c.__decorate([h.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:da}}})],e.prototype,"labelsVisible",null);c.__decorate([h.property({value:null})],
e.prototype,"layer",null);c.__decorate([h.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:ka}}})],e.prototype,"legendEnabled",void 0);c.__decorate([h.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],e.prototype,"listMode",null);c.__decorate([h.property({type:Number,value:0,json:{write:{overridePolicy:da}}})],e.prototype,"minScale",
null);c.__decorate([J.reader("minScale",["minScale","layerDefinition.minScale"])],e.prototype,"readMinScale",null);c.__decorate([h.property({type:Number,value:0,json:{write:{overridePolicy:da}}})],e.prototype,"maxScale",null);c.__decorate([J.reader("maxScale",["maxScale","layerDefinition.maxScale"])],e.prototype,"readMaxScale",null);c.__decorate([h.property({type:String})],e.prototype,"objectIdField",void 0);c.__decorate([J.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],
e.prototype,"readObjectIdFieldFromService",null);c.__decorate([h.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:da}}})],e.prototype,"opacity",null);c.__decorate([J.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],e.prototype,"readOpacity",null);c.__decorate([O.writer("opacity")],e.prototype,"writeOpacity",null);c.__decorate([h.property({json:{type:P.Integer,write:{target:"parentLayerId",allowNull:!0,
overridePolicy:da}}})],e.prototype,"parent",void 0);c.__decorate([O.writer("parent")],e.prototype,"writeParent",null);c.__decorate([h.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(T,aa){return!aa.disablePopup}},write:{target:"disablePopup",overridePolicy:ka,writer(T,aa,A){aa[A]=!T}}}})],e.prototype,"popupEnabled",void 0);c.__decorate([h.property({type:q,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:ka}}})],e.prototype,"popupTemplate",void 0);c.__decorate([h.property({readOnly:!0})],
e.prototype,"defaultPopupTemplate",null);c.__decorate([h.property({types:C.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:da},origins:{"web-scene":{types:C.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:da}}}}})],e.prototype,"renderer",null);c.__decorate([h.property({types:{key:"type",base:null,typeMap:{"data-layer":Z.DataLayerSource,"map-layer":ba.MapLayerSource}},cast(T){if(T){if("mapLayerId"in T)return P.ensureClass(ba.MapLayerSource,
T);if("dataSource"in T)return P.ensureClass(Z.DataLayerSource,T)}return T},json:{name:"layerDefinition.source",write:{overridePolicy:da}}})],e.prototype,"source",null);c.__decorate([h.property()],e.prototype,"sourceJSON",void 0);c.__decorate([h.property({value:null,json:{type:[P.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:da}}})],e.prototype,"sublayers",null);c.__decorate([w.cast("sublayers")],e.prototype,"castSublayers",null);c.__decorate([O.writer("sublayers")],e.prototype,
"writeSublayers",null);c.__decorate([h.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:ka}}})],e.prototype,"title",void 0);c.__decorate([h.property({type:String})],e.prototype,"typeIdField",void 0);c.__decorate([J.reader("typeIdField",["layerDefinition.typeIdField"])],e.prototype,"readTypeIdField",null);c.__decorate([h.property({type:[ca],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],e.prototype,"types",void 0);c.__decorate([h.property({type:String,
json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:qa}}})],e.prototype,"url",null);c.__decorate([h.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:da}}})],e.prototype,"visible",null);c.__decorate([O.writer("visible")],e.prototype,"writeVisible",null);return e=la=c.__decorate([U.subclass("esri.layers.support.Sublayer")],e)})},"esri/views/support/floorFilterUtils":function(){define(["exports"],function(r){function l(c,
e){if(null==c||!c.length)return null;c=c.filter(q=>""!==q).map(q=>`'${q}'`);c.push("''");return`${e} IN (${c.join(",")}) OR ${e} IS NULL`}r.combineFloorsDefinitionExpression=function(c,e){({definitionExpression:e}=e);return c?e?`(${e}) AND (${c})`:c:e};r.getFloorFilterClause=function(c){var e;const q=c.layer;return"floorInfo"in q&&null!=(e=q.floorInfo)&&e.floorField&&"floors"in c.view?l(c.view.floors,q.floorInfo.floorField):null};r.getLayerFloorFilterClause=function(c,e){var q;return"floorInfo"in
e&&null!=(q=e.floorInfo)&&q.floorField?l(c,e.floorInfo.floorField):null};Object.defineProperty(r,"__esModule",{value:!0})})},"esri/layers/support/sublayerUtils":function(){define(["exports"],function(r){function l(c,e){if(!c||!c.length)return!0;e=e.slice().reverse().flatten(({sublayers:v})=>v&&v.toArray().reverse()).map(v=>v.id).toArray();if(c.length>e.length)return!1;let q=0;const t=e.length;for(const {id:v}of c){for(;q<t&&e[q]!==v;)q++;if(q>=t)return!1}return!0}r.isExportDynamic=function(c,e,q){return c.some(t=>
{const v=t.source;return!(!v||"map-layer"===v.type&&v.mapLayerId===t.id&&(!v.gdbVersion||v.gdbVersion===q.gdbVersion))||2<t.originIdOf("renderer")||2<t.originIdOf("labelingInfo")||2<t.originIdOf("opacity")||2<t.originIdOf("labelsVisible")})?!0:!l(c,e)};r.isSublayerOverhaul=function(c){return!!c&&c.some(e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale)};r.shouldWriteSublayerStructure=function(c,e,q){return e.flatten(({sublayers:t})=>t).length!==c.length||c.some(t=>t.originIdOf("minScale")>
q||t.originIdOf("maxScale")>q||t.originIdOf("renderer")>q||t.originIdOf("labelingInfo")>q||t.originIdOf("opacity")>q||t.originIdOf("labelsVisible")>q||t.originIdOf("source")>q)?!0:!l(c,e)};Object.defineProperty(r,"__esModule",{value:!0})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../geometry ../request ../core/Error ../core/HandleOwner ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/decorators/cast ../core/Logger ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/commonProperties ./support/Sublayer ../geometry/SpatialReference".split(" "),function(r,
l,c,e,q,t,v,n,F,x,u,M,N,C,L,V,H,D,S,I,B,y,z,d,b,g,h,k,w,G,J,U,O){const P="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");c=function(Q){function ca(...p){p=
Q.call(this,...p)||this;p.listMode="show";p.isReference=null;p.operationalLayerType="ArcGISTiledMapServiceLayer";p.resampling=!0;p.sourceJSON=null;p.spatialReference=null;p.path=null;p.sublayers=null;p.type="tile";p.url=null;return p}r._inheritsLoose(ca,Q);var Y=ca.prototype;Y.normalizeCtorArgs=function(p,K){return"string"===typeof p?{url:p,...K}:p};Y.load=function(p){const K=v.isSome(p)?p.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},p).catch(F.throwIfAbortError).then(()=>
this._fetchService(K)));return Promise.resolve(this)};Y.readSpatialReference=function(p,K){return(p=p||K.tileInfo&&K.tileInfo.spatialReference)&&O.fromJSON(p)};Y.writeSublayers=function(p,K,W,Z){if(this.loaded&&p){p=p.slice().reverse().flatten(({sublayers:ea})=>ea&&ea.toArray().reverse()).toArray();var ba=[],ja={writeSublayerStructure:!1,...Z};p.forEach(ea=>{ea=ea.write({},ja);ba.push(ea)});ba.some(ea=>1<Object.keys(ea).length)&&(K.layers=ba)}};Y.castTileServers=function(p){return Array.isArray(p)?
p.map(K=>x.urlToObject(K).path):null};Y.fetchTile=function(p,K,W,Z={}){({signal:Z}=Z);p=this.getTileUrl(p,K,W);return e(p,{responseType:"image",signal:Z,query:{...this.refreshParameters}}).then(ba=>ba.data)};Y.getTileUrl=function(p,K,W){const Z=x.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,...this.customParameters,token:this.apiKey}),ba=this.tileServers;return`${ba&&ba.length?ba[K%ba.length]:this.parsedUrl.path}/tile/${p}/${K}/${W}${Z?"?"+Z:
""}`};Y._fetchService=function(p){return(new Promise((K,W)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new q("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");K({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new q("tile-layer:undefined-url","layer's url is not defined");var Z=G.parse(this.parsedUrl.path);if(v.isSome(Z)&&"ImageServer"===Z.serverType)throw new q("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
e(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:p}).then(K,W)}})).then(K=>{K.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=K.data;this.read(K.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!G.isHostedAgolService(this.url))return this._fetchServerVersion(this.url,p).then(W=>{this.read({currentVersion:W})}).catch(()=>{})})};Y._fetchServerVersion=function(p,K){if(!G.isArcGISUrl(p))return Promise.reject();
p=p.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return e(p,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:K}).then(W=>{if(W.data&&W.data.currentVersion)return W.data.currentVersion;throw new q("tile-layer:version-not-available");})};Y._getMapName=function(p){return(p=p.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&p[2]};Y._getDefaultAttribution=
function(p){if(p){p=p.toLowerCase();for(let W=0,Z=P.length;W<Z;W++){var K=P[W];if(-1<K.toLowerCase().indexOf(p))return x.makeAbsolute("//static.arcgis.com/attribution/"+K)}}};Y._getDefaultTileServers=function(p){const K=-1!==p.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),W=-1!==p.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return K||W?[p,p.replace(K?/server\.arcgisonline/i:/services\.arcgisonline/i,K?"services.arcgisonline":"server.arcgisonline")]:[]};r._createClass(ca,[{key:"attributionDataUrl",
get:function(){var p;const K=null==(p=this.parsedUrl)?void 0:p.path.toLowerCase();return K&&this._getDefaultAttribution(this._getMapName(K))}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}},{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile.__isDefault__}}]);return ca}(z.BlendLayer(w.SublayersOwner(k.ScaleRangeLayer(b.OperationalLayer(g.PortalLayer(I.ArcGISCachedService(B.ArcGISMapService(y.ArcGISService(n.MultiOriginJSONMixin(t.HandleOwnerMixin(h.RefreshableLayer(S.APIKeyMixin(d.CustomParametersMixin(D))))))))))))));
l.__decorate([u.property({readOnly:!0})],c.prototype,"attributionDataUrl",null);l.__decorate([u.property({type:["show","hide","hide-children"]})],c.prototype,"listMode",void 0);l.__decorate([u.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],c.prototype,"isReference",void 0);l.__decorate([u.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],c.prototype,"operationalLayerType",void 0);l.__decorate([u.property({type:Boolean})],c.prototype,"resampling",
void 0);l.__decorate([u.property()],c.prototype,"sourceJSON",void 0);l.__decorate([u.property({type:O})],c.prototype,"spatialReference",void 0);l.__decorate([L.reader("spatialReference",["spatialReference","tileInfo"])],c.prototype,"readSpatialReference",null);l.__decorate([u.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],c.prototype,"path",void 0);l.__decorate([u.property({readOnly:!0})],c.prototype,"sublayers",void 0);l.__decorate([H.writer("sublayers",{layers:{type:[U]}})],
c.prototype,"writeSublayers",null);l.__decorate([u.property({json:{read:!1,write:!1}})],c.prototype,"popupEnabled",void 0);l.__decorate([u.property()],c.prototype,"tileServers",null);l.__decorate([N.cast("tileServers")],c.prototype,"castTileServers",null);l.__decorate([u.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);l.__decorate([u.property(J.url)],c.prototype,"url",void 0);c=l.__decorate([V.subclass("esri.layers.TileLayer")],c);c.prototype.fetchTile.__isDefault__=!0;return c});