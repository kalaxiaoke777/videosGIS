// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Map ../TimeExtent ../core/Accessor ../core/Collection ../core/CollectionFlattener ../core/Error ../core/Evented ../core/HandleOwner ../core/Loadable ../core/Logger ../core/maybe ../core/Promise ../core/promiseUtils ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ../geometry/Extent ../geometry/HeightModelInfo ../geometry/SpatialReference ../geometry/support/spatialReferenceUtils ../support/GraphicsCollection ./BasemapView ./LayerViewManager ./Magnifier ./ToolViewManager ./input/Input ./input/ViewEvents ./navigation/Navigation ./support/DefaultsFromMap".split(" "),
function(h,d,B,C,c,m,D,E,F,G,u,H,k,I,J,K,l,v,V,W,e,L,w,M,N,O,x,P,Q,y,R,S,T,z,U){var n;const p=H.getLogger("esri.views.View");c=n=function(t){function q(b){var a=t.call(this,b)||this;a._userSpatialReference=null;a._cursor=null;a.allLayerViews=new D({getCollections:()=>{var g,r,A;return[null==(g=a.basemapView)?void 0:g.baseLayerViews,null==(r=a.groundView)?void 0:r.layerViews,a.layerViews,null==(A=a.basemapView)?void 0:A.referenceLayerViews]},getChildrenFunction:g=>g.layerViews});a.groundView=null;
a.animation=null;a.basemapView=null;a.defaultsFromMap=new U({view:h._assertThisInitialized(a)});a.fatalError=null;a.extent=null;a.graphics=new x["default"];a.navigating=!1;a.layerViews=new m;a.magnifier=new y;a.padding={left:0,top:0,right:0,bottom:0};a.ready=!1;a.spatialReferenceWarningDelay=1E3;a.supportsGround=!0;a.timeExtent=null;a.type=null;a.scale=null;a.updating=!1;a.initialExtentRequired=!0;a.input=new S;a.navigation=new z;a.layerViewManager=null;a.isHeightModelInfoRequired=!1;a.width=null;
a.height=null;a.resizing=!1;a.suspended=!1;a.viewEvents=new T.ViewEvents(h._assertThisInitialized(a));a.persistableViewModels=new m;a._isValid=!1;a._readyCycleForced=!1;a.handles.add(a.watch("preconditionsReady",g=>{g?(a._currentSpatialReference=a.spatialReference,n.views.add(h._assertThisInitialized(a))):(a._currentSpatialReference=null,n.views.remove(h._assertThisInitialized(a)));a.notifyChange("spatialReference");!g&&a.ready?(a.layerViewManager.clear(),a.toolViewManager.detach(),a._teardown()):
g&&!a.ready&&(a._startup(),a.toolViewManager.attach())},!0));return a}h._inheritsLoose(q,t);var f=q.prototype;f.initialize=function(){this.addResolvingPromise(this.validate().then(()=>{this._isValid=!0;return l.whenOnce(this,"ready")}));this.basemapView=new P.BasemapView({view:this});this.layerViewManager=new Q({view:this,layerViewImporter:{importLayerView:a=>this.importLayerView(a),hasLayerViewModule:a=>this.hasLayerViewModule(a)},supportsGround:this.supportsGround});this.toolViewManager=new R({view:this});
this._resetInitialViewPropertiesFromContent();let b;l.init(this.defaultsFromMap,"isSpatialReferenceDone",a=>{const g=!!(this.map&&0<this.map.allLayers.length);if((!a||this.spatialReference||!g)&&b)b=null;else if(a&&!this.spatialReference&&g&&!b){const r=b=J.after(this.spatialReferenceWarningDelay);b.then(()=>{r===b&&p.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}).catch(()=>{})}},!0)};f.destroy=function(){if(!this.destroyed){this.viewEvents.destroy();
this.allLayerViews.destroy();this.navigation&&(this.navigation.destroy(),this._set("navigation",null));this.graphics=k.destroyMaybe(this.graphics);this.handles.remove("defaultsFromMap");this.defaultsFromMap.destroy();this._set("defaultsFromMap",null);this.toolViewManager=k.destroyMaybe(this.toolViewManager);this.layerViewManager=k.destroyMaybe(this.layerViewManager);this.basemapView=k.destroyMaybe(this.basemapView);this.invalidate();this._emitter.clear();this.handles.removeAll();var b=this.map;this.map=
null;null==b?void 0:b.destroy()}};f._startup=function(){this._set("ready",!0)};f._teardown=function(){this._set("ready",!1)};f.whenReady=function(){return Promise.resolve(this)};f.toMap=function(){p.error("#toMap()","Not implemented on this instance of View");return null};f.whenLayerView=function(b){return this.layerViewManager.whenLayerView(b)};f.getDefaultSpatialReference=function(){return this.get("defaultsFromMap.spatialReference")};f.getDefaultHeightModelInfo=function(){return this.get("map.supportsHeightModelInfo")&&
this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null};f.importLayerView=function(b){throw new E("importLayerView() not implemented");};f.hasLayerViewModule=function(b){return!1};f.validate=function(){var b=h._asyncToGenerator(function*(){});return function(){return b.apply(this,arguments)}}();f.invalidate=function(){this._isValid=!1};f.isSpatialReferenceSupported=function(b,a,g){return!0};f.isTileInfoRequired=function(){return!1};f.when=function(b,a){this.isResolved()&&
!this.ready&&p.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.');return t.prototype.when.call(this,b,a)};f.forceReadyCycle=function(){this.ready&&(this._readyCycleForced=!0,l.whenFalseOnce(this,"preconditionsReady",()=>this._readyCycleForced=!1))};f.addAndActivateTool=function(b){this.toolViewManager.tools.add(b);this.activeTool=b};f.tryFatalErrorRecovery=function(){this.fatalError=
null};f._resetInitialViewPropertiesFromContent=function(){if(this.defaultsFromMap){var b=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset();this._currentSpatialReference=null;this.notifyChange("spatialReference");this.handles.remove("defaultsFromMap");this.handles.add([l.watch(this,"spatialReference",(a,g)=>{O.equals(a,g)||b()}),l.watch(this,"initialExtentRequired",b),K.schedule(b)],"defaultsFromMap")}};h._createClass(q,[{key:"heightModelInfo",get:function(){return this.getDefaultHeightModelInfo()}},
{key:"interacting",get:function(){return this.navigating}},{key:"preconditionsReady",get:function(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!u.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&
this.defaultsFromMap.isTileInfoDone)}},{key:"map",set:function(b){var a;const g=this._get("map");b!==g&&(null!=(a=b)&&a.destroyed&&(p.warn("#map","The provided map is already destroyed",{map:b}),b=null),u.isLoadable(b)&&b.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",b))}},{key:"spatialReference",get:function(){let b=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;b&&
this.isHeightModelInfoRequired&&this.defaultsFromMap&&(b=b.clone(),b.vcsWkid=this.defaultsFromMap.vcsWkid,b.latestVcsWkid=this.defaultsFromMap.latestVcsWkid);return b},set:function(b){this._userSpatialReference=b;this._set("spatialReference",b)}},{key:"stationary",get:function(){return!this.animation&&!this.navigating&&!this.resizing}},{key:"initialExtent",get:function(){return this.defaultsFromMap&&this.defaultsFromMap.extent}},{key:"cursor",get:function(){const b=this.toolViewManager?this.toolViewManager.cursor:
null;return k.isSome(b)?b:this._cursor||"default"},set:function(b){this._cursor=b;this.notifyChange("cursor")}},{key:"size",get:function(){return[this.width,this.height]}}]);return q}(G.HandleOwnerMixin(F.EventedMixin(I.EsriPromiseMixin(c))));c.views=new m;d.__decorate([v.aliasOf("toolViewManager.activeTool")],c.prototype,"activeTool",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"allLayerViews",void 0);d.__decorate([e.property()],c.prototype,"groundView",void 0);d.__decorate([e.property()],
c.prototype,"animation",void 0);d.__decorate([e.property()],c.prototype,"basemapView",void 0);d.__decorate([e.property()],c.prototype,"defaultsFromMap",void 0);d.__decorate([e.property()],c.prototype,"fatalError",void 0);d.__decorate([e.property({type:w})],c.prototype,"extent",void 0);d.__decorate([e.property(x.graphicsCollectionProperty())],c.prototype,"graphics",void 0);d.__decorate([e.property({readOnly:!0,type:M,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],c.prototype,
"heightModelInfo",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"interacting",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"navigating",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:"fatalError _isValid _readyCycleForced map map.loaded? width height spatialReference _currentSpatialReference initialExtentRequired initialExtent defaultsFromMap.isSpatialReferenceDone defaultsFromMap.isTileInfoDone".split(" ")})],c.prototype,"preconditionsReady",null);d.__decorate([e.property({type:m,
readOnly:!0})],c.prototype,"layerViews",void 0);d.__decorate([e.property({type:y})],c.prototype,"magnifier",void 0);d.__decorate([e.property({value:null,type:B})],c.prototype,"map",null);d.__decorate([e.property()],c.prototype,"padding",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"ready",void 0);d.__decorate([e.property({type:N})],c.prototype,"spatialReference",null);d.__decorate([e.property()],c.prototype,"spatialReferenceWarningDelay",void 0);d.__decorate([e.property()],c.prototype,
"stationary",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"supportsGround",void 0);d.__decorate([e.property({type:C})],c.prototype,"timeExtent",void 0);d.__decorate([v.aliasOf("toolViewManager.tools")],c.prototype,"tools",void 0);d.__decorate([e.property()],c.prototype,"toolViewManager",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"type",void 0);d.__decorate([e.property({type:Number})],c.prototype,"scale",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"updating",
void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"initialExtentRequired",void 0);d.__decorate([e.property({readOnly:!0,type:w})],c.prototype,"initialExtent",null);d.__decorate([e.property()],c.prototype,"cursor",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"input",void 0);d.__decorate([e.property({type:z,nonNullable:!0})],c.prototype,"navigation",void 0);d.__decorate([e.property()],c.prototype,"layerViewManager",void 0);d.__decorate([e.property()],c.prototype,"width",void 0);
d.__decorate([e.property()],c.prototype,"height",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"resizing",void 0);d.__decorate([e.property({value:null,readOnly:!0})],c.prototype,"size",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"suspended",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"viewEvents",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"persistableViewModels",void 0);d.__decorate([e.property()],c.prototype,"_isValid",void 0);d.__decorate([e.property()],
c.prototype,"_readyCycleForced",void 0);d.__decorate([e.property()],c.prototype,"_currentSpatialReference",void 0);return c=n=d.__decorate([L.subclass("esri.views.View")],c)});