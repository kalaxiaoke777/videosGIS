// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/projection":function(){define("require exports ../chunks/_rollupPluginBabelHelpers ../core/Error ../core/mathUtils ../core/maybe ../core/promiseUtils ../core/unitUtils ../chunks/mat4 ../chunks/vec3 ../chunks/vec3f64 ./Extent ./Multipoint ../chunks/pe ./Point ./Polygon ./Polyline ./projectionEllipsoid ./support/aaBoundingRect ./support/Ellipsoid ./support/geodesicConstants ./support/GeographicTransformation ./support/spatialReferenceUtils".split(" "),function(a,p,b,r,
q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C){function A(){return!!ka&&u.isLoaded()}function B(Ha){y.isNone(Ja)&&(Ja=Promise.all([u.load(),(new Promise(function(Ka,Ga){a(["../chunks/geometryEngineBase"],Ka,Ga)})).then(function(Ka){return Ka.geometryEngineBase}),new Promise(function(Ka,Ga){a(["./geometryAdapters/hydrated"],Ka,Ga)})]));return Ja.then(([,Ka,{hydratedAdapter:Ga}])=>{f.throwIfAborted(Ha);sa=Ga;ka=Ka.default;ka._enableProjection(u.pe)})}function D(Ha,Ka,Ga,Oa,za=null){if(y.isNone(Ga)||y.isNone(Oa))return Ka;
if(G(Ga,Oa,za))return Ka.map(Ba=>y.unwrap(M(Ba,Ga,Oa)));if(y.isNone(za)){const Ba=x.cacheKey(Ga,Oa);void 0!==Ta[Ba]?za=Ta[Ba]:(za=E(Ga,Oa,null),y.isNone(za)&&(za=new x),Ta[Ba]=za)}if(y.isNone(ka))throw new da;return ka._project(Ha,Ka,Ga,Oa,za)}function E(Ha,Ka,Ga=null){if(y.isNone(ka))throw new da;if(y.isNone(Ha)||y.isNone(Ka))return null;Ha=ka._getTransformation(sa,Ha,Ka,Ga,null==Ga?void 0:Ga.spatialReference);return null!==Ha?x.fromGE(Ha):null}function G(Ha,Ka,Ga){return Ga?!1:C.equals(Ha,Ka)?!0:
C.isValid(Ha)&&C.isValid(Ka)&&!!ta(Ha,Ka,na)}function K(){K=b._asyncToGenerator(function*(Ha,Ka,Ga,Oa){if(!A())if(Array.isArray(Ha))for(const {source:za,dest:Ba,geographicTransformation:Va}of Ha){if(!G(za,Ba,Va))return B(Oa)}else if(!G(Ha,Ka,Ga))return B(Oa)});return K.apply(this,arguments)}function M(Ha,Ka,Ga){return Ha?"x"in Ha?H(Ha,Ka,new t,Ga,0):"xmin"in Ha?F(Ha,Ka,new d,Ga,0):"rings"in Ha?I(Ha,Ka,new h,Ga,0):"paths"in Ha?O(Ha,Ka,new m,Ga,0):"points"in Ha?J(Ha,Ka,new c,Ga,0):null:null}function H(Ha,
Ka,Ga,Oa,za){db[0]=Ha.x;db[1]=Ha.y;const Ba=Ha.z;db[2]=void 0!==Ba?Ba:za;if(!S(db,Ka,0,db,Oa,0,1))return null;Ga.x=db[0];Ga.y=db[1];Ga.spatialReference=Oa;void 0===Ba?(Ga.z=void 0,Ga.hasZ=!1):(Ga.z=db[2],Ga.hasZ=!0);void 0===Ha.m?(Ga.m=void 0,Ga.hasM=!1):(Ga.m=Ha.m,Ga.hasM=!0);return Ga}function J(Ha,Ka,Ga,Oa,za){const {points:Ba,hasZ:Va,hasM:Ya}=Ha;Ha=[];const $a=Ba.length,bb=[];for(var cb of Ba)bb.push(cb[0],cb[1],Va?cb[2]:za);if(!S(bb,Ka,0,bb,Oa,0,$a))return null;for(Ka=0;Ka<$a;++Ka){za=3*Ka;cb=
bb[za];const kb=bb[za+1];Va&&Ya?Ha.push([cb,kb,bb[za+2],Ba[Ka][3]]):Va?Ha.push([cb,kb,bb[za+2]]):Ya?Ha.push([cb,kb,Ba[Ka][2]]):Ha.push([cb,kb])}Ga.points=Ha;Ga.spatialReference=Oa;Ga.hasZ=Va;Ga.hasM=Ya;return Ga}function O(Ha,Ka,Ga,Oa,za){const {paths:Ba,hasZ:Va,hasM:Ya}=Ha;Ha=[];if(!P(Ba,Va,Ya,Ka,Ha,Oa,za))return null;Ga.paths=Ha;Ga.spatialReference=Oa;Ga.hasZ=Va;Ga.hasM=Ya;return Ga}function I(Ha,Ka,Ga,Oa,za){const {rings:Ba,hasZ:Va,hasM:Ya}=Ha;Ha=[];if(!P(Ba,Va,Ya,Ka,Ha,Oa,za))return null;Ga.rings=
Ha;Ga.spatialReference=Oa;Ga.hasZ=Va;Ga.hasM=Ya;return Ga}function F(Ha,Ka,Ga,Oa,za){const {xmin:Ba,ymin:Va,xmax:Ya,ymax:$a,hasZ:bb,hasM:cb}=Ha;if(!L(Ba,Va,bb?Ha.zmin:za,Ka,db,Oa))return null;Ga.xmin=db[0];Ga.ymin=db[1];bb&&(Ga.zmin=db[2]);if(!L(Ya,$a,bb?Ha.zmax:za,Ka,db,Oa))return null;Ga.xmax=db[0];Ga.ymax=db[1];bb&&(Ga.zmax=db[2]);cb&&(Ga.mmin=Ha.mmin,Ga.mmax=Ha.mmax);Ga.spatialReference=Oa;return Ga}function L(Ha,Ka,Ga,Oa,za,Ba){Wa[0]=Ha;Wa[1]=Ka;Wa[2]=Ga;return S(Wa,Oa,0,za,Ba,0,1)}function N(Ha,
Ka,Ga,Oa){if(y.isNone(Ka)||y.isNone(Oa)||2>Ha.length)return!1;2===Ha.length&&(Wa[0]=Ha[0],Wa[1]=Ha[1],Wa[2]=0,Ha=Wa);return S(Ha,Ka,0,Ga,Oa,0,1)}function R(Ha,Ka,Ga){if(y.isNone(Ka))return!1;Ka=ba(Ka,Pa);Ka=Da[Ka][6];if(y.isNone(Ka))return!1;Ka(Ha,0,Wa,0);Ga!==Wa&&(Ga[0]=Wa[0],Ga[1]=Wa[1],2<Ga.length&&(Ga[2]=Wa[2]));return!0}function S(Ha,Ka,Ga,Oa,za,Ba,Va=1){Ka=ta(Ka,za,na);if(y.isNone(Ka))return!1;if(Ka===Z){if(Ha===Oa&&Ga===Ba)return!0;Va=Ga+3*Va;for(let Ya=Ga,$a=Ba;Ya<Va;Ya++,$a++)Oa[$a]=Ha[Ya];
return!0}Va=Ga+3*Va;for(let Ya=Ga,$a=Ba;Ya<Va;Ya+=3,$a+=3)Ka(Ha,Ya,Oa,$a);return!0}function P(Ha,Ka,Ga,Oa,za,Ba,Va=0){const Ya=[];for(const $a of Ha)for(const bb of $a)Ya.push(bb[0],bb[1],Ka?bb[2]:Va);if(!S(Ya,Oa,0,Ya,Ba,0,Ya.length/3))return!1;Oa=0;za.length=0;for(const $a of Ha){Ha=[];for(const bb of $a)Ka&&Ga?Ha.push([Ya[Oa++],Ya[Oa++],Ya[Oa++],bb[3]]):Ka?Ha.push([Ya[Oa++],Ya[Oa++],Ya[Oa++]]):(Ga?Ha.push([Ya[Oa++],Ya[Oa++],bb[2]]):Ha.push([Ya[Oa++],Ya[Oa++]]),Oa++);za.push(Ha)}return!0}function Q(Ha,
Ka,Ga,Oa){Ha=Math.abs(Ra*Ha)+Math.asin(Ga/(Oa+Ka));return Ha>=Math.PI/2?Number.MAX_VALUE:Ga/Math.cos(Ha)}function V(Ha,Ka,Ga){const Oa=Math.sin(Ha);Ha=Math.cos(Ha);const za=Math.sin(Ka);Ka=Math.cos(Ka);Ga[0]=-Oa;Ga[4]=-za*Ha;Ga[8]=Ka*Ha;Ga[12]=0;Ga[1]=Ha;Ga[5]=-za*Oa;Ga[9]=Ka*Oa;Ga[13]=0;Ga[2]=0;Ga[6]=Ka;Ga[10]=za;Ga[14]=0;Ga[3]=0;Ga[7]=0;Ga[11]=0;Ga[15]=1;return Ga}function ca(Ha,Ka,Ga){V(Ha,Ka,Ga);e.transpose(Ga,Ga);return Ga}function ba(Ha,Ka){if(Ka.spatialReference===Ha)return Ka.spatialReferenceId;
Ka.spatialReference=Ha;"metersPerUnit"in Ka&&(Ka.metersPerUnit=w.getMetersPerUnitForSR(Ha,1));return Ha.wkt===n.SphericalECEFSpatialReference.wkt?Ka.spatialReferenceId=1:C.isWGS84(Ha)?Ka.spatialReferenceId=2:C.isWebMercator(Ha)?Ka.spatialReferenceId=3:C.isPlateCarree(Ha)?Ka.spatialReferenceId=12:Ha.wkt===n.WGS84ECEFSpatialReference.wkt?Ka.spatialReferenceId=4:4490===Ha.wkid?Ka.spatialReferenceId=5:Ha.wkt===n.SphericalPCPFMars.wkt?Ka.spatialReferenceId=7:Ha.wkt===n.SphericalPCPFMoon.wkt?Ka.spatialReferenceId=
9:C.isMars(Ha)?Ka.spatialReferenceId=8:C.isMoon(Ha)?Ka.spatialReferenceId=10:Ka.spatialReferenceId=0}function Z(Ha,Ka,Ga,Oa){Ha!==Ga&&(Ga[Oa++]=Ha[Ka++],Ga[Oa++]=Ha[Ka++],Ga[Oa]=Ha[Ka])}function ha(Ha,Ka,Ga,Oa){Ga[Oa++]=Ua*(Ha[Ka++]/k.earth.radius);Ga[Oa++]=Ua*(Math.PI/2-2*Math.atan(Math.exp(-Ha[Ka++]/k.earth.radius)));Ga[Oa]=Ha[Ka]}function fa(Ha,Ka,Ga,Oa){ha(Ha,Ka,Ga,Oa);la(Ga,Oa,Ga,Oa)}function aa(Ha,Ka,Ga,Oa){ha(Ha,Ka,Ga,Oa);Sa(Ga,Oa,Ga,Oa)}function W(Ha,Ka,Ga,Oa,za){var Ba=.4999999*Math.PI;Ba=
q.clamp(Ra*Ha[Ka+1],-Ba,Ba);Ba=Math.sin(Ba);Ga[Oa++]=Ra*Ha[Ka]*za.radius;Ga[Oa++]=za.halfSemiMajorAxis*Math.log((1+Ba)/(1-Ba));Ga[Oa]=Ha[Ka+2]}function U(Ha,Ka,Ga,Oa){W(Ha,Ka,Ga,Oa,k.earth)}function X(Ha,Ka,Ga,Oa){Ga[Oa]=Ha[Ka]*qa;Ga[Oa+1]=Ha[Ka+1]*qa;Ga[Oa+2]=Ha[Ka+2]}function T(Ha,Ka,Ga,Oa){Ga[Oa]=Ha[Ka]*ra;Ga[Oa+1]=Ha[Ka+1]*ra;Ga[Oa+2]=Ha[Ka+2]}function Y(Ha,Ka,Ga,Oa,za){za+=Ha[Ka+2];const Ba=Ra*Ha[Ka+1];Ha=Ra*Ha[Ka];Ka=Math.cos(Ba);Ga[Oa++]=Math.cos(Ha)*Ka*za;Ga[Oa++]=Math.sin(Ha)*Ka*za;Ga[Oa]=
Math.sin(Ba)*za}function ea(Ha,Ka,Ga,Oa){Y(Ha,Ka,Ga,Oa,k.moon.radius)}function ia(Ha,Ka,Ga,Oa){Y(Ha,Ka,Ga,Oa,k.mars.radius)}function la(Ha,Ka,Ga,Oa){Y(Ha,Ka,Ga,Oa,k.earth.radius)}function pa(Ha,Ka,Ga,Oa,za){var Ba=Ha[Ka];const Va=Ha[Ka+1];Ka=Ha[Ka+2];Ha=Math.sqrt(Ba*Ba+Va*Va+Ka*Ka);Ka=q.asinClamped(Ka/(0===Ha?1:Ha));Ba=Math.atan2(Va,Ba);Ga[Oa++]=Ua*Ba;Ga[Oa++]=Ua*Ka;Ga[Oa]=Ha-za}function ua(Ha,Ka,Ga,Oa){pa(Ha,Ka,Ga,Oa,k.moon.radius)}function wa(Ha,Ka,Ga,Oa){pa(Ha,Ka,Ga,Oa,k.mars.radius)}function Fa(Ha,
Ka,Ga,Oa){pa(Ha,Ka,Ga,Oa,k.earth.radius)}function La(Ha,Ka,Ga,Oa){Fa(Ha,Ka,Ga,Oa);U(Ga,Oa,Ga,Oa)}function Ma(Ha,Ka,Ga,Oa){Fa(Ha,Ka,Ga,Oa);Sa(Ga,Oa,Ga,Oa)}function Sa(Ha,Ka,Ga,Oa){{var za=k.earth;const Va=Ra*Ha[Ka];var Ba=Ra*Ha[Ka+1];Ha=Ha[Ka+2];Ka=Math.sin(Ba);Ba=Math.cos(Ba);const Ya=za.radius/Math.sqrt(1-za.eccentricitySquared*Ka*Ka);Ga[Oa++]=(Ya+Ha)*Ba*Math.cos(Va);Ga[Oa++]=(Ya+Ha)*Ba*Math.sin(Va);Ga[Oa++]=(Ya*(1-za.eccentricitySquared)+Ha)*Ka}}function Ia(Ha,Ka,Ga,Oa){var za=v.earthEllipsoidConstants,
Ba=Ha[Ka],Va=Ha[Ka+1];Ha=Ha[Ka+2];let Ya;Ka=Math.abs(Ha);var $a=Ba*Ba+Va*Va;var bb=Math.sqrt($a);var cb=$a+Ha*Ha;var kb=Math.sqrt(cb);Ba=Math.atan2(Va,Ba);var tb=Ha*Ha/cb;cb=$a/cb;Va=za.a2/kb;$a=za.a3-za.a4/kb;.3<cb?(tb=Ka/kb*(1+cb*(za.a1+Va+tb*$a)/kb),kb=Math.asin(tb),Va=tb*tb,cb=Math.sqrt(1-Va)):(cb=bb/kb*(1-tb*(za.a5-Va-cb*$a)/kb),kb=Math.acos(cb),Va=1-cb*cb,tb=Math.sqrt(Va));Ya=1-k.earth.eccentricitySquared*Va;Va=k.earth.radius/Math.sqrt(Ya);za=za.a6*Va;Va=bb-Va*cb;$a=Ka-za*tb;Ka=cb*Va+tb*$a;
bb=cb*$a-tb*Va;za=bb/(za/Ya+Ka);kb+=za;0>Ha&&(kb=-kb);Ga[Oa++]=Ua*Ba;Ga[Oa++]=Ua*kb;Ga[Oa]=Ka+bb*za/2}function va(Ha,Ka,Ga,Oa){Ia(Ha,Ka,Ga,Oa);la(Ga,Oa,Ga,Oa)}function ma(Ha,Ka,Ga,Oa){Ia(Ha,Ka,Ga,Oa);U(Ga,Oa,Ga,Oa)}function ta(Ha,Ka,Ga=Ca()){return y.isNone(Ha)||y.isNone(Ka)?null:Ea(Ha,Ka,Ga).projector}function Ea(Ha,Ka,Ga){if(y.isNone(Ha)||y.isNone(Ka)||Ga.source.spatialReference===Ha&&Ga.dest.spatialReference===Ka)return Ga;const Oa=ba(Ha,Ga.source),za=ba(Ka,Ga.dest);0===Oa&&0===za?C.equals(Ha,
Ka)?Ga.projector=Z:Ga.projector=null:Ga.projector=Da[Oa][za];return Ga}function Ca(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:Z}}let ka=null,sa=null,Ja=null,Ta={},da=function(Ha){function Ka(){return Ha.call(this,"projection:not-loaded","projection engine not fully loaded yet, please call load()")||this}b._inheritsLoose(Ka,Ha);return Ka}(r);const qa=k.earth.radius*Math.PI/180,ra=180/(k.earth.radius*
Math.PI),Da={[2]:{[5]:null,[8]:null,[10]:null,[11]:Z,[6]:Z,[1]:la,[7]:null,[9]:null,[0]:null,[3]:U,[12]:X,[2]:Z,[4]:Sa},[5]:{[5]:Z,[8]:null,[10]:null,[11]:Z,[6]:Z,[1]:la,[7]:null,[9]:null,[0]:null,[3]:null,[12]:X,[2]:null,[4]:Sa},[8]:{[5]:null,[8]:Z,[10]:null,[11]:Z,[6]:null,[1]:null,[7]:ia,[9]:null,[0]:null,[3]:null,[12]:null,[2]:null,[4]:null},[10]:{[5]:null,[8]:null,[10]:Z,[11]:Z,[6]:null,[1]:null,[7]:null,[9]:ea,[0]:null,[3]:null,[12]:null,[2]:null,[4]:null},[3]:{[5]:null,[8]:null,[10]:null,[11]:ha,
[6]:ha,[1]:fa,[7]:null,[9]:null,[0]:null,[3]:Z,[12]:function(Ha,Ka,Ga,Oa){ha(Ha,Ka,Ga,Oa);X(Ga,Oa,Ga,Oa)},[2]:ha,[4]:aa},[4]:{[5]:Ia,[8]:null,[10]:null,[11]:Ia,[6]:Ia,[1]:va,[7]:null,[9]:null,[0]:null,[3]:ma,[12]:function(Ha,Ka,Ga,Oa){Ia(Ha,Ka,Ga,Oa);X(Ga,Oa,Ga,Oa)},[2]:Ia,[4]:Z},[1]:{[5]:Fa,[8]:null,[10]:null,[11]:Fa,[6]:Fa,[1]:Z,[7]:null,[9]:null,[0]:null,[3]:La,[12]:function(Ha,Ka,Ga,Oa){Fa(Ha,Ka,Ga,Oa);X(Ga,Oa,Ga,Oa)},[2]:Fa,[4]:Ma},[7]:{[5]:null,[8]:wa,[10]:null,[11]:wa,[6]:null,[1]:null,[7]:Z,
[9]:null,[0]:null,[3]:null,[12]:null,[2]:null,[4]:null},[9]:{[5]:null,[8]:null,[10]:ua,[11]:ua,[6]:null,[1]:null,[7]:null,[9]:Z,[0]:null,[3]:null,[12]:null,[2]:null,[4]:null},[0]:{[5]:null,[8]:null,[10]:null,[11]:null,[6]:null,[1]:null,[7]:null,[9]:null,[0]:Z,[3]:null,[12]:null,[2]:null,[4]:null},[11]:{[5]:Z,[8]:Z,[10]:Z,[11]:Z,[6]:Z,[1]:la,[7]:ia,[9]:ea,[0]:null,[3]:U,[12]:X,[2]:Z,[4]:Sa},[6]:{[5]:null,[8]:null,[10]:null,[11]:Z,[6]:Z,[1]:la,[7]:null,[9]:null,[0]:null,[3]:null,[12]:X,[2]:Z,[4]:Sa},
[12]:{[5]:T,[8]:null,[10]:null,[11]:T,[6]:T,[1]:function(Ha,Ka,Ga,Oa){T(Ha,Ka,Ga,Oa);la(Ga,Oa,Ga,Oa)},[7]:null,[9]:null,[0]:null,[3]:function(Ha,Ka,Ga,Oa){T(Ha,Ka,Ga,Oa);U(Ga,Oa,Ga,Oa)},[12]:Z,[2]:T,[4]:function(Ha,Ka,Ga,Oa){T(Ha,Ka,Ga,Oa);Sa(Ga,Oa,Ga,Oa)}}},Pa={spatialReference:null,spatialReferenceId:0},Qa={spatialReference:null,spatialReferenceId:0},na=Ca(),Aa=Ca(),Ra=q.deg2rad(1),Ua=q.rad2deg(1),Wa=g.create(),ab=g.create(),eb=g.create(),db=g.create(),lb=g.create();p.canProjectToWGS84ComparableLonLat=
function(Ha){if(y.isNone(Ha))return!1;Ha=ba(Ha,Pa);return!!Da[Ha][6]};p.canProjectWithoutEngine=G;p.computeENUToSphericalPCPFLocalRotation=V;p.computeSphericalPCPFToENULocalRotation=ca;p.computeTranslationToOriginAndRotation=function(Ha,Ka,Ga,Oa){if(y.isNone(Ha)||y.isNone(Oa))return!1;var za=ba(Ha,Pa),Ba=ba(Oa,Qa);if(za===Ba&&1!==Ba&&7!==Ba&&9!==Ba&&(0!==za||C.equals(Ha,Oa)))return e.identity(Ga),e.translate(Ga,Ga,Ka),!0;if(1===Ba||7===Ba||9===Ba){za=Da[za][11];Ba=Da[11][Ba];if(y.isNone(za)||y.isNone(Ba))return!1;
za(Ka,0,ab,0);Ba(ab,0,eb,0);V(Ra*ab[0],Ra*ab[1],Ga);Ga[12]=eb[0];Ga[13]=eb[1];Ga[14]=eb[2];return!0}if(!(3!==Ba&&12!==Ba||2!==za&&1!==za)){Ha=Da[za][11];Ba=Da[11][Ba];if(y.isNone(Ha)||y.isNone(Ba))return!1;Ha(Ka,0,ab,0);Ba(ab,0,eb,0);2===za?e.identity(Ga):ca(Ra*ab[0],Ra*ab[1],Ga);Ga[12]=eb[0];Ga[13]=eb[1];Ga[14]=eb[2];return!0}return!1};p.getProjectorName=function(Ha,Ka){switch(ta(Ha,Ka,na)){case Z:return"copy3";case la:return"wgs84ToSphericalECEF";case U:return"wgs84ToWebMercator";case X:return"wgs84ToPlateCarree";
case Sa:return"wgs84ToWGS84ECEF";case ha:return"webMercatorToWGS84";case fa:return"webMercatorToSphericalECEF";case aa:return"webMercatorToWGS84ECEF";case Ia:return"wgs84ECEFToWGS84";case va:return"wgs84ECEFToSphericalECEF";case ma:return"wgs84ECEFToWebMercator";case Fa:return"sphericalECEFToWGS84";case La:return"sphericalECEFToWebMercator";case wa:return"sphericalMarsPCPFToMars2000";case ua:return"sphericalMoonPCPFToMoon2000";case Ma:return"sphericalECEFToWGS84ECEF";case ia:return"mars2000ToSphericalPCPF";
case ea:return"moon2000ToSphericalPCPF";default:return null}};p.getTransformation=E;p.getTransformations=function(Ha,Ka,Ga=null){if(y.isNone(ka))throw new da;Ha=ka._getTransformationBySuitability(sa,Ha,Ka,Ga,null==Ga?void 0:Ga.spatialReference);if(null!==Ha){Ka=[];for(const Oa of Ha)Ka.push(x.fromGE(Oa));return Ka}return[]};p.initializeProjection=function(Ha,Ka,Ga,Oa){return K.apply(this,arguments)};p.isLoaded=A;p.isSupported=function(){return!0};p.load=B;p.localLinearScaleFactors=function(Ha,Ka,
Ga,Oa){if(y.isNone(Ka)||y.isNone(Oa))return!1;const za=ba(Ka,Pa);var Ba=ba(Oa,Qa);if(za===Ba&&0!==za||C.equals(Ka,Oa))return Ga[0]=1,Ga[1]=1,Ga[2]=1,!0;if(1===za){Ka=l.length(Ha);Ha=Ka/Math.sqrt(Ha[0]*Ha[0]+Ha[1]*Ha[1]);Ka/=k.earth.radius;if(3===Ba)return Ga[0]=Ha*Ka,Ga[1]=Ha*Ka,Ga[2]=1,!0;if(2===Ba||5===Ba)return Ba=180/(k.earth.radius*Math.PI),Ga[0]=Ba*Ha*Ka,Ga[1]=Ba*Ka,Ga[2]=1,!0}else if(12===za&&(2===Ba||5===Ba))return Ga[0]=ra,Ga[1]=ra,Ga[2]=1,!0;return!1};p.lonLatToSphericalPCPF=function(Ha,
Ka,Ga,Oa,za=0){Oa+=za;za=Math.cos(Ga);Ha[0]=Math.cos(Ka)*za*Oa;Ha[1]=Math.sin(Ka)*za*Oa;Ha[2]=Math.sin(Ga)*Oa};p.lonLatToWebMercatorComparable=W;p.project=function(Ha,Ka,Ga=null){return Array.isArray(Ha)?0===Ha.length?[]:D(sa,Ha,Ha[0].spatialReference,Ka,Ga):D(sa,[Ha],Ha.spatialReference,Ka,Ga)[0]};p.projectBoundingRect=function(Ha,Ka,Ga,Oa){if(null==Ha)return!1;if(C.equals(Ka,Oa))return z.copy(Ga,Ha),!0;Wa[0]=Ha[0];Wa[1]=Ha[1];Wa[2]=0;if(!S(Wa,Ka,0,Wa,Oa,0,1))return!1;Ga[0]=Wa[0];Ga[1]=Wa[1];Wa[0]=
Ha[2];Wa[1]=Ha[3];Wa[2]=0;if(!S(Wa,Ka,0,Wa,Oa,0,1))return!1;Ga[2]=Wa[0];Ga[3]=Wa[1];return!0};p.projectBoundingSphere=function(Ha,Ka,Ga,Oa){if(y.isNone(Ka)||y.isNone(Oa))return!1;Ka=Ea(Ka,Oa,Aa);if(Ka.projector===Z)return Ga[0]=Ha[0],Ga[1]=Ha[1],Ga[2]=Ha[2],Ga[3]=Ha[3],!0;if(y.isNone(Ka.projector))return!1;const {source:za,dest:Ba}=Ka;if(3===Ba.spatialReferenceId){Ka=Da[za.spatialReferenceId][2];if(y.isNone(Ka))return!1;Ka(Ha,0,ab,0);U(ab,0,Ga,0);Ga[3]=Q(ab[1],Ha[2],Ha[3],k.earth.radius);return!0}if(2!==
za.spatialReferenceId&&5!==za.spatialReferenceId||12!==Ba.spatialReferenceId)Ka.projector(Ha,0,Ga,0),Ga[3]=Ha[3]*za.metersPerUnit/Ba.metersPerUnit;else{Oa=Da[1][12];let Va=Ha[3];y.isSome(Da[za.spatialReferenceId][1])&&y.isSome(Oa)&&(Va=Q(Ha[1],Ha[2],Ha[3],k.earth.radius));Ka.projector(Ha,0,Ga,0);Ga[3]=Va}return!0};p.projectBuffer=S;p.projectDirection=function(Ha,Ka,Ga,Oa,za){l.copy(db,Ha);l.add(lb,Ha,Ka);N(db,Ga,db,za);N(lb,Ga,lb,za);l.subtract(Oa,lb,db);l.normalize(Oa,Oa)};p.projectExtent=function(Ha,
Ka,Ga=Ka.spatialReference,Oa=0){return y.isSome(Ga)&&y.isSome(F(Ha,Ha.spatialReference,Ka,Ga,Oa))};p.projectMany=D;p.projectMultipoint=function(Ha,Ka,Ga=Ka.spatialReference,Oa=0){return y.isNone(Ga)?!1:y.isSome(J(Ha,Ha.spatialReference,Ka,Ga,Oa))};p.projectPoint=function(Ha,Ka,Ga=Ka.spatialReference,Oa=0){return y.isNone(Ga)?!1:y.isSome(H(Ha,Ha.spatialReference,Ka,Ga,Oa))};p.projectPointToVector=function(Ha,Ka,Ga,Oa=0){db[0]=Ha.x;db[1]=Ha.y;const za=Ha.z;db[2]=void 0!==za?za:Oa;return S(db,Ha.spatialReference,
0,Ka,Ga,0,1)};p.projectPointToWGS84ComparableLonLat=function(Ha,Ka){db[0]=Ha.x;db[1]=Ha.y;const Ga=Ha.z;db[2]=void 0!==Ga?Ga:0;return R(db,Ha.spatialReference,Ka)};p.projectPolygon=function(Ha,Ka,Ga=Ka.spatialReference,Oa=0){return y.isSome(Ga)&&y.isSome(I(Ha,Ha.spatialReference,Ka,Ga,Oa))};p.projectPolyline=function(Ha,Ka,Ga=Ka.spatialReference,Oa=0){return y.isSome(Ga)&&y.isSome(O(Ha,Ha.spatialReference,Ka,Ga,Oa))};p.projectVectorToDehydratedPoint=function(Ha,Ka,Ga){return S(Ha,Ka,0,db,Ga.spatialReference,
0,1)?(Ga.x=db[0],Ga.y=db[1],Ga.z=db[2],Ga):null};p.projectVectorToPoint=function(Ha,Ka,Ga){if(y.isNone(Ka)||y.isNone(Ga))return null;const Oa=new t({spatialReference:Ga});return S(Ha,Ka,0,db,Ga,0,1)?(Oa.x=db[0],Oa.y=db[1],Oa.z=db[2],Oa):null};p.projectVectorToVector=N;p.projectVectorToWGS84ComparableLonLat=function(Ha,Ka,Ga){return R(Ha,Ka,Ga)};p.projectWithoutEngine=M;p.projectXYZToVector=L;p.sphericalPCPFtoLonLatElevation=pa;p.unload=function(){Ja=sa=ka=null;Ta={}};Object.defineProperty(p,"__esModule",
{value:!0})})},"esri/chunks/pe":function(){define(["require","exports","./_rollupPluginBabelHelpers","../assets","../core/has"],function(a,p,b,r,q){function y(){return!!p._pe}function f(){return!!q("esri-wasm")}function w(){return u?u:u=(new Promise(function(h,m){a(["./pe-wasm"],h,m)})).then(function(h){return h.peWasm}).then(({default:h})=>h({locateFile:m=>r.getAssetUrl(`esri/geometry/support/${m}`)})).then(h=>{e(h)})}function e(h){function m(k,v,x){k[v]=x(k[v])}p._pe=h;p.PeDefs.init();p.PeGTlistExtended.init();
p.PeNotationMgrs.init();p.PeNotationUtm.init();p.PePCSInfo.init();p.PeGCSExtent=function(k){function v(){return k.apply(this,arguments)||this}b._inheritsLoose(v,k);v.prototype.destroy=function(){p._pe.destroy(this)};return v}(p._pe.PeGCSExtent);h=[p._pe.PeDatum,p._pe.PeGeogcs,p._pe.PeGeogtran,p._pe.PeObject,p._pe.PeParameter,p._pe.PePrimem,p._pe.PeProjcs,p._pe.PeSpheroid,p._pe.PeUnit];for(var n of h)m(n.prototype,"getName",k=>function(){return k.call(this,Array(p.PeDefs.PE_NAME_MAX))});for(const k of[p._pe.PeGeogtran,
p._pe.PeProjcs])m(k.prototype,"getParameters",v=>function(){const x=Array(p.PeDefs.PE_PARM_MAX);let C=v.call(this);for(let A=0;A<x.length;A++){const B=p._pe.getValue(C,"*");x[A]=B?p._pe.wrapPointer(B,p._pe.PeParameter):null;C+=Int32Array.BYTES_PER_ELEMENT}return x});m(p._pe.PeHorizon.prototype,"getCoord",k=>function(){const v=this.getSize();if(!v)return null;const x=[],C=k.call(this);c(x,v,C);return x});m(p._pe.PeGTlistExtendedEntry.prototype,"getEntries",k=>{const v=p._pe._pe_getPeGTlistExtendedGTsSize();
return function(){let x=null;var C=k.call(this);if(!p._pe.compare(C,p._pe.NULL)){x=[C];const A=this.getSteps();if(1<A){C=p._pe.getPointer(C);for(let B=1;B<A;B++)x.push(p._pe.wrapPointer(C+v*B,p._pe.PeGTlistExtendedGTs))}}return x}});const z=p._pe._pe_getPeHorizonSize();n=k=>function(){let v=this._cache;v||(this._cache=v=new Map);if(v.has(k))return v.get(k);let x=null;var C=k.call(this);if(!p._pe.compare(C,p._pe.NULL)){x=[C];const A=C.getNump();if(1<A){C=p._pe.getPointer(C);for(let B=1;B<A;B++)x.push(p._pe.wrapPointer(C+
z*B,p._pe.PeHorizon))}}v.set(k,x);return x};m(p._pe.PeProjcs.prototype,"horizonGcsGenerate",n);m(p._pe.PeProjcs.prototype,"horizonPcsGenerate",n);p._pe.PeObject.prototype.toString=function(k=p.PeDefs.PE_STR_OPTS_NONE){p._pe.ensureCache.prepare();const v=p._pe.getPointer(this),x=p._pe.ensureInt8(Array(p.PeDefs.PE_BUFFER_MAX));return p._pe.UTF8ToString(p._pe._pe_object_to_string_ext(v,k,x))}}function l(h){if(h){var m=p._pe.getClass(h);m&&(m=p._pe.getCache(m))&&(h=p._pe.getPointer(h))&&delete m[h]}}
function g(h,m){const n=[];m=Array(m);for(let z=0;z<h;z++)n.push(p._pe.ensureInt8(m));return n}function d(h){let m;Array.isArray(h[0])?(m=[],h.forEach(n=>{m.push(n[0],n[1])})):m=h;return m}function c(h,m,n,z=!1){if(z)for(z=0;z<2*m;z++)h[z]=p._pe.getValue(n+z*Float64Array.BYTES_PER_ELEMENT,"double");else{z=0===h.length;for(let k=0;k<m;k++)z&&(h[k]=Array(2)),h[k][0]=p._pe.getValue(n,"double"),h[k][1]=p._pe.getValue(n+Float64Array.BYTES_PER_ELEMENT,"double"),n+=2*Float64Array.BYTES_PER_ELEMENT}}let u;
p._pe=null;p.PeCSTransformations=void 0;(function(h){function m(k,v,x){p._pe.ensureCache.prepare();var C=d(x);const A=x===C;C=p._pe.ensureFloat64(C);(k=p._pe._pe_geog_to_proj(p._pe.getPointer(k),v,C))&&c(x,v,C,A);return k}function n(k,v,x){return z(k,v,x,0)}function z(k,v,x,C){p._pe.ensureCache.prepare();var A=d(x);const B=x===A;A=p._pe.ensureFloat64(A);(k=p._pe._pe_proj_to_geog_center(p._pe.getPointer(k),v,A,C))&&c(x,v,A,B);return k}h.geogToProj=m;h.projGeog=function(k,v,x,C){switch(C){case p.PeDefs.PE_TRANSFORM_P_TO_G:return n(k,
v,x);case p.PeDefs.PE_TRANSFORM_G_TO_P:return m(k,v,x)}return 0};h.projToGeog=n;h.projToGeogCenter=z})(p.PeCSTransformations||(p.PeCSTransformations={}));p.PeDefs=void 0;(function(h){h.init=function(){h.PE_BUFFER_MAX=p._pe.PeDefs.prototype.PE_BUFFER_MAX;h.PE_NAME_MAX=p._pe.PeDefs.prototype.PE_NAME_MAX;h.PE_MGRS_MAX=p._pe.PeDefs.prototype.PE_MGRS_MAX;h.PE_USNG_MAX=p._pe.PeDefs.prototype.PE_USNG_MAX;h.PE_DD_MAX=p._pe.PeDefs.prototype.PE_DD_MAX;h.PE_DDM_MAX=p._pe.PeDefs.prototype.PE_DDM_MAX;h.PE_DMS_MAX=
p._pe.PeDefs.prototype.PE_DMS_MAX;h.PE_UTM_MAX=p._pe.PeDefs.prototype.PE_UTM_MAX;h.PE_PARM_MAX=p._pe.PeDefs.prototype.PE_PARM_MAX;h.PE_TYPE_NONE=p._pe.PeDefs.prototype.PE_TYPE_NONE;h.PE_TYPE_GEOGCS=p._pe.PeDefs.prototype.PE_TYPE_GEOGCS;h.PE_TYPE_PROJCS=p._pe.PeDefs.prototype.PE_TYPE_PROJCS;h.PE_TYPE_GEOGTRAN=p._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;h.PE_TYPE_COORDSYS=p._pe.PeDefs.prototype.PE_TYPE_COORDSYS;h.PE_TYPE_UNIT=p._pe.PeDefs.prototype.PE_TYPE_UNIT;h.PE_TYPE_LINUNIT=p._pe.PeDefs.prototype.PE_TYPE_LINUNIT;
h.PE_STR_OPTS_NONE=p._pe.PeDefs.prototype.PE_STR_OPTS_NONE;h.PE_STR_AUTH_NONE=p._pe.PeDefs.prototype.PE_STR_AUTH_NONE;h.PE_STR_AUTH_TOP=p._pe.PeDefs.prototype.PE_STR_AUTH_TOP;h.PE_STR_NAME_CANON=p._pe.PeDefs.prototype.PE_STR_NAME_CANON;h.PE_PARM_X0=p._pe.PeDefs.prototype.PE_PARM_X0;h.PE_PARM_ND=p._pe.PeDefs.prototype.PE_PARM_ND;h.PE_TRANSFORM_1_TO_2=p._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;h.PE_TRANSFORM_2_TO_1=p._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;h.PE_TRANSFORM_P_TO_G=p._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;
h.PE_TRANSFORM_G_TO_P=p._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;h.PE_HORIZON_RECT=p._pe.PeDefs.prototype.PE_HORIZON_RECT;h.PE_HORIZON_POLY=p._pe.PeDefs.prototype.PE_HORIZON_POLY;h.PE_HORIZON_LINE=p._pe.PeDefs.prototype.PE_HORIZON_LINE;h.PE_HORIZON_DELTA=p._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(p.PeDefs||(p.PeDefs={}));p.PeFactory=void 0;(function(h){function m(v,x){let C=null,A=n[v];A||(A={},n[v]=A);A.hasOwnProperty(String(x))?C=A[x]:(v=p._pe.PeFactory.prototype.factoryByType(v,x),p._pe.compare(v,
p._pe.NULL)||(C=v,A[x]=C));return C=k(C)}const n={},z={},k=v=>{if(v){const x=v.getType();switch(x){case p.PeDefs.PE_TYPE_GEOGCS:v=p._pe.castObject(v,p._pe.PeGeogcs);break;case p.PeDefs.PE_TYPE_PROJCS:v=p._pe.castObject(v,p._pe.PeProjcs);break;case p.PeDefs.PE_TYPE_GEOGTRAN:v=p._pe.castObject(v,p._pe.PeGeogtran);break;default:x&p.PeDefs.PE_TYPE_UNIT&&(v=p._pe.castObject(v,p._pe.PeUnit))}}return v};h.initialize=function(){p._pe.PeFactory.prototype.initialize(null)};h.coordsys=function(v){return m(p.PeDefs.PE_TYPE_COORDSYS,
v)};h.factoryByType=m;h.fromString=function(v,x){let C=null,A=z[v];A||(A={},z[v]=A);A.hasOwnProperty(x)?C=A[x]:(v=p._pe.PeFactory.prototype.fromString(v,x),p._pe.compare(v,p._pe.NULL)||(C=v,A[x]=C));return C=k(C)};h.geogcs=function(v){return m(p.PeDefs.PE_TYPE_GEOGCS,v)};h.geogtran=function(v){return m(p.PeDefs.PE_TYPE_GEOGTRAN,v)};h.getCode=function(v){return p._pe.PeFactory.prototype.getCode(v)};h.projcs=function(v){return m(p.PeDefs.PE_TYPE_PROJCS,v)};h.unit=function(v){return m(p.PeDefs.PE_TYPE_UNIT,
v)}})(p.PeFactory||(p.PeFactory={}));p.PeGCSExtent=null;p.PeGTlistExtended=void 0;(function(h){let m;h.init=function(){h.PE_GTLIST_OPTS_COMMON=p._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;m=p._pe._pe_getPeGTlistExtendedEntrySize()};h.getGTlist=function(n,z,k,v,x,C){let A=null;const B=new p._pe.PeInteger(C);try{const D=p._pe.PeGTlistExtended.prototype.getGTlist(n,z,k,v,x,B);if(C=B.val)if(A=[D],1<C){const E=p._pe.getPointer(D);for(n=1;n<C;n++)A.push(p._pe.wrapPointer(E+m*n,p._pe.PeGTlistExtendedEntry))}}finally{p._pe.destroy(B)}return A}})(p.PeGTlistExtended||
(p.PeGTlistExtended={}));p.PeGTlistExtendedEntry=void 0;(function(h){h.destroy=function(m){if(m&&m.length){for(const n of m)l(n),n.getEntries().forEach(z=>{l(z);z=z.getGeogtran();l(z);z.getParameters().forEach(l);[z.getGeogcs1(),z.getGeogcs2()].forEach(k=>{l(k);const v=k.getDatum();l(v);l(v.getSpheroid());l(k.getPrimem());l(k.getUnit())})});p._pe.PeGTlistExtendedEntry.prototype.Delete(m[0])}}})(p.PeGTlistExtendedEntry||(p.PeGTlistExtendedEntry={}));p.PeGTTransformations=void 0;(function(h){h.geogToGeog=
function(m,n,z,k,v){p._pe.ensureCache.prepare();var x=d(z);const C=z===x;x=p._pe.ensureFloat64(x);let A=0;k&&(A=p._pe.ensureFloat64(k));(m=p._pe._pe_geog_to_geog(p._pe.getPointer(m),n,x,A,v))&&c(z,n,x,C);return m}})(p.PeGTTransformations||(p.PeGTTransformations={}));p.PeNotationDms=void 0;(function(h){const m=(z,k,v,x,C,A)=>{p._pe.ensureCache.prepare();switch(z){case "dd":var B=p._pe._pe_geog_to_dd;var D=p.PeDefs.PE_DD_MAX;break;case "ddm":B=p._pe._pe_geog_to_ddm;D=p.PeDefs.PE_DDM_MAX;break;case "dms":B=
p._pe._pe_geog_to_dms,D=p.PeDefs.PE_DMS_MAX}z=0;k&&(z=p._pe.getPointer(k));k=d(x);k=p._pe.ensureFloat64(k);D=g(v,D);x=p._pe.ensureInt32(D);if(C=B(z,v,k,C,x))for(B=0;B<v;B++)A[B]=p._pe.UTF8ToString(D[B]);return C},n=(z,k,v,x,C)=>{p._pe.ensureCache.prepare();switch(z){case "dd":var A=p._pe._pe_dd_to_geog;break;case "ddm":A=p._pe._pe_ddm_to_geog;break;case "dms":A=p._pe._pe_dms_to_geog}z=0;k&&(z=p._pe.getPointer(k));k=x.map(B=>p._pe.ensureString(B));x=p._pe.ensureInt32(k);k=p._pe.ensureFloat64(Array(2*
v));(A=A(z,v,x,k))&&c(C,v,k);return A};h.geog_to_dms=function(z,k,v,x,C){return m("dms",z,k,v,x,C)};h.dms_to_geog=function(z,k,v,x){return n("dms",z,k,v,x)};h.geog_to_ddm=function(z,k,v,x,C){return m("ddm",z,k,v,x,C)};h.ddm_to_geog=function(z,k,v,x){return n("ddm",z,k,v,x)};h.geog_to_dd=function(z,k,v,x,C){return m("dd",z,k,v,x,C)};h.dd_to_geog=function(z,k,v,x){return n("dd",z,k,v,x)}})(p.PeNotationDms||(p.PeNotationDms={}));p.PeNotationMgrs=void 0;(function(h){h.init=function(){h.PE_MGRS_STYLE_NEW=
p._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;h.PE_MGRS_STYLE_OLD=p._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;h.PE_MGRS_STYLE_AUTO=p._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;h.PE_MGRS_180_ZONE_1_PLUS=p._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;h.PE_MGRS_ADD_SPACES=p._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};h.geog_to_mgrs_extended=function(m,n,z,k,v,x,C){p._pe.ensureCache.prepare();let A=0;m&&(A=p._pe.getPointer(m));m=d(z);z=p._pe.ensureFloat64(m);m=g(n,p.PeDefs.PE_MGRS_MAX);
const B=p._pe.ensureInt32(m);if(k=p._pe._pe_geog_to_mgrs_extended(A,n,z,k,v,x,B))for(v=0;v<n;v++)C[v]=p._pe.UTF8ToString(m[v]);return k};h.mgrs_to_geog_extended=function(m,n,z,k,v){p._pe.ensureCache.prepare();let x=0;m&&(x=p._pe.getPointer(m));m=z.map(C=>p._pe.ensureString(C));z=p._pe.ensureInt32(m);m=p._pe.ensureFloat64(Array(2*n));(k=p._pe._pe_mgrs_to_geog_extended(x,n,z,k,m))&&c(v,n,m);return k}})(p.PeNotationMgrs||(p.PeNotationMgrs={}));p.PeNotationUsng=void 0;(function(h){h.geog_to_usng=function(m,
n,z,k,v,x,C){p._pe.ensureCache.prepare();let A=0;m&&(A=p._pe.getPointer(m));m=d(z);z=p._pe.ensureFloat64(m);m=g(n,p.PeDefs.PE_MGRS_MAX);const B=p._pe.ensureInt32(m);if(k=p._pe._pe_geog_to_usng(A,n,z,k,v,x,B))for(v=0;v<n;v++)C[v]=p._pe.UTF8ToString(m[v]);return k};h.usng_to_geog=function(m,n,z,k){p._pe.ensureCache.prepare();var v=0;m&&(v=p._pe.getPointer(m));m=z.map(x=>p._pe.ensureString(x));z=p._pe.ensureInt32(m);m=p._pe.ensureFloat64(Array(2*n));(v=p._pe._pe_usng_to_geog(v,n,z,m))&&c(k,n,m);return v}})(p.PeNotationUsng||
(p.PeNotationUsng={}));p.PeNotationUtm=void 0;(function(h){h.init=function(){h.PE_UTM_OPTS_NONE=p._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;h.PE_UTM_OPTS_ADD_SPACES=p._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;h.PE_UTM_OPTS_NS=p._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};h.geog_to_utm=function(m,n,z,k,v){p._pe.ensureCache.prepare();var x=0;m&&(x=p._pe.getPointer(m));m=d(z);z=p._pe.ensureFloat64(m);m=g(n,p.PeDefs.PE_UTM_MAX);const C=p._pe.ensureInt32(m);if(k=p._pe._pe_geog_to_utm(x,n,z,
k,C))for(x=0;x<n;x++)v[x]=p._pe.UTF8ToString(m[x]);return k};h.utm_to_geog=function(m,n,z,k,v){p._pe.ensureCache.prepare();let x=0;m&&(x=p._pe.getPointer(m));m=z.map(C=>p._pe.ensureString(C));z=p._pe.ensureInt32(m);m=p._pe.ensureFloat64(Array(2*n));(k=p._pe._pe_utm_to_geog(x,n,z,k,m))&&c(v,n,m);return k}})(p.PeNotationUtm||(p.PeNotationUtm={}));p.PePCSInfo=void 0;(function(h){const m=new Map;h.init=function(){h.PE_PCSINFO_OPTION_NONE=p._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;h.PE_PCSINFO_OPTION_DOMAIN=
p._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;h.PE_POLE_OUTSIDE_BOUNDARY=p._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;h.PE_POLE_POINT=p._pe.PePCSInfo.prototype.PE_POLE_POINT};h.generate=function(n,z=h.PE_PCSINFO_OPTION_DOMAIN){let k,v;m.has(n)&&(v=m.get(n),v[z]&&(k=v[z]));k||(k=p._pe.PePCSInfo.prototype.generate(n,z),v||(v=[],m.set(n,v)),v[z]=k);return k}})(p.PePCSInfo||(p.PePCSInfo={}));p.PeVersion=void 0;(function(h){h.version_string=function(){return p._pe.PeVersion.prototype.version_string()}})(p.PeVersion||
(p.PeVersion={}));var t=Object.freeze({__proto__:null,get _pe(){return p._pe},isLoaded:y,isSupported:f,load:w,get PeCSTransformations(){return p.PeCSTransformations},get PeDefs(){return p.PeDefs},get PeFactory(){return p.PeFactory},get PeGCSExtent(){return p.PeGCSExtent},get PeGTlistExtended(){return p.PeGTlistExtended},get PeGTlistExtendedEntry(){return p.PeGTlistExtendedEntry},get PeGTTransformations(){return p.PeGTTransformations},get PeNotationDms(){return p.PeNotationDms},get PeNotationMgrs(){return p.PeNotationMgrs},
get PeNotationUsng(){return p.PeNotationUsng},get PeNotationUtm(){return p.PeNotationUtm},get PePCSInfo(){return p.PePCSInfo},get PeVersion(){return p.PeVersion},_init:e});p._init=e;p.isLoaded=y;p.isSupported=f;p.load=w;p.pe=t})},"esri/geometry/support/geodesicConstants":function(){define(["exports","./Ellipsoid"],function(a,p){const b=Math.PI/180;var r=p.earth.radius;const q=p.earth.eccentricitySquared;r={a1:r*q,a2:r*q*r*q,a3:r*q*q/2,a4:r*q*r*q*2.5,a5:r*q+r*q*q/2,a6:1-q};p={4267:{a:6378206.4,f:1/
294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:p.earth.radius,f:p.earth.flattening},104900:{a:2439700,f:0},104901:{a:6051E3,f:0},104902:{a:6051800,f:0},104903:{a:p.moon.radius,f:p.moon.flattening},104904:{a:3393400,f:.005207166853303471},104905:{a:p.mars.radius,f:p.mars.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492E3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1E4,f:0},104912:{a:2409300,f:0},104913:{a:15E3,f:0},104914:{a:4E4,f:0},104915:{a:1562090,
f:0},104916:{a:2632345,f:0},104917:{a:85E3,f:0},104918:{a:1821460,f:0},104919:{a:5E3,f:0},104920:{a:12E3,f:0},104921:{a:3E4,f:3},104922:{a:18E3,f:0},104923:{a:14E3,f:0},104924:{a:49300,f:0},104925:{a:60268E3,f:.09796243445941462},104926:{a:16E3,f:0},104927:{a:9500,f:0},104928:{a:56E4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16E3,f:0},104932:{a:133E3,f:0},104933:{a:718E3,f:0},104934:{a:888E3,f:0},104935:{a:1986300,f:0},104936:{a:1E4,f:0},104937:{a:41900,f:0},104938:{a:11E4,f:0},104939:{a:50100,
f:0},104940:{a:764E3,f:0},104941:{a:11E3,f:0},104942:{a:529800,f:0},104943:{a:2575E3,f:0},104944:{a:25559E3,f:.022927344575296365},104945:{a:578900,f:0},104946:{a:33E3,f:0},104947:{a:21E3,f:0},104948:{a:13E3,f:0},104949:{a:31E3,f:0},104950:{a:27E3,f:0},104951:{a:42E3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15E3,f:0},104955:{a:54E3,f:0},104956:{a:77E3,f:0},104957:{a:27E3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764E3,f:.01708124697141011},104961:{a:74E3,f:0},
104962:{a:79E3,f:0},104963:{a:104E3,f:.14423076923076922},104964:{a:29E3,f:0},104965:{a:17E4,f:0},104966:{a:208E3,f:0},104967:{a:4E4,f:0},104968:{a:1352600,f:0},104969:{a:1195E3,f:0},104970:{a:593E3,f:0},104971:{a:p.mars.radius,f:0},104972:{a:47E4,f:0},104973:{a:255E3,f:0},104974:{a:2439400,f:0}};a.WKT_SPHEROID_REGEX=/SPHEROID\[([^\]]+)]/i;a.earthEllipsoidConstants=r;a.spheroids=p;a.toRadians=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/GeographicTransformation":function(){define(["./GeographicTransformationStep"],
function(a){return function(){function p(r){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(r&&r.steps)for(const q of r.steps)q instanceof a?this.steps.push(q):this.steps.push(new a({wkid:q.wkid,wkt:q.wkt,isInverse:q.isInverse}))}p.cacheKey=function(r,q){return[void 0!==r.wkid&&null!==r.wkid?r.wkid.toString():"-1",void 0!==r.wkt&&null!==r.wkt?r.wkt.toString():"",void 0!==q.wkid&&null!==q.wkid?q.wkid.toString():"-1",void 0!==q.wkt&&null!==q.wkt?q.wkt.toString():""].join()};
p.fromGE=function(r){const q=new p;let y="";for(const f of r.steps)r=a.fromGE(f),q.steps.push(r),y+=r.uid.toString()+",";q._cached_projection={};q._gtlistentry=null;q._chain=y;return q};var b=p.prototype;b.getInverse=function(){const r=new p;r.steps=[];for(let q=this.steps.length-1;0<=q;q--)r.steps.push(this.steps[q].getInverse());return r};b.getGTListEntry=function(){let r="";for(const q of this.steps)r+=q.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=
r);return this._gtlistentry};b.assignCachedGe=function(r,q,y){this._cached_projection[p.cacheKey(r,q)]=y};b.getCachedGeTransformation=function(r,q){let y="";for(const f of this.steps)y+=f.uid.toString()+",";y!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=y);r=this._cached_projection[p.cacheKey(r,q)];return void 0===r?null:r};return p}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["../../chunks/_rollupPluginBabelHelpers"],function(a){let p=
0;return function(){function b(r=null){this.uid=p++;r?(this._wkt=void 0!==r.wkt?r.wkt:null,this._wkid=void 0!==r.wkid?r.wkid:-1,this._isInverse=void 0!==r.isInverse?!0===r.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}b.fromGE=function(r){const q=new b;q._wkt=r.wkt;q._wkid=r.wkid;q._isInverse=r.isInverse;return q};b.prototype.getInverse=function(){const r=new b;r._wkt=this.wkt;r._wkid=this._wkid;r._isInverse=!this.isInverse;return r};a._createClass(b,[{key:"wkt",get:function(){return this._wkt},
set:function(r){this._wkt=r;this.uid=p++}},{key:"wkid",get:function(){return this._wkid},set:function(r){this._wkid=r;this.uid=p++}},{key:"isInverse",get:function(){return this._isInverse},set:function(r){this._isInverse=r;this.uid=p++}}]);return b}()})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){function t(ea=ha){return{plane:g.create(ea.plane),origin:e.clone(ea.origin),basis1:e.clone(ea.basis1),basis2:e.clone(ea.basis2)}}function h(ea,ia,la){const pa=U.get();pa.origin=ea;pa.basis1=ia;pa.basis2=la;pa.plane=g.wrap(0,0,0,0);k(pa);return pa}function m(ea,ia=t()){return z(ea.origin,ea.basis1,ea.basis2,ia)}function n(ea,ia){w.copy(ia.origin,ea.origin);w.copy(ia.basis1,ea.basis1);w.copy(ia.basis2,ea.basis2);g.copy(ea.plane,ia.plane)}function z(ea,ia,la,pa=
t()){w.copy(pa.origin,ea);w.copy(pa.basis1,ia);w.copy(pa.basis2,la);k(pa);1E-6<Math.abs(w.dot(pa.basis1,pa.basis2)/(w.length(pa.basis1)*w.length(pa.basis2)))&&Z.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(w.dot(pa.basis1,P(pa)))&&Z.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-w.dot(P(pa),pa.origin)-pa.plane[3])&&Z.warn("fromValues()","Plane offset is not consistent with plane origin");return pa}function k(ea){g.fromVectorsAndPoint(ea.basis2,
ea.basis1,ea.origin,ea.plane)}function v(ea,ia,la){ea!==la&&m(ea,la);ea=w.scale(u.sv3d.get(),P(ea),ia);w.add(la.origin,la.origin,ea);la.plane[3]-=ia;return la}function x(ea,ia,la){C(ia,la);v(la,F(ea,ea.origin),la);return la}function C(ea,ia=t()){const la=(ea[2]-ea[0])/2,pa=(ea[3]-ea[1])/2;w.set(ia.origin,ea[0]+la,ea[1]+pa,0);w.set(ia.basis1,la,0,0);w.set(ia.basis2,0,pa,0);g.fromValues(0,0,1,0,ia.plane);return ia}function A(ea,ia,la){return g.intersectRay(ea.plane,ia,la)?Q(ea,la):!1}function B(ea,
ia,la){if(A(ea,ia,la))return la;ea=D(ea,ia,u.sv3d.get());w.add(la,ia.origin,w.scale(u.sv3d.get(),ia.direction,w.distance(ia.origin,ea)/w.length(ia.direction)));return la}function D(ea,ia,la){const pa=fa.get();var ua=fa.get();ba(ea,ia,pa,ua);ua=Number.POSITIVE_INFINITY;for(const Fa of X){var wa=ca(ea,Fa,aa.get());const La=u.sv3d.get();g.intersectLineSegment(pa,wa,La)&&(wa=w.direction(u.sv3d.get(),ia.origin,La),wa=Math.abs(r.acosClamped(w.dot(ia.direction,wa))),wa<ua&&(ua=wa,w.copy(la,La)))}return ua===
Number.POSITIVE_INFINITY?E(ea,ia,la):la}function E(ea,ia,la){if(A(ea,ia,la))return la;const pa=fa.get(),ua=fa.get();ba(ea,ia,pa,ua);let wa=Number.POSITIVE_INFINITY;for(const La of X){var Fa=ca(ea,La,aa.get());const Ma=u.sv3d.get();g.intersectLineSegmentClamp(pa,Fa,Ma)&&(Fa=d.distance2(ia,Ma),g.isPointInside(ua,Ma)&&Fa<wa&&(wa=Fa,w.copy(la,Ma)))}M(ea,ia.origin)<wa&&G(ea,ia.origin,la);return la}function G(ea,ia,la){var pa=g.projectPoint(ea.plane,ia,u.sv3d.get());ia=l.projectPointClamp(V(ea,ea.basis1),
pa,-1,1,u.sv3d.get());pa=l.projectPointClamp(V(ea,ea.basis2),pa,-1,1,u.sv3d.get());w.subtract(la,w.add(u.sv3d.get(),ia,pa),ea.origin);return la}function K(ea,ia,la){const {origin:pa,basis1:ua,basis2:wa}=ea,Fa=w.subtract(u.sv3d.get(),ia,pa);ia=c.projectPointSignedLength(ua,Fa);const La=c.projectPointSignedLength(wa,Fa);ea=c.projectPointSignedLength(P(ea),Fa);return w.set(la,ia,La,ea)}function M(ea,ia){ia=K(ea,ia,u.sv3d.get());const {basis1:la,basis2:pa}=ea;ea=w.length(la);var ua=w.length(pa);ea=Math.max(Math.abs(ia[0])-
ea,0);ua=Math.max(Math.abs(ia[1])-ua,0);ia=ia[2];return ea*ea+ua*ua+ia*ia}function H(ea,ia){return Math.sqrt(M(ea,ia))}function J(ea,ia){let la=Number.NEGATIVE_INFINITY;for(const ua of X){var pa=ca(ea,ua,aa.get());pa=l.distance2(pa,ia);pa>la&&(la=pa)}return Math.sqrt(la)}function O(ea,ia){return g.isPointInside(ea.plane,ia)&&Q(ea,ia)}function I(ea,ia,la,pa){switch(la){case 0:w.copy(pa,ea.basis1);w.normalize(pa,pa);break;case 1:w.copy(pa,ea.basis2);w.normalize(pa,pa);break;case 2:w.copy(pa,P(ea))}return pa}
function F(ea,ia){const la=-ea.plane[3];return c.projectPointSignedLength(P(ea),ia)-la}function L(ea,ia,la,pa){const ua=F(ea,ia);ea=w.scale(W,P(ea),la-ua);w.add(pa,ia,ea);return pa}function N(ea,ia){return w.exactEquals(ea.basis1,ia.basis1)&&w.exactEquals(ea.basis2,ia.basis2)&&w.exactEquals(ea.origin,ia.origin)}function R(ea,ia,la){ea!==la&&m(ea,la);y.invert(T,ia);y.transpose(T,T);w.transformMat4(la.basis1,ea.basis1,T);w.transformMat4(la.basis2,ea.basis2,T);w.transformMat4(g.normal(la.plane),g.normal(ea.plane),
T);w.transformMat4(la.origin,ea.origin,ia);g.setOffsetFromPoint(la.plane,la.origin,la.plane);return la}function S(ea,ia,la,pa){ea!==pa&&m(ea,pa);y.rotate(Y,y.identity(Y),ia,la);w.transformMat4(pa.basis1,ea.basis1,Y);w.transformMat4(pa.basis2,ea.basis2,Y);k(pa);return pa}function P(ea){return g.normal(ea.plane)}function Q(ea,ia){const la=w.subtract(u.sv3d.get(),ia,ea.origin);ia=w.squaredLength(ea.basis1);const pa=w.squaredLength(ea.basis2),ua=w.dot(ea.basis1,la);ea=w.dot(ea.basis2,la);return 0>-ua-
ia&&0>ua-ia&&0>-ea-pa&&0>ea-pa}function V(ea,ia){const la=aa.get();w.copy(la.origin,ea.origin);w.copy(la.vector,ia);return la}function ca(ea,ia,la){const {basis1:pa,basis2:ua,origin:wa}=ea;ea=w.scale(u.sv3d.get(),pa,ia.origin[0]);const Fa=w.scale(u.sv3d.get(),ua,ia.origin[1]);w.add(la.origin,ea,Fa);w.add(la.origin,la.origin,wa);ea=w.scale(u.sv3d.get(),pa,ia.direction[0]);ia=w.scale(u.sv3d.get(),ua,ia.direction[1]);w.scale(la.vector,w.add(ea,ea,ia),2);return la}function ba(ea,ia,la,pa){ea=P(ea);g.fromVectorsAndPoint(ea,
ia.direction,ia.origin,la);g.fromVectorsAndPoint(g.normal(la),ea,ia.origin,pa)}const Z=b.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");p=function(){this.plane=g.create();this.origin=e.create();this.basis1=e.create();this.basis2=e.create()};const ha={plane:g.create(),origin:e.fromValues(0,0,0),basis1:e.fromValues(1,0,0),basis2:e.fromValues(0,1,0)},fa=new q.ObjectStack(g.create),aa=new q.ObjectStack(l.create),W=e.create(),U=new q.ObjectStack(()=>({origin:null,basis1:null,basis2:null,
plane:null})),X=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],T=f.create(),Y=f.create();q=Object.freeze({__proto__:null,BoundedPlaneClass:p,create:t,wrap:h,copy:m,copyWithoutVerify:n,fromValues:z,updateUnboundedPlane:k,elevate:v,setExtent:x,fromAABoundingRect:C,intersectRay:A,intersectRayClosestSilhouette:B,closestPointOnSilhouette:D,closestPoint:E,projectPoint:G,projectPointLocal:K,distance2:M,distance:H,distanceToSilhouette:J,
extrusionContainsPoint:O,axisAt:I,altitudeAt:F,setAltitudeAt:L,equals:N,transform:R,rotate:S,normal:P,UP:ha});a.BoundedPlaneClass=p;a.UP=ha;a.altitudeAt=F;a.axisAt=I;a.boundedPlane=q;a.closestPoint=E;a.closestPointOnSilhouette=D;a.copy=m;a.copyWithoutVerify=n;a.create=t;a.distance=H;a.distance2=M;a.distanceToSilhouette=J;a.elevate=v;a.equals=N;a.extrusionContainsPoint=O;a.fromAABoundingRect=C;a.fromValues=z;a.intersectRay=A;a.intersectRayClosestSilhouette=B;a.normal=P;a.projectPoint=G;a.projectPointLocal=
K;a.rotate=S;a.setAltitudeAt=L;a.setExtent=x;a.transform=R;a.updateUnboundedPlane=k;a.wrap=h})},"esri/core/ObjectStack":function(){define(["exports","./maybe","./nextTick"],function(a,p,b){let r=function(){function q(f){this.allocator=f;this.items=[];this.itemsPtr=0;this.tickHandle=b.before(()=>this.reset());this.grow()}var y=q.prototype;y.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=p.nullifyNonnullableForDispose(this.tickHandle));this.items=p.nullifyNonnullableForDispose(this.items)};
y.get=function(){0===this.itemsPtr&&b(()=>{});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};y.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3072),this.items.length);this.itemsPtr=0};y.grow=function(){for(let f=0;f<Math.max(8,Math.min(this.items.length,1024));f++)this.items.push(this.allocator())};return q}();a.ObjectStack=r;a["default"]=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat4f64":function(){define(["exports"],
function(a){function p(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function b(w){return[w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15]]}function r(w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C){return[w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C]}function q(w,e){return new Float64Array(w,e,16)}const y=p();var f=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,createView:q,IDENTITY:y});a.IDENTITY=y;a.clone=b;a.create=p;a.createView=q;a.fromValues=r;a.mat4f64=f})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),
function(a,p,b,r,q,y){function f(t){return t?{origin:q.clone(t.origin),vector:q.clone(t.vector)}:{origin:q.create(),vector:q.create()}}function w(t,h){const m=u.get();m.origin=t;m.vector=h;return m}function e(t,h,m=f()){r.copy(m.origin,t);r.copy(m.vector,h);return m}function l(t,h){h=r.subtract(y.sv3d.get(),h,t.origin);var m=r.dot(t.vector,h);const n=r.dot(t.vector,t.vector);m=p.clamp(m/n,0,1);t=r.subtract(y.sv3d.get(),r.scale(y.sv3d.get(),t.vector,m),h);return r.dot(t,t)}function g(t,h,m,n,z){const {vector:k,
origin:v}=t;h=r.subtract(y.sv3d.get(),h,v);h=r.dot(k,h)/r.squaredLength(k);r.scale(z,k,p.clamp(h,m,n));return r.add(z,z,t.origin)}function d(t,h,m,n){const z=t.origin;var k=r.add(y.sv3d.get(),z,t.vector);t=h.origin;var v=r.add(y.sv3d.get(),t,h.vector),x=y.sv3d.get();h=y.sv3d.get();x[0]=z[0]-t[0];x[1]=z[1]-t[1];x[2]=z[2]-t[2];h[0]=v[0]-t[0];h[1]=v[1]-t[1];h[2]=v[2]-t[2];if(1E-6>Math.abs(h[0])&&1E-6>Math.abs(h[1])&&1E-6>Math.abs(h[2]))return!1;v=y.sv3d.get();v[0]=k[0]-z[0];v[1]=k[1]-z[1];v[2]=k[2]-
z[2];if(1E-6>Math.abs(v[0])&&1E-6>Math.abs(v[1])&&1E-6>Math.abs(v[2]))return!1;k=x[0]*h[0]+x[1]*h[1]+x[2]*h[2];var C=h[0]*v[0]+h[1]*v[1]+h[2]*v[2];const A=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],B=(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])*A-C*C;if(1E-6>Math.abs(B))return!1;x=(k*C-(x[0]*v[0]+x[1]*v[1]+x[2]*v[2])*A)/B;k=(k+C*x)/A;m&&(x=p.clamp(x,0,1),k=p.clamp(k,0,1));m=y.sv3d.get();C=y.sv3d.get();m[0]=z[0]+x*v[0];m[1]=z[1]+x*v[1];m[2]=z[2]+x*v[2];C[0]=t[0]+k*h[0];C[1]=t[1]+k*h[1];C[2]=t[2]+k*h[2];n.tA=x;n.tB=k;n.pA=m;
n.pB=C;n.distance2=r.squaredDistance(m,C);return!0}const c={tA:0,tB:0,pA:q.create(),pB:q.create(),distance2:0},u=new b.ObjectStack(()=>({origin:null,vector:null}));a.closestLineSegmentDistance2=function(t,h){return d(t,h,!0,c)?c.distance2:null};a.closestLineSegmentPoint=function(t,h,m){return d(t,h,!0,c)?(r.copy(m,c.pA),!0):!1};a.closestRayDistance2=function(t,h){if(d(t,w(h.origin,h.direction),!1,c)){const {tA:m,pB:n,distance2:z}=c;if(0<=m&&1>=m)return z;if(0>m)return r.squaredDistance(t.origin,n);
if(1<m)return r.squaredDistance(r.add(y.sv3d.get(),t.origin,t.vector),n)}return null};a.copy=function(t,h=f()){return e(t.origin,t.vector,h)};a.create=f;a.distance=function(t,h){return Math.sqrt(l(t,h))};a.distance2=l;a.fromPoints=function(t,h,m=f()){r.copy(m.origin,t);r.subtract(m.vector,h,t);return m};a.fromValues=e;a.pointAt=function(t,h,m){return r.add(m,t.origin,r.scale(m,t.vector,h))};a.projectPoint=function(t,h,m){return g(t,h,0,1,m)};a.projectPointClamp=g;a.wrap=w;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(a,p){const b=p.VectorStack.createVec2f64(),r=p.VectorStack.createVec3f64(),q=p.VectorStack.createVec4f64(),y=p.VectorStack.createMat3f64(),f=p.VectorStack.createMat4f64();p=p.VectorStack.createQuatf64();a.sm3d=y;a.sm4d=f;a.sq4d=p;a.sv2d=b;a.sv3d=r;a.sv4d=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./maybe ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),
function(a,p,b,r,q,y,f,w,e,l){let g=function(){function d(u,t,h){this.itemByteSize=u;this.itemCreate=t;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(h/this.itemByteSize);this.tickHandle=r.before(()=>this.reset())}var c=d.prototype;c.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=b.nullifyNonnullableForDispose(this.tickHandle));this.itemsPtr=0;this.items=b.nullifyNonnullableForDispose(this.items);this.buffers=b.nullifyNonnullableForDispose(this.buffers)};
c.get=function(){0===this.itemsPtr&&r(()=>{});const u=Math.floor(this.itemsPtr/this.itemsPerBuffer);for(;this.buffers.length<=u;){const t=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize);for(let h=0;h<this.itemsPerBuffer;++h)this.items.push(this.itemCreate(t,h*this.itemByteSize));this.buffers.push(t)}return this.items[this.itemsPtr++]};c.reset=function(){const u=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);for(;this.buffers.length>u;)this.buffers.pop(),this.items.length=this.buffers.length*
this.itemsPerBuffer;this.itemsPtr=0};d.createVec2f64=function(u=4096){return new d(16,w.createView,u)};d.createVec3f64=function(u=4096){return new d(24,e.createView,u)};d.createVec4f64=function(u=4096){return new d(32,l.createView,u)};d.createMat3f64=function(u=4096){return new d(72,q.createView,u)};d.createMat4f64=function(u=4096){return new d(128,y.createView,u)};d.createQuatf64=function(u=4096){return new d(32,f.createView,u)};p._createClass(d,[{key:"test",get:function(){return{size:this.buffers.length*
this.itemsPerBuffer*this.itemByteSize}}}]);return d}();a.VectorStack=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat3f64":function(){define(["exports"],function(a){function p(){return[1,0,0,0,1,0,0,0,1]}function b(f){return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8]]}function r(f,w,e,l,g,d,c,u,t){return[f,w,e,l,g,d,c,u,t]}function q(f,w){return new Float64Array(f,w,9)}var y=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,createView:q});a.clone=b;a.create=p;a.createView=
q;a.fromValues=r;a.mat3f64=y})},"esri/chunks/quatf64":function(){define(["exports"],function(a){function p(){return[0,0,0,1]}function b(w){return[w[0],w[1],w[2],w[3]]}function r(w,e,l,g){return[w,e,l,g]}function q(w,e){return new Float64Array(w,e,4)}const y=p();var f=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,createView:q,IDENTITY:y});a.IDENTITY=y;a.clone=b;a.create=p;a.createView=q;a.fromValues=r;a.quatf64=f})},"esri/chunks/vec2f64":function(){define(["exports"],function(a){function p(){return[0,
0]}function b(h){return[h[0],h[1]]}function r(h,m){return[h,m]}function q(h){const m=[0,0],n=Math.min(2,h.length);for(let z=0;z<n;++z)m[z]=h[z];return m}function y(h,m){return new Float64Array(h,m,2)}function f(){return[0,0]}function w(){return[1,1]}function e(){return[1,0]}function l(){return[0,1]}const g=[0,0],d=[1,1],c=[1,0],u=[0,1];var t=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,fromArray:q,createView:y,zeros:f,ones:w,unitX:e,unitY:l,ZEROS:g,ONES:d,UNIT_X:c,UNIT_Y:u});a.ONES=
d;a.UNIT_X=c;a.UNIT_Y=u;a.ZEROS=g;a.clone=b;a.create=p;a.createView=y;a.fromArray=q;a.fromValues=r;a.ones=w;a.unitX=e;a.unitY=l;a.vec2f64=t;a.zeros=f})},"esri/chunks/vec4f64":function(){define(["exports"],function(a){function p(){return[0,0,0,0]}function b(k){return[k[0],k[1],k[2],k[3]]}function r(k,v,x,C){return[k,v,x,C]}function q(k){const v=p(),x=Math.min(4,k.length);for(let C=0;C<x;++C)v[C]=k[C];return v}function y(k,v){return new Float64Array(k,v,4)}function f(){return p()}function w(){return[1,
1,1,1]}function e(){return[1,0,0,0]}function l(){return[0,1,0,0]}function g(){return[0,0,1,0]}function d(){return[0,0,0,1]}const c=p(),u=w(),t=e(),h=l(),m=g(),n=d();var z=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,fromArray:q,createView:y,zeros:f,ones:w,unitX:e,unitY:l,unitZ:g,unitW:d,ZEROS:c,ONES:u,UNIT_X:t,UNIT_Y:h,UNIT_Z:m,UNIT_W:n});a.ONES=u;a.UNIT_W=n;a.UNIT_X=t;a.UNIT_Y=h;a.UNIT_Z=m;a.ZEROS=c;a.clone=b;a.create=p;a.createView=y;a.fromArray=q;a.fromValues=r;a.ones=w;a.unitW=
d;a.unitX=e;a.unitY=l;a.unitZ=g;a.vec4f64=z;a.zeros=f})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../core/maybe ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/sphere ./vectorStacks".split(" "),function(a,p,b,r,q,y,f){function w(C=x){return[C[0],C[1],C[2],C[3]]}function e(C,A=w()){return l(C[0],C[1],C[2],C[3],A)}function l(C,A,B,D,E=w()){E[0]=C;E[1]=A;E[2]=B;E[3]=D;return E}function g(C,A,B){var D=A[0]*A[0]+A[1]*A[1]+A[2]*A[2];D=1E-5<Math.abs(D-1)&&1E-12<
D?1/Math.sqrt(D):1;B[0]=A[0]*D;B[1]=A[1]*D;B[2]=A[2]*D;B[3]=-(B[0]*C[0]+B[1]*C[1]+B[2]*C[2]);return B}function d(C,A,B,D=w()){var E=B[0]-A[0],G=B[1]-A[1],K=B[2]-A[2];B=C[0]-A[0];const M=C[1]-A[1],H=C[2]-A[2];A=G*H-K*M;K=K*B-E*H;E=E*M-G*B;G=A*A+K*K+E*E;G=1E-5<Math.abs(G-1)&&1E-12<G?1/Math.sqrt(G):1;D[0]=A*G;D[1]=K*G;D[2]=E*G;D[3]=-(D[0]*C[0]+D[1]*C[1]+D[2]*C[2])}function c(C,A,B,D,E){if(3>C.count)return!1;C.getVec(B,m);let G=D,K=!1;for(;G<C.count-1&&!K;)C.getVec(G,n),G++,K=!r.exactEquals(m,n);if(!K)return!1;
G=Math.max(G,E);for(K=!1;G<C.count&&!K;)C.getVec(G,z),G++,r.subtract(k,m,n),r.normalize(k,k),r.subtract(v,n,z),r.normalize(v,v),K=!r.exactEquals(m,z)&&!r.exactEquals(n,z)&&.99619469809>Math.abs(r.dot(k,v));if(!K)return 0===B&&1===D&&2===E?!1:c(C,A,0,1,2);d(m,n,z,A);return!0}function u(C,A,B){C=r.scale(f.sv3d.get(),C,r.dot(C,A));r.subtract(B,A,C);return B}function t(C,A){return r.dot(C,A)+C[3]}function h(C,A,B,D,E){const G=r.dot(C,B);if(0===G)return!1;C=-(r.dot(C,A)+C[3])/G;D&1&&(C=p.clamp(C,0,1));
if(!(D&4)&&0>C||!(D&8)&&1<C)return!1;r.add(E,A,r.scale(E,B,C));return!0}const m=q.create(),n=q.create(),z=q.create(),k=q.create(),v=q.create(),x=[0,0,1,0];a.UP=x;a.clip=function(C,A){const B=r.dot(C,A.ray.direction);C=-t(C,A.ray.origin);if(0>C&&0<=B)return!1;if(-1E-6<B&&1E-6>B)return 0<C;if((0>C||0>B)&&!(0>C&&0>B))return!0;C/=B;0<B?C<A.c1&&(A.c1=C):C>A.c0&&(A.c0=C);return A.c0<=A.c1};a.clipInfinite=function(C,A){const B=r.dot(C,A.ray.direction);C=-t(C,A.ray.origin);if(-1E-6<B&&1E-6>B)return 0<C;C/=
B;0<B?C<A.c1&&(A.c1=C):C>A.c0&&(A.c0=C);return A.c0<=A.c1};a.copy=e;a.create=w;a.distance=function(C,A){return Math.abs(t(C,A))};a.fromManyPoints=function(C,A){return c(C,A,0,1,2)};a.fromManyPointsSampleAt=c;a.fromNormalAndOffset=function(C,A,B){r.copy(B,C);B[3]=A;return B};a.fromPoints=d;a.fromPositionAndNormal=g;a.fromValues=l;a.fromVectorsAndPoint=function(C,A,B,D){r.cross(z,A,C);return g(B,z,D)};a.intersectLine=function(C,A,B,D){B=r.subtract(f.sv3d.get(),B,A);return h(C,A,B,12,D)};a.intersectLineSegment=
function(C,A,B){return h(C,A.origin,A.vector,0,B)};a.intersectLineSegmentClamp=function(C,A,B){return h(C,A.origin,A.vector,1,B)};a.intersectRay=function(C,A,B){return b.isSome(A)?h(C,A.origin,A.direction,8,B):!1};a.isAABBFullyInside=function(C,A){const B=A[0],D=A[1],E=A[2],G=A[3],K=A[4];A=A[5];return 0<=C[0]*(0<C[0]?B:G)+C[1]*(0<C[1]?D:K)+C[2]*(0<C[2]?E:A)+C[3]};a.isPointInside=function(C,A){return 0<=t(C,A)};a.isPointOutside=function(C,A){return 0>t(C,A)};a.isSphereFullyInside=function(C,A){return 0<=
t(C,y.getCenter(A))-A[3]};a.isSphereFullyOutside=function(C,A){return 0>t(C,y.getCenter(A))+A[3]};a.negate=function(C,A){A[0]=-C[0];A[1]=-C[1];A[2]=-C[2];A[3]=-C[3];return A};a.normal=function(C){return C};a.projectPoint=function(C,A,B){const D=r.scale(f.sv3d.get(),C,-C[3]);A=r.subtract(f.sv3d.get(),A,D);C=u(C,A,f.sv3d.get());r.add(B,C,D);return B};a.projectVector=u;a.setOffsetFromPoint=function(C,A,B){C!==B&&e(C,B);B[3]=-r.dot(B,A);return B};a.signedDistance=t;a.wrap=function(C,A,B,D){return l(C,
A,B,D,f.sv4d.get())};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/maybe ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d,c){function u(){return l.create()}function t(P,Q=u()){return e.copy(Q,P)}function h(P,Q){return l.fromValues(P[0],P[1],P[2],Q)}function m(P){return P}function n(P){P[0]=
P[1]=P[2]=P[3]=0}function z(P){return P}function k(P){return Array.isArray(P)?P[3]:P}function v(P){return Array.isArray(P)?P:R}function x(P,Q,V,ca){return l.fromValues(P,Q,V,ca)}function C(P,Q,V){P!==V&&f.copy(V,P);V[3]=P[3]+Q;return V}function A(P,Q,V){L.error("sphere.setExtent is not yet supported");return P===V?V:t(P,V)}function B(P,Q,V){if(q.isNone(Q))return!1;var ca=f.subtract(c.sv3d.get(),Q.origin,v(P)),ba=f.dot(Q.direction,Q.direction);const Z=2*f.dot(Q.direction,ca);P=f.dot(ca,ca)-P[3]*P[3];
P=Z*Z-4*ba*P;if(0>P)return!1;ca=Math.sqrt(P);P=(-Z-ca)/(2*ba);ba=(-Z+ca)/(2*ba);if(0>P||ba<P&&0<ba)P=ba;if(0>P)return!1;V&&f.add(V,Q.origin,f.scale(c.sv3d.get(),Q.direction,P));return!0}function D(P,Q){return B(P,Q,null)}function E(P,Q,V){if(B(P,Q,V))return V;P=G(P,Q,c.sv3d.get());f.add(V,Q.origin,f.scale(c.sv3d.get(),Q.direction,f.distance(Q.origin,P)/f.length(Q.direction)));return V}function G(P,Q,V){const ca=c.sv3d.get(),ba=c.sm4d.get();f.cross(ca,Q.origin,Q.direction);const Z=k(P);f.cross(V,ca,
Q.origin);f.scale(V,V,1/f.length(V)*Z);P=J(P,Q.origin);Q=d.angle(Q.origin,V);y.identity(ba);y.rotate(ba,ba,Q+P,ca);f.transformMat4(V,V,ba);return V}function K(P,Q,V){if(B(P,Q,V))return V;g.closestPoint(Q,v(P),V);return M(P,V,V)}function M(P,Q,V){Q=f.subtract(c.sv3d.get(),Q,v(P));Q=f.scale(c.sv3d.get(),Q,P[3]/f.length(Q));return f.add(V,Q,v(P))}function H(P,Q){Q=f.subtract(c.sv3d.get(),Q,v(P));Q=f.squaredLength(Q);return Math.sqrt(Math.abs(Q-P[3]*P[3]))}function J(P,Q){Q=f.subtract(c.sv3d.get(),Q,
v(P));Q=f.length(Q);P=k(P);return r.acosClamped(P/(P+Math.abs(P-Q)))}function O(P,Q,V,ca){P=f.subtract(N,Q,v(P));switch(V){case 0:return V=r.cartesianToSpherical(P,N)[2],f.set(ca,-Math.sin(V),Math.cos(V),0);case 1:return P=r.cartesianToSpherical(P,N),V=P[1],P=P[2],Q=Math.sin(V),f.set(ca,-Q*Math.cos(P),-Q*Math.sin(P),Math.cos(V));case 2:return f.normalize(ca,P)}}function I(P,Q){Q=f.subtract(S,Q,v(P));return f.length(Q)-P[3]}function F(P,Q,V,ca){const ba=I(P,Q);P=O(P,Q,2,S);V=f.scale(S,P,V-ba);return f.add(ca,
Q,V)}const L=b.getLogger("esri.geometry.support.sphere"),N=w.create(),R=w.create(),S=w.create();p=Object.freeze({__proto__:null,create:u,copy:t,fromCenterAndRadius:h,wrap:m,clear:n,fromRadius:z,getRadius:k,getCenter:v,fromValues:x,elevate:C,setExtent:A,intersectRay:B,intersectsRay:D,intersectRayClosestSilhouette:E,closestPointOnSilhouette:G,closestPoint:K,projectPoint:M,distanceToSilhouette:H,angleToSilhouette:J,axisAt:O,altitudeAt:I,setAltitudeAt:F});a.altitudeAt=I;a.angleToSilhouette=J;a.axisAt=
O;a.clear=n;a.closestPoint=K;a.closestPointOnSilhouette=G;a.copy=t;a.create=u;a.distanceToSilhouette=H;a.elevate=C;a.fromCenterAndRadius=h;a.fromRadius=z;a.fromValues=x;a.getCenter=v;a.getRadius=k;a.intersectRay=B;a.intersectRayClosestSilhouette=E;a.intersectsRay=D;a.projectPoint=M;a.setAltitudeAt=F;a.setExtent=A;a.sphere=p;a.wrap=m})},"esri/geometry/support/ray":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","../../chunks/vec3f64","./vectorStacks"],function(a,p,b,r,q){function y(l){return l?
{origin:r.clone(l.origin),direction:r.clone(l.direction)}:{origin:r.create(),direction:r.create()}}function f(l,g,d=y()){b.copy(d.origin,l);b.copy(d.direction,g);return d}function w(l,g){l=b.cross(q.sv3d.get(),b.normalize(q.sv3d.get(),l.direction),b.subtract(q.sv3d.get(),g,l.origin));return b.dot(l,l)}const e=new p.ObjectStack(function(){return{origin:null,direction:null}});a.closestPoint=function(l,g,d){g=b.dot(l.direction,b.subtract(d,g,l.origin));b.add(d,l.origin,b.scale(d,l.direction,g));return d};
a.copy=function(l,g=y()){return f(l.origin,l.direction,g)};a.create=y;a.distance=function(l,g){return Math.sqrt(w(l,g))};a.distance2=w;a.fromPoints=function(l,g,d=y()){b.copy(d.origin,l);b.subtract(d.direction,g,l);return d};a.fromValues=f;a.wrap=function(l,g){const d=e.get();d.origin=l;d.direction=g;return d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],function(a,
p,b,r){const q=r.create(),y=r.create();a.angle=function(f,w){f=b.dot(f,w)/(b.length(f)*b.length(w));return-p.acosClamped(f)};a.angleAroundAxis=function(f,w,e){b.normalize(q,f);b.normalize(y,w);f=b.dot(q,y);f=p.acosClamped(f);w=b.cross(q,q,y);return 0>b.dot(w,e)?2*Math.PI-f:f};a.projectPoint=function(f,w,e){w=b.dot(f,w)/b.dot(f,f);return b.scale(e,f,w)};a.projectPointSignedLength=function(f,w){return b.dot(f,w)/b.length(f)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/scaleUtils":function(){define(["exports",
"../../core/unitUtils"],function(a,p){function b(r,q){q=p.getMetersPerUnitForSR(q);return r/(q*p.inchesPerMeter*96)}a.getExtentForScale=function(r,q){const y=r.extent;r=r.width;q=b(q,y.spatialReference);return y.clone().expand(q*r/y.width)};a.getResolutionForScale=b;a.getScale=function(r,q){q=q||r.extent;r=r.width;const y=p.getMetersPerUnitForSR(q&&q.spatialReference);return q&&r?q.width/r*y*p.inchesPerMeter*96:0};a.getScaleForResolution=function(r,q){q=p.getMetersPerUnitForSR(q);return r*q*p.inchesPerMeter*
96};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/layerUtils":function(){define(["exports"],function(a){a.areLabelsVisible=function(p){return!0===p.labelsVisible&&null!=p.labelingInfo&&0<p.labelingInfo.length};a.getLayersForScale=function(p,b){const r=[];if(0<p&&b)for(let q=0;q<b.length;q++)if(!(0<=b[q].parentLayerId&&-1===r.indexOf(b[q].parentLayerId)&&b.some(function(y){return y.id===b[q].parentLayerId}))&&0<=b[q].id){let y=!0;const f=b[q].maxScale,w=b[q].minScale;if(0<
f||0<w)0<f&&0<w?y=f<=p&&p<=w:0<f?y=f<=p:0<w&&(y=p<=w);y&&r.push(b[q].id)}return r};a.isBaseLayer=function(p){return p.parent&&"esri.Basemap"===p.parent.declaredClass&&-1<p.parent.baseLayers.indexOf(p)};a.isTiledLayer=function(p){return p&&"base-tile"===p.type||"tile"===p.type||"elevation"===p.type||"imagery-tile"===p.type||"base-elevation"===p.type||"open-street-map"===p.type||"wcs"===p.type||"web-tile"===p.type||"wmts"===p.type||"vector-tile"===p.type};a.serializeLayerDefinitions=function(p){const b=
/[:;]/,r=[];let q=!1;if(p&&(p.forEach(function(y,f){r.push([f,y]);!q&&b.test(y)&&(q=!0)}),0<r.length)){if(q){const y={};r.forEach(f=>{y[f[0]]=f[1]});p=JSON.stringify(y)}else{const y=[];r.forEach(f=>{y.push(f[0]+":"+f[1])});p=y.join(";")}return p}return null};a.serializeTimeOptions=function(p){if(p){var b=[];p.forEach(function(r,q){b.push('"'+q+'":'+JSON.stringify(r))});if(b.length)return"{"+b.join(",")+"}"}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){function d(t,h){return h?c[t].valueToClassName[h].split(" "):[]}const c={widthBreakpoint:{getValue(t){const h=t.viewSize[0];t=t.breakpoints;const m=this.values;return h<=t.xsmall?m.xsmall:h<=t.small?m.small:h<=t.medium?m.medium:h<=t.large?m.large:m.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const h=t.viewSize[1];t=t.breakpoints;const m=this.values;return h<=t.xsmall?m.xsmall:h<=t.small?m.small:h<=t.medium?m.medium:h<=t.large?m.large:m.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){t=t.viewSize;const h=this.values;return t[1]>=t[0]?h.portrait:h.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},u={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
t=>{t=function(h){function m(...z){z=h.call(this,...z)||this;z._breakpointsHandles=new q;z.orientation=null;z.widthBreakpoint=null;z.heightBreakpoint=null;z.breakpoints=u;return z}p._inheritsLoose(m,h);var n=m.prototype;n.initialize=function(){this._breakpointsHandles.add(y.init(this,["breakpoints","size"],this._updateClassNames))};n.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};n._updateClassNames=function(){if(this.container){var z=
r.acquire(),k=r.acquire(),v=!1,x;for(x in c){const C=this[x],A=c[x].getValue({viewSize:this.size,breakpoints:this.breakpoints});C!==A&&(v=!0,this[x]=A,d(x,C).forEach(B=>k.push(B)),d(x,A).forEach(B=>z.push(B)))}v&&(this._applyClassNameChanges(z,k),r.release(z),r.release(k))}};n._applyClassNameChanges=function(z,k){const v=this.container;v&&(k.forEach(x=>v.classList.remove(x)),z.forEach(x=>v.classList.add(x)))};n._removeActiveClassNames=function(){const z=this.container;if(z)for(var k in c)d(k,this[k]).forEach(v=>
z.classList.remove(v))};p._createClass(m,[{key:"breakpoints",set:function(z){var k=this._get("breakpoints");if(z!==k){k=(k=z)&&k.xsmall<k.small&&k.small<k.medium&&k.medium<k.large;if(!k){const v=JSON.stringify(u,null,2);console.warn("provided breakpoints are not valid, using defaults:"+v)}z=k?z:u;this._set("breakpoints",{...z})}}}]);return m}(t);b.__decorate([f.property()],t.prototype,"breakpoints",null);b.__decorate([f.property()],t.prototype,"orientation",void 0);b.__decorate([f.property()],t.prototype,
"widthBreakpoint",void 0);b.__decorate([f.property()],t.prototype,"heightBreakpoint",void 0);return t=b.__decorate([g.subclass("esri.views.BreakpointsOwner")],t)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/DOMContainer":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/domUtils ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){function u(h){h&&(r.empty(h),h.parentNode&&h.parentNode.removeChild(h))}const t=[0,0];a.DOMContainer=h=>{h=function(m){function n(...k){var v=m.call(this,...k)||this;v._freqInfo={freq:16,time:750};v._overlayRenderTaskHandle=null;v.height=0;v.position=null;v.resizing=!1;v.root=null;v.surface=null;v.suspended=!0;v.ui=null;v.userContent=null;v.width=0;v.widthBreakpoint=null;v.handles.add([v.watch("cursor",x=>{const C=v.surface;C&&C.setAttribute("data-cursor",x)}),
v.watch("interacting",x=>{const C=v.surface;C&&C.setAttribute("data-interacting",x.toString())})]);return v}p._inheritsLoose(n,m);var z=n.prototype;z.initialize=function(){this.handles.add(this.watch("ui",(k,v)=>this._handleUIChange(k,v)));this._wireUI(this.ui);this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])};z.destroy=function(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),
this.container=null)};z.blur=function(){this.surface&&this.surface.blur()};z.focus=function(){this.surface&&this.surface.focus()};z.pageToContainer=function(k,v,x){const C=this.position;k-=C[0];v-=C[1];x?(x[0]=k,x[1]=v):x=[k,v];return x};z.containerToPage=function(k,v,x){const C=this.position;k+=C[0];v+=C[1];x?(x[0]=k,x[1]=v):x=[k,v];return x};z._handleUIChange=function(k,v){v&&(this.handles.remove("ui"),v.destroy());k&&this._wireUI(k);this._set("ui",k)};z._wireUI=function(k){this.handles.remove("ui");
k&&(k.view=this,this.handles.add([y.init(this,"root",v=>{if(v){{const x=document.createElement("div");v.appendChild(x);v=x}}else v=null;k.container=v}),y.init(this,"popup",(v,x)=>{x&&k.remove(x,"popup");v&&(v.view=k.view,k.add(v,{key:"popup",position:"manual"}))})],"ui"))};z._stopMeasuring=function(){this.handles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};z._startMeasuring=function(){const k=this._freqInfo;k.freq=16;k.time=750;this.handles.add([(()=>{const v=()=>{k.freq=
16;k.time=750};window.addEventListener("resize",v);return{remove(){window.removeEventListener("resize",v)}}})(),q.addFrameTask({prepare:v=>{const x=this._measure(),C=this._freqInfo;C.time+=v.deltaTime;x&&(C.freq=16,this._get("resizing")||this._set("resizing",!0));C.time<C.freq||(C.time=0,this._position()||x?C.freq=16:C.freq=Math.min(750,2*C.freq),!x&&512<=C.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()};z._measure=function(){var k=this.container;
const v=k?k.clientWidth:0;k=k?k.clientHeight:0;if(0===v||0===k)return this.suspended||this._set("suspended",!0),!1;const x=this.width,C=this.height;if(v===x&&k===C)return this.suspended&&this._set("suspended",!1),!1;this._set("width",v);this._set("height",k);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:x,oldHeight:C,width:v,height:k});return!0};z._position=function(){var k=this.container;const v=this.position;{const x=(k.ownerDocument||window.document).defaultView;k=k.getBoundingClientRect();
t[0]=k.left+x.pageXOffset;t[1]=k.top+x.pageYOffset}return v&&t[0]===v[0]&&t[1]===v[1]?!1:(this._set("position",[t[0],t[1]]),!0)};z.forceDOMReadyCycle=function(){};p._createClass(n,[{key:"container",set:function(k){var v=this._get("container");if(v!==k)if(this.handles.remove("dom-size"),this._stopMeasuring(),v&&(v.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),
u(this.root),this._set("root",null),r.reparent(this.userContent,v),u(this.userContent),this._set("userContent",null)),k){k.classList.add("esri-view");v=document.createElement("div");v.className="esri-view-user-storage";r.reparent(k,v);k.appendChild(v);this._set("userContent",v);v=document.createElement("div");v.className="esri-view-root";k.insertBefore(v,k.firstChild);this._set("root",v);const x=document.createElement("div");x.className="esri-view-surface";x.setAttribute("role","application");x.tabIndex=
0;v.appendChild(x);this._set("surface",x);const C=new d;v.appendChild(C.surface);this._set("overlay",C);C.watch("needsRender",A=>{A&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=q.addFrameTask({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)});this.forceDOMReadyCycle();this.handles.add(y.init(this,"size",A=>{const [B,D]=A;B>=document.body.clientWidth||D>=document.body.clientHeight?x.classList.add("esri-view-surface--inset-outline"):
x.classList.remove("esri-view-surface--inset-outline")}),"dom-size");this._set("container",k);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},{key:"focused",get:function(){const k=document.activeElement===this.surface;return document.hasFocus()&&k}},{key:"popup",get:function(){return this._get("popup")||new c({view:this})},set:function(k){const v=this._get("popup");v&&
v!==k&&v.destroy();this._set("popup",k)}},{key:"size",get:function(){return[this.width,this.height]}}]);return n}(h);b.__decorate([f.property({value:null,cast:m=>r.byId(m)})],h.prototype,"container",null);b.__decorate([f.property({readOnly:!0})],h.prototype,"focused",null);b.__decorate([f.property({readOnly:!0})],h.prototype,"height",void 0);b.__decorate([f.property({type:c})],h.prototype,"popup",null);b.__decorate([f.property({type:d})],h.prototype,"overlay",void 0);b.__decorate([f.property({readOnly:!0})],
h.prototype,"position",void 0);b.__decorate([f.property({readOnly:!0})],h.prototype,"resizing",void 0);b.__decorate([f.property({readOnly:!0})],h.prototype,"root",void 0);b.__decorate([f.property({value:null,readOnly:!0})],h.prototype,"size",null);b.__decorate([f.property({readOnly:!0})],h.prototype,"surface",void 0);b.__decorate([f.property({readOnly:!0})],h.prototype,"suspended",void 0);b.__decorate([f.property()],h.prototype,"ui",void 0);b.__decorate([f.property({readOnly:!0})],h.prototype,"userContent",
void 0);b.__decorate([f.property({readOnly:!0})],h.prototype,"width",void 0);b.__decorate([f.property()],h.prototype,"widthBreakpoint",void 0);return h=b.__decorate([g.subclass("esri.views.DOMContainer")],h)};a.isDOMContainer=function(h){return h&&"focus"in h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../libs/maquette/projection ../../libs/maquette/projector ../support/WatchUpdatingTracking".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){b=function(c){function u(){var h=c.apply(this,arguments)||this;h.items=new r;h._watchUpdatingTracking=new d.WatchUpdatingTracking;h._callbacks=new Map;h._projector=g.createProjector();h._hiddenProjector=g.createProjector();return h}a._inheritsLoose(u,c);var t=u.prototype;t.initialize=function(){const h=document.createElement("div");h.className="esri-overlay-surface";this._set("surface",h);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style",
"visibility: hidden;");h.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(this.items,m=>{m.added.map(n=>{const z=()=>n.render();this._callbacks.set(n,z);this._projector.append(this.surface,z)});m.removed.map(n=>{const z=this._projector.detach(this._callbacks.get(n));this.surface.removeChild(z.domNode);this._callbacks.delete(n)})})};t.addItem=function(h){this.items.add(h)};t.removeItem=function(h){this.items.remove(h)};t.destroy=function(){this.items.removeAll();this._callbacks.forEach(h=>
this._projector.detach(h));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};t.render=function(){this._projector.renderNow()};t.computeBoundingRect=function(h){const m=this._hiddenSurface,n=this._hiddenProjector;let z=null;const k=()=>z=h.render();n.append(m,k);n.renderNow();const v={left:0,top:0,right:0,bottom:0};if(z&&z.domNode){const x=z.domNode.getBoundingClientRect();v.left=x.left;v.top=x.top;v.right=x.right;v.bottom=x.bottom}for(n.detach(k);m.firstChild;)m.removeChild(m.firstChild);
return v};t.overlaps=function(h,m){h=this.computeBoundingRect(h);m=this.computeBoundingRect(m);return Math.max(h.left,m.left)<=Math.min(h.right,m.right)&&Math.max(h.top,m.top)<=Math.min(h.bottom,m.bottom)};t.renderCanvas=function(h){if(this.items.some(n=>n.visible)){var m=h.getContext("2d");m.save();m.font=`10px ${getComputedStyle(this.surface).fontFamily}`;this.items.forEach(n=>{m.save();n.renderCanvas(m);m.restore()});m.restore()}};a._createClass(u,[{key:"needsRender",get:function(){return 0<this.items.length}},
{key:"hasVisibleItems",get:function(){return this.items.some(h=>h.visible)}}]);return u}(b);p.__decorate([q.property({readOnly:!0})],b.prototype,"surface",void 0);p.__decorate([q.property({readOnly:!0})],b.prototype,"items",void 0);p.__decorate([q.property({readOnly:!0})],b.prototype,"needsRender",null);p.__decorate([q.property({readOnly:!0})],b.prototype,"_watchUpdatingTracking",void 0);p.__decorate([q.property({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],b.prototype,"updating",void 0);
return b=p.__decorate([e.subclass("esri.views.overlay.ViewOverlay")],b)})},"esri/widgets/Popup":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/Collection ../core/events ../core/Handles ../core/Logger ../core/maybe ../core/throttle ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Feature ./Spinner ./Widget ./Feature/support/FeatureContentMixin ./Popup/PopupViewModel ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ./support/widgetUtils ../intl/substitute".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E){function G(J,O){return void 0===O?`${"esri-popup"}__${J}`:`${"esri-popup"}__${J}-${O}`}const K={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},M=f.getLogger("esri.widgets.Popup"),H={closeButton:!0,featureNavigation:!0};b=function(J){function O(F,L){var N=J.call(this,F,L)||this;N._blurClose=!1;N._blurContainer=!1;N._containerNode=null;N._mainContainerNode=null;N._featureMenuNode=null;N._actionsMenuNode=null;N._focusClose=!1;
N._focusContainer=!1;N._focusDockButton=!1;N._focusFeatureMenuButton=!1;N._focusActionsMenuButton=!1;N._focusFirstFeature=!1;N._focusFirstAction=!1;N._handles=new y;N._pointerOffsetInPx=16;N._spinner=null;N._feature=null;N._featureMenuIntersectionObserverCallback=([R])=>{null!=R&&R.isIntersecting&&N.viewModel.featurePage++};N._featureMenuIntersectionObserver=new IntersectionObserver(N._featureMenuIntersectionObserverCallback);N._displaySpinnerThrottled=e.throttle(()=>N._displaySpinner(),0);N.actions=
null;N.alignment="auto";N.autoCloseEnabled=null;N.autoOpenEnabled=null;N.defaultPopupTemplateEnabled=null;N.content=null;N.collapsed=!1;N.collapseEnabled=!0;N.dockEnabled=!1;N.featureCount=null;N.featureMenuOpen=!1;N.features=null;N.goToOverride=null;N.headingLevel=2;N.highlightEnabled=null;N.location=null;N.label=void 0;N.maxInlineActions=3;N.messages=null;N.messagesCommon=null;N.promises=null;N.selectedFeature=null;N.selectedFeatureIndex=null;N.spinnerEnabled=!0;N.title=null;N.updateLocationEnabled=
null;N.view=null;N.viewModel=new k;N.visible=null;N.visibleElements={...H};N._addSelectedFeatureIndexHandle();N.own([l.watch(a._assertThisInitialized(N),"viewModel.screenLocation",()=>N._positionContainer()),l.watch(a._assertThisInitialized(N),["viewModel.active","dockEnabled"],()=>N._toggleScreenLocationEnabled()),l.watch(a._assertThisInitialized(N),"viewModel.screenLocation",(R,S)=>{!!R!==!!S&&N.reposition()}),l.watch(a._assertThisInitialized(N),["viewModel.view.padding","viewModel.view.size","viewModel.active",
"viewModel.location","alignment"],()=>N.reposition()),l.watch(a._assertThisInitialized(N),"spinnerEnabled",R=>N._spinnerEnabledChange(R)),l.watch(a._assertThisInitialized(N),"viewModel.view.size",(R,S)=>N._updateDockEnabledForViewSize(R,S)),l.watch(a._assertThisInitialized(N),"viewModel.view",(R,S)=>N._viewChange(R,S)),l.watch(a._assertThisInitialized(N),"viewModel.view.ready",(R,S)=>N._viewReadyChange(R,S)),l.watch(a._assertThisInitialized(N),["viewModel.waitingForResult","viewModel.location"],()=>
{N._hideSpinner();N._displaySpinnerThrottled()}),l.watch(a._assertThisInitialized(N),["selectedFeatureWidget.viewModel.title","selectedFeatureWidget.viewModel.state"],()=>N._setTitleFromFeatureWidget()),l.watch(a._assertThisInitialized(N),["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.state"],()=>N._setContentFromFeatureWidget()),l.whenFalse(a._assertThisInitialized(N),"collapsed",()=>{var R,S;"xsmall"===(null==(R=N.viewModel)?void 0:null==(S=R.view)?void 0:S.widthBreakpoint)&&
N.viewModel.active&&N.collapseEnabled&&N.viewModel.centerAtLocation()}),l.on(a._assertThisInitialized(N),"viewModel.allActions","change",()=>N._watchActions()),l.init(a._assertThisInitialized(N),"viewModel.allActions",()=>N._watchActions()),l.watch(a._assertThisInitialized(N),"viewModel.featureViewModels",()=>N._featureMenuViewportScrollTop())]);return N}a._inheritsLoose(O,J);var I=O.prototype;I.destroy=function(){var F,L;this._destroySelectedFeatureWidget();this._destroySpinner();null==(F=this._handles)?
void 0:F.destroy();this._unobserveFeatureMenuObserver();null==(L=this._featureMenuIntersectionObserver)?void 0:L.disconnect();this._handles=null};I.castVisibleElements=function(F){return{...H,...F}};I.blur=function(){const {active:F}=this.viewModel;F||M.warn("Popup can only be blurred when currently active.");this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0;this.scheduleRender()};I.clear=function(){this.viewModel.clear()};I.close=function(){this.visible=!1};I.fetchFeatures=
function(F,L){return this.viewModel.fetchFeatures(F,L)};I.focus=function(){const {active:F}=this.viewModel;F||M.warn("Popup can only be focused when currently active.");this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0;this.scheduleRender()};I.next=function(){return this.viewModel.next()};I.open=function(F){var L,N;this._handles.remove("selected-index");const R={collapsed:F?!!F.collapsed:!1,actionsMenuOpen:F?!!F.actionsMenuOpen:!1,featureMenuOpen:F?!!F.featureMenuOpen:!1};
"xsmall"===(null==(L=this.viewModel)?void 0:null==(N=L.view)?void 0:N.widthBreakpoint)&&(R.collapsed=!0);this.set(R);this.viewModel.open(F);this._addSelectedFeatureIndexHandle()};I.previous=function(){return this.viewModel.previous()};I.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};I.triggerAction=function(F){this.viewModel.triggerAction(F)};I.render=function(){var F,L,N,R;const {actionsMenuOpen:S,dockEnabled:P,featureMenuVisible:Q,dividedActions:V,
currentAlignment:ca,currentDockPosition:ba}=this,{active:Z}=this.viewModel;var {menuActions:ha}=V;ha=Z&&1<ha.length&&S;const fa=null==(F=this.selectedFeature)?void 0:null==(L=F.layer)?void 0:L.title;F=null==(N=this.selectedFeature)?void 0:null==(R=N.layer)?void 0:R.id;return B.tsx("div",{class:this.classes("esri-popup",{["esri-popup--aligned-top-center"]:"top-center"===ca,["esri-popup--aligned-bottom-center"]:"bottom-center"===ca,["esri-popup--aligned-top-left"]:"top-left"===ca,["esri-popup--aligned-bottom-left"]:"bottom-left"===
ca,["esri-popup--aligned-top-right"]:"top-right"===ca,["esri-popup--aligned-bottom-right"]:"bottom-right"===ca,["esri-popup--is-docked"]:Z&&P,["esri-popup--shadow"]:Z&&!P,["esri-popup--is-docked-top-left"]:"top-left"===ba,["esri-popup--is-docked-top-center"]:"top-center"===ba,["esri-popup--is-docked-top-right"]:"top-right"===ba,["esri-popup--is-docked-bottom-left"]:"bottom-left"===ba,["esri-popup--is-docked-bottom-center"]:"bottom-center"===ba,["esri-popup--is-docked-bottom-right"]:"bottom-right"===
ba,["esri-popup--feature-menu-open"]:Q,["esri-popup--actions-menu-open"]:ha}),role:"presentation","data-layer-title":fa,"data-layer-id":F,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},Z?[this.renderMainContainer(),this.renderPointer()]:null)};I.renderLoadingIcon=function(){return B.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})};I.renderNavigationLoading=function(){const {messagesCommon:F}=
this;return this.viewModel.pendingPromisesCount?B.tsx("div",{key:G("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":F.loading,title:F.loading},this.renderLoadingIcon()):null};I.renderPreviousIcon=function(){const F=D.isRTL(this.container);return B.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-right-triangle-arrow"]:F,["esri-popup__pagination-previous-icon--rtl"]:F,["esri-icon-left-triangle-arrow"]:!F,["esri-popup__pagination-previous-icon"]:!F})})};
I.renderPreviousButton=function(){const {messages:F}=this;return B.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":F.previous,title:F.previous},this.renderPreviousIcon())};I.renderNextIcon=function(){const F=D.isRTL(this.container);return B.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-left-triangle-arrow"]:F,["esri-popup__pagination-next-icon--rtl"]:F,
["esri-icon-right-triangle-arrow"]:!F,["esri-popup__pagination-next-icon"]:!F})})};I.renderNextButton=function(){const {messages:F}=this;return B.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":F.next,title:F.next},this.renderNextIcon())};I.renderFeatureMenuButton=function(){const {featureMenuOpen:F,featureMenuId:L,messagesCommon:N}=this,{featureCount:R,selectedFeatureIndex:S}=
this.viewModel;return B.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":L,"aria-expanded":F.toString(),"aria-label":N.menu,title:N.menu},this._getPageText(R,S))};I.renderNavigationButtons=function(){return this.featureNavigationVisible?
[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null};I.renderDockIcon=function(){const {dockEnabled:F}=this,L=this._wouldDockTo();return B.tsx("span",{"aria-hidden":"true",class:this.classes({["esri-icon-minimize"]:F,["esri-popup__icon--dock-icon"]:!F,["esri-icon-dock-right"]:!F&&("top-right"===L||"bottom-right"===L),["esri-icon-dock-left"]:!F&&("top-left"===L||"bottom-left"===L),["esri-icon-maximize"]:!F&&"top-center"===L,["esri-icon-dock-bottom"]:!F&&
"bottom-center"===L},"esri-popup__icon")})};I.renderDockButton=function(){var F,L,N;const {dockEnabled:R,messages:S}=this,P=null==(F=this.viewModel)?void 0:null==(L=F.view)?void 0:L.widthBreakpoint;F=R?S.undock:S.dock;return"xsmall"!==P&&null!=(N=this.dockOptions)&&N.buttonEnabled?B.tsx("div",{role:"button","aria-label":F,title:F,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button",
"esri-popup__button--dock")},this.renderDockIcon()):null};I.renderTitle=function(){const {title:F}=this.viewModel,{titleId:L,collapsible:N,contentCollapsed:R,messagesCommon:S}=this;var P={["esri-popup__header-container--button"]:N};const Q=B.tsx(v.Heading,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:F});P=N?B.tsx("button",{key:`${F}--collapsible`,id:L,title:R?S.expand:S.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",
P),"aria-expanded":R?"false":"true",onclick:this._toggleCollapsed},Q):B.tsx("div",{key:F,id:L,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",P)},Q);return F?P:null};I.renderCloseIcon=function(){return B.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")})};I.renderCloseButton=function(){const {visibleElements:F,messagesCommon:L}=this;return F.closeButton?B.tsx("div",{role:"button",tabIndex:0,bind:this,
onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":L.close,title:L.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null};I.renderHeader=function(){return B.tsx("header",{class:"esri-popup__header"},this.renderTitle(),B.tsx("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))};I.renderContentContainer=function(){const {contentId:F,hasContent:L,contentCollapsed:N}=
this,{content:R}=this.viewModel;return L&&!N?B.tsx("article",{key:R,enterAnimation:this._createFeatureUpdatedAnimation(),id:F,class:"esri-popup__content"},this.renderContent()):null};I.renderActionsMenuButton=function(){const {actionsMenuId:F,actionsMenuButtonId:L,actionsMenuOpen:N,dividedActions:R,messagesCommon:S}=this,P=N?S.close:S.open,{menuActions:Q}=R;return Q.length?B.tsx("div",{key:G("actions-menu-button"),class:this.classes("esri-popup__button","esri-popup__actions-menu-button"),role:"button",
id:L,"aria-haspopup":"true","aria-controls":N?F:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":P,title:P},B.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null};I.renderMenuActions=function(){const {actionsMenuId:F,actionsMenuButtonId:L,actionsMenuOpen:N,dividedActions:R}=this,{menuActions:S,inlineActions:P}=R;return S.length&&
N?B.tsx("ul",{id:F,role:"menu","aria-labelledby":L,key:G("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},S.toArray().map((Q,V)=>this.renderAction({action:Q,index:V+P.length,type:"menu-item"}))):null};I.renderInlineActions=function(){const {inlineActions:F}=this.dividedActions;return!!F.length&&F.toArray().map((L,N)=>this.renderAction({action:L,index:N,type:"inline"}))};I.renderInlineActionsContainer=
function(){const {inlineActions:F,menuActions:L}=this.dividedActions,N=!!F.length,R=!!L.length;return N||R?B.tsx("div",{key:"inline-actions-container","data-inline-actions":N.toString(),"data-menu-actions":R.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null};I.renderNavigation=function(){return this.featureNavigationVisible?B.tsx("section",{key:G("navigation"),class:this.classes("esri-popup__navigation")},
this.renderNavigationButtons()):null};I.renderFooter=function(){const {featureNavigationVisible:F,dividedActions:L}=this,{inlineActions:N,menuActions:R}=L,S=!!N.length,P={["esri-popup__footer--has-pagination"]:F,["esri-popup__footer--has-actions"]:S,["esri-popup__footer--has-actions-menu"]:!!R.length};return F||S?B.tsx("div",{key:G("feature-buttons"),class:this.classes("esri-popup__footer",P)},this.renderInlineActionsContainer(),this.renderNavigation()):null};I.renderFeatureMenuContainer=function(){var {messages:F}=
this;const {featureViewModels:L,isLoadingFeature:N}=this.viewModel;F=E.substitute(F.selectedFeatures,{total:L.length});return B.tsx("section",{key:G("menu"),class:"esri-popup__feature-menu"},B.tsx("strong",{class:"esri-popup__feature-menu-header"},F),B.tsx("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:D.storeNode},this.renderFeatureMenu(),B.tsx("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),
N?B.tsx("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):null))};I.renderPointer=function(){return this.dockEnabled?null:B.tsx("div",{key:G("pointer"),class:"esri-popup__pointer",role:"presentation"},B.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}))};I.renderMainContainer=function(){const {dockEnabled:F,currentAlignment:L,currentDockPosition:N,titleId:R,contentId:S,collapsible:P,hasContent:Q,contentCollapsed:V,visibleElements:ca}=this,
{title:ba}=this.viewModel,Z="bottom-left"===L||"bottom-center"===L||"bottom-right"===L||"top-left"===N||"top-center"===N||"top-right"===N,ha="top-left"===L||"top-center"===L||"top-right"===L||"bottom-left"===N||"bottom-center"===N||"bottom-right"===N;return B.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",{["esri-popup--shadow"]:F,["esri-popup--is-collapsible"]:P,["esri-popup--is-collapsed"]:V}),tabIndex:ca.closeButton?null:-1,role:"dialog","aria-labelledby":ba?R:"","aria-describedby":Q&&
!V?S:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},Z?this.renderFooter():null,Z?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),ha?this.renderFooter():null,ha?this.renderFeatureMenuContainer():null)};I.renderContent=function(){var F;const L=null==(F=this.viewModel)?void 0:F.content;return L?"string"===typeof L?B.tsx("div",{key:L,innerHTML:L}):this.renderNodeContent(L):null};
I.renderActionText=function(F){return B.tsx("span",{key:"text",class:"esri-popup__action-text"},F)};I.renderActionIcon=function(F){const L=this._getActionClass(F),N=this._getActionImage(F),R={["esri-icon-loading-indicator"]:F.active,["esri-rotating"]:F.active,["esri-popup__icon"]:!!L,["esri-popup__action-image"]:!F.active&&!!N};L&&(R[L]=!F.active);return B.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",R),styles:this._getIconStyles(N)})};I.renderAction=function(F){const {action:L,
index:N,type:R}=F;F=this._getActionTitle(L);const S={["esri-popup__action"]:"toggle"!==L.type,["esri-popup__action-toggle"]:"toggle"===L.type,["esri-popup__action-toggle--on"]:"toggle"===L.type&&L.value,["esri-popup__button--disabled"]:L.disabled},P=[this.renderActionIcon(L),this.renderActionText(F)];F="menu-item"===R?B.tsx("li",{key:L.uid,role:"menuitem",tabIndex:0,title:F,"aria-label":F,class:this.classes("esri-popup__button",S),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":N,
onclick:this._triggerAction,onkeydown:this._triggerAction},P):B.tsx("div",{key:L.uid,role:"button",tabIndex:0,title:F,"aria-label":F,class:this.classes("esri-popup__button",S),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":N,onclick:this._triggerAction,onkeydown:this._triggerAction},P);return L.visible?F:null};I.renderFeatureMenuItem=function(F,L){const {messages:N,messagesCommon:R}=this,{selectedFeatureIndex:S,selectedFeatureViewModel:P}=this.viewModel;var Q=F===P;const V=
{["esri-popup__feature-menu-item--selected"]:Q};Q=Q?B.tsx("span",{key:G(`feature-menu-selected-feature-${S}`),title:N.selectedFeature,"aria-label":N.selectedFeature,class:"esri-icon-check-mark"}):null;F=B.tsx("span",{innerHTML:F.title||R.untitled});return B.tsx("li",{role:"menuitem",tabIndex:-1,key:G(`feature-menu-feature-${S}`),class:this.classes(V,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":L,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},
B.tsx("span",{class:"esri-popup__feature-menu-title"},F,Q))};I.renderFeatureMenu=function(){const {featureMenuId:F}=this,{featureViewModels:L}=this.viewModel;return 1<L.length?B.tsx("ol",{class:"esri-popup__feature-menu-list",id:F,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},L.filter(N=>!!N.graphic).map((N,R)=>this.renderFeatureMenuItem(N,R))):null};I._getActionTitle=function(F){const {messages:L,selectedFeature:N,
messagesCommon:R}=this,{id:S}=F,P=null==N?void 0:N.attributes;return(F="zoom-to-feature"===S?E.substitute(F.title,{messages:L}):"remove-selected-feature"===S?E.substitute(F.title,{messages:R}):"zoom-to-clustered-features"===S?E.substitute(F.title,{messages:L}):"browse-clustered-features"===S?E.substitute(F.title,{messages:L}):F.title)&&P?E.substitute(F,P):F};I._getActionClass=function(F){var {selectedFeature:L}=this;L=null==L?void 0:L.attributes;const {className:N,image:R}=F;return(F=R||N?N:"esri-icon-default-action")&&
L?E.substitute(F,L):F};I._getActionImage=function(F){var {selectedFeature:L}=this;L=null==L?void 0:L.attributes;({image:F}=F);return F&&L?E.substitute(F,L):F};I._createFeatureUpdatedAnimation=function(){return D.cssTransition("enter","esri-popup--feature-updated")};I._getInlineActionCount=function(){const {maxInlineActions:F,featureNavigationVisible:L}=this;if("number"!==typeof F)return null;const N=Math.round(F);return Math.max(L?N-1:N,0)};I._watchActions=function(){const {allActions:F}=this.viewModel;
this.notifyChange("dividedActions");this._handles.remove("actions");F&&F.forEach(L=>{this._handles.add(l.watch(L,"active className disabled id title image visible".split(" "),()=>this.scheduleRender()),"actions")})};I._divideActions=function(){const {allActions:F}=this.viewModel,L=this._getInlineActionCount(),N=null===L,R=0===L;return{inlineActions:N?F.slice(0):R?new r:F.slice(0,L),menuActions:N?new r:R?F.slice(0):F.slice(L)}};I._featureMenuOpenChanged=function(F){F?this._focusFirstFeature=!0:this._focusFeatureMenuButton=
!0};I._actionsMenuOpenChanged=function(F){F?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};I._setTitleFromFeatureWidget=function(){const {selectedFeatureWidget:F,messagesCommon:L}=this;if(F){var N,R;this.viewModel.title="error"===(null==(N=F.viewModel)?void 0:N.state)?L.errorMessage:(null==(R=F.viewModel)?void 0:R.title)||""}};I._setContentFromFeatureWidget=function(){const {selectedFeatureWidget:F}=this;F&&(this.viewModel.content=F)};I._unobserveFeatureMenuObserver=function(){this._featureMenuIntersectionObserverNode&&
this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)};I._featureMenuIntersectionObserverCreated=function(F){this._unobserveFeatureMenuObserver();this._featureMenuIntersectionObserver.observe(F);this._featureMenuIntersectionObserverNode=F};I._handleFeatureMenuKeyup=function(F){"Escape"===q.eventKey(F)&&(F.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())};I._handleActionMenuKeyup=function(F){"Escape"===q.eventKey(F)&&
(F.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};I._handleFeatureMenuItemKeyup=function(F){const L=q.eventKey(F);var {_featureMenuNode:N}=this;const R=F.currentTarget["data-feature-index"];if(N){N=N.querySelectorAll("li");var S=N.length;"ArrowUp"===L?(F.stopPropagation(),N[(R-1+S)%S].focus()):"ArrowDown"===L?(F.stopPropagation(),N[(R+1+S)%S].focus()):"Home"===L?(F.stopPropagation(),N[0].focus()):"End"===L&&(F.stopPropagation(),N[N.length-1].focus())}};
I._handleActionMenuItemKeyup=function(F){const L=q.eventKey(F);var {_actionsMenuNode:N}=this;const R=F.currentTarget["data-action-index"];if(N){N=N.querySelectorAll("li");var S=N.length;"ArrowUp"===L?(F.stopPropagation(),N[(R-1+S)%S].focus()):"ArrowDown"===L?(F.stopPropagation(),N[(R+1+S)%S].focus()):"Home"===L?(F.stopPropagation(),N[0].focus()):"End"===L&&(F.stopPropagation(),N[N.length-1].focus())}};I._handleMainKeyup=function(F){const L=q.eventKey(F);"ArrowLeft"===L&&(F.stopPropagation(),this.previous());
"ArrowRight"===L&&(F.stopPropagation(),this.next())};I._spinnerEnabledChange=function(F){this._destroySpinner();F&&(F=this.get("viewModel.view"),this._createSpinner(F))};I._hideSpinner=function(){const {_spinner:F}=this;F&&(F.location=null,F.hide())};I._displaySpinner=function(){const {_spinner:F}=this;if(F){var {location:L,waitingForResult:N}=this.viewModel;N?F.show({location:L}):F.hide()}};I._getIconStyles=function(F){return{"background-image":F?`url(${F})`:""}};I._addSelectedFeatureIndexHandle=
function(){const F=l.watch(this,"viewModel.selectedFeatureIndex",(L,N)=>this._selectedFeatureIndexUpdated(L,N));this._handles.add(F,"selected-index")};I._selectedFeatureIndexUpdated=function(F,L){const {featureCount:N}=this;N&&F!==L&&-1!==F&&(this.featureMenuOpen=this.actionsMenuOpen=!1)};I._destroySelectedFeatureWidget=function(){const {_feature:F}=this;F&&(F.viewModel=null,F&&!F.destroyed&&F.destroy());this._feature=null};I._isScreenLocationWithinView=function(F,L){return-1<F.x&&-1<F.y&&F.x<=L.width&&
F.y<=L.height};I._isOutsideView=function(F){const {popupHeight:L,popupWidth:N,screenLocation:R,side:S,view:P}=F;if(isNaN(N)||isNaN(L)||!P||!R)return!1;F=P.padding;return"right"===S&&R.x+N/2>P.width-F.right||"left"===S&&R.x-N/2<F.left||"top"===S&&R.y-L<F.top||"bottom"===S&&R.y+L>P.height-F.bottom?!0:!1};I._calculateAutoAlignment=function(F){if("auto"!==F)return F;const {_pointerOffsetInPx:L,_containerNode:N,_mainContainerNode:R,viewModel:S}=this,{screenLocation:P,view:Q}=S;if(w.isNone(P)||!Q||!N)return"top-center";
if(!this._isScreenLocationWithinView(P,Q))return this._get("currentAlignment")||"top-center";var V=(F=R?window.getComputedStyle(R,null):null)?parseInt(F.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,ca=F?parseInt(F.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0;const {height:ba,width:Z}=N.getBoundingClientRect();F=Z+L;const ha=Math.max(ba,V,ca)+L;V=this._isOutsideView({popupHeight:ha,popupWidth:F,screenLocation:P,side:"right",view:Q});ca=this._isOutsideView({popupHeight:ha,
popupWidth:F,screenLocation:P,side:"left",view:Q});const fa=this._isOutsideView({popupHeight:ha,popupWidth:F,screenLocation:P,side:"top",view:Q});F=this._isOutsideView({popupHeight:ha,popupWidth:F,screenLocation:P,side:"bottom",view:Q});return ca?fa?"bottom-right":"top-right":V?fa?"bottom-left":"top-left":fa?F?"top-center":"bottom-center":"top-center"};I._callCurrentAlignment=function(F){return"function"===typeof F?F.call(this):F};I._getCurrentAlignment=function(){const {alignment:F,dockEnabled:L}=
this;return L||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(F)))};I._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};I._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};I._calculatePositionResult=function(F){const L=["left","right"];D.isRTL(this.container)&&L.reverse();return F.replace(/leading/gi,L[0]).replace(/trailing/gi,L[1])};I._callDockPosition=
function(F){return"function"===typeof F?F.call(this):F};I._getDockPosition=function(){var F;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(F=this.dockOptions)?void 0:F.position)))};I._getCurrentDockPosition=function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null};I._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};I._calculateAutoDockPosition=function(F){var L;if("auto"!==F)return F;F=null==
(L=this.viewModel)?void 0:L.view;L=D.isRTL(this.container)?"top-left":"top-right";if(!F)return L;var N=F.padding||{left:0,right:0,top:0,bottom:0};N=F.width-N.left-N.right;({breakpoints:F}=F);return F&&N<=F.xsmall?"bottom-center":L};I._positionContainer=function(F=this._containerNode){F&&(this._containerNode=F);if(F){var {screenLocation:L}=this.viewModel,{width:N}=F.getBoundingClientRect();if(L=this._calculatePositionStyle(L,N))F.style.top=L.top,F.style.left=L.left,F.style.bottom=L.bottom,F.style.right=
L.right}};I._calculateFullWidth=function(F){const {currentAlignment:L,_pointerOffsetInPx:N}=this;return"top-left"===L||"bottom-left"===L||"top-right"===L||"bottom-right"===L?F+N:F};I._calculateAlignmentPosition=function(F,L,N,R){const {currentAlignment:S,_pointerOffsetInPx:P}=this;R/=2;const Q=N.height-L;N=N.width-F;const {padding:V}=this.view;if("bottom-center"===S)return{top:L+P-V.top,left:F-R-V.left};if("top-left"===S)return{bottom:Q+P-V.bottom,right:N+P-V.right};if("bottom-left"===S)return{top:L+
P-V.top,right:N+P-V.right};if("top-right"===S)return{bottom:Q+P-V.bottom,left:F+P-V.left};if("bottom-right"===S)return{top:L+P-V.top,left:F+P-V.left};if("top-center"===S)return{bottom:Q+P-V.bottom,left:F-R-V.left}};I._calculatePositionStyle=function(F,L){const {dockEnabled:N,view:R}=this;if(R){if(N)return{left:"",top:"",right:"",bottom:""};if(!w.isNone(F)&&L&&(L=this._calculateFullWidth(L),F=this._calculateAlignmentPosition(F.x,F.y,R,L)))return{top:void 0!==F.top?`${F.top}px`:"auto",left:void 0!==
F.left?`${F.left}px`:"auto",bottom:void 0!==F.bottom?`${F.bottom}px`:"auto",right:void 0!==F.right?`${F.right}px`:"auto"}}};I._viewChange=function(F,L){F&&L&&(this.close(),this.clear())};I._viewReadyChange=function(F,L){F?(F=this.get("viewModel.view"),this._wireUpView(F)):L&&(this.close(),this.clear())};I._wireUpView=function(F){this._destroySpinner();if(F){var {spinnerEnabled:L}=this;L&&this._createSpinner(F);this._setDockEnabledForViewSize(this.dockOptions)}};I._dockingThresholdCrossed=function(F,
L,N){const [R,S]=F,[P,Q]=L,{width:V,height:ca}=N;return R<=V&&P>V||R>V&&P<=V||S<=ca&&Q>ca||S>ca&&Q<=ca};I._updateDockEnabledForViewSize=function(F,L){if(F&&L){var N=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},R=N.left+N.right,S=N.top+N.bottom;N=[];var P=[];N[0]=F[0]-R;N[1]=F[1]-S;P[0]=L[0]-R;P[1]=L[1]-S;({dockOptions:F}=this);this._dockingThresholdCrossed(N,P,F.breakpoint)&&this._setDockEnabledForViewSize(F);this._setCurrentDockPosition()}};I._focusDockButtonNode=function(F){this._focusDockButton&&
(this._focusDockButton=!1,F.focus())};I._closeButtonNodeUpdated=function(F){this._focusClose?(this._focusClose=!1,F.focus()):this._blurClose&&(this._blurClose=!1,F.blur())};I._mainContainerNodeUpdated=function(F){this._mainContainerNode=F;this._focusContainer?(this._focusContainer=!1,F.focus()):this._blurContainer&&(this._blurContainer=!1,F.blur())};I._featureMenuNodeUpdated=function(F){(this._featureMenuNode=F)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,F=F.querySelectorAll("li"),F.length&&
F[0].focus())};I._actionsMenuNodeUpdated=function(F){(this._actionsMenuNode=F)&&this._focusFirstAction&&(this._focusFirstAction=!1,F=F.querySelectorAll("li"),F.length&&F[0].focus())};I._focusFeatureMenuButtonNode=function(F){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,F.focus())};I._focusActionsMenuButtonNode=function(F){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,F.focus())};I._featureMenuViewportScrollTop=function(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=
0)};I._toggleScreenLocationEnabled=function(){const {dockEnabled:F,viewModel:L}=this;L&&(L.screenLocationEnabled=L.active&&!F)};I._shouldDockAtCurrentViewSize=function(F){var L,N;F=F.breakpoint;const R=null==(L=this.viewModel)?void 0:null==(N=L.view)?void 0:N.ui;if(!R)return!1;const {width:S,height:P}=R;if(isNaN(S)||isNaN(P))return!1;L=F.hasOwnProperty("width")&&S<=F.width;N=F.hasOwnProperty("height")&&P<=F.height;return L||N};I._setDockEnabledForViewSize=function(F){F.breakpoint&&(this.dockEnabled=
this._shouldDockAtCurrentViewSize(F))};I._getPageText=function(F,L){return this.featureNavigationVisible?E.substitute(this.messages.pageText,{index:L+1,total:F}):null};I._destroySpinner=function(){const {_spinner:F,view:L}=this;F&&(L&&L.ui&&L.ui.remove(this._spinner,"popup-spinner"),F.destroy(),this._spinner=null)};I._createSpinner=function(F){F&&(this._spinner=new m({view:F}),F.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};I._toggleCollapsed=function(){this.collapsed=!this.collapsed};
I._close=function(){this.close();this.view&&this.view.focus()};I._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};I._toggleFeatureMenu=function(){const F=!this.featureMenuOpen;this._featureMenuOpenChanged(F);this.actionsMenuOpen=!1;this.featureMenuOpen=F};I._toggleActionsMenu=function(){const F=!this.actionsMenuOpen;this._actionsMenuOpenChanged(F);this.featureMenuOpen=!1;this.actionsMenuOpen=F};I._triggerAction=function(F){F=F.currentTarget["data-action-index"];
const L=this.viewModel.allActions.getItemAt(F);L&&"toggle"===L.type&&(L.value=!L.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(F)};I._selectFeature=function(F){F=F.currentTarget["data-feature-index"];isNaN(F)||(this.viewModel.selectedFeatureIndex=F);this.featureMenuOpen=!1;this._focusFeatureMenuButton=!0;this.scheduleRender()};I._next=function(){this.next()};I._previous=function(){this.previous()};a._createClass(O,[{key:"actionsMenuId",get:function(){return`${this.id}-actions-menu`}},
{key:"actionsMenuButtonId",get:function(){return`${this.id}-actions-menu-button`}},{key:"featureMenuId",get:function(){return`${this.id}-feature-menu`}},{key:"titleId",get:function(){return`${this.id}-popup-title`}},{key:"contentId",get:function(){return`${this.id}-popup-content`}},{key:"hasContent",get:function(){var F,L,N,R,S,P,Q;return!!(this.selectedFeatureWidget?(null==(F=this.selectedFeatureWidget)?0:null==(L=F.viewModel)?0:L.waitingForContent)||"error"===(null==(N=this.selectedFeatureWidget)?
void 0:null==(R=N.viewModel)?void 0:R.state)||(null==(S=this.selectedFeatureWidget)?0:null==(P=S.viewModel)?0:P.content):null==(Q=this.viewModel)?0:Q.content)}},{key:"featureNavigationVisible",get:function(){return this.viewModel.active&&1<this.viewModel.featureCount&&this.visibleElements.featureNavigation}},{key:"collapsible",get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},
{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},{key:"actionsMenuOpen",get:function(){return this.viewModel.active?this._get("actionsMenuOpen"):!1},set:function(F){this._set("actionsMenuOpen",!!F)}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",
get:function(){return this._get("dockOptions")||K},set:function(F){var L={...K};const N=this.get("viewModel.view.breakpoints");var R={};N&&(R.width=N.xsmall,R.height=N.xsmall);F={...L,...F};L={...L.breakpoint,...R};({breakpoint:R}=F);!0===R?F.breakpoint=L:"object"===typeof R&&(F.breakpoint={...L,...R});this._set("dockOptions",F);this._setCurrentDockPosition();this.reposition()}},{key:"selectedFeatureWidget",get:function(){const {_feature:F,visibleElements:L,headingLevel:N}=this,{selectedFeatureViewModel:R}=
this.viewModel,S={...L,title:!1};if(!R)return null;F?(F.viewModel=R,F.visibleElements=S):this._feature=new h({headingLevel:N+1,viewModel:R,visibleElements:S});return this._feature}}]);return O}(z.FeatureContentMixin(n));p.__decorate([u.property({readOnly:!0})],b.prototype,"actionsMenuId",null);p.__decorate([u.property({readOnly:!0})],b.prototype,"actionsMenuButtonId",null);p.__decorate([u.property({readOnly:!0})],b.prototype,"featureMenuId",null);p.__decorate([u.property({readOnly:!0})],b.prototype,
"titleId",null);p.__decorate([u.property({readOnly:!0})],b.prototype,"contentId",null);p.__decorate([u.property({readOnly:!0})],b.prototype,"hasContent",null);p.__decorate([u.property({readOnly:!0})],b.prototype,"featureNavigationVisible",null);p.__decorate([u.property({readOnly:!0})],b.prototype,"collapsible",null);p.__decorate([u.property({readOnly:!0})],b.prototype,"featureMenuVisible",null);p.__decorate([u.property({readOnly:!0})],b.prototype,"contentCollapsed",null);p.__decorate([u.property({readOnly:!0})],
b.prototype,"dividedActions",null);p.__decorate([g.aliasOf("viewModel.actions")],b.prototype,"actions",void 0);p.__decorate([u.property()],b.prototype,"actionsMenuOpen",null);p.__decorate([u.property()],b.prototype,"alignment",void 0);p.__decorate([g.aliasOf("viewModel.autoCloseEnabled")],b.prototype,"autoCloseEnabled",void 0);p.__decorate([g.aliasOf("viewModel.autoOpenEnabled")],b.prototype,"autoOpenEnabled",void 0);p.__decorate([g.aliasOf("viewModel.defaultPopupTemplateEnabled")],b.prototype,"defaultPopupTemplateEnabled",
void 0);p.__decorate([g.aliasOf("viewModel.content")],b.prototype,"content",void 0);p.__decorate([u.property()],b.prototype,"collapsed",void 0);p.__decorate([u.property()],b.prototype,"collapseEnabled",void 0);p.__decorate([u.property({readOnly:!0})],b.prototype,"currentAlignment",null);p.__decorate([u.property({readOnly:!0})],b.prototype,"currentDockPosition",null);p.__decorate([u.property()],b.prototype,"dockOptions",null);p.__decorate([u.property()],b.prototype,"dockEnabled",void 0);p.__decorate([g.aliasOf("viewModel.featureCount")],
b.prototype,"featureCount",void 0);p.__decorate([u.property()],b.prototype,"featureMenuOpen",void 0);p.__decorate([g.aliasOf("viewModel.features")],b.prototype,"features",void 0);p.__decorate([g.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);p.__decorate([u.property()],b.prototype,"headingLevel",void 0);p.__decorate([g.aliasOf("viewModel.highlightEnabled")],b.prototype,"highlightEnabled",void 0);p.__decorate([g.aliasOf("viewModel.location")],b.prototype,"location",void 0);p.__decorate([u.property({aliasOf:{source:"messages.widgetLabel",
overridable:!0}})],b.prototype,"label",void 0);p.__decorate([u.property()],b.prototype,"maxInlineActions",void 0);p.__decorate([u.property(),C.messageBundle("esri/widgets/Popup/t9n/Popup")],b.prototype,"messages",void 0);p.__decorate([u.property(),C.messageBundle("esri/t9n/common")],b.prototype,"messagesCommon",void 0);p.__decorate([g.aliasOf("viewModel.promises")],b.prototype,"promises",void 0);p.__decorate([g.aliasOf("viewModel.selectedFeature")],b.prototype,"selectedFeature",void 0);p.__decorate([g.aliasOf("viewModel.selectedFeatureIndex")],
b.prototype,"selectedFeatureIndex",void 0);p.__decorate([u.property({readOnly:!0})],b.prototype,"selectedFeatureWidget",null);p.__decorate([u.property()],b.prototype,"spinnerEnabled",void 0);p.__decorate([g.aliasOf("viewModel.title")],b.prototype,"title",void 0);p.__decorate([g.aliasOf("viewModel.updateLocationEnabled")],b.prototype,"updateLocationEnabled",void 0);p.__decorate([g.aliasOf("viewModel.view")],b.prototype,"view",void 0);p.__decorate([u.property({type:k}),A.vmEvent(["triggerAction","trigger-action"])],
b.prototype,"viewModel",void 0);p.__decorate([g.aliasOf("viewModel.visible")],b.prototype,"visible",void 0);p.__decorate([u.property()],b.prototype,"visibleElements",void 0);p.__decorate([c.cast("visibleElements")],b.prototype,"castVisibleElements",null);p.__decorate([x.accessibleHandler()],b.prototype,"_close",null);p.__decorate([x.accessibleHandler()],b.prototype,"_toggleDockEnabled",null);p.__decorate([x.accessibleHandler()],b.prototype,"_toggleFeatureMenu",null);p.__decorate([x.accessibleHandler()],
b.prototype,"_toggleActionsMenu",null);p.__decorate([x.accessibleHandler()],b.prototype,"_triggerAction",null);p.__decorate([x.accessibleHandler()],b.prototype,"_selectFeature",null);p.__decorate([x.accessibleHandler()],b.prototype,"_next",null);p.__decorate([x.accessibleHandler()],b.prototype,"_previous",null);return b=p.__decorate([t.subclass("esri.widgets.Popup")],b)})},"esri/core/throttle":function(){define(["exports"],function(a){function p(b,r,q,y){let f=null,w=1E3;"number"===typeof r?(w=r,
y=q):(f=null!=r?r:null,w=q);let e=0,l;const g=()=>{e=0;b.apply(y,l)};r=(...d)=>{f&&f.apply(y,d);l=d;w?e||(e=setTimeout(g,w)):g()};r.remove=()=>{e&&(clearTimeout(e),e=0)};r.forceUpdate=()=>{e&&(clearTimeout(e),g())};r.hasPendingUpdates=()=>!!e;return r}a["default"]=p;a.throttle=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/decorators/cast ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Feature/FeatureAttachments ./Feature/FeatureContent ./Feature/FeatureFields ./Feature/FeatureMedia ./Feature/FeatureViewModel ./Feature/support/FeatureContentMixin ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C){const A={title:!0,content:!0,lastEditedInfo:!0};r=function(B){function D(G,K){G=B.call(this,G,K)||this;G._contentWidgets=[];G.graphic=null;G.defaultPopupTemplateEnabled=!1;G.headingLevel=2;G.label=void 0;G.messages=null;G.messagesCommon=null;G.messagesURIUtils=null;G.spatialReference=null;G.title=null;G.visibleElements={...A};G.map=null;G.view=null;G.viewModel=new m;return G}p._inheritsLoose(D,B);var E=D.prototype;E.initialize=function(){this.own(q.init(this,
"viewModel.contentViewModels",()=>this._setupContentWidgets()))};E.loadDependencies=function(){return new Promise(function(G,K){a(["../chunks/notice"],G,K)})};E.destroy=function(){this._destroyContentWidgets()};E.castVisibleElements=function(G){return{...A,...G}};E.render=function(){var {state:G}=this.viewModel;G=x.tsx("div",{class:"esri-feature__size-container",key:"container"},this.renderTitle(),"error"===G?this.renderError():"loading"===G?this.renderLoading():this.renderContentContainer());return x.tsx("div",
{class:this.classes("esri-feature","esri-widget")},G)};E.setActiveMedia=function(G,K){this.viewModel.setActiveMedia(G,K)};E.nextMedia=function(G){this.viewModel.nextMedia(G)};E.previousMedia=function(G){this.viewModel.previousMedia(G)};E.renderError=function(){const {messagesCommon:G,messages:K,visibleElements:M}=this;return x.tsx("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},M.title?x.tsx("div",{key:"error-title",slot:"title"},G.errorMessage):null,x.tsx("div",
{key:"error-message",slot:"message"},K.loadingError))};E.renderLoading=function(){return x.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},x.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))};E.renderContentContainer=function(){const {visibleElements:G}=this;return G.content?x.tsx("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null};E.renderTitle=function(){const {visibleElements:G,
title:K}=this;return G.title?x.tsx(z.Heading,{level:this.headingLevel,class:"esri-feature__title",innerHTML:K}):null};E.renderContent=function(){var G=this.viewModel.content;return G?Array.isArray(G)?G.length?x.tsx("div",{key:"content-content-elements"},G.map(this.renderContentElement,this)):null:"string"===typeof G?(G=this._contentWidgets[0],!G||G.destroyed?null:x.tsx("div",{key:"content-content"},G.render())):this.renderNodeContent(G):null};E.renderContentElement=function(G,K){const {visibleElements:M}=
this;if("boolean"!==typeof M.content&&!M.content[G.type])return null;switch(G.type){case "attachments":return this.renderAttachments(K);case "custom":return this.renderCustom(G,K);case "fields":return this.renderFields(K);case "media":return this.renderMedia(K);case "text":return this.renderText(G,K);default:return null}};E.renderAttachments=function(G){const K=this._contentWidgets[G];if(!K||K.destroyed)return null;const {state:M,attachmentInfos:H}=K.viewModel;return"loading"===M||0<H.length?x.tsx("div",
{key:this._buildKey("attachments-element",G),class:this.classes("esri-feature__content-element")},K.render()):null};E.renderCustom=function(G,K){({creator:G}=G);const M=this._contentWidgets[K];return!M||M.destroyed?null:G?x.tsx("div",{key:this._buildKey("custom-element",K),class:"esri-feature__content-element"},M.render()):null};E.renderFields=function(G){const K=this._contentWidgets[G];return!K||K.destroyed?null:x.tsx("div",{key:this._buildKey("fields-element",G),class:"esri-feature__content-element"},
K.render())};E.renderMedia=function(G){const K=this._contentWidgets[G];return!K||K.destroyed?null:x.tsx("div",{key:this._buildKey("media-element",G),class:"esri-feature__content-element"},K.render())};E.renderLastEditInfo=function(){const {visibleElements:G,messages:K}=this;var {lastEditInfo:M}=this.viewModel;if(!M||!G.lastEditedInfo)return null;const {date:H,user:J}=M;M=C.substitute("edit"===M.type?J?K.lastEditedByUser:K.lastEdited:J?K.lastCreatedByUser:K.lastCreated,{date:H,user:J});return x.tsx("div",
{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},M)};E.renderText=function(G,K){const M=this._contentWidgets[K];return!M||M.destroyed?null:G.text?x.tsx("div",{key:this._buildKey("text-element",K),class:this.classes("esri-feature__content-element","esri-feature__text")},M.render()):null};E._buildKey=function(G,...K){const M=this.get("viewModel.graphic.uid")||"0";K=K.join("-");return`${G}__${M}-${K}`};E._destroyContentWidgets=function(){this._contentWidgets.forEach(G=>
{G.viewModel=null;G&&!G.destroyed&&G.destroy()});this._contentWidgets=[]};E._setupContentWidgets=function(){this._destroyContentWidgets();const {headingLevel:G,visibleElements:K}=this;var M=this.get("viewModel.content");const {contentViewModels:H}=this.viewModel;Array.isArray(M)?M.forEach((J,O)=>{"attachments"===J.type&&(this._contentWidgets[O]=new c({displayType:J.displayType,headingLevel:K.title?G+1:G,viewModel:H[O]}));"fields"===J.type&&(this._contentWidgets[O]=new t({viewModel:H[O]}));"media"===
J.type&&(this._contentWidgets[O]=new h({viewModel:H[O]}));"text"===J.type&&(this._contentWidgets[O]=new u({viewModel:H[O]}));"custom"===J.type&&(this._contentWidgets[O]=new u({viewModel:H[O]}))},this):(M=H[0])&&!M.destroyed&&(this._contentWidgets[0]=new u({viewModel:M}));this.scheduleRender()};return D}(n.FeatureContentMixin(d));b.__decorate([y.aliasOf("viewModel.graphic")],r.prototype,"graphic",void 0);b.__decorate([y.aliasOf("viewModel.defaultPopupTemplateEnabled")],r.prototype,"defaultPopupTemplateEnabled",
void 0);b.__decorate([l.property()],r.prototype,"headingLevel",void 0);b.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],r.prototype,"label",void 0);b.__decorate([l.property(),v.messageBundle("esri/widgets/Feature/t9n/Feature")],r.prototype,"messages",void 0);b.__decorate([l.property(),v.messageBundle("esri/t9n/common")],r.prototype,"messagesCommon",void 0);b.__decorate([l.property(),v.messageBundle("esri/widgets/support/t9n/uriUtils")],r.prototype,"messagesURIUtils",
void 0);b.__decorate([y.aliasOf("viewModel.spatialReference")],r.prototype,"spatialReference",void 0);b.__decorate([y.aliasOf("viewModel.title")],r.prototype,"title",void 0);b.__decorate([l.property()],r.prototype,"visibleElements",void 0);b.__decorate([w.cast("visibleElements")],r.prototype,"castVisibleElements",null);b.__decorate([y.aliasOf("viewModel.map")],r.prototype,"map",void 0);b.__decorate([y.aliasOf("viewModel.view")],r.prototype,"view",void 0);b.__decorate([l.property({type:m})],r.prototype,
"viewModel",void 0);return r=b.__decorate([g.subclass("esri.widgets.Feature")],r)})},"esri/widgets/Feature/FeatureAttachments":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Attachments ../Widget ./FeatureAttachments/FeatureAttachmentsViewModel ./support/FeatureElementInfo ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){q=function(h){function m(z,k){z=h.call(this,z,k)||this;z._featureElementInfo=null;z.attachmentsWidget=new l;z.description=null;z.displayType=null;z.graphic=null;z.headingLevel=2;z.title=null;z.viewModel=new d;return z}a._inheritsLoose(m,h);var n=m.prototype;n.initialize=function(){this._featureElementInfo=new c;b.init(this,["viewModel.description","viewModel.title","headingLevel"],()=>this._setupFeatureElementInfo());b.init(this,"viewModel.graphic",z=>this.attachmentsWidget.graphic=
z)};n.destroy=function(){this.attachmentsWidget.destroy();this._featureElementInfo.destroy()};n.render=function(){var z;const {attachmentsWidget:k}=this;return t.tsx("div",{class:"esri-feature-attachments"},null==(z=this._featureElementInfo)?void 0:z.render(),null==k?void 0:k.render())};n._setupFeatureElementInfo=function(){const {description:z,title:k,headingLevel:v}=this;this._featureElementInfo.set({description:z,title:k,headingLevel:v})};return m}(g);p.__decorate([w.property({readOnly:!0})],q.prototype,
"attachmentsWidget",void 0);p.__decorate([r.aliasOf("viewModel.description")],q.prototype,"description",void 0);p.__decorate([r.aliasOf("attachmentsWidget.displayType")],q.prototype,"displayType",void 0);p.__decorate([r.aliasOf("viewModel.graphic")],q.prototype,"graphic",void 0);p.__decorate([w.property()],q.prototype,"headingLevel",void 0);p.__decorate([r.aliasOf("viewModel.title")],q.prototype,"title",void 0);p.__decorate([w.property({type:d})],q.prototype,"viewModel",void 0);return q=p.__decorate([e.subclass("esri.widgets.Feature.FeatureAttachments")],
q)})},"esri/widgets/Attachments":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/unitFormatUtils ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/decorators/cast ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){const n={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},z=window.CSS;f=function(k){function v(C,A){C=k.call(this,C,A)||this;C.abilities=null;C.displayType="list";C.graphic=null;C.label=void 0;C.messages=null;C.messagesUnits=null;C.selectedFile=null;C.submitting=!1;C.viewModel=new c;C.visibleElements={...n};C._supportsImageOrientation=z&&z.supports&&z.supports("image-orientation",
"from-image");C._addAttachmentForm=null;C._updateAttachmentForm=null;return C}a._inheritsLoose(v,k);var x=v.prototype;x.initialize=function(){this.own(q.on(this,"viewModel.attachmentInfos","change",()=>this.scheduleRender()),q.init(this,"viewModel.mode",()=>this._modeChanged()))};x.castVisibleElements=function(C){return{...n,...C}};x.addAttachment=function(){const {_addAttachmentForm:C,viewModel:A}=this;this._set("submitting",!0);this._set("error",null);return A.addAttachment(C).then(B=>{this._set("submitting",
!1);this._set("error",null);A.mode="view";return B}).catch(B=>{this._set("submitting",!1);this._set("error",new b("attachments:add-attachment",this.messages.addErrorMessage,B));throw B;})};x.deleteAttachment=function(C){const {viewModel:A}=this;this._set("submitting",!0);this._set("error",null);return A.deleteAttachment(C).then(B=>{this._set("submitting",!1);this._set("error",null);A.mode="view";return B}).catch(B=>{this._set("submitting",!1);this._set("error",new b("attachments:delete-attachment",
this.messages.deleteErrorMessage,B));throw B;})};x.updateAttachment=function(){const {viewModel:C}=this,{_updateAttachmentForm:A}=this;this._set("submitting",!0);this._set("error",null);return C.updateAttachment(A).then(B=>{this._set("submitting",!1);this._set("error",null);C.mode="view";return B}).catch(B=>{this._set("submitting",!1);this._set("error",new b("attachments:update-attachment",this.messages.updateErrorMessage,B));throw B;})};x.render=function(){const {submitting:C,viewModel:A}=this,{state:B}=
A;return m.tsx("div",{class:this.classes("esri-attachments","esri-widget")},C?this.renderProgressBar():null,"loading"===B?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())};x.renderErrorMessage=function(){const {error:C,visibleElements:A}=this;return C&&A.errorMessage?m.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},C.message):null};x.renderAttachments=function(){const {mode:C,activeAttachmentInfo:A}=this.viewModel;return"add"===C?this.renderAddForm():
"edit"===C?this.renderDetailsForm(A):this.renderAttachmentContainer()};x.renderLoading=function(){return m.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},m.tsx("div",{class:"esri-attachments__loader"}))};x.renderProgressBar=function(){return this.visibleElements.progressBar?m.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};x.renderAddForm=function(){const {submitting:C,selectedFile:A}=this;var B=C||!A,D=this.visibleElements.cancelAddButton?m.tsx("button",
{type:"button",bind:this,disabled:C,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",C&&"esri-button--disabled")},this.messages.cancel):null;B=this.visibleElements.addSubmitButton?m.tsx("button",{type:"submit",disabled:B,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{["esri-button--disabled"]:B})},this.messages.add):null;const E=A?m.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},
A.name):null;D=m.tsx("form",{bind:this,afterCreate:t.storeNode,afterRemoved:t.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},m.tsx("fieldset",{class:"esri-attachments__file-fieldset"},E,m.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},A?this.messages.changeFile:this.messages.selectFile,m.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),
B,D);return m.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},D)};x.renderDetailsForm=function(C){const {visibleElements:A,viewModel:B,selectedFile:D,submitting:E}=this,{contentType:G,size:K,url:M}=C;var {abilities:H}=B,J=E||!D,O=H.editing&&H.operations.delete&&A.deleteButton?m.tsx("button",{key:"delete-button",type:"button",disabled:E,bind:this,onclick:N=>this._submitDeleteAttachment(N,C),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",
{["esri-button--disabled"]:E})},this.messages.delete):null;J=H.editing&&H.operations.update&&A.updateButton?m.tsx("button",{disabled:J,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{["esri-button--disabled"]:J})},this.messages.update):null;const I=this.visibleElements.cancelUpdateButton?m.tsx("button",{disabled:E,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small",
"esri-button--tertiary","esri-button--third",{["esri-button--disabled"]:E})},this.messages.cancel):null;var F=D?m.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},D.name):null;H=H.editing&&H.operations.update?m.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},F,m.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,m.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",
bind:this,onchange:this._handleFileInputChange}))):null;F=m.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},m.tsx("label",null,r.formatFileSize(this.messagesUnits,K)));const L=m.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},m.tsx("label",null,G));O=m.tsx("form",{bind:this,afterCreate:t.storeNode,afterRemoved:t.discardNode,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},m.tsx("div",{class:"esri-attachments__metadata"},
F,L),H,m.tsx("div",{class:"esri-attachments__actions"},O,I,J));return m.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},m.tsx("a",{class:"esri-attachments__item-link",href:M,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:C,size:400}),m.tsx("div",{class:"esri-attachments__item-link-overlay"},m.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},m.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},m.tsx("path",
{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),m.tsx("path",{fill:"none",d:"M0 0h32v32H0z"}))))),O)};x.renderImageMask=function({attachmentInfo:C,size:A}){var {supportsResizeAttachments:B}=this.viewModel;const {contentType:D,name:E,url:G}=C,K=B&&u.isSupportedImage(D);C=(C=this._getCSSTransform(C,K))?{transform:C,"image-orientation":"none"}:{};const M=-1===G.indexOf("?")?"?":"\x26";A=K?`${G}${M}w=${A}`:u.getIconPath(D);B={["esri-attachments__image--resizable"]:B};
return m.tsx("div",{class:this.classes({["esri-attachments__item-mask--icon"]:!K},"esri-attachments__item-mask")},m.tsx("img",{styles:C,alt:E,src:A,class:this.classes(B,"esri-attachments__image")}))};x.renderAttachmentInfo=function({attachmentInfo:C,displayType:A}){var {viewModel:B}=this;({abilities:B}=B);const {name:D,url:E}=C;A=this.renderImageMask({attachmentInfo:C,size:"list"===A?48:400});var G=B.editing?m.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",
t.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}):null;G=m.tsx("label",{class:"esri-attachments__label"},m.tsx("span",{class:"esri-attachments__filename"},D||this.messages.noTitle),G);A=[A,G];B=B.editing?m.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":C.id,onclick:()=>this._startEditAttachment(C),type:"button"},A):m.tsx("a",{key:"details-link",
class:"esri-attachments__item-button",href:E,target:"_blank"},A);return m.tsx("li",{class:"esri-attachments__item",key:C},B)};x.renderAttachmentContainer=function(){const {displayType:C,viewModel:A,visibleElements:B}=this,{attachmentInfos:D,abilities:E}=A;var G=D&&D.length;const K={["esri-attachments__container--list"]:"preview"!==C,["esri-attachments__container--preview"]:"preview"===C},M=E.editing&&E.operations.add&&B.addButton?m.tsx("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button",
"esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},m.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null;G=G?m.tsx("ul",{class:"esri-attachments__items"},D.toArray().map(H=>this.renderAttachmentInfo({attachmentInfo:H,displayType:C}))):m.tsx("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return m.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",
K)},G,M)};x._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};x._handleFileInputChange=function(C){C=(C=C.target)&&C.files&&C.files.item(0);this._set("selectedFile",C)};x._submitDeleteAttachment=function(C,A){C.preventDefault();this.deleteAttachment(A)};x._submitAddAttachment=function(C){C.preventDefault();this.addAttachment()};x._submitUpdateAttachment=function(C){C.preventDefault();this.updateAttachment()};x._startEditAttachment=function(C){const {viewModel:A}=this;
A.activeAttachmentInfo=C;A.mode="edit"};x._startAddAttachment=function(){this.viewModel.mode="add"};x._cancelForm=function(C){C.preventDefault();this.viewModel.mode="view"};x._getCSSTransform=function(C,A){({orientationInfo:C}=C);return!this._supportsImageOrientation&&A&&C?[C.rotation?`rotate(${C.rotation}deg)`:"",C.mirrored?"scaleX(-1)":""].join(" "):""};return v}(d);p.__decorate([y.aliasOf("viewModel.abilities")],f.prototype,"abilities",void 0);p.__decorate([l.property()],f.prototype,"displayType",
void 0);p.__decorate([y.aliasOf("viewModel.graphic")],f.prototype,"graphic",void 0);p.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0);p.__decorate([l.property(),h.messageBundle("esri/widgets/Attachments/t9n/Attachments")],f.prototype,"messages",void 0);p.__decorate([l.property(),h.messageBundle("esri/core/t9n/Units")],f.prototype,"messagesUnits",void 0);p.__decorate([l.property({readOnly:!0})],f.prototype,"selectedFile",void 0);p.__decorate([l.property({readOnly:!0})],
f.prototype,"submitting",void 0);p.__decorate([l.property({readOnly:!0})],f.prototype,"error",void 0);p.__decorate([l.property({type:c})],f.prototype,"viewModel",void 0);p.__decorate([l.property()],f.prototype,"visibleElements",void 0);p.__decorate([w.cast("visibleElements")],f.prototype,"castVisibleElements",null);return f=p.__decorate([g.subclass("esri.widgets.Attachments")],f)})},"esri/core/unitFormatUtils":function(){define(["exports","./mathUtils","./string","./unitUtils","../intl/number"],function(a,
p,b,r,q){function y(e,l,g){return e.units[l][g]}function f(e,l,g,d=2,c="abbr"){return`${q.formatNumber(l,{minimumFractionDigits:d,maximumFractionDigits:d})} ${y(e,g,c)}`}const w=["B","kB","MB","GB","TB"];a.formatAngleDegrees=function(e,l,g=2){e=r.convertUnit(e,l,"degrees");return q.formatNumber(e,{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:g,minimumFractionDigits:g})};a.formatDMS=function(e,l,g=2){e=r.convertUnit(e,l,"degrees");l=e-Math.floor(e);e-=l;l*=60;let d=l-Math.floor(l);
l-=d;d*=60;return`${e.toFixed()}\u00b0 ${l.toFixed()}' ${d.toFixed(g)}"`};a.formatDecimal=f;a.formatFileSize=function(e,l){let g=0===l?0:Math.floor(Math.log(l)/Math.log(1024));g=p.clamp(g,0,w.length-1);l=q.formatNumber(l/1024**g,{maximumFractionDigits:2});return b.replace(e.units.bytes[w[g]],{fileSize:l})};a.formatImperialArea=function(e,l,g,d=2,c="abbr"){const u=r.preferredImperialAreaUnit(l,g);return f(e,r.convertUnit(l,g,u),u,d,c)};a.formatImperialLength=function(e,l,g,d=2,c="abbr"){const u=r.preferredImperialLengthUnit(l,
g);return f(e,r.convertUnit(l,g,u),u,d,c)};a.formatImperialVerticalLength=function(e,l,g,d=2,c="abbr"){const u=r.preferredImperialVerticalLengthUnit(l,g);return f(e,r.convertUnit(l,g,u),u,d,c)};a.formatMetricArea=function(e,l,g,d=2,c="abbr"){const u=r.preferredMetricAreaUnit(l,g);return f(e,r.convertUnit(l,g,u),u,d,c)};a.formatMetricLength=function(e,l,g,d=2,c="abbr"){const u=r.preferredMetricLengthUnit(l,g);return f(e,r.convertUnit(l,g,u),u,d,c)};a.formatMetricVerticalLength=function(e,l,g,d=2,c=
"abbr"){const u=r.preferredMetricVerticalLengthUnit(l,g);return f(e,r.convertUnit(l,g,u),u,d,c)};a.unitName=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/maybe ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/cast ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../rest/query/support/AttachmentInfo ../../rest/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){const m={editing:!1,operations:{add:!0,update:!0,delete:!0}},n=r.ofType(u);r=function(z){function k(x){var C=z.call(this,x)||this;C._getAttachmentsPromise=null;C._attachmentLayer=null;C.abilities={...m};C.activeAttachmentInfo=null;C.attachmentInfos=new n;C.graphic=null;C.mode="view";C.handles.add([w.init(a._assertThisInitialized(C),"graphic",()=>C._graphicChanged())]);return C}a._inheritsLoose(k,z);var v=k.prototype;v.destroy=function(){this.graphic=this._attachmentLayer=
null};v.castAbilities=function(x){return{...m,...x}};v.getAttachments=function(){var x=a._asyncToGenerator(function*(){const {_attachmentLayer:C,attachmentInfos:A}=this;if(!C||"function"!==typeof C.queryAttachments)throw new q("invalid-layer","getAttachments(): A valid layer is required.");const B=this._getFeatureId();var D=new t({objectIds:[B],returnMetadata:!0});const E=[];this._getAttachmentsPromise=D=C.queryAttachments(D).then(G=>G[B]||E).catch(()=>E);this.notifyChange("state");D=yield D;A.removeAll();
D.length&&A.addMany(D);this._getAttachmentsPromise=null;this.notifyChange("state");return D});return function(){return x.apply(this,arguments)}}();v.addAttachment=function(){var x=a._asyncToGenerator(function*(C){const {_attachmentLayer:A,attachmentInfos:B,graphic:D,abilities:E}=this;if(!C)throw new q("invalid-attachment","addAttachment(): An attachment is required.",{attachment:C});if(!E.operations.add)throw new q("invalid-abilities","addAttachment(): add abilities are required.");if(!A||"function"!==
typeof A.addAttachment)throw new q("invalid-layer","addAttachment(): A valid layer is required.");C=yield A.addAttachment(D,C).then(G=>this._queryAttachment(G.objectId));B.add(C);return C});return function(C){return x.apply(this,arguments)}}();v.deleteAttachment=function(){var x=a._asyncToGenerator(function*(C){const {_attachmentLayer:A,attachmentInfos:B,graphic:D,abilities:E}=this;if(!C)throw new q("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:C});
if(!E.operations.delete)throw new q("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!A||"function"!==typeof A.deleteAttachments)throw new q("invalid-layer","deleteAttachment(): A valid layer is required.");const G=yield A.deleteAttachments(D,[C.id]).then(()=>C);B.remove(G);return G});return function(C){return x.apply(this,arguments)}}();v.updateAttachment=function(){var x=a._asyncToGenerator(function*(C,A=this.activeAttachmentInfo){const {_attachmentLayer:B,attachmentInfos:D,
graphic:E,abilities:G}=this;if(!C)throw new q("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:C});if(!A)throw new q("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:A});if(!G.operations.update)throw new q("invalid-abilities","updateAttachment(): Update abilities are required.");const K=D.findIndex(M=>M===A);if(!B||"function"!==typeof B.updateAttachment)throw new q("invalid-layer","updateAttachment(): A valid layer is required.");
C=yield B.updateAttachment(E,A.id,C).then(M=>this._queryAttachment(M.objectId));D.splice(K,1,C);return C});return function(C){return x.apply(this,arguments)}}();v._queryAttachment=function(){var x=a._asyncToGenerator(function*(C){if(!C)throw new q("invalid-attachment-id","Could not query attachment.");const {_attachmentLayer:A}=this,B=this._getFeatureId();C=new t({objectIds:[B],attachmentsWhere:`AttachmentId=${C}`,returnMetadata:!0});return A.queryAttachments(C).then(D=>D[B][0])});return function(C){return x.apply(this,
arguments)}}();v._getFeatureId=function(){const {_attachmentLayer:x,graphic:C}=this;if(!x||!C)return null;const {objectIdField:A}=x,{attributes:B}=C;return B&&B[A]};v._graphicChanged=function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))};v._setAttachmentLayer=function(){var {graphic:x}=this;this._attachmentLayer=(x=h.getSourceLayer(x))?"scene"===x.type&&f.isSome(x.associatedLayer)?x.associatedLayer:x:null};a._createClass(k,[{key:"state",get:function(){return this._getAttachmentsPromise?
"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}}]);return k}(y.HandleOwner);p.__decorate([e.property()],r.prototype,"abilities",void 0);p.__decorate([g.cast("abilities")],r.prototype,"castAbilities",null);p.__decorate([e.property()],r.prototype,"activeAttachmentInfo",void 0);p.__decorate([e.property({readOnly:!0,type:n})],r.prototype,"attachmentInfos",void 0);p.__decorate([e.property({type:b})],
r.prototype,"graphic",void 0);p.__decorate([e.property()],r.prototype,"mode",void 0);p.__decorate([e.property({readOnly:!0})],r.prototype,"state",null);p.__decorate([e.property({readOnly:!0})],r.prototype,"supportsResizeAttachments",null);return r=p.__decorate([c.subclass("esri.widgets.Attachments.AttachmentsViewModel")],r)})},"esri/widgets/Feature/support/featureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../intl ../../../core/Logger ../../../core/maybe ../../../core/string ../../../intl/date ../../../intl/number ../../../layers/support/fieldUtils ../../../popup/support/FieldInfoFormat ../../../support/arcadeOnDemand".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){function d(){d=p._asyncToGenerator(function*(aa,W){return"function"===typeof aa?aa.call(null,W):aa});return d.apply(this,arguments)}function c(aa){return P.test(aa)}function u(aa,W){if(!c(W)||!aa)return null;const U=W.replace(P,"").toLowerCase();let X;aa.some(T=>T.name.toLowerCase()===U?(X=T,!0):!1);return X}function t(aa,W){return(W=h(W,aa))?W.name:aa}function h(aa,W){return aa&&"function"===typeof aa.getField?aa.getField(W):null}function m({formattedAttributes:aa,
template:W,fieldInfoMap:U}){return`${y.replace(y.replace(W,X=>{{const T=U.get(X.toLowerCase());X=`{${T&&T.fieldName||X}}`}return X}),aa).replace(N,"")}`.trim()}function n(aa,W,U=!1){const X=W[aa];"string"===typeof X&&(U=(U?encodeURIComponent(X):X).replace(S,"%27"),W[aa]=U)}function z(aa,W=!1){const U={...aa};Object.keys(U).forEach(X=>n(X,U,W));return U}function k(aa,W){return aa.replace(R,(U,X,T)=>(U=h(W,T))?`{${U.name}}`:X)}function v(aa,W,U){return(aa=k(aa,U))?aa.replace(ca,(X,T,Y)=>{T=`${T||Y}`.trim();
return y.replace(X,z(W,T&&"{"!==T[0]))}):aa}function x(aa,W){var U=W.fieldName,X=C(W.fieldInfos,U),T=null==X?void 0:X.clone();X=W.preventPlacesFormatting;W=W.layer;U=h(W,U);if(T&&"date"===(null==U?void 0:U.type)){U=T.format||new l;U.dateFormat=U.dateFormat||"short-date-short-time";var Y;if(!(Y="feature"===(null==W?void 0:W.type)&&W.datesInUnknownTimezone)){if(Y=!(null==W||!W.layer))Y=W.layer,Y="map-image"===(null==Y?void 0:Y.type);Y=Y&&W.layer.datesInUnknownTimezone}U.dateTimeFormatOptions=Y?{timeZone:"UTC"}:
null;T.format=U}T=T&&T.format;"string"!==typeof aa||!T||null!=T.dateFormat||null==T.places&&null==T.digitSeparator||(W=Number(aa),isNaN(W)||(aa=W));return"string"===typeof aa||null==aa||null==T?aa:X?w.formatNumber(aa,{...w.convertNumberFormatToIntlOptions(T),minimumFractionDigits:0,maximumFractionDigits:20}):T.format(aa)}function C(aa,W){if(aa&&aa.length&&W){var U=W.toLowerCase(),X=void 0;aa.some(T=>T.fieldName&&T.fieldName.toLowerCase()===U?(X=T,!0):!1);return X}}function A({fieldName:aa,graphic:W,
layer:U}){if(O(aa)||!U||"function"!==typeof U.getFeatureType)return null;const {typeIdField:X}=U;return X&&aa===X?(aa=U.getFeatureType(W))?aa.name:null:null}function B({fieldName:aa,value:W,graphic:U,layer:X}){return O(aa)||!X||"function"!==typeof X.getFieldDomain?null:(aa=X.getFieldDomain(aa,{feature:U}))&&"coded-value"===aa.type?aa.getName(W):null}function D(aa){return"string"===typeof aa?aa.replace(Q,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):aa}function E(aa){const {value:W,fieldName:U,fieldInfos:X,
fieldInfoMap:T,layer:Y,graphic:ea}=aa;return null==W?"":(aa=B({fieldName:U,value:W,graphic:ea,layer:Y}))||(aa=A({fieldName:U,graphic:ea,layer:Y}))?aa:T.get(U.toLowerCase())?x(W,{fieldInfos:X,fieldName:U,layer:Y}):(aa=Y&&Y.fieldsIndex)&&aa.isDateField(U)?f.formatDate(W,Z):D(W)}function G(aa,W){return K.apply(this,arguments)}function K(){K=p._asyncToGenerator(function*(aa,W){var U,X;const {layer:T,graphic:Y,outFields:ea,objectIds:ia,returnGeometry:la,spatialReference:pa}=aa;aa=ia[0];if("number"!==typeof aa&&
"string"!==typeof aa)return L.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:T,graphic:Y,objectId:aa,requiredFields:ea}),null;if(null==(U=T.capabilities)||null==(X=U.operations)||!X.supportsQuery)return L.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:T,graphic:Y,requiredFields:ea,returnGeometry:la}),null;U=T.createQuery();U.objectIds=ia;U.outFields=null!=ea&&ea.length?ea:[T.objectIdField];U.returnGeometry=
!!la;U.returnZ=!!la;U.returnM=!!la;U.outSpatialReference=pa;return(yield T.queryFeatures(U,W)).features[0]});return K.apply(this,arguments)}function M(aa){return H.apply(this,arguments)}function H(){H=p._asyncToGenerator(function*(aa){var W;if(null==(W=aa.expressionInfos)||!W.length)return!1;W=yield g.loadArcade();({arcadeUtils:{hasGeometryFunctions:W}}=W);return W(aa)});return H.apply(this,arguments)}function J(){J=p._asyncToGenerator(function*({graphic:aa,popupTemplate:W,layer:U,spatialReference:X},
T){if(U&&W&&("function"===typeof U.load&&(yield U.load(T)),aa.attributes)){var Y=aa.attributes[U.objectIdField];if(null!=Y){Y=[Y];var ea=yield W.getRequiredFields(U.fieldsIndex),ia=e.featureHasFields(ea,aa);ea=ia?[]:ea;W=W.returnGeometry||(yield M(W));if(!ia||W)if(U=yield G({layer:U,graphic:aa,outFields:ea,objectIds:Y,returnGeometry:W,spatialReference:X},T))U.geometry&&(aa.geometry=U.geometry),U.attributes&&(aa.attributes={...aa.attributes,...U.attributes})}}});return J.apply(this,arguments)}function O(aa=
""){return aa?-1!==aa.indexOf("relationships/"):!1}function I({attributes:aa,graphic:W,relatedInfo:U}){aa&&W&&U&&Object.keys(W.attributes).forEach(X=>{var T={layerId:U.relation.id.toString(),fieldName:X};aa[T?`${"relationships/"}${T.layerId}/${T.fieldName}`:""]=W.attributes[X]})}function F(aa,W){aa&&W&&(W.relatedFeatures&&W.relatedFeatures&&W.relatedFeatures.forEach(U=>I({attributes:aa,graphic:U,relatedInfo:W})),W.relatedStatsFeatures&&W.relatedStatsFeatures&&W.relatedStatsFeatures.forEach(U=>I({attributes:aa,
graphic:U,relatedInfo:W})))}const L=r.getLogger("esri.widgets.Feature.support.featureUtils"),N=/href=(""|'')/gi,R=/(\{([^\{\r\n]+)\})/g,S=/'/g,P=/^\s*expression\//i,Q=/(\n)/gi,V=/[\u00A0-\u9999<>&]/gim,ca=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,ba=/^(?:mailto:|tel:)/,Z=f.convertDateFormatToIntlOptions("short-date-short-time"),ha=aa=>{if(!aa)return!1;aa=aa.toUpperCase();return-1<aa.indexOf("CURRENT_TIMESTAMP")||-1<aa.indexOf("CURRENT_DATE")||-1<aa.indexOf("CURRENT_TIME")},fa=({layer:aa,method:W,query:U,
definitionExpression:X})=>{var T,Y;null!=(T=aa.capabilities)&&null!=(Y=T.query)&&Y.supportsCacheHint&&"attachments"!==W&&(aa=q.isSome(U.where)&&U.where,W=q.isSome(U.geometry)&&U.geometry,ha(X)||ha(aa)||"extent"===(null==W?void 0:W.type)||"tile"===U.resultType||(U.cacheHint=!0))};a.applyTextFormattingHTML=D;a.createfieldInfoMap=function(aa,W){const U=new Map;aa&&aa.forEach(X=>{const T=t(X.fieldName,W);X.fieldName=T;U.set(T.toLowerCase(),X)});return U};a.fixTokens=k;a.formatAttributes=function({fieldInfos:aa,
attributes:W,layer:U,graphic:X,fieldInfoMap:T,relatedInfos:Y}){const ea={...W};null==Y?void 0:Y.forEach(ia=>F(ea,ia));Object.keys(ea).forEach(ia=>{ea[ia]=E({fieldName:ia,fieldInfos:aa,fieldInfoMap:T,layer:U,value:ea[ia],graphic:X})});return ea};a.formatEditInfo=function(aa,W){const {creatorField:U,creationDateField:X,editorField:T,editDateField:Y}=aa;if(W){aa=W[Y];if("number"===typeof aa)return W=W[T],{type:"edit",date:f.formatDate(aa,Z),user:W};aa=W[X];return"number"===typeof aa?(W=W[U],{type:"create",
date:f.formatDate(aa,Z),user:W}):null}};a.formatValueToFieldInfo=x;a.getAllFieldInfos=function(aa){const W=[];if(!aa)return W;const {fieldInfos:U,content:X}=aa;U&&W.push(...U);if(!X||!Array.isArray(X))return W;X.forEach(T=>{"fields"===T.type&&(T=T&&T.fieldInfos)&&W.push(...T)});return W};a.getFieldInfo=C;a.getFieldInfoLabel=function(aa,W){return(W=u(W,null==aa?void 0:aa.fieldName))?W.title||null:aa?aa.label||aa.fieldName:null};a.getFixedFieldName=t;a.getFixedFieldNames=function(aa,W){return aa&&aa.map(U=>
t(U,W))};a.getSourceLayer=function(aa){if(!q.isNone(aa))return aa.get("sourceLayer")||aa.get("layer")};a.graphicCallback=function(aa,W){return d.apply(this,arguments)};a.htmlEntities=function(aa){return aa.replace(V,W=>`&#${W.charCodeAt(0)};`)};a.isExpressionField=c;a.isRelatedField=O;a.preLayerQueryCallback=({query:aa,layer:W,method:U})=>{fa({layer:W,method:U,query:aa,definitionExpression:`${W.definitionExpression} ${W.serviceDefinitionExpression}`})};a.preRequestCallback=({queryPayload:aa,layer:W,
method:U})=>{fa({layer:W,method:U,query:aa,definitionExpression:`${W.definitionExpression} ${W.serviceDefinitionExpression}`})};a.queryUpdatedFeature=function(aa,W){return J.apply(this,arguments)};a.shouldOpenInNewTab=function(aa=""){if(aa)return!ba.test(aa.trim().toLowerCase())};a.substituteAttributes=m;a.substituteFieldsInLinksAndAttributes=function({attributes:aa,globalAttributes:W,layer:U,text:X,expressionAttributes:T,fieldInfoMap:Y}){return X?m({formattedAttributes:W,template:v(X,{...W,...T,
...aa},U),fieldInfoMap:Y}):""};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["exports","../../../assets"],function(a,p){a.getIconPath=function(b){const r=p.getAssetUrl("esri/themes/base/images/files/");return b?"text/plain"===b?`${r}text-32.svg`:"application/pdf"===b?`${r}pdf-32.svg`:"text/csv"===b?`${r}csv-32.svg`:"application/gpx+xml"===b?`${r}gpx-32.svg`:"application/x-dwf"===b?`${r}cad-32.svg`:"application/postscript"===
b||"application/json"===b||"text/xml"===b||"model/vrml"===b?`${r}code-32.svg`:"application/x-zip-compressed"===b||"application/x-7z-compressed"===b||"application/x-gzip"===b||"application/x-tar"===b||"application/x-gtar"===b||"application/x-bzip2"===b||"application/gzip"===b||"application/x-compress"===b||"application/x-apple-diskimage"===b||"application/x-rar-compressed"===b||"application/zip"===b?`${r}zip-32.svg`:-1!==b.indexOf("image/")?`${r}image-32.svg`:-1!==b.indexOf("audio/")?`${r}sound-32.svg`:
-1!==b.indexOf("video/")?`${r}video-32.svg`:-1!==b.indexOf("msexcel")||-1!==b.indexOf("ms-excel")||-1!==b.indexOf("spreadsheetml")?`${r}excel-32.svg`:-1!==b.indexOf("msword")||-1!==b.indexOf("ms-word")||-1!==b.indexOf("wordprocessingml")?`${r}word-32.svg`:-1!==b.indexOf("powerpoint")||-1!==b.indexOf("presentationml")?`${r}report-32.svg`:`${r}generic-32.svg`:`${r}generic-32.svg`};a.isSupportedImage=function(b){b=b.toLowerCase();return"image/bmp"===b||"image/emf"===b||"image/exif"===b||"image/gif"===
b||"image/x-icon"===b||"image/jpeg"===b||"image/png"===b||"image/tiff"===b||"image/x-wmf"===b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../Attachments/AttachmentsViewModel".split(" "),
function(a,p,b,r,q,y,f,w){r=function(e){function l(g){g=e.call(this,g)||this;g.description=null;g.title=null;return g}a._inheritsLoose(l,e);return l}(w);p.__decorate([b.property()],r.prototype,"description",void 0);p.__decorate([b.property()],r.prototype,"title",void 0);return r=p.__decorate([f.subclass("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],r)})},"esri/widgets/Feature/support/FeatureElementInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../Widget ../../support/Heading ../../support/widgetUtils ../../support/jsxFactory".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){r=function(d){function c(t,h){t=d.call(this,t,h)||this;t.description=null;t.headingLevel=2;t.title=null;return t}a._inheritsLoose(c,d);var u=c.prototype;u.render=function(){return g.tsx("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())};u.renderTitle=function(){const {title:t}=this;return t?g.tsx(e.Heading,{level:this.headingLevel,class:"esri-feature-element-info__title"},t):null};u.renderDescription=function(){const {description:t}=
this;return t?g.tsx("div",{key:"description",class:"esri-feature-element-info__description"},t):null};return c}(w);p.__decorate([b.property()],r.prototype,"description",void 0);p.__decorate([b.property()],r.prototype,"headingLevel",void 0);p.__decorate([b.property()],r.prototype,"title",void 0);return r=p.__decorate([f.subclass("esri.widgets.Feature.support.FeatureElementInfo")],r)})},"esri/widgets/support/Heading":function(){define("exports ../../core/mathUtils ./widgetUtils ../../core/has ../../core/Logger ./jsxFactory".split(" "),
function(a,p,b,r,q,y){const f={heading:"esri-widget__heading"};a.CSS=f;a.Heading=function(w,e){const l=`h${p.clamp(Math.ceil(w.level),1,6)}`;delete w.level;return y.tsx(l,{...w,class:b.classes(f.heading,w.class)},e)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureContent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/aliasOf ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent/FeatureContentViewModel ./support/featureUtils ../support/widget ../support/jsxFactory".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){r=function(u){function t(m,n){m=u.call(this,m,n)||this;m.creator=null;m.graphic=null;m.viewModel=null;m._addTargetToAnchors=z=>{Array.from(z.querySelectorAll("a")).forEach(k=>{g.shouldOpenInNewTab(k.href)&&!k.hasAttribute("target")&&k.setAttribute("target","_blank")})};return m}a._inheritsLoose(t,u);var h=t.prototype;h.renderLoading=function(){return c.tsx("div",{class:"esri-feature-content__loader-container",key:"loader"},c.tsx("div",{class:"esri-feature-content__loader"}))};
h.renderCreated=function(){var m;const n=null==(m=this.viewModel)?void 0:m.created;return n?n instanceof HTMLElement?c.tsx("div",{key:n,bind:n,afterCreate:this._attachToNode}):d.isWidget(n)?c.tsx("div",{key:n},!n.destroyed&&n.render()):c.tsx("div",{key:n,innerHTML:n,afterCreate:this._addTargetToAnchors}):null};h.render=function(){var m;const n=null==(m=this.viewModel)?void 0:m.state;return c.tsx("div",{class:"esri-feature-content"},"loading"===n?this.renderLoading():this.renderCreated())};h._attachToNode=
function(m){m.appendChild(this)};return t}(e);p.__decorate([b.aliasOf("viewModel.creator")],r.prototype,"creator",void 0);p.__decorate([b.aliasOf("viewModel.graphic")],r.prototype,"graphic",void 0);p.__decorate([f.property({type:l})],r.prototype,"viewModel",void 0);return r=p.__decorate([w.subclass("esri.widgets.Feature.FeatureContent")],r)})},"esri/widgets/Feature/FeatureContent/FeatureContentViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../support/featureUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){r=function(c){function u(h){var m=c.call(this,h)||this;m._loadingPromise=null;m.created=null;m.creator=null;m.destroyer=null;m.graphic=null;m.handles.add(y.init(a._assertThisInitialized(m),"creator",n=>{m._destroyContent();m._createContent(n)}));return m}a._inheritsLoose(u,c);var t=u.prototype;t.destroy=function(){this._destroyContent()};t._destroyContent=function(){const {created:h,graphic:m,destroyer:n}=this;h&&(d.graphicCallback(n,{graphic:m}).catch(()=>null),
this._set("created",null))};t._createContent=function(){var h=a._asyncToGenerator(function*(m){var {graphic:n}=this;this._loadingPromise=m=d.graphicCallback(m,{graphic:n}).catch(()=>null);this.notifyChange("state");n=yield m;m===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",n))});return function(m){return h.apply(this,arguments)}}();a._createClass(u,[{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}}]);return u}(q.HandleOwnerMixin(r));
p.__decorate([f.property({readOnly:!0})],r.prototype,"created",void 0);p.__decorate([f.property()],r.prototype,"creator",void 0);p.__decorate([f.property()],r.prototype,"destroyer",void 0);p.__decorate([f.property({type:b})],r.prototype,"graphic",void 0);p.__decorate([f.property({readOnly:!0})],r.prototype,"state",null);return r=p.__decorate([g.subclass("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],r)})},"esri/widgets/Feature/FeatureFields":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureFields/FeatureFieldsViewModel ./support/FeatureElementInfo ../support/uriUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){q=function(m){function n(k,v){k=m.call(this,k,v)||this;k._featureElementInfo=null;k.attributes=null;k.description=null;k.expressionInfos=null;k.fieldInfos=null;k.title=null;k.viewModel=new g;k.messages=null;k.messagesURIUtils=null;return k}a._inheritsLoose(n,m);var z=n.prototype;z.initialize=function(){this._featureElementInfo=new d;b.init(this,["viewModel.description","viewModel.title"],()=>this._setupFeatureElementInfo())};z.destroy=function(){this._featureElementInfo.destroy()};
z.renderFieldInfo=function(k,v){var {attributes:x}=this.viewModel;const C=k.fieldName,A=k.label||C;x=x?null==x[C]?"":x[C]:"";k=!(!k.format||!k.format.dateFormat);x="number"!==typeof x||k?c.autoLink(this.messagesURIUtils,x):this._forceLTR(x);k={["esri-feature-fields__field-data--date"]:k};return h.tsx("tr",{key:`fields-element-info-row-${C}-${v}`},h.tsx("th",{key:`fields-element-info-row-header-${C}-${v}`,class:"esri-feature-fields__field-header",innerHTML:A}),h.tsx("td",{key:`fields-element-info-row-data-${C}-${v}`,
class:this.classes("esri-feature-fields__field-data",k),innerHTML:x}))};z.renderFields=function(){const {formattedFieldInfos:k}=this.viewModel;return null!=k&&k.length?h.tsx("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},h.tsx("tbody",null,k.map((v,x)=>this.renderFieldInfo(v,x)))):null};z.render=function(){var k;return h.tsx("div",{class:"esri-feature-fields"},null==(k=this._featureElementInfo)?void 0:k.render(),this.renderFields())};z._setupFeatureElementInfo=function(){const {description:k,
title:v}=this;this._featureElementInfo.set({description:k,title:v})};z._forceLTR=function(k){return`&lrm;${k}`};return n}(l);p.__decorate([r.aliasOf("viewModel.attributes")],q.prototype,"attributes",void 0);p.__decorate([r.aliasOf("viewModel.description")],q.prototype,"description",void 0);p.__decorate([r.aliasOf("viewModel.expressionInfos")],q.prototype,"expressionInfos",void 0);p.__decorate([r.aliasOf("viewModel.fieldInfos")],q.prototype,"fieldInfos",void 0);p.__decorate([r.aliasOf("viewModel.title")],
q.prototype,"title",void 0);p.__decorate([w.property({type:g})],q.prototype,"viewModel",void 0);p.__decorate([w.property(),t.messageBundle("esri/widgets/Feature/t9n/Feature")],q.prototype,"messages",void 0);p.__decorate([w.property(),t.messageBundle("esri/widgets/support/t9n/uriUtils")],q.prototype,"messagesURIUtils",void 0);return q=p.__decorate([e.subclass("esri.widgets.Feature.FeatureFields")],q)})},"esri/widgets/Feature/FeatureFields/FeatureFieldsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../support/featureUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){b=function(d){function c(u){u=d.call(this,u)||this;u.attributes=null;u.expressionInfos=null;u.description=null;u.fieldInfos=null;u.title=null;return u}a._inheritsLoose(c,d);a._createClass(c,[{key:"formattedFieldInfos",get:function(){const {expressionInfos:u,fieldInfos:t}=this,h=[];null==t?void 0:t.forEach(m=>{if(!m.hasOwnProperty("visible")||m.visible)m=m.clone(),m.label=g.getFieldInfoLabel(m,u),h.push(m)});return h}}]);return c}(b);p.__decorate([r.property()],b.prototype,
"attributes",void 0);p.__decorate([r.property({type:[e]})],b.prototype,"expressionInfos",void 0);p.__decorate([r.property()],b.prototype,"description",void 0);p.__decorate([r.property({type:[l]})],b.prototype,"fieldInfos",void 0);p.__decorate([r.property({readOnly:!0})],b.prototype,"formattedFieldInfos",null);p.__decorate([r.property()],b.prototype,"title",void 0);return b=p.__decorate([w.subclass("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],b)})},"esri/widgets/support/uriUtils":function(){define(["exports",
"../../core/string"],function(a,p){function b(q){let y=null;r.some(f=>{f.pattern.test(q)&&(y=f);return!!y});return y}const r=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];a.autoLink=function(q,y){if("string"!==typeof y||!y)return y;const f=b(y);if(!f)return y;const w=y.match(f.pattern);
q=p.replace(p.replace(f.label,{messages:q,hierPart:w&&w[2]}),{appName:f.appName});return y.replace(f.pattern,`<a${f.target?` target="${f.target}"`:""} href="$1"${"_blank"===f.target?' rel\x3d"noreferrer"':""}>${q}</a>`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureMedia":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/events ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n){y=function(z){function k(x,C){x=z.call(this,x,C)||this;x._refreshTimer=null;x._refreshIntervalInfo=null;x._featureElementInfo=null;x.attributes=null;x.activeMediaInfoIndex=null;x.description=null;x.fieldInfoMap=null;x.layer=null;x.mediaInfos=null;x.popupTemplate=null;x.relatedInfos=null;x.title=null;x.viewModel=new d;x.messages=null;return x}a._inheritsLoose(k,z);var v=k.prototype;v.initialize=function(){this._featureElementInfo=new c;this.own(r.init(this,
["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],()=>this._setupMediaRefreshTimer()),r.init(this,["viewModel.description","viewModel.title"],()=>this._setupFeatureElementInfo()))};v.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo.destroy()};v.render=function(){var x;return n.tsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(x=this._featureElementInfo)?void 0:x.render(),this.renderMedia())};v.renderMedia=function(){const {formattedMediaInfoCount:x}=
this.viewModel;return x?n.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null};v.renderImageMediaInfo=function(x){var {_refreshIntervalInfo:C}=this;const {activeMediaInfoIndex:A,formattedMediaInfoCount:B}=this.viewModel,{value:D,refreshInterval:E,altText:G,title:K,type:M}=x,{sourceURL:H,linkURL:J}=D;x=u.shouldOpenInNewTab(J)?"_blank":"_self";const O="_blank"===x?"noreferrer":
"";C=E?C:null;C=n.tsx("img",{alt:G||K,key:`media-${M}-${A}-${B}-${C?C.timestamp:0}`,src:C?C.sourceURL:H});return(x=J?n.tsx("a",{title:K,href:J,rel:O,target:x},C):null)?x:C};v.renderChartMediaInfo=function(x){const {activeMediaInfoIndex:C,formattedMediaInfoCount:A}=this.viewModel;return n.tsx("div",{key:`media-${x.type}-${C}-${A}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};v.renderMediaInfoType=function(){const {activeMediaInfo:x}=this.viewModel;return x?
"image"===x.type?this.renderImageMediaInfo(x):-1!==x.type.indexOf("chart")?this.renderChartMediaInfo(x):null:null};v.renderMediaInfo=function(){var {activeMediaInfo:x}=this.viewModel;if(!x)return null;const C=x.title?n.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:x.title}):null;x=x.caption?n.tsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:x.caption}):null;return n.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},
n.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),C,x)};v.renderMediaPageButton=function(x){if(2>this.viewModel.formattedMediaInfoCount)return null;const C=(x="previous"===x)?this.messages.previous:this.messages.next,A=x?this.classes("esri-feature-media__button","esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),B=x?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):
this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),D=x?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return n.tsx("button",{type:"button",key:x?"media-previous":"media-next",title:C,"aria-label":C,tabIndex:0,class:A,bind:this,onclick:x?this._previous:this._next},n.tsx("span",
{"aria-hidden":"true",class:B}),n.tsx("span",{"aria-hidden":"true",class:D}))};v._setupFeatureElementInfo=function(){const {description:x,title:C}=this;this._featureElementInfo.set({description:x,title:C})};v._next=function(){this.viewModel.next()};v._previous=function(){this.viewModel.previous()};v._getChartDependencies=function(){var x=a._asyncToGenerator(function*(C){const A=yield t.loadChartsModule(),{activeMediaInfo:B}=this.viewModel;this._renderChart({chartDiv:C,mediaInfo:B,chartsModule:A})});
return function(C){return x.apply(this,arguments)}}();v._handleMediaKeyup=function(x){const C=b.eventKey(x);"ArrowLeft"===C&&(x.stopPropagation(),this.viewModel.previous());"ArrowRight"===C&&(x.stopPropagation(),this.viewModel.next())};v._renderChart=function(x){const {chartsModule:C,chartDiv:A,mediaInfo:B}=x,{value:D,type:E}=B,{am4core:G}=C,K=t.getColorSet(G);h.isDarkTheme()&&G.useTheme(C.am4themes_dark);G.useTheme(C.am4themes_animated);G.useTheme(function(M){M instanceof G.ColorSet&&K&&(M.list=
K)});x="pie-chart"===E?this._createPieChart(x):this._createXYChart(x);A.setAttribute("aria-label",B.altText||B.title);x.data=D.series.map(M=>({tooltip:M.tooltip,value:M.value})).filter(M=>"pie-chart"===E?0<M.value:!0)};v._customizeChartTooltip=function(x,C){x.label.wrap=!0;x.label.maxWidth=200;x.autoTextColor=!1;x.getFillFromObject=!1;x.label.fill=C.color("#ffffff");x.background.fill=C.color({r:0,g:0,b:0,a:.7})};v._createPieChart=function(x){const {chartDiv:C,chartsModule:A}=x,{am4core:B,am4charts:D}=
A;x=B.create(C,D.PieChart);x.rtl=h.isRTL(this.container);const E=x.series.push(new D.PieSeries);E.labels.template.disabled=!0;E.ticks.template.disabled=!0;E.dataFields.value="value";E.dataFields.category="tooltip";this._customizeChartTooltip(E.tooltip,B);return x};v._getMinSeriesValue=function(x){let C=0;x.forEach(A=>C=Math.min(A.value,C));return C};v._createColumnChart=function(x,C){const {chartsModule:A,mediaInfo:B}=C;({value:C}=B);const {am4core:D,am4charts:E}=A,G=x.xAxes.push(new E.CategoryAxis);
G.dataFields.category="tooltip";G.renderer.labels.template.disabled=!0;this._customizeChartTooltip(G.tooltip,D);G.tooltip.events.on("sizechanged",()=>{G.tooltip.dy=-G.tooltip.contentHeight});var K=x.yAxes.push(new E.ValueAxis);const M=K.renderer.labels.template;K.renderer.minLabelPosition=.05;K.renderer.maxLabelPosition=.95;K.min=this._getMinSeriesValue(C.series);this._customizeChartTooltip(K.tooltip,D);M.wrap=!0;K=x.series.push(new E.ColumnSeries);K.dataFields.valueY="value";K.dataFields.categoryX=
"tooltip";x.cursor=new E.XYCursor;15<C.series.length&&(x.scrollbarX=new D.Scrollbar)};v._createBarChart=function(x,C){const {chartsModule:A,mediaInfo:B}=C;({value:C}=B);const {am4core:D,am4charts:E}=A,G=x.yAxes.push(new E.CategoryAxis);G.dataFields.category="tooltip";G.renderer.inversed=!0;G.renderer.labels.template.disabled=!0;this._customizeChartTooltip(G.tooltip,D);G.tooltip.events.on("sizechanged",()=>{G.tooltip.dx=G.tooltip.contentWidth});var K=x.xAxes.push(new E.ValueAxis);const M=K.renderer.labels.template;
K.renderer.minLabelPosition=.05;K.renderer.maxLabelPosition=.95;K.min=this._getMinSeriesValue(C.series);this._customizeChartTooltip(K.tooltip,D);M.wrap=!0;K=x.series.push(new E.ColumnSeries);K.dataFields.valueX="value";K.dataFields.categoryY="tooltip";x.cursor=new E.XYCursor;15<C.series.length&&(x.scrollbarY=new D.Scrollbar)};v._createLineChart=function(x,C){const {chartsModule:A,mediaInfo:B}=C;({value:C}=B);const {am4core:D,am4charts:E}=A,G=x.xAxes.push(new E.CategoryAxis);G.dataFields.category=
"tooltip";G.renderer.labels.template.disabled=!0;this._customizeChartTooltip(G.tooltip,D);G.tooltip.events.on("sizechanged",()=>{G.tooltip.dy=-G.tooltip.contentHeight});var K=x.yAxes.push(new E.ValueAxis);const M=K.renderer.labels.template;K.renderer.minLabelPosition=.05;K.renderer.maxLabelPosition=.95;K.min=this._getMinSeriesValue(C.series);this._customizeChartTooltip(K.tooltip,D);M.wrap=!0;K=x.series.push(new E.LineSeries);K.dataFields.categoryX="tooltip";K.dataFields.valueY="value";x.cursor=new E.XYCursor;
15<C.series.length&&(x.scrollbarX=new D.Scrollbar)};v._createXYChart=function(x){const {chartDiv:C,chartsModule:A,mediaInfo:B}=x,{type:D}=B,{am4core:E,am4charts:G}=A,K=E.create(C,G.XYChart);K.rtl=h.isRTL(this.container);"column-chart"===D&&this._createColumnChart(K,x);"bar-chart"===D&&this._createBarChart(K,x);"line-chart"===D&&this._createLineChart(K,x);return K};v._clearMediaRefreshTimer=function(){const {_refreshTimer:x}=this;x&&(clearTimeout(x),this._refreshTimer=null)};v._updateMediaInfoTimestamp=
function(x){const C=Date.now();this._refreshIntervalInfo={timestamp:C,sourceURL:this._getImageSource(x,C)};this.scheduleRender()};v._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:x}=this.viewModel;x&&"image"===x.type&&x.refreshInterval&&this._setRefreshTimeout(x)};v._setRefreshTimeout=function(x){const {refreshInterval:C,value:A}=x;C&&(x=6E4*C,this._updateMediaInfoTimestamp(A.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(A.sourceURL)},
x))};v._getImageSource=function(x,C){const A=-1!==x.indexOf("?")?"\x26":"?",[B,D=""]=x.split("#");return`${B}${A}timestamp=${C}${D?"#":""}${D}`};return k}(g);p.__decorate([q.aliasOf("viewModel.attributes")],y.prototype,"attributes",void 0);p.__decorate([q.aliasOf("viewModel.activeMediaInfoIndex")],y.prototype,"activeMediaInfoIndex",void 0);p.__decorate([q.aliasOf("viewModel.description")],y.prototype,"description",void 0);p.__decorate([q.aliasOf("viewModel.fieldInfoMap")],y.prototype,"fieldInfoMap",
void 0);p.__decorate([q.aliasOf("viewModel.layer")],y.prototype,"layer",void 0);p.__decorate([q.aliasOf("viewModel.mediaInfos")],y.prototype,"mediaInfos",void 0);p.__decorate([q.aliasOf("viewModel.popupTemplate")],y.prototype,"popupTemplate",void 0);p.__decorate([q.aliasOf("viewModel.relatedInfos")],y.prototype,"relatedInfos",void 0);p.__decorate([q.aliasOf("viewModel.title")],y.prototype,"title",void 0);p.__decorate([e.property({type:d})],y.prototype,"viewModel",void 0);p.__decorate([e.property(),
m.messageBundle("esri/widgets/Feature/t9n/Feature")],y.prototype,"messages",void 0);return y=p.__decorate([l.subclass("esri.widgets.Feature.FeatureMedia")],y)})},"esri/widgets/Feature/FeatureMedia/FeatureMediaViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){b=function(c){function u(h){h=c.call(this,h)||this;h.activeMediaInfoIndex=0;h.attributes=null;h.description=null;h.fieldInfoMap=null;h.formattedAttributes=null;h.expressionAttributes=null;h.layer=null;h.mediaInfos=null;h.popupTemplate=null;h.relatedInfos=null;h.title=null;return h}a._inheritsLoose(u,c);var t=u.prototype;t.setActiveMedia=function(h){this._setContentElementMedia(h)};t.next=function(){this._pageContentElementMedia(1)};t.previous=function(){this._pageContentElementMedia(-1)};
t._setContentElementMedia=function(h){const {formattedMediaInfoCount:m}=this;this.activeMediaInfoIndex=(h+m)%m};t._pageContentElementMedia=function(h){const {activeMediaInfoIndex:m}=this;this._setContentElementMedia(m+h)};t._formatMediaInfos=function(){const {attributes:h,mediaInfos:m,formattedAttributes:n,expressionAttributes:z,fieldInfoMap:k,layer:v}=this;return null==m?void 0:m.map(x=>{if(!x)return null;x.title=g.substituteFieldsInLinksAndAttributes({attributes:h,fieldInfoMap:k,globalAttributes:n,
expressionAttributes:z,layer:v,text:x.title});x.caption=g.substituteFieldsInLinksAndAttributes({attributes:h,fieldInfoMap:k,globalAttributes:n,expressionAttributes:z,layer:v,text:x.caption});x.altText=g.substituteFieldsInLinksAndAttributes({attributes:h,fieldInfoMap:k,globalAttributes:n,expressionAttributes:z,layer:v,text:x.altText});if("image"===x.type){var {value:C}=x;this._setImageValue({value:C,formattedAttributes:n,layer:v});return x.value.sourceURL?x:void 0}return"pie-chart"===x.type||"line-chart"===
x.type||"column-chart"===x.type||"bar-chart"===x.type?({value:C}=x,this._setChartValue({value:C,chartType:x.type,attributes:h,formattedAttributes:n,layer:v}),x):null}).filter(Boolean)};t._setImageValue=function(h){const {fieldInfoMap:m}=this,{value:n,formattedAttributes:z,layer:k}=h,{linkURL:v,sourceURL:x}=n;x&&(h=g.fixTokens(x,k),n.sourceURL=g.substituteAttributes({formattedAttributes:z,template:h,fieldInfoMap:m}));v&&(h=g.fixTokens(v,k),n.linkURL=g.substituteAttributes({formattedAttributes:z,template:h,
fieldInfoMap:m}))};t._setChartValue=function(h){const {value:m,attributes:n,formattedAttributes:z,chartType:k,layer:v}=h,{popupTemplate:x,relatedInfos:C}=this,{fields:A,normalizeField:B}=m;m.fields=g.getFixedFieldNames(A,v);B&&(m.normalizeField=g.getFixedFieldName(B,v));if(A.some(E=>!!(null!=z[E]||g.isRelatedField(E)&&C.size))){var D=null==x?void 0:x.fieldInfos;A.forEach(E=>{g.isRelatedField(E)?m.series=[...m.series,...this._getRelatedChartInfos({fieldInfos:D,fieldName:E,formattedAttributes:z,chartType:k,
value:m})]:(E=this._getChartOption({value:m,attributes:n,chartType:k,formattedAttributes:z,fieldName:E,fieldInfos:D}),m.series.push(E))})}};t._getRelatedChartInfos=function(h){var m;const {fieldInfos:n,fieldName:z,formattedAttributes:k,chartType:v,value:x}=h,C=[];h=d.getRelatedFieldInfo(z);const {layerId:A,fieldName:B}=h;h=null==(m=this.relatedInfos)?void 0:m.get(A.toString());if(!h)return C;const {relatedFeatures:D,relation:E}=h;if(!E||!D)return C;({cardinality:m}=E);D.forEach(G=>{const {attributes:K}=
G;K&&Object.keys(K).forEach(M=>{M===B&&C.push(this._getChartOption({value:x,attributes:K,formattedAttributes:k,fieldName:z,chartType:v,relatedFieldName:M,fieldInfos:n}))})});return"one-to-many"===m||"many-to-many"===m?C:[C[0]]};t._getTooltip=function({label:h,value:m,chartType:n}){return"pie-chart"===n?h:`${h}: ${m}`};t._getChartOption=function(h){const {value:m,attributes:n,formattedAttributes:z,fieldName:k,relatedFieldName:v,fieldInfos:x,chartType:C}=h;var {layer:A}=this;const {normalizeField:B,
tooltipField:D}=m;var E=B?g.isRelatedField(B)?n[d.getRelatedFieldInfo(B).fieldName]:n[B]:null;h=v&&void 0!==n[v]?n[v]:void 0!==n[k]?n[k]:z[k];const G=void 0===h?null:h&&E?h/E:h;h=new l({value:G});if(g.isRelatedField(k)){var K=d.getRelatedFieldInfo(k);var M=d.getRelatedFieldInfo(D);M=M?M.fieldName:null;A=g.formatValueToFieldInfo(G,{fieldInfos:x,fieldName:v,layer:A,preventPlacesFormatting:!!E});K=K?K.label||K.fieldName:v;h.tooltip=this._getTooltip({label:M&&void 0!==n[M]?n[M]:K,value:A,chartType:C});
return h}E=g.getFieldInfo(x,k);A=g.getFixedFieldName(k,A);E=D&&void 0!==z[D]?z[D]:g.getFieldInfoLabel(E||new e({fieldName:A}),null==(K=this.popupTemplate)?void 0:K.expressionInfos);h.tooltip=this._getTooltip({label:E,value:z[A],chartType:C});return h};a._createClass(u,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);
return u}(b);p.__decorate([r.property()],b.prototype,"activeMediaInfoIndex",void 0);p.__decorate([r.property({readOnly:!0})],b.prototype,"activeMediaInfo",null);p.__decorate([r.property()],b.prototype,"attributes",void 0);p.__decorate([r.property()],b.prototype,"description",void 0);p.__decorate([r.property()],b.prototype,"fieldInfoMap",void 0);p.__decorate([r.property()],b.prototype,"formattedAttributes",void 0);p.__decorate([r.property()],b.prototype,"expressionAttributes",void 0);p.__decorate([r.property({readOnly:!0})],
b.prototype,"formattedMediaInfos",null);p.__decorate([r.property()],b.prototype,"layer",void 0);p.__decorate([r.property({readOnly:!0})],b.prototype,"formattedMediaInfoCount",null);p.__decorate([r.property()],b.prototype,"mediaInfos",void 0);p.__decorate([r.property()],b.prototype,"popupTemplate",void 0);p.__decorate([r.property()],b.prototype,"relatedInfos",void 0);p.__decorate([r.property()],b.prototype,"title",void 0);return b=p.__decorate([w.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],
b)})},"esri/widgets/Feature/support/relatedFeatureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../layers/support/fieldUtils ../../../rest/support/Query ../../../rest/support/RelationshipQuery ../../../rest/support/StatisticDefinition ../../../tasks/QueryTask ./featureUtils".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d){function c(C,A){if(!A.relationships)return null;let B=null;
({relationships:A}=A);A.some(D=>D.id===parseInt(C,10)?(B=D,!0):!1);return B}function u({originRelationship:C,relationships:A,layerId:B}){let D;A&&A.some(E=>{`${E.relatedTableId}`===B&&E.id===C.id&&(D=E);return!!D});return D}function t(C,A){A=A.toLowerCase();for(const B in C)if(B.toLowerCase()===A)return C[B];return null}function h(C,A,B,D){const E=new e;E.outFields=["*"];E.relationshipId="number"===typeof A.id?A.id:parseInt(A.id,10);E.objectIds=[C.attributes[B.objectIdField]];return B.queryRelatedFeatures(E,
D)}function m(C,A,B){let D=0;const E=[];for(;D<A.length;)E.push(`${C} IN (${A.slice(D,B+D)})`),D+=B;return E.join(" OR ")}function n(C,A,B,D){return z.apply(this,arguments)}function z(){z=p._asyncToGenerator(function*(C,A,B,D){var E=B.layerId.toString();const {layerInfo:G,queryTask:K,relation:M,relatedFields:H,outStatistics:J}=A;E=u({originRelationship:M,relationships:G.relationships,layerId:E});if(E.relationshipTableId&&E.keyFieldInRelationshipTable){B=(yield h(C,E,B,D))[C.attributes[B.objectIdField]];
if(!B)return null;const O=B.features.map(I=>I.attributes[G.objectIdField]);if(0<(null==J?void 0:J.length)&&G.supportsStatistics)return A=new w,A.where=m(G.objectIdField,O,1E3),A.outFields=H,A.outStatistics=J,A={features:Promise.resolve(B),statsFeatures:K.execute(A)},y.eachAlways(A)}return(E=null==E?void 0:E.keyField)?(B=f.isNumericField(k(G.fields,E)),C=t(C.attributes,M.keyField),E=B?`${E}=${C}`:`${E}='${C}'`,C=K.execute(new w({where:E,outFields:A.relatedFields}),D),A=A.outStatistics&&0<A.outStatistics.length&&
G.supportsStatistics?K.execute(new w({where:E,outFields:A.relatedFields,outStatistics:A.outStatistics}),D):null,D={features:C},A&&(D.statsFeatures=A),y.eachAlways(D)):null});return z.apply(this,arguments)}function k(C,A){if(null!=C){A=A.toLowerCase();for(const B of C)if(B&&B.name.toLowerCase()===A)return B}return null}const v=q.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),x=new Map;a.createRelatedInfo=function(C,A){if(C=c(C,A)){var B=`${A.url}/${C.relatedTableId}`;A=new g({url:B,
sourceSpatialReference:A.spatialReference});return{url:B,queryTask:A,relation:C,relatedFields:[],outStatistics:[]}}};a.getDestinationRelation=u;a.getRelatedFieldInfo=function(C){if(!d.isRelatedField(C))return null;const [A,B]=C.split("/").slice(1);return{layerId:A,fieldName:B}};a.queryLayerInfos=function({relatedInfos:C,layer:A},B){const D={};C.forEach((E,G)=>{({relation:E}=E);if(!E)throw G=new r("relation-required","A relation is required on a layer to retrieve related records."),v.error(G),G;({relatedTableId:E}=
E);if("number"!==typeof E)throw G=new r("A related table ID is required on a layer to retrieve related records."),v.error(G),G;E=`${A.url}/${E}`;const K=x.get(E),M=K?K:b(E,{query:{f:"json"},signal:B&&B.signal});K||x.set(E,M);D[G]=M});return y.eachAlways(D)};a.queryRelatedFeatures=function({graphic:C,relatedInfos:A,layer:B},D){const E={};A.forEach((G,K)=>{G.layerInfo&&(E[K]=n(C,G,B,D))});return y.eachAlways(E)};a.setRelatedFeatures=function(C,A){if(A&&C){var {features:B,statsFeatures:D}=C;C=B&&B.value;
A.relatedFeatures=C?C.features:[];C=D&&D.value;A.relatedStatsFeatures=C?C.features:[]}};a.updateRelatedInfo=function({relatedInfo:C,fieldName:A,fieldInfo:B}){C.relatedFields.push(A);B.statisticType&&(A=new l({statisticType:B.statisticType,onStatisticField:A,outStatisticFieldName:A}),C.outStatistics.push(A))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/support/chartUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../intl ../../core/has ../../intl/locale".split(" "),
function(a,p,b,r,q,y){function f(c){if(!c)return"en-us";if(l.has(c.toLowerCase()))return c.toLowerCase();{c=c.split("-")[0].toLowerCase();let t=null;for(u of l.keys())if(u.startsWith(c)){t=u;break}var u=t}return u||"en-us"}function w(){w=b._asyncToGenerator(function*(c=y.getLocale()){c=f(c);if(g&&c===d)return g;g=(new Promise(function(u,t){a(["../../chunks/index"],u,t)})).then(function(u){return u.index});d=c;try{const [u,t]=yield Promise.all([g,l.get(d)()]);d===c&&(u.am4core.options.defaultLocale=
t.default);u.am4core.options.suppressWarnings=!0;u.am4core.options.autoDispose=!0}catch{return d=g=null}return g});return w.apply(this,arguments)}r="#ffffff #858585 #ffbebe #ffebbe #ffebaf #ffffbe #e9ffbe #d3ffbe #beffe8 #bee8ff #bed2ff #e8beff #ffbee8 #ebebeb #707070 #ff7f7f #ffa77f #ffd37f #ffff73 #d1ff73 #a3ff73 #73ffdf #73dfff #73b2ff #df73ff #ff73df #d6d6d6 #5c5c5c #ff0000 #ff5500 #ffaa00 #ffff00 #aaff00 #55ff00 #00ffc5 #00c5ff #0070ff #c500ff #ff00c5 #c2c2c2 #474747 #e60000 #e64c00 #e69800 #e6e600 #98e600 #4ce600 #00e6a9 #00a9e6 #005ce6 #a900e6 #e600a9 #adadad #242424 #a80000 #a83800 #a87000 #a8a800 #70a800 #38a800 #00a884 #0084a8 #004da8 #8400a8 #a80084 #999999 #1a1a1a #730000 #732600 #734c00 #737300 #4c7300 #267300 #00734c #004c73 #002673 #4c0073 #73004".split(" ");
var e=[{name:"default",colors:[].concat(r.slice(30,39),r.slice(28,30).reverse())},{name:"cat-dark",colors:"#ed5151 #149ece #a7c636 #9e559c #fc921f #ffde3e #f789d8 #b7814a #3caf99 #6b6bd6 #b54779 #7f7f7f".split(" ")},{name:"tropical-bliss",colors:"#fce138 #ff9399 #fcd27e #f1983c #a553b7 #b1a9d0 #6ecffc #4c81cd #fc6f84 #fc3e5a #6af689 #48885c".split(" ")},{name:"desert-blooms",colors:"#102432 #144d59 #ffc730 #ed9310 #a64f1b #661510 #d9351a #b31515 #4a0932 #8c213f #18382e #2c6954".split(" ")},{name:"under-the-sea",
colors:"#bf9727 #607100 #00734c #704489 #01acca #024e76 #f09100 #ea311f #c6004b #7570b3 #666666 #333333".split(" ")},{name:"vibrant-rainbow",colors:"#fffb00 #f5cb11 #9fd40c #46e39c #32b8a6 #7ff2fa #ac08cc #dd33ff #eb7200 #e8a784 #bf2e2e #6c7000".split(" ")},{name:"ocean-bay",colors:"#191921 #11495c #78b1c2 #454f4b #8f8f82 #9be0c0 #87b051 #f7ec88 #ebdcc1 #dbb658 #c43541 #75351e".split(" ")},{name:"prairie-summer",colors:"#332424 #751555 #d47013 #d68989 #211173 #82aad6 #7bfaeb #6ec9a8 #6b6408 #eada40 #ccc54a #1fc235".split(" ")},
{name:"pastel-chalk",colors:"#fffd99 #f5e6a4 #c1d48c #b8e3d0 #a0b8b5 #cbf7fa #d791f2 #dfc1eb #f2b983 #e8c4b2 #bf8e8e #94995c".split(" ")},{name:"seq-yellow-orange-red-bright",colors:"#910000 #b1260b #c0370f #e05919 #ef6a1d #ff7b22 #ffa143 #ffb454 #ffda74 #ffed85".split(" ")},{name:"seq-reds-bright",colors:"#57453b #7b4238 #9f4036 #c23d33 #d7483c #ec5244 #f3696c #f9816c #ffc4ae #fff0dc".split(" ")},{name:"seq-purples-bright",colors:"#4e465c #5a4a78 #695291 #775baa #8663c3 #946bdc #aa89e8 #c1a6f3 #d7c4ff #e6e1ff".split(" ")},
{name:"seq-blues-bright",colors:"#404d54 #435c6c #48799d #4b88b6 #4d96ce #50a5e7 #74bbed #98d0f3 #bce6f9 #e6faff".split(" ")},{name:"seq-greens-bright",colors:"#39544c #386757 #368165 #359b73 #33b581 #4bc392 #64d2a2 #7ce0b3 #cbf6d9 #f4ffea".split(" ")},{name:"seq-browns-bright",colors:"#524834 #715b38 #8f6e3c #ae8140 #cc9444 #eba748 #eeb664 #f0c47f #f9e0b7 #fff8eb".split(" ")}];const l=new Map([["ar",()=>(new Promise(function(c,u){a(["../../chunks/ar2"],c,u)})).then(function(c){return c.ar})],["bs-ba",
()=>(new Promise(function(c,u){a(["../../chunks/bs_BA"],c,u)})).then(function(c){return c.bs_BA})],["ca-es",()=>(new Promise(function(c,u){a(["../../chunks/ca_ES"],c,u)})).then(function(c){return c.ca_ES})],["cs-cz",()=>(new Promise(function(c,u){a(["../../chunks/cs_CZ"],c,u)})).then(function(c){return c.cs_CZ})],["da-dk",()=>(new Promise(function(c,u){a(["../../chunks/da_DK"],c,u)})).then(function(c){return c.da_DK})],["de-de",()=>(new Promise(function(c,u){a(["../../chunks/de_DE"],c,u)})).then(function(c){return c.de_DE})],
["de-ch",()=>(new Promise(function(c,u){a(["../../chunks/de_CH"],c,u)})).then(function(c){return c.de_CH})],["el-gr",()=>(new Promise(function(c,u){a(["../../chunks/el_GR"],c,u)})).then(function(c){return c.el_GR})],["en-us",()=>(new Promise(function(c,u){a(["../../chunks/en_US"],c,u)})).then(function(c){return c.en_US})],["en-ca",()=>(new Promise(function(c,u){a(["../../chunks/en_CA"],c,u)})).then(function(c){return c.en_CA})],["es-es",()=>(new Promise(function(c,u){a(["../../chunks/es_ES"],c,u)})).then(function(c){return c.es_ES})],
["et-ee",()=>(new Promise(function(c,u){a(["../../chunks/et_EE"],c,u)})).then(function(c){return c.et_EE})],["fi-fi",()=>(new Promise(function(c,u){a(["../../chunks/fi_FI"],c,u)})).then(function(c){return c.fi_FI})],["fr-fr",()=>(new Promise(function(c,u){a(["../../chunks/fr_FR"],c,u)})).then(function(c){return c.fr_FR})],["he-il",()=>(new Promise(function(c,u){a(["../../chunks/he_IL"],c,u)})).then(function(c){return c.he_IL})],["hr-hr",()=>(new Promise(function(c,u){a(["../../chunks/hr_HR"],c,u)})).then(function(c){return c.hr_HR})],
["hu-hu",()=>(new Promise(function(c,u){a(["../../chunks/hu_HU"],c,u)})).then(function(c){return c.hu_HU})],["id-id",()=>(new Promise(function(c,u){a(["../../chunks/id_ID"],c,u)})).then(function(c){return c.id_ID})],["it-it",()=>(new Promise(function(c,u){a(["../../chunks/it_IT"],c,u)})).then(function(c){return c.it_IT})],["ja-jp",()=>(new Promise(function(c,u){a(["../../chunks/ja_JP"],c,u)})).then(function(c){return c.ja_JP})],["ko-kr",()=>(new Promise(function(c,u){a(["../../chunks/ko_KR"],c,u)})).then(function(c){return c.ko_KR})],
["lt-lt",()=>(new Promise(function(c,u){a(["../../chunks/lt_LT"],c,u)})).then(function(c){return c.lt_LT})],["lv-lv",()=>(new Promise(function(c,u){a(["../../chunks/lv_LV"],c,u)})).then(function(c){return c.lv_LV})],["nb-no",()=>(new Promise(function(c,u){a(["../../chunks/nb_NO"],c,u)})).then(function(c){return c.nb_NO})],["nl-nl",()=>(new Promise(function(c,u){a(["../../chunks/nl_NL"],c,u)})).then(function(c){return c.nl_NL})],["pl-pl",()=>(new Promise(function(c,u){a(["../../chunks/pl_PL"],c,u)})).then(function(c){return c.pl_PL})],
["pt-br",()=>(new Promise(function(c,u){a(["../../chunks/pt_BR"],c,u)})).then(function(c){return c.pt_BR})],["pt-pt",()=>(new Promise(function(c,u){a(["../../chunks/pt_PT"],c,u)})).then(function(c){return c.pt_PT})],["ro-ro",()=>(new Promise(function(c,u){a(["../../chunks/ro_RO"],c,u)})).then(function(c){return c.ro_RO})],["ru-ru",()=>(new Promise(function(c,u){a(["../../chunks/ru_RU"],c,u)})).then(function(c){return c.ru_RU})],["sk-sk",()=>(new Promise(function(c,u){a(["../../chunks/sk_SK"],c,u)})).then(function(c){return c.sk_SK})],
["sl-sl",()=>(new Promise(function(c,u){a(["../../chunks/sl_SL"],c,u)})).then(function(c){return c.sl_SL})],["sr-rs",()=>(new Promise(function(c,u){a(["../../chunks/sr_RS"],c,u)})).then(function(c){return c.sr_RS})],["sv-se",()=>(new Promise(function(c,u){a(["../../chunks/sv_SE"],c,u)})).then(function(c){return c.sv_SE})],["th-th",()=>(new Promise(function(c,u){a(["../../chunks/th_TH"],c,u)})).then(function(c){return c.th_TH})],["tr-tr",()=>(new Promise(function(c,u){a(["../../chunks/tr_TR"],c,u)})).then(function(c){return c.tr_TR})],
["uk-ua",()=>(new Promise(function(c,u){a(["../../chunks/uk_UA"],c,u)})).then(function(c){return c.uk_UA})],["vi-vn",()=>(new Promise(function(c,u){a(["../../chunks/vi_VN"],c,u)})).then(function(c){return c.vi_VN})],["zh-cn",()=>(new Promise(function(c,u){a(["../../chunks/zh_Hans"],c,u)})).then(function(c){return c.zh_Hans})],["zh-hk",()=>(new Promise(function(c,u){a(["../../chunks/zh_Hant"],c,u)})).then(function(c){return c.zh_Hant})],["zh-tw",()=>(new Promise(function(c,u){a(["../../chunks/zh_Hant"],
c,u)})).then(function(c){return c.zh_Hant})]]);let g,d;p.getChartLocale=f;p.getColorSet=function(c,u="default"){const t=e.find(h=>h.name===u);return t?t.colors.map(h=>c.color(h)):null};p.loadChartsModule=function(){return w.apply(this,arguments)};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../arcade/featureset/support/FeatureSetQueryInterceptor ../../core/Accessor ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../popup/content/TextContent ./FeatureAttachments/FeatureAttachmentsViewModel ./FeatureContent/FeatureContentViewModel ./FeatureFields/FeatureFieldsViewModel ./FeatureMedia/FeatureMediaViewModel ./support/arcadeFeatureUtils ./support/featureUtils ./support/relatedFeatureUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C){var A;const B=f.getLogger("esri.widgets.FeatureViewModel"),D={attachmentsContent:!0,customContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};q=A=function(E){function G(M){var H=E.call(this,M)||this;H._handles=new y;H._error=null;H._featureAbortController=null;H.graphicChangedThrottled=l.throttle(H.graphicChanged,1,a._assertThisInitialized(H));H._expressionAttributes=null;H.abilities={...D};H.content=null;H.contentViewModels=[];H.defaultPopupTemplateEnabled=
!1;H.formattedAttributes=null;H.lastEditInfo=null;H.relatedInfos=new Map;H.title="";H.view=null;H._isAllowedContentType=J=>{const {abilities:O}=a._assertThisInitialized(H);return"attachments"===J.type&&O.attachmentsContent||"custom"===J.type&&O.customContent||"fields"===J.type&&O.fieldsContent||"media"===J.type&&O.mediaContent||"text"===J.type&&O.textContent};H._handles.add(g.init(a._assertThisInitialized(H),["graphic","_effectivePopupTemplate","abilities"],()=>H.graphicChangedThrottled()));return H}
a._inheritsLoose(G,E);var K=G.prototype;K.destroy=function(){this._clear();this._cancelFeatureQuery();this._error=null;this._handles.destroy();this.graphic=this._handles=null;this._destroyContentViewModels();this.relatedInfos.clear()};K.castAbilities=function(M){return{...D,...M}};K.setActiveMedia=function(M,H){M=this.contentViewModels[M];M instanceof k&&M.setActiveMedia(H)};K.nextMedia=function(M){M=this.contentViewModels[M];M instanceof k&&M.next()};K.previousMedia=function(M){M=this.contentViewModels[M];
M instanceof k&&M.previous()};K._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};K.graphicChanged=function(){var M=a._asyncToGenerator(function*(){this._cancelFeatureQuery();this._error=null;this._clear();const {graphic:H}=this;if(H){var J=e.createAbortController();this._featureAbortController=J;try{yield this._queryFeature({signal:J.signal})}catch(O){e.isAbortError(O)||(this._error=O,B.error("error","The popupTemplate could not be displayed for this feature.",
{error:O,graphic:H,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===J&&(this._featureAbortController=null)}});return function(){return M.apply(this,arguments)}}();K._cancelFeatureQuery=function(){const {_featureAbortController:M}=this;M&&M.abort();this._featureAbortController=null};K._compileContent=function(M){this._destroyContentViewModels();if(this.graphic)return Array.isArray(M)?M.filter(this._isAllowedContentType).map((H,J)=>{if("attachments"===H.type)return this._compileAttachments(H,
J);if("custom"===H.type)return this._compileCustom(H,J);if("fields"===H.type)return this._compileFields(H,J);if("media"===H.type)return this._compileMedia(H,J);if("text"===H.type)return this._compileText(H,J)}):"string"===typeof M?this._compileText(new h({text:M}),0).text:M};K._destroyContentViewModels=function(){this.contentViewModels.forEach(M=>M&&!M.destroyed&&M.destroy());this._set("contentViewModels",[])};K._compileAttachments=function(M,H){const {graphic:J}=this,{description:O,title:I}=M;this.contentViewModels[H]=
new m({graphic:J,...this._compileTitleAndDesc({title:I,description:O})});return M};K._compileCustom=function(M,H){const {graphic:J}=this,{creator:O,destroyer:I}=M;this.contentViewModels[H]=new n({graphic:J,creator:O,destroyer:I});return M};K._compileTitleAndDesc=function({title:M,description:H}){const {_fieldInfoMap:J,_sourceLayer:O,graphic:I,formattedAttributes:F,_expressionAttributes:L}=this,{attributes:N}=I,R=F.global;return{title:x.substituteFieldsInLinksAndAttributes({attributes:N,fieldInfoMap:J,
globalAttributes:R,expressionAttributes:L,layer:O,text:M}),description:x.substituteFieldsInLinksAndAttributes({attributes:N,fieldInfoMap:J,globalAttributes:R,expressionAttributes:L,layer:O,text:H})}};K._compileFields=function(M,H){const {_effectivePopupTemplate:J,formattedAttributes:O}=this,I=M.clone();M=(null==M?void 0:M.fieldInfos)||(null==J?void 0:J.fieldInfos);const F=null==J?void 0:J.expressionInfos,L={...O.global,...O.content[H]},{description:N,title:R}=I;M=new z({attributes:L,expressionInfos:F,
fieldInfos:M,...this._compileTitleAndDesc({title:R,description:N})});this.contentViewModels[H]=M;I.fieldInfos=M.formattedFieldInfos.slice(0);return I};K._compileMedia=function(M,H){const {graphic:J,_fieldInfoMap:O,_effectivePopupTemplate:I,relatedInfos:F,_sourceLayer:L,_expressionAttributes:N}=this;var {attributes:R}=J;const S=this.formattedAttributes.global;M=M.clone();const {description:P,mediaInfos:Q,title:V}=M;R=new k({activeMediaInfoIndex:M.activeMediaInfoIndex||0,attributes:R,layer:L,fieldInfoMap:O,
formattedAttributes:S,expressionAttributes:N,mediaInfos:Q,popupTemplate:I,relatedInfos:F,...this._compileTitleAndDesc({title:V,description:P})});M.mediaInfos=R.formattedMediaInfos.slice(0);this.contentViewModels[H]=R;return M};K._compileText=function(M,H){M=M.clone();const {graphic:J,_fieldInfoMap:O,_sourceLayer:I,_expressionAttributes:F}=this;if(M&&M.text){const {attributes:L}=J;M.text=x.substituteFieldsInLinksAndAttributes({attributes:L,fieldInfoMap:O,globalAttributes:this.formattedAttributes.global,
expressionAttributes:F,layer:I,text:M.text})}this.contentViewModels[H]=new n({graphic:J,creator:M.text});return M};K._compileLastEditInfo=function(){const {_effectivePopupTemplate:M,_sourceLayer:H,graphic:J}=this;if(M){var {lastEditInfoEnabled:O}=M,I=null==H?void 0:H.editFieldsInfo;if(O&&I)return x.formatEditInfo(I,J.attributes)}};K._compileTitle=function(M){const {_fieldInfoMap:H,_sourceLayer:J,graphic:O,_expressionAttributes:I}=this,{attributes:F}=O;return x.substituteFieldsInLinksAndAttributes({attributes:F,
fieldInfoMap:H,globalAttributes:this.formattedAttributes.global,expressionAttributes:I,layer:J,text:M})};K._getTitle=function(){var M=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:H,graphic:J}=this;return x.graphicCallback(null==H?void 0:H.title,{graphic:J})});return function(){return M.apply(this,arguments)}}();K._getContent=function(){var M=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:H,graphic:J}=this;return x.graphicCallback(null==H?void 0:H.content,{graphic:J})});
return function(){return M.apply(this,arguments)}}();K._queryFeature=function(){var M=a._asyncToGenerator(function*(H){const {_featureAbortController:J,_sourceLayer:O,graphic:I,_effectivePopupTemplate:F,spatialReference:L,map:N,view:R}=this,{content:{value:S},title:{value:P}}=yield e.eachAlways({content:this._getContent(),title:this._getTitle()});J===this._featureAbortController&&I&&(yield x.queryUpdatedFeature({graphic:I,popupTemplate:F,layer:O,spatialReference:L},H),{expressionAttributes:{value:H}}=
yield e.eachAlways({checkForRelatedFeatures:this._checkForRelatedFeatures(H),expressionAttributes:v.createCompiledExpressions({popupTemplate:this._effectivePopupTemplate,spatialReference:L,graphic:I,map:N,interceptor:A.interceptor,view:R})}),J===this._featureAbortController&&I&&(this._expressionAttributes=H,this._set("formattedAttributes",this._createFormattedAttributes(S,H)),this._set("title",this._compileTitle(P)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(S)||
null)))});return function(H){return M.apply(this,arguments)}}();K._createFormattedAttributes=function(M,H){const {_effectivePopupTemplate:J,graphic:O,relatedInfos:I,_sourceLayer:F,_fieldInfoMap:L}=this,N={...O.attributes,...H},R={global:x.formatAttributes({fieldInfos:null==J?void 0:J.fieldInfos,graphic:O,attributes:N,layer:F,fieldInfoMap:L,relatedInfos:I}),content:[]};Array.isArray(M)&&M.forEach((S,P)=>{"fields"===S.type&&S.fieldInfos&&(R.content[P]=x.formatAttributes({fieldInfos:S.fieldInfos,graphic:O,
attributes:N,layer:F,fieldInfoMap:L,relatedInfos:I}))});return R};K._checkForRelatedFeatures=function(M){const {graphic:H,_effectivePopupTemplate:J}=this;return this._queryRelatedInfos(H,x.getAllFieldInfos(J),M)};K._queryRelatedInfos=function(){var M=a._asyncToGenerator(function*(H,J,O){const {relatedInfos:I,_sourceLayer:F}=this;I.clear();const L=w.isSome(F.associatedLayer)?yield F.associatedLayer.load(O):F;if(L){var N=J.filter(P=>P&&x.isRelatedField(P.fieldName));if(N&&N.length){J.forEach(P=>this._configureRelatedInfo(P,
L));var R=yield C.queryLayerInfos({relatedInfos:I,layer:L},O);Object.keys(R).forEach(P=>{var Q;const V=I.get(P.toString());P=null==(Q=R[P])?void 0:Q.value;V&&P&&(V.layerInfo=P.data)});var S=yield C.queryRelatedFeatures({graphic:H,relatedInfos:I,layer:L},O);Object.keys(S).forEach(P=>{var Q;C.setRelatedFeatures(null==(Q=S[P])?void 0:Q.value,I.get(P.toString()))})}}});return function(H,J,O){return M.apply(this,arguments)}}();K._configureRelatedInfo=function(M,H){const {relatedInfos:J}=this,O=C.getRelatedFieldInfo(M.fieldName);
if(O){var {layerId:I,fieldName:F}=O;I&&(H=J.get(I.toString())||C.createRelatedInfo(I,H))&&(C.updateRelatedInfo({relatedInfo:H,fieldName:F,fieldInfo:M}),this.relatedInfos.set(I,H))}};a._createClass(G,[{key:"_effectivePopupTemplate",get:function(){return w.isSome(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return x.createfieldInfoMap(x.getAllFieldInfos(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",
get:function(){return x.getSourceLayer(this.graphic)}},{key:"state",get:function(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(M){this._set("graphic",M?M.clone():null)}},{key:"spatialReference",get:function(){return this.get("view.spatialReference")||null},set:function(M){void 0===M?this._clearOverride("spatialReference"):this._override("spatialReference",M)}},{key:"map",get:function(){return this.get("view.map")||null},
set:function(M){void 0===M?this._clearOverride("map"):this._override("map",M)}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}}]);return G}(q);q.interceptor=new r.FeatureSetQueryInterceptor(x.preLayerQueryCallback,x.preRequestCallback);p.__decorate([d.property()],q.prototype,"_error",void 0);p.__decorate([d.property()],q.prototype,"_featureAbortController",void 0);p.__decorate([d.property({readOnly:!0})],q.prototype,"_effectivePopupTemplate",null);p.__decorate([d.property({readOnly:!0})],
q.prototype,"_fieldInfoMap",null);p.__decorate([d.property({readOnly:!0})],q.prototype,"_sourceLayer",null);p.__decorate([d.property()],q.prototype,"abilities",void 0);p.__decorate([u.cast("abilities")],q.prototype,"castAbilities",null);p.__decorate([d.property({readOnly:!0})],q.prototype,"content",void 0);p.__decorate([d.property({readOnly:!0})],q.prototype,"contentViewModels",void 0);p.__decorate([d.property({type:Boolean})],q.prototype,"defaultPopupTemplateEnabled",void 0);p.__decorate([d.property({readOnly:!0})],
q.prototype,"state",null);p.__decorate([d.property({readOnly:!0})],q.prototype,"formattedAttributes",void 0);p.__decorate([d.property({type:b,value:null})],q.prototype,"graphic",null);p.__decorate([d.property({readOnly:!0})],q.prototype,"lastEditInfo",void 0);p.__decorate([d.property()],q.prototype,"relatedInfos",void 0);p.__decorate([d.property()],q.prototype,"spatialReference",null);p.__decorate([d.property({readOnly:!0})],q.prototype,"title",void 0);p.__decorate([d.property()],q.prototype,"map",
null);p.__decorate([d.property({readOnly:!0})],q.prototype,"waitingForContent",null);p.__decorate([d.property()],q.prototype,"view",void 0);return q=A=p.__decorate([t.subclass("esri.widgets.FeatureViewModel")],q)})},"esri/arcade/featureset/support/FeatureSetQueryInterceptor":function(){define(["exports"],function(a){a.FeatureSetQueryInterceptor=function(p,b){this.preLayerQueryCallback=p;this.preRequestCallback=b;this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{});this.preRequestCallback||
(this.preLayerQueryCallback=r=>{})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/support/arcadeFeatureUtils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../layers/FeatureLayer ./featureUtils".split(" "),function(a,p,b,r,q,y,f){function w(z){return`<ul class="esri-widget__list">${z.map(k=>`<li>${"string"===typeof k?f.applyTextFormattingHTML(f.htmlEntities(k)):k}</li>`).join("")}</ul>`}
function e(z){return`<table class="esri-widget__table">${z.keys().map(k=>{var v=z.field(k);v="string"===typeof v?f.applyTextFormattingHTML(f.htmlEntities(v)):v;return`<tr><th>${k}</th><td>${v}</td></tr>`}).join("")}</table>`}function l({aggregatedFeatures:z,arcadeUtils:k,featureSetVars:v,context:x,viewInfo:C,map:A,graphic:B,interceptor:D}){v.forEach(E=>{E=E.toLowerCase();var G={map:A,spatialReference:C.sr,interceptor:D};"$map"===E&&(x.vars[E]=k.convertMapToFeatureSetCollection(G));"$layer"===E&&(x.vars[E]=
k.convertFeatureLayerToFeatureSet({layer:B.sourceLayer,spatialReference:C.sr,interceptor:D}));"$datastore"===E&&(x.vars[E]=k.convertServiceUrlToWorkspace({url:B.sourceLayer.url,spatialReference:C.sr,interceptor:D}));if("$aggregatedfeatures"===E){G=B.layer;const {fields:K,objectIdField:M,geometryType:H,spatialReference:J,displayField:O}=G;G=new y({fields:K,objectIdField:M,geometryType:H,spatialReference:J,displayField:O,..."feature"===G.type?{templates:G.templates,typeIdField:G.typeIdField,types:G.types}:
null,source:z});x.vars[E]=k.convertFeatureLayerToFeatureSet({layer:G,spatialReference:C.sr,interceptor:D})}})}function g(){return new Promise(function(z,k){a(["../../../support/arcadeUtils"],z,k)})}function d(z){return c.apply(this,arguments)}function c(){c=b._asyncToGenerator(function*({graphic:z,view:k}){const {isAggregate:v,layer:x}=z;if(!v||!x||"2d"!==(null==k?void 0:k.type))return[];k=yield k.whenLayerView(x);if(!k.createQuery||!k.queryFeatures)return[];const C=k.createQuery();C.aggregateIds=
[z.getObjectId()];({features:z}=yield k.queryFeatures(C));return z});return c.apply(this,arguments)}function u(z){return t.apply(this,arguments)}function t(){t=b._asyncToGenerator(function*({expressionAttributes:z,info:k,arcadeUtils:v,interceptor:x,spatialReference:C,map:A,graphic:B,view:D}){const E=`expression/${k.name}`,G=v.createSyntaxTree(k.expression),K=m.filter(H=>v.hasVariable(G,H));yield v.loadScriptDependencies(G,!0,K);const M=v.getViewInfo({spatialReference:C});C=v.createExecContext(B,M);
C.interceptor=x;C.useAsync=!0;D=yield d({graphic:B,view:D});l({aggregatedFeatures:D,arcadeUtils:v,featureSetVars:K,context:C,viewInfo:M,map:A,graphic:B,interceptor:x});x=v.createFunction(G,C);x=yield v.executeAsyncFunction(x,C).catch(H=>n.error("arcade-execution-error",{error:H,graphic:B,expressionInfo:k}));z[E]="string"===typeof x?f.applyTextFormattingHTML(f.htmlEntities(x)):Array.isArray(x)?w(x):x&&"esri.arcade.Dictionary"===x.declaredClass?e(x):x});return t.apply(this,arguments)}function h(){h=
b._asyncToGenerator(function*({popupTemplate:z,spatialReference:k,graphic:v,interceptor:x,map:C,view:A}){z=z.expressionInfos;const B=[],D={};if(!z||!z.length)return D;const E=yield g();for(const G of z)B.push(u({expressionAttributes:D,info:G,arcadeUtils:E,interceptor:x,spatialReference:k,map:C,graphic:v,view:A}));yield q.eachAlways(B);return D});return h.apply(this,arguments)}const m=["$datastore","$map","$layer","$aggregatedfeatures"],n=r.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");
p.createCompiledExpressions=function(z){return h.apply(this,arguments)};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/widgets/Feature/support/FeatureContentMixin":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../support/widget ../../support/jsxFactory".split(" "),
function(a,p,b,r,q,y,f,w,e,l){a.FeatureContentMixin=g=>{g=function(d){function c(){var u=d.apply(this,arguments)||this;u.renderNodeContent=t=>e.isWidget(t)&&!t.destroyed?l.tsx("div",{key:t},t.render()):t instanceof HTMLElement?l.tsx("div",{key:t,bind:t,afterCreate:u._attachToNode}):e.hasDomNode(t)?l.tsx("div",{key:t,bind:t.domNode,afterCreate:u._attachToNode}):null;return u}p._inheritsLoose(c,d);c.prototype._attachToNode=function(u){u.appendChild(this)};return c}(g);return g=b.__decorate([w.subclass("esri.widgets.Feature.ContentMixin")],
g)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Spinner":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Spinner/SpinnerViewModel ./support/widgetUtils ./support/jsxFactory".split(" "),function(a,
p,b,r,q,y,f,w,e,l,g,d,c,u,t){f=function(h){function m(z,k){z=h.call(this,z,k)||this;z._animationDelay=500;z._animationPromise=null;z.location=null;z.view=null;z.viewModel=new c;z.visible=!1;return z}a._inheritsLoose(m,h);var n=m.prototype;n.initialize=function(){this.own([q.watch(this,"visible",z=>this._visibleChange(z))])};n.destroy=function(){this._animationPromise=null};n.show=function(z){const {location:k,promise:v}=z;k&&(this.viewModel.location=k);this.visible=!0;z=()=>this.hide();v&&v.catch(()=>
{}).then(z)};n.hide=function(){this.visible=!1};n.render=function(){var {visible:z}=this,{screenLocation:k}=this.viewModel;k=!!k;z={["esri-spinner--start"]:z&&k,["esri-spinner--finish"]:!z&&k};k=this._getPositionStyles();return t.tsx("div",{class:this.classes("esri-spinner",z),styles:k})};n._visibleChange=function(z){if(z)this.viewModel.screenLocationEnabled=!0;else{var k=r.after(this._animationDelay);this._animationPromise=k;k.catch(()=>{}).then(()=>{this._animationPromise===k&&(this.viewModel.screenLocationEnabled=
!1,this._animationPromise=null)})}};n._getPositionStyles=function(){const {screenLocation:z,view:k}=this.viewModel;if(!k||b.isNone(z))return{};const {padding:v}=k;return{left:`${z.x-v.left}px`,top:`${z.y-v.top}px`}};return m}(d);p.__decorate([y.aliasOf("viewModel.location")],f.prototype,"location",void 0);p.__decorate([y.aliasOf("viewModel.view")],f.prototype,"view",void 0);p.__decorate([l.property({type:c})],f.prototype,"viewModel",void 0);p.__decorate([y.aliasOf("viewModel.visible")],f.prototype,
"visible",void 0);return f=p.__decorate([g.subclass("esri.widgets.Spinner")],f)})},"esri/widgets/Spinner/SpinnerViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../support/AnchorElementViewModel".split(" "),function(a,p,b,r,q,y,f,w){r=function(e){function l(g){g=e.call(this,g)||this;g.visible=
!1;return g}a._inheritsLoose(l,e);return l}(w);p.__decorate([b.property()],r.prototype,"visible",void 0);return r=p.__decorate([f.subclass("esri.widgets.CompassViewModel")],r)})},"esri/widgets/support/AnchorElementViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Handles ../../core/maybe ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){b=function(d){function c(t){var h=d.call(this,t)||this;h._anchorHandles=new r;h.location=null;h.screenLocation=null;h.screenLocationEnabled=!1;h.view=null;h._anchorHandles.add([y.watch(a._assertThisInitialized(h),["screenLocationEnabled","location","view.size","view.stationary"],()=>h._updateScreenPointAndHandle()),y.watch(a._assertThisInitialized(h),["view","view.ready"],()=>h._wireUpView())]);return h}a._inheritsLoose(c,d);var u=c.prototype;u.destroy=function(){this.view=
null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=this._anchorHandles=null};u._wireUpView=function(){this._anchorHandles.remove("view");this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var {view:t}=this;t=y.pausable(t,"3d"===t.type?"camera":"viewpoint",()=>this._viewpointChange());this._anchorHandles.add(t,"view");this._viewpointHandle=t;this._toggleWatchingViewpoint()}};u._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};
u._updateScreenPointAndHandle=function(){this._setScreenLocation();this._toggleWatchingViewpoint()};u._toggleWatchingViewpoint=function(){const {_viewpointHandle:t,location:h,screenLocationEnabled:m}=this;t&&(h&&m?t.resume():t.pause())};u._setScreenLocation=function(){const {location:t,view:h,screenLocationEnabled:m}=this;var n=this.get("view.ready");n=m&&n&&q.isSome(t)?h.toScreen(t):null;this._set("screenLocation",n)};return c}(b.EventedAccessor);p.__decorate([f.property()],b.prototype,"location",
void 0);p.__decorate([f.property({readOnly:!0})],b.prototype,"screenLocation",void 0);p.__decorate([f.property()],b.prototype,"screenLocationEnabled",void 0);p.__decorate([f.property()],b.prototype,"view",void 0);return b=p.__decorate([g.subclass("esri.widgets.support.AnchorElementViewModel")],b)})},"esri/widgets/Popup/PopupViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../symbols ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/webMercatorUtils ../../layers/Layer ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../symbols/support/symbolUtils ../../views/input/InputManager ../../views/support/layerViewUtils ../Feature/FeatureViewModel ./actions ./actionUtils ../support/AnchorElementViewModel ../support/GoTo ../../geometry/Point ../../symbols/SimpleFillSymbol".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H){const J=y.ofType({key:"type",defaultKeyValue:"button",base:z,typeMap:{button:k,toggle:v}}),O=e.getLogger("esri.widgets.Popup.PopupViewModel");b=function(I){function F(N){N=I.call(this,N)||this;N._handles=new w;N._pendingPromises=new Set;N._fetchFeaturesController=null;N._selectedClusterFeature=null;N.featurePage=null;N.actions=new J;N.defaultPopupTemplateEnabled=!1;N.autoCloseEnabled=!1;N.autoOpenEnabled=!0;N.browseClusterEnabled=
!1;N.content=null;N.featuresPerPage=20;N.featureViewModelAbilities=null;N.featureViewModels=[];N.highlightEnabled=!0;N.includeDefaultActions=!0;N.selectedClusterBoundaryFeature=new r({symbol:new H({outline:{width:1.5,color:"cyan"},style:"none"})});N.title=null;N.updateLocationEnabled=!1;N.view=null;N.visible=!1;N.zoomFactor=4;N.zoomToLocation=null;return N}a._inheritsLoose(F,I);var L=F.prototype;L.initialize=function(){this._handles.add([d.init(this,["autoOpenEnabled","view"],()=>this._autoOpenEnabledChange()),
this.on("view-change",()=>this._autoClose()),d.watch(this,["highlightEnabled","selectedFeature","visible","view"],()=>this._highlightFeature()),d.watch(this,"view.animation.state",N=>this._animationStateChange(N)),d.watch(this,"location",N=>this._locationChange(N)),d.watch(this,"selectedFeature",N=>this._selectedFeatureChange(N)),d.watch(this,["selectedFeatureIndex","featureCount","featuresPerPage"],()=>this._selectedFeatureIndexChange()),d.watch(this,["featurePage","selectedFeatureIndex","featureCount",
"featuresPerPage, featureViewModels"],()=>this._setGraphicOnFeatureViewModels()),d.watch(this,"featureViewModels",()=>this._featureViewModelsChange()),this.on("trigger-action",N=>E.triggerAction({event:N,view:this.view})),d.whenFalse(this,"waitingForResult",()=>this._waitingForResultChange(),!0),d.watch(this,["features","view","view.map","view.spatialReference"],()=>this._updateFeatureVMs()),d.watch(this,["view.scale"],this._viewScaleChange),d.whenFalse(this,"visible",()=>this.browseClusterEnabled=
!1),d.watch(this,"browseClusterEnabled",N=>N?this.enableClusterBrowsing():this.disableClusterBrowsing())])};L.destroy=function(){this._cancelFetchingFeatures();this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.browseClusterEnabled=!1;this.view=null};L.centerAtLocation=function(){var {view:N}=this;const R=E.getSelectedTarget(this);return R?this.callGoTo({target:{target:R,scale:N.scale}}):(N=new f("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",
{target:R,view:N}),O.error(N),Promise.reject(N))};L.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})};L.fetchFeatures=function(N,R){const {view:S}=this;return S&&N?S.fetchPopupFeatures(N,{event:R&&R.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:R&&R.signal}):(N=new f("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:N,view:S}),O.error(N),Promise.reject(N))};L.open=
function(N){N={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...N,visible:!0};const {fetchFeatures:R}=N;delete N.fetchFeatures;R&&this._setFetchFeaturesPromises(N.location);this.set(N)};L.triggerAction=function(N){(N=this.allActions.getItemAt(N))&&!N.disabled&&this.emit("trigger-action",{action:N})};L.next=function(){this.selectedFeatureIndex+=1;return this};L.previous=function(){--this.selectedFeatureIndex;return this};L.disableClusterBrowsing=function(){E.removeClusteredFeaturesForBrowsing(this);
this._clearBrowsedClusterGraphics()};L.enableClusterBrowsing=function(){var N=a._asyncToGenerator(function*(){yield E.displayClusterExtent(this);yield E.browseAggregateFeatures(this)});return function(){return N.apply(this,arguments)}}();L._animationStateChange=function(N){this.zoomToLocation||(D.zoomToFeature.disabled="waiting-for-target"===N)};L._clearBrowsedClusterGraphics=function(){var N;const R=null==(N=this.view)?void 0:N.graphics;R&&(R.remove(this.selectedClusterBoundaryFeature),R.remove(this._selectedClusterFeature));
this._selectedClusterFeature=null;this.selectedClusterBoundaryFeature.geometry=null};L._viewScaleChange=function(){var N;if(null!=(N=this.selectedFeature)&&N.isAggregate||this.browseClusterEnabled)this.visible=this.browseClusterEnabled=!1};L._locationChange=function(N){const {selectedFeature:R,updateLocationEnabled:S}=this;S&&N&&(!R||R.geometry)&&this.centerAtLocation()};L._selectedFeatureIndexChange=function(){this.featurePage=1<this.featureCount?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+
1:null};L._featureViewModelsChange=function(){this.featurePage=1<this.featureCount?1:null};L._setGraphicOnFeatureViewModels=function(){const {features:N,featureCount:R,featurePage:S,featuresPerPage:P,featureViewModels:Q}=this;if(null!==S){var V=((S-1)*P+R)%R;Q.slice(V,V+P).forEach((ca,ba)=>{ca&&!ca.graphic&&(ca.graphic=N[V+ba])})}};L._selectedFeatureChange=function(){var N=a._asyncToGenerator(function*(R){if(R){var {location:S,updateLocationEnabled:P,view:Q}=this;this.browseClusterEnabled?(this._selectedClusterFeature&&
(Q.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),R.isAggregate||(R.symbol=yield x.getDisplayedSymbol(R),this._selectedClusterFeature=R,Q.graphics.add(this._selectedClusterFeature))):!P&&S||!R.geometry?P&&!R.geometry&&this.centerAtLocation().then(()=>{this.location=Q.center.clone()}):this.location=l.unwrap(this._getPointFromGeometry(R.geometry))}});return function(R){return N.apply(this,arguments)}}();L._waitingForResultChange=function(){!this.featureCount&&this.promises&&
(this.visible=!1)};L._setFetchFeaturesPromises=function(N){return this._fetchFeaturesWithController(this._getScreenPoint(N||this.location)).then(R=>{const {clientOnlyGraphics:S,promisesPerLayerView:P}=R;R=Promise.resolve(S);const Q=P.map(V=>V.promise);this.promises=[R,...Q]})};L._destroyFeatureVMs=function(){this.featureViewModels.forEach(N=>N&&!N.destroyed&&N.destroy());this._set("featureViewModels",[])};L._updateFeatureVMs=function(){const {selectedFeature:N,features:R,featureViewModels:S}=this;
null!=N&&N.isAggregate||(this.browseClusterEnabled=!1);this._destroyFeatureVMs();if(R&&R.length){var P=S.slice(0),Q=[];R.forEach((V,ca)=>{if(V){var ba=null;P.some((fa,aa)=>{fa&&fa.graphic===V&&(ba=fa,P.splice(aa,1));return!!ba});if(ba)Q[ca]=ba;else{var Z,ha;const fa=new B({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(Z=this.view)?void 0:Z.spatialReference,graphic:V===N?V:null,map:null==(ha=this.view)?void 0:ha.map,view:this.view});
Q[ca]=fa}}});P.forEach(V=>V&&!V.destroyed&&V.destroy());this._set("featureViewModels",Q)}};L._getScreenPoint=function(N){const {view:R}=this;return R&&N&&"function"===typeof R.toScreen?R.toScreen(N):null};L._autoOpenEnabledChange=function(){const {_handles:N,autoOpenEnabled:R}=this;N.remove("auto-fetch-features");if(R&&this.view){const S=this.view.on("click",P=>{"mouse"===P.pointerType&&0!==P.button||this._fetchFeaturesAndOpen(P)},C.ViewEventPriorities.WIDGET);N.add(S,"auto-fetch-features")}};L._cancelFetchingFeatures=
function(){const N=this._fetchFeaturesController;N&&N.abort();this._fetchFeaturesController=null;this.notifyChange("waitingForResult")};L._fetchFeaturesWithController=function(N,R){this._cancelFetchingFeatures();const S=g.createAbortController(),{signal:P}=S;this._fetchFeaturesController=S;this.notifyChange("waitingForResult");N=this.fetchFeatures(N,{signal:P,event:R});N.catch(()=>{}).then(()=>{this._fetchFeaturesController=null;this.notifyChange("waitingForResult")});return N};L._fetchFeaturesAndOpen=
function(N){const {screenPoint:R,mapPoint:S}=N,{view:P}=this;this._fetchFeaturesWithController(R,N).then(Q=>{const {clientOnlyGraphics:V,promisesPerLayerView:ca,location:ba}=Q,Z=[Promise.resolve(V),...ca.map(ha=>ha.promise)];P.popup.open({location:ba||S,promises:Z});return Q})};L._updatePendingPromises=function(N){N&&this._pendingPromises.has(N)&&(this._pendingPromises.delete(N),this.notifyChange("pendingPromisesCount"))};L._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};L._getPointFromGeometry=
function(N){return l.isNone(N)?null:"point"===N.type?N:"extent"===N.type?N.center:"polygon"===N.type?N.centroid:"multipoint"===N.type||"polyline"===N.type?N.extent.center:null};L._getLayerView=function(){var N=a._asyncToGenerator(function*(R,S){yield R.when();return R.whenLayerView(S)});return function(R,S){return N.apply(this,arguments)}}();L._highlightFeature=function(){var N=a._asyncToGenerator(function*(){this._handles.remove("highlight");const {selectedFeature:R,highlightEnabled:S,view:P,visible:Q}=
this;if(R&&P&&S&&Q){var {layer:V,sourceLayer:ca}=R;if("map-notes"===(null==ca?void 0:ca.type)||"subtype-group"===(null==ca?void 0:ca.type))V=ca;if(V&&V instanceof n){var ba=this._getLayerView(P,V);this._highlightPromise=ba;var Z=yield ba;if(Z&&A.highlightsSupported(Z)&&this._highlightPromise===ba&&this.selectedFeature&&this.highlightEnabled&&this.visible){ba="objectIdField"in V&&V.objectIdField;var ha=R.attributes;Z=Z.highlight(ha&&ba&&ha[ba]||R);this._handles.add(Z,"highlight")}}}});return function(){return N.apply(this,
arguments)}}();L._updateFeatures=function(N){const {features:R}=this;N&&N.length&&(R.length?(N=N.filter(S=>-1===R.indexOf(S)),this.features=R.concat(N)):this.features=N)};a._createClass(F,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some(N=>N.waitingForContent)}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){const N=this._get("allActions")||new J;N.removeAll();const {actions:R,defaultActions:S,defaultPopupTemplateEnabled:P,
includeDefaultActions:Q,selectedFeature:V}=this;var ca=Q?S.concat(R):R;const ba=V&&("function"===typeof V.getEffectivePopupTemplate&&V.getEffectivePopupTemplate(P)||V.popupTemplate),Z=ba&&ba.actions;(ca=ba&&ba.overwriteActions?Z:Z?Z.concat(ca):ca)&&ca.filter(Boolean).forEach(ha=>N.add(ha));return N}},{key:"defaultActions",get:function(){var N;const R=this._get("defaultActions")||new J;R.removeAll();R.addMany(null!=(N=this.selectedFeature)&&N.isAggregate?[D.zoomToClusteredFeatures.clone(),D.browseClusteredFeatures.clone()]:
[D.zoomToFeature.clone()]);return R}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||[]},set:function(N){N=N||[];this._set("features",N);const {pendingPromisesCount:R,promiseCount:S,selectedFeatureIndex:P}=this,Q=S&&N.length;Q&&R&&-1===P?this.selectedFeatureIndex=0:Q&&-1!==P||(this.selectedFeatureIndex=N.length?0:-1)}},{key:"location",get:function(){return this._get("location")||null},set:function(N){const R=this.get("view.spatialReference.isWebMercator");
N&&N.get("spatialReference.isWGS84")&&R&&(N=m.geographicToWebMercator(N));this._set("location",N)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||0<this.pendingPromisesCount)||0!==this.featureCount)}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(N){this._pendingPromises.clear();this.features=
[];Array.isArray(N)&&N.length?(this._set("promises",N),N=N.slice(0),N.forEach(R=>{this._pendingPromises.add(R);R.then(S=>{this._pendingPromises.has(R)&&this._updateFeatures(S);this._updatePendingPromises(R)},()=>this._updatePendingPromises(R))})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")}},{key:"selectedFeature",get:function(){const {features:N,selectedFeatureIndex:R}=this;return-1===R?null:N[R]||null}},{key:"selectedFeatureIndex",get:function(){const N=this._get("selectedFeatureIndex");
return"number"===typeof N?N:-1},set:function(N){const {featureCount:R}=this;N=isNaN(N)||-1>N||!R?-1:(N+R)%R;this._set("selectedFeatureIndex",N)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}}]);return F}(K.GoToMixin(G));p.__decorate([c.property()],b.prototype,"featurePage",void 0);p.__decorate([c.property()],b.prototype,"isLoadingFeature",null);p.__decorate([c.property({type:J})],
b.prototype,"actions",void 0);p.__decorate([c.property({readOnly:!0})],b.prototype,"active",null);p.__decorate([c.property({readOnly:!0})],b.prototype,"allActions",null);p.__decorate([c.property({type:Boolean})],b.prototype,"defaultPopupTemplateEnabled",void 0);p.__decorate([c.property()],b.prototype,"autoCloseEnabled",void 0);p.__decorate([c.property()],b.prototype,"autoOpenEnabled",void 0);p.__decorate([c.property()],b.prototype,"browseClusterEnabled",void 0);p.__decorate([c.property()],b.prototype,
"content",void 0);p.__decorate([c.property({type:J,readOnly:!0})],b.prototype,"defaultActions",null);p.__decorate([c.property({readOnly:!0})],b.prototype,"featureCount",null);p.__decorate([c.property()],b.prototype,"features",null);p.__decorate([c.property()],b.prototype,"featuresPerPage",void 0);p.__decorate([c.property()],b.prototype,"featureViewModelAbilities",void 0);p.__decorate([c.property({readOnly:!0})],b.prototype,"featureViewModels",void 0);p.__decorate([c.property()],b.prototype,"highlightEnabled",
void 0);p.__decorate([c.property()],b.prototype,"includeDefaultActions",void 0);p.__decorate([c.property({type:M})],b.prototype,"location",null);p.__decorate([c.property({readOnly:!0})],b.prototype,"pendingPromisesCount",null);p.__decorate([c.property({readOnly:!0})],b.prototype,"selectedClusterBoundaryFeature",void 0);p.__decorate([c.property({readOnly:!0})],b.prototype,"waitingForResult",null);p.__decorate([c.property({readOnly:!0})],b.prototype,"promiseCount",null);p.__decorate([c.property()],
b.prototype,"promises",null);p.__decorate([c.property({value:null,readOnly:!0})],b.prototype,"selectedFeature",null);p.__decorate([c.property({value:-1})],b.prototype,"selectedFeatureIndex",null);p.__decorate([c.property({readOnly:!0})],b.prototype,"selectedFeatureViewModel",null);p.__decorate([c.property({readOnly:!0})],b.prototype,"state",null);p.__decorate([c.property()],b.prototype,"title",void 0);p.__decorate([c.property()],b.prototype,"updateLocationEnabled",void 0);p.__decorate([c.property()],
b.prototype,"view",void 0);p.__decorate([c.property()],b.prototype,"visible",void 0);p.__decorate([c.property()],b.prototype,"zoomFactor",void 0);p.__decorate([c.property()],b.prototype,"zoomToLocation",void 0);p.__decorate([c.property()],b.prototype,"centerAtLocation",null);return b=p.__decorate([h.subclass("esri.widgets.Popup.PopupViewModel")],b)})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./utils".split(" "),
function(a,p,b,r,q,y,f){function w(u,t){return e.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(u,t){switch(u.type){case "web-style":var {previewWebStyleSymbol:h}=yield new Promise(function(m,n){a(["./previewWebStyleSymbol"],m,n)});return h(u,w,t);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:h}=yield new Promise(function(m,n){a(["./previewSymbol3D"],m,n)}),h(u,t);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:h}=
yield new Promise(function(m,n){a(["./previewSymbol2D"],m,n)}),h(u,t);case "cim":return{previewCIMSymbol:h}=yield new Promise(function(m,n){a(["./previewCIMSymbol"],m,n)}),h(u,t)}});return e.apply(this,arguments)}function l(u){return u&&"opacity"in u?u.opacity*l(u.parent):1}function g(){g=b._asyncToGenerator(function*(u,t){var h,m;if(u){var n=u.sourceLayer;n=null!=(h=q.isSome(t)&&null!=(m=t.useSourceLayer)&&m?n:u.layer)?h:n;h=l(n);if(q.isSome(u.symbol)&&(!q.isSome(t)||!0!==t.ignoreGraphicSymbol))return u=
"web-style"===u.symbol.type?yield u.symbol.fetchSymbol(q.isSome(t)?t.abortOptions:null):u.symbol.clone(),f.applyColorToSymbol(u,null,h),u;var z=q.isSome(t)&&t.renderer||n&&"renderer"in n&&n.renderer;if(m=z&&"getSymbolAsync"in z?yield z.getSymbolAsync(u,t):null){m="web-style"===m.type?yield m.fetchSymbol(q.isSome(t)?t.abortOptions:null):m.clone();if(!("visualVariables"in z&&z.visualVariables&&z.visualVariables.length))return f.applyColorToSymbol(m,null,h),m;"arcadeRequiredForVisualVariables"in z&&
z.arcadeRequiredForVisualVariables&&(q.isNone(t)||q.isNone(t.arcade))&&(t={...q.unwrap(t)},t.arcade=yield y.loadArcade());n=yield new Promise(function(B,D){a(["../../renderers/visualVariables/support/visualVariableUtils"],B,D)});var k=[],v=[],x=[],C=[];for(var A of z.visualVariables)switch(A.type){case "color":k.push(A);break;case "opacity":v.push(A);break;case "rotation":C.push(A);break;case "size":A.target||x.push(A)}A=(A=!!k.length&&k[k.length-1])?n.getColor(A,u,t):null;v=(v=!!v.length&&v[v.length-
1])?n.getOpacity(v,u,t):null;null!=h&&(v=null!=v?v*h:h);f.applyColorToSymbol(m,A,v);x.length&&(h=n.getAllSizes(x,u,t),yield f.applySizesToSymbol(m,h));for(const B of C)f.applyRotationToSymbol(m,n.getRotationAngle(B,u,t),B.axis);return m}}});return g.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(u,t){var h;if(u){var m=l(u.layer||u.sourceLayer);if(q.isSome(u.symbol)&&(!q.isSome(t)||!0!==t.ignoreGraphicSymbol))return u="web-style"===u.symbol.type?yield u.symbol.fetchSymbol(q.isSome(t)?
t.abortOptions:null):u.symbol.clone(),f.getColorFromSymbol(u,m);var n=q.isSome(t)&&t.renderer||u.get("layer.renderer")||u.get("sourceLayer.renderer"),z=yield n.getSymbolAsync(u,t);if(z){z="web-style"===z.type?yield z.fetchSymbol(q.isSome(t)?t.abortOptions:null):z.clone();z=f.getColorFromSymbol(z,m);if(!("visualVariables"in n)||"visualVariables"in n&&!n.visualVariables||"visualVariables"in n&&(null==(h=n.visualVariables)||!h.length))return z;n.arcadeRequiredForVisualVariables&&(q.isNone(t)||q.isNone(t.arcade))&&
(t={...q.unwrap(t)},t.arcade=yield y.loadArcade());h=yield new Promise(function(x,C){a(["../../renderers/visualVariables/support/visualVariableUtils"],x,C)});var k=[],v=[];for(const x of n.visualVariables)switch(x.type){case "color":k.push(x);break;case "opacity":v.push(x)}n=(n=0<k.length?k[k.length-1]:null)?h.getColor(n,u,t):z;u=(z=0<v.length?v[v.length-1]:null)?h.getOpacity(z,u,t):null;null!=m&&(u=null!=u?u*m:m);return n?f.applyOpacityToColor(n,u):null}}});return d.apply(this,arguments)}let c=null;
p.getDisplayedColor=function(u,t){return d.apply(this,arguments)};p.getDisplayedSymbol=function(u,t){return g.apply(this,arguments)};p.renderColorRampPreviewHTML=function(u,t={}){var h="horizontal"===t.align;const {width:m=h?75:24,height:n=h?24:75,gradient:z=!0}=t;t=window.devicePixelRatio;var k=m*t,v=n*t;t=document.createElement("canvas");t.width=k;t.height=v;t.style.width=`${m}px`;t.style.height=`${n}px`;const x=t.getContext("2d");var C=h?k:0,A=h?0:v;if(z){const B=x.createLinearGradient(0,0,C,A);
h=u.length;const D=1===h?0:1/(h-1);u.forEach((E,G)=>B.addColorStop(G*D,E.toString()));x.fillStyle=B;x.fillRect(0,0,k,v)}else{k=h?k/u.length:k;v=h?v:v/u.length;A=C=0;for(const B of u)x.fillStyle=B.toString(),x.fillRect(C,A,k,v),C=h?C+k:0,A=h?0:A+v}u=document.createElement("div");u.style.width=`${m}px`;u.style.height=`${n}px`;u.appendChild(t);return u};p.renderDotDensityPreviewHTML=function(u,t,h){const {backgroundColor:m,outline:n,dotSize:z}=u;h=h&&h.swatchSize||22;const k=Math.round(h*h/z**2*.8),
v=window.devicePixelRatio;u=document.createElement("canvas");const x=h*v;u.width=x;u.height=x;u.style.width=`${u.width/v}px`;u.style.height=`${u.height/v}px`;const C=u.getContext("2d");m&&(C.fillStyle=m.toCss(!0),C.fillRect(0,0,x,x),C.fill());C.fillStyle=t.toCss(!0);if(c&&c.length/2===k)for(t=0;t<2*k;t+=2)C.fillRect(c[t],c[t+1],z*v,z*v),C.fill();else for(c=[],t=0;t<2*k;t+=2){const A=Math.floor(Math.random()*(x-0+1)),B=Math.floor(Math.random()*(x-0+1));c.push(A,B);C.fillRect(A,B,z*v,z*v);C.fill()}n&&
(n.color&&(C.strokeStyle=n.color.toCss(!0)),C.lineWidth=n.width,C.strokeRect(0,0,x,x));h=new Image(h,h);h.src=u.toDataURL();return h};p.renderPreviewHTML=w;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/symbols/support/utils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../chunks/vec3f64 ./gfxUtils ./Symbol3DMaterial".split(" "),function(a,p,b,r,q,y,f,w,
e,l,g,d){function c(M){M=M.symbolLayers;if(!M)return null;let H=null;M.forEach(J=>{if("object"!==J.type||null==J.resource.href)H="water"===J.type?w.unwrap(J.color):w.isSome(J.material)?w.unwrap(J.material.color):null});return H?new r(H):null}function u(M,H){if(null==H)return M;M=M.toRgba();M[3]*=H;return new r(M)}function t(M,H,J){if(M=M.symbolLayers){var O=I=>{I=w.isSome(I)?I:null;H=H||I||null!=J&&K;return u(H,J)};M.forEach(I=>{if("object"!==I.type||null==I.resource.href||H)if("water"===I.type)I.color=
O(I.color);else{var F=w.isSome(I.material)?I.material.color:null;F=O(F);w.isNone(I.material)?I.material=new d["default"]({color:F}):I.material.color=F;null!=J&&"outline"in I&&w.isSome(I.outline)&&w.isSome(I.outline.color)&&(I.outline.color=u(I.outline.color,J))}})}}function h(M,H){return m.apply(this,arguments)}function m(){m=b._asyncToGenerator(function*(M,H){(M=M.symbolLayers)&&(yield y.forEach(M,function(){var J=b._asyncToGenerator(function*(O){return n(O,H)});return function(O){return J.apply(this,
arguments)}}()))});return m.apply(this,arguments)}function n(M,H){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(M,H){switch(M.type){case "extrude":M.size="number"===typeof H[2]?H[2]:0;break;case "icon":case "line":case "text":H=k(H);w.isSome(H)&&(M.size=H);break;case "path":{const J=C(H,l.ONES,[M.width,void 0,M.height]);M.width=D(H[0],M.width,1,J);M.height=D(H[2],M.height,1,J)}break;case "object":yield v(M,H)}});return z.apply(this,arguments)}function k(M){for(const H of M)if("number"===
typeof H)return H;return null}function v(M,H){return x.apply(this,arguments)}function x(){x=b._asyncToGenerator(function*(M,H){const {resourceSize:J,symbolSize:O}=yield A(M),I=C(H,J,O);M.width=D(H[0],O[0],J[0],I);M.depth=D(H[1],O[1],J[1],I);M.height=D(H[2],O[2],J[2],I)});return x.apply(this,arguments)}function C(M,H,J){for(let O=0;3>O;O++){const I=M[O];switch(I){case "symbol-value":return null!=J[O]?J[O]/H[O]:1;case "proportional":break;default:if(I&&H[O])return I/H[O]}}return 1}function A(M){return B.apply(this,
arguments)}function B(){B=b._asyncToGenerator(function*(M){const H=yield(yield new Promise(function(N,R){a(["./symbolLayerUtils"],N,R)})).computeObjectLayerResourceSize(M,10),{width:J,height:O,depth:I}=M;M=[J,I,O];let F=1;for(var L=0;3>L;L++)if(null!=M[L]){F=M[L]/H[L];break}for(L=0;3>L;L++)null==M[L]&&(M[L]=H[L]*F);return{resourceSize:H,symbolSize:M}});return B.apply(this,arguments)}function D(M,H,J,O){switch(M){case "proportional":return J*O;case "symbol-value":return null!=H?H:J;default:return M}}
function E(){E=b._asyncToGenerator(function*(M,H){if(M&&H){if(q.isSymbol3D(M))return h(M,H);if(q.isSymbol2D(M)&&(H=k(H),!w.isNone(H)))switch(M.type){case "simple-marker":M.size=H;break;case "picture-marker":{const J=M.width/M.height;1<J?(M.width=H,M.height=H*J):(M.width=H*J,M.height=H);break}case "simple-line":M.width=H;break;case "text":M.font.size=H}}});return E.apply(this,arguments)}const G=/\/resource\/(.*?)\.svg$/,K=new r("white");p.applyColorToSymbol=function(M,H,J){if(M&&(H||null!=J))if(H&&
(H=new r(H)),q.isSymbol3D(M))t(M,H,J);else if(q.isSymbol2D(M)){if(H=H||M.color)M.color=u(H,J);null!=J&&"outline"in M&&M.outline&&M.outline.color&&(M.outline.color=u(M.outline.color,J))}};p.applyOpacityToColor=u;p.applyRotationToSymbol=function(M,H,J){M&&null!=H&&(q.isSymbol3D(M)?(M=M.symbolLayers)&&M.forEach(O=>{if(O&&"object"===O.type)switch(J){case "tilt":O.tilt=H;break;case "roll":O.roll=H;break;default:O.heading=H}}):!q.isSymbol2D(M)||"simple-marker"!==M.type&&"picture-marker"!==M.type&&"text"!==
M.type||(M.angle=H))};p.applySizesToSymbol=function(M,H){return E.apply(this,arguments)};p.getColorFromSymbol=function(M,H){if(!M)return null;let J=null;q.isSymbol3D(M)?J=c(M):q.isSymbol2D(M)&&(J=M.color?new r(M.color):null);return J?u(J,H):null};p.getIconHref=function(M,H){H=H.resource.href;return!f("esri-canvas-svg-support")&&M.styleOrigin&&G.test(H)?H.replace(G,"/resource/png/$1.png"):H};p.getSymbolOutlineSize=function(M){if(!M)return 0;if(q.isSymbol3D(M)){{const H=M.symbolLayers&&M.symbolLayers.length;
H?(M=M.symbolLayers.getItemAt(H-1),M="outline"in M?w.get(M,"outline","size"):void 0):M=void 0}return w.isSome(M)?M:0}return(M=g.getStroke(M))&&e.px2pt(M.width)||0};p.isVolumetricSymbol=function(M){if(w.isNone(M)||!("symbolLayers"in M)||w.isNone(M.symbolLayers))return!1;switch(M.type){case "point-3d":return M.symbolLayers.some(H=>"object"===H.type);case "line-3d":return M.symbolLayers.some(H=>"path"===H.type);case "polygon-3d":return M.symbolLayers.some(H=>"object"===H.type||"extrude"===H.type);default:return!1}};
Object.defineProperty(p,"__esModule",{value:!0})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/ItemCache ../../core/screenUtils ./cimSymbolUtils".split(" "),function(a,p,b,r,q,y,f){function w(c){if(!c)return null;let u;switch(c.type){case "simple-fill":case "picture-fill":case "simple-marker":u=w(c.outline);break;case "simple-line":{const t=y.pt2px(c.width);"none"!==c.style&&0!==t&&(u={color:c.color,style:d(c.style),width:t,cap:c.cap,
join:"miter"===c.join?y.pt2px(c.miterLimit):c.join});break}default:u=null}return u}const e={left:"start",center:"middle",right:"end",justify:"start"},l={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},g=new q(1E3),d=function(){const c={};return function(u){if(c[u])return c[u];const t=u.replace(/-/g,"");return c[u]=t}}();b=new b([128,128,128]);a.defaultThematicColor=b;a.dekebabifyLineStyle=d;a.getFill=function(c){const u=c.style;let t=null;if(c)switch(c.type){case "simple-marker":"cross"!==
u&&"x"!==u&&(t=c.color);break;case "simple-fill":"solid"===u?t=c.color:"none"!==u&&(t={type:"pattern",x:0,y:0,src:p.getAssetUrl(`esri/symbols/patterns/${u}.png`),width:5,height:5});break;case "picture-fill":t={type:"pattern",src:c.url,width:y.pt2px(c.width)*c.xscale,height:y.pt2px(c.height)*c.yscale,x:y.pt2px(c.xoffset),y:y.pt2px(c.yoffset)};break;case "text":t=c.color;break;case "cim":t=f.getCIMSymbolColor(c)}return t};a.getPatternUrlWithColor=function(c,u){const t=c+"-"+u;return void 0!==g.get(t)?
Promise.resolve(g.get(t)):r(c,{responseType:"image"}).then(h=>{h=h.data;const m=h.naturalWidth,n=h.naturalHeight,z=document.createElement("canvas");z.width=m;z.height=n;const k=z.getContext("2d");k.fillStyle=u;k.fillRect(0,0,m,n);k.globalCompositeOperation="destination-in";k.drawImage(h,0,0);h=z.toDataURL();g.put(t,h);return h})};a.getSVGAlign=function(c){return c=(c=c.horizontalAlignment)&&e[c.toLowerCase()]||"middle"};a.getSVGBaseline=function(c){return(c=c.verticalAlignment)&&l[c.toLowerCase()]||
"alphabetic"};a.getSVGBaselineShift=function(c){return"bottom"===c.verticalAlignment?"super":null};a.getStroke=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/ItemCache":function(){define(["./MemCache"],function(a){return function(){function p(r,q){this._storage=new a.MemCacheStorage;this._storage.maxSize=r;q&&this._storage.registerRemoveFunc("",q)}var b=p.prototype;b.put=function(r,q){this._storage.put(r,q,1,1)};b.pop=function(r){return this._storage.pop(r)};b.get=function(r){return this._storage.get(r)};
b.clear=function(){this._storage.clearAll()};b.destroy=function(){this._storage.destroy()};return p}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,p,b){function r(d){d=b.toCIMSymbolJSON(d);if("CIMTextSymbol"===d.type)return d.height;let c=0;if(d.symbolLayers)for(const u of d.symbolLayers)b.isCIMMarker(u)&&u.size>c?c=u.size:b.isCIMStroke(u)&&u.width>c?c=u.width:b.isCIMFill(u);return c}function q(d,c,u,t){if("CIMTextSymbol"===d.type)d.height*=
c;else{if(u&&d.effects)for(const h of d.effects)w(h,c);if(d.symbolLayers)for(const h of d.symbolLayers)switch(h.type){case "CIMPictureMarker":case "CIMVectorMarker":y(h,c,t);break;case "CIMPictureStroke":case "CIMSolidStroke":null!=t&&t.preserveOutlineWidth||(h.width*=c);break;case "CIMPictureFill":h.height*=c;h.offsetX*=c;h.offsetY*=c;break;case "CIMHatchFill":q(h.lineSymbol,c,!0,{...t,preserveOutlineWidth:!1}),h.offsetX*=c,h.offsetY*=c,h.separation*=c}}}function y(d,c,u){d.markerPlacement&&f(d.markerPlacement,
c);d.offsetX*=c;d.offsetY*=c;d.anchorPoint&&"Absolute"===d.anchorPointUnits&&(d.anchorPoint={x:d.anchorPoint.x*c,y:d.anchorPoint.y*c});d.size*=c;if("CIMVectorMarker"===d.type&&d.markerGraphics)for(const t of d.markerGraphics)d.scaleSymbolsProportionally||q(t.symbol,c,!0,u)}function f(d,c){b.isCIMMarkerStrokePlacement(d)&&(d.offset*=c);switch(d.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":d.customEndingOffset*=c;d.offsetAlongLine*=c;if(d.placementTemplate&&
d.placementTemplate.length){var u=d.placementTemplate.map(t=>t*c);d.placementTemplate=u}break;case "CIMMarkerPlacementAlongLineVariableSize":d.maxRandomOffset*=c;d.placementTemplate&&d.placementTemplate.length&&(u=d.placementTemplate.map(t=>t*c),d.placementTemplate=u);break;case "CIMMarkerPlacementOnLine":d.startPointOffset*=c;break;case "CIMMarkerPlacementAtExtremities":d.offsetAlongLine*=c;break;case "CIMMarkerPlacementAtRatioPositions":d.beginPosition*=c;d.endPosition*=c;break;case "CIMMarkerPlacementPolygonCenter":d.offsetX*=
c;d.offsetY*=c;break;case "CIMMarkerPlacementInsidePolygon":d.offsetX*=c,d.offsetY*=c,d.stepX*=c,d.stepY*=c}}function w(d,c){switch(d.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":d.width*=c;break;case "CIMGeometricEffectBuffer":d.size*=c;break;case "CIMGeometricEffectCut":d.beginCut*=c;d.endCut*=c;d.middleCut*=c;break;case "CIMGeometricEffectDashes":d.customEndingOffset*=c;d.offsetAlongLine*=c;if(d.dashTemplate&&d.dashTemplate.length){const u=d.dashTemplate.map(t=>t*c);d.dashTemplate=
u}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":d.length*=c;break;case "CIMGeometricEffectMove":d.offsetX*=c;d.offsetY*=c;break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":d.offset*=c;break;case "CIMGeometricEffectRegularPolygon":d.radius*=c;break;case "CIMGeometricEffectTaperedPolygon":d.fromWidth*=c;d.length*=c;d.toWidth*=c;break;case "CIMGeometricEffectWave":d.amplitude*=c,d.period*=c}}function e(d,c){let u;u="CIMTextSymbol"===
d.type?d.symbol:d;d="CIMPolygonSymbol"===d.type;if(u.symbolLayers)for(const t of u.symbolLayers)if(!(t.colorLocked||d&&(b.isCIMStroke(t)||b.isCIMMarker(t)&&t.markerPlacement&&b.isCIMMarkerStrokePlacement(t.markerPlacement))))switch(t.type){case "CIMVectorMarker":t.markerGraphics.forEach(h=>{e(h.symbol,c)});break;case "CIMSolidStroke":case "CIMSolidFill":l(c,t.color);break;case "CIMHatchFill":e(t.lineSymbol,c)}}function l(d,c){for(const u of d)if(u.join(".")===c.join("."))return;d.push(c)}function g(d,
c){var u="CIMTextSymbol"===d.type?d.symbol:d;d="CIMPolygonSymbol"===d.type?!0:!1;if(u.symbolLayers)for(const t of u.symbolLayers)if(!(t.colorLocked||d&&(b.isCIMStroke(t)||b.isCIMMarker(t)&&t.markerPlacement&&b.isCIMMarkerStrokePlacement(t.markerPlacement))))switch(u=c.toArray(0),t.type){case "CIMVectorMarker":t.markerGraphics.forEach(h=>{g(h.symbol,c)});break;case "CIMSolidStroke":case "CIMSolidFill":t.color=u;break;case "CIMHatchFill":g(t.lineSymbol,c)}}a.applyCIMSymbolColor=function(d,c){c instanceof
p||(c=new p(c));d=b.toCIMSymbolJSON(d);g(d,c)};a.applyCIMSymbolRotation=function(d,c,u=!1){d=b.toCIMSymbolJSON(d);u&&0!==c&&(c=360-c);if("CIMTextSymbol"===d.type)d.angle=c;else if("CIMPointSymbol"===d.type&&d.symbolLayers){u=c-(d.angle||0);for(const t of d.symbolLayers)if(b.isCIMMarker(t)){let h=t.rotation||0;h=t.rotateClockwise?h-u:h+u;t.rotation=h}d.angle=c}};a.getCIMSymbolColor=function(d){d=b.toCIMSymbolJSON(d);const c=[];e(d,c);return c.length?new p(b.fromCIMColor(c[0])):null};a.getCIMSymbolRotation=
function(d,c=!1){d=b.toCIMSymbolJSON(d);return"CIMTextSymbol"===d.type||"CIMPointSymbol"===d.type?c&&0!==d.angle?360-d.angle:d.angle||0:0};a.getCIMSymbolSize=r;a.scaleCIMMarker=y;a.scaleCIMSymbolTo=function(d,c,u){const t=b.toCIMSymbolJSON(d);d=r(d);if(0===d)if("CIMTextSymbol"===t.type)t.height=c;else{if(t.symbolLayers)for(const h of t.symbolLayers)switch(h.type){case "CIMPictureMarker":case "CIMVectorMarker":h.size=c;break;case "CIMPictureStroke":case "CIMSolidStroke":h.width=c}}else q(t,c/d,!1,
u)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/symbols/cim/utils":function(){define(["exports"],function(a){function p(b,r){"string"!==typeof b&&(b=String(b));switch(r){case "LowerCase":return b.toLowerCase();case "Allcaps":return b.toUpperCase();default:return b}}a._adjustTextCase=p;a.colorToArray=function(b){return[b.r,b.g,b.b,b.a]};a.createLabelOverrideFunction=function(b,r,q){const y=l=>{let g=l.length;for(;g--;)if(-1===" /-,\n".indexOf(l.charAt(g)))return!1;return!0},f=[];var w=
0;let e=-1;do e=r.indexOf("[",w),e>=w&&(e>w&&(w=r.substr(w,e-w),f.push([w,null,y(w)])),w=e+1,e=r.indexOf("]",w),e>=w&&(e>w&&(w=r.substr(w,e-w),(w=b[w])&&f.push([null,w,!1])),w=e+1));while(-1!==e);w<r.length-1&&(b=r.substr(w),f.push([b,null,y(b)]));return l=>{let g="",d=null;for(const c of f){const [u,t,h]=c;if(u)h?d=u:(d&&(g+=d,d=null),g+=u);else{const m=l.attributes[t];m&&(d&&(g+=d,d=null),g+=m)}}return p(g,q)}};a.evaluateValueOrFunction=function(b,r,q,y){return"function"===typeof b?b(r,q,y):b};
a.fromCIMColor=function(b){return b?{r:b[0],g:b[1],b:b[2],a:b[3]/255}:{r:0,g:0,b:0,a:0}};a.isCIMFill=function(b){return"CIMGradientFill"===b.type||"CIMHatchFill"===b.type||"CIMPictureFill"===b.type||"CIMSolidFill"===b.type||"CIMWaterFill"===b.type};a.isCIMMarker=function(b){return"CIMVectorMarker"===b.type||"CIMPictureMarker"===b.type||"CIMBarChartMarker"===b.type||"CIMCharacterMarker"===b.type||"CIMPieChartMarker"===b.type||"CIMStackedBarChartMarker"===b.type};a.isCIMMarkerStrokePlacement=function(b){return"CIMMarkerPlacementAlongLineRandomSize"===
b.type||"CIMMarkerPlacementAlongLineSameSize"===b.type||"CIMMarkerPlacementAlongLineVariableSize"===b.type||"CIMMarkerPlacementAtExtremities"===b.type||"CIMMarkerPlacementAtMeasuredUnits"===b.type||"CIMMarkerPlacementAtRatioPositions"===b.type||"CIMMarkerPlacementOnLine"===b.type||"CIMMarkerPlacementOnVertices"===b.type};a.isCIMStroke=function(b){return"CIMGradientStroke"===b.type||"CIMPictureStroke"===b.type||"CIMSolidStroke"===b.type};a.resampleHermite=function(b,r,q,y,f,w,e=!0){const l=r/f;q/=
w;const g=Math.ceil(l/2),d=Math.ceil(q/2);for(let t=0;t<w;t++)for(let h=0;h<f;h++){const m=4*(h+(e?w-t-1:t)*f);var c=0;let n=0,z=0,k=0,v=0,x=0,C=0;const A=(t+.5)*q;for(let B=Math.floor(t*q);B<(t+1)*q;B++){var u=Math.abs(A-(B+.5))/d;const D=(h+.5)*l;u*=u;for(let E=Math.floor(h*l);E<(h+1)*l;E++){let G=Math.abs(D-(E+.5))/g;c=Math.sqrt(u+G*G);-1<=c&&1>=c&&(c=2*c*c*c-3*c*c+1,0<c&&(G=4*(E+B*r),C+=c*b[G+3],z+=c,255>b[G+3]&&(c=c*b[G+3]/250),k+=c*b[G],v+=c*b[G+1],x+=c*b[G+2],n+=c))}}y[m]=k/n;y[m+1]=v/n;y[m+
2]=x/n;y[m+3]=C/z}};a.toCIMSymbolJSON=function(b){var r;return null==(r=b.data)?void 0:r.symbol};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/layerViewUtils":function(){define(["exports","../../core/maybe"],function(a,p){a.extractSafeScaleBounds=function(b){let {minScale:r,maxScale:q}=b;return{minScale:r||0,maxScale:q||0}};a.highlightsSupported=function(b){return b&&"function"===typeof b.highlight};a.occludeesSupported=function(b){return b&&"function"===typeof b.maskOccludee};
a.scaleBoundsPredicate=function(b,r,q){return p.isNone(b)||b>q&&(0===r||b<r)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Popup/actions":function(){define(["exports","../../support/actions/ActionButton"],function(a,p){const b=new p({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),r=new p({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),q=new p({id:"zoom-to-clustered-features",title:"{messages.zoom}",
className:"esri-icon-zoom-in-magnifying-glass"});p=new p({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"});a.all=[b,r,p,q];a.browseClusteredFeatures=p;a.removeSelectedFeature=r;a.zoomToClusteredFeatures=q;a.zoomToFeature=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Popup/actionUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/Error","../../core/Logger","./actions"],function(a,p,b,r,
q){function y(t){const {selectedFeature:h,location:m,view:n}=t;return n?"3d"===n.type?h||m:t.get("selectedFeature.geometry")||m:null}function f(t,h){if("3d"!==(null==h?void 0:h.type)||!t||"esri.Graphic"!==t.declaredClass)return!0;if((h=h.getViewForGraphic(t))&&"whenGraphicBounds"in h){let m=!1;h.whenGraphicBounds(t,{useViewElevation:!0}).then(n=>{m=!n||!n.boundingBox||n.boundingBox[0]===n.boundingBox[3]&&n.boundingBox[1]===n.boundingBox[4]&&n.boundingBox[2]===n.boundingBox[5]}).catch(()=>{const n=
new b("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:t});u.error(n)});return m}return!0}function w(t){return e.apply(this,arguments)}function e(){e=p._asyncToGenerator(function*(t){const {location:h,selectedFeature:m,view:n,zoomFactor:z}=t,k=y(t);if(!k)return t=new b("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:k,view:n}),u.error(t),Promise.reject(t);const v=n.scale/z,x=t.get("selectedFeature.geometry")||h,C=x&&
"point"===x.type&&f(m,n);q.zoomToFeature.active=!0;q.zoomToFeature.disabled=!0;yield t.view.goTo({target:k,scale:C?v:void 0});q.zoomToFeature.active=!1;q.zoomToFeature.disabled=!1;t.zoomToLocation=null;C&&(t.location=x)});return e.apply(this,arguments)}function l(t){return g.apply(this,arguments)}function g(){g=p._asyncToGenerator(function*(t){const {selectedFeature:h,view:m}=t;if("2d"!==(null==m?void 0:m.type))throw t=new b("zoomToCluster:invalid-view","View must be 2d MapView.",{view:m}),u.error(t),
t;if(!h.isAggregate)throw t=new b("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:h}),u.error(t),t;t=yield m.whenLayerView(h.sourceLayer);const n=t.createQuery();n.aggregateIds=[h.getObjectId()];q.zoomToClusteredFeatures.active=!0;q.zoomToClusteredFeatures.disabled=!0;({extent:t}=yield t.queryExtent(n));yield m.goTo({target:t});q.zoomToClusteredFeatures.active=!1;q.zoomToClusteredFeatures.disabled=!1});return g.apply(this,arguments)}
function d(){d=p._asyncToGenerator(function*(t){const {selectedFeature:h,view:m}=t;if("2d"!==(null==m?void 0:m.type))throw t=new b("displayClusterExtent:invalid-view","View must be 2d MapView.",{view:m}),u.error(t),t;if(!h.isAggregate)throw t=new b("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:h}),u.error(t),t;var n=yield m.whenLayerView(h.sourceLayer);const z=n.createQuery();z.aggregateIds=[h.getObjectId()];({extent:n}=yield n.queryExtent(z));
t.selectedClusterBoundaryFeature.geometry=n;m.graphics.add(t.selectedClusterBoundaryFeature)});return d.apply(this,arguments)}function c(){c=p._asyncToGenerator(function*(t){const {selectedFeature:h,view:m}=t;if("2d"!==(null==m?void 0:m.type))throw t=new b("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:m}),u.error(t),t;if(!h.isAggregate)throw t=new b("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:h}),
u.error(t),t;t=yield m.whenLayerView(h.sourceLayer);const n=t.createQuery();n.aggregateIds=[h.getObjectId()];q.browseClusteredFeatures.active=!0;q.browseClusteredFeatures.disabled=!0;({features:t}=yield t.queryFeatures(n));q.browseClusteredFeatures.active=!1;q.browseClusteredFeatures.disabled=!1;m.popup.open({features:[h].concat(t),featureMenuOpen:!0})});return c.apply(this,arguments)}const u=r.getLogger("esri.widgets.Popup.PopupViewModel");a.browseAggregateFeatures=function(t){return c.apply(this,
arguments)};a.displayClusterExtent=function(t){return d.apply(this,arguments)};a.getSelectedTarget=y;a.isZoomScreenSize=f;a.removeClusteredFeaturesForBrowsing=function(t){t.features=t.features.filter(h=>h.isAggregate)};a.triggerAction=function(t){const {event:h,view:m}=t;({action:t}=h);var n=m&&m.popup;if(!t)return Promise.reject(new b("trigger-action:missing-arguments","Event has no action"));if(!n)return Promise.reject(new b("trigger-action:missing-arguments","view.popup is missing"));const {disabled:z,
id:k}=t;if(!k)return Promise.reject(new b("trigger-action:invalid-action","action.id is missing"));if(z)return Promise.reject(new b("trigger-action:invalid-action","Action is disabled"));if(k===q.zoomToFeature.id)return w(n.viewModel);if(k===q.zoomToClusteredFeatures.id)return l(n.viewModel);if(k===q.browseClusteredFeatures.id)return n.featureMenuOpen=!n.featureMenuOpen,n.viewModel.browseClusterEnabled=!n.viewModel.browseClusterEnabled,Promise.resolve();n.viewModel.browseClusterEnabled=!1;if(k===
q.removeSelectedFeature.id){n.close();({selectedFeature:t}=n);if(!t)return Promise.reject(new b(`trigger-action:${q.removeSelectedFeature.id}`,"selectedFeature is required",{selectedFeature:t}));({sourceLayer:n}=t);n?n.remove(t):m.graphics.remove(t)}return Promise.resolve()};a.zoomToClusterExtent=l;a.zoomToLocation=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w){a.GoToMixin=e=>{e=function(l){function g(...d){d=l.call(this,...d)||this;d.goToOverride=null;d.view=null;return d}p._inheritsLoose(g,l);g.prototype.callGoTo=function(d){const {view:c}=this;return this.goToOverride?this.goToOverride(c,d):c.goTo(d.target,d.options)};return g}(e);b.__decorate([r.property()],e.prototype,"goToOverride",void 0);b.__decorate([r.property()],e.prototype,"view",void 0);return e=b.__decorate([w.subclass("esri.widgets.support.GoTo")],e)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/subclass ./support/GroundViewElevationSampler".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d){b=function(c){function u(h){h=c.call(this,h)||this;h.handles=new q;h.view=
null;h.layerViews=new r;return h}a._inheritsLoose(u,c);var t=u.prototype;t.initialize=function(){this.handles.add(y.when(this,"view.map.ground",h=>h.load()));this.handles.add(this.layerViews.on("after-changes",()=>this.layerViewsAfterChangesHandler()))};t.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};t.layerViewsAfterChangesHandler=function(){this.handles.remove("updating");this.handles.add(this.layerViews.map(h=>h.watch("updating",()=>this.updateUpdating(),
!0)).toArray(),"updating");this.updateUpdating()};t.updateUpdating=function(){this.notifyChange("updating")};a._createClass(u,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new d({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?!1:this.layerViews.some(h=>h.updating)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}}]);return u}(b);p.__decorate([f.property({readOnly:!0})],
b.prototype,"elevationSampler",null);p.__decorate([f.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);p.__decorate([f.property({constructOnly:!0})],b.prototype,"view",void 0);p.__decorate([f.property({type:r,readOnly:!0})],b.prototype,"layerViews",void 0);p.__decorate([f.property({readOnly:!0})],b.prototype,"suspended",null);return b=p.__decorate([g.subclass("esri.views.GroundView")],b)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/support/ElevationProvider ../3d/terrain/TerrainConst".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){const h=r.getLogger("esri.views.support.GroundViewElevationSampler");b=function(m){function n(k){k=m.call(this,k)||this;k.demResolution={min:-1,max:-1};k.noDataValue=t.ELEVATION_NODATA_VALUE;return k}a._inheritsLoose(n,m);var z=n.prototype;z.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};z.elevationAt=function(k){var v=k.spatialReference;const x=this.spatialReference;if(!d.canProject(v,x))return h.error(`Cannot sample elevation at a location with spatial reference (${v?
v.wkid:"unknown"}) different from the view (${x.wkid})`),null;if(q.isNone(this.extent)||!g.extentContainsPoint(this.extent,k))v=q.isSome(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null,h.warn("#elevationAt()",`Point used to sample elevation (${k.x}, ${k.y}) is outside of the sampler extent (${v})`);return u.getElevationAtPoint(this.view.elevationProvider,k)};z.queryElevation=function(k){return c.updateGeometryElevation(k.clone(),this)};a._createClass(n,
[{key:"extent",get:function(){const k=this.view.basemapTerrain;return q.isSome(k.extent)&&k.spatialReference?l.toExtent(k.extent,k.spatialReference):null}}]);return n}(b.EventedAccessor);p.__decorate([y.property({readOnly:!0})],b.prototype,"demResolution",void 0);p.__decorate([y.property({readOnly:!0})],b.prototype,"extent",null);p.__decorate([y.property({readOnly:!0})],b.prototype,"noDataValue",void 0);p.__decorate([y.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],b.prototype,
"spatialReference",void 0);p.__decorate([y.property({constructOnly:!0})],b.prototype,"view",void 0);return b=p.__decorate([e.subclass("esri.views.support.GroundViewElevationSampler")],b)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){function d(n,z){const k=c(n,z.spatialReference);if(!k)return null;switch(n.type){case "point":n.z=y.unwrapOr(z.elevationAt(k),0);break;case "polyline":h.spatialReference=k.spatialReference;var v=n.hasM&&!n.hasZ;for(var x=0;x<n.paths.length;x++){var C=n.paths[x],A=k.paths[x];for(let B=0;B<C.length;B++){const D=C[B],E=A[B];h.x=E[0];h.y=E[1];v&&(D[3]=D[2]);D[2]=y.unwrapOr(z.elevationAt(h),0)}}n.hasZ=!0;break;case "multipoint":h.spatialReference=k.spatialReference;v=n.hasM&&
!n.hasZ;for(x=0;x<n.points.length;x++)C=n.points[x],A=k.points[x],h.x=A[0],h.y=A[1],v&&(C[3]=C[2]),C[2]=y.unwrapOr(z.elevationAt(h),0);n.hasZ=!0}return n}function c(n,z){if(y.isNone(n))return null;const k=n.spatialReference;if(k.equals(z))return n;(n=l.project(n,z))||u.error(`Cannot project geometry spatial reference (wkid:${k.wkid}) to elevation sampler spatial reference (wkid:${z.wkid})`);return n}const u=q.getLogger("esri.layers.support.ElevationSampler");b=function(){function n(){}var z=n.prototype;
z.queryElevation=function(k){return d(k.clone(),this)};z.on=function(){return m};z.projectIfRequired=function(k,v){return c(k,v)};return n}();let t=function(n){function z(v,x,C){var A=n.call(this)||this;A.tile=v;A.noDataValue=C;A.extent=w.toExtent(v.tile.extent,x.spatialReference);C=f.getMetersPerUnitForSR(x.spatialReference);v=x.lodAt(v.tile.level).resolution*C;A.demResolution={min:v,max:v};return A}p._inheritsLoose(z,n);var k=z.prototype;k.contains=function(v){v=this.projectIfRequired(v,this.spatialReference);
return e.extentContainsPoint(this.extent,v)};k.elevationAt=function(v){const x=this.projectIfRequired(v,this.spatialReference);if(y.isNone(x))return null;if(!this.contains(v)){const C=this.extent;u.warn("#elevationAt()",`Point used to sample elevation (${v.x}, ${v.y}) is outside of the sampler extent (${`${C.xmin}, ${C.ymin}, ${C.xmax}, ${C.ymax}`})`)}return this.tile.sample(x.x,x.y)};p._createClass(z,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return z}(b);r=function(n){function z(k,
v,x){var C=n.call(this)||this;let A;"number"===typeof v?(C.noDataValue=v,A=null):(A=v,C.noDataValue=x);C.samplers=A?k.map(B=>new t(B,A,C.noDataValue)):k;if(k=C.samplers[0]){C.extent=k.extent.clone();const {min:B,max:D}=k.demResolution;C.demResolution={min:B,max:D};for(k=1;k<C.samplers.length;k++)v=C.samplers[k],C.extent.union(v.extent),C.demResolution.min=Math.min(C.demResolution.min,v.demResolution.min),C.demResolution.max=Math.max(C.demResolution.max,v.demResolution.max)}else C.extent=w.toExtent(w.create(),
A.spatialReference),C.demResolution={min:0,max:0};return C}p._inheritsLoose(z,n);z.prototype.elevationAt=function(k){const v=this.projectIfRequired(k,this.spatialReference);if(!v)return null;for(const x of this.samplers)if(x.contains(v))return x.elevationAt(v);u.warn("#elevationAt()",`Point used to sample elevation (${k.x}, ${k.y}) is outside of the sampler`);return null};p._createClass(z,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return z}(b);const h=new g,m=
{remove(){}};a.ElevationSamplerBase=b;a.MultiTileElevationSampler=r;a.TileElevationSampler=t;a.updateGeometryElevation=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../core/maybe","../../../layers/graphics/dehydratedFeatureUtils"],function(a,p,b){function r(q){return"array"in q}a.SamplePosition=function(q,y=null,f=0){this.array=q;this.spatialReference=y;this.offset=f};a.getElevationAtPoint=function(q,y,f="ground"){if(b.isDehydratedPoint(y))return q.getElevation(y.x,
y.y,y.z||0,y.spatialReference,f);if(r(y)){let w=y.offset;return q.getElevation(y.array[w++],y.array[w++],y.array[w]||0,p.unwrapOr(y.spatialReference,q.spatialReference),f)}return q.getElevation(y[0],y[1],y[2]||0,q.spatialReference,f)};a.isSamplePosition=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(p){return"point"===p.type};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,p,b,r){p=p.clampFloat32(p.NUMBER_MAX_FLOAT32/10);const q=b.create();r.WebMercatorAuxiliarySphere.getExtent(0,0,0,q);b=b.create([-180,-90,180,90]);a.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
a.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;a.ELEVATION_NODATA_VALUE=p;a.GEOGRAPHIC_WORLD_EXTENT=b;a.GEOMETRY_VERTEX_STRIDE=5;a.LayerClasses=[0,1];a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.PROGRESSIVE_LOADING_MODULO=4;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";
a.WEBMERCATOR_WORLD_EXTENT=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TilingScheme":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/TileInfo".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){let c=function(){function t(m){var n=t.checkUnsupported(m);if(n)throw n;this.spatialReference=m.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=f.canProjectToWGS84ComparableLonLat(this.spatialReference)||l.isMars(this.spatialReference)||l.isMoon(this.spatialReference);this.origin=[m.origin.x,m.origin.y];this.pixelSize=m.size[0];this.dpi=m.dpi;var z=m.lods.reduce(function(x,C,A){C.level<x.min&&(x.min=C.level,x.minIndex=A);x.max=
Math.max(x.max,C.level);return x},{min:Infinity,minIndex:0,max:-Infinity}),k=m.lods[z.minIndex];const v=2**k.level;n=k.resolution*v;k=k.scale*v;this.levels=Array(z.max+1);for(z=0;z<this.levels.length;z++)this.levels[z]={resolution:n,scale:k,tileSize:[n*m.size[0],n*m.size[1]]},n/=2,k/=2}var h=t.prototype;h.clone=function(){return new t(this.toTileInfo())};h.toTileInfo=function(){return new d({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,
this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((m,n)=>({level:n,scale:m.scale,resolution:m.resolution}))})};h.getExtent=function(m,n,z,k){var v=this.levels[m];m=v.tileSize[0];v=v.tileSize[1];k[0]=this.origin[0]+z*m;k[2]=k[0]+m;k[3]=this.origin[1]-n*v;k[1]=k[3]-v};h.convertExtentToRadians=function(m,n){this._isWebMercator?(n[0]=g.x2lon(m[0]),n[1]=g.y2lat(m[1]),n[2]=g.x2lon(m[2]),n[3]=g.y2lat(m[3])):this._isGCS&&(n[0]=b.deg2rad(m[0]),n[1]=b.deg2rad(m[1]),n[2]=b.deg2rad(m[2]),
n[3]=b.deg2rad(m[3]))};h.getExtentGeometry=function(m,n,z,k=new y){this.getExtent(m,n,z,u);k.spatialReference=this.spatialReference;k.xmin=u[0];k.ymin=u[1];k.xmax=u[2];k.ymax=u[3];k.zmin=void 0;k.zmax=void 0;return k};h.ensureMaxLod=function(m){if(null==m)return!1;for(var n=!1;this.levels.length<=m;){n=this.levels[this.levels.length-1];const z=n.resolution/2;this.levels.push({resolution:z,scale:n.scale/2,tileSize:[z*this.pixelSize,z*this.pixelSize]});n=!0}return n};h.capMaxLod=function(m){this.levels.length>
m+1&&(this.levels.length=m+1)};h.getMaxLod=function(){return this.levels.length-1};h.scaleAtLevel=function(m){return this.levels[0].scale/2**m};h.levelAtScale=function(m){const n=this.levels[0].scale;return m>=n?0:Math.log(n/m)*Math.LOG2E};h.resolutionAtLevel=function(m){return this.levels[0].resolution/2**m};h.compatibleWith=function(m){if(!(m instanceof t)){if(t.checkUnsupported(m))return!1;m=new t(m)}if(!m.spatialReference.equals(this.spatialReference)||m.pixelSize!==this.pixelSize)return!1;const n=
Math.min(this.levels.length,m.levels.length)-1,z=this.levels[n].resolution;let k=.5*z;if(!b.floatEqualAbsolute(m.origin[0],this.origin[0],k)||!b.floatEqualAbsolute(m.origin[1],this.origin[1],k))return!1;k=.5*z/2**n/this.pixelSize*12;return b.floatEqualAbsolute(z,m.levels[n].resolution,k)};h.rootTilesInExtent=function(m,n=null,z=Infinity){const k=[],v=this.levels[0].tileSize;if(r.isNone(m)||0===v[0]||0===v[1])return k;t.computeRowColExtent(m,v,this.origin,u);m=u[1];let x=u[3],C=u[0],A=u[2];var B=A-
C;const D=x-m;B*D>z&&(z=Math.floor(Math.sqrt(z)),D>z&&(m=m+Math.floor(.5*D)-Math.floor(.5*z),x=m+z),B>z&&(C=C+Math.floor(.5*B)-Math.floor(.5*z),A=C+z));for(z=m;z<x;z++)for(B=C;B<A;B++)k.push([0,z,B]);r.isSome(n)&&(n[0]=this.origin[0]+C*v[0],n[1]=this.origin[1]-x*v[1],n[2]=this.origin[0]+A*v[0],n[3]=this.origin[1]-m*v[1]);return k};t.computeRowColExtent=function(m,n,z,k){const v=.001*(m[2]-m[0]+(m[3]-m[1]));k[0]=Math.max(0,Math.floor((m[0]+v-z[0])/n[0]));k[2]=Math.max(0,Math.ceil((m[2]-v-z[0])/n[0]));
k[1]=Math.max(0,Math.floor((z[1]-m[3]+v)/n[1]));k[3]=Math.max(0,Math.ceil((z[1]-m[1]-v)/n[1]))};t.isPowerOfTwo=function(m){m=m.lods;const n=m[0].resolution*2**m[0].level;return!m.some(function(z){return!b.floatEqualRelative(z.resolution,n/2**z.level)})};t.hasGapInLevels=function(m){m=m.lods.map(function(n){return n.level});m.sort(function(n,z){return n-z});for(let n=1;n<m.length;n++)if(m[n]!==m[0]+n)return!0;return!1};t.tileSizeSupported=function(m){const n=m.size[1];return n===m.size[0]&&0===(n&
n-1)&&128<=n&&512>=n};t.checkUnsupported=function(m){return m?1>m.lods.length?new p("tilingscheme:generic","Tiling scheme must have at least one level"):t.isPowerOfTwo(m)?t.hasGapInLevels(m)?new p("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):t.tileSizeSupported(m)?null:new p("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new p("tilingscheme:power-of-two","Tiling scheme must be power of two"):new p("tilingscheme:tile-info-missing",
"Tiling scheme must have tiling information")};t.fromExtent=function(m,n){const z=m[2]-m[0],k=m[3]-m[1],v=q.getMetersPerUnitForSR(n),x=1.2*Math.max(z,k);m=new t(new d({size:[256,256],origin:{x:m[0]-.5*(x-z),y:m[3]+.5*(x-k)},lods:[{level:0,resolution:x/256,scale:1/(256/96*.0254/(x*v))}],spatialReference:n}));m.ensureMaxLod(20);return m};t.makeWebMercatorAuxiliarySphere=function(m){const n=new t(t.WebMercatorAuxiliarySphereTileInfo);n.ensureMaxLod(m);return n};t.makeGCSWithTileSize=function(m,n=256,
z=16){const k=256/n;m=new t(new d({size:[n,n],origin:{x:-180,y:90,spatialReference:m},spatialReference:m,lods:[{level:0,resolution:.703125*k,scale:2.95497598570834E8*k}]}));m.ensureMaxLod(z);return m};a._createClass(t,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return t}();c.WebMercatorAuxiliarySphereTileInfo=new d({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:w.WebMercator},spatialReference:w.WebMercator,lods:[{level:0,
resolution:156543.03392800014,scale:5.91657527591555E8}]});c.WebMercatorAuxiliarySphere=c.makeWebMercatorAuxiliarySphere(19);const u=e.create();return c})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z){var k;b=new b.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});r=k=function(v){function x(A){A=v.call(this,A)||this;A.dpi=96;A.format=null;A.origin=null;A.minScale=0;A.maxScale=0;A.size=null;A.spatialReference=null;return A}a._inheritsLoose(x,v);x.create=function(A=
{}){const {resolutionFactor:B=1,scales:D,size:E=256,spatialReference:G=t.WebMercator,numLODs:K=24}=A;if(!m.isValid(G)){A=[];if(D)for(var M=0;M<D.length;M++){var H=D[M];A.push({level:M,scale:H,resolution:H})}else for(M=5E-4,H=K-1;0<=H;H--)A.unshift({level:H,scale:M,resolution:M}),M*=2;return new k({dpi:96,lods:A,origin:new u(0,0,G),size:[E,E],spatialReference:G})}M=m.getInfo(G);A=A.origin?new u({x:A.origin.x,y:A.origin.y,spatialReference:G}):M?new u({x:M.origin[0],y:M.origin[1],spatialReference:G}):
new u({x:0,y:0,spatialReference:G});M=1/(39.37*y.getMetersPerUnitForSR(G)*96);H=[];if(D)for(var J=0;J<D.length;J++){var O=D[J];H.push({level:J,scale:O,resolution:O*M})}else{var I=m.isGeographic(G)?512/E*5.916575275917094E8:256/E*5.91657527591555E8;J=Math.ceil(K/B);H.push({level:0,scale:I,resolution:I*M});for(O=1;O<J;O++)I/=2**B,H.push({level:O,scale:I,resolution:I*M})}return new k({dpi:96,lods:H,origin:A,size:[E,E],spatialReference:G})};var C=x.prototype;C.readOrigin=function(A,B){return u.fromJSON({spatialReference:B.spatialReference,
...A})};C.readSize=function(A,B){return[B.cols,B.rows]};C.writeSize=function(A,B){B.cols=A[0];B.rows=A[1]};C.zoomToScale=function(A){const B=this.scales;if(0>=A)return B[0];if(A>=B.length-1)return B[B.length-1];{const D=Math.floor(A);return B[D]/(B[D]/B[D+1])**(A-D)}};C.scaleToZoom=function(A){const B=this.scales,D=B.length-1;let E=0;for(;E<D;E++){const G=B[E],K=B[E+1];if(G<=A)break;if(K===A)return E+1;if(G>A&&K<A)return E+Math.log(G/A)/Math.log(G/K)}return E};C.snapScale=function(A,B=.95){A=this.scaleToZoom(A);
return A%Math.floor(A)>=B?this.zoomToScale(Math.ceil(A)):this.zoomToScale(Math.floor(A))};C.tileAt=function(A,B,D,E){var G=this.lodAt(A);if(!G)return null;let K;if("number"===typeof B)K=B,B=D;else{if(m.equals(B.spatialReference,this.spatialReference))K=B.x,B=B.y;else{E=n.project(B,this.spatialReference);if(q.isNone(E))return null;K=E.x;B=E.y}E=D}D=G.resolution*this.size[0];G=G.resolution*this.size[1];E||(E={id:null,level:0,row:0,col:0,extent:h.create()});E.level=A;E.row=Math.floor((this.origin.y-
B)/G+.001);E.col=Math.floor((K-this.origin.x)/D+.001);this.updateTileInfo(E);return E};C.updateTileInfo=function(A,B=0){var D=this.lodAt(A.level);D||1!==B||(B=this.lods[this.lods.length-1],B.level<A.level&&(D=B));if(D){var E=A.level-D.level;B=D.resolution*this.size[0]/2**E;D=D.resolution*this.size[1]/2**E;A.id=`${A.level}/${A.row}/${A.col}`;A.extent||(A.extent=h.create());A.extent[0]=this.origin.x+A.col*B;A.extent[1]=this.origin.y-(A.row+1)*D;A.extent[2]=A.extent[0]+B;A.extent[3]=A.extent[1]+D}};
C.upsampleTile=function(A){const B=this._upsampleLevels[A.level];if(!B||-1===B.parentLevel)return!1;A.level=B.parentLevel;A.row=Math.floor(A.row/B.factor+.001);A.col=Math.floor(A.col/B.factor+.001);this.updateTileInfo(A);return!0};C.getTileBounds=function(A,B){var {resolution:D}=this.lodAt(B.level);const E=D*this.size[0];D*=this.size[1];A[0]=this.origin.x+B.col*E;A[1]=this.origin.y-(B.row+1)*D;A[2]=A[0]+E;A[3]=A[1]+D;return A};C.lodAt=function(A){return this._levelToLOD&&this._levelToLOD[A]||null};
C.clone=function(){return k.fromJSON(this.write({}))};C._initializeUpsampleLevels=function(){const A=this.lods;this._upsampleLevels=[];let B=null;for(let D=0;D<A.length;D++){const E=A[D];this._upsampleLevels[E.level]={parentLevel:B?B.level:-1,factor:B?B.resolution/E.resolution:0};B=E}};a._createClass(x,[{key:"isWrappable",get:function(){const {spatialReference:A,origin:B}=this;if(A&&B){const D=m.getInfo(A);return A.isWrappable&&Math.abs(D.origin[0]-B.x)<=D.dx}return!1}},{key:"lods",set:function(A){let B=
0,D=0;const E=[];this._levelToLOD={};A&&(B=-Infinity,D=Infinity,A.forEach(G=>{E.push(G.scale);B=G.scale>B?G.scale:B;D=G.scale<D?G.scale:D;this._levelToLOD[G.level]=G}));this._set("scales",E);this._set("minScale",B);this._set("maxScale",D);this._set("lods",A);this._initializeUpsampleLevels()}}]);return x}(r.JSONSupport);p.__decorate([f.property({type:Number,json:{write:!0}})],r.prototype,"compressionQuality",void 0);p.__decorate([f.property({type:Number,json:{write:!0}})],r.prototype,"dpi",void 0);
p.__decorate([f.property({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],r.prototype,"format",void 0);p.__decorate([f.property({readOnly:!0})],r.prototype,"isWrappable",null);p.__decorate([f.property({type:u,json:{write:!0}})],r.prototype,"origin",void 0);p.__decorate([g.reader("origin")],r.prototype,"readOrigin",null);p.__decorate([f.property({type:[z],value:null,json:{write:!0}})],r.prototype,"lods",null);p.__decorate([f.property({readOnly:!0})],r.prototype,
"minScale",void 0);p.__decorate([f.property({readOnly:!0})],r.prototype,"maxScale",void 0);p.__decorate([f.property({readOnly:!0})],r.prototype,"scales",void 0);p.__decorate([f.property({cast:v=>Array.isArray(v)?v:"number"===typeof v?[v,v]:[256,256]})],r.prototype,"size",void 0);p.__decorate([g.reader("size",["rows","cols"])],r.prototype,"readSize",null);p.__decorate([c.writer("size",{cols:{type:e.Integer},rows:{type:e.Integer}})],r.prototype,"writeSize",null);p.__decorate([f.property({type:t,json:{write:!0}})],
r.prototype,"spatialReference",void 0);return r=k=p.__decorate([d.subclass("esri.layers.support.TileInfo")],r)})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),function(a,p,b,r,q,y,f,w){var e;b=e=function(l){function g(d){d=l.call(this,d)||
this;d.cols=null;d.level=0;d.levelValue=null;d.resolution=0;d.rows=null;d.scale=0;return d}a._inheritsLoose(g,l);g.prototype.clone=function(){return new e({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return g}(b.JSONSupport);p.__decorate([r.property({type:Number,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"cols",void 0);p.__decorate([r.property({type:y.Integer,
json:{write:!0}})],b.prototype,"level",void 0);p.__decorate([r.property({type:String,json:{write:!0}})],b.prototype,"levelValue",void 0);p.__decorate([r.property({type:Number,json:{write:!0}})],b.prototype,"resolution",void 0);p.__decorate([r.property({type:Number,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"rows",void 0);p.__decorate([r.property({type:Number,json:{write:!0}})],b.prototype,"scale",void 0);return b=e=p.__decorate([w.subclass("esri.layers.support.LOD")],
b)})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/arrayUtils ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/subclass".split(" "),function(a,p,b,r,q,y,f,w,e,l,g){a.PopupView=d=>{d=function(c){function u(){return c.apply(this,arguments)||this}p._inheritsLoose(u,c);var t=u.prototype;t.fetchPopupFeatures=
function(){var h=p._asyncToGenerator(function*(m,n){yield this.when();const {location:z,queryArea:k,layerViewsAndGraphics:v,clientOnlyGraphics:x}=yield this._prepareFetchPopupFeatures(m,n);m=Promise.resolve(x);n=this._queryLayerPopupFeatures({queryArea:k,layerViewsAndGraphics:v,options:n});const C=n.map(A=>A.promise);m=y.eachAlwaysValues([m,...C]).then(r.flatten);return{location:z,clientOnlyGraphics:x,allGraphicsPromise:m,promisesPerLayerView:n}});return function(m,n){return h.apply(this,arguments)}}();
t._queryLayerPopupFeatures=function({queryArea:h,layerViewsAndGraphics:m,options:n}){return m.map(({layerView:z,graphics:k})=>{k={clientGraphics:k,event:q.isSome(n)?n.event:null,signal:q.isSome(n)?n.signal:null,defaultPopupTemplateEnabled:q.isSome(n)?!!n.defaultPopupTemplateEnabled:!1};k=z.fetchPopupFeatures(h,k);return{layerView:z,promise:k}})};t._isValidPopupGraphic=function(h,m){return h&&!!h.getEffectivePopupTemplate(q.isSome(m)&&m.defaultPopupTemplateEnabled)};t._prepareFetchPopupFeatures=function(){var h=
p._asyncToGenerator(function*(m,n){const {clientGraphics:z,queryArea:k,location:v}=yield this._popupHitTestGraphics(m,n);m=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:x,clientOnlyGraphics:C}=this._graphicsPerFetchPopupLayerView(z,m);return{clientOnlyGraphics:C,layerViewsAndGraphics:x,queryArea:k,location:v}});return function(m,n){return h.apply(this,arguments)}}();t._popupHitTestGraphics=function(){var h=p._asyncToGenerator(function*(m,n){const {results:z,mapPoint:k}=yield this.popupHitTest(m);
m=z.filter(x=>this._isValidPopupGraphic(x.graphic,n));const v=m.length?m[0].mapPoint:null;return{clientGraphics:m.map(x=>x.graphic),queryArea:k,location:k||v}});return function(m,n){return h.apply(this,arguments)}}();t._getFetchPopupLayerViews=function(){const h=[];this.allLayerViews.forEach(m=>{this._isValidPopupLayerView(m)&&h.push(m)});q.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&h.push(this.graphicsView);return h.reverse()};t._isValidPopupLayerView=function(h){return q.isSome(h)&&
(!("layer"in h)||!h.suspended)&&"fetchPopupFeatures"in h};t._graphicsPerFetchPopupLayerView=function(h,m){const n=[],z=new Map;m=m.map(k=>{const v=[];"layer"in k?z.set(k.layer,v):z.set(k.graphics,v);return{layerView:k,graphics:v}});for(const k of h)(h=z.get(k.layer)||z.get(k.sourceLayer)||null)?h.push(k):n.push(k);return{layerViewsAndGraphics:m,clientOnlyGraphics:n}};return u}(d);return d=b.__decorate([g.subclass("esri.views.PopupView")],d)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/ViewingMode":function(){define(["exports"],
function(a){a.stringFromViewingMode=function(p){return 1===p?"global":"local"};a.viewingModeFromString=function(p){return"global"===p?1:2};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe"],function(a,p,b,r){function q(e){return Object.freeze({__proto__:null,default:e})}const y=()=>new Promise(function(e,l){a(["./layers/TileLayerView3D"],function(g){e(q(g))},l)}),f=()=>new Promise(function(e,
l){a(["./layers/ElevationLayerView3D"],function(g){e(q(g))},l)}),w={"base-dynamic":()=>new Promise(function(e,l){a(["./layers/BaseDynamicLayerView3D"],function(g){e(q(g))},l)}),"base-elevation":f,"base-tile":y,"bing-maps":y,"building-scene":()=>new Promise(function(e,l){a(["./layers/BuildingSceneLayerView3D"],function(g){e(q(g))},l)}),csv:()=>new Promise(function(e,l){a(["./layers/CSVLayerView3D"],function(g){e(q(g))},l)}),"direct-line-measurement":()=>new Promise(function(e,l){a(["./layers/DirectLineMeasurementLayerView3D"],
function(g){e(q(g))},l)}),"area-measurement":()=>new Promise(function(e,l){a(["./layers/AreaMeasurementLayerView3D"],function(g){e(q(g))},l)}),elevation:f,feature:()=>new Promise(function(e,l){a(["./layers/FeatureLayerView3D"],function(g){e(q(g))},l)}),geojson:()=>new Promise(function(e,l){a(["./layers/GeoJSONLayerView3D"],function(g){e(q(g))},l)}),graphics:()=>new Promise(function(e,l){a(["./layers/GraphicsLayerView3D"],function(g){e(q(g))},l)}),group:()=>new Promise(function(e,l){a(["../layers/GroupLayerView"],
function(g){e(q(g))},l)}),imagery:()=>new Promise(function(e,l){a(["./layers/ImageryLayerView3D"],function(g){e(q(g))},l)}),"integrated-mesh":()=>new Promise(function(e,l){a(["./layers/IntegratedMeshLayerView3D"],function(g){e(q(g))},l)}),"line-of-sight":()=>new Promise(function(e,l){a(["./layers/LineOfSightLayerView3D"],e,l)}),"map-image":()=>new Promise(function(e,l){a(["./layers/MapImageLayerView3D"],function(g){e(q(g))},l)}),"ogc-feature":()=>new Promise(function(e,l){a(["./layers/OGCFeatureLayerView3D"],
function(g){e(q(g))},l)}),"open-street-map":y,"point-cloud":()=>new Promise(function(e,l){a(["./layers/PointCloudLayerView3D"],function(g){e(q(g))},l)}),scene:e=>null==e.profile||"mesh-pyramids"===e.profile?new Promise(function(l,g){a(["./layers/SceneLayerView3D"],function(d){l(q(d))},g)}):new Promise(function(l,g){a(["./layers/SceneLayerGraphicsView3D"],function(d){l(q(d))},g)}),stream:()=>new Promise(function(e,l){a(["./layers/StreamLayerView3D"],function(g){e(q(g))},l)}),tile:y,"imagery-tile":()=>
new Promise(function(e,l){a(["./layers/ImageryTileLayerView3D"],function(g){e(q(g))},l)}),"vector-tile":()=>new Promise(function(e,l){a(["./layers/VectorTileLayerView3D"],function(g){e(q(g))},l)}),wcs:()=>new Promise(function(e,l){a(["./layers/ImageryTileLayerView3D"],function(g){e(q(g))},l)}),"web-tile":y,wfs:()=>new Promise(function(e,l){a(["./layers/WFSLayerView3D"],function(g){e(q(g))},l)}),wms:()=>new Promise(function(e,l){a(["./layers/WMSLayerView3D"],function(g){e(q(g))},l)}),wmts:()=>new Promise(function(e,
l){a(["./layers/WMTSLayerView3D"],function(g){e(q(g))},l)}),slice:()=>new Promise(function(e,l){a(["./layers/SliceLayerView3D"],e,l)}),"geo-rss":null,kml:null,"map-notes":null,route:null,"subtype-group":null,unknown:null,unsupported:null,voxel:null};p.layerView3DImporter={hasLayerViewModule:e=>r.isSome(w[e.type]),importLayerView:e=>{var l=w[e.type];if(!r.isSome(l))throw e=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",l=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),
e=new b(`${l}:view-not-supported`,`${e} is not supported in 3D`),e;return l(e)}};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){a.Constraints=function(c){function u(){var t=c.apply(this,arguments)||this;t.tilt=new d["default"];t.altitude=new l["default"];t.clipDistance=new g["default"];return t}p._inheritsLoose(u,c);return u}(r);b.__decorate([q.property({type:d["default"]})],a.Constraints.prototype,"tilt",void 0);b.__decorate([q.property({type:l["default"]})],a.Constraints.prototype,"altitude",void 0);b.__decorate([q.property({type:g["default"]})],a.Constraints.prototype,"clipDistance",void 0);
a.Constraints=b.__decorate([e.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);a["default"]=a.Constraints;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){a.AltitudeConstraint=function(d){function c(){var u=d.apply(this,arguments)||this;u.min=g.earthAltitudeConstraint.min;u.max=g.earthAltitudeConstraint.max;return u}p._inheritsLoose(c,d);p._createClass(c,[{key:"mode",get:function(){q.deprecated(y.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"});return"manual"},
set:function(u){q.deprecated(y.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})}}]);return c}(r);b.__decorate([f.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);b.__decorate([f.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=b.__decorate([l.subclass("esri.views.3d.constraints.AltitudeConstraint")],
a.AltitudeConstraint);a["default"]=a.AltitudeConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../support/mathUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){const c=q.getLogger("esri.views.3d.state.Constraints");a.Constraints=function(m){function n(k){k=m.call(this,k)||this;k.collision=new h;k.distance=Infinity;k.minimumPoiDistance=4;return k}p._inheritsLoose(n,m);var z=n.prototype;z.clampAltitude=function(k){return this.altitude?y.clamp(k,this.altitude.min,this.altitude.max):k};z.clampTilt=function(k,v){if(!this.tilt)return v;k=this.tilt(k);return y.clamp(v,k.min,k.max)};z.clampDistance=function(k){return Math.min(k,
this.distance)};z.createDefaultTilt=function(){return 2===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};z.createConstantMaxTilt=function(k){return(v,x=t)=>{x.min=u.min;x.max=k;return x}};z.createDefaultTiltLocal=function(){const k=this.collision.enabled?d.makePiecewiseLinearFunction([[4E3,u.max],[1E4,y.deg2rad(88)],[6E6,y.deg2rad(88)]]):()=>u.max;return(v,x=t)=>{x.min=u.min;x.max=k(v);return x}};z.createDefaultTiltGlobal=function(){const k=this.collision.enabled?d.makePiecewiseLinearFunction([[4E3,
u.max],[5E4,y.deg2rad(88)],[6E6,y.deg2rad(88)],[2E7,u.min]]):d.makePiecewiseLinearFunction([[3E5,u.max],[3E6,y.deg2rad(88)],[6E6,y.deg2rad(88)],[2E7,u.min]]);return(v,x=t)=>{x.min=u.min;x.max=k(v);return x}};p._createClass(n,[{key:"altitude",get:function(){return 2===this.mode?null:this._get("altitude")||null},set:function(k){2===this.mode?c.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",k)}}]);return n}(r);b.__decorate([f.property()],a.Constraints.prototype,"altitude",
null);b.__decorate([f.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);b.__decorate([f.property()],a.Constraints.prototype,"distance",void 0);b.__decorate([f.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);b.__decorate([f.property()],a.Constraints.prototype,"tilt",void 0);b.__decorate([f.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=b.__decorate([l.subclass("esri.views.3d.state.Constraints")],a.Constraints);q={min:-2E5,
max:4*g.earth.radius};const u={min:y.deg2rad(.5),max:y.deg2rad(179.5)},t={min:0,max:0};let h=function(m){function n(){var z=m.apply(this,arguments)||this;z.enabled=!0;z.elevationMargin=5;return z}p._inheritsLoose(n,m);return n}(r);b.__decorate([f.property({type:Boolean})],h.prototype,"enabled",void 0);b.__decorate([f.property({type:Number})],h.prototype,"elevationMargin",void 0);h=b.__decorate([l.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],h);b=a.Constraints;a.TiltDefault=u;a["default"]=
b;a.earthAltitudeConstraint=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,p,b,r,q,y,f,w,e){a.ClipDistanceConstraint=
function(l){function g(){var c=l.apply(this,arguments)||this;c.mode="auto";return c}p._inheritsLoose(g,l);var d=g.prototype;d.castNear=function(c){return Math.max(1E-8,c)};d.castFar=function(c){return Math.max(1E-8,c)};d.autoUpdate=function(c,u){"auto"===this.mode&&(this._get("near")!==c&&this._set("near",c),this._get("far")!==u&&this._set("far",u))};p._createClass(g,[{key:"near",get:function(){return this._get("near")},set:function(c){this._set("near",c);c>=this._get("far")&&(this.far=c+1E-9);this.mode=
"manual"}},{key:"far",get:function(){return this._get("far")},set:function(c){this._set("far",c);c<=this._get("near")&&(this.near=c-1E-9);this.mode="manual"}}]);return g}(r);b.__decorate([q.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);b.__decorate([f.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);b.__decorate([q.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);b.__decorate([f.cast("far")],a.ClipDistanceConstraint.prototype,
"castFar",null);b.__decorate([q.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=b.__decorate([e.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);a["default"]=a.ClipDistanceConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){var d=q.rad2deg(g.TiltDefault.min),c=q.rad2deg(g.TiltDefault.max);a.TiltConstraint=function(u){function t(){var m=u.apply(this,arguments)||this;m.mode="auto";return m}p._inheritsLoose(t,u);var h=t.prototype;h.castMax=function(m){return q.clamp(m,d,c)};h.autoUpdate=function(m){"auto"===this.mode&&this._get("max")!==m&&this._set("max",m)};p._createClass(t,[{key:"max",get:function(){return this._get("max")},set:function(m){this._set("max",m);this.mode="manual"}}]);return t}(r);
b.__decorate([y.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);b.__decorate([y.property({type:Number,value:c})],a.TiltConstraint.prototype,"max",null);b.__decorate([w.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=b.__decorate([l.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);a["default"]=a.TiltConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./Clouds ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){var t;y=t=function(h){function m(z){z=h.call(this,z)||this;z.atmosphere=new g["default"];z.clouds=null;return z}a._inheritsLoose(m,h);m.fromWebsceneEnvironment=function(z){z=z.cloneConstructProperties();return new t({...z,lighting:d.SceneViewLighting.fromWebsceneLighting(z.lighting)})};var n=m.prototype;n.castLighting=function(z){return this.convertLighting(z)};n.applyLighting=function(z){this.lighting=this.convertLighting(z)};n.convertLighting=function(z){return z?
z instanceof d.SceneViewLighting?z:z instanceof u?this.lighting?this.lighting.cloneWithWebsceneLighting(z):d.SceneViewLighting.fromWebsceneLighting(z):e.ensureType(d.SceneViewLighting,z):new d.SceneViewLighting};n.clone=function(){return new t({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),clouds:null===this.clouds?null:this.clouds.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:b.clone(this.background)})};n.cloneWithWebsceneEnvironment=
function(z){return new t({atmosphere:this.atmosphere.clone(),clouds:null===this.clouds?null:this.clouds.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:b.clone(this.background),...z.cloneConstructProperties(),lighting:null!=this.lighting?this.lighting.cloneWithWebsceneLighting(z.lighting):d.SceneViewLighting.fromWebsceneLighting(z.lighting)})};return m}(c);p.__decorate([r.property({type:g["default"],json:{read:!1}})],y.prototype,"atmosphere",void 0);p.__decorate([r.property({type:l,
json:{write:!1}})],y.prototype,"clouds",void 0);p.__decorate([r.property()],y.prototype,"lighting",void 0);p.__decorate([q.cast("lighting")],y.prototype,"castLighting",null);return y=t=p.__decorate([w.subclass("esri.views.3d.environment.SceneViewEnvironment")],y)})},"esri/views/3d/environment/Clouds":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w){var e;b=e=function(l){function g(c){c=l.call(this,c)||this;c.absorption=0;c.cloudHeight=1;c.cloudSize=.5;c.coverage=.4;c.density=.5;c.detailSize=.5;c.smoothness=.7;return c}a._inheritsLoose(g,l);var d=g.prototype;d.clone=function(){return new e(this.cloneConstructProperties())};d.cloneConstructProperties=function(){return{absorption:this.absorption,cloudHeight:this.cloudHeight,cloudSize:this.cloudSize,coverage:this.coverage,density:this.density,detailSize:this.detailSize,
smoothness:this.smoothness}};return g}(b);p.__decorate([r.property({type:Number,nonNullable:!0,json:{write:!1}})],b.prototype,"absorption",void 0);p.__decorate([r.property({type:Number,nonNullable:!0})],b.prototype,"cloudHeight",void 0);p.__decorate([r.property({type:Number,nonNullable:!0})],b.prototype,"cloudSize",void 0);p.__decorate([r.property({type:Number,nonNullable:!0})],b.prototype,"coverage",void 0);p.__decorate([r.property({type:Number,nonNullable:!0})],b.prototype,"density",void 0);p.__decorate([r.property({type:Number,
nonNullable:!0})],b.prototype,"detailSize",void 0);p.__decorate([r.property({type:Number,nonNullable:!0})],b.prototype,"smoothness",void 0);return b=e=p.__decorate([w.subclass("esri.view.3d.environment.Clouds")],b)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e){var l;a.SceneViewAtmosphere=l=function(g){function d(){return g.apply(this,arguments)||this}p._inheritsLoose(d,g);d.prototype.clone=function(){return new l({quality:this.quality})};p._createClass(d,[{key:"quality",set:function(c){-1!==["low","high"].indexOf(c)&&this._set("quality",c)}}]);return d}(r);b.__decorate([q.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=l=b.__decorate([e.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);a["default"]=a.SceneViewAtmosphere;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SceneViewLighting":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../webscene/Lighting".split(" "),function(a,
p,b,r,q,y,f,w,e,l){function g({hours:u,minutes:t,seconds:h}){return Math.round(u+t/60+h/3600)}var d;a.SceneViewLighting=d=function(u){function t(m){m=u.call(this,m)||this;m.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};m.cameraTrackingEnabled=!0;m.ambientOcclusionEnabled=!1;m.waterReflectionEnabled=!1;var n=(new Date).getFullYear();n=new Date("March 15, "+n+" 12:00:00 UTC");m._set("defaultDate",n);m._set("date",n);return m}p._inheritsLoose(t,u);t.fromWebsceneLighting=function(m){return new d({...m.cloneConstructProperties()})};
var h=t.prototype;h.autoUpdate=function(m,n){const z=g(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=n.hours;this.positionTimezoneInfo.minutes=n.minutes;this.positionTimezoneInfo.seconds=n.seconds;n=null;null!=m&&(this.positionTimezoneInfo.autoUpdated=!0,n=this.date&&this.date.getTime(),this._set("date",new Date(m.getTime())));const k=g(this.positionTimezoneInfo);z!==k&&(c.target=this,c.timezoneOffset=k,this.emit("timezone-will-change",c));if(null!=m)return n!==m.getTime()};h.clone=function(){const m=
this._get("date")===this._get("defaultDate"),n=new d({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});m&&n._set("date",n._get("defaultDate"));n.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;n.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;n.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;
n.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return n};h.cloneWithWebsceneLighting=function(m){const n=this.clone();null!=m.date&&(n.date=m.date);n.directShadowsEnabled=m.directShadowsEnabled;n.displayUTCOffset=m.displayUTCOffset;return n};p._createClass(t,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(m){const n=this._get("date")===this._get("defaultDate");m=new Date(m.getTime());this._set("defaultDate",m);n&&this._set("date",
m)}},{key:"date",set:function(m){null!=m&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(m.getTime())))}}]);return t}(r.EventedMixin(l));b.__decorate([q.property({type:Boolean})],a.SceneViewLighting.prototype,"cameraTrackingEnabled",void 0);b.__decorate([q.property({type:Boolean})],a.SceneViewLighting.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([q.property({type:Boolean})],a.SceneViewLighting.prototype,"waterReflectionEnabled",void 0);b.__decorate([q.property({type:Date})],
a.SceneViewLighting.prototype,"defaultDate",null);b.__decorate([q.property({type:Date})],a.SceneViewLighting.prototype,"date",null);a.SceneViewLighting=d=b.__decorate([e.subclass("esri.views.3d.environment.SceneViewLighting")],a.SceneViewLighting);const c={target:null,timezoneOffset:0};b=a.SceneViewLighting;a.calculateTimezoneOffset=g;a["default"]=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webscene/Lighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),
function(a,p,b,r,q,y,f,w,e,l){var g;b=g=function(d){function c(t){t=d.call(this,t)||this;t.date=null;t.directShadowsEnabled=!1;t.displayUTCOffset=null;return t}a._inheritsLoose(c,d);var u=c.prototype;u.readDate=function(t,h){return null!=h.datetime&&new Date(h.datetime)||null};u.writeDate=function(t,h,m){h[m]=t.getTime()};u.readDirectShadowsEnabled=function(t,h){return!!h.directShadows};u.writedirectShadowsEnabled=function(t,h,m){t&&(h[m]=t)};u.writeDisplayUTCOffset=function(t,h){null!=t&&(h.displayUTCOffset=
t)};u.clone=function(){return new g(this.cloneConstructProperties())};u.cloneConstructProperties=function(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(t.date=new Date(this.date.getTime()));return t};return c}(b.JSONSupport);p.__decorate([r.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],b.prototype,"date",void 0);p.__decorate([w.reader("date",["datetime"])],b.prototype,"readDate",
null);p.__decorate([l.writer("date")],b.prototype,"writeDate",null);p.__decorate([r.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],b.prototype,"directShadowsEnabled",void 0);p.__decorate([w.reader("directShadowsEnabled",["directShadows"])],b.prototype,"readDirectShadowsEnabled",null);p.__decorate([l.writer("directShadowsEnabled")],b.prototype,"writedirectShadowsEnabled",null);p.__decorate([r.property({type:Number,json:{write:!0}})],b.prototype,"displayUTCOffset",void 0);
p.__decorate([l.writer("displayUTCOffset")],b.prototype,"writeDisplayUTCOffset",null);return b=g=p.__decorate([e.subclass("esri.webscene.Lighting")],b)})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ./Lighting ./background/utils".split(" "),function(a,p,b,r,q,
y,f,w,e,l,g){var d;y=(c,u,t)=>({enabled:!t||!t.isPresentation});b=d=function(c){function u(h){h=c.call(this,h)||this;h.lighting=new l;h.background=null;h.atmosphereEnabled=!0;h.starsEnabled=!0;return h}a._inheritsLoose(u,c);var t=u.prototype;t.clone=function(){return new d(this.cloneConstructProperties())};t.cloneConstructProperties=function(){return{lighting:l.prototype.clone.call(this.lighting),background:r.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
return u}(b.JSONSupport);p.__decorate([q.property({type:l,json:{write:!0}})],b.prototype,"lighting",void 0);p.__decorate([q.property(g.backgroundProperty)],b.prototype,"background",void 0);p.__decorate([q.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:y}}})],b.prototype,"atmosphereEnabled",void 0);p.__decorate([q.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:y}}})],b.prototype,"starsEnabled",void 0);return b=d=p.__decorate([e.subclass("esri.webscene.Environment")],
b)})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,p,b){p={base:p,key:"type",typeMap:{color:b}};p={types:p,json:{read:function(r){return(q,y,f)=>{if(!q)return q;for(const w in r.typeMap)if(q.type===w)return y=new r.typeMap[w],y.read(q,f),y}}(p),write:{overridePolicy:(r,q,y)=>({enabled:!y||!y.isPresentation})}}};a.backgroundProperty=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w){b=function(e){function l(g){return e.call(this,g)||this}a._inheritsLoose(l,e);l.prototype.clone=function(){};return l}(b.JSONSupport);p.__decorate([r.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);return b=p.__decorate([w.subclass("esri.webscene.background.Background")],b)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){var d;q={...l.colorAndTransparencyProperty,nonNullable:!0};g=d=function(c){function u(h){h=c.call(this,h)||this;h.type="color";h.color=new b([0,0,0,1]);return h}a._inheritsLoose(u,c);var t=u.prototype;t.clone=function(){return new d(this.cloneProperties())};t.cloneProperties=function(){return{color:this.color.clone()}};return u}(g);p.__decorate([w.enumeration({color:"color"},{readOnly:!0})],g.prototype,"type",void 0);p.__decorate([r.property(q)],g.prototype,"color",
void 0);return g=d=p.__decorate([e.subclass("esri.webscene.background.ColorBackground")],g)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A){a.SceneViewEnvironmentManager=function(H){function J(){var I=H.call(this)||this;I._referencePointUpdateDelay=200;I._referencePointUpdateInterval=3E3;I._referencePointUpdateDistThreshold=1E6;I._referencePosUpdateQuery=null;I._referencePosMapCoordsRequested=null;I._viewHandles=new y;I._preserveAbsoluteDateTime=!1;I._trackingEnabled=!1;I._referencePosResetPreserveAbsoluteTime=!1;I._referencePosUpdateTimer=null;I._referencePosMapCoords=null;I._mainLight=
new C.MainLight;I._ambientLight=new C.AmbientLight;I._moonLight=new C.FillLight;I._renderer=null;I._referencePosWGS84Comparable=null;I._resetReferencePosition();return I}p._inheritsLoose(J,H);var O=J.prototype;O.destroy=function(){this.disconnectView();this._viewHandles.destroy()};O.connectView=function(I){this._renderer||(this._renderer=new k.EnvironmentRenderer({view:I}),this._viewHandles.add([I.watch("environment.lighting.date",F=>this._lightingDateHandler(F),!0),I.watch("stationary",()=>this._interactingStationaryHandler()),
I.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.lighting.waterReflectionEnabled","environment.background.color"],()=>this._updateRenderParamsHandler(),!0),I.watch("spatialReference",()=>this._resetReferencePosition(!0),!0),e.init(I,"viewingMode",()=>this._resetReferencePosition(!0),!0),e.init(I,"environment.lighting.cameraTrackingEnabled",F=>this._updateCameraTracking(F),!0),e.init(I,"state.camera",()=>this._cameraHandler(null),!0),
this.watch("disableQueries",()=>this._cameraHandler(null))]),this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))};O.disconnectView=function(){this._viewHandles.removeAll();this._resetReferencePosition();this._renderer=f.destroyMaybe(this._renderer)};O._updateCameraTracking=function(I){if(this._trackingEnabled=I)this._cameraHandler();else if(I=this._view.environment.lighting)I.positionTimezoneInfo.autoUpdated=!1};O._lightingDateHandler=function(I){if(I){var F=
this._view.environment.lighting;if(!F.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!n.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var L=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(L)){this._requestReferencePositionUpdate(L);return}}this._preupdateTracking(I);f.isSome(this._referencePosWGS84Comparable)&&(L=v.positionToTimezoneInfo(this._referencePosWGS84Comparable,G),f.isSome(L)&&(F.autoUpdate(null,L),
this._trackingEnabled&&(F.positionTimezoneInfo.autoUpdated=!0)))}this._updateLightParams(I)}};O._preupdateTracking=function(I){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(I)};O._cameraHandler=function(I=null){if(this._view.ready){var F=this._view.camera;F&&(this._cameraHandlerClientSide(F,I)||this._cameraHandlerServerSide(F))}};O._cameraHandlerClientSide=function(I,F){const L=z.isEarth(this._view.spatialReference);if(L&&!n.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;
I=I.position;f.isNone(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=h.create());L?n.projectPointToWGS84ComparableLonLat(I,this._referencePosWGS84Comparable):t.set(this._referencePosWGS84Comparable,I.longitude,I.latitude,I.z);this.notifyChange("referencePositionWGS84Comparable");this._autoUpdateTimezone(this._referencePosWGS84Comparable,F)||this._updateLightParams(F);return!0};O._cameraHandlerServerSide=function(I){I=I.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||
this._exceedsReferencePosDistThreshold(I))&&this._requestReferencePositionUpdate(I,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=I.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};O._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};O._updateLightParams=function(I){var F=this._view.environment.lighting;I=I||F.date;F=this._view._stage;const L=f.isSome(this._referencePosWGS84Comparable)?
B:D;f.isSome(this._referencePosWGS84Comparable)&&x.computeColorAndIntensity(I,this._referencePosWGS84Comparable,this._view.state.viewingMode,B);t.scale(this._mainLight.intensity,L.diffuse.color,L.diffuse.intensity*Math.PI);t.copy(this._mainLight.direction,L.diffuse.directionToLightSource);t.scale(this._ambientLight.intensity,L.ambient.color,L.ambient.intensity);t.lerp(this._moonLight.intensity,K,M,L.globalFactor);t.scale(this._moonLight.intensity,this._moonLight.intensity,(1-.5*L.globalFactor)*(1-
.4*L.noonFactor*(1-L.globalFactor)));t.copy(this._moonLight.direction,L.diffuse.directionToLightSource);F.renderView.updateLightSources([this._mainLight,this._ambientLight,this._moonLight],1-L.noonFactor,L.globalFactor);this._updateRenderParamsHandler()};O._autoUpdateTimezone=function(I,F=null){if(!this._view.environment.lighting.cameraTrackingEnabled||f.isNone(I))return!1;const L=E;L.setTime((F||this._view.environment.lighting.date).getTime());I=v.positionToTimezoneInfo(I,G);if(f.isNone(I))return!1;
var N=this._view.environment.lighting.positionTimezoneInfo;if(!N.autoUpdated)N=I;else if(N.hours===I.hours&&N.minutes===I.minutes&&N.seconds===I.seconds)return!1;const R=L.getUTCHours()-(I.hours-N.hours),S=L.getUTCMinutes()-(I.minutes-N.minutes);N=L.getUTCSeconds()-(I.seconds-N.seconds);L.setUTCHours(R);L.setUTCMinutes(S);L.setUTCSeconds(N);return F?!1:this._view.environment.lighting.autoUpdate(L,I)};O._updateRenderParamsHandler=function(){const I=this._view._stage;if(I){var F=f.mapOr(this._referencePosWGS84Comparable,
!0,N=>x.computeShadowsEnabled(N[2],this._view.state.viewingMode)),L=this._view.environment.background;L=L instanceof A?{type:"color",color:m.fromArray(r.toUnitRGBA(L.color))}:{type:"color",color:m.fromValues(0,0,0,1)};I.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&F,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,background:L})}};O._resetReferencePosition=function(I=
!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");I&&this._cameraHandler(null)};O._requestReferencePositionUpdate=function(I,F=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(I):this._referencePosMapCoordsRequested=I.clone(),this._referencePosResetPreserveAbsoluteTime=!!F,!this._referencePosUpdateQuery&&
!this._referencePosUpdateTimer&&this._view.stationary)){const L=this._referencePosUpdateQuery=w.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===L)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==L)}).catch(R=>{"mapcoordshelper:missing-geometry-service"===R.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===L&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),
this.notifyChange("updating"))}),N=this._referencePosUpdateTimer=w.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===N&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};O._doReferencePositionUpdateQuery=function(){var I=p._asyncToGenerator(function*(F){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):
this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const L=yield this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);F()||isNaN(L[0])||isNaN(L[1])||(F=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=L[0],this._referencePosWGS84Comparable[1]=L[1],this._referencePosWGS84Comparable[2]=
F):this._referencePosWGS84Comparable=[L[0],L[1],F],this._referencePosChanged())});return function(F){return I.apply(this,arguments)}}();O._executePendingReferencePositionUpdate=function(){const I=this._referencePosMapCoordsRequested;I&&this._requestReferencePositionUpdate(I,this._referencePosResetPreserveAbsoluteTime)};O._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams();this.notifyChange("referencePositionWGS84Comparable")};
O._exceedsReferencePosDistThreshold=function(I){return this._referencePosMapCoords?(I=this._referencePosMapCoords.distance(I),this._view.mapCoordsHelper&&(I*=this._view.mapCoordsHelper.unitInMeters),I>this._referencePointUpdateDistThreshold):!0};O._cancelReferencePosUpdates=function(){const I=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return I};p._createClass(J,[{key:"_view",get:function(){var I;return null==(I=this._renderer)?void 0:I.view}},
{key:"updating",get:function(){return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||this._renderer&&this._renderer.updating)}},{key:"referencePositionWGS84Comparable",get:function(){return this._referencePosWGS84Comparable}},{key:"test",get:function(){const I=this;return{renderer:this._renderer,set referencePointUpdateInterval(F){I._referencePointUpdateInterval=F},set referencePointUpdateDistThreshold(F){I._referencePointUpdateDistThreshold=F},set referencePosUpdateTimer(F){I._referencePosUpdateTimer=
F},set referencePointUpdateDelay(F){I._referencePointUpdateDelay=F}}}}]);return J}(q.EventedAccessor);b.__decorate([l.property({type:Boolean,readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);b.__decorate([l.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);b.__decorate([l.property()],a.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);b.__decorate([l.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);
b.__decorate([l.property()],a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=b.__decorate([u.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const B=new x.ColorAndIntensity,D=new x.ColorAndIntensity,E=new Date,G={hours:0,minutes:0,seconds:0},K=h.fromValues(.22,.22,.33),M=h.fromValues(.22,.22,.22);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Handles ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/trackingUtils ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ../../../support/featureFlags ./ChapmanAtmosphere ./CloudsComposition ./CloudsGenerator ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C){const A=[14,15,16];a.EnvironmentRenderer=function(B){function D(){var G=B.apply(this,arguments)||this;G._handles=new y;G._context=null;G._chapmanQuality="high";G._enableNewAtmosphere=h.enableNewAtmosphere();G._pendingAtmosphere=null;G._atmosphere=null;G._stars=null;G._clouds=null;G._cloudComposition=null;G._cloudsEnabled=!!q("enable-feature:enable-clouds");return G}p._inheritsLoose(D,B);var E=D.prototype;E.renderCubeMap=function(){f.isSome(this._clouds)&&
(this._clouds.resetRenderFlags(),this._context.requestRender())};E.initialize=function(){this.view._stage.addRenderPlugin(A,this)};E.destroy=function(){this._pendingAtmosphere=f.destroyMaybe(this._pendingAtmosphere);this._atmosphere=f.destroyMaybe(this._atmosphere);this._stars=f.destroyMaybe(this._stars);this._handles=f.destroyMaybe(this._handles);this._clouds=f.destroyMaybe(this._clouds);this._cloudComposition=f.destroyMaybe(this._cloudComposition);this.view&&null!=this.view._stage&&(this.view._stage.removeRenderPlugin(this),
this._set("view",null))};E.initializeRenderContext=function(G){this._context=G;this.setup()};E.setup=function(){this._handles.add(w.when(this.view,"basemapTerrain",()=>this._updateBasemapTerrain(),!0));this._handles.add([w.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],()=>this._updateAtmosphere(),!0),c.autorun(()=>this._updateStars()),c.autorun(()=>{this.evaluateCloudsEnabled();this.ensureClouds(this._context.renderContext.rctx);if(f.isSome(this._clouds)){var G,
K;const M=null==(G=this.view)?void 0:null==(K=G.environment)?void 0:K.clouds;this._clouds.coverage=null==M?void 0:M.coverage;this._clouds.absorption=null==M?void 0:M.absorption;this._clouds.cloudHeight=null==M?void 0:M.cloudHeight;this._clouds.cloudSize=null==M?void 0:M.cloudSize;this._clouds.density=null==M?void 0:M.density;this._clouds.detailSize=null==M?void 0:M.detailSize;this._clouds.smoothness=null==M?void 0:M.smoothness}})])};E.evaluateCloudsEnabled=function(){var G,K,M,H;this.cloudsEnabled=
(null!=(G=null!==(null==(K=this.view)?void 0:null==(M=K.environment)?void 0:M.clouds))?G:!!q("enable-feature:enable-clouds"))&&t.isEarth(null==(H=this.view)?void 0:H.spatialReference)};E.uninitializeRenderContext=function(){f.isSome(this._stars)&&(this._stars.destroy(),this._stars=null);f.isSome(this._atmosphere)&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null);this._clouds=f.destroyMaybe(this._clouds);this._cloudComposition=f.destroyMaybe(this._cloudComposition)};
E.render=function(G){let K=!0;const M=this._context.renderContext.rctx;f.isSome(this._stars)&&this._stars.canRender&&15===G.slot&&0===G.pass&&(K=this._stars.render(G.rctx,G.camera)&&K);if(this._cloudsEnabled&&14===G.slot&&0===G.pass&&(this.ensureClouds(M),f.isSome(this._clouds))){const H=G.rctx.getViewport();K=this._clouds.render(M)&&K;G.rctx.setViewport(H.x,H.y,H.width,H.height)}f.isSome(this._atmosphere)&&this._atmosphere.canRender&&(K=this._atmosphere.render(G)&&K);this._cloudsEnabled&&f.isSome(this._clouds)&&
f.isSome(this._cloudComposition)&&15===G.slot&&0===G.pass&&(K=this._cloudComposition.render(G,this._clouds._frameBufferCube)&&K,this._cloudComposition.isFading()&&this._setNeedsRender());return K};E.ensureClouds=function(G){this._cloudsEnabled&&f.isSome(this._clouds)&&f.isSome(this._cloudComposition)||(this._cloudsEnabled&&f.isNone(this._clouds)&&f.isNone(this._cloudComposition)&&(this._clouds=new z.CloudsGenerator(G,this.view),G=u.getReferenceEllipsoid(this.view.spatialReference).radius,this._cloudComposition=
new n.CloudsComposition(this._context.renderContext.rctx,this.view.state.viewingMode,G)),this._cloudsEnabled||!f.isSome(this._clouds)&&!f.isSome(this._cloudComposition)||(this._clouds=f.destroyMaybe(this._clouds),this._cloudComposition=f.destroyMaybe(this._cloudComposition)))};E._setNeedsRender=function(){this._context&&this._context.requestRender()};E._updateStars=function(){var G,K,M;const H=null!=(G=null==(K=this.view)?void 0:null==(M=K.environment)?void 0:M.starsEnabled)?G:!1;H&&f.isNone(this._stars)?
(this._stars=new C.Stars({view:this.view,requestRender:()=>this._context.requestRender}),this._setNeedsRender()):!H&&f.isSome(this._stars)&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())};E._updateAtmosphere=function(){var G=this._getAtmosphereType();if(this.atmosphereType!==G)if(this.atmosphereType=G,f.isSome(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),G=this._getAtmosphereClass()){var K=new G(this.view);
K instanceof m.ChapmanAtmosphere&&K.setSimplified("medium"===this._getAtmosphereType());K.initializeRenderContext(this._context);f.isNone(this._atmosphere)&&(this._atmosphere=K,this._setNeedsRender());this._pendingAtmosphere=K;K.when().then(()=>{f.isSome(this._atmosphere)&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere);this._pendingAtmosphere=null;this._setNeedsRender();this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===
K&&(this._pendingAtmosphere=null)})}else f.isSome(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()};E._getAtmosphereClass=function(){const G=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(G);switch(G){case "none":return null;case "chapman":case "medium":return m.ChapmanAtmosphere;case "realistic":return v.RealisticAtmosphere;case "panoramic":return k;case "simple":return x}};E._getAtmosphereType=
function(){const G=this.view.get("environment.atmosphereEnabled"),K=this.view.get("environment.atmosphere.quality"),M=this.view.viewingMode;return!G||null==K||t.isMoon(this.view.spatialReference)?"none":"local"===M?"panoramic":this._enableNewAtmosphere&&m.ChapmanAtmosphere.isSupported(this._context)&&!t.isMars(this.view.spatialReference)?"medium"===this._chapmanQuality?"medium":"chapman":"high"===K&&v.RealisticAtmosphere.isSupported(this._context)&&!t.isMars(this.view.spatialReference)?"realistic":
"simple"};E._updateBasemapTerrain=function(){const G=this.view.basemapTerrain;G&&(G.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};p._createClass(D,[{key:"canRender",get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode}},{key:"updating",get:function(){return f.isSome(this._pendingAtmosphere)||f.isSome(this._stars)&&this._stars.updating}},{key:"cloudsEnabled",set:function(G){this._cloudsEnabled=
G;this._setNeedsRender()}},{key:"test",get:function(){return{atmosphere:this._atmosphere,clouds:this._clouds,enableNewAtmosphere:G=>{this._enableNewAtmosphere=G},setNewAtmosphereQuality:G=>{this._chapmanQuality=G},updateAtmosphere:()=>{this._updateAtmosphere()}}}}]);return D}(r);b.__decorate([e.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);b.__decorate([e.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"atmosphereClassFromType",void 0);b.__decorate([e.property({type:Boolean,
readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);b.__decorate([e.property()],a.EnvironmentRenderer.prototype,"_pendingAtmosphere",void 0);b.__decorate([e.property()],a.EnvironmentRenderer.prototype,"_stars",void 0);a.EnvironmentRenderer=b.__decorate([d.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/Handles ../../../core/maybe ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/Ellipsoid ./atmosphereUtils ./ChapmanAtmosphereTechnique ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){let m=function(){function n(k){this._view=k;this.canRender=!0;this._skyslot=15;this._hazeSlot=16;this._cameraPosition=l.create();this._projectionInverse=y.create();this._viewInverse=y.create();this._heightParameters=g.create();this._betasRayleigh=l.create();this._betasCombined=l.create();this._scaleHeight=0;this._radii=w.create();this._nearFar=w.create();this._lowerElevationBoundRadius=this._altitudeFade=this._innerFadeDistance=this._cAtmosphere=this._cameraHeightSq=
this._cameraHeight=0;this._lowerBoundEarthRadius=d.earth.radius;this._simplified=!1;this._skyStrength=1;this._hazeStrength=3;this._skyHazeMultiplier=this._mieStrength=1;this._skyHazePow=0;this._sunSpread=this._sunSize=1;this._updateRadius(d.earth.radius)}var z=n.prototype;z.destroy=function(){this._atmosphereTechnique=b.releaseMaybe(this._atmosphereTechnique);this._atmosphereHazeTechnique=b.releaseMaybe(this._atmosphereHazeTechnique);this._vao=b.disposeMaybe(this._vao);this._handles=b.destroyMaybe(this._handles)};
z.when=function(){return Promise.resolve()};z.setSimplified=function(k){this._simplified=k};z.initializeRenderContext=function(k){const v=k.renderContext.rctx;this._handles=new p;b.isSome(this._view.basemapTerrain.rootTiles)&&this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(r.on(this._view,"basemapTerrain","elevation-change",C=>this._updateElevation(C),
()=>this._updateElevation()));this._handles.add(r.on(this._view,"basemapTerrain","elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const x=new u.ChapmanAtmosphereTechniqueConfiguration;x.haze=!1;x.simplified=this._simplified;this._atmosphereTechnique=k.shaderTechniqueRep.acquire(u.ChapmanAtmosphereTechnique,x);x.haze=!0;this._atmosphereHazeTechnique=k.shaderTechniqueRep.acquire(u.ChapmanAtmosphereTechnique,x);this._vao=h.createQuadVAO(v,t.Pos2Tex);this._scaleHeight=c.rayLeighScaleHeight*
c.atmosphereHeight;e.set(this._betasRayleigh,c.betaRayleigh[0],c.betaRayleigh[1],c.betaRayleigh[2]);e.set(this._betasCombined,c.betaRayleigh[0]+c.betaOzone[0],c.betaRayleigh[1]+c.betaOzone[1],c.betaRayleigh[2]+c.betaOzone[2])};z.uninitializeRenderContext=function(){this.destroy()};z.render=function(k){if(k.slot!==this._hazeSlot&&k.slot!==this._skyslot||0!==k.pass)return!1;this._update(k.camera);const v=k.rctx,x=k.offscreenRenderingHelper,C=k.slot===this._skyslot?this._atmosphereTechnique:this._atmosphereHazeTechnique,
A=k.slot===this._skyslot?x.depthTexture:x.linearDepthTexture;v.useProgram(C.program);C.bindPipelineState(v);x.renderDepthDetached(()=>{C.program.bindTexture(A,"depthTex");this._renderCommon(C.program,k)});return!0};z._renderCommon=function(k,v){if(b.isNone(this._vao))return!1;const x=v.rctx;v.scenelightingData.setLightDirectionUniform(k);k.setUniform4fv("heightParameters",this._heightParameters);k.setUniform3fv("cameraPosition",this._cameraPosition);k.setUniformMatrix4fv("projectionInverse",this._projectionInverse);
k.setUniformMatrix4fv("viewInverse",this._viewInverse);k.setUniform2fv("nearFar",this._nearFar);k.setUniform2fv("radii",this._radii);k.setUniform1f("scaleHeight",this._scaleHeight);this._simplified||k.setUniform1f("betaMie",c.betaMie);k.setUniform3fv("betaRayleigh",this._betasRayleigh);k.setUniform3fv("betaCombined",this._betasCombined);k.setUniform1f("innerFadeDistance",this._innerFadeDistance);k.setUniform1f("altitudeFade",this._altitudeFade);k.setUniform1f("skyStrength",this._skyStrength);k.setUniform1f("hazeStrength",
this._hazeStrength);k.setUniform1f("mieStrength",this._mieStrength);k.setUniform1f("skyHazeMultiplier",this._skyHazeMultiplier);k.setUniform1f("skyHazePow",this._skyHazePow);k.setUniform1f("sunSize",this._sunSize);k.setUniform1f("sunSpread",this._sunSpread);x.bindVAO(this._vao);k.assertCompatibleVertexAttributeLocations(this._vao);x.drawArrays(5,0,4);return!0};z._adjustRadiusForTesselation=function(k){return k*Math.cos(Math.PI/16/16)};z._updateElevation=function(k){k=k?k.tile:b.unwrapOr(this._view.basemapTerrain.rootTiles,
[null])[0];b.isNone(k)||0!==k.lij[0]||(k=this._adjustRadiusForTesselation(d.earth.radius+k.elevationBounds[0]),k!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=k,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds()))};z._updateVisibleElevationBounds=function(){const k=this._adjustRadiusForTesselation(d.earth.radius+this._view.basemapTerrain.elevationBounds.min);(0>this._lowerBoundEarthRadius||k<this._lowerBoundEarthRadius)&&this._updateRadius(k)};z._updateRadius=
function(k){this._lowerBoundEarthRadius=k;f.set(this._radii,k,k+c.atmosphereHeight);this._innerFadeDistance=2*Math.sqrt((2*k-c.innerAtmosphereDepth)*c.innerAtmosphereDepth)};z._update=function(k){b.isNone(k)||(this._cameraHeight=e.length(k.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1],this._heightParameters=g.fromValues(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,Math.min(1,Math.max(0,(this._cameraHeight-
this._radii[0])/c.atmosphereHeight))),e.copy(this._cameraPosition,k.eye),q.invert(this._projectionInverse,k.projectionMatrix),q.invert(this._viewInverse,k.viewMatrix),f.set(this._nearFar,k.near,k.far),this._altitudeFade=c.computeInnerAltitudeFade(this._cameraHeight-this._lowerBoundEarthRadius))};n.isSupported=function(k){return k.renderContext.rctx.capabilities.depthTexture};return n}();a.ChapmanAtmosphere=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec2":function(){define(["exports",
"./common"],function(a,p){function b(R,S){R[0]=S[0];R[1]=S[1];return R}function r(R,S,P){R[0]=S;R[1]=P;return R}function q(R,S,P){R[0]=S[0]+P[0];R[1]=S[1]+P[1];return R}function y(R,S,P){R[0]=S[0]-P[0];R[1]=S[1]-P[1];return R}function f(R,S,P){R[0]=S[0]*P[0];R[1]=S[1]*P[1];return R}function w(R,S,P){R[0]=S[0]/P[0];R[1]=S[1]/P[1];return R}function e(R,S){R[0]=Math.ceil(S[0]);R[1]=Math.ceil(S[1]);return R}function l(R,S){R[0]=Math.floor(S[0]);R[1]=Math.floor(S[1]);return R}function g(R,S,P){R[0]=Math.min(S[0],
P[0]);R[1]=Math.min(S[1],P[1]);return R}function d(R,S,P){R[0]=Math.max(S[0],P[0]);R[1]=Math.max(S[1],P[1]);return R}function c(R,S){R[0]=Math.round(S[0]);R[1]=Math.round(S[1]);return R}function u(R,S,P){R[0]=S[0]*P;R[1]=S[1]*P;return R}function t(R,S,P,Q){R[0]=S[0]+P[0]*Q;R[1]=S[1]+P[1]*Q;return R}function h(R,S){const P=S[0]-R[0];R=S[1]-R[1];return Math.sqrt(P*P+R*R)}function m(R,S){const P=S[0]-R[0];R=S[1]-R[1];return P*P+R*R}function n(R){const S=R[0];R=R[1];return Math.sqrt(S*S+R*R)}function z(R){const S=
R[0];R=R[1];return S*S+R*R}function k(R,S){R[0]=-S[0];R[1]=-S[1];return R}function v(R,S){R[0]=1/S[0];R[1]=1/S[1];return R}function x(R,S){var P=S[0];const Q=S[1];P=P*P+Q*Q;0<P&&(P=1/Math.sqrt(P),R[0]=S[0]*P,R[1]=S[1]*P);return R}function C(R,S){return R[0]*S[0]+R[1]*S[1]}function A(R,S,P){S=S[0]*P[1]-S[1]*P[0];R[0]=R[1]=0;R[2]=S;return R}function B(R,S,P,Q){const V=S[0];S=S[1];R[0]=V+Q*(P[0]-V);R[1]=S+Q*(P[1]-S);return R}function D(R,S){S=S||1;const P=2*p.RANDOM()*Math.PI;R[0]=Math.cos(P)*S;R[1]=
Math.sin(P)*S;return R}function E(R,S,P){const Q=S[0];S=S[1];R[0]=P[0]*Q+P[2]*S;R[1]=P[1]*Q+P[3]*S;return R}function G(R,S,P){const Q=S[0];S=S[1];R[0]=P[0]*Q+P[2]*S+P[4];R[1]=P[1]*Q+P[3]*S+P[5];return R}function K(R,S,P){const Q=S[0];S=S[1];R[0]=P[0]*Q+P[3]*S+P[6];R[1]=P[1]*Q+P[4]*S+P[7];return R}function M(R,S,P){const Q=S[0];S=S[1];R[0]=P[0]*Q+P[4]*S+P[12];R[1]=P[1]*Q+P[5]*S+P[13];return R}function H(R,S,P,Q){const V=S[0]-P[0];S=S[1]-P[1];const ca=Math.sin(Q);Q=Math.cos(Q);R[0]=V*Q-S*ca+P[0];R[1]=
V*ca+S*Q+P[1];return R}function J(R,S){var P=R[0];R=R[1];const Q=S[0];S=S[1];let V=P*P+R*R;0<V&&(V=1/Math.sqrt(V));let ca=Q*Q+S*S;0<ca&&(ca=1/Math.sqrt(ca));P=(P*Q+R*S)*V*ca;return 1<P?0:-1>P?Math.PI:Math.acos(P)}function O(R){return"vec2("+R[0]+", "+R[1]+")"}function I(R,S){return R[0]===S[0]&&R[1]===S[1]}function F(R,S){const P=R[0];R=R[1];const Q=S[0];S=S[1];return Math.abs(P-Q)<=p.EPSILON*Math.max(1,Math.abs(P),Math.abs(Q))&&Math.abs(R-S)<=p.EPSILON*Math.max(1,Math.abs(R),Math.abs(S))}function L(R,
S,P,Q,V){let ca=S[0]-P[0];P=S[1]-P[1];V=(Q[0]*ca+Q[1]*P)*(V-1);ca=Q[0]*V;P=Q[1]*V;R[0]=S[0]+ca;R[1]=S[1]+P;return R}var N=Object.freeze({__proto__:null,copy:b,set:r,add:q,subtract:y,multiply:f,divide:w,ceil:e,floor:l,min:g,max:d,round:c,scale:u,scaleAndAdd:t,distance:h,squaredDistance:m,length:n,squaredLength:z,negate:k,inverse:v,normalize:x,dot:C,cross:A,lerp:B,random:D,transformMat2:E,transformMat2d:G,transformMat3:K,transformMat4:M,rotate:H,angle:J,str:O,exactEquals:I,equals:F,projectAndScale:L,
len:n,sub:y,mul:f,div:w,dist:h,sqrDist:m,sqrLen:z});a.add=q;a.angle=J;a.ceil=e;a.copy=b;a.cross=A;a.dist=h;a.distance=h;a.div=w;a.divide=w;a.dot=C;a.equals=F;a.exactEquals=I;a.floor=l;a.inverse=v;a.len=n;a.length=n;a.lerp=B;a.max=d;a.min=g;a.mul=f;a.multiply=f;a.negate=k;a.normalize=x;a.projectAndScale=L;a.random=D;a.rotate=H;a.round=c;a.scale=u;a.scaleAndAdd=t;a.set=r;a.sqrDist=m;a.sqrLen=z;a.squaredDistance=m;a.squaredLength=z;a.str=O;a.sub=y;a.subtract=y;a.transformMat2=E;a.transformMat2d=G;a.transformMat3=
K;a.transformMat4=M;a.vec2=N})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../chunks/vec3f64"],function(a,p){const b=p.fromValues(5.802E-6,1.3558E-5,3.31E-5);p=p.fromValues(1.95E-6,5.643E-6,2.55E-7);a.atmosphereHeight=1E5;a.betaMie=3.996E-6;a.betaOzone=p;a.betaRayleigh=b;a.computeInnerAltitudeFade=function(r){return Math.min(1,Math.max(0,(r-1E5)/9E5))};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=.085;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){f=function(d){function c(){return d.apply(this,arguments)||this}b._inheritsLoose(c,d);var u=c.prototype;u.initializeProgram=function(t){var h=c.shader.get();const m=this.configuration;h=h.build({haze:m.haze,simplified:m.simplified});return new l.Program(t.rctx,h,e.Default3D)};u.initializePipeline=function(){return this.configuration.haze?g.makePipelineState({blending:g.separateBlendingParams(1,0,769,1),colorWrite:g.defaultColorWriteParams}):g.makePipelineState({blending:g.separateBlendingParams(770,
1,771,771),depthTest:{func:515},colorWrite:g.defaultColorWriteParams})};return c}(f.ShaderTechnique);f.shader=new y.ReloadableShaderModule(q.ChapmanAtmosphereShader,()=>new Promise(function(d,c){a(["./ChapmanAtmosphere.glsl"],d,c)}));q=function(d){function c(){var u=d.apply(this,arguments)||this;u.haze=!1;u.simplified=!1;return u}b._inheritsLoose(c,d);return c}(w.ShaderTechniqueConfiguration);r.__decorate([w.parameter()],q.prototype,"haze",void 0);r.__decorate([w.parameter()],q.prototype,"simplified",
void 0);p.ChapmanAtmosphereTechnique=f;p.ChapmanAtmosphereTechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y){function f(e){const l=new y.ShaderBuilder;l.attributes.add("position","vec2");l.include(p.TextureCoordinateAttribute,{attributeTextureCoordinates:1});l.varyings.add("worldRay","vec3");l.varyings.add("eyeDir","vec3");l.vertex.uniforms.add("projectionInverse","mat4");l.vertex.uniforms.add("viewInverse","mat4");l.vertex.code.add(q.glsl`void main(void) {
vec3 posViewNear = (projectionInverse * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (viewInverse * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);l.fragment.uniforms.add("lightingMainDirection","vec3").add("radii","vec2").add("scaleHeight","float").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4").add("innerFadeDistance","float").add("altitudeFade","float").add("strength","float").add("depthTex","sampler2D").add("betaRayleigh","vec3").add("betaCombined","vec3").add("skyStrength","float").add("skyHazeMultiplier","float").add("hazeStrength","float").add("mieStrength","float").add("skyHazePow","float").add("sunSize",
"float").add("sunSpread","float");e.simplified||l.fragment.uniforms.add("betaMie","float");l.include(r.Gamma);e.haze&&l.fragment.include(b.ReadLinearDepth);l.fragment.code.add(q.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);l.fragment.code.add(q.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);l.fragment.code.add(q.glsl`float getOpticalDepth(vec3 position, vec3 dir) {
float h = length(position) - radii[0];
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h / scaleHeight, dot(normalize(position), dir));
}`);l.fragment.code.add(q.glsl`
    ${e.simplified?"":q.glsl`const int STEPS = 6;`}

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getSkyColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] * 0.998;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      ${e.simplified?"":q.glsl`float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;`}

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        ${e.simplified?"":q.glsl`start = rayPlanetIntersect.y;`}
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?q.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;
      ${e.simplified?q.glsl`
          float sampleOpticalDepth = getOpticalDepth(samplePoint, multiplier * rayDir);
          float cameraOpticalDepth = getOpticalDepth(cameraPos, multiplier * rayDir);
          float lightOpticalDepth = getOpticalDepth(normalize(samplePoint) * radii[0], lightDir);
          float cameraLightOpticalDepth = min(1e6, getOpticalDepth(normalize(cameraPos) * radii[0], lightDir));
          lightOpticalDepth = mix(cameraLightOpticalDepth, lightOpticalDepth, heightParameters[3]);

          if (heightParameters[0] < radii[0]) {
            lightOpticalDepth = cameraLightOpticalDepth;
          }

          float opticalDepth = abs(cameraOpticalDepth - sampleOpticalDepth);
          ${e.haze?q.glsl`if (terrainDepth != -1.0) { opticalDepth = min(0.25 * end, opticalDepth); }`:""}

          vec3 scattering =
          ${e.haze?q.glsl`betaRayleigh`:q.glsl`mix(0.5 * betaRayleigh, betaCombined,(pow(1.0 - clamp(dot(normalize(samplePoint), rayDir), 0.0, 1.0), 10.0)))`}
          * opticalDepth;
          vec3 lightDepth = betaCombined * lightOpticalDepth;
          vec3 absorption = (exp(-scattering) - exp(-lightDepth)) / (lightDepth - scattering);`:q.glsl`
          vec3 scattering = vec3(0);
          float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir);
          float stepSize = (end - start) / float(STEPS);
          for (int i = 0; i < STEPS; i++) {
            samplePoint -= stepSize * rayDir;
            float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier);
            if (i > 0) {
              scattering *= exp(-(betaRayleigh + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
            }

            if (dot(normalize(samplePoint), lightDir) > -0.3) {
              scattering += exp(-(length(samplePoint) - radii[0]) / scaleHeight) * exp(-(betaCombined + betaMie) * getOpticalDepth(samplePoint, lightDir));
            }

            lastOpticalDepth = opticalDepth;
          }`}

      float mu = dot(rayDir, lightDir);
      float mumu = mu * mu;

      ${e.simplified?q.glsl``:q.glsl`
          float phaseRayleigh = 0.05968310365 * (1.0 + mumu);`}
        ${e.haze?q.glsl`
            ${e.simplified?q.glsl`
                return absorption * scattering;`:q.glsl`
                return scattering * stepSize * phaseRayleigh * betaRayleigh;`}`:q.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * (mumu + 1.0)) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0-mu, sunSize * 5e-5, sunSpread * 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            ${e.simplified?q.glsl`
                return absorption * scattering * (1.0 + mieStrength * 0.15 * phaseMie);`:q.glsl`
                return scattering * stepSize * (phaseRayleigh * betaRayleigh + mieStrength * 0.05 * phaseMie * betaMie);`}`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?q.glsl`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:q.glsl`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}
      vec3 skyCol = getSkyColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
      ${e.haze?q.glsl`
          float x = sqrt(max(heightParameters[1] - radii[0] * radii[0], 0.0));
          vec3 up = normalize(cameraPosition);
          vec3 upCorrected = normalize((heightParameters[0] - (x * x) / heightParameters[0]) * up + x * (radii[0] / heightParameters[0]) * rayDir);
          float skyHaze = pow( (1.0 - dot(rayDir, upCorrected)) * radii[0] / heightParameters[0], skyHazePow) * skyHazeMultiplier;
          ${e.simplified?q.glsl`
              vec3 col = ((depthSample != vec4(0)) ? 0.075 : skyHaze * 0.01) * hazeStrength * skyCol;`:q.glsl`
              vec3 col = ((depthSample != vec4(0)) ? 1.0 : skyHaze) * hazeStrength * skyCol;`}
          float alpha = 1.0;`:q.glsl`
          vec3 up = normalize(cameraPosition);
          ${e.simplified?q.glsl`
              vec3 col = mix(1.0, 3.0, max(0.0, dot(rayDir, up))) * skyStrength * skyCol;`:q.glsl`
              vec3 col = mix(4.0, 8.0, max(0.0, dot(rayDir, up))) * skyStrength * skyCol;`}
          float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":q.glsl`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `);return l}var w=Object.freeze({__proto__:null,build:f});a.ChapmanAtmosphereShader=w;a.build=f})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.TextureCoordinateAttribute=function(b,r){1===r.attributeTextureCoordinates&&(b.attributes.add("uv0","vec2"),b.varyings.add("vuv0","vec2"),b.vertex.code.add(p.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`));2===r.attributeTextureCoordinates&&(b.attributes.add("uv0","vec2"),b.varyings.add("vuv0","vec2"),b.attributes.add("uvRegion","vec4"),b.varyings.add("vuvRegion","vec4"),b.vertex.code.add(p.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`));0===r.attributeTextureCoordinates&&b.vertex.code.add(p.glsl`void forwardTextureCoordinates() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function p(b,...r){let q="";for(let y=0;y<r.length;y++)q+=b[y]+r[y];return q+=b[b.length-1]}(function(b){b.int=function(r){return Math.round(r).toString()};b.float=function(r){return r.toPrecision(8)}})(p||(p={}));a.glsl=p;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,p,b){a.ReadLinearDepth=function(r){r.include(p.RgbaFloatEncoding);r.code.add(b.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.RgbaFloatEncoding=function(b){b.code.add(p.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.Gamma=function(b){b.fragment.code.add(p.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Logger"],function(a,p,b){const r=b.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");b=function(){function c(){this.includedModules=new Map}c.prototype.include=function(u,t){this.includedModules.has(u)?this.includedModules.get(u)!==t&&r.error("Trying to include shader module multiple times with different sets of options."):
(this.includedModules.set(u,t),u(this.builder,t))};return c}();let q=function(c){function u(){var t=c.apply(this,arguments)||this;t.vertex=new w;t.fragment=new w;t.attributes=new e;t.varyings=new l;t.extensions=new g;t.constants=new d;return t}p._inheritsLoose(u,c);u.prototype.generateSource=function(t){const h=this.extensions.generateSource(t),m=this.attributes.generateSource(t),n=this.varyings.generateSource();var z="vertex"===t?this.vertex:this.fragment;const k=z.uniforms.generateSource(),v=z.code.generateSource();
t="vertex"===t?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";z=this.constants.generateSource().concat(z.constants.generateSource());return`\n${h.join("\n")}\n\n${t}\n\n${z.join("\n")}\n\n${k.join("\n")}\n\n${m.join("\n")}\n\n${n.join("\n")}\n\n${v.join("\n")}`};p._createClass(u,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms}},
{key:"builder",get:function(){return this}}]);return u}(b),y=function(){function c(){this._entries=new Map}var u=c.prototype;u.add=function(t,h,m){this._entries.set(`${t}_${h}_${m}`,{name:t,type:h,arraySize:m});return this};u.generateSource=function(){return Array.from(this._entries.values()).map(t=>{var h=t.arraySize;return`uniform ${t.type} ${t.name}${h?`[${h}]`:""};`})};p._createClass(c,[{key:"entries",get:function(){return Array.from(this._entries.values())}}]);return c}(),f=function(){function c(){this._entries=
[]}var u=c.prototype;u.add=function(t){this._entries.push(t)};u.generateSource=function(){return this._entries};return c}(),w=function(c){function u(){var t=c.apply(this,arguments)||this;t.uniforms=new y;t.code=new f;t.constants=new d;return t}p._inheritsLoose(u,c);p._createClass(u,[{key:"builder",get:function(){return this}}]);return u}(b),e=function(){function c(){this._entries=[]}var u=c.prototype;u.add=function(t,h){this._entries.push([t,h])};u.generateSource=function(t){return"fragment"===t?
[]:this._entries.map(h=>`attribute ${h[1]} ${h[0]};`)};return c}(),l=function(){function c(){this._entries=[]}var u=c.prototype;u.add=function(t,h){this._entries.push([t,h])};u.generateSource=function(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)};return c}(),g=function(){function c(){this._entries=new Set}var u=c.prototype;u.add=function(t){this._entries.add(t)};u.generateSource=function(t){const h="vertex"===t?c.ALLOWLIST_VERTEX:c.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(m=>
h.includes(m)).map(m=>`#extension ${m} : enable`)};return c}();g.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];g.ALLOWLIST_VERTEX=[];let d=function(){function c(){this._entries=[]}var u=c.prototype;u.add=function(t,h,m){let n="ERROR_CONSTRUCTOR_STRING";switch(h){case "float":n=c.numberToFloatStr(m);break;case "int":n=c.numberToIntStr(m);break;case "bool":n=m.toString();break;case "vec2":n=`vec2(${c.numberToFloatStr(m[0])},                            ${c.numberToFloatStr(m[1])})`;
break;case "vec3":n=`vec3(${c.numberToFloatStr(m[0])},                            ${c.numberToFloatStr(m[1])},                            ${c.numberToFloatStr(m[2])})`;break;case "vec4":n=`vec4(${c.numberToFloatStr(m[0])},                            ${c.numberToFloatStr(m[1])},                            ${c.numberToFloatStr(m[2])},                            ${c.numberToFloatStr(m[3])})`;break;case "ivec2":n=`ivec2(${c.numberToIntStr(m[0])},                             ${c.numberToIntStr(m[1])})`;
break;case "ivec3":n=`ivec3(${c.numberToIntStr(m[0])},                             ${c.numberToIntStr(m[1])},                             ${c.numberToIntStr(m[2])})`;break;case "ivec4":n=`ivec4(${c.numberToIntStr(m[0])},                             ${c.numberToIntStr(m[1])},                             ${c.numberToIntStr(m[2])},                             ${c.numberToIntStr(m[3])})`;break;case "mat2":case "mat3":case "mat4":n=`${h}(${Array.prototype.map.call(m,z=>c.numberToFloatStr(z)).join(", ")})`}this._entries.push(`const ${h} ${t} = ${n};`);
return this};c.numberToIntStr=function(t){return t.toFixed(0)};c.numberToFloatStr=function(t){return Number.isInteger(t)?t.toFixed(1):t.toString()};u.generateSource=function(){return Array.from(this._entries)};return c}();a.Code=f;a.Includes=b;a.ShaderBuilder=q;a.Stage=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,p){let b=function(){function r(y,
f){this._module=y;this._loadModule=f}var q=r.prototype;q.get=function(){return this._module};q.reload=function(){var y=p._asyncToGenerator(function*(){return this._module=yield this._loadModule()});return function(){return y.apply(this,arguments)}}();return r}();a.ReloadableShaderModule=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],
function(a,p,b){let r=function(){function q(f,w,e=()=>this.dispose()){this.release=e;w&&(this._config=w.snapshot());this._program=this.initializeProgram(f);this._pipeline=this.initializePipeline(f)}var y=q.prototype;y.dispose=function(){this._program=b.disposeMaybe(this._program);this._pipeline=this._config=null};y.reload=function(f){b.disposeMaybe(this._program);this._program=this.initializeProgram(f)};y.bindPass=function(f,w){};y.bindMaterial=function(f,w){};y.bindDraw=function(f,w,e){};y.bindPipelineState=
function(f){f.setPipelineState(this.pipeline)};y.ensureAttributeLocations=function(f){this.program.assertCompatibleVertexAttributeLocations(f)};p._createClass(q,[{key:"program",get:function(){return this._program}},{key:"pipeline",get:function(){return this._pipeline}},{key:"key",get:function(){return this._config.key}},{key:"configuration",get:function(){return this._config}},{key:"primitiveType",get:function(){return 4}}]);return q}();a.ShaderTechnique=r;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/mathUtils"],function(a,p,b){let r=function(){function q(){this._key="";this._keyDirty=!1;this._parameterBits=this._parameterBits.map(()=>0)}q.prototype.snapshot=function(){const y=this._parameterNames,f={key:this.key};for(const w of y)f[w]=this[w];return f};p._createClass(q,[{key:"key",get:function(){this._keyDirty&&(this._keyDirty=
!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return q}();a.ShaderTechniqueConfiguration=r;a.parameter=function(q={}){return(y,f)=>{var w,e;y._parameterNames=null!=(w=y._parameterNames)?w:[];y._parameterNames.push(f);const l=y._parameterNames.length-1;w=Math.ceil(b.log2(q.count||2));const g=null!=(e=y._parameterBits)?e:[0];let d=0;for(;16<g[d]+w;)d++,d>=g.length&&g.push(0);y._parameterBits=g;const c=g[d],u=(1<<w)-1<<c;g[d]+=w;Object.defineProperty(y,f,{get(){return this[l]},
set(t){if(this[l]!==t&&(this[l]=t,this._keyDirty=!0,this._parameterBits[d]=this._parameterBits[d]&~u|+t<<c&u,"number"!==typeof t&&"boolean"!==typeof t))throw"Configuration value for "+f+" must be boolean or number, got "+typeof t;}})}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports"],function(a){const p=new Map([["position",0],["normal",1],["uv0",2],["color",3],["size",4],["tangent",4],["auxpos1",5],
["symbolColor",5],["auxpos2",6],["featureAttribute",6],["instanceFeatureAttribute",6],["instanceColor",7],["model",8],["modelNormal",12],["modelOriginHi",11],["modelOriginLo",15]]);a.Default3D=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Program":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../webgl/checkWebGLError ../../../webgl/Program".split(" "),function(a,p,b,r,q,y){y=
function(f){function w(l,g,d){l=f.call(this,l,g.generateSource("vertex"),g.generateSource("fragment"),d)||this;l._textures=new Map;l._freeTextureUnits=new r({deallocator:null});l._fragmentUniforms=q.webglDebugEnabled()?g.fragmentUniforms.entries:null;return l}p._inheritsLoose(w,f);var e=w.prototype;e.stop=function(){this._textures.clear();this._freeTextureUnits.clear()};e.bindTexture=function(l,g){if(b.isNone(l)||null==l.glName){if(l=this._textures.get(g))this._context.bindTexture(null,l.unit),this._freeTextureUnit(l),
this._textures.delete(g);return null}let d=this._textures.get(g);null==d?(d=this._allocTextureUnit(l),this._textures.set(g,d)):d.texture=l;this._context.useProgram(this);this.setUniform1i(g,d.unit);this._context.bindTexture(l,d.unit);return d.unit};e.rebindTextures=function(){this._context.useProgram(this);this._textures.forEach((l,g)=>{this._context.bindTexture(l.texture,l.unit);this.setUniform1i(g,l.unit)});b.isSome(this._fragmentUniforms)&&this._fragmentUniforms.forEach(l=>{if(("sampler2D"===l.type||
"samplerCube"===l.type)&&!this._textures.has(l.name))throw Error(`Texture sampler ${l.name} has no bound texture`);})};e._allocTextureUnit=function(l){return{texture:l,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}};e._freeTextureUnit=function(l){this._freeTextureUnits.push(l.unit)};return w}(y.Program);a.Program=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has",
"../../core/Logger"],function(a,p,b,r){function q(w,e){switch(e){case w.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case w.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case w.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case w.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";
case w.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case w.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const y=r.getLogger("esri/views/webgl"),f=!!b("enable-feature:webgl-debug");a.checkWebGLError=function(w){if(f){const e=w.getError();e&&(w=q(w,e),y.error(new p("webgl-error","WebGL error occured",{message:w,stack:Error().stack})))}};a.hasFeatureFlagWebGLDebug=f;a.webglDebugEnabled=function(){return f};a.webglValidateShadersEnabled=
function(){return f};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Program":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./checkWebGLError ./enums ./ShaderTranspiler".split(" "),function(a,p,b,r,q,y,f){function w(d,c){if(r.isNone(d)||d.length!==c.length)return!0;for(let u=0;u<d.length;++u)if(d[u]!==c[u])return!0;return!1}function e(d,c,u){const t="webgl2"===d.webglVersion?f.transpileShader(u,c):u,h=d.gl,m=h.createShader(c);
h.shaderSource(m,t);h.compileShader(m);q.webglValidateShadersEnabled()&&!h.getShaderParameter(m,h.COMPILE_STATUS)&&(console.error("Compile error in ".concat(35633===c?"vertex":"fragment"," shader")),console.error(h.getShaderInfoLog(m)),console.error(l(t)),"webgl2"===d.webglVersion&&(console.log("Shader source before transpilation:"),console.log(u)));return m}function l(d){let c=2;return d.replace(/\n/g,()=>{var u=c++;u=1E3<=u?u.toString():("  "+u).slice(-3);return"\n"+u+":"})}function g(d,c){for(let u=
0;u<d.length;++u)c[u]=d[u]}b=function(){function d(u,t,h,m){this._context=u;this._locations=m;this._fShader=this._vShader=null;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};u||console.error("RenderingContext isn't initialized!");0===t.length&&console.error("Shaders source should not be empty!");this._vShader=e(this._context,35633,t);
this._fShader=e(this._context,35632,h);this._vShader&&this._fShader||console.error("Error loading shaders!");const n=this._context.gl,z=n.createProgram();n.attachShader(z,this._vShader);n.attachShader(z,this._fShader);m.forEach((k,v)=>n.bindAttribLocation(z,k,v));n.linkProgram(z);q.webglValidateShadersEnabled()&&!n.getProgramParameter(z,n.LINK_STATUS)&&console.error("Could not initialize shader\nVALIDATE_STATUS: "+n.getProgramParameter(z,n.VALIDATE_STATUS)+", gl error ["+n.getError()+"]infoLog: "+
n.getProgramInfoLog(z));this._glName=z;this._context.instanceCounter.increment(y.ResourceType.Program,this)}var c=d.prototype;c.dispose=function(){const u=this._context.gl;this._vShader&&(u.deleteShader(this._vShader),this._vShader=null);this._fShader&&(u.deleteShader(this._fShader),this._fShader=null);this._glName&&(u.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(y.ResourceType.Program,this))};c._getUniformLocation=function(u){void 0===this._nameToUniformLocation[u]&&
(this._nameToUniformLocation[u]=this._context.gl.getUniformLocation(this._glName,u));return this._nameToUniformLocation[u]};c.hasUniform=function(u){return null!==this._getUniformLocation(u)};c.setUniform1i=function(u,t){const h=this._nameToUniform1[u];if(void 0===h||t!==h)this._context.useProgram(this),this._context.gl.uniform1i(this._getUniformLocation(u),t),this._nameToUniform1[u]=t};c.setUniform1iv=function(u,t){const h=this._nameToUniform1v[u];w(h,t)&&(this._context.useProgram(this),this._context.gl.uniform1iv(this._getUniformLocation(u),
t),void 0===h?this._nameToUniform1v[u]=Array.from(t):g(t,h))};c.setUniform2iv=function(u,t){const h=this._nameToUniform2[u];w(h,t)&&(this._context.useProgram(this),this._context.gl.uniform2iv(this._getUniformLocation(u),t),void 0===h?this._nameToUniform2[u]=Array.from(t):g(t,h))};c.setUniform3iv=function(u,t){const h=this._nameToUniform3[u];w(h,t)&&(this._context.useProgram(this),this._context.gl.uniform3iv(this._getUniformLocation(u),t),void 0===h?this._nameToUniform3[u]=Array.from(t):g(t,h))};c.setUniform4iv=
function(u,t){const h=this._nameToUniform4[u];w(h,t)&&(this._context.useProgram(this),this._context.gl.uniform4iv(this._getUniformLocation(u),t),void 0===h?this._nameToUniform4[u]=Array.from(t):g(t,h))};c.setUniform1f=function(u,t){const h=this._nameToUniform1[u];if(void 0===h||t!==h)this._context.useProgram(this),this._context.gl.uniform1f(this._getUniformLocation(u),t),this._nameToUniform1[u]=t};c.setUniform1fv=function(u,t){const h=this._nameToUniform1v[u];w(h,t)&&(this._context.useProgram(this),
this._context.gl.uniform1fv(this._getUniformLocation(u),t),void 0===h?this._nameToUniform1v[u]=Array.from(t):g(t,h))};c.setUniform2f=function(u,t,h){const m=this._nameToUniform2[u];if(void 0===m||t!==m[0]||h!==m[1])this._context.useProgram(this),this._context.gl.uniform2f(this._getUniformLocation(u),t,h),void 0===m?this._nameToUniform2[u]=[t,h]:(m[0]=t,m[1]=h)};c.setUniform2fv=function(u,t){const h=this._nameToUniform2[u];w(h,t)&&(this._context.useProgram(this),this._context.gl.uniform2fv(this._getUniformLocation(u),
t),void 0===h?this._nameToUniform2[u]=Array.from(t):g(t,h))};c.setUniform3f=function(u,t,h,m){const n=this._nameToUniform3[u];if(void 0===n||t!==n[0]||h!==n[1]||m!==n[2])this._context.useProgram(this),this._context.gl.uniform3f(this._getUniformLocation(u),t,h,m),void 0===n?this._nameToUniform3[u]=[t,h,m]:(n[0]=t,n[1]=h,n[2]=m)};c.setUniform3fv=function(u,t){const h=this._nameToUniform3[u];w(h,t)&&(this._context.useProgram(this),this._context.gl.uniform3fv(this._getUniformLocation(u),t),void 0===h?
this._nameToUniform3[u]=Array.from(t):g(t,h))};c.setUniform4f=function(u,t,h,m,n){const z=this._nameToUniform4[u];if(void 0===z||t!==z[0]||h!==z[1]||m!==z[2]||n!==z[3])this._context.useProgram(this),this._context.gl.uniform4f(this._getUniformLocation(u),t,h,m,n),void 0===z?this._nameToUniform4[u]=[t,h,m,n]:(z[0]=t,z[1]=h,z[2]=m,z[3]=n)};c.setUniform4fv=function(u,t){const h=this._nameToUniform4[u];w(h,t)&&(this._context.useProgram(this),this._context.gl.uniform4fv(this._getUniformLocation(u),t),void 0===
h?this._nameToUniform4[u]=Array.from(t):g(t,h))};c.setUniformMatrix3fv=function(u,t,h=!1,m=!1){const n=this._nameToUniformMatrix3[u];m=m?n!==t:r.isNone(n)?!0:9!==n.length?w(n,t):9!==n.length||n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]||n[4]!==t[4]||n[5]!==t[5]||n[6]!==t[6]||n[7]!==t[7]||n[8]!==t[8];m&&(this._context.useProgram(this),this._context.gl.uniformMatrix3fv(this._getUniformLocation(u),h,t),void 0===n?this._nameToUniformMatrix3[u]=Array.from(t):g(t,n))};c.setUniformMatrix4fv=function(u,
t,h=!1){const m=this._nameToUniformMatrix4[u];var n=r.isNone(m)?!0:16!==m.length?w(m,t):16!==m.length||m[0]!==t[0]||m[1]!==t[1]||m[2]!==t[2]||m[3]!==t[3]||m[4]!==t[4]||m[5]!==t[5]||m[6]!==t[6]||m[7]!==t[7]||m[8]!==t[8]||m[9]!==t[9]||m[10]!==t[10]||m[11]!==t[11]||m[12]!==t[12]||m[13]!==t[13]||m[14]!==t[14]||m[15]!==t[15];n&&(this._context.useProgram(this),this._context.gl.uniformMatrix4fv(this._getUniformLocation(u),h,t),void 0===m?this._nameToUniformMatrix4[u]=Array.from(t):g(t,m))};c.assertCompatibleVertexAttributeLocations=
function(u){u.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")};c.stop=function(){};p._createClass(d,[{key:"glName",get:function(){return this._glName}}]);return d}();a.Program=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ResourceType=void 0;var p=a.ResourceType||(a.ResourceType={});p[p.Texture=0]="Texture";p[p.Buffer=1]="Buffer";p[p.VAO=2]="VAO";p[p.Program=3]="Program";p[p.Framebuffer=
4]="Framebuffer";p[p.Renderbuffer=5]="Renderbuffer";p[p.COUNT=6]="COUNT";a.BASE_TEXTURE_UNIT=33984;a.DepthStencilAttachment=33306;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/ShaderTranspiler":function(){define(["exports","./reservedWordsGLSL3","../../chunks/builtins"],function(a,p,b){function r(){function c(I){I.length&&D.push({type:g[x],data:I,position:K,line:E,column:G})}function u(){B=B.length?[]:B;if("/"===A&&"*"===C)return K=v+k-1,x=0,A=C,k+1;if("/"===A&&"/"===C)return K=
v+k-1,x=1,A=C,k+1;if("#"===C)return x=2,K=v+k,k;if(/\s/.test(C))return x=9,K=v+k,k;M=/\d/.test(C);H=/[^\w_]/.test(C);K=v+k;x=M?4:H?3:9999;return k}function t(){if(("\r"===C||"\n"===C)&&"\\"!==A)return c(B.join("")),x=999,k;B.push(C);A=C;return k+1}function h(){if("."===A&&/\d/.test(C))return x=5,k;if("/"===A&&"*"===C)return x=0,k;if("/"===A&&"/"===C)return x=1,k;if("."===C&&B.length){for(;m(B););x=5;return k}if(";"===C||")"===C||"("===C){if(B.length)for(;m(B););c(C);x=999;return k+1}var I=2===B.length&&
"\x3d"!==C;if(/[\w_\d\s]/.test(C)||I){for(;m(B););x=999;return k}B.push(C);A=C;return k+1}function m(I){var F=0;do{var L=b.operators.indexOf(I.slice(0,I.length+F).join(""));var N=b.operators[L];if(-1===L){if(0<F--+I.length)continue;N=I.slice(0,1).join("")}c(N);K+=N.length;B=B.slice(N.length);return B.length}while(1)}function n(){if("."===C||/[eE]/.test(C))return B.push(C),x=5,A=C,k+1;if("x"===C&&1===B.length&&"0"===B[0])return x=11,B.push(C),A=C,k+1;if(/[^\d]/.test(C))return c(B.join("")),x=999,k;
B.push(C);A=C;return k+1}function z(){"f"===C&&(B.push(C),A=C,k+=1);if(/[eE]/.test(C)||"-"===C&&/[eE]/.test(A))return B.push(C),A=C,k+1;if(/[^\d]/.test(C))return c(B.join("")),x=999,k;B.push(C);A=C;return k+1}var k=0,v=0,x=999,C,A,B=[],D=[],E=1,G=0,K=0,M=!1,H=!1,J="",O;return function(I){D=[];if(null!==I){I=I.replace?I.replace(/\r\n/g,"\n"):I;k=0;J+=I;for(O=J.length;C=J[k],k<O;){I=k;switch(x){case 0:"/"===C&&"*"===A?(B.push(C),c(B.join("")),x=999):(B.push(C),A=C);k+=1;break;case 1:k=t();break;case 2:k=
t();break;case 3:k=h();break;case 4:k=n();break;case 11:/[^a-fA-F0-9]/.test(C)?(c(B.join("")),x=999):(B.push(C),A=C,k+=1);break;case 5:k=z();break;case 9999:if(/[^\d\w_]/.test(C)){var F=B.join("");x=-1<b.literals.indexOf(F)?8:-1<b.builtins.indexOf(F)?7:6;c(B.join(""));x=999}else B.push(C),A=C,k+=1;break;case 9:/[^\s]/g.test(C)?(c(B.join("")),x=999):(B.push(C),A=C,k+=1);break;case 999:k=u()}if(I!==k)switch(J[I]){case "\n":G=0;++E;break;default:++G}}v+=k;J=J.slice(k);return D}B.length&&c(B.join(""));
x=10;c("(eof)");return D}}function q(c){return c.map(u=>"eof"!==u.type?u.data:"").join("")}function y(c,u="100",t="300 es"){const h=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const m of c)if("preprocessor"===m.type){const n=h.exec(m.data);if(n){c=n[1].replace(/\s\s+/g," ");if(c===t)return c;if(c===u)return m.data="#version "+t,u;throw Error("unknown glsl version: "+c);}}c.splice(0,0,{type:"preprocessor",data:"#version "+t},{type:"whitespace",data:"\n"});return null}function f(c,u,t,h){h=h||t;
for(const m of c)if("ident"===m.type&&m.data===t)return h in u?u[h]++:u[h]=0,f(c,u,h+"_"+u[h],h);return t}function w(c,u,t="afterVersion"){const h={data:"\n",type:"whitespace"},m=z=>z<c.length?/[^\r\n]$/.test(c[z].data):!1;let n=function(z){let k=-1,v=0,x=-1;for(let A=0;A<z.length;A++){var C=z[A];"preprocessor"===C.type&&(C.data.match(/#(if|ifdef|ifndef)\s+.+/)?++v:C.data.match(/#endif\s*.*/)&&--v);("afterVersion"===t||"afterPrecision"===t)&&"preprocessor"===C.type&&/^#version/.test(C.data)&&(x=Math.max(x,
A));if("afterPrecision"===t&&"keyword"===C.type&&"precision"===C.data){a:{for(C=A;C<z.length;C++){const B=z[C];if("operator"===B.type&&";"===B.data)break a}C=null}if(null===C)throw Error("precision statement not followed by any semicolons!");x=Math.max(x,C)}k<x&&0===v&&(k=A)}return k+1}(c);m(n-1)&&c.splice(n++,0,h);for(const z of u)c.splice(n++,0,z);m(n-1)&&m(n)&&c.splice(n,0,h)}function e(c,u,t,h="lowp"){w(c,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:h},{type:"whitespace",
data:" "},{type:"keyword",data:t},{type:"whitespace",data:" "},{type:"ident",data:u},{type:"operator",data:";"}],"afterPrecision")}function l(c,u,t,h,m="lowp"){w(c,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:h.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",
data:m},{type:"whitespace",data:" "},{type:"keyword",data:t},{type:"whitespace",data:" "},{type:"ident",data:u},{type:"operator",data:";"}],"afterPrecision")}var g="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const d=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];a.transpileShader=function(c,u){var t=r(),h=[];h=h.concat(t(c));c=h=h.concat(t(null));if("300 es"===y(c,"100",
"300 es"))throw Error("shader is already glsl 300 es");h=t=null;const m={},n={};for(let x=0;x<c.length;++x){const C=c[x];switch(C.type){case "keyword":35633===u&&"attribute"===C.data?C.data="in":"varying"===C.data&&(C.data=35633===u?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(C.data.trim())&&(C.data=C.data.replace(/(2D|Cube|EXT)/g,""));35632===u&&"gl_FragColor"===C.data&&(t||(t=f(c,m,"fragColor"),e(c,t,"vec4")),C.data=t);if(35632===u&&"gl_FragData"===C.data){{var z=
void 0;let A=void 0;var k=c;var v=x+1;let B=-1;for(;v<k.length;v++){const D=k[v];if("operator"===D.type&&("["===D.data&&(A=v),"]"===D.data)){z=v;break}"integer"===D.type&&(B=parseInt(D.data,10))}A&&z&&k.splice(A,z-A+1);k=B}z=f(c,m,"fragData");l(c,z,"vec4",k,"mediump");C.data=z}else 35632===u&&"gl_FragDepthEXT"===C.data&&(h||(h=f(c,m,"gl_FragDepth")),C.data=h);break;case "ident":if(0<=p.indexOf(C.data)){if(k=35633===u)a:{for(k=x-1;0<=k;k--)if(z=c[k],"whitespace"!==z.type&&"block-comment"!==z.type)if("keyword"===
z.type){if("attribute"===z.data||"in"===z.data){k=!0;break a}}else break;k=!1}if(k)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");C.data in n||(n[C.data]=f(c,m,C.data));C.data=n[C.data]}}}for(u=c.length-1;0<=u;--u)t=c[u],"preprocessor"===t.type&&((h=t.data.match(/#extension\s+(.*):/))&&h[1]&&0<=d.indexOf(h[1].trim())&&(h=c[u+1],c.splice(u,h&&"whitespace"===h.type?2:1)),(h=t.data.match(/#ifdef\s+(.*)/))&&h[1]&&0<=d.indexOf(h[1].trim())&&(t.data="#if 1"),
(h=t.data.match(/#ifndef\s+(.*)/))&&h[1]&&0<=d.indexOf(h[1].trim())&&(t.data="#if 0"));return q(c)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/chunks/builtins":function(){define(["exports"],function(a){var p={exports:{}};(function(q){(function(y){y=y();void 0!==y&&(q.exports=y)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(p);
p=p.exports;var b={exports:{}};(function(q){(function(y){y=y();void 0!==y&&(q.exports=y)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(b);b=b.exports;var r={exports:{}};(function(q){(function(y){y=y();void 0!==y&&(q.exports=y)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})})(r);
a.builtins=r.exports;a.literals=p;a.operators=b})},"esri/views/webgl/renderState":function(){define(["exports"],function(a){function p(H){return x.intern(H)}function b(H){return C.intern(H)}function r(H){return A.intern(H)}function q(H){return B.intern(H)}function y(H){return D.intern(H)}function f(H){return E.intern(H)}function w(H){return G.intern(H)}function e(H){return K.intern(H)}function l(H){return"["+H.join(",")+"]"}function g(H){return H?l([H.srcRgb,H.srcAlpha,H.dstRgb,H.dstAlpha,H.opRgb,
H.opAlpha,H.color.r,H.color.g,H.color.b,H.color.a]):null}function d(H){return H?l([H.face,H.mode]):null}function c(H){return H?l([H.factor,H.units]):null}function u(H){return H?l([H.func]):null}function t(H){return H?l([H.function.func,H.function.ref,H.function.mask,H.operation.fail,H.operation.zFail,H.operation.zPass]):null}function h(H){return H?l([H.zNear,H.zFar]):null}function m(H){return H?l([H.r,H.g,H.b,H.a]):null}function n(H){return H?l([H.mask]):null}const z={face:1029,mode:2305},k={face:1028,
mode:2305};var v=function(){function H(J,O){this.makeKey=J;this.makeRef=O;this.interns=new Map}H.prototype.intern=function(J){if(!J)return null;const O=this.makeKey(J),I=this.interns;I.has(O)||I.set(O,this.makeRef(J));return I.get(O)};return H}();const x=new v(g,H=>({__tag:"Blending",...H})),C=new v(d,H=>({__tag:"Culling",...H})),A=new v(c,H=>({__tag:"PolygonOffset",...H})),B=new v(u,H=>({__tag:"DepthTest",...H})),D=new v(t,H=>({__tag:"StencilTest",...H})),E=new v(h,H=>({__tag:"DepthWrite",...H})),
G=new v(m,H=>({__tag:"ColorWrite",...H})),K=new v(n,H=>({__tag:"StencilWrite",...H})),M=new v(function(H){return H?l([g(H.blending),d(H.culling),c(H.polygonOffset),u(H.depthTest),t(H.stencilTest),h(H.depthWrite),m(H.colorWrite),n(H.stencilWrite)]):null},H=>({blending:p(H.blending),culling:b(H.culling),polygonOffset:r(H.polygonOffset),depthTest:q(H.depthTest),stencilTest:y(H.stencilTest),depthWrite:f(H.depthWrite),colorWrite:w(H.colorWrite),stencilWrite:e(H.stencilWrite)}));v=function(){function H(O){this._stencilWriteInvalid=
this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=O}var J=H.prototype;J.setPipeline=function(O){if(this._pipelineInvalid||O!==this._pipeline)this.setBlending(O.blending),this.setCulling(O.culling),this.setPolygonOffset(O.polygonOffset),this.setDepthTest(O.depthTest),this.setStencilTest(O.stencilTest),this.setDepthWrite(O.depthWrite),this.setColorWrite(O.colorWrite),
this.setStencilWrite(O.stencilWrite),this._pipeline=O;this._pipelineInvalid=!1};J.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};J.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};J.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};J.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};J.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};J.invalidateDepthWrite=
function(){this._pipelineInvalid=this._depthWriteInvalid=!0};J.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};J.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};J.setBlending=function(O){this._blending=this.setSubState(O,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};J.setCulling=function(O){this._culling=this.setSubState(O,this._culling,this._cullingInvalid,this._stateSetters.setCulling);
this._cullingInvalid=!1};J.setPolygonOffset=function(O){this._polygonOffset=this.setSubState(O,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};J.setDepthTest=function(O){this._depthTest=this.setSubState(O,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};J.setStencilTest=function(O){this._stencilTest=this.setSubState(O,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);
this._stencilTestInvalid=!1};J.setDepthWrite=function(O){this._depthWrite=this.setSubState(O,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};J.setColorWrite=function(O){this._colorWrite=this.setSubState(O,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};J.setStencilWrite=function(O){this._stencilWrite=this.setSubState(O,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);
this._stencilTestInvalid=!1};J.setSubState=function(O,I,F,L){if(F||O!==I)L(O),this._pipelineInvalid=!0;return O};return H}();a.StateTracker=v;a.backFaceCullingParams=z;a.cullingParams=H=>2===H?z:1===H?k:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=k;a.makeBlending=p;a.makeColorWrite=w;a.makeCulling=b;a.makeDepthTest=q;a.makeDepthWrite=f;a.makePipelineState=function(H){return M.intern(H)};a.makePolygonOffset=r;a.makeStencilTest=
y;a.makeStencilWrite=e;a.separateBlendingParams=function(H,J,O,I,F=32774,L=32774,N=[0,0,0,0]){return{srcRgb:H,srcAlpha:J,dstRgb:O,dstAlpha:I,opRgb:F,opAlpha:L,color:{r:N[0],g:N[1],b:N[2],a:N[3]}}};a.simpleBlendingParams=function(H,J,O=32774,I=[0,0,0,0]){return{srcRgb:H,srcAlpha:H,dstRgb:J,dstAlpha:J,opRgb:O,opAlpha:O,color:{r:I[0],g:I[1],b:I[2],a:I[3]}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports"],function(a){a.Pos2=
[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];a.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];a.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];a.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];a.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,
stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];a.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y){a.createColorTexture=function(f,w,e=4){const l=new Uint8Array(e*e*4);for(let g=0;g<l.length;g+=4)l[g+0]=255*w[0],l[g+1]=255*w[1],l[g+2]=255*w[2],l[g+3]=255*w[3];return new q(f,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:e},l)};a.createEmptyDepthTexture=function(f){return new q(f,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))};a.createEmptyTexture=function(f,w=4){return new q(f,
{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:w,height:w})};a.createQuadVAO=function(f,w=b.Pos2,e=p.Default3D,l=-1,g=1){let d=null;switch(w){case b.Pos2Tex:d=new Float32Array([l,l,0,0,g,l,1,0,l,g,0,1,g,g,1,1]);break;default:d=new Float32Array([l,l,g,l,l,g,g,g])}return new y(f,e,{geometry:w},{geometry:r.createVertex(f,35044,d)})};a.createScreenSizeTriangleVAO=function(f,w=b.Pos2,e=p.Default3D){const l=new Float32Array([-1,-1,3,-1,-1,3]);return new y(f,e,{geometry:w},{geometry:r.createVertex(f,
35044,l)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/BufferObject":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/Logger","../../core/typedArrayUtil","./checkWebGLError","./enums"],function(a,p,b,r,q){const y=p.getLogger("esri.views.webgl.BufferObject");return function(){function f(e,l,g,d,c){this._context=e;this.bufferType=l;this.usage=g;this._glName=null;this._size=-1;this._indexType=void 0;e.instanceCounter.increment(q.ResourceType.Buffer,this);
this._glName=this._context.gl.createBuffer();r.checkWebGLError(this._context.gl);d&&this.setData(d,c)}f.createIndex=function(e,l,g,d){return new f(e,34963,l,g,d)};f.createVertex=function(e,l,g){return new f(e,34962,l,g)};var w=f.prototype;w.dispose=function(){var e;null!=(e=this._context)&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(q.ResourceType.Buffer,this),this._context=null):this._glName&&y.warn("Leaked WebGL buffer object")};
w.setData=function(e,l){if(e){if("number"===typeof e){if(0>e&&y.error("Buffer size cannot be negative!"),34963===this.bufferType&&l)switch(this._indexType=l,this._size=e,l){case 5123:e*=2;break;case 5125:e*=4}}else l=e.byteLength,b.isUint16Array(e)&&(l/=2,this._indexType=5123),b.isUint32Array(e)&&(l/=4,this._indexType=5125),this._size=l;l=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);var g=this._context.gl;g.bufferData(this.bufferType,e,this.usage);r.checkWebGLError(g);
this._context.bindVAO(l)}};w.setSubData=function(e,l=0,g=0,d=e.byteLength){if(e){(0>l||l>=this._size)&&y.error("offset is out of range!");var c=l,u=g,t=d,h=e.byteLength;b.isUint16Array(e)&&(h/=2,c*=2,u*=2,t*=2);b.isUint32Array(e)&&(h/=4,c*=4,u*=4,t*=4);void 0===d&&(d=h-1);g>=d&&y.error("end must be bigger than start!");l+g-d>this._size&&y.error("An attempt to write beyond the end of the buffer!");l=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);g=this._context.gl;
d=ArrayBuffer.isView(e)?e.buffer:e;e=0===u&&t===e.byteLength?d:d.slice(u,t);g.bufferSubData(this.bufferType,c,e);r.checkWebGLError(g);this._context.bindVAO(l)}};a._createClass(f,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return 34962===this.bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}}]);return f}()})},"esri/views/webgl/Texture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../core/mathUtils ../../core/maybe ./checkWebGLError ./enums ./capabilities/isWebGL2Context".split(" "),
function(a,p,b,r,q,y){let f=function(){function w(l,g,d=null){this._context=l;this.type="texture";this._glName=null;this._descriptor=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;l.instanceCounter.increment(q.ResourceType.Texture,this);this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...g};34067===this._descriptor.target?this.setDataCubeMap(d):this.setData(d)}var e=w.prototype;e.dispose=function(){this._context.gl&&
this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(q.ResourceType.Texture,this))};e.release=function(){this.dispose()};e.resize=function(l,g){const d=this._descriptor;if(d.width!==l||d.height!==g)d.width=l,d.height=g,34067===this._descriptor.target?this.setDataCubeMap(null):this.setData(null)};e.setDataCubeMap=function(l=null){for(let g=34069;34074>=g;g++)this.setData(l,g)};e.setData=function(l,
g=3553){if(this._context&&this._context.gl){var d=this._context.gl;this._glName||(this._glName=d.createTexture());void 0===l&&(l=null);null===l&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);var c=this._context.bindTexture(this,w.TEXTURE_UNIT_FOR_UPDATES),u=this._descriptor;w._validateTexture(this._context,u);d.pixelStorei(d.UNPACK_ALIGNMENT,u.unpackAlignment);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,u.flipped?1:0);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
u.preMultiplyAlpha?1:0);var t=u.pixelFormat,h=u.internalFormat?u.internalFormat:this._deriveInternalFormat(t,u.dataType);if(l instanceof ImageData||l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement){var m=l.width,n=l.height;l instanceof HTMLVideoElement&&(m=l.videoWidth,n=l.videoHeight);d.texImage2D(g,0,h,t,u.dataType,l);r.checkWebGLError(d);u.hasMipmap&&this.generateMipmap();void 0===u.width&&(u.width=m);void 0===u.height&&(u.height=n)}else{null!=u.width&&
null!=u.height||console.error("Width and height must be specified!");d.DEPTH24_STENCIL8&&h===d.DEPTH_STENCIL&&(h=d.DEPTH24_STENCIL8);m=u.width;n=u.height;var z=l;if(b.isSome(z)&&"type"in z&&"compressed"===z.type)for(t=Math.round(Math.log(Math.max(m,n))/Math.LN2)+1,u.hasMipmap=u.hasMipmap&&t===l.levels.length,t=0;;++t){d.compressedTexImage2D(g,t,h,m,n,0,l.levels[Math.min(t,l.levels.length-1)]);if(1===m&&1===n||!u.hasMipmap)break;m=Math.max(1,m>>1);n=Math.max(1,n>>1)}else if(b.isSome(l))d.texImage2D(g,
0,h,m,n,0,t,u.dataType,l),r.checkWebGLError(d),u.hasMipmap&&this.generateMipmap();else for(l=0;;++l){d.texImage2D(g,l,h,m,n,0,t,u.dataType,null);r.checkWebGLError(d);if(1===m&&1===n||!u.hasMipmap)break;m=Math.max(1,m>>1);n=Math.max(1,n>>1)}}w._applySamplingMode(d,this._descriptor);w._applyWrapMode(d,this._descriptor);w._applyAnisotropicFilteringParameters(this._context,this._descriptor);r.checkWebGLError(d);this._context.bindTexture(c,w.TEXTURE_UNIT_FOR_UPDATES)}};e.updateData=function(l,g,d,c,u,
t,h=3553){t||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const m=this._context.gl,n=this._descriptor,z=this._context.bindTexture(this,w.TEXTURE_UNIT_FOR_UPDATES);(0>g||0>d||c>n.width||u>n.height||g+c>n.width||d+u>n.height)&&console.error("An attempt to update out of bounds of the texture!");m.pixelStorei(m.UNPACK_ALIGNMENT,n.unpackAlignment);m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,n.flipped?1:0);m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
n.preMultiplyAlpha?1:0);t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?m.texSubImage2D(h,l,g,d,n.pixelFormat,n.dataType,t):m.texSubImage2D(h,l,g,d,c,u,n.pixelFormat,n.dataType,t);this._context.bindTexture(z,w.TEXTURE_UNIT_FOR_UPDATES)};e.generateMipmap=function(){const l=this._descriptor;l.hasMipmap||(this._samplingModeDirty=l.hasMipmap=!0,w._validateTexture(this._context,l));9729===l.samplingMode?(this._samplingModeDirty=!0,l.samplingMode=
9985):9728===l.samplingMode&&(this._samplingModeDirty=!0,l.samplingMode=9984);const g=this._context.bindTexture(this,w.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(l.target);this._context.bindTexture(g,w.TEXTURE_UNIT_FOR_UPDATES)};e.setSamplingMode=function(l){l!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=l,this._samplingModeDirty=!0)};e.setWrapMode=function(l){l!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=l,w._validateTexture(this._context,this._descriptor),
this._wrapModeDirty=!0)};e.applyChanges=function(){const l=this._context.gl,g=this._descriptor;this._samplingModeDirty&&(w._applySamplingMode(l,g),this._samplingModeDirty=!1);this._wrapModeDirty&&(w._applyWrapMode(l,g),this._wrapModeDirty=!1)};e._deriveInternalFormat=function(l,g){if("webgl"===this._context.webglVersion)return l;switch(g){case 5126:switch(l){case 6408:return 34836;case 6407:return 34837;default:throw Error("Unable to derive format");}default:return l}};w._validateTexture=function(l,
g){(0>g.width||0>g.height)&&console.error("Negative dimension parameters are not allowed!");const d=p.isPowerOfTwo(g.width)&&p.isPowerOfTwo(g.height);y(l.gl)||d||("number"===typeof g.wrapMode?33071!==g.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(33071!==g.wrapMode.s||33071!==g.wrapMode.t)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),g.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};w._applySamplingMode=
function(l,g){let d=g.samplingMode,c=g.samplingMode;if(9985===d||9987===d)d=9729,g.hasMipmap||(c=9729);else if(9984===d||9986===d)d=9728,g.hasMipmap||(c=9728);l.texParameteri(g.target,l.TEXTURE_MAG_FILTER,d);l.texParameteri(g.target,l.TEXTURE_MIN_FILTER,c)};w._applyWrapMode=function(l,g){"number"===typeof g.wrapMode?(l.texParameteri(g.target,l.TEXTURE_WRAP_S,g.wrapMode),l.texParameteri(g.target,l.TEXTURE_WRAP_T,g.wrapMode)):(l.texParameteri(g.target,l.TEXTURE_WRAP_S,g.wrapMode.s),l.texParameteri(g.target,
l.TEXTURE_WRAP_T,g.wrapMode.t))};w._applyAnisotropicFilteringParameters=function(l,g){var d;const c=l.capabilities.textureFilterAnisotropic;c&&l.gl.texParameterf(g.target,c.TEXTURE_MAX_ANISOTROPY,null!=(d=g.maxAnisotropy)?d:1)};a._createClass(w,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}}]);return w}();f.TEXTURE_UNIT_FOR_UPDATES=0;return f})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&
a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/VertexArrayObject":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/Logger","../../core/maybe","./enums","./Util"],function(a,p,b,r,q){const y=p.getLogger("esri.views.webgl.VertexArrayObject");return function(){function f(e,l,g,d,c=null){this._context=e;this._locations=l;this._layout=g;this._buffers=d;this._indexBuffer=c;this._glName=null;this._initialized=!1;e.instanceCounter.increment(r.ResourceType.VAO,this)}
var w=f.prototype;w.dispose=function(e=!0){if(this._context){if(this._glName){var l,g;const d=null==(l=this._context)?void 0:null==(g=l.capabilities)?void 0:g.vao;d?(d.deleteVertexArray(this._glName),this._glName=null):y.warn("Leaked WebGL VAO")}this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(e){for(const d in this._buffers)this._buffers[d].dispose(),delete this._buffers[d];this._indexBuffer=b.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(r.ResourceType.VAO,
this);this._context=null}else(this._glName||e&&0<Object.getOwnPropertyNames(this._buffers).length)&&y.warn("Leaked WebGL VAO")};w.initialize=function(){if(!this._initialized){var e=this._context.capabilities.vao;if(e){const l=e.createVertexArray();e.bindVertexArray(l);this._bindLayout();e.bindVertexArray(null);this._glName=l}this._initialized=!0}};w.bind=function(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};
w._bindLayout=function(){const {_buffers:e,_layout:l,_indexBuffer:g}=this;e||y.error("Vertex buffer dictionary is empty!");const d=this._context.gl;for(const c in e){const u=e[c];u||y.error("Vertex buffer is uninitialized!");const t=l[c];t||y.error("Vertex element descriptor is empty!");q.bindVertexBufferLayout(this._context,this._locations,u,t)}b.isSome(g)&&(this._context.capabilities.vao?d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,g.glName):this._context.bindBuffer(g))};w.unbind=function(){this.initialize();
const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()};w._unbindLayout=function(){const {_buffers:e,_layout:l}=this;e||y.error("Vertex buffer dictionary is empty!");for(const g in e){const d=e[g];d||y.error("Vertex buffer is uninitialized!");q.unbindVertexBufferLayout(this._context,this._locations,d,l[g])}b.isSome(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)};a._createClass(f,[{key:"glName",get:function(){return this._glName}},{key:"vertexBuffers",
get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((e,l)=>e+this._buffers[l].size,b.isSome(this._indexBuffer)?this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}}]);return f}()})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","../../core/maybe"],function(a,p,b){function r(f){return f[0].stride}
function q(f){switch(f){case 6406:case 6409:case 36168:return 1;case 6410:case 32854:case 33325:case 32854:case 33189:return 2;case 6407:case 6402:return 3;case 6408:case 34041:case 33326:case 35898:case 33327:case 34041:return 4;case 33328:case 34842:return 8;case 34837:return 12;case 34836:return 16;case 33776:case 33777:return.5;case 33778:case 33779:return 1;case 37488:case 37489:case 37492:case 37493:case 37494:case 37495:return.5;case 37490:case 37491:case 37496:case 37497:return 1}return 0}
function y(f){if(b.isNone(f))return 0;if("descriptor"in f)return f.glName?y(f.descriptor):0;const w=f.internalFormat||"pixelFormat"in f&&f.pixelFormat;if(!w)return 0;const e="hasMipmap"in f&&f.hasMipmap?1.3:1;f=f.width*f.height;return q(w)*f*e}a.bindVertexBufferLayout=function(f,w,e,l,g){const d=f.gl,c=f.capabilities.instancing;f.bindBuffer(e);for(const u of l)if(f=w.get(u.name),void 0===f&&console.error(`There is no location for vertex attribute '${u.name}' defined.`),u.baseInstance&&!u.divisor&&
console.error(`Vertex attribute '${u.name}' uses baseInstanceOffset without divisor.`),e=(g?g:0+u.baseInstance?u.baseInstance:0)*u.stride,4>=u.count)d.vertexAttribPointer(f,u.count,u.type,u.normalized,u.stride,u.offset+e),d.enableVertexAttribArray(f),0<u.divisor&&c&&c.vertexAttribDivisor(f,u.divisor);else if(9===u.count)for(l=0;3>l;l++)d.vertexAttribPointer(f+l,3,u.type,u.normalized,u.stride,u.offset+12*l+e),d.enableVertexAttribArray(f+l),0<u.divisor&&c&&c.vertexAttribDivisor(f+l,u.divisor);else if(16===
u.count)for(l=0;4>l;l++)d.vertexAttribPointer(f+l,4,u.type,u.normalized,u.stride,u.offset+16*l+e),d.enableVertexAttribArray(f+l),0<u.divisor&&c&&c.vertexAttribDivisor(f+l,u.divisor);else console.error("Unsupported vertex attribute element count: "+u.count)};a.getBytesPerElementFormat=q;a.getGpuMemoryUsage=y;a.getStride=r;a.unbindVertexBufferLayout=function(f,w,e,l){const g=f.gl,d=f.capabilities.instancing;f.bindBuffer(e);for(const c of l)if(e=w.get(c.name),4>=c.count)g.disableVertexAttribArray(e),
c.divisor&&0<c.divisor&&d&&d.vertexAttribDivisor(e,0);else if(9===c.count)for(l=0;3>l;l++)g.disableVertexAttribArray(e+l),c.divisor&&0<c.divisor&&d&&d.vertexAttribDivisor(e+l,0);else if(16===c.count)for(l=0;4>l;l++)g.disableVertexAttribArray(e+l),c.divisor&&0<c.divisor&&d&&d.vertexAttribDivisor(e+l,0);else console.error("Unsupported vertex attribute element count: "+c.count);f.unbindBuffer(34962)};a.vertexCount=function(f,w){return f.vertexBuffers[w].size/r(f.layout[w])};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/axisAngle ./CloudsCompositionTechnique ../webgl-engine/lib/glUtil3D".split(" "),function(a,p,b,r,q,y,f,w,e,l){var g;(function(z){z[z.FINISHED=0]="FINISHED";z[z.CHANGE_ANCHOR=1]="CHANGE_ANCHOR";z[z.FADE_IN=2]="FADE_IN"})(g||(g={}));var d;(function(z){z[z.FINISHED=
0]="FINISHED";z[z.FADE_OUT=1]="FADE_OUT";z[z.FADE_IN=2]="FADE_IN"})(d||(d={}));var c;(function(z){z[z.FINISHED=0]="FINISHED";z[z.CROSS_FADE=1]="CROSS_FADE"})(c||(c={}));let u=function(){function z(v,x,C){this._viewingMode=x;this._inverseProjectionMatrix=q.create();this._inverseViewMatrix=q.create();this._cameraPositionLastFrame=f.create();this._cloudCompositionTechnique=new e.CloudsCompositionTechnique({rctx:v,viewingMode:this._viewingMode},null);this._vao=l.createQuadVAO(v);this._setDefaultParallax(C)}
var k=z.prototype;k.destroy=function(){this._cloudCompositionTechnique=b.releaseMaybe(this._cloudCompositionTechnique);this._vao=b.disposeMaybe(this._vao)};k.render=function(v,x){const C=v.camera;if(b.isNone(this._vao)||b.isNone(C))return!1;const A=v.rctx,B=this._cloudCompositionTechnique.program;A.useProgram(B);this._cloudCompositionTechnique.bindPipelineState(A);v.scenelightingData.setLightDirectionUniform(B);v.scenelightingData.setUniforms(B);r.invert(this._inverseProjectionMatrix,C.projectionMatrix);
r.invert(this._inverseViewMatrix,C.viewMatrix);B.setUniformMatrix4fv("inverseProjectionMatrix",this._inverseProjectionMatrix);B.setUniformMatrix4fv("inverseViewMatrix",this._inverseViewMatrix);B.bindTexture(x.colorTexture,"cubeMap");this._setParallaxParams(C.eye);this._bindParallaxParams(B,v.camera);A.bindVAO(this._vao);B.assertCompatibleVertexAttributeLocations(this._vao);A.drawArrays(5,0,4);return!0};k.isFading=function(){return this._crossFadeParams.crossFadeStage!==c.FINISHED||this._fadeInOutParams.fadeInOutStage!==
d.FINISHED||this._fadeInParams.fadeInStage!==g.FINISHED};k._setDefaultParallax=function(v){this._parallaxParams={anchorPointClouds:f.create(),radius:v,cloudsFadeOutHeightFactor:0,cloudsHeight:1E5,radiusCurvatureCorrectionFactor:0,transform:q.create()};this._parallaxParamsNew={anchorPointClouds:f.create(),radius:v,cloudsFadeOutHeightFactor:0,cloudsHeight:1E5,radiusCurvatureCorrectionFactor:0,transform:q.create()};this._crossFadeParams={crossFadeStage:c.FINISHED,crossFadeFactor:0,distanceThresholdFactor:.3};
this._fadeInOutParams={fadeInOutStage:d.FINISHED,fadeInOutFactor:0,distanceThresholdFactor:.6};this._fadeInParams={fadeInStage:g.FINISHED,fadeInFactor:0,distanceThresholdFactor:2}};k._isCameraPossitionFinal=function(v){return y.equals(this._cameraPositionLastFrame,v)};k._setFadeInStage=function(v){v=this._isCameraPossitionFinal(v);this._fadeInParams.fadeInStage===g.FINISHED&&(this._fadeInParams.fadeInFactor=1,y.copy(this._parallaxParams.anchorPointClouds,m),this._fadeInParams.fadeInStage=g.CHANGE_ANCHOR,
this._crossFadeParams.crossFadeStage=c.FINISHED,this._fadeInOutParams.fadeInOutStage=d.FINISHED);this._fadeInParams.fadeInStage===g.CHANGE_ANCHOR&&v&&(y.copy(this._parallaxParams.anchorPointClouds,m),this._fadeInParams.fadeInStage=g.FADE_IN,this._startTime=performance.now());0<this._fadeInParams.fadeInFactor&&this._fadeInParams.fadeInStage===g.FADE_IN&&(this._fadeInParams.fadeInFactor=1-(performance.now()-this._startTime)/500);0>=this._fadeInParams.fadeInFactor&&this._fadeInParams.fadeInStage===g.FADE_IN&&
(this._fadeInParams.fadeInStage=g.FINISHED,this._fadeInParams.fadeInFactor=0)};k._setCrossFadingStage=function(){this._crossFadeParams.crossFadeStage===c.FINISHED&&(y.copy(this._parallaxParamsNew.anchorPointClouds,m),this._startTime=performance.now(),this._crossFadeParams.crossFadeFactor=0,this._crossFadeParams.crossFadeStage=c.CROSS_FADE);1>this._crossFadeParams.crossFadeFactor&&this._crossFadeParams.crossFadeStage===c.CROSS_FADE&&(this._crossFadeParams.crossFadeFactor=(performance.now()-this._startTime)/
500);1<=this._crossFadeParams.crossFadeFactor&&this._crossFadeParams.crossFadeStage===c.CROSS_FADE&&(this._crossFadeParams.crossFadeStage=c.FINISHED,this._crossFadeParams.crossFadeFactor=1,y.copy(this._parallaxParams.anchorPointClouds,this._parallaxParamsNew.anchorPointClouds))};k._setFadeInOutStage=function(v){v=this._isCameraPossitionFinal(v);this._fadeInOutParams.fadeInOutStage===d.FINISHED&&(this._startTime=performance.now(),this._fadeInOutParams.fadeInOutFactor=0,this._fadeInOutParams.fadeInOutStage=
d.FADE_OUT);1>this._fadeInOutParams.fadeInOutFactor&&this._fadeInOutParams.fadeInOutStage===d.FADE_OUT&&(this._fadeInOutParams.fadeInOutFactor=(performance.now()-this._startTime)/250);1<=this._fadeInOutParams.fadeInOutFactor&&this._fadeInOutParams.fadeInOutStage===d.FADE_OUT&&(this._fadeInOutParams.fadeInOutFactor=1,y.copy(this._parallaxParams.anchorPointClouds,m));1<=this._fadeInOutParams.fadeInOutFactor&&this._fadeInOutParams.fadeInOutStage===d.FADE_OUT&&v&&(this._startTime=performance.now(),this._fadeInOutParams.fadeInOutFactor=
1,this._fadeInOutParams.fadeInOutStage=d.FADE_IN,this._crossFadeParams.crossFadeStage=c.FINISHED,this._crossFadeParams.crossFadeFactor=0);0<this._fadeInOutParams.fadeInOutFactor&&this._fadeInOutParams.fadeInOutStage===d.FADE_IN&&(this._fadeInOutParams.fadeInOutFactor=1-(performance.now()-this._startTime)/500);0>=this._fadeInOutParams.fadeInOutFactor&&this._fadeInOutParams.fadeInOutStage===d.FADE_IN&&(this._fadeInOutParams.fadeInOutStage=d.FINISHED,this._fadeInOutParams.fadeInOutFactor=0)};k._setParallaxParams=
function(v){y.normalize(m,v);y.scale(m,m,this._parallaxParams.radius);0===this._parallaxParams.anchorPointClouds[0]&&0===this._parallaxParams.anchorPointClouds[1]&&0===this._parallaxParams.anchorPointClouds[2]&&y.copy(this._parallaxParams.anchorPointClouds,m);var x=y.length(y.subtract(n,this._parallaxParams.anchorPointClouds,m));let C=!0;x>this._fadeInParams.distanceThresholdFactor*this._parallaxParams.cloudsHeight||this._fadeInParams.fadeInStage!==g.FINISHED?this._setFadeInStage(v):x>this._fadeInOutParams.distanceThresholdFactor*
this._parallaxParams.cloudsHeight||this._fadeInOutParams.fadeInOutStage!==d.FINISHED?this._setFadeInOutStage(v):x>this._crossFadeParams.distanceThresholdFactor*this._parallaxParams.cloudsHeight||this._crossFadeParams.crossFadeStage!==c.FINISHED?this._setCrossFadingStage():C=!1;x=y.length(v);const A=.05*this._parallaxParams.cloudsHeight,B=.1*this._parallaxParams.cloudsHeight;this._parallaxParams.cloudsFadeOutHeightFactor=1-p.clamp(1/(A-B)*(x-this._parallaxParams.radius)+-B/(A-B),0,1);this._parallaxParams.radiusCurvatureCorrectionFactor=
.84*Math.sqrt(Math.max(x*x-this._parallaxParams.radius*this._parallaxParams.radius,0))/x;w.fromPoints(t,this._parallaxParams.anchorPointClouds,h);this._parallaxParams.transform=q.create();r.rotate(this._parallaxParams.transform,this._parallaxParams.transform,h[3],w.axis(h));C&&(w.fromPoints(t,this._parallaxParamsNew.anchorPointClouds,h),this._parallaxParamsNew.transform=q.create(),r.rotate(this._parallaxParamsNew.transform,this._parallaxParamsNew.transform,h[3],w.axis(h)));y.copy(this._cameraPositionLastFrame,
v)};k._bindParallaxParams=function(v,x){v.setUniform1f("cloudsHeight",this._parallaxParams.cloudsHeight);v.setUniformMatrix4fv("rotationMatrixClouds",this._parallaxParams.transform);v.setUniformMatrix4fv("rotationMatrixCloudsCrossFade",this._parallaxParamsNew.transform);v.setUniform3fv("anchorPosition",this._parallaxParams.anchorPointClouds);v.setUniform3fv("anchorPositionCrossFade",this._parallaxParamsNew.anchorPointClouds);this._fadeInOutParams.fadeInOutStage!==d.FINISHED?v.setUniform1f("totalFadeInOut",
this._parallaxParams.cloudsFadeOutHeightFactor+Math.max(p.clamp(this._fadeInOutParams.fadeInOutFactor,0,1))):v.setUniform1f("totalFadeInOut",this._parallaxParams.cloudsFadeOutHeightFactor+Math.max(p.clamp(this._fadeInParams.fadeInFactor,0,1)));v.setUniform1f("radiusCurvatureCorrectionFactor",this._parallaxParams.radiusCurvatureCorrectionFactor);v.setUniform1i("crossFade",this._crossFadeParams.crossFadeStage);v.setUniform1f("crossFadeAnchorFactor",p.clamp(this._crossFadeParams.crossFadeFactor,0,1));
v.setUniform1f("radius",this._parallaxParams.radius);v.setUniform3fv("cameraPosition",x.eye)};return z}();const t=f.fromValues(0,0,1),h=w.create(),m=f.create(),n=f.create();a.CloudsComposition=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),function(a,p,b,r,q,y){function f(c=l){return[c[0],c[1],c[2],c[3]]}function w(c,u,t,h,m=f()){m[0]=c;m[1]=
u;m[2]=t;m[3]=h;return m}function e(c,u){c[3]=u;return c}const l=[0,0,1,0],g=b.create(),d=b.create();a.UP=l;a.angle=function(c){return c[3]};a.axis=function(c){return c};a.compose=function(c,u,t=f()){p.setAxisAngle(g,c,c[3]);p.setAxisAngle(d,u,u[3]);p.multiply(g,d,g);return e(t,p.getAxisAngle(t,g))};a.copy=function(c,u=f()){return w(c[0],c[1],c[2],c[3],u)};a.create=f;a.fromAxisAndAngle=function(c,u,t=f()){r.copy(t,c);t[3]=u;return t};a.fromPoints=function(c,u,t=f()){r.cross(t,c,u);r.normalize(t,t);
t[3]=q.angle(c,u);return t};a.fromValues=w;a.setAngle=e;a.wrap=function(c,u,t,h){return w(c,u,t,h,y.sv4d.get())};a.wrapAxisAngle=function(c,u){return w(c[0],c[1],c[2],u,y.sv4d.get())};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),function(a,p,b,r,q,y,f){function w(V){V[0]=0;V[1]=0;V[2]=0;V[3]=1;return V}function e(V,ca,ba){ba*=.5;const Z=Math.sin(ba);V[0]=Z*ca[0];V[1]=Z*ca[1];V[2]=
Z*ca[2];V[3]=Math.cos(ba);return V}function l(V,ca){const ba=2*Math.acos(ca[3]),Z=Math.sin(ba/2);Z>q.EPSILON?(V[0]=ca[0]/Z,V[1]=ca[1]/Z,V[2]=ca[2]/Z):(V[0]=1,V[1]=0,V[2]=0);return ba}function g(V,ca,ba){const Z=ca[0],ha=ca[1],fa=ca[2];ca=ca[3];const aa=ba[0],W=ba[1],U=ba[2];ba=ba[3];V[0]=Z*ba+ca*aa+ha*U-fa*W;V[1]=ha*ba+ca*W+fa*aa-Z*U;V[2]=fa*ba+ca*U+Z*W-ha*aa;V[3]=ca*ba-Z*aa-ha*W-fa*U;return V}function d(V,ca,ba){ba*=.5;const Z=ca[0],ha=ca[1],fa=ca[2];ca=ca[3];const aa=Math.sin(ba);ba=Math.cos(ba);
V[0]=Z*ba+ca*aa;V[1]=ha*ba+fa*aa;V[2]=fa*ba-ha*aa;V[3]=ca*ba-Z*aa;return V}function c(V,ca,ba){ba*=.5;const Z=ca[0],ha=ca[1],fa=ca[2];ca=ca[3];const aa=Math.sin(ba);ba=Math.cos(ba);V[0]=Z*ba-fa*aa;V[1]=ha*ba+ca*aa;V[2]=fa*ba+Z*aa;V[3]=ca*ba-ha*aa;return V}function u(V,ca,ba){ba*=.5;const Z=ca[0],ha=ca[1],fa=ca[2];ca=ca[3];const aa=Math.sin(ba);ba=Math.cos(ba);V[0]=Z*ba+ha*aa;V[1]=ha*ba-Z*aa;V[2]=fa*ba+ca*aa;V[3]=ca*ba-fa*aa;return V}function t(V,ca){const ba=ca[0],Z=ca[1];ca=ca[2];V[0]=ba;V[1]=Z;
V[2]=ca;V[3]=Math.sqrt(Math.abs(1-ba*ba-Z*Z-ca*ca));return V}function h(V,ca,ba,Z){const ha=ca[0],fa=ca[1],aa=ca[2];ca=ca[3];let W=ba[0],U=ba[1],X=ba[2];ba=ba[3];let T;let Y;var ea=ha*W+fa*U+aa*X+ca*ba;0>ea&&(ea=-ea,W=-W,U=-U,X=-X,ba=-ba);1-ea>q.EPSILON?(T=Math.acos(ea),Y=Math.sin(T),ea=Math.sin((1-Z)*T)/Y,Z=Math.sin(Z*T)/Y):ea=1-Z;V[0]=ea*ha+Z*W;V[1]=ea*fa+Z*U;V[2]=ea*aa+Z*X;V[3]=ea*ca+Z*ba;return V}function m(V){var ca=q.RANDOM();const ba=q.RANDOM(),Z=q.RANDOM(),ha=Math.sqrt(1-ca);ca=Math.sqrt(ca);
V[0]=ha*Math.sin(2*Math.PI*ba);V[1]=ha*Math.cos(2*Math.PI*ba);V[2]=ca*Math.sin(2*Math.PI*Z);V[3]=ca*Math.cos(2*Math.PI*Z);return V}function n(V,ca){const ba=ca[0],Z=ca[1],ha=ca[2];ca=ca[3];var fa=ba*ba+Z*Z+ha*ha+ca*ca;fa=fa?1/fa:0;V[0]=-ba*fa;V[1]=-Z*fa;V[2]=-ha*fa;V[3]=ca*fa;return V}function z(V,ca){V[0]=-ca[0];V[1]=-ca[1];V[2]=-ca[2];V[3]=ca[3];return V}function k(V,ca){var ba=ca[0]+ca[4]+ca[8];if(0<ba)ba=Math.sqrt(ba+1),V[3]=.5*ba,ba=.5/ba,V[0]=(ca[5]-ca[7])*ba,V[1]=(ca[6]-ca[2])*ba,V[2]=(ca[1]-
ca[3])*ba;else{let Z=0;ca[4]>ca[0]&&(Z=1);ca[8]>ca[3*Z+Z]&&(Z=2);const ha=(Z+1)%3,fa=(Z+2)%3;ba=Math.sqrt(ca[3*Z+Z]-ca[3*ha+ha]-ca[3*fa+fa]+1);V[Z]=.5*ba;ba=.5/ba;V[3]=(ca[3*ha+fa]-ca[3*fa+ha])*ba;V[ha]=(ca[3*ha+Z]+ca[3*Z+ha])*ba;V[fa]=(ca[3*fa+Z]+ca[3*Z+fa])*ba}return V}function v(V,ca,ba,Z){var ha=.5*Math.PI/180;ca*=ha;ba*=ha;Z*=ha;ha=Math.sin(ca);ca=Math.cos(ca);const fa=Math.sin(ba);ba=Math.cos(ba);const aa=Math.sin(Z);Z=Math.cos(Z);V[0]=ha*ba*Z-ca*fa*aa;V[1]=ca*fa*Z+ha*ba*aa;V[2]=ca*ba*aa-ha*
fa*Z;V[3]=ca*ba*Z+ha*fa*aa;return V}function x(V){return"quat("+V[0]+", "+V[1]+", "+V[2]+", "+V[3]+")"}function C(V,ca,ba){const Z=y.dot(ca,ba);if(-.999999>Z)return y.cross(L,N,ca),1E-6>y.len(L)&&y.cross(L,R,ca),y.normalize(L,L),e(V,L,Math.PI),V;if(.999999<Z)return V[0]=0,V[1]=0,V[2]=0,V[3]=1,V;y.cross(L,ca,ba);V[0]=L[0];V[1]=L[1];V[2]=L[2];V[3]=1+Z;return I(V,V)}function A(V,ca,ba,Z,ha,fa){h(S,ca,ha,fa);h(P,ba,Z,fa);h(V,S,P,2*fa*(1-fa));return V}function B(V,ca,ba,Z){const ha=Q;ha[0]=ba[0];ha[3]=
ba[1];ha[6]=ba[2];ha[1]=Z[0];ha[4]=Z[1];ha[7]=Z[2];ha[2]=-ca[0];ha[5]=-ca[1];ha[8]=-ca[2];return I(V,k(V,ha))}const D=f.copy,E=f.set,G=f.add,K=f.scale,M=f.dot,H=f.lerp,J=f.length,O=f.squaredLength,I=f.normalize,F=f.exactEquals;f=f.equals;const L=r.create(),N=r.fromValues(1,0,0),R=r.fromValues(0,1,0),S=b.create(),P=b.create(),Q=p.create();p=Object.freeze({__proto__:null,identity:w,setAxisAngle:e,getAxisAngle:l,multiply:g,rotateX:d,rotateY:c,rotateZ:u,calculateW:t,slerp:h,random:m,invert:n,conjugate:z,
fromMat3:k,fromEuler:v,str:x,copy:D,set:E,add:G,mul:g,scale:K,dot:M,lerp:H,length:J,len:J,squaredLength:O,sqrLen:O,normalize:I,exactEquals:F,equals:f,rotationTo:C,sqlerp:A,setAxes:B});a.add=G;a.calculateW=t;a.conjugate=z;a.copy=D;a.dot=M;a.equals=f;a.exactEquals=F;a.fromEuler=v;a.fromMat3=k;a.getAxisAngle=l;a.identity=w;a.invert=n;a.len=J;a.length=J;a.lerp=H;a.mul=g;a.multiply=g;a.normalize=I;a.quat=p;a.random=m;a.rotateX=d;a.rotateY=c;a.rotateZ=u;a.rotationTo=C;a.scale=K;a.set=E;a.setAxes=B;a.setAxisAngle=
e;a.slerp=h;a.sqlerp=A;a.sqrLen=O;a.squaredLength=O;a.str=x})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),function(a,p,b,r,q,y,f,w,e){y=function(l){function g(){return l.apply(this,
arguments)||this}b._inheritsLoose(g,l);var d=g.prototype;d.initializeProgram=function(c){const u=g.shader.get().build();return new w.Program(c.rctx,u,f.Default3D)};d.initializePipeline=function(){return e.makePipelineState({blending:e.simpleBlendingParams(1,770),depthTest:{func:515},colorWrite:e.defaultColorWriteParams})};return g}(y.ShaderTechnique);y.shader=new q.ReloadableShaderModule(r.CloudsCompositionShader,()=>new Promise(function(l,g){a(["./CloudsComposition.glsl"],l,g)}));p.CloudsCompositionTechnique=
y;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w){function e(){const g=new w.ShaderBuilder;g.attributes.add("position","vec2");g.varyings.add("worldRay","vec3");g.vertex.uniforms.add("inverseProjectionMatrix","mat4");g.vertex.uniforms.add("inverseViewMatrix","mat4");g.vertex.code.add(f.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);g.fragment.uniforms.add("lightingMainDirection","vec3").add("cubeMap","samplerCube");g.fragment.include(q.ColorConversion);g.fragment.include(y.RgbaFloatEncoding);g.include(b.EvaluateMainLighting);g.include(p.EvaluateAmbientLighting,{pbrMode:0,lightingSphericalHarmonicsOrder:2});g.include(r.CloudsParallaxShading);g.fragment.code.add(f.glsl`void main() {
vec4 cloudsColor = crossFade == 0 ? renderCloud(normalize(worldRay)) : renderCloudCrossFade(normalize(worldRay));
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return g}var l=Object.freeze({__proto__:null,build:e});a.CloudsCompositionShader=l;a.build=e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.EvaluateAmbientLighting=function(b,r){b=b.fragment;const q=void 0!==r.lightingSphericalHarmonicsOrder?r.lightingSphericalHarmonicsOrder:2;0===q?(b.uniforms.add("lightingAmbientSH0","vec3"),b.code.add(p.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===q?(b.uniforms.add("lightingAmbientSH_R","vec4"),b.uniforms.add("lightingAmbientSH_G","vec4"),b.uniforms.add("lightingAmbientSH_B","vec4"),b.code.add(p.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===q&&(b.uniforms.add("lightingAmbientSH0","vec3"),b.uniforms.add("lightingAmbientSH_R1","vec4"),b.uniforms.add("lightingAmbientSH_G1","vec4"),b.uniforms.add("lightingAmbientSH_B1","vec4"),b.uniforms.add("lightingAmbientSH_R2","vec4"),b.uniforms.add("lightingAmbientSH_G2","vec4"),b.uniforms.add("lightingAmbientSH_B2","vec4"),b.code.add(p.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),1!==r.pbrMode&&2!==r.pbrMode||b.code.add(p.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.EvaluateMainLighting=function(b){b=b.fragment;b.uniforms.add("lightingMainDirection","vec3");b.uniforms.add("lightingMainIntensity","vec3");b.uniforms.add("lightingFixedFactor","float");b.code.add(p.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define(["exports","../shading/PiUtils.glsl","../../shaderModules/interfaces"],function(a,p,b){a.CloudsParallaxShading=function(r){r.fragment.uniforms.add("anchorPosition","vec3").add("anchorPositionCrossFade","vec3").add("fadeInOutFactor","float").add("cloudsHeight","float").add("rotationMatrixClouds","mat4").add("rotationMatrixCloudsCrossFade","mat4").add("radiusCurvatureCorrectionFactor",
"float").add("radius","float").add("cameraPosition","vec3").add("totalFadeInOut","float").add("crossFade","int").add("crossFadeAnchorFactor","float");r.include(p.PiUtils);r.fragment.code.add(b.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 camPos, vec3 spherePos, float radiusReduction)
{
vec3 dirAnchor = normalize(spherePos);
vec3 sphereOriginOffset = dirAnchor * radiusReduction;
float radiusClouds = radius + cloudsHeight - radiusReduction;
float B = 2.0 * dot(camPos - sphereOriginOffset, dir);
float C = dot(camPos - sphereOriginOffset, camPos - sphereOriginOffset) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = camPos + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);r.fragment.code.add(b.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);r.fragment.code.add(b.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);r.fragment.code.add(b.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
const float GAMMA_SRGB = 2.1;
const float INV_GAMMA_SRGB = 0.4761904;
vec3 calculateCloudColor(vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA_SRGB)), vec3(INV_GAMMA_SRGB));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);r.fragment.code.add(b.glsl`vec4 renderCloud(vec3 worldRay)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = textureCube(cubeMap, worldRayRotatedCorrected).rgba;
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(normalize(-worldRay), cloudData), totalTransmittance);
}`);r.fragment.code.add(b.glsl`vec4 renderCloudCrossFade(vec3 worldRay)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = textureCube(cubeMap, worldRayRotatedCorrected).rgba;
vec4 cloudColor = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade, 0.0);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = textureCube(cubeMap, worldRayRotatedCorrected).rgba;
vec4 cloudColorCrossFade = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.PiUtils=function(b){b.vertex.code.add(p.glsl`const float PI = 3.141592653589793;`);b.fragment.code.add(p.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.ColorConversion=function(b){b.code.add(p.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3f32 ../../../geometry/projectionEllipsoid ./CloudsTechnique ./NoiseTextureAtlas ../webgl-engine/lib/glUtil3D ../../webgl/FramebufferObject".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d,c){let u=function(){function t(m,
n){this._cubeMapSize=2048;this._viewMat3=q.create();this._eye=w.zeros();this._faceRenderFlags=[];this.viewDirections=[w.fromValues(1,0,0),w.fromValues(-1,0,0),w.fromValues(0,1,0),w.fromValues(0,-1,0),w.fromValues(0,0,1)];this.upDirections=[w.fromValues(0,1,0),w.fromValues(0,1,0),w.fromValues(0,0,-1),w.fromValues(0,0,1),w.fromValues(0,1,0)];this._cloudRadius=0;this._viewMatrix=f.create();this.coverage=.4;this.detailSize=this.cloudSize=this.density=.5;this.smoothness=.7;this.absorption=0;this.cloudHeight=
1;this._noiseTextureAtlas=new g.NoiseTextureAtlas(m,n);this._noiseTextureAtlas.render(128,m);this._frameBufferCube=new c(m,{colorTarget:2,width:this._cubeMapSize,height:this._cubeMapSize},{target:34067,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize});this._vao=d.createQuadVAO(m);this._technique=new l.CloudsTechnique({rctx:m,viewingMode:n.state.viewingMode},null);this._cloudRadius=.5*e.getReferenceEllipsoid(n.spatialReference).radius;
this.resetRenderFlags()}var h=t.prototype;h.destroy=function(){this._technique=b.releaseMaybe(this._technique);this._frameBufferCube=b.disposeMaybe(this._frameBufferCube);this._vao=b.disposeMaybe(this._vao);this._noiseTextureAtlas=b.destroyMaybe(this._noiseTextureAtlas)};h.resetRenderFlags=function(){for(let m=0;5>m;m++)this._faceRenderFlags[m]=!0};h._allRendered=function(){for(let m=0;5>m;m++)if(!0===this._faceRenderFlags[m])return!1;return!0};h.remap=function(m,n,z,k,v){return k+(m-n)*(v-k)/(z-
n)};h.render=function(m){if(b.isNone(this._vao)||this._allRendered())return!1;this.resetRenderFlags();m.setViewport(0,0,this._cubeMapSize,this._cubeMapSize);m.bindFramebuffer(this._frameBufferCube,!1,34069);const n=this._technique.program;m.useProgram(n);n.bindTexture(this._noiseTextureAtlas.textureAtlas,"cloudShapeTexture");n.setUniform1f("cloudRadius",this._cloudRadius);n.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize);n.setUniform1f("power",this._power);n.setUniform1f("sigmaE",this._sigmaE);
n.setUniform1f("density",this._density);n.setUniform1f("cloudSize",this._cloudSize);n.setUniform1f("detailSize",this._detailSize);n.setUniform1f("smoothness",this._smoothness);n.setUniform1f("cloudHeight",this._cloudHeight);n.setUniform1f("coverage",this._coverage);m.bindVAO(this._vao);n.assertCompatibleVertexAttributeLocations(this._vao);this._technique.bindPipelineState(m);for(let z=0;5>z;z++)this._faceRenderFlags[z]&&(y.targetTo(this._viewMatrix,this._eye,this.viewDirections[z],this.upDirections[z]),
r.fromMat4(this._viewMat3,this._viewMatrix),n.setUniformMatrix3fv("viewMatrix",this._viewMat3),this._frameBufferCube.framebufferTexture2D(this._frameBufferCube.colorAttachment.glName,m.gl,36064,34069+z),m.gl.drawArrays(m.gl.TRIANGLE_STRIP,0,4),m.gl.flush(),this._faceRenderFlags[z]=!1);return!0};p._createClass(t,[{key:"coverage",get:function(){return this._coverage},set:function(m){this._coverage=m;this.resetRenderFlags()}},{key:"density",get:function(){return this._density},set:function(m){this._density=
this.remap(m,0,1,0,.3);this.resetRenderFlags()}},{key:"cloudSize",get:function(){return this._cloudSize},set:function(m){this._cloudSize=this.remap(Math.max(.01,1-m),0,1,0,.02);this.resetRenderFlags()}},{key:"detailSize",get:function(){return this._detailSize},set:function(m){this._detailSize=this.remap(Math.max(.01,1-m),0,1,0,.2);this.resetRenderFlags()}},{key:"smoothness",get:function(){return this._smoothness},set:function(m){this._smoothness=this.remap(1-m,0,1,0,.5);this.resetRenderFlags()}},
{key:"absorption",get:function(){return this._power},set:function(m){this._sigmaE=1+m;this._power=this.remap(m,0,1,35,70);this.resetRenderFlags()}},{key:"cloudHeight",get:function(){return this._cloudHeight},set:function(m){this._cloudHeight=this.remap(m,0,1,0,1500);this.resetRenderFlags()}},{key:"test",get:function(){return{power:this._power,density:this._density,cloudHeight:this._cloudHeight,cloudSize:this._cloudSize,detailSize:this._detailSize,smoothness:this._smoothness}}}]);return t}();a.CloudsGenerator=
u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(a,p){function b(I,F){I[0]=F[0];I[1]=F[1];I[2]=F[2];I[3]=F[4];I[4]=F[5];I[5]=F[6];I[6]=F[8];I[7]=F[9];I[8]=F[10];return I}function r(I,F){I[0]=F[0];I[1]=F[1];I[2]=F[2];I[3]=F[3];I[4]=F[4];I[5]=F[5];I[6]=F[6];I[7]=F[7];I[8]=F[8];return I}function q(I,F,L,N,R,S,P,Q,V,ca){I[0]=F;I[1]=L;I[2]=N;I[3]=R;I[4]=S;I[5]=P;I[6]=Q;I[7]=V;I[8]=ca;return I}function y(I){I[0]=1;I[1]=0;I[2]=0;I[3]=
0;I[4]=1;I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function f(I,F){if(I===F){const L=F[1],N=F[2],R=F[5];I[1]=F[3];I[2]=F[6];I[3]=L;I[5]=F[7];I[6]=N;I[7]=R}else I[0]=F[0],I[1]=F[3],I[2]=F[6],I[3]=F[1],I[4]=F[4],I[5]=F[7],I[6]=F[2],I[7]=F[5],I[8]=F[8];return I}function w(I,F){const L=F[0],N=F[1],R=F[2],S=F[3],P=F[4],Q=F[5],V=F[6],ca=F[7];F=F[8];const ba=F*P-Q*ca,Z=-F*S+Q*V,ha=ca*S-P*V;let fa=L*ba+N*Z+R*ha;if(!fa)return null;fa=1/fa;I[0]=ba*fa;I[1]=(-F*N+R*ca)*fa;I[2]=(Q*N-R*P)*fa;I[3]=Z*fa;I[4]=(F*L-R*V)*
fa;I[5]=(-Q*L+R*S)*fa;I[6]=ha*fa;I[7]=(-ca*L+N*V)*fa;I[8]=(P*L-N*S)*fa;return I}function e(I,F){const L=F[0],N=F[1],R=F[2],S=F[3],P=F[4],Q=F[5],V=F[6],ca=F[7];F=F[8];I[0]=P*F-Q*ca;I[1]=R*ca-N*F;I[2]=N*Q-R*P;I[3]=Q*V-S*F;I[4]=L*F-R*V;I[5]=R*S-L*Q;I[6]=S*ca-P*V;I[7]=N*V-L*ca;I[8]=L*P-N*S;return I}function l(I){const F=I[3],L=I[4],N=I[5],R=I[6],S=I[7],P=I[8];return I[0]*(P*L-N*S)+I[1]*(-P*F+N*R)+I[2]*(S*F-L*R)}function g(I,F,L){const N=F[0],R=F[1],S=F[2],P=F[3],Q=F[4],V=F[5],ca=F[6],ba=F[7];F=F[8];const Z=
L[0],ha=L[1],fa=L[2],aa=L[3],W=L[4],U=L[5],X=L[6],T=L[7];L=L[8];I[0]=Z*N+ha*P+fa*ca;I[1]=Z*R+ha*Q+fa*ba;I[2]=Z*S+ha*V+fa*F;I[3]=aa*N+W*P+U*ca;I[4]=aa*R+W*Q+U*ba;I[5]=aa*S+W*V+U*F;I[6]=X*N+T*P+L*ca;I[7]=X*R+T*Q+L*ba;I[8]=X*S+T*V+L*F;return I}function d(I,F,L){const N=F[0],R=F[1],S=F[2],P=F[3],Q=F[4],V=F[5],ca=F[6],ba=F[7];F=F[8];const Z=L[0];L=L[1];I[0]=N;I[1]=R;I[2]=S;I[3]=P;I[4]=Q;I[5]=V;I[6]=Z*N+L*P+ca;I[7]=Z*R+L*Q+ba;I[8]=Z*S+L*V+F;return I}function c(I,F,L){const N=F[0],R=F[1],S=F[2],P=F[3],Q=
F[4],V=F[5],ca=F[6],ba=F[7];F=F[8];const Z=Math.sin(L);L=Math.cos(L);I[0]=L*N+Z*P;I[1]=L*R+Z*Q;I[2]=L*S+Z*V;I[3]=L*P-Z*N;I[4]=L*Q-Z*R;I[5]=L*V-Z*S;I[6]=ca;I[7]=ba;I[8]=F;return I}function u(I,F,L){const N=L[0],R=L[1];L=L[2];I[0]=N*F[0];I[1]=N*F[1];I[2]=N*F[2];I[3]=R*F[3];I[4]=R*F[4];I[5]=R*F[5];I[6]=L*F[6];I[7]=L*F[7];I[8]=L*F[8];return I}function t(I,F,L){const N=L[0];L=L[1];I[0]=N*F[0];I[1]=N*F[1];I[2]=N*F[2];I[3]=L*F[3];I[4]=L*F[4];I[5]=L*F[5];return I}function h(I,F){I[0]=1;I[1]=0;I[2]=0;I[3]=
0;I[4]=1;I[5]=0;I[6]=F[0];I[7]=F[1];I[8]=1;return I}function m(I,F){const L=Math.sin(F);F=Math.cos(F);I[0]=F;I[1]=L;I[2]=0;I[3]=-L;I[4]=F;I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function n(I,F){I[0]=F[0];I[1]=0;I[2]=0;I[3]=0;I[4]=F[1];I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function z(I,F){I[0]=F[0];I[1]=F[1];I[2]=0;I[3]=F[2];I[4]=F[3];I[5]=0;I[6]=F[4];I[7]=F[5];I[8]=1;return I}function k(I,F){var L=F[0],N=F[1],R=F[2];F=F[3];var S=L+L,P=N+N;const Q=R+R;L*=S;const V=N*S;N*=P;const ca=R*S,ba=R*P;R*=Q;S*=
F;P*=F;F*=Q;I[0]=1-N-R;I[3]=V-F;I[6]=ca+P;I[1]=V+F;I[4]=1-L-R;I[7]=ba-S;I[2]=ca-P;I[5]=ba+S;I[8]=1-L-N;return I}function v(I,F){const L=F[0],N=F[1],R=F[2],S=F[4],P=F[5],Q=F[6],V=F[8],ca=F[9];F=F[10];const ba=F*P-Q*ca,Z=-F*S+Q*V,ha=ca*S-P*V;var fa=L*ba+N*Z+R*ha;if(!fa)return null;fa=1/fa;I[0]=ba*fa;I[1]=(-F*N+R*ca)*fa;I[2]=(Q*N-R*P)*fa;I[3]=Z*fa;I[4]=(F*L-R*V)*fa;I[5]=(-Q*L+R*S)*fa;I[6]=ha*fa;I[7]=(-ca*L+N*V)*fa;I[8]=(P*L-N*S)*fa;return I}function x(I,F){const L=F[0],N=F[1],R=F[2],S=F[3],P=F[4],Q=
F[5],V=F[6],ca=F[7];var ba=F[8],Z=F[9],ha=F[10],fa=F[11];const aa=F[12],W=F[13],U=F[14];F=F[15];const X=L*Q-N*P,T=L*V-R*P,Y=L*ca-S*P,ea=N*V-R*Q,ia=N*ca-S*Q,la=R*ca-S*V,pa=ba*W-Z*aa,ua=ba*U-ha*aa;ba=ba*F-fa*aa;const wa=Z*U-ha*W;Z=Z*F-fa*W;ha=ha*F-fa*U;fa=X*ha-T*Z+Y*wa+ea*ba-ia*ua+la*pa;if(!fa)return null;fa=1/fa;I[0]=(Q*ha-V*Z+ca*wa)*fa;I[1]=(V*ba-P*ha-ca*ua)*fa;I[2]=(P*Z-Q*ba+ca*pa)*fa;I[3]=(R*Z-N*ha-S*wa)*fa;I[4]=(L*ha-R*ba+S*ua)*fa;I[5]=(N*ba-L*Z-S*pa)*fa;I[6]=(W*la-U*ia+F*ea)*fa;I[7]=(U*Y-aa*la-
F*T)*fa;I[8]=(aa*ia-W*Y+F*X)*fa;return I}function C(I,F,L){I[0]=2/F;I[1]=0;I[2]=0;I[3]=0;I[4]=-2/L;I[5]=0;I[6]=-1;I[7]=1;I[8]=1;return I}function A(I){return"mat3("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+", "+I[8]+")"}function B(I){return Math.sqrt(I[0]**2+I[1]**2+I[2]**2+I[3]**2+I[4]**2+I[5]**2+I[6]**2+I[7]**2+I[8]**2)}function D(I,F,L){I[0]=F[0]+L[0];I[1]=F[1]+L[1];I[2]=F[2]+L[2];I[3]=F[3]+L[3];I[4]=F[4]+L[4];I[5]=F[5]+L[5];I[6]=F[6]+L[6];I[7]=F[7]+L[7];I[8]=
F[8]+L[8];return I}function E(I,F,L){I[0]=F[0]-L[0];I[1]=F[1]-L[1];I[2]=F[2]-L[2];I[3]=F[3]-L[3];I[4]=F[4]-L[4];I[5]=F[5]-L[5];I[6]=F[6]-L[6];I[7]=F[7]-L[7];I[8]=F[8]-L[8];return I}function G(I,F,L){I[0]=F[0]*L;I[1]=F[1]*L;I[2]=F[2]*L;I[3]=F[3]*L;I[4]=F[4]*L;I[5]=F[5]*L;I[6]=F[6]*L;I[7]=F[7]*L;I[8]=F[8]*L;return I}function K(I,F,L,N){I[0]=F[0]+L[0]*N;I[1]=F[1]+L[1]*N;I[2]=F[2]+L[2]*N;I[3]=F[3]+L[3]*N;I[4]=F[4]+L[4]*N;I[5]=F[5]+L[5]*N;I[6]=F[6]+L[6]*N;I[7]=F[7]+L[7]*N;I[8]=F[8]+L[8]*N;return I}function M(I,
F){return I[0]===F[0]&&I[1]===F[1]&&I[2]===F[2]&&I[3]===F[3]&&I[4]===F[4]&&I[5]===F[5]&&I[6]===F[6]&&I[7]===F[7]&&I[8]===F[8]}function H(I,F){const L=I[0],N=I[1],R=I[2],S=I[3],P=I[4],Q=I[5],V=I[6],ca=I[7];I=I[8];const ba=F[0],Z=F[1],ha=F[2],fa=F[3],aa=F[4],W=F[5],U=F[6],X=F[7];F=F[8];return Math.abs(L-ba)<=p.EPSILON*Math.max(1,Math.abs(L),Math.abs(ba))&&Math.abs(N-Z)<=p.EPSILON*Math.max(1,Math.abs(N),Math.abs(Z))&&Math.abs(R-ha)<=p.EPSILON*Math.max(1,Math.abs(R),Math.abs(ha))&&Math.abs(S-fa)<=p.EPSILON*
Math.max(1,Math.abs(S),Math.abs(fa))&&Math.abs(P-aa)<=p.EPSILON*Math.max(1,Math.abs(P),Math.abs(aa))&&Math.abs(Q-W)<=p.EPSILON*Math.max(1,Math.abs(Q),Math.abs(W))&&Math.abs(V-U)<=p.EPSILON*Math.max(1,Math.abs(V),Math.abs(U))&&Math.abs(ca-X)<=p.EPSILON*Math.max(1,Math.abs(ca),Math.abs(X))&&Math.abs(I-F)<=p.EPSILON*Math.max(1,Math.abs(I),Math.abs(F))}function J(I){const F=p.EPSILON,L=I[0],N=I[1],R=I[2],S=I[3],P=I[4],Q=I[5],V=I[6],ca=I[7];I=I[8];return Math.abs(1-(L*L+S*S+V*V))<=F&&Math.abs(1-(N*N+P*
P+ca*ca))<=F&&Math.abs(1-(R*R+Q*Q+I*I))<=F}var O=Object.freeze({__proto__:null,fromMat4:b,copy:r,set:q,identity:y,transpose:f,invert:w,adjoint:e,determinant:l,multiply:g,translate:d,rotate:c,scale:u,scaleByVec2:t,fromTranslation:h,fromRotation:m,fromScaling:n,fromMat2d:z,fromQuat:k,normalFromMat4Legacy:v,normalFromMat4:x,projection:C,str:A,frob:B,add:D,subtract:E,multiplyScalar:G,multiplyScalarAndAdd:K,exactEquals:M,equals:H,isOrthoNormal:J,mul:g,sub:E});a.add=D;a.adjoint=e;a.copy=r;a.determinant=
l;a.equals=H;a.exactEquals=M;a.frob=B;a.fromMat2d=z;a.fromMat4=b;a.fromQuat=k;a.fromRotation=m;a.fromScaling=n;a.fromTranslation=h;a.identity=y;a.invert=w;a.isOrthoNormal=J;a.mat3=O;a.mul=g;a.multiply=g;a.multiplyScalar=G;a.multiplyScalarAndAdd=K;a.normalFromMat4=x;a.normalFromMat4Legacy=v;a.projection=C;a.rotate=c;a.scale=u;a.scaleByVec2=t;a.set=q;a.str=A;a.sub=E;a.subtract=E;a.translate=d;a.transpose=f})},"esri/chunks/vec3f32":function(){define(["exports"],function(a){function p(){return new Float32Array(3)}
function b(m){const n=new Float32Array(3);n[0]=m[0];n[1]=m[1];n[2]=m[2];return n}function r(m,n,z){const k=new Float32Array(3);k[0]=m;k[1]=n;k[2]=z;return k}function q(m,n){return new Float32Array(m,n,3)}function y(){return p()}function f(){return r(1,1,1)}function w(){return r(1,0,0)}function e(){return r(0,1,0)}function l(){return r(0,0,1)}const g=p(),d=f(),c=w(),u=e(),t=l();var h=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,createView:q,zeros:y,ones:f,unitX:w,unitY:e,unitZ:l,ZEROS:g,
ONES:d,UNIT_X:c,UNIT_Y:u,UNIT_Z:t});a.ONES=d;a.UNIT_X=c;a.UNIT_Y=u;a.UNIT_Z=t;a.ZEROS=g;a.clone=b;a.create=p;a.createView=q;a.fromValues=r;a.ones=f;a.unitX=w;a.unitY=e;a.unitZ=l;a.vec3f32=h;a.zeros=y})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Clouds.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e){y=function(l){function g(){return l.apply(this,arguments)||this}b._inheritsLoose(g,l);var d=g.prototype;d.initializeProgram=function(c){const u=g.shader.get().build();return new w.Program(c.rctx,u,f.Default3D)};d.initializePipeline=function(){return e.makePipelineState({blending:e.separateBlendingParams(1,1,0,0),depthTest:{func:515},colorWrite:e.defaultColorWriteParams})};return g}(y.ShaderTechnique);y.shader=new q.ReloadableShaderModule(r.CloudsShader,()=>new Promise(function(l,
g){a(["./Clouds.glsl"],l,g)}));p.CloudsTechnique=y;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/Clouds.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,p,b){function r(){const y=new b.ShaderBuilder;y.attributes.add("position","vec3");y.fragment.uniforms.add("cloudRadius","float").add("halfCubeMapSize","float").add("power","float").add("sigmaE","float").add("density",
"float").add("cloudSize","float").add("detailSize","float").add("smoothness","float").add("cloudHeight","float").add("coverage","float").add("viewMatrix","mat3").add("cloudShapeTexture","sampler2D");y.vertex.code.add(p.glsl`void main(void) {
gl_Position = vec4(position, 1.0);
}`);y.fragment.code.add(p.glsl`const int STEPS = 200;
const int STEPS_LIGHT = 6;
const float stepL = 300.0 / float(STEPS_LIGHT);
const float cloudStart = 1500.0;
vec3 rayDirection(vec2 fragCoord) {
vec2 xy = fragCoord - halfCubeMapSize;
return normalize(vec3(-xy, -halfCubeMapSize));
}
float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}
float saturate(float x) {
return clamp(x, 0.0, 1.0);
}`);y.fragment.code.add("\n    float getCloudShape(vec3 pos) {\n      const float textureWidth \x3d 1560.0;\n      const float dataWidth \x3d 1560.0;\n      const float tileRows \x3d 12.0;\n      const vec3 atlasDimensions \x3d vec3(128.0, 128.0, 144.0);\n\n      //Change from Y being height to Z being height\n      vec3 p \x3d pos.xzy;\n\n      //Pixel coordinates of point in the 3D data\n      vec3 coord \x3d vec3(mod(p, atlasDimensions));\n      float f \x3d fract(coord.z);\n      float level \x3d floor(coord.z);\n      float tileY \x3d floor(level / tileRows);\n      float tileX \x3d level - tileY * tileRows;\n\n      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column\n      vec2 offset \x3d atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;\n      vec2 pixel \x3d coord.xy + offset;\n      vec2 data \x3d texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;\n\n      return 1.0 - mix(data.x, data.y, f);\n    }");
y.fragment.code.add("\n    float clouds(vec3 p) {\n      float cloud \x3d saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));\n      float heightFraction \x3d saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);\n\n      //Round the bottom and top of the clouds\n      cloud *\x3d saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * saturate(remap(heightFraction, 0.75, 1.0, 1.0, 0.0));\n\n      float shape \x3d getCloudShape(cloudSize * p);\n      shape *\x3d mix(0.0, 1.0, min(2.0 * (1.0 - coverage), 1.0));\n      cloud \x3d saturate(remap(cloud, shape, 1.0, 0.0, 1.0));\n\n      if (cloud \x3c\x3d 0.0) {\n        return 0.0;\n      }\n\n      return density * saturate(remap(cloud, smoothness * getCloudShape(detailSize * p), 1.0, 0.0, 1.0));\n    }");
y.fragment.code.add("\n    vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {\n      float a \x3d dot(dir, dir);\n      float b \x3d 2.0 * dot(dir, start);\n      float c \x3d dot(start, start) - (radius * radius);\n      float d \x3d (b * b) - 4.0 * a * c;\n\n      if (d \x3c 0.0) {\n        return vec2(1e5, -1e5);\n      }\n\n      return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));\n    }\n      \n    float HenyeyGreenstein(float g, float costh) {\n      return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));\n    }\n    ");
y.fragment.code.add("\n    vec3 multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      vec3 luminance \x3d vec3(0);\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
y.fragment.code.add("\n    vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {\n      float lightRayDensity \x3d clouds(p);\n      lightRayDensity +\x3d clouds(p + sunDirection * 1.0 * stepL);\n      lightRayDensity +\x3d clouds(p + sunDirection * 2.0 * stepL);\n      lightRayDensity +\x3d clouds(p + sunDirection * 3.0 * stepL);\n      lightRayDensity +\x3d clouds(p + sunDirection * 4.0 * stepL);\n      lightRayDensity +\x3d clouds(p + sunDirection * 5.0 * stepL);\n      \n      vec3 beersLaw \x3d multipleOctaves(lightRayDensity, mu, stepL);\n\n      return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);\n    }");
y.fragment.code.add('\n    vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {\n\n      // This is never true but having the if statement stops later loop unrolling, texture prefetching and WebGL context crashes\n      if (dir.z \x3c 0.0) {\n        return vec3(0);\n      }\n\n      //Variable to track transmittance along view ray. Assume clear sky and attenuate light when encountering clouds.\n      totalTransmittance \x3d 1.0;\n\n      float stepS \x3d totalDistance / float(STEPS);\n      float cameraHeight \x3d length(org);\n\n      //Alignment of view and light directions.\n      float mu \x3d 0.5 + 0.5 * dot(sunDirection, dir);\n      float phaseFunction \x3d mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);\n      \n      vec3 p \x3d org + distToStart  * dir;\n      float dist \x3d distToStart;\n      vec3 color \x3d vec3(0.0);\n\n      for (int i \x3d 0; i \x3c STEPS; i++) {\n\n        float sampleDensity \x3d clouds(p);\n        float sampleSigmaE \x3d sampleDensity * sigmaE;\n\n        if (sampleDensity \x3e 0.0 ) {\n          float ambient \x3d mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));\n\n          vec3 luminance \x3d sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));\n          float transmittance \x3d exp(-sampleSigmaE * stepS);\n\n          //Better energy conserving integration\n          //"From Physically based sky, atmosphere and cloud rendering in Frostbite" 5.6\n          color +\x3d totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;\n\n          totalTransmittance *\x3d transmittance;\n\n          //If ray combined transmittance is close to 0, nothing beyond this sample point is visible, so break early.\n          if (totalTransmittance \x3c\x3d 0.001) {\n            totalTransmittance \x3d 0.0;\n            break;\n          }\n\n        }\n\n        dist +\x3d stepS;\n        p \x3d org + dir * dist;\n      }\n\n      return color;\n    }');
y.fragment.code.add("\n    void main() {\n      vec3 rayDir \x3d rayDirection(gl_FragCoord.xy);\n      rayDir \x3d normalize(viewMatrix * rayDir);\n\n      vec3 viewPos \x3d vec3(0, 0, cloudRadius + 1.0);\n\n      bool hitsPlanet \x3d rayDir.z \x3c 0.0;\n\n      if (hitsPlanet) {\n        gl_FragColor \x3d vec4(vec3(0), 1);\n        return;\n      }\n\n      vec2 rayStartIntersect \x3d sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);\n      vec2 rayEndIntersect \x3d sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);\n      float distToStart \x3d rayStartIntersect.y;\n      float totalDistance \x3d rayEndIntersect.y - distToStart;\n\n      float totalTransmittance \x3d 1.0;\n      vec3 sunDirection \x3d normalize(vec3(0, 0, 1));\n      vec3 col \x3d 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;\n\n      gl_FragColor \x3d vec4(col, totalTransmittance);\n    }\n  ");
return y}var q=Object.freeze({__proto__:null,build:r});a.CloudsShader=q;a.build=r})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../core/maybe ../../webgl/BufferObject ../../webgl/FramebufferObject ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ../../webgl/checkWebGLError ../../webgl/enums ../../../chunks/builtins ../../webgl/renderState ../../webgl/Texture ../../webgl/VertexArrayObject ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){b=function(){function t(m,n){this._shapeTextureDescriptor={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,hasMipmap:!1,width:1,height:1};this._tileRows=this._tileSize=1;this._frameBuffer=new r(m,{colorTarget:0});this._vao=u.createQuadVAO(m);this.textureAtlas=new g(m,this._shapeTextureDescriptor,null);this._technique=new c.NoiseTextureAtlasTechnique({rctx:m,viewingMode:n.state.viewingMode},null)}var h=t.prototype;h.destroy=function(){this._technique=
p.releaseMaybe(this._technique);this._frameBuffer=p.disposeMaybe(this._frameBuffer);this._vao=p.disposeMaybe(this._vao);this.textureAtlas=p.disposeMaybe(this.textureAtlas)};h.render=function(m,n){if(p.isNone(this._vao)||p.isNone(this.textureAtlas))return!1;this._tileSize=m;this._tileRows=Math.ceil(Math.sqrt(this._tileSize));m=(m+2)*this._tileRows;this._frameBuffer.resize(m,m);this.textureAtlas.resize(m,m);this._frameBuffer.attachColorTexture(this.textureAtlas);n.bindFramebuffer(this._frameBuffer);
var z=this._technique.program;n.bindVAO(this._vao);z.assertCompatibleVertexAttributeLocations(this._vao);this._technique.bindPipelineState(n);n.useProgram(z);z.setUniform1f("tileSize",this._tileSize);z.setUniform1f("tileRows",this._tileRows);z=n.getViewport();n.setViewport(0,0,m,m);n.gl.drawArrays(n.gl.TRIANGLE_STRIP,0,4);this._frameBuffer.detachColorTexture();n.setViewport(z.x,z.y,z.width,z.height);return!0};return t}();a.NoiseTextureAtlas=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/FramebufferObject":function(){define("../../chunks/_rollupPluginBabelHelpers ../../core/Logger ./checkWebGLError ./enums ./Renderbuffer ./Texture ./Util".split(" "),
function(a,p,b,r,q,y,f){function w(g){return"type"in g&&"texture"===g.type}function e(g,d){void 0!==d.width&&0<=d.width&&void 0!==d.height&&0<=d.height?d.width===g.width&&d.height===g.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(d.width=g.width,d.height=g.height)}const l=p.getLogger("esri.views.webgl.FrameBufferObject");p=function(){function g(c,u,t,h){this._context=c;this._stencilAttachment=this._depthAttachment=this._glName=null;this._colorAttachments=new Map;
this._initialized=!1;this._desc={...u};c.instanceCounter.increment(r.ResourceType.Framebuffer,this);if(t)for(Array.isArray(t)||(t=[t]),u=0;u<t.length;++u){var m,n;const k=t[u];let v;w(k)?(v=k.descriptor,this._colorAttachments.set(36064+u,k)):(v=k,this._colorAttachments.set(36064+u,new y(c,k)));0!==(null==(m=this._desc)?void 0:m.colorTarget)&&2!==(null==(n=this._desc)?void 0:n.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!");
this._validateColorAttachmentPoint(36064+u);this._validateTextureDimensions(v,this._desc)}if(h instanceof q){var z;c=null!=(z=this._desc.depthStencilTarget)?z:3;2===c?this._stencilAttachment=h:1===c||3===c?this._depthAttachment=h:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER');e(h.descriptor,this._desc)}else if(h){this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");
let k;w(h)?(this._depthStencilTexture=h,k=h.descriptor):this._depthStencilTexture=new y(this._context,h);this._validateTextureDimensions(k,this._desc)}}var d=g.prototype;d.dispose=function(){if(this._desc){var c=this._context.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(c);this._context.instanceCounter.decrement(r.ResourceType.Framebuffer,
this);this._desc=null}};d.getColorTexture=function(c){return(c=this._colorAttachments.get(c))&&w(c)?c:null};d.framebufferTexture2D=function(c,u,t=36064,h=3553,m=0){u.framebufferTexture2D(u.FRAMEBUFFER,t,h,c,m)};d.attachColorTexture=function(c,u=36064){c&&(this._validateColorAttachmentPoint(u),this._validateTextureDimensions(c.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(c.glName,this._context.gl,u)),this._colorAttachments.set(u,
c))};d.detachColorTexture=function(c=36064){const u=this._colorAttachments.get(c);if(w(u))return this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,c)),this._colorAttachments.delete(c),u};d.attachDepthStencilTexture=function(c){if(c){var u=c.descriptor;34041!==u.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==u.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");
this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");this._validateTextureDimensions(u,this._desc);this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(c.glName,this._context.gl,r.DepthStencilAttachment));this._depthStencilTexture=
c}};d.detachDepthStencilTexture=function(){const c=this._depthStencilTexture;c&&this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,r.DepthStencilAttachment));this._depthStencilTexture=null;return c};d.attachDepthStencilBuffer=function(c){if(c){var u=c.descriptor;34041!==u.internalFormat&&33189!==u.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");e(u,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=
34041===u.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),u=this._context.gl,u.framebufferRenderbuffer(u.FRAMEBUFFER,1===this._desc.depthStencilTarget?u.DEPTH_ATTACHMENT:u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,c.glName));this._depthAttachment=c}};d.detachDepthStencilBuffer=function(){const c=this._context.gl,u=this._depthAttachment;u&&this._initialized&&(this._context.bindFramebuffer(this),c.framebufferRenderbuffer(c.FRAMEBUFFER,1===this._desc.depthStencilTarget?c.DEPTH_ATTACHMENT:
c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,null));this._depthAttachment=null;return u};d.detachAll=function(){this.detachColorTexture();this.detachDepthStencilBuffer();this.detachDepthStencilTexture()};d.copyToTexture=function(c,u,t,h,m,n,z){(0>c||0>u||0>m||0>n)&&console.error("Offsets cannot be negative!");(0>=t||0>=h)&&console.error("Copy width and height must be greater than zero!");var k=this._desc;const v=z.descriptor;3553!==z.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");
(c+t>k.width||u+h>k.height||m+t>v.width||n+h>v.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");k=this._context;z=k.bindTexture(z,y.TEXTURE_UNIT_FOR_UPDATES);k.bindFramebuffer(this);k.gl.copyTexSubImage2D(3553,0,m,n,c,u,t,h);k.bindTexture(z,y.TEXTURE_UNIT_FOR_UPDATES)};d.readPixels=function(c,u,t,h,m,n,z){(0>=t||0>=h)&&console.error("Copy width and height must be greater than zero!");z||console.error("Target memory is not initialized!");
this._context.bindFramebuffer(this);this._context.gl.readPixels(c,u,t,h,m,n,z)};d.resize=function(c,u){const t=this._desc;if(t.width!==c||t.height!==u)if(this._initialized){t.width=c;t.height=u;this._colorAttachments.forEach(h=>{h&&h.resize(c,u)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(c,u);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(c,u),this._stencilAttachment&&this._stencilAttachment.resize(c,u);this._context.getBoundFramebufferObject()===
this&&this._context.bindFramebuffer(null);this._initialized=!1}else t.width=c,t.height=u,this._colorAttachments.forEach(h=>{h&&h.resize(c,u)}),this._depthStencilTexture&&this._depthStencilTexture.resize(c,u)};d.initializeAndBind=function(c=3553){var u,t,h,m;const n=this._context.gl;if(this._initialized)n.bindFramebuffer(n.FRAMEBUFFER,this.glName);else{this._glName&&n.deleteFramebuffer(this._glName);var z=this._context,k=n.createFramebuffer(),v=this._desc,x=null!=(u=v.colorTarget)?u:1;u=null!=(t=v.width)?
t:1;t=null!=(h=v.height)?h:1;n.bindFramebuffer(n.FRAMEBUFFER,k);0===this._colorAttachments.size&&(0===x?this._colorAttachments.set(36064,new y(z,{target:2===this.descriptor.colorTarget?34067:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:v.width,height:v.height})):(h=new q(z,{internalFormat:32854,width:u,height:t}),this._colorAttachments.set(36064,h)));this._colorAttachments.forEach((C,A)=>{C&&(w(C)?this.framebufferTexture2D(C.glName,n,A,c):n.framebufferRenderbuffer(n.FRAMEBUFFER,
n.COLOR_ATTACHMENT0,n.RENDERBUFFER,C.glName))});h=null!=(m=v.depthStencilTarget)?m:0;switch(h){case 1:case 3:this._depthAttachment||(this._depthAttachment=new q(z,{internalFormat:1===v.depthStencilTarget?33189:34041,width:u,height:t}));n.framebufferRenderbuffer(n.FRAMEBUFFER,1===h?n.DEPTH_ATTACHMENT:n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new q(z,{internalFormat:36168,width:u,height:t}));n.framebufferRenderbuffer(n.FRAMEBUFFER,
n.STENCIL_ATTACHMENT,n.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||(z.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new y(z,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:u,height:t})),this.framebufferTexture2D(this._depthStencilTexture.glName,n,n.DEPTH_STENCIL_ATTACHMENT,
c)}b.webglValidateShadersEnabled()&&n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=k;this._initialized=!0}};d._disposeColorAttachments=function(){this._colorAttachments.forEach((c,u)=>{if(w(c))this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,u)),c.dispose();else if(c instanceof WebGLRenderbuffer){const t=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),
t.framebufferRenderbuffer(t.FRAMEBUFFER,u,t.RENDERBUFFER,null));this._context.gl.deleteRenderbuffer(c)}});this._colorAttachments.clear()};d._disposeDepthStencilAttachments=function(){const c=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),c.framebufferRenderbuffer(c.FRAMEBUFFER,1===this._desc.depthStencilTarget?c.DEPTH_ATTACHMENT:c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&
(this._initialized&&(this._context.bindFramebuffer(this),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.STENCIL_ATTACHMENT,c.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,c,c.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};d._validateTextureDimensions=function(c,u){3553!==c.target&&34067!==c.target&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");
void 0!==u.width&&0<=u.width&&void 0!==u.height&&0<=u.height?u.width===c.width&&u.height===c.height||console.error("Color attachment texture must match the framebuffer's!"):(u.width=c.width,u.height=c.height)};d._validateColorAttachmentPoint=function(c){if(-1===g._MAX_COLOR_ATTACHMENTS){const u=this._context.capabilities.drawBuffers;g._MAX_COLOR_ATTACHMENTS=u?this._context.gl.getParameter(u.MAX_COLOR_ATTACHMENTS):1}c-=36064;c+1>g._MAX_COLOR_ATTACHMENTS&&l.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${c+
1}. Implementation supports up to ${g._MAX_COLOR_ATTACHMENTS} color attachments`)};a._createClass(g,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._desc}},{key:"colorTexture",get:function(){const c=this._colorAttachments.get(36064);return c&&w(c)?c:null}},{key:"colorAttachment",get:function(){return this._colorAttachments.get(36064)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},
{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._desc.width}},{key:"height",get:function(){return this._desc.height}},{key:"gpuMemoryUsage",get:function(){return f.getGpuMemoryUsage(this.colorAttachment)+f.getGpuMemoryUsage(this.depthStencilAttachment)}}]);return g}();p._MAX_COLOR_ATTACHMENTS=-1;return p})},"esri/views/webgl/Renderbuffer":function(){define(["../../chunks/_rollupPluginBabelHelpers","./enums"],function(a,p){return function(){function b(q,
y){this._context=q;this._desc=y;this._context.instanceCounter.increment(p.ResourceType.Renderbuffer,this);q=this._context.gl;this.glName=q.createRenderbuffer();this._context.bindRenderbuffer(this);q.renderbufferStorage(q.RENDERBUFFER,y.internalFormat,y.width,y.height)}var r=b.prototype;r.resize=function(q,y){const f=this._desc;if(f.width!==q||f.height!==y)f.width=q,f.height=y,q=this._context.gl,this._context.bindRenderbuffer(this),q.renderbufferStorage(q.RENDERBUFFER,f.internalFormat,f.width,f.height)};
r.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(p.ResourceType.Renderbuffer,this),this._context=null)};a._createClass(b,[{key:"descriptor",get:function(){return this._desc}}]);return b}()})},"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/NoiseTextureAtlas.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e){y=function(l){function g(){return l.apply(this,arguments)||this}b._inheritsLoose(g,l);var d=g.prototype;d.initializeProgram=function(c){const u=g.shader.get().build();return new w.Program(c.rctx,u,f.Default3D)};d.initializePipeline=function(){return e.makePipelineState({blending:e.simpleBlendingParams(1,0),depthTest:{func:515},colorWrite:e.defaultColorWriteParams})};return g}(y.ShaderTechnique);y.shader=new q.ReloadableShaderModule(r.NoiseTextureAtlasShader,()=>new Promise(function(l,
g){a(["./NoiseTextureAtlas.glsl"],l,g)}));p.NoiseTextureAtlasTechnique=y;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,p,b){function r(){const y=new b.ShaderBuilder;y.attributes.add("position","vec3");y.vertex.code.add(p.glsl`void main(void) {
gl_Position = vec4(position, 1.0);
}`);y.fragment.uniforms.add("tileRows","float").add("tileSize","float");y.fragment.code.add("\n    #define NUM_CELLS 2.0\n    #define PERLIN_WORLEY 0\n    #define WORLEY 1\n\n    float remap(float x, float low1, float high1, float low2, float high2) {\n      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);\n    }\n\n    float saturate(float x) {\n      return clamp(x, 0.0, 1.0);\n    }\n\n    vec4 taylorInvSqrt(vec4 r) {\n      return 1.79284291400159 - 0.85373472095314 * r;\n    }\n\n    vec4 mod289(vec4 x) {\n      return x - floor( x * (1.0 / 289.0)) * 289.0;\n    }\n\n    vec4 permute(vec4 x) {\n      return mod289(((x * 34.0) + 1.0) * x);\n    }\n\n    vec4 fade(vec4 t) {\n      return (t * t * t) * (t * (t * vec4(6) - vec4(15)) + vec4(10));\n    }\n\n    float glmPerlin(vec4 Position, vec4 rep) {\n      vec4 Pi0 \x3d mod(floor(Position), rep);\n      vec4 Pi1 \x3d mod(Pi0 + float(1), rep);\n      vec4 Pf0 \x3d fract(Position);\n      vec4 Pf1 \x3d Pf0 - float(1);\n      vec4 ix \x3d vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n      vec4 iy \x3d vec4(Pi0.y, Pi0.y, Pi1.y, Pi1.y);\n      vec4 iz0 \x3d vec4(Pi0.z);\n      vec4 iz1 \x3d vec4(Pi1.z);\n      vec4 iw0 \x3d vec4(Pi0.w);\n      vec4 iw1 \x3d vec4(Pi1.w);\n\n      vec4 ixy \x3d permute(permute(ix) + iy);\n      vec4 ixy0 \x3d permute(ixy + iz0);\n      vec4 ixy1 \x3d permute(ixy + iz1);\n      vec4 ixy00 \x3d permute(ixy0 + iw0);\n      vec4 ixy01 \x3d permute(ixy0 + iw1);\n      vec4 ixy10 \x3d permute(ixy1 + iw0);\n      vec4 ixy11 \x3d permute(ixy1 + iw1);\n\n      vec4 gx00 \x3d ixy00 / float(7);\n      vec4 gy00 \x3d floor(gx00) / float(7);\n      vec4 gz00 \x3d floor(gy00) / float(6);\n      gx00 \x3d fract(gx00) - float(0.5);\n      gy00 \x3d fract(gy00) - float(0.5);\n      gz00 \x3d fract(gz00) - float(0.5);\n      vec4 gw00 \x3d vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n      vec4 sw00 \x3d step(gw00, vec4(0));\n      gx00 -\x3d sw00 * (step(float(0), gx00) - float(0.5));\n      gy00 -\x3d sw00 * (step(float(0), gy00) - float(0.5));\n\n      vec4 gx01 \x3d ixy01 / float(7);\n      vec4 gy01 \x3d floor(gx01) / float(7);\n      vec4 gz01 \x3d floor(gy01) / float(6);\n      gx01 \x3d fract(gx01) - float(0.5);\n      gy01 \x3d fract(gy01) - float(0.5);\n      gz01 \x3d fract(gz01) - float(0.5);\n      vec4 gw01 \x3d vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n      vec4 sw01 \x3d step(gw01, vec4(0.0));\n      gx01 -\x3d sw01 * (step(float(0), gx01) - float(0.5));\n      gy01 -\x3d sw01 * (step(float(0), gy01) - float(0.5));\n\n      vec4 gx10 \x3d ixy10 / float(7);\n      vec4 gy10 \x3d floor(gx10) / float(7);\n      vec4 gz10 \x3d floor(gy10) / float(6);\n      gx10 \x3d fract(gx10) - float(0.5);\n      gy10 \x3d fract(gy10) - float(0.5);\n      gz10 \x3d fract(gz10) - float(0.5);\n      vec4 gw10 \x3d vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n      vec4 sw10 \x3d step(gw10, vec4(0.0));\n      gx10 -\x3d sw10 * (step(float(0), gx10) - float(0.5));\n      gy10 -\x3d sw10 * (step(float(0), gy10) - float(0.5));\n\n      vec4 gx11 \x3d ixy11 / float(7);\n      vec4 gy11 \x3d floor(gx11) / float(7);\n      vec4 gz11 \x3d floor(gy11) / float(6);\n      gx11 \x3d fract(gx11) - float(0.5);\n      gy11 \x3d fract(gy11) - float(0.5);\n      gz11 \x3d fract(gz11) - float(0.5);\n      vec4 gw11 \x3d vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n      vec4 sw11 \x3d step(gw11, vec4(float(0)));\n      gx11 -\x3d sw11 * (step(float(0), gx11) - float(0.5));\n      gy11 -\x3d sw11 * (step(float(0), gy11) - float(0.5));\n\n      vec4 g0000 \x3d vec4(gx00.x, gy00.x, gz00.x, gw00.x);\n      vec4 g1000 \x3d vec4(gx00.y, gy00.y, gz00.y, gw00.y);\n      vec4 g0100 \x3d vec4(gx00.z, gy00.z, gz00.z, gw00.z);\n      vec4 g1100 \x3d vec4(gx00.w, gy00.w, gz00.w, gw00.w);\n      vec4 g0010 \x3d vec4(gx10.x, gy10.x, gz10.x, gw10.x);\n      vec4 g1010 \x3d vec4(gx10.y, gy10.y, gz10.y, gw10.y);\n      vec4 g0110 \x3d vec4(gx10.z, gy10.z, gz10.z, gw10.z);\n      vec4 g1110 \x3d vec4(gx10.w, gy10.w, gz10.w, gw10.w);\n      vec4 g0001 \x3d vec4(gx01.x, gy01.x, gz01.x, gw01.x);\n      vec4 g1001 \x3d vec4(gx01.y, gy01.y, gz01.y, gw01.y);\n      vec4 g0101 \x3d vec4(gx01.z, gy01.z, gz01.z, gw01.z);\n      vec4 g1101 \x3d vec4(gx01.w, gy01.w, gz01.w, gw01.w);\n      vec4 g0011 \x3d vec4(gx11.x, gy11.x, gz11.x, gw11.x);\n      vec4 g1011 \x3d vec4(gx11.y, gy11.y, gz11.y, gw11.y);\n      vec4 g0111 \x3d vec4(gx11.z, gy11.z, gz11.z, gw11.z);\n      vec4 g1111 \x3d vec4(gx11.w, gy11.w, gz11.w, gw11.w);\n\n      vec4 norm00 \x3d taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n      g0000 *\x3d norm00.x;\n      g0100 *\x3d norm00.y;\n      g1000 *\x3d norm00.z;\n      g1100 *\x3d norm00.w;\n\n      vec4 norm01 \x3d taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n      g0001 *\x3d norm01.x;\n      g0101 *\x3d norm01.y;\n      g1001 *\x3d norm01.z;\n      g1101 *\x3d norm01.w;\n\n      vec4 norm10 \x3d taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n      g0010 *\x3d norm10.x;\n      g0110 *\x3d norm10.y;\n      g1010 *\x3d norm10.z;\n      g1110 *\x3d norm10.w;\n\n      vec4 norm11 \x3d taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n      g0011 *\x3d norm11.x;\n      g0111 *\x3d norm11.y;\n      g1011 *\x3d norm11.z;\n      g1111 *\x3d norm11.w;\n\n      float n0000 \x3d dot(g0000, Pf0);\n      float n1000 \x3d dot(g1000, vec4(Pf1.x, Pf0.y, Pf0.z, Pf0.w));\n      float n0100 \x3d dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.z, Pf0.w));\n      float n1100 \x3d dot(g1100, vec4(Pf1.x, Pf1.y, Pf0.z, Pf0.w));\n      float n0010 \x3d dot(g0010, vec4(Pf0.x, Pf0.y, Pf1.z, Pf0.w));\n      float n1010 \x3d dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n      float n0110 \x3d dot(g0110, vec4(Pf0.x, Pf1.y, Pf1.z, Pf0.w));\n      float n1110 \x3d dot(g1110, vec4(Pf1.x, Pf1.y, Pf1.z, Pf0.w));\n      float n0001 \x3d dot(g0001, vec4(Pf0.x, Pf0.y, Pf0.z, Pf1.w));\n      float n1001 \x3d dot(g1001, vec4(Pf1.x, Pf0.y, Pf0.z, Pf1.w));\n      float n0101 \x3d dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n      float n1101 \x3d dot(g1101, vec4(Pf1.x, Pf1.y, Pf0.z, Pf1.w));\n      float n0011 \x3d dot(g0011, vec4(Pf0.x, Pf0.y, Pf1.z, Pf1.w));\n      float n1011 \x3d dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.z, Pf1.w));\n      float n0111 \x3d dot(g0111, vec4(Pf0.x, Pf1.y, Pf1.z, Pf1.w));\n      float n1111 \x3d dot(g1111, Pf1);\n\n      vec4 fade_xyzw \x3d fade(Pf0);\n      vec4 n_0w \x3d mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n      vec4 n_1w \x3d mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n      vec4 n_zw \x3d mix(n_0w, n_1w, fade_xyzw.z);\n      vec2 n_yzw \x3d mix(vec2(n_zw.x, n_zw.y), vec2(n_zw.z, n_zw.w), fade_xyzw.y);\n      float n_xyzw \x3d mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n      return float(2.2) * n_xyzw;\n    }\n\n    float getPerlinNoise(vec3 pos, float frequency) {\n      const float octaveFrequencyFactor \x3d 2.0;\n\n      float sum \x3d 0.0;\n      float weightSum \x3d 0.0;\n      float weight \x3d 1.0;\n\n      for (int oct \x3d 0; oct \x3c 3; oct++) {\n        vec3 p \x3d pos * frequency;\n        float val \x3d 0.5 + 0.5 * glmPerlin(vec4(p, 0.0), vec4(frequency));\n        sum +\x3d val * weight;\n        weightSum +\x3d weight;\n        weight *\x3d 0.5;\n        frequency *\x3d octaveFrequencyFactor;\n      }\n\n      float noise \x3d (sum / weightSum);\n      noise \x3d saturate(noise);\n      return noise;\n    }\n\n    float hash(float p) {\n      p \x3d fract(p * 0.1031);\n      p *\x3d p + 33.33;\n      p *\x3d p + p;\n      return fract(p);;\n    }\n\n    float noise(vec3 x) {\n      vec3 p \x3d floor(x);\n      vec3 f \x3d fract(x);\n\n      f \x3d f * f * (3.0 - 2.0 * f);\n      float n \x3d p.x + p.y * 57.0 + 113.0 * p.z;\n\n      return mix(\n      mix(\n        mix(hash(n + 0.0), hash(n + 1.0), f.x),\n        mix(hash(n + 57.0), hash(n + 58.0), f.x),\n        f.y),\n      mix(\n        mix(hash(n + 113.0), hash(n + 114.0), f.x),\n        mix(hash(n + 170.0), hash(n + 171.0), f.x),\n        f.y),\n      f.z);\n    }\n\n    float worley(vec3 pos, float numCells) {\n      vec3 p \x3d pos * numCells;\n      float d \x3d 1.0e10;\n\n      for (int x \x3d -1; x \x3c\x3d 1; x++) {\n        for (int y \x3d -1; y \x3c\x3d 1; y++) {\n          for (int z \x3d -1; z \x3c\x3d 1; z++) {\n            vec3 tp \x3d floor(p) + vec3(x, y, z);\n            tp \x3d p - tp - noise(mod(tp, numCells));\n            d \x3d min(d, dot(tp, tp));\n          }\n        }\n      }\n\n      return 1.0 - clamp(d, 0.0, 1.0);\n    }\n\n    vec3 get3Dfrom2D(vec2 uv, float tileRows) {\n      vec2 tile \x3d floor(uv);\n      float z \x3d floor(tileRows * tile.y + tile.x);\n      return vec3(fract(uv), z);\n    }\n\n    float getTextureForPoint(vec3 p, int type) {\n      if (type \x3d\x3d PERLIN_WORLEY) {\n\n        const float frequency \x3d 8.0;\n        float perlinNoise \x3d getPerlinNoise(p, frequency);\n\n        float worley0 \x3d worley(p, NUM_CELLS * 2.0);\n        float worley1 \x3d worley(p, NUM_CELLS * 8.0);\n        float worley2 \x3d worley(p, NUM_CELLS * 14.0);\n\n        float worleyFBM \x3d worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;\n        return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);\n      }\n\n      float worley0 \x3d worley(p, NUM_CELLS);\n      float worley1 \x3d worley(p, NUM_CELLS * 2.0);\n      float worley2 \x3d worley(p, NUM_CELLS * 4.0);\n      float worley3 \x3d worley(p, NUM_CELLS * 8.0);\n\n      float FBM0 \x3d worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;\n      float FBM1 \x3d worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;\n      float FBM2 \x3d worley2 * 0.75 + worley3 * 0.25;\n\n      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;\n    }\n  ");
y.fragment.code.add("\n    void main() {\n      const float padWidth \x3d 1.0;\n      float paddedSize \x3d tileSize + 2.0 * padWidth;\n      float tileCount \x3d tileRows * tileRows;\n      vec2 tile \x3d floor((gl_FragCoord.xy - 0.5) / paddedSize);\n\n      bool padCell \x3d false;\n      if (mod(gl_FragCoord.x, paddedSize) \x3d\x3d 0.5 || mod(gl_FragCoord.x, paddedSize) \x3d\x3d paddedSize - 0.5) {\n        padCell \x3d true;\n      }\n\n      if (mod(gl_FragCoord.y, paddedSize) \x3d\x3d 0.5 || mod(gl_FragCoord.y, paddedSize) \x3d\x3d paddedSize - 0.5) {\n        padCell \x3d true;\n      }\n\n      bool startPadX \x3d false;\n      bool startPadY \x3d false;\n      bool endPadX \x3d false;\n      bool endPadY \x3d false;\n\n      if (gl_FragCoord.x \x3d\x3d tile.x * paddedSize + 0.5) {\n        startPadX \x3d true;\n      }\n\n      if (gl_FragCoord.y \x3d\x3d tile.y * paddedSize + 0.5) {\n        startPadY \x3d true;\n      }\n\n      if (gl_FragCoord.x \x3d\x3d (tile.x + 1.0) * paddedSize - 0.5) {\n        endPadX \x3d true;\n      }\n\n      if (gl_FragCoord.y \x3d\x3d (tile.y + 1.0) * paddedSize - 0.5) {\n        endPadY \x3d true;\n      }\n\n      vec2 padding \x3d vec2(2.0 * padWidth) * tile;\n      vec2 uv;\n\n      if (padCell) {\n        vec2 pixel \x3d gl_FragCoord.xy - padWidth - padding;\n\n        if (startPadX) {\n          pixel.x +\x3d tileSize;\t\n        }\n\n        if (startPadY) {\n          pixel.y +\x3d tileSize;\t\n        }\n\n        if (endPadX) {\n          pixel.x -\x3d tileSize;\t\n        }\n\n        if (endPadY) {\n          pixel.y -\x3d tileSize;\t\n        }\n\n        uv \x3d vec2(pixel.xy / tileSize);\n      } else {\n        vec2 pixel \x3d gl_FragCoord.xy - padWidth - padding;\n        uv \x3d vec2(pixel.xy / tileSize);\n      }\n\n      vec3 p_ \x3d get3Dfrom2D(uv, tileRows);\n      vec3 p \x3d p_;\n      p.z /\x3d (tileRows * tileRows);\n\n      float worleyPerlinNoise \x3d getTextureForPoint(p, PERLIN_WORLEY);\n      float worleyNoise \x3d getTextureForPoint(p, WORLEY);\n\n      vec3 col \x3d vec3(0);\n      col.r \x3d saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));\n\n      p_ \x3d mod(p_ + 1.0, tileRows * tileRows);\n      p \x3d p_;\n      p.z /\x3d (tileRows * tileRows);\n\n      worleyPerlinNoise \x3d getTextureForPoint(p, PERLIN_WORLEY);\n      worleyNoise \x3d getTextureForPoint(p, WORLEY);\n\n      col.g \x3d saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));\n\n    \tgl_FragColor \x3d vec4(col, 1.0);\n    }\n  ");
return y}var q=Object.freeze({__proto__:null,build:r});a.NoiseTextureAtlasShader=q;a.build=r})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n){const z=p.getLogger("esri.views.3d.environment.PanoramicAtmosphere");p=function(){function x(){this.slot=15;this._atmosphereTechniqueConfig=new w.SimpleAtmosphereTechniqueConfiguration;this._readyResolver=r.createResolver();this._readyController=r.createAbortController()}var C=x.prototype;C.destroy=function(){this._readyResolver.reject();this._texture=b.disposeMaybe(this._texture);this._vao=b.disposeMaybe(this._vao);this._readyController=b.abortMaybe(this._readyController)};
C.when=function(){return this._readyResolver.promise};C.initializeRenderContext=function(A){this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=A.shaderTechniqueRep.acquire(w.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig);const B=A.renderContext.rctx;this._vao=this._createVertexArrayObject(B);this._vaoCount=m.vertexCount(this._vao,"geometry");f.requestImage(e,{signal:this._readyController.signal}).then(D=>{this._texture=new h(B,{pixelFormat:6408,dataType:5121,wrapMode:33071,
samplingMode:9729,flipped:!0},D);A.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(D=>{r.isAbortError(D)||z.error("Unable to initialize atmosphere: image request failed",D);this._readyResolver.reject()})};C.uninitializeRenderContext=function(){this.destroy()};C.render=function(A){if(A.slot!==this.slot||0!==A.pass)return!1;const B=A.rctx,D=this._atmosphereTechnique.program;B.useProgram(D);this._atmosphereTechnique.bindPipelineState(B);D.bindTexture(this._texture,"tex");
d.bindProjectionMatrix(D,A.camera.projectionMatrix);var E=k;q.copy(E,A.camera.viewMatrix);E[12]=0;E[13]=0;E[14]=0;E[15]=1;D.setUniformMatrix4fv("view",k);D.setUniform4f("color",1,1,1,1);A.scenelightingData.setLightDirectionUniform(D);B.bindVAO(this._vao);D.assertCompatibleVertexAttributeLocations(this._vao);B.drawArrays(4,0,this._vaoCount);return!0};C._createVertexArrayObject=function(A){var B=u.createPolySphereGeometry(1,2,!1);const D=B.indices.get("position");for(var E=0;E<D.length;E+=3){var G=
D[E];D[E]=D[E+2];D[E+2]=G}B=B.vertexAttributes.get("position").data;E=v.createBuffer(D.length);G=E.position;for(let K=0;K<D.length;++K){const M=3*D[K];G.set(K,0,B[M]);G.set(K,1,B[M+1]);G.set(K,2,B[M+2])}return new n(A,c.Default3D,{geometry:l.glLayout(v)},{geometry:t.createVertex(A,35044,E.buffer)})};a._createClass(x,[{key:"canRender",get:function(){return null!=this._texture}}]);return x}();const k=y.create(),v=g.newLayout().vec3f("position");return p})},"esri/support/requestImageUtils":function(){define(["exports",
"../chunks/_rollupPluginBabelHelpers","../request"],function(a,p,b){function r(){r=p._asyncToGenerator(function*(q,y){({data:q}=yield b(q,{responseType:"image",...y}));return q});return r.apply(this,arguments)}a.requestImage=function(q,y){return r.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/SimpleAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){f=function(d){function c(){return d.apply(this,arguments)||this}b._inheritsLoose(c,d);var u=c.prototype;u.initializeProgram=function(t){const h=c.shader.get().build({geometry:this.configuration.geometry});return new l.Program(t.rctx,h,e.Default3D)};u.initializePipeline=function(){return 1===this.configuration.geometry?g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),culling:g.backFaceCullingParams,depthTest:{func:515},colorWrite:g.defaultColorWriteParams}):
g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:g.defaultColorWriteParams})};return c}(f.ShaderTechnique);f.shader=new y.ReloadableShaderModule(q.SimpleAtmosphereShader,()=>new Promise(function(d,c){a(["./SimpleAtmosphere.glsl"],d,c)}));q=function(d){function c(){var u=d.apply(this,arguments)||this;u.geometry=0;return u}b._inheritsLoose(c,d);return c}(w.ShaderTechniqueConfiguration);r.__decorate([w.parameter({count:3})],q.prototype,"geometry",
void 0);p.SimpleAtmosphereTechnique=f;p.SimpleAtmosphereTechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,p,b,r){function q(f){const w=new r.ShaderBuilder;2===f.geometry?(w.attributes.add("position","vec2"),w.varyings.add("color",
"vec4"),w.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),w.vertex.code.add(b.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),w.fragment.code.add(b.glsl`void main() {
gl_FragColor = color;
}`)):(w.include(p.Transform,{linearDepth:!1}),w.attributes.add("position","vec3"),w.varyings.add("vtc","vec2"),w.varyings.add("falloff","float"),f=1===f.geometry,w.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),f||(w.varyings.add("innerFactor","float"),w.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float")),w.vertex.code.add(b.glsl`
		void main(void) {
      ${f?b.glsl`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:b.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${b.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${b.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),w.fragment.uniforms.add("tex","sampler2D"),f||w.fragment.uniforms.add("altitudeFade","float"),w.fragment.code.add(b.glsl`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${f?b.glsl`gl_FragColor = atmosphereColor;`:b.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return w}var y=Object.freeze({__proto__:null,build:q});a.SimpleAtmosphereShader=y;a.build=q})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,p){a.Transform=function(b,r){r.linearDepth?b.vertex.code.add(p.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):b.vertex.code.add(p.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(function(){return"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII\x3d"})},
"esri/views/3d/support/buffer/glUtil":function(){define(["exports"],function(a){const p={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126};a.glLayout=function(b,r=0){const q=b.stride;return b.fieldNames.filter(y=>{y=b.fields.get(y).optional;return!(y&&y.glPadding)}).map(y=>{const f=b.fields.get(y),w=f.constructor.ElementCount;var e=p[f.constructor.ElementType];if(!e)throw Error("BufferType not supported in WebGL");return{name:y,stride:q,count:w,type:e,offset:f.offset,normalized:!(!f.optional||
!f.optional.glNormalized),divisor:r}})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types"],function(a,p,b,r){let q=function(){function f(e,l){this.layout=e;this.buffer="number"===typeof l?new ArrayBuffer(l*e.stride):l;for(const g of e.fieldNames)l=e.fields.get(g),this[g]=new l.constructor(this.buffer,
l.offset,this.stride)}var w=f.prototype;w.getField=function(e,l){return(e=this[e])&&e.elementCount===l.ElementCount&&e.elementType===l.ElementType?e:null};w.slice=function(e,l){return new f(this.layout,this.buffer.slice(e*this.stride,l*this.stride))};w.copyFrom=function(e,l,g,d){const c=this.stride;0===c%4?(e=new Uint32Array(e.buffer,l*c,d*c/4),(new Uint32Array(this.buffer,g*c,d*c/4)).set(e)):(e=new Uint8Array(e.buffer,l*c,d*c),(new Uint8Array(this.buffer,g*c,d*c)).set(e))};p._createClass(f,[{key:"stride",
get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return f}(),y=function(){function f(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var w=f.prototype;w.vec2f=function(e,l){this.appendField(e,b.BufferViewVec2f,l);return this};w.vec2f64=function(e,l){this.appendField(e,b.BufferViewVec2f64,l);return this};w.vec3f=function(e,l){this.appendField(e,b.BufferViewVec3f,
l);return this};w.vec3f64=function(e,l){this.appendField(e,b.BufferViewVec3f64,l);return this};w.vec4f=function(e,l){this.appendField(e,b.BufferViewVec4f,l);return this};w.vec4f64=function(e,l){this.appendField(e,b.BufferViewVec4f64,l);return this};w.mat3f=function(e,l){this.appendField(e,b.BufferViewMat3f,l);return this};w.mat3f64=function(e,l){this.appendField(e,b.BufferViewMat3f64,l);return this};w.mat4f=function(e,l){this.appendField(e,b.BufferViewMat4f,l);return this};w.mat4f64=function(e,l){this.appendField(e,
b.BufferViewMat4f64,l);return this};w.vec4u8=function(e,l){this.appendField(e,b.BufferViewVec4u8,l);return this};w.f32=function(e,l){this.appendField(e,b.BufferViewFloat,l);return this};w.f64=function(e,l){this.appendField(e,b.BufferViewFloat64,l);return this};w.u8=function(e,l){this.appendField(e,b.BufferViewUint8,l);return this};w.u16=function(e,l){this.appendField(e,b.BufferViewUint16,l);return this};w.i8=function(e,l){this.appendField(e,b.BufferViewInt8,l);return this};w.vec2i8=function(e,l){this.appendField(e,
b.BufferViewVec2i8,l);return this};w.vec2i16=function(e,l){this.appendField(e,b.BufferViewVec2i16,l);return this};w.vec2u8=function(e,l){this.appendField(e,b.BufferViewVec2u8,l);return this};w.vec4u16=function(e,l){this.appendField(e,b.BufferViewVec4u16,l);return this};w.u32=function(e,l){this.appendField(e,b.BufferViewUint32,l);return this};w.appendField=function(e,l,g){const d=l.ElementCount*r.elementTypeSize(l.ElementType);this.fields.set(e,{size:d,constructor:l,offset:this.stride,optional:g});
this.stride+=d;this.fieldNames.push(e)};w.alignTo=function(e){this.stride=Math.floor((this.stride+e-1)/e)*e;return this};w.hasField=function(e){return 0<=this.fieldNames.indexOf(e)};w.createBuffer=function(e){return new q(this,e)};w.createView=function(e){return new q(this,e)};w.clone=function(){const e=new f;e.stride=this.stride;e.fields=new Map;this.fields.forEach((l,g)=>e.fields.set(g,l));e.fieldNames=this.fieldNames.slice();e.BufferType=this.BufferType;return e};return f}();a.InterleavedBuffer=
q;a.InterleavedLayout=y;a.newLayout=function(){return new y};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(a,p,b,r,q,y,f,w){let e=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float32Array,Q,V,ca,ba)||this;Q.elementType="f32";return Q}p._inheritsLoose(P,S);
P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(q.BufferViewScalarImpl);e.ElementType="f32";let l=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float32Array,Q,V,ca,ba)||this;Q.elementType="f32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(y.BufferViewVec2Impl);l.ElementType="f32";let g=
function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float32Array,Q,V,ca,ba)||this;Q.elementType="f32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(f.BufferViewVec3Impl);g.ElementType="f32";let d=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float32Array,Q,V,ca,ba)||this;Q.elementType="f32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,
V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(w.BufferViewVec4Impl);d.ElementType="f32";let c=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float32Array,Q,V,ca,ba)||this;Q.elementType="f32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(b.BufferViewMat3Impl);
c.ElementType="f32";b=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float64Array,Q,V,ca,ba)||this;Q.elementType="f64";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(b.BufferViewMat3Impl);b.ElementType="f64";let u=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float32Array,Q,V,ca,ba)||this;Q.elementType="f32";return Q}p._inheritsLoose(P,S);
P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(r.BufferViewMat4Impl);u.ElementType="f32";r=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float64Array,Q,V,ca,ba)||this;Q.elementType="f64";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};
return P}(r.BufferViewMat4Impl);r.ElementType="f64";let t=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float64Array,Q,V,ca,ba)||this;Q.elementType="f64";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(q.BufferViewScalarImpl);t.ElementType="f64";let h=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float64Array,Q,V,ca,ba)||this;Q.elementType=
"f64";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(y.BufferViewVec2Impl);h.ElementType="f64";let m=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float64Array,Q,V,ca,ba)||this;Q.elementType="f64";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,
Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(f.BufferViewVec3Impl);m.ElementType="f64";let n=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Float64Array,Q,V,ca,ba)||this;Q.elementType="f64";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(w.BufferViewVec4Impl);n.ElementType="f64";let z=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint8Array,
Q,V,ca,ba)||this;Q.elementType="u8";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(q.BufferViewScalarImpl);z.ElementType="u8";let k=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint8Array,Q,V,ca,ba)||this;Q.elementType="u8";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,
V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(y.BufferViewVec2Impl);k.ElementType="u8";let v=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint8Array,Q,V,ca,ba)||this;Q.elementType="u8";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(f.BufferViewVec3Impl);v.ElementType="u8";let x=function(S){function P(Q,V=0,ca,
ba){Q=S.call(this,Uint8Array,Q,V,ca,ba)||this;Q.elementType="u8";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(w.BufferViewVec4Impl);x.ElementType="u8";let C=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint16Array,Q,V,ca,ba)||this;Q.elementType="u16";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,
Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(q.BufferViewScalarImpl);C.ElementType="u16";let A=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint16Array,Q,V,ca,ba)||this;Q.elementType="u16";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(y.BufferViewVec2Impl);A.ElementType="u16";
let B=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint16Array,Q,V,ca,ba)||this;Q.elementType="u16";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(f.BufferViewVec3Impl);B.ElementType="u16";let D=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint16Array,Q,V,ca,ba)||this;Q.elementType="u16";return Q}p._inheritsLoose(P,S);P.prototype.slice=
function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(w.BufferViewVec4Impl);D.ElementType="u16";let E=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint32Array,Q,V,ca,ba)||this;Q.elementType="u32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(q.BufferViewScalarImpl);
E.ElementType="u32";let G=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint32Array,Q,V,ca,ba)||this;Q.elementType="u32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(y.BufferViewVec2Impl);G.ElementType="u32";let K=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint32Array,Q,V,ca,ba)||this;Q.elementType="u32";return Q}p._inheritsLoose(P,
S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(f.BufferViewVec3Impl);K.ElementType="u32";let M=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Uint32Array,Q,V,ca,ba)||this;Q.elementType="u32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};
return P}(w.BufferViewVec4Impl);M.ElementType="u32";let H=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int8Array,Q,V,ca,ba)||this;Q.elementType="i8";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(q.BufferViewScalarImpl);H.ElementType="i8";let J=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int8Array,Q,V,ca,ba)||this;Q.elementType="i8";return Q}
p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(y.BufferViewVec2Impl);J.ElementType="i8";let O=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int8Array,Q,V,ca,ba)||this;Q.elementType="i8";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+
Q.byteLength)};return P}(f.BufferViewVec3Impl);O.ElementType="i8";let I=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int8Array,Q,V,ca,ba)||this;Q.elementType="i8";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(w.BufferViewVec4Impl);I.ElementType="i8";let F=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int16Array,Q,V,ca,ba)||this;Q.elementType=
"i16";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(q.BufferViewScalarImpl);F.ElementType="i16";let L=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int16Array,Q,V,ca,ba)||this;Q.elementType="i16";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,
Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(y.BufferViewVec2Impl);L.ElementType="i16";let N=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int16Array,Q,V,ca,ba)||this;Q.elementType="i16";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(f.BufferViewVec3Impl);N.ElementType="i16";let R=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int16Array,
Q,V,ca,ba)||this;Q.elementType="i16";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(w.BufferViewVec4Impl);R.ElementType="i16";q=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int32Array,Q,V,ca,ba)||this;Q.elementType="i32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,
V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(q.BufferViewScalarImpl);q.ElementType="i32";y=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int32Array,Q,V,ca,ba)||this;Q.elementType="i32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(y.BufferViewVec2Impl);y.ElementType="i32";f=function(S){function P(Q,V=0,ca,ba){Q=
S.call(this,Int32Array,Q,V,ca,ba)||this;Q.elementType="i32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(f.BufferViewVec3Impl);f.ElementType="i32";w=function(S){function P(Q,V=0,ca,ba){Q=S.call(this,Int32Array,Q,V,ca,ba)||this;Q.elementType="i32";return Q}p._inheritsLoose(P,S);P.prototype.slice=function(Q,V){return this.sliceBuffer(P,Q,V)};P.fromTypedArray=
function(Q,V){return new P(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return P}(w.BufferViewVec4Impl);w.ElementType="i32";a.BufferViewFloat=e;a.BufferViewFloat64=t;a.BufferViewInt16=F;a.BufferViewInt32=q;a.BufferViewInt8=H;a.BufferViewMat3f=c;a.BufferViewMat3f64=b;a.BufferViewMat4f=u;a.BufferViewMat4f64=r;a.BufferViewUint16=C;a.BufferViewUint32=E;a.BufferViewUint8=z;a.BufferViewVec2f=l;a.BufferViewVec2f64=h;a.BufferViewVec2i16=L;a.BufferViewVec2i32=y;a.BufferViewVec2i8=J;a.BufferViewVec2u16=
A;a.BufferViewVec2u32=G;a.BufferViewVec2u8=k;a.BufferViewVec3f=g;a.BufferViewVec3f64=m;a.BufferViewVec3i16=N;a.BufferViewVec3i32=f;a.BufferViewVec3i8=O;a.BufferViewVec3u16=B;a.BufferViewVec3u32=K;a.BufferViewVec3u8=v;a.BufferViewVec4f=d;a.BufferViewVec4f64=n;a.BufferViewVec4i16=R;a.BufferViewVec4i32=w;a.BufferViewVec4i8=I;a.BufferViewVec4u16=D;a.BufferViewVec4u32=M;a.BufferViewVec4u8=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers"],function(a,p){let b=function(){function r(y,f,w=0,e,l){this.TypedArrayConstructor=y;this.elementCount=9;y=this.TypedArrayConstructor;void 0===e&&(e=9*y.BYTES_PER_ELEMENT);const g=0===f.byteLength?0:w;this.typedBuffer=null==l?new y(f,g):new y(f,g,(l-w)/y.BYTES_PER_ELEMENT);this.typedBufferStride=e/y.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var q=r.prototype;q.sliceBuffer=function(y,f,w=this.count-f){f=this.typedBuffer.byteOffset+f*this.stride;return new y(this.buffer,f,this.stride,f+w*this.stride)};q.getMat=function(y,f){y*=this.typedBufferStride;for(let w=0;9>w;w++)f[w]=this.typedBuffer[y++];return f};q.setMat=function(y,f){y*=this.typedBufferStride;for(let w=0;9>w;w++)this.typedBuffer[y++]=f[w]};q.get=function(y,f){return this.typedBuffer[y*this.typedBufferStride+f]};q.set=function(y,f,w){this.typedBuffer[y*this.typedBufferStride+
f]=w};q.copyFrom=function(y,f,w){const e=this.typedBuffer,l=f.typedBuffer;y*=this.typedBufferStride;f=w*f.typedBufferStride;for(w=0;9>w;++w)e[y++]=l[f++]};p._createClass(r,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return r}();b.ElementCount=9;a.BufferViewMat3Impl=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,p){let b=function(){function r(y,
f,w=0,e,l){this.TypedArrayConstructor=y;this.elementCount=16;y=this.TypedArrayConstructor;void 0===e&&(e=16*y.BYTES_PER_ELEMENT);const g=0===f.byteLength?0:w;this.typedBuffer=null==l?new y(f,g):new y(f,g,(l-w)/y.BYTES_PER_ELEMENT);this.typedBufferStride=e/y.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var q=r.prototype;q.sliceBuffer=function(y,f,w=this.count-f){f=this.typedBuffer.byteOffset+
f*this.stride;return new y(this.buffer,f,this.stride,f+w*this.stride)};q.getMat=function(y,f){y*=this.typedBufferStride;for(let w=0;16>w;w++)f[w]=this.typedBuffer[y++];return f};q.setMat=function(y,f){y*=this.typedBufferStride;for(let w=0;16>w;w++)this.typedBuffer[y++]=f[w]};q.get=function(y,f){return this.typedBuffer[y*this.typedBufferStride+f]};q.set=function(y,f,w){this.typedBuffer[y*this.typedBufferStride+f]=w};q.copyFrom=function(y,f,w){const e=this.typedBuffer,l=f.typedBuffer;y*=this.typedBufferStride;
f=w*f.typedBufferStride;for(w=0;16>w;++w)e[y++]=l[f++]};p._createClass(r,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return r}();b.ElementCount=16;a.BufferViewMat4Impl=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,p){let b=function(){function r(y,f,w=0,e,l){this.TypedArrayConstructor=y;this.elementCount=1;y=this.TypedArrayConstructor;
void 0===e&&(e=y.BYTES_PER_ELEMENT);const g=0===f.byteLength?0:w;this.typedBuffer=null==l?new y(f,g):new y(f,g,(l-w)/y.BYTES_PER_ELEMENT);this.typedBufferStride=e/y.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var q=r.prototype;q.sliceBuffer=function(y,f,w=this.count-f){f=this.typedBuffer.byteOffset+f*this.stride;return new y(this.buffer,f,this.stride,f+w*this.stride)};q.get=function(y){return this.typedBuffer[y*
this.typedBufferStride]};q.set=function(y,f){this.typedBuffer[y*this.typedBufferStride]=f};p._createClass(r,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return r}();b.ElementCount=1;a.BufferViewScalarImpl=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2"],function(a,p,b){let r=function(){function q(f,w,e=0,l,g){this.TypedArrayConstructor=
f;this.elementCount=2;f=this.TypedArrayConstructor;void 0===l&&(l=2*f.BYTES_PER_ELEMENT);const d=0===w.byteLength?0:e;this.typedBuffer=null==g?new f(w,d):new f(w,d,(g-e)/f.BYTES_PER_ELEMENT);this.typedBufferStride=l/f.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var y=q.prototype;y.sliceBuffer=function(f,w,e=this.count-w){w=this.typedBuffer.byteOffset+w*this.stride;return new f(this.buffer,
w,this.stride,w+e*this.stride)};y.getVec=function(f,w){f*=this.typedBufferStride;return b.set(w,this.typedBuffer[f],this.typedBuffer[f+1])};y.setVec=function(f,w){f*=this.typedBufferStride;this.typedBuffer[f++]=w[0];this.typedBuffer[f]=w[1]};y.get=function(f,w){return this.typedBuffer[f*this.typedBufferStride+w]};y.set=function(f,w,e){this.typedBuffer[f*this.typedBufferStride+w]=e};y.setValues=function(f,w,e){f*=this.typedBufferStride;this.typedBuffer[f++]=w;this.typedBuffer[f]=e};y.copyFrom=function(f,
w,e){const l=this.typedBuffer,g=w.typedBuffer;f*=this.typedBufferStride;w=e*w.typedBufferStride;l[f++]=g[w++];l[f]=g[w]};p._createClass(q,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return q}();r.ElementCount=2;a.BufferViewVec2Impl=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3"],function(a,p,b){let r=function(){function q(f,
w,e=0,l,g){this.TypedArrayConstructor=f;this.elementCount=3;f=this.TypedArrayConstructor;void 0===l&&(l=3*f.BYTES_PER_ELEMENT);const d=0===w.byteLength?0:e;this.typedBuffer=null==g?new f(w,d):new f(w,d,(g-e)/f.BYTES_PER_ELEMENT);this.typedBufferStride=l/f.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var y=q.prototype;y.sliceBuffer=function(f,w,e=this.count-w){w=this.typedBuffer.byteOffset+
w*this.stride;return new f(this.buffer,w,this.stride,w+e*this.stride)};y.getVec=function(f,w){f*=this.typedBufferStride;return b.set(w,this.typedBuffer[f],this.typedBuffer[f+1],this.typedBuffer[f+2])};y.setVec=function(f,w){f*=this.typedBufferStride;this.typedBuffer[f++]=w[0];this.typedBuffer[f++]=w[1];this.typedBuffer[f]=w[2]};y.get=function(f,w){return this.typedBuffer[f*this.typedBufferStride+w]};y.set=function(f,w,e){this.typedBuffer[f*this.typedBufferStride+w]=e};y.setValues=function(f,w,e,l){f*=
this.typedBufferStride;this.typedBuffer[f++]=w;this.typedBuffer[f++]=e;this.typedBuffer[f]=l};y.copyFrom=function(f,w,e){const l=this.typedBuffer,g=w.typedBuffer;f*=this.typedBufferStride;w=e*w.typedBufferStride;l[f++]=g[w++];l[f++]=g[w++];l[f]=g[w]};p._createClass(q,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return q}();r.ElementCount=3;a.BufferViewVec3Impl=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4"],function(a,p,b){let r=function(){function q(f,w,e=0,l,g){this.TypedArrayConstructor=f;this.elementCount=4;f=this.TypedArrayConstructor;void 0===l&&(l=4*f.BYTES_PER_ELEMENT);const d=0===w.byteLength?0:e;this.typedBuffer=null==g?new f(w,d):new f(w,d,(g-e)/f.BYTES_PER_ELEMENT);this.typedBufferStride=l/f.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var y=q.prototype;y.sliceBuffer=function(f,w,e=this.count-w){w=this.typedBuffer.byteOffset+w*this.stride;return new f(this.buffer,w,this.stride,w+e*this.stride)};y.getVec=function(f,w){f*=this.typedBufferStride;return b.set(w,this.typedBuffer[f++],this.typedBuffer[f++],this.typedBuffer[f++],this.typedBuffer[f])};y.setVec=function(f,w){f*=this.typedBufferStride;this.typedBuffer[f++]=w[0];this.typedBuffer[f++]=w[1];this.typedBuffer[f++]=w[2];this.typedBuffer[f]=w[3]};y.get=function(f,w){return this.typedBuffer[f*
this.typedBufferStride+w]};y.set=function(f,w,e){this.typedBuffer[f*this.typedBufferStride+w]=e};y.setValues=function(f,w,e,l,g){f*=this.typedBufferStride;this.typedBuffer[f++]=w;this.typedBuffer[f++]=e;this.typedBuffer[f++]=l;this.typedBuffer[f]=g};y.copyFrom=function(f,w,e){const l=this.typedBuffer,g=w.typedBuffer;f*=this.typedBufferStride;w=e*w.typedBufferStride;l[f++]=g[w++];l[f++]=g[w++];l[f++]=g[w++];l[f]=g[w]};p._createClass(q,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);
return q}();r.ElementCount=4;a.BufferViewVec4Impl=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/types":function(){define(["exports","../../../core/has"],function(a,p){a.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;
case "f32":case "f64":return!1}};a.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define(["exports",
"../../../../../../chunks/mat4","../../../../../../chunks/mat4f32"],function(a,p,b){function r(y,f,w){p.translate(q,w,f);y.setUniform3fv("localOrigin",f);y.setUniformMatrix4fv("view",q)}const q=b.create();a.bindCameraPosition=function(y,f,w){y.setUniform3f("camPos",w[3]-f[0],w[7]-f[1],w[11]-f[2])};a.bindNearFar=function(y,f){y.setUniform2fv("nearFar",f)};a.bindProjectionMatrix=function(y,f){y.setUniformMatrix4fv("proj",f)};a.bindView=function(y,f){r(y,f.origin,f.camera.viewMatrix)};a.bindViewCustomOrigin=
r;a.bindViewport=function(y,f){y.setUniform4fv("viewport",f.camera.fullViewport)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./BufferVectorMath ./Geometry ./geometryDataUtils ./Util".split(" "),function(a,p,b,r,q,y,f,w,e){const l=y.Vec3Compact;var g;(function(h){const m=[[-.5,-.5,
.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],n=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],z=[0,0,1,0,1,1,0,1],k=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),v=new Uint16Array(36);for(var x=0;6>x;x++)for(let A=0;6>A;A++)v[6*x+A]=x;const C=new Uint16Array(36);for(x=0;6>x;x++)C[6*x]=0,C[6*x+1]=1,C[6*x+2]=2,C[6*x+3]=2,C[6*x+4]=3,C[6*x+5]=0;h.createGeometry=function(A){Array.isArray(A)||(A=[A,A,A]);const B=Array(24);
for(let D=0;8>D;D++)B[3*D]=m[D][0]*A[0],B[3*D+1]=m[D][1]*A[1],B[3*D+2]=m[D][2]*A[2];return new f.Geometry([["position",{size:3,data:B,exclusive:!0}],["normal",{size:3,data:n}],["uv0",{size:2,data:z}]],[["position",k],["normal",v],["uv0",C]])}})(g||(g={}));var d;(function(h){const m=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],n=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],z=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),k=new Uint16Array([0,0,0,
1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);h.createGeometry=function(v){Array.isArray(v)||(v=[v,v,v]);const x=Array(18);for(let C=0;6>C;C++)x[3*C]=m[C][0]*v[0],x[3*C+1]=m[C][1]*v[1],x[3*C+2]=m[C][2]*v[2];return new f.Geometry([["position",{size:3,data:x,exclusive:!0}],["normal",{size:3,data:n}]],[["position",z],["normal",k]])}})(d||(d={}));var c;(function(h){const m=p.fromValues(-.5,0,-.5),n=p.fromValues(.5,0,-.5),z=p.fromValues(0,0,.5),k=p.fromValues(0,.5,0),v=p.create(),x=p.create(),C=p.create(),
A=p.create(),B=p.create();a.subtract(v,m,k);a.subtract(x,m,n);a.cross(C,v,x);a.normalize(C,C);a.subtract(v,n,k);a.subtract(x,n,z);a.cross(A,v,x);a.normalize(A,A);a.subtract(v,z,k);a.subtract(x,z,m);a.cross(B,v,x);a.normalize(B,B);const D=[m,n,z,k],E=[0,-1,0,C[0],C[1],C[2],A[0],A[1],A[2],B[0],B[1],B[2]],G=[0,1,2,3,1,0,3,2,1,3,0,2],K=[0,0,0,1,1,1,2,2,2,3,3,3];h.createGeometry=function(M){Array.isArray(M)||(M=[M,M,M]);const H=Array(12);for(let J=0;4>J;J++)H[3*J]=D[J][0]*M[0],H[3*J+1]=D[J][1]*M[1],H[3*
J+2]=D[J][2]*M[2];return new f.Geometry([["position",{size:3,data:H,exclusive:!0}],["normal",{size:3,data:E}]],[["position",new Uint16Array(G)],["normal",new Uint16Array(K)]])}})(c||(c={}));var u;(function(h){function m(k,v,x,C,A){if(Math.abs(a.dot(v,k))>A)return!1;a.cross(x,k,v);a.normalize(x,x);a.cross(C,x,k);a.normalize(C,C);return!0}function n(k,v,x,C,A,B,D){return m(k,v,A,B,D)||m(k,x,A,B,D)||m(k,C,A,B,D)}h.createBoxGeometry=g.createGeometry;h.createDiamondGeometry=d.createGeometry;h.createTetrahedronGeometry=
c.createGeometry;h.createSphereGeometry=function(k,v,x,C={uv:!0}){var A=-Math.PI,B=2*Math.PI,D=-Math.PI/2,E=Math.PI;v=Math.max(3,Math.floor(v));const G=Math.max(2,Math.floor(x));var K=(v+1)*(G+1);x=new Float32Array(3*K);const M=new Float32Array(3*K);K=new Float32Array(2*K);const H=[];let J=0;for(var O=0;O<=G;O++){var I=[];const L=O/G,N=D+L*E,R=Math.cos(N);for(let S=0;S<=v;S++){const P=S/v;var F=A+P*B;const Q=Math.cos(F)*R,V=Math.sin(N);F=-Math.sin(F)*R;x[3*J]=Q*k;x[3*J+1]=V*k;x[3*J+2]=F*k;M[3*J]=
Q;M[3*J+1]=V;M[3*J+2]=F;K[2*J]=P;K[2*J+1]=L;I.push(J);++J}H.push(I)}k=new Uint32Array(2*v*(G-1)*3);J=0;for(A=0;A<G;A++)for(B=0;B<v;B++)D=H[A][B],E=H[A][B+1],O=H[A+1][B+1],I=H[A+1][B],0===A?(k[J++]=D,k[J++]=O,k[J++]=I):A===G-1?(k[J++]=D,k[J++]=E,k[J++]=O):(k[J++]=D,k[J++]=E,k[J++]=O,k[J++]=O,k[J++]=I,k[J++]=D);v=[["position",k],["normal",k]];x=[["position",{size:3,data:x,exclusive:!0}],["normal",{size:3,data:M,exclusive:!0}]];C.uv&&(x.push(["uv0",{size:2,data:K,exclusive:!0}]),v.push(["uv0",k]));C.offset&&
(v[0][0]="offset",x[0][0]="offset",v.push(["position",new Uint32Array(k.length)]),x.push(["position",{size:3,data:Float64Array.from(C.offset),exclusive:!0}]));return new f.Geometry(x,v)};h.createPolySphereGeometry=function(k,v,x){function C(E,G){E>G&&([E,G]=[G,E]);const K=E.toString()+"."+G.toString();if(D[K])return D[K];let M=A.length;A.length+=3;l.add(A,3*E,A,3*G,A,M);l.scale(A,M,k/l.length(A,M));M/=3;return D[K]=M}let A;x?(A=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],x=new Uint32Array([0,1,2,0,2,
3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(x=k*(1+Math.sqrt(5))/2,A=[-k,x,0,k,x,0,-k,-x,0,k,-x,0,0,-k,x,0,k,x,0,-k,-x,0,k,-x,x,0,-k,x,0,k,-x,0,-k,-x,0,k],x=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var B=0;B<A.length;B+=3)l.scale(A,B,k/l.length(A,B));let D={};for(B=0;B<v;B++){const E=x.length,G=new Uint32Array(4*E);for(let K=0;K<E;K+=3){const M=x[K],H=x[K+1],J=x[K+2],O=C(M,H),I=C(H,J),F=
C(J,M),L=4*K;G[L]=M;G[L+1]=O;G[L+2]=F;G[L+3]=H;G[L+4]=I;G[L+5]=O;G[L+6]=J;G[L+7]=F;G[L+8]=I;G[L+9]=O;G[L+10]=I;G[L+11]=F}x=G;D={}}v=new Float32Array(A);for(B=0;B<v.length;B+=3)l.normalize(v,B);x=[["position",x],["normal",x]];v=[["position",{size:3,data:new Float32Array(A),exclusive:!0}],["normal",{size:3,data:v,exclusive:!0}]];return new f.Geometry(v,x)};h.createPointGeometry=function(k,v,x,C,A,B,D){v=v?[v[0],v[1],v[2]]:[0,0,0];k=k?[k[0],k[1],k[2]]:[0,0,1];B=B||[0,0];x=[["position",{size:3,data:v,
exclusive:!0}],["normal",{size:3,data:k,exclusive:!0}],["uv0",{size:B.length,data:B}],["color",{size:4,data:x?[255*x[0],255*x[1],255*x[2],3<x.length?255*x[3]:255]:[255,255,255,255],exclusive:!0}],["size",{size:2,data:null!=C&&2===C.length?C:[1,1]}]];null!=A&&(A=new Float32Array([A[0],A[1],A[2],A[3]]),x.push(["auxpos1",{size:4,data:A}]));null!=D&&(D=new Float32Array([D[0],D[1],D[2],D[3]]),x.push(["auxpos2",{size:4,data:D}]));return new f.Geometry(x,null,1)};h.updatePointGeometry=function(k,v,x,C,A,
B,D,E){if(null!=k){const {data:G}=E.getMutableAttribute("normal");G[0]=k[0];G[1]=k[1];G[2]=k[2]}null!=v&&({data:k}=E.getMutableAttribute("position"),k[0]=v[0],k[1]=v[1],k[2]=v[2]);null!=x&&({data:v}=E.getMutableAttribute("color"),v[0]=x[0],v[1]=x[1],v[2]=x[2],v[3]=x[3]);null!=C&&({data:x}=E.getMutableAttribute("size"),x[0]=C[0],x[1]=C[1]);null!=A&&({data:C}=E.getMutableAttribute("auxpos1"),C[0]=A[0],C[1]=A[1],C[2]=A[2],C[3]=A[3]);null!=B&&({data:A}=E.getMutableAttribute("uv0"),A[0]=B[0],A[1]=B[1]);
null!=D&&({data:B}=E.getMutableAttribute("auxpos2"),B[0]=D[0],B[1]=D[1],B[2]=D[2],B[3]=D[3])};h.createPointArrayGeometry=function(k,v){const x=new Float32Array(3*k.length),C=new Float32Array(v?3*k.length:3),A=new Uint32Array(k.length),B=new Uint32Array(k.length);for(let D=0;D<k.length;D++)x[3*D]=k[D][0],x[3*D+1]=k[D][1],x[3*D+2]=k[D][2],v&&(C[3*D]=v[D][0],C[3*D+1]=v[D][1],C[3*D+2]=v[D][2]),A[D]=D,B[D]=0;v||(C[0]=0,C[1]=1,C[2]=0);return new f.Geometry([["position",{size:3,data:x,exclusive:!0}],["normal",
{size:3,data:C,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",A],["normal",v?A:B],["uv0",B]],1)};h.createTriangleGeometry=function(){const k=new Uint16Array([0,1,2]),v=new Uint16Array([0,0,0]),x=new Uint16Array([0,0,0]);return new f.Geometry([["position",{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],["normal",{size:3,data:[0,1,0],exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",k],["normal",v],["uv0",x]])};const z=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,
0]];h.createSquareGeometry=function(k=z){const v=Array(12);for(var x=0;4>x;x++)for(let C=0;3>C;C++)v[3*x+C]=k[x][C];k=new Uint32Array([0,1,2,2,3,0]);x=new Uint32Array([0,0,0,0,0,0]);return new f.Geometry([["position",{size:3,data:v,exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",k],["normal",x],["uv0",k],["color",x]])};h.createConeGeometry=function(k,v,x,C,A=!0,B=
!0){var D=0,E=p.fromValues(0,D,0),G=p.fromValues(0,D+k,0),K=p.fromValues(0,-1,0),M=p.fromValues(0,1,0);C&&(D=k,G=p.fromValues(0,0,0),E=p.fromValues(0,D,0),K=p.fromValues(0,1,0),M=p.fromValues(0,-1,0));E=[G,E];K=[K,M];M=x+2;G=Math.sqrt(k*k+v*v);if(C)for(C=x-1;0<=C;C--){var H=2*Math.PI/x*C,J=p.fromValues(Math.cos(H)*v,D,Math.sin(H)*v);E.push(J);H=p.fromValues(k*Math.cos(H)/G,-v/G,k*Math.sin(H)/G);K.push(H)}else for(C=0;C<x;C++)H=2*Math.PI/x*C,J=p.fromValues(Math.cos(H)*v,D,Math.sin(H)*v),E.push(J),
H=p.fromValues(k*Math.cos(H)/G,v/G,k*Math.sin(H)/G),K.push(H);k=new Uint32Array(6*(x+2));x=new Uint32Array(6*(x+2));D=v=0;if(A){for(A=3;A<E.length;A++)k[v++]=1,k[v++]=A-1,k[v++]=A,x[D++]=0,x[D++]=0,x[D++]=0;k[v++]=E.length-1;k[v++]=2;k[v++]=1;x[D++]=0;x[D++]=0;x[D++]=0}if(B){for(B=3;B<E.length;B++)k[v++]=B,k[v++]=B-1,k[v++]=0,x[D++]=B,x[D++]=B-1,x[D++]=1;k[v++]=0;k[v++]=2;k[v++]=E.length-1;x[D++]=1;x[D++]=2;x[D++]=K.length-1}B=new Float32Array(3*M);for(A=0;A<M;A++)B[3*A]=E[A][0],B[3*A+1]=E[A][1],
B[3*A+2]=E[A][2];E=new Float32Array(3*M);for(A=0;A<M;A++)E[3*A]=K[A][0],E[3*A+1]=K[A][1],E[3*A+2]=K[A][2];return new f.Geometry([["position",{size:3,data:B,exclusive:!0}],["normal",{size:3,data:E,exclusive:!0}]],[["position",k],["normal",x]])};h.createCylinderGeometry=function(k,v,x,C,A,B){C=C?p.clone(C):p.fromValues(1,0,0);A=A?p.clone(A):p.fromValues(0,0,0);B=null==B?!0:B;var D=p.create();a.normalize(D,C);const E=p.create();a.scale(E,D,Math.abs(k));const G=p.create();a.scale(G,E,-.5);a.add(G,G,A);
const K=p.fromValues(0,1,0);.2>Math.abs(1-a.dot(D,K))&&a.set(K,0,0,1);const M=p.create();a.cross(M,D,K);a.normalize(M,M);a.cross(K,M,D);k=2*x+(B?2:0);A=x+(B?2:0);C=new Float32Array(3*k);const H=new Float32Array(3*A),J=new Float32Array(2*k),O=new Uint32Array(3*x*(B?4:2)),I=new Uint32Array(3*x*(B?4:2));B&&(C[3*(k-2)]=G[0],C[3*(k-2)+1]=G[1],C[3*(k-2)+2]=G[2],J[2*(k-2)]=0,J[2*(k-2)+1]=0,C[3*(k-1)]=C[3*(k-2)]+E[0],C[3*(k-1)+1]=C[3*(k-2)+1]+E[1],C[3*(k-1)+2]=C[3*(k-2)+2]+E[2],J[2*(k-1)]=1,J[2*(k-1)+1]=
1,H[3*(A-2)]=-D[0],H[3*(A-2)+1]=-D[1],H[3*(A-2)+2]=-D[2],H[3*(A-1)]=D[0],H[3*(A-1)+1]=D[1],H[3*(A-1)+2]=D[2]);D=function(S,P,Q){O[S]=P;I[S]=Q};let F=0;const L=p.create(),N=p.create();for(let S=0;S<x;S++){var R=2*Math.PI/x*S;a.scale(L,K,Math.sin(R));a.scale(N,M,Math.cos(R));a.add(L,L,N);H[3*S]=L[0];H[3*S+1]=L[1];H[3*S+2]=L[2];a.scale(L,L,v);a.add(L,L,G);C[3*S]=L[0];C[3*S+1]=L[1];C[3*S+2]=L[2];J[2*S]=S/x;J[2*S+1]=0;C[3*(S+x)]=C[3*S]+E[0];C[3*(S+x)+1]=C[3*S+1]+E[1];C[3*(S+x)+2]=C[3*S+2]+E[2];J[2*(S+
x)]=S/x;J[2*S+1]=1;R=(S+1)%x;D(F++,S,S);D(F++,S+x,S);D(F++,R,R);D(F++,R,R);D(F++,S+x,S);D(F++,R+x,R)}if(B){for(v=0;v<x;v++)B=(v+1)%x,D(F++,k-2,A-2),D(F++,v,A-2),D(F++,B,A-2);for(v=0;v<x;v++)B=(v+1)%x,D(F++,v+x,A-1),D(F++,k-1,A-1),D(F++,B+x,A-1)}return new f.Geometry([["position",{size:3,data:C,exclusive:!0}],["normal",{size:3,data:H,exclusive:!0}],["uv0",{size:2,data:J,exclusive:!0}]],[["position",O],["normal",I],["uv0",O]])};h.createTubeGeometry=function(k,v,x,C,A){x=x||10;C=null!=C?C:!0;e.assert(1<
k.length);const B=[],D=[];for(let E=0;E<x;E++){B.push([0,-E-1,-((E+1)%x)-1]);const G=E/x*2*Math.PI;D.push([Math.cos(G)*v,Math.sin(G)*v])}return h.createPathExtrusionGeometry(D,k,[[0,0,0]],B,C,A)};h.createPathExtrusionGeometry=function(k,v,x,C,A,B=p.fromValues(0,0,0)){var D=k.length;const E=new Float32Array(v.length*D*3+(6*x.length||0)),G=new Float32Array(v.length*D*3+(x?6:0));var K=(v.length-1)*D*6+6*C.length;const M=new Uint32Array(K);K=new Uint32Array(K);let H=0;var J=0;let O=0,I=0;const F=p.create(),
L=p.create(),N=p.create(),R=p.create(),S=p.create(),P=p.create(),Q=p.create(),V=b.create(),ca=p.create(),ba=p.create(),Z=p.create(),ha=p.create(),fa=p.create(),aa=r.create();a.set(ca,0,1,0);a.subtract(L,v[1],v[0]);a.normalize(L,L);A?(a.add(V,v[0],B),a.normalize(N,V)):a.set(N,0,0,1);n(L,N,ca,ca,S,N,.99619469809);a.copy(R,N);a.copy(ha,S);for(var W=0;W<x.length;W++)a.scale(P,S,x[W][0]),a.scale(V,N,x[W][2]),a.add(P,P,V),a.add(P,P,v[0]),E[H++]=P[0],E[H++]=P[1],E[H++]=P[2];G[J++]=-L[0];G[J++]=-L[1];G[J++]=
-L[2];for(W=0;W<C.length;W++)M[O++]=0<C[W][0]?C[W][0]:-C[W][0]-1+x.length,M[O++]=0<C[W][1]?C[W][1]:-C[W][1]-1+x.length,M[O++]=0<C[W][2]?C[W][2]:-C[W][2]-1+x.length,K[I++]=0,K[I++]=0,K[I++]=0;W=x.length;const U=x.length-1;for(let T=0;T<v.length;T++){let Y=!1;0<T&&(a.copy(F,L),T<v.length-1?(a.subtract(L,v[T+1],v[T]),a.normalize(L,L)):Y=!0,a.add(ba,F,L),a.normalize(ba,ba),a.add(Z,v[T-1],R),r.fromPositionAndNormal(v[T],ba,aa),r.intersectRay(aa,q.wrap(Z,F),V)?(a.subtract(V,V,v[T]),a.normalize(N,V),a.cross(S,
ba,N),a.normalize(S,S)):n(ba,R,ha,ca,S,N,.99619469809),a.copy(R,N),a.copy(ha,S));A&&(a.add(V,v[T],B),a.normalize(fa,V));for(let ea=0;ea<D;ea++)if(a.scale(P,S,k[ea][0]),a.scale(V,N,k[ea][1]),a.add(P,P,V),a.normalize(Q,P),G[J++]=Q[0],G[J++]=Q[1],G[J++]=Q[2],a.add(P,P,v[T]),E[H++]=P[0],E[H++]=P[1],E[H++]=P[2],!Y){var X=(ea+1)%D;M[O++]=W+ea;M[O++]=W+D+ea;M[O++]=W+X;M[O++]=W+X;M[O++]=W+D+ea;M[O++]=W+D+X;for(X=0;6>X;X++)K[I++]=M[O-6+X]-U}W+=D}k=v[v.length-1];for(v=0;v<x.length;v++)a.scale(P,S,x[v][0]),
a.scale(V,N,x[v][1]),a.add(P,P,V),a.add(P,P,k),E[H++]=P[0],E[H++]=P[1],E[H++]=P[2];x=J/3;G[J++]=L[0];G[J++]=L[1];G[J++]=L[2];D=W-D;for(J=0;J<C.length;J++)M[O++]=0<=C[J][0]?W+C[J][0]:-C[J][0]-1+D,M[O++]=0<=C[J][2]?W+C[J][2]:-C[J][2]-1+D,M[O++]=0<=C[J][1]?W+C[J][1]:-C[J][1]-1+D,K[I++]=x,K[I++]=x,K[I++]=x;return new f.Geometry([["position",{size:3,data:E,exclusive:!0}],["normal",{size:3,data:G,exclusive:!0}]],[["position",M],["normal",K]])};h.createPolylineGeometry=function(k,v,x){e.assert(1<k.length,
"createPolylineGeometry(): polyline needs at least 2 points");e.assert(3===k[0].length,"createPolylineGeometry(): malformed vertex");e.assert(null==v||v.length===k.length,"createPolylineGeometry: need same number of points and normals");e.assert(null==v||3===v[0].length,"createPolylineGeometry(): malformed normal");var C=new Float64Array(3*k.length);const A=new Uint32Array(2*(k.length-1));var B=0,D=0;for(var E=0;E<k.length;E++){for(var G=0;3>G;G++)C[B++]=k[E][G];0<E&&(A[D++]=E-1,A[D++]=E)}B=[];D=
[];B.push(["position",A]);D.push(["position",{size:3,data:C,exclusive:!0}]);if(v){C=new Float32Array(3*v.length);E=0;for(G=0;G<k.length;G++)for(let K=0;3>K;K++)C[E++]=v[G][K];B.push(["normal",A]);D.push(["normal",{size:3,data:C,exclusive:!0}])}x&&(D.push(["color",{size:4,data:x}]),B.push(["color",w.generateDefaultIndexArray(x.length/4)]));return new f.Geometry(D,B,2)};h.createExtrudedTriangle=function(k,v,x,C,A=0){const B=Array(18);k=[[-v,A,C/2],[x,A,C/2],[0,k+A,C/2],[-v,A,-C/2],[x,A,-C/2],[0,k+A,
-C/2]];v=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(x=0;6>x;x++)B[3*x]=k[x][0],B[3*x+1]=k[x][1],B[3*x+2]=k[x][2];return new f.Geometry([["position",{size:3,data:B,exclusive:!0}]],[["position",v]])};h.transformInPlace=function(k,v){k=k.getMutableAttribute("position").data;for(let x=0;x<k.length;x+=3)a.set(t,k[x],k[x+1],k[x+2]),a.transformMat4(t,t,v),k[x]=t[0],k[x+1]=t[1],k[x+2]=t[2]};h.cgToGIS=function(k,v=k){var x=k.vertexAttributes;k=x.get("position").data;if(x=x.get("normal").data){var C=
v.getMutableAttribute("normal").data;for(var A=0;A<x.length;A+=3){const B=x[A+1];C[A+1]=-x[A+2];C[A+2]=B}}if(k)for(x=v.getMutableAttribute("position").data,C=0;C<k.length;C+=3)A=k[C+1],x[C+1]=-k[C+2],x[C+2]=A;return v};h.makeOrthoBasisDirUp=m;h.makeOrthoBasisDirUpFallback=n})(u||(u={}));const t=p.create();return u})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){a.Vec3Compact=void 0;(function(p){p.length=function(b,r){const q=b[r],y=b[r+1];b=b[r+2];return Math.sqrt(q*
q+y*y+b*b)};p.normalize=function(b,r){var q=b[r];const y=b[r+1],f=b[r+2];q=1/Math.sqrt(q*q+y*y+f*f);b[r]*=q;b[r+1]*=q;b[r+2]*=q};p.scale=function(b,r,q){b[r]*=q;b[r+1]*=q;b[r+2]*=q};p.add=function(b,r,q,y,f,w=r){f=f||b;f[w]=b[r]+q[y];f[w+1]=b[r+1]+q[y+1];f[w+2]=b[r+2]+q[y+2]};p.subtract=function(b,r,q,y,f,w=r){f=f||b;f[w]=b[r]-q[y];f[w+1]=b[r+1]-q[y+1];f[w+2]=b[r+2]-q[y+2]}})(a.Vec3Compact||(a.Vec3Compact={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./BoundingInfo ./ContentObject ./geometryDataUtils ./Util".split(" "),
function(a,p,b,r,q,y,f){function w(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const l of e)if(65536<=l)return e;return new Uint16Array(e)}q=function(e){function l(d,c=[],u=0,t=-1){var h=e.call(this)||this;h._primitiveType=u;h.edgeIndicesLength=t;h.type=2;h._vertexAttributes=new Map;h._indices=new Map;h._boundingInfo=null;for(const [m,n]of d)n&&h._vertexAttributes.set(m,{...n});if(null==c||0===c.length){d=h._vertexAttributes.values().next().value;d=null==d?0:d.data.length/
d.size;c=y.generateDefaultIndexArray(d);h.edgeIndicesLength=0>h.edgeIndicesLength?d:h.edgeIndicesLength;for(const m of h._vertexAttributes.keys())h._indices.set(m,c)}else for(const [m,n]of c)n&&(h._indices.set(m,w(n)),"position"===m&&(h.edgeIndicesLength=0>h.edgeIndicesLength?h._indices.get(m).length:h.edgeIndicesLength));return h}p._inheritsLoose(l,e);var g=l.prototype;g.getMutableAttribute=function(d){(d=this._vertexAttributes.get(d))&&!d.exclusive&&(d.data=Array.from(d.data),d.exclusive=!0);return d};
g.computeAttachmentOrigin=function(d){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(d):this.computeAttachmentOriginPoints(d)};g.computeAttachmentOriginTriangles=function(d){const c=this.indices.get("position"),u=this.vertexAttributes.get("position");return y.computeAttachmentOriginTriangles(u,c,d)};g.computeAttachmentOriginPoints=function(d){const c=this.indices.get("position"),u=this.vertexAttributes.get("position");return y.computeAttachmentOriginPoints(u,c,d)};g.invalidateBoundingInfo=
function(){this._boundingInfo=null};g._calculateBoundingInfo=function(){const d=this.indices.get("position");if(0===d.length)return null;const c=0===this.primitiveType?3:1;f.assert(0===d.length%c,"Indexing error: "+d.length+" not divisible by "+c);const u=y.generateDefaultIndexArray(d.length/c),t=this.vertexAttributes.get("position");return new r.BoundingInfo(u,c,d,t)};p._createClass(l,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},
{key:"indexCount",get:function(){const d=this._indices.values().next().value;return d?d.length:0}},{key:"primitiveType",get:function(){return this._primitiveType}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){b.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}}]);return l}(q.ContentObject);a.Geometry=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports",
"../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],function(a,p,b,r,q){let y=function(){function w(l,g,d,c){this.primitiveIndices=l;this._numIndexPerPrimitive=g;this.indices=d;this.position=c;this.center=r.create();q.assert(1<=l.length);q.assert(0===d.length%this._numIndexPerPrimitive);q.assert(d.length>=l.length*this._numIndexPerPrimitive);q.assert(3===c.size||4===c.size);const {data:u,size:t}=c;c=l.length;g=t*d[this._numIndexPerPrimitive*l[0]];f.clear();
f.push(g);this.bbMin=r.fromValues(u[g],u[g+1],u[g+2]);this.bbMax=r.clone(this.bbMin);for(var h=0;h<c;++h){var m=this._numIndexPerPrimitive*l[h];for(var n=0;n<this._numIndexPerPrimitive;++n){g=t*d[m+n];f.push(g);let z=u[g];this.bbMin[0]=Math.min(z,this.bbMin[0]);this.bbMax[0]=Math.max(z,this.bbMax[0]);z=u[g+1];this.bbMin[1]=Math.min(z,this.bbMin[1]);this.bbMax[1]=Math.max(z,this.bbMax[1]);z=u[g+2];this.bbMin[2]=Math.min(z,this.bbMin[2]);this.bbMax[2]=Math.max(z,this.bbMax[2])}}b.lerp(this.center,this.bbMin,
this.bbMax,.5);this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);l=this.radius*this.radius;for(d=0;d<f.length;++d)g=f.getItemAt(d),c=u[g]-this.center[0],h=u[g+1]-this.center[1],g=u[g+2]-this.center[2],m=c*c+h*h+g*g,m<=l||(m=Math.sqrt(m),n=.5*(m-this.radius),this.radius+=n,l=this.radius*this.radius,m=n/m,this.center[0]+=c*m,this.center[1]+=h*m,this.center[2]+=g*m);f.clear()}var e=w.prototype;e.getCenter=function(){return this.center};
e.getBSRadius=function(){return this.radius};e.getBBMin=function(){return this.bbMin};e.getBBMax=function(){return this.bbMax};e.getChildren=function(){if(this._children)return this._children;if(1<b.squaredDistance(this.bbMin,this.bbMax)){var l=b.lerp(r.create(),this.bbMin,this.bbMax,.5),g=this.primitiveIndices.length;const t=new Uint8Array(g),h=Array(8);for(var d=0;8>d;++d)h[d]=0;const {data:m,size:n}=this.position;for(d=0;d<g;++d){var c=0;const z=this._numIndexPerPrimitive*this.primitiveIndices[d];
var u=n*this.indices[z];let k=m[u],v=m[u+1],x=m[u+2];for(let C=1;C<this._numIndexPerPrimitive;++C){u=n*this.indices[z+C];const A=m[u],B=m[u+1];u=m[u+2];A<k&&(k=A);B<v&&(v=B);u<x&&(x=u)}k<l[0]&&(c|=1);v<l[1]&&(c|=2);x<l[2]&&(c|=4);t[d]=c;++h[c]}l=0;for(d=0;8>d;++d)0<h[d]&&++l;if(2>l)return;l=Array(8);for(d=0;8>d;++d)l[d]=0<h[d]?new Uint32Array(h[d]):void 0;for(d=0;8>d;++d)h[d]=0;for(d=0;d<g;++d)c=t[d],l[c][h[c]++]=this.primitiveIndices[d];this._children=Array(8);for(g=0;8>g;++g)void 0!==l[g]&&(this._children[g]=
new w(l[g],this._numIndexPerPrimitive,this.indices,this.position))}return this._children};w.prune=function(){f.prune()};return w}();const f=new p({deallocator:null});a.BoundingInfo=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Util":function(){define("exports ../../../../core/mathUtils ../../../../chunks/mat4 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64".split(" "),function(a,
p,b,r,q,y,f,w){function e(n,z){if(!n)throw z=z||"assert",n=Error(z),n.stack&&console.log(n.stack),new u(z);}function l(n,z){n[12]=z[0];n[13]=z[1];n[14]=z[2]}function g(n,z=0){let k=0;for(let v=0;4>v;v++)k+=n[z+v]*h[v];return k}function d(n){return n-Math.floor(n)}const c=w.create();let u=function(){function n(z){this.message=z}n.prototype.toString=function(){return`AssertException: ${this.message}`};return n}();const t=[1,256,65536,16777216],h=[1/256,1/65536,1/16777216,1/4294967296],m=g(new Uint8ClampedArray([255,
255,255,255]));a.AssertException=u;a.assert=e;a.createTranslationMatrix=function(n,z){n=b.identity(n);l(n,z);return n};a.dec2hex=function(n){n=n.toString(16);return"00000000".substr(0,8-n.length)+n};a.encodeInt16=function(n){return p.clamp(Math.round(32767*n),-32767,32767)};a.encodeNormal=function(n,z){const k=Math.abs(n[0]),v=Math.abs(n[1]),x=1/(k+v+Math.abs(n[2])),C=Math.min(n[2]*x,0);z[0]=(0>n[0]?-1:1)*(k*x-C);z[1]=(0>n[1]?-1:1)*(v*x-C)};a.fallbackIfUndefined=function(n,z){return void 0===n?z:
n};a.fovd2fovx=function(n,z,k){return 2*Math.atan(z*Math.tan(.5*n)/Math.sqrt(z*z+k*k))};a.fovd2fovy=function(n,z,k){return 2*Math.atan(k*Math.tan(.5*n)/Math.sqrt(z*z+k*k))};a.fovx2fovd=function(n,z,k){return 2*Math.atan(Math.sqrt(z*z+k*k)*Math.tan(.5*n)/z)};a.fovx2fovy=function(n,z,k){return 2*Math.atan(k*Math.tan(.5*n)/z)};a.fovy2fovd=function(n,z,k){return 2*Math.atan(Math.sqrt(z*z+k*k)*Math.tan(.5*n)/k)};a.fovy2fovx=function(n,z,k){return 2*Math.atan(z*Math.tan(.5*n)/k)};a.getFirstObjectKey=function(n){for(const z in n)return z};
a.getMatrixTranslation=function(n,z=y.create()){z[0]=n[12];z[1]=n[13];z[2]=n[14];return z};a.hex2rgb=function(n){n=Math.floor(n);return[(n>>16&255)/255,(n>>8&255)/255,(n&255)/255]};a.inverseProjectionInfo=function(n,z,k,v,x){0===n[11]?(v[0]=2/(z*n[0]),v[1]=2/(k*n[5]),v[2]=(1+n[12])/n[0],v[3]=(1+n[13])/n[5],r.set(x,0,1)):(v[0]=-2/(z*n[0]),v[1]=-2/(k*n[5]),v[2]=(1-n[8])/n[0],v[3]=(1-n[9])/n[5],r.set(x,1,0))};a.isTranslationMatrix=function(n){return 1===n[0]&&0===n[1]&&0===n[2]&&0===n[3]&&0===n[4]&&
1===n[5]&&0===n[6]&&0===n[7]&&0===n[8]&&0===n[9]&&1===n[10]&&0===n[11]&&1===n[15]};a.logWithBase=function(n,z){return Math.log(n)/Math.log(z)};a.objectEmpty=function(n){for(const z in n)return!1;return!0};a.packFloatRGBA=function(n,z,k=0){n=p.clamp(n,0,m);for(let v=0;4>v;v++)z[k+v]=Math.floor(256*d(n*t[v]))};a.project=function(n,z,k,v,x){x||(x=n);c[0]=n[0];c[1]=n[1];c[2]=n[2];c[3]=1;f.transformMat4(c,c,z);2<x.length&&(x[2]=-c[2]);f.transformMat4(c,c,k);e(0!==c[3]);x[0]=c[0]/c[3];x[1]=c[1]/c[3];x[2]=
c[2]/c[3];x[0]=(.5*x[0]+.5)*v[2]+v[0];x[1]=(.5*x[1]+.5)*v[3]+v[1]};a.rayBoxTest=function(n,z,k,v){let x,C=(k[0]-n[0])/z[0],A=(v[0]-n[0])/z[0];C>A&&(x=C,C=A,A=x);let B=(k[1]-n[1])/z[1],D=(v[1]-n[1])/z[1];B>D&&(x=B,B=D,D=x);if(C>D||B>A)return!1;B>C&&(C=B);D<A&&(A=D);k=(k[2]-n[2])/z[2];n=(v[2]-n[2])/z[2];k>n&&(x=k,k=n,n=x);if(C>n||k>A)return!1;n<A&&(A=n);return 0>A?!1:!0};a.rayRay2D=function(n,z,k,v,x,C=q.create()){const A=(v[x]-k[x])*(z[0]-n[0])-(v[0]-k[0])*(z[x]-n[x]);if(0===A)return!1;k=((v[0]-k[0])*
(n[x]-k[x])-(v[x]-k[x])*(n[0]-k[0]))/A;C[0]=n[0]+k*(z[0]-n[0]);C[1]=n[x]+k*(z[x]-n[x]);return!0};a.rayTriangle3D=function(n,z,k,v,x,C,A,B,D=y.create()){var E=v[A]-k[C];const G=v[A+1]-k[C+1],K=v[A+2]-k[C+2];v=x[B]-k[C];A=x[B+1]-k[C+1];x=x[B+2]-k[C+2];const M=z[1]*x-A*z[2],H=z[2]*v-x*z[0],J=z[0]*A-v*z[1];B=E*M+G*H+K*J;if(-1E-5<B&&1E-5>B)return!1;B=1/B;const O=n[0]-k[C],I=n[1]-k[C+1];n=n[2]-k[C+2];D[1]=B*(O*M+I*H+n*J);if(0>D[1]||1<D[1])return!1;k=I*K-G*n;n=n*E-K*O;E=O*G-E*I;D[2]=B*(z[0]*k+z[1]*n+z[2]*
E);if(0>D[2]||1<D[1]+D[2])return!1;D[0]=B*(v*k+A*n+x*E);return!0};a.rgb2hex=function(n){const z=p.clamp(Math.round(255*n[0]),0,255),k=p.clamp(Math.round(255*n[1]),0,255);n=p.clamp(Math.round(255*n[2]),0,255);return"0x"+((z<<16)+(k<<8)+n).toString(16)};a.setMatrixTranslation=l;a.setMatrixTranslation3=function(n,z,k,v){n[12]=z;n[13]=k;n[14]=v};a.unpackFloatRGBA=g;a.verify=function(n,z){n||console.warn("Verify failed: "+(z||"")+"\n"+Error("verify").stack)};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../core/uid"],function(a,p){let b=function(){function r(){this.id=p.generateUID()}r.prototype.unload=function(){};return r}();a.ContentObject=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],function(a,p,b,r){let q=(()=>{const d=new Uint32Array(131072);
for(let c=0;c<d.length;++c)d[c]=c;return d})();const y=new Uint16Array([0]),f=(()=>{const d=new Uint16Array(65536);for(let c=0;c<d.length;++c)d[c]=c;return d})(),w=b.create(),e=b.create(),l=b.create(),g=b.create();a.computeAttachmentOriginLines=function(d,c,u,t){if(!d)return!1;const {size:h,data:m}=d;p.set(t,0,0,0);p.set(g,0,0,0);let n=d=0;const z=c?c.length-1:m.length/h-1;u=z+(u?2:0);for(let x=0;x<u;x+=2){var k=x<z?x:z,v=x<z?x+1:0;k=(c?c[k]:k)*h;v=(c?c[v]:v)*h;w[0]=m[k+0];w[1]=m[k+1];w[2]=m[k+2];
e[0]=m[v+0];e[1]=m[v+1];e[2]=m[v+2];p.scale(w,p.add(w,w,e),.5);v=p.dist(w,e);0<v?(p.add(t,t,p.scale(w,w,v)),d+=v):(p.add(g,g,w),n++)}return 0!==d?(p.scale(t,t,1/d),!0):0!==n?(p.scale(t,g,1/n),!0):!1};a.computeAttachmentOriginPoints=function(d,c,u){if(!d||!c)return!1;const {size:t,data:h}=d;p.set(u,0,0,0);d=-1;let m=0;for(let n=0;n<c.length;n++){const z=c[n]*t;d!==z&&(u[0]+=h[z+0],u[1]+=h[z+1],u[2]+=h[z+2],m++);d=z}1<m&&p.scale(u,u,1/m);return 0<m};a.computeAttachmentOriginTriangles=function(d,c,u){if(!d)return!1;
const {size:t,data:h}=d;p.set(u,0,0,0);p.set(g,0,0,0);let m=d=0;for(let z=0;z<c.length-2;z+=3){var n=c[z+0]*t;const k=c[z+1]*t,v=c[z+2]*t;p.set(w,h[n+0],h[n+1],h[n+2]);p.set(e,h[k+0],h[k+1],h[k+2]);p.set(l,h[v+0],h[v+1],h[v+2]);(n=r.areaPoints3d(w,e,l))?(p.add(w,w,e),p.add(w,w,l),p.scale(w,w,1/3*n),p.add(u,u,w),d+=n):(p.add(g,g,w),p.add(g,g,e),p.add(g,g,l),m+=3)}return 0===m&&0===d?!1:0!==d?(p.scale(u,u,1/d),!0):0!==m?(p.scale(u,g,1/m),!0):!1};a.generateDefaultIndexArray=function(d){if(1===d)return y;
if(d<f.length)return new Uint16Array(f.buffer,0,d);if(d>q.length){q=new Uint32Array(Math.max(2*q.length,d));for(let c=0;c<q.length;c++)q[c]=c}return new Uint32Array(q.buffer,0,d)};a.generateIndexArray=function(d){if(1===d)return new Uint16Array(y);if(d<f.length)return new Uint16Array(f.slice(0,d));if(d>q.length){d=new Uint32Array(d);for(let c=0;c<d.length;c++)d[c]=c;return d}return new Uint32Array(q.slice(0,d))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec2 ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),
function(a,p,b,r,q,y,f){function w(t){return t?{p0:q.clone(t.p0),p1:q.clone(t.p1),p2:q.clone(t.p2)}:{p0:q.create(),p1:q.create(),p2:q.create()}}function e(t,h,m,n=w()){r.copy(n.p0,t);r.copy(n.p1,h);r.copy(n.p2,m);return n}function l(t,h,m){var n=b.distance(t,h);h=b.distance(h,m);t=b.distance(m,t);m=(n+h+t)/2;n=m*(m-n)*(m-h)*(m-t);return 0>=n?0:Math.sqrt(n)}const g=new p.ObjectStack(y.create),d=new p.ObjectStack(()=>({p0:null,p1:null,p2:null})),c=q.create(),u=q.create();a.area2d=function(t){return l(t.p0,
t.p1,t.p2)};a.areaPoints2d=l;a.areaPoints3d=function(t,h,m){r.subtract(c,h,t);r.subtract(u,m,t);return r.length(r.cross(c,c,u))/2};a.copy=function(t,h=w()){return e(t.p0,t.p1,t.p2,h)};a.create=w;a.distance2=function(t,h){var m=t.p0,n=t.p1;t=t.p2;const z=r.subtract(f.sv3d.get(),n,m),k=r.subtract(f.sv3d.get(),t,n),v=r.subtract(f.sv3d.get(),m,t),x=r.subtract(f.sv3d.get(),h,m);var C=r.subtract(f.sv3d.get(),h,n),A=r.subtract(f.sv3d.get(),h,t);const B=r.cross(z,z,v),D=r.dot(r.cross(f.sv3d.get(),z,B),x);
C=r.dot(r.cross(f.sv3d.get(),k,B),C);A=r.dot(r.cross(f.sv3d.get(),v,B),A);if(0<D&&0<C&&0<A)return h=r.dot(B,x),h*h/r.dot(B,B);m=y.distance2(y.fromValues(m,z,g.get()),h);n=y.distance2(y.fromValues(n,k,g.get()),h);h=y.distance2(y.fromValues(t,v,g.get()),h);return Math.min(m,n,h)};a.fromValues=e;a.intersectRay=function(t,h,m){const {direction:n,origin:z}=h,{p0:k,p1:v,p2:x}=t;var C=v[0]-k[0],A=v[1]-k[1],B=v[2]-k[2];t=x[0]-k[0];h=x[1]-k[1];const D=x[2]-k[2];var E=n[1]*D-h*n[2],G=n[2]*t-D*n[0];const K=
n[0]*h-t*n[1];var M=C*E+A*G+B*K;if(-1E-5<M&&1E-5>M)return!1;M=1/M;const H=z[0]-k[0],J=z[1]-k[1],O=z[2]-k[2];E=M*(H*E+J*G+O*K);if(0>E||1<E)return!1;G=J*B-A*O;B=O*C-B*H;C=H*A-C*J;A=M*(n[0]*G+n[1]*B+n[2]*C);if(0>A||1<E+A)return!1;m&&(r.scale(m,n,M*(t*G+h*B+D*C)),r.add(m,z,m));return!0};a.wrap=function(t,h,m){const n=d.get();n.p0=t;n.p1=h;n.p2=m;return n};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("exports ../../../core/Handles ../../../core/maybe ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/Ellipsoid ./atmosphereUtils ./RealisticAtmosphereTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k){let v=function(){function G(M){this._view=M;this.canRender=!0;this._skyslot=15;this._hazeSlot=16;this._renderData={texDepth:w.create(),cameraPosition:l.create(),projectionInverse:y.create(),viewInverse:y.create(),heightParameters:d.create(),atmosphereParameters1:d.create(),atmosphereParameters2:d.create(),atmosphereParameters3:l.create(),invWavelength:A,invWavelengthScaled:B,radii:w.create(),scale:0,scaleDepth:.25,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,
oneOverScaleDepth:0,scaleDepthBlue:.05,oneOverScaleDepthBlue:20,scaleOverScaleDepthBlue:0,g:-.99999,g2:-.99999*-.99999,miePhaseCoefficients:D,nearFar:w.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0};this._lowerElevationBoundRadius=0;this._lowerBoundEarthRadius=c.earth.radius;this._updateRadius(c.earth.radius)}var K=G.prototype;K.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._vao&&(this._vao.dispose(),this._vao=null)};K.when=
function(){return Promise.resolve()};K.initializeRenderContext=function(M){const H=M.renderContext.rctx;this._handles=new p;b.isSome(this._view.basemapTerrain.rootTiles)&&this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(r.on(this._view,"basemapTerrain","elevation-change",O=>this._updateElevation(O),()=>this._updateElevation()));this._handles.add(r.on(this._view,
"basemapTerrain","elevation-bounds-change",()=>this._updateVisibleElevationBounds(),()=>this._updateVisibleElevationBounds()));const J=new t.RealisticAtmosphereTechniqueConfiguration;J.haze=!1;this._atmosphereTechnique=M.shaderTechniqueRep.acquire(t.RealisticAtmosphereTechnique,J);J.haze=!0;this._atmosphereHazeTechnique=M.shaderTechniqueRep.acquire(t.RealisticAtmosphereTechnique,J);this._vao=this._createVertexArrayObject(H)};K.uninitializeRenderContext=function(){this.destroy()};K.render=function(M){if(M.slot!==
this._hazeSlot&&M.slot!==this._skyslot||0!==M.pass)return!1;this._update(M.camera);M.slot===this._skyslot&&this._renderSky(M);M.slot===this._hazeSlot&&this._renderHaze(M);return!0};K._renderSky=function(M){const H=M.rctx,J=this._atmosphereTechnique.program;H.useProgram(J);this._atmosphereTechnique.bindPipelineState(H);J.setUniform3fv("atmosphereParameters3",this._renderData.atmosphereParameters3);this._renderCommon(J,M)};K._renderHaze=function(M){const H=M.rctx,J=M.offscreenRenderingHelper,O=this._atmosphereHazeTechnique.program;
H.useProgram(O);this._atmosphereHazeTechnique.bindPipelineState(H);J.renderDepthDetached(()=>{O.bindTexture(J.depthTexture,"depthTex");this._renderCommon(O,M)})};K._renderCommon=function(M,H){const J=H.rctx;M.setUniform3fv("invWavelength",this._renderData.invWavelength);M.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled);H.scenelightingData.setLightDirectionUniform(M);M.setUniform4fv("heightParameters",this._renderData.heightParameters);M.setUniform3fv("cameraPosition",this._renderData.cameraPosition);
M.setUniformMatrix4fv("projectionInverse",this._renderData.projectionInverse);M.setUniformMatrix4fv("viewInverse",this._renderData.viewInverse);M.setUniform2fv("nearFar",this._renderData.nearFar);M.setUniform2fv("radii",this._renderData.radii);M.setUniform4fv("atmosphereParameters1",this._renderData.atmosphereParameters1);M.setUniform4fv("atmosphereParameters2",this._renderData.atmosphereParameters2);M.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance);M.setUniform1f("altitudeFade",
this._renderData.altitudeFade);J.bindVAO(this._vao);M.assertCompatibleVertexAttributeLocations(this._vao);J.drawArrays(5,0,4)};K._createVertexArrayObject=function(M){const H=E.createBuffer(4);H.position.setVec(0,[-1,-1]);H.position.setVec(1,[1,-1]);H.position.setVec(2,[-1,1]);H.position.setVec(3,[1,1]);H.uv0.setVec(0,[0,0]);H.uv0.setVec(1,[1,0]);H.uv0.setVec(2,[0,1]);H.uv0.setVec(3,[1,1]);return new k(M,n.Default3D,{geometry:h.glLayout(E)},{geometry:z.createVertex(M,35044,H.buffer)})};K._adjustRadiusForTesselation=
function(M){return M*Math.cos(Math.PI/16/16)};K._updateElevation=function(M){M=M?M.tile:b.unwrapOr(this._view.basemapTerrain.rootTiles,[null])[0];b.isNone(M)||0!==M.lij[0]||(M=this._adjustRadiusForTesselation(c.earth.radius+M.elevationBounds[0]),M!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=M,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds()))};K._updateVisibleElevationBounds=function(){const M=this._adjustRadiusForTesselation(c.earth.radius+this._view.basemapTerrain.elevationBounds.min);
(0>this._lowerBoundEarthRadius||M<this._lowerBoundEarthRadius)&&this._updateRadius(M)};K._updateRadius=function(M){this._lowerBoundEarthRadius=M;var H=M/10*10.25;const J=1/(H-M),O=J/.25,I=J/.05,F=.3*(H-M)+M,L=this._renderData;g.set(L.atmosphereParameters1,J,.25,O,4);g.set(L.atmosphereParameters2,-.99999,.05,I,20);e.set(L.atmosphereParameters3,-.99999*-.99999,D,F);f.set(L.radii,M,H);L.scale=J;L.lowerAlphaBlendBound=F;L.scaleOverScaleDepth=O;L.scaleOverScaleDepthBlue=I;H=u.innerAtmosphereDepth;L.innerFadeDistance=
2*Math.sqrt((2*M-H)*H)};K._update=function(M){M&&(this._renderData.cameraHeight=e.length(M.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=this._renderData.cameraHeightSq-this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.heightParameters=d.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,
this._renderData.C,this._renderData.CSur),e.copy(this._renderData.cameraPosition,M.eye),q.invert(this._renderData.projectionInverse,M.projectionMatrix),q.invert(this._renderData.viewInverse,M.viewMatrix),f.set(this._renderData.nearFar,M.near,M.far),this._renderData.altitudeFade=u.computeInnerAltitudeFade(this._renderData.cameraHeight-this._lowerBoundEarthRadius))};G.isSupported=function(M){return M.renderContext.rctx.capabilities.depthTexture};return G}();const x=.02*Math.PI,C=.004*Math.PI,A=l.fromValues(1/
.65**4,1/.57**4,1/.475**4),B=l.clone(A);e.scale(B,B,x);e.add(B,B,l.fromValues(C,C,C));const D=(1- -.99999*-.99999)/(2+-.99999*-.99999)*1.5,E=m.newLayout().vec2f("position").vec2f("uv0");a.RealisticAtmosphere=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/RealisticAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/RealisticAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){f=function(d){function c(){return d.apply(this,arguments)||this}b._inheritsLoose(c,d);var u=c.prototype;u.initializeProgram=function(t){const h=c.shader.get().build({haze:this.configuration.haze});return new l.Program(t.rctx,h,e.Default3D)};u.initializePipeline=function(){return this.configuration.haze?g.makePipelineState({blending:g.separateBlendingParams(1,0,769,1),colorWrite:g.defaultColorWriteParams}):g.makePipelineState({blending:g.separateBlendingParams(770,1,
771,771),depthTest:{func:515},colorWrite:g.defaultColorWriteParams})};return c}(f.ShaderTechnique);f.shader=new y.ReloadableShaderModule(q.RealisticAtmosphereShader,()=>new Promise(function(d,c){a(["./RealisticAtmosphere.glsl"],d,c)}));q=function(d){function c(){var u=d.apply(this,arguments)||this;u.haze=!1;return u}b._inheritsLoose(c,d);return c}(w.ShaderTechniqueConfiguration);r.__decorate([w.parameter()],q.prototype,"haze",void 0);p.RealisticAtmosphereTechnique=f;p.RealisticAtmosphereTechniqueConfiguration=
q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/RealisticAtmosphere.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,p,b,r){function q(f){const w=new r.ShaderBuilder;w.attributes.add("position","vec2");w.attributes.add("uv0","vec2");w.varyings.add("worldRay","vec3");w.varyings.add("vtc","vec2");
f.haze&&w.varyings.add("eyeDir","vec3");w.vertex.uniforms.add("projectionInverse","mat4");w.vertex.uniforms.add("viewInverse","mat4");w.vertex.code.add(b.glsl`
    void main(void) {
      vec3 posViewNear = (projectionInverse * vec4(position, -1, 1)).xyz;

      worldRay = (viewInverse * vec4(posViewNear, 0)).xyz;
      vtc = uv0;

      ${f.haze?b.glsl`eyeDir = posViewNear;`:""}

      gl_Position = vec4(position, 1, 1);
    }
  `);w.fragment.uniforms.add("lightingMainDirection","vec3").add("invWavelength","vec3").add("invWavelengthScaled","vec3").add("radii","vec2").add("atmosphereParameters1","vec4").add("atmosphereParameters2","vec4").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4");f.haze?w.fragment.uniforms.add("depthTex","sampler2D"):w.fragment.uniforms.add("atmosphereParameters3","vec3").add("innerFadeDistance","float").add("altitudeFade","float");w.fragment.include(p.ColorConversion);
w.fragment.code.add(b.glsl`const float krESun = 0.075;
const float kmESun = 0.015;
#define innerRadius radii[0]
#define outerRadius radii[1]
#define shellScale atmosphereParameters1.x
#define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)
#define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)
#define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)`);f.haze||w.fragment.code.add(b.glsl`#define g atmosphereParameters2.x
#define gSq atmosphereParameters3.x
#define miePhaseCoefficients atmosphereParameters3.y
#define lowerAlphaBlendBound atmosphereParameters3.z`);w.fragment.code.add(b.glsl`
  // The camera's current height
  #define cameraHeight heightParameters[0]
  // cameraHeight^2
  #define cameraHeightSq heightParameters[1]
  // cameraHeightSq - outerRadiusSq; // C = ||o-c||^2 - r^2
  #define C heightParameters[2]
  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C = ||o-c||^2 - r^2
  #define CSur heightParameters[3]

  ${f.haze?"// Camera HDR\n        const float exposure \x3d 1.5;\n        const vec3 oneOverGamma \x3d vec3(1.0); //Gamma \x3d 1.0":"const float exposure \x3d 2.0;\n        const vec3 oneOverGamma \x3d vec3(0.454545); // Gamma \x3d 2.2\n        vec3 reinhardTM(vec3 inputColor, float _exposure) {\n          vec3 intermediate \x3d inputColor * _exposure;\n          intermediate /\x3d ( 1.0 + intermediate );\n          return pow(intermediate, oneOverGamma);\n        }\n        "}
    // Loop constants for integral approximation
    const float samples = 5.0;
    const int maxSamples = 5;

    // ToneMapping operators
    vec3 expTM(vec3 inputColor,float _exposure) {
        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);
    }

    // Approximation for inner integral based on a radii ratio of 10.25:10
    float scale(float _cos) {
      float x = 1.0 - _cos;
      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));
    }

    void main() {
      // Obtain ray from Camera
      vec3 worldSpaceRay = normalize(worldRay);

      // Compute Atmosphere intersection; i.e. ray/sphere intersection
      float B = 2.0 * dot(cameraPosition, worldSpaceRay); // B = 2(l * (o-c))
      float det = B * B - 4.0 * C; // det = B^2 - 4.0* C

      // idealized sphere intersection to discard early some pixels
      float detSur = B * B - 4.0 * CSur; // det = B^2 - 4.0* C

      // the minimal sample start position:
      // at the camera by default, on the earth radius surface if the camera is underground.
      float minRayStart = 0.0;
  `);f.haze||w.fragment.code.add(b.glsl`float surfaceBlend = 0.0;
vec4 surfaceColor = vec4(0.0);
if (detSur >= 0.0) {
float nearSurface = max(0.0, 0.5 *(-B - sqrt(detSur)));
float farSurface = max(0.0, 0.5 *(-B + sqrt(detSur)));
if (nearSurface == 0.0) {
minRayStart = farSurface;
}
vec3 vPos = cameraPosition + worldSpaceRay * nearSurface;
float lightAngle = dot(lightingMainDirection, normalize(vPos));
float brightness = max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));
surfaceColor = vec4(brightness, brightness, brightness, 1.0 - altitudeFade);
float relDist = (farSurface - nearSurface) / innerFadeDistance;
if (relDist > 1.0) {
gl_FragColor = surfaceColor;
return;
}
surfaceBlend = smoothstep(0.0, 1.0, relDist * relDist);
}`);w.fragment.code.add(b.glsl`
    if (det >= 0.0) {
    ${f.haze?"\n          float depthSample \x3d texture2D(depthTex, vtc).r;\n\n          float zNear \x3d nearFar[0];\n          float zFar \x3d nearFar[1];\n\n          // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n          float zNorm \x3d 2.0 * depthSample - 1.0;\n          float linDepth \x3d 2.0 * zNear * zFar /\n            (zFar + zNear - zNorm * (zFar - zNear));\n\n          float rayEnd;\n          float altitudeAlpha \x3d 1.0;\n\n          // find intersections with ground, but only between the near and far\n          // clipping planes.\n          if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n            vec3 cameraSpaceRay \x3d normalize(eyeDir);\n            cameraSpaceRay /\x3d cameraSpaceRay.z;\n            cameraSpaceRay *\x3d linDepth;\n\n            float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n\n            vec3 world \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n            float worldRadiusSq \x3d dot(world, world);\n\n            // Handle tall structures:\n            // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n            float transitionStart \x3d innerRadius + 20000.0;\n            float transitionHeight \x3d 25000.0;\n            float transitionEnd \x3d transitionStart + transitionHeight;\n\n            float edge0 \x3d transitionStart * transitionStart;\n            float edge1 \x3d transitionEnd * transitionEnd;\n\n            altitudeAlpha \x3d 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n            rayEnd \x3d cameraSpaceRayLength;\n\n            if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\n              float nearSurface \x3d 0.5 * ( -B - sqrt(detSur) );\n              float interp \x3d clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n              rayEnd \x3d mix(cameraSpaceRayLength, nearSurface, interp);\n            }\n          }":
""}
    float rayStart = 0.5 *(-B - sqrt(det)); //near intersection with atmosphere
    ${f.haze?"float near \x3d abs(rayStart);\n        float far \x3d abs(rayEnd);":"float rayEnd \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere"}

    float scatterDistance; // calculate its scattering offset
    // Calculate the ray's starting position
    if (rayStart < minRayStart)
    { // ray starts from camera or inner radius sphere to far
      rayStart = minRayStart;
      ${f.haze?"":"// clamp to value at inner radius altitude\n          scatterDistance \x3d shellScale * min(0.0, innerRadius - cameraHeight);"}
    }
    ${f.haze?"":"else { // outside atmosphere\n          scatterDistance \x3d -1.0;\n        }"}
    // Initialize the scattering loop variables
    vec3 start = cameraPosition + worldSpaceRay * rayStart;
  `);f.haze&&w.fragment.code.add(b.glsl`vec3 end = cameraPosition + worldSpaceRay * rayEnd;
float endLength = length(end);
vec2 altitudeInterval = vec2(length(start) - innerRadius, endLength - innerRadius);
if (altitudeInterval.x < 0.0) {
altitudeInterval = -altitudeInterval;
}
float lightAngle = dot(lightingMainDirection, end) / endLength;
if (near > far)
{
if (altitudeInterval.x < altitudeInterval.y)
{
end = cameraPosition + worldSpaceRay * rayStart;
start = cameraPosition + worldSpaceRay * rayEnd;
worldSpaceRay *= -1.0;
float tmp = altitudeInterval.x;
altitudeInterval.x = altitudeInterval.y;
altitudeInterval.y = tmp;
}
else if (altitudeInterval.x == altitudeInterval.y)
{
altitudeInterval.x += 1.0;
}
}
if (altitudeInterval.x > outerRadius - innerRadius)
{
scatterDistance = innerRadius - outerRadius;
} else
{
scatterDistance = altitudeInterval.y - altitudeInterval.x;
}`);w.fragment.code.add(b.glsl`vec2 opticalStartDepth = exp(scatterDistance * oneOverScaleDepth);
float rayLength = rayEnd - rayStart;
float sampleLength = rayLength / samples;
float scaledLength = sampleLength * shellScale;
vec3 sampleRay = worldSpaceRay * sampleLength;
vec3 samplePoint = start + sampleRay * 0.5;`);f.haze?w.fragment.code.add(b.glsl`float cameraAngle = dot(-worldSpaceRay, end) / length(end);
float scaleCameraAngle = scale(cameraAngle);
vec2 cameraOffset = scaleCameraAngle * opticalStartDepth;
float scaledValues = scale(lightAngle) + scaleCameraAngle;
vec2 scaledValuesDepth = scaledValues * shellDepth;`):w.fragment.code.add(b.glsl`float cameraAngle = dot(worldSpaceRay, start / length(start));
float angleMultiplier = cameraAngle > 0.0 ? cameraAngle : 0.0;
float scaleCameraAngle = scale(cameraAngle);
vec2 cameraOffset = scaleCameraAngle * opticalStartDepth * shellDepth;`);w.fragment.code.add(b.glsl`vec3 frontColor = vec3(0.0);
vec3 frontColorBlue = vec3(0.0);
vec3 attenuate = vec3(0.0);
vec3 attenuateBlue = vec3(0.0);
for(int i=0; i<maxSamples; i++) {
float height = length(samplePoint);
float altitude = abs(height - innerRadius);
vec2 depth = exp(-altitude * scaleOverScaleDepth);`);f.haze?w.fragment.code.add(b.glsl`vec2 scatter = depth * scaledValuesDepth - cameraOffset;`):w.fragment.code.add(b.glsl`float lightAngle = dot(lightingMainDirection, samplePoint) / height;
float cameraAngle = dot(worldSpaceRay, samplePoint) / height;
float tmpScaledValues = scale(lightAngle) - scale(cameraAngle);
vec2 scatter = cameraOffset + tmpScaledValues * depth * shellDepth;`);w.fragment.code.add(b.glsl`attenuate = exp(-scatter.x * invWavelengthScaled);
attenuateBlue = exp(-scatter.y * invWavelengthScaled);
frontColor += attenuate * depth.x;
frontColorBlue += attenuateBlue * depth.y;
samplePoint += sampleRay;
}
float LdotR = clamp(dot(lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);
float LdotRSq = LdotR * LdotR + 1.0;`);f.haze?w.fragment.code.add(b.glsl`vec3 colorCoefficients = (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );
vec3 color = colorCoefficients * frontColor;
vec3 colorBlue = colorCoefficients * frontColorBlue;`):w.fragment.code.add(b.glsl`vec3 rayleighCoefficients = (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;
float mieCoefficients = scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);
vec3 color = rayleighCoefficients * frontColor + mieCoefficients * frontColor;
vec3 colorBlue = rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;`);w.fragment.code.add(b.glsl`vec3 ldrBlue = expTM(colorBlue, 2.0 * exposure);
vec3 ldrRed = expTM(color, exposure);
vec3 LDR = mix(ldrBlue, ldrRed, 0.2);`);f.haze?w.fragment.code.add(b.glsl`LDR *= (1.0 - cameraAngle);
vec3 hsv = rgb2hsv(LDR);
hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0);
LDR = hsv2rgb(hsv);
vec3 finalColor = LDR;`):w.fragment.code.add(b.glsl`vec3 ldrReinhard = reinhardTM(color, exposure);
LDR += angleMultiplier * ldrReinhard;
float side = (rayEnd + rayStart) * 0.5;
float atmoHeight = sqrt(cameraHeightSq - side * side);
float h2 = clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);
vec3 finalColor = LDR * h2;
vec3 hsv = rgb2hsv(finalColor);
hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0);
finalColor = hsv2rgb(hsv);`);w.fragment.code.add(b.glsl`
    ${f.haze?"gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;":"float atmosStrength \x3d clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n          gl_FragColor \x3d vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n          if (surfaceBlend \x3e 0.0) {\n            gl_FragColor \x3d mix(gl_FragColor, surfaceColor, surfaceBlend);\n          }"}
      } else { // Outside Atmosphere
        gl_FragColor = vec4(0.0);
      }
    }
  `);return w}var y=Object.freeze({__proto__:null,build:q});a.RealisticAtmosphereShader=y;a.build=q})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ../../../support/requestImageUtils ./atmosphereUtils ./SimpleAtmosphereTechnique ./resources/MarsAtmosphereTexture ./resources/SimpleAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G){function K(N,R,S,P,Q){const V=l.length(N),ca=P*Math.sqrt(V*V-P*P)/V,ba=Q.silCircleV1,Z=Q.silCircleV2;l.scale(Q.silCircleCenter,N,Math.sqrt(P*P-ca*ca)/V);l.cross(ba,N,R);1>l.squaredLength(ba)&&l.cross(ba,N,S);l.scale(ba,ba,ca/l.length(ba));l.cross(Z,ba,N);l.scale(Z,Z,ca/l.length(Z));return ca}const M=p.getLogger("esri.views.3d.environment.SimpleAtmosphere"),H=-t.innerAtmosphereDepth,J=z.makePiecewiseLinearFunction([[50,.1015625],[500,
.21875],[5E3,.51171875],[5E4,.4140625]]);p=function(){function N(S){this.view=S;this.slot=15;this._renderData={texV:e.create(),silCircleCenter:g.create(),silCircleV1:g.create(),silCircleV2:g.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this._readyResolver=r.createResolver();this._readyController=r.createAbortController();this.texV1=1;this.isOnMars=c.isMars(S.spatialReference);S=d.getReferenceEllipsoid(S.spatialReference);this.planetRadius=S.radius;this.outerRimWidth=
S.outerAtmosphereRimWidth;this.innerRimFactor=(this.planetRadius+H)/this.planetRadius;this.middleRimFactor=(this.planetRadius+0)/this.planetRadius;this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius;this.texV0=0/this.outerRimWidth;this.texVScale=this.texV1-this.texV0}var R=N.prototype;R.when=function(){return this._readyResolver.promise};R.initializeRenderContext=function(S){const P=S.renderContext.rctx;this._cameraChangeHandle=q.init(this.view,"state.camera",()=>S.requestRender(),
!0);const Q=new h.SimpleAtmosphereTechniqueConfiguration;Q.geometry=0;this._atmosphereConeTechnique=S.shaderTechniqueRep.acquire(h.SimpleAtmosphereTechnique,Q);Q.geometry=2;this._atmosphereUndergroundTechnique=S.shaderTechniqueRep.acquire(h.SimpleAtmosphereTechnique,Q);this._vao=this._createRibbon(P);this._vaoCount=E.vertexCount(this._vao,"geometry");this._fadeVao=C.createQuadVAO(P);this._fadeVaoCount=E.vertexCount(this._fadeVao,"geometry");u.requestImage(this.isOnMars?m:n,{signal:this._readyController.signal}).then(V=>
{this._texture=new D(P,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},V);S.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(V=>{r.isAbortError(V)||M.error("Unable to initialize simple atmosphere: image request failed",V);this._readyResolver.reject()})};R.uninitializeRenderContext=function(){this.destroy()};R.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=
null);this._texture&&(this._texture.dispose(),this._texture=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._vao&&(this._vao.dispose(),this._vao=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};R.render=function(S){if(S.slot!==this.slot||0!==S.pass)return!1;this._update(S.camera);const P=S.rctx;this._atmosphereConeTechnique.bindPipelineState(P);if(1>this._renderData.undergroundFadeAlpha){var Q=this._atmosphereConeTechnique.program;P.useProgram(Q);
Q.setUniformMatrix4fv("proj",S.camera.projectionMatrix);Q.setUniformMatrix4fv("view",S.camera.viewMatrix);Q.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);Q.setUniform3fv("silCircleV1",this._renderData.silCircleV1);Q.setUniform3fv("silCircleV2",this._renderData.silCircleV2);Q.setUniform2fv("texV",this._renderData.texV);Q.bindTexture(this._texture,"tex");S.scenelightingData.setLightDirectionUniform(Q);Q.setUniform1f("altitudeFade",this._renderData.altitudeFade);Q.setUniform1f("innerScale",
this._renderData.innerScale);P.bindVAO(this._vao);P.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(Q=this._atmosphereUndergroundTechnique.program,P.useProgram(Q),Q.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),S.scenelightingData.setLightDirectionUniform(Q),Q.setUniform3fv("cameraPosition",S.camera.eye),P.bindVAO(this._fadeVao),P.drawArrays(5,0,this._fadeVaoCount));return!0};R._update=function(S){var P=g.create();const Q=this.planetRadius;var V=
l.length(S.eye);const ca=V-Q;this._renderData.undergroundFadeAlpha=0>ca?Math.min(-ca/5E3,1):0;var ba=Q+H,Z=Q+Math.max(50,ca);this._renderData.innerScale=Z*Z/(Math.sqrt(Z*Z-Q*Q)*Math.sqrt(Z*Z-ba*ba)+Q*ba)-1;this._renderData.altitudeFade=t.computeInnerAltitudeFade(ca);l.scale(P,S.eye,(Q+50)/V);K(P,S.center,S.up,Q,this._renderData);P=this._computeScreenRimWidth(S,P,S.up,this._renderData);V=J(ca);ba=this.texV0+.001953125*this.texVScale;Z=this.texV0+P*V*this.texVScale;50<ca&&(K(S.eye,S.center,S.up,Q,this._renderData),
S=this._computeScreenRimWidth(S,S.eye,S.up,this._renderData),S=b.clamp((S-1.5)/(P-1.5),0,1),ba=this.texV0+.001953125*S*this.texVScale,Z=this.texV0+b.lerp(this.texV1,P*V,S)*this.texVScale);w.set(this._renderData.texV,ba,Z)};R._createRibbon=function(S){const P=new Float32Array(1155),Q=new Uint32Array(1920);P[0]=0;P[1]=0;P[2]=-1;for(var V=0;128>V;V++){var ca=9*V+3;P[ca+0]=V;P[ca+1]=this.innerRimFactor;P[ca+2]=-1;P[ca+3]=V;P[ca+4]=this.middleRimFactor;P[ca+5]=0;P[ca+6]=V;P[ca+7]=this.outerRimFactor;P[ca+
8]=1;ca=3*V+1;var ba=127===V?1:ca+3,Z=15*V;Q[Z+0]=ca;Q[Z+1]=ca+1;Q[Z+2]=ba+1;Q[Z+3]=ba+1;Q[Z+4]=ba;Q[Z+5]=ca;Q[Z+6]=ca+1;Q[Z+7]=ca+2;Q[Z+8]=ba+2;Q[Z+9]=ba+2;Q[Z+10]=ba+1;Q[Z+11]=ca+1;Q[Z+12]=ca;Q[Z+13]=ba;Q[Z+14]=0}V=L.createBuffer(Q.length);ca=V.position;for(ba=0;ba<Q.length;++ba)Z=3*Q[ba],ca.set(ba,0,P[Z]),ca.set(ba,1,P[Z+1]),ca.set(ba,2,P[Z+2]);return new G(S,x.Default3D,{geometry:k.glLayout(L)},{geometry:B.createVertex(S,35044,V.buffer)})};R._computeScreenRimWidth=function(S,P,Q,V){l.add(I,V.silCircleCenter,
V.silCircleV2);l.scale(F,I,this.outerRimFactor);y.lookAt(O,P,I,Q);A.project(I,O,S.projectionMatrix,S.viewport);A.project(F,O,S.projectionMatrix,S.viewport);return l.distance(I,F)/S.height};a._createClass(N,[{key:"canRender",get:function(){return null!=this._texture}}]);return N}();const O=f.create(),I=g.create(),F=g.create(),L=v.newLayout().vec3f("position");return p})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../support/WatchUpdatingTracking ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x){const C=f.getLogger("esri.views.3d.environment.Stars");a.Stars=function(K){function M(J){J=K.call(this,J)||this;J._loadDataTask=null;J._numPoints=0;J._renderParameter={camera:null,modelMatrix:t.create()};J._updatingTracking=new k.WatchUpdatingTracking;return J}p._inheritsLoose(M,K);var H=M.prototype;H.initialize=function(){this._loadDataTask=this._createLoadDataTask()};H.destroy=function(){this._loadDataTask=w.abortMaybe(this._loadDataTask);this._updatingTracking.destroy();
this._numPoints=0;this._technique=w.disposeMaybe(this._technique);this._vao=w.disposeMaybe(this._vao)};H.render=function(J,O){this._ensureResources(J);if(w.isNone(this._technique)||w.isNone(this._vao))return!0;const I=this._technique.program;J.useProgram(I);this._renderParameter.camera=O;this._technique.bindPass(this._renderParameter);this._technique.bindPipelineState(J);J.bindVAO(this._vao);I.assertCompatibleVertexAttributeLocations(this._vao);J.drawArrays(0,0,this._numPoints);return!0};H._ensureResources=
function(J){if(!w.isSome(this._technique)&&!w.isNone(G)){this._technique=new h.StarsTechnique({rctx:J,viewingMode:this.view.state.viewingMode},null);this._numPoints=G.byteLength/9;var O=new Float32Array(G,0,2*this._numPoints),I=new Uint8Array(G,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(J,O,I,this._numPoints);this._updatingTracking.add(this.view,"environment.lighting.date",F=>this._update(F),2)}};H._computeDayDuration=function(J){const O=new Date(J.getFullYear(),0,
1,11,58,56),I=new Date(J.getFullYear()+1,0,1,11,58,55);return(+J-+O)/(+I-+O)};H._update=function(J){if(J){var O=J.getHours()/12,I=J.getMinutes()/60*(2/24),F=J.getSeconds()/60*(2/1440);O=(O+I+F-.9972222)%2;J=2*this._computeDayDuration(J);I=this._renderParameter.modelMatrix;u.copy(I,D);u.rotateZ(I,I,-J*Math.PI);u.multiply(I,B,I);u.rotateZ(I,I,-O*Math.PI);this.requestRender()}};H._hexToRGB=function(J){return[parseInt(J.substring(0,2),16),parseInt(J.substring(2,4),16),parseInt(J.substring(4,6),16)]};
H._unpackUint8Attributes=function(J){return 192<=J?[2.9,J-192]:160<=J?[2.5,J-160]:128<=J?[2,J-128]:96<=J?[1.5,J-96]:64<=J?[1,J-64]:32<=J?[.7,J-32]:[.4,J]};H._createVertexArrayObject=function(J,O,I,F){const L=E.createBuffer(F),N=L.position,R=L.color,S=L.size;for(let V=0;V<F;V++){var P=O[2*V],Q=O[2*V+1];N.set(V,0,-Math.cos(P)*Math.sin(Q));N.set(V,1,-Math.sin(P)*Math.sin(Q));N.set(V,2,-Math.cos(Q));P=this._unpackUint8Attributes(I[V]);Q=this._hexToRGB(A[P[1]]);R.set(V,0,255*Q[0]);R.set(V,1,255*Q[1]);
R.set(V,2,255*Q[2]);R.set(V,3,255);S.set(V,P[0])}return new x(J,z.Default3D,{geometry:m.glLayout(E)},{geometry:v.createVertex(J,35044,L.buffer)})};H._createLoadDataTask=function(){var J=this;if(w.isSome(G))return null;const O=e.createTask(function(){var I=p._asyncToGenerator(function*(F){({data:F}=yield r.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:F}));J._verifyStarData(F);G=F});return function(F){return I.apply(this,arguments)}}());O.promise.catch(I=>
{e.isAbortError(I)||C.error(I)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return O};H._verifyStarData=function(J){if(!J)throw new y("stars:no-data-received","Failed to create stars because star catalogue is missing");J=J.byteLength/9;if(0!==J%1||5E4<J||5E3>J)throw new y("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};p._createClass(M,[{key:"updating",get:function(){return this._updatingTracking.updating||this.loading}},
{key:"loading",get:function(){return w.isSome(this._loadDataTask)&&!this._loadDataTask.finished}},{key:"canRender",get:function(){return!this.loading}}]);return M}(q);b.__decorate([l.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);b.__decorate([l.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);b.__decorate([l.property({readOnly:!0})],a.Stars.prototype,"updating",null);b.__decorate([l.property()],a.Stars.prototype,"_loadDataTask",void 0);b.__decorate([l.property()],
a.Stars.prototype,"_updatingTracking",void 0);a.Stars=b.__decorate([c.subclass("esri.views.3d.environment.Stars")],a.Stars);const A="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),B=t.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),D=t.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,
0,.39778850739794974,.9174771405229186,0,0,0,0,1),E=n.newLayout().vec3f("position").vec4u8("color").f32("size");let G=null;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){w=function(c){function u(){return c.apply(this,arguments)||this}b._inheritsLoose(u,c);var t=u.prototype;t.initializeProgram=function(h){const m=u.shader.get().build();return new l.Program(h.rctx,m,e.Default3D)};t.initializePipeline=function(){return g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:g.defaultColorWriteParams})};t.bindPass=function(h){const m=this.makeInfiniteProjectionMatrix(h.camera.projectionMatrix,
h.camera.near,d);r.multiply(m,m,h.camera.viewMatrix);r.multiply(m,m,h.modelMatrix);this.program.setUniformMatrix4fv("transform",m);this.program.setUniform4fv("viewport",h.camera.fullViewport);this.program.setUniform1f("pixelRatio",h.camera.pixelRatio)};t.makeInfiniteProjectionMatrix=function(h,m,n){r.copy(n,h);n[10]=2.4E-7-1;n[11]=-1;n[14]=(2.4E-7-2)*m;return n};return u}(w.ShaderTechnique);w.shader=new f.ReloadableShaderModule(y.StarsShader,()=>new Promise(function(c,u){a(["./Stars.glsl"],c,u)}));
const d=q.create();p.StarsTechnique=w;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/Stars.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,p,b,r){function q(){const f=new r.ShaderBuilder;f.attributes.add("position","vec3");f.attributes.add("color","vec4");f.attributes.add("size","float");f.varyings.add("vcolor",
"vec4");f.varyings.add("vsize","float");f.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float");f.include(p.AlignPixel);f.vertex.code.add(b.glsl`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);f.fragment.code.add(b.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`);return f}var y=Object.freeze({__proto__:null,build:q});a.StarsShader=y;a.build=q})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.AlignPixel=function(b){const r=p.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,q=p.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;b.vertex.code.add(r);b.vertex.code.add(q);b.fragment.code.add(r);b.fragment.code.add(q)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/Point","../../../geometry/projectionEllipsoid"],function(a,p,b,r){function q(w,e,l){return y(w,e.longitude,e.latitude,l.longitude,l.latitude)}function y(w,e,l,g,d){l=p.deg2rad(l);d=p.deg2rad(d);e=p.deg2rad(e);const c=p.deg2rad(g);g=Math.sin((l-d)/2);
e=Math.sin((e-c)/2);l=2*p.asinClamped(Math.sqrt(g*g+Math.cos(l)*Math.cos(d)*e*e));return Math.round(l*w*1E4)/1E4}function f(w,e){w/=15;e||(w=Math.round(w));return w}a.getGreatCircleDistance=y;a.getGreatCircleDistanceFromPoints=q;a.getGreatCircleSpanAt=function(w,e,l){const g=e.spatialReference,d=r.getReferenceEllipsoid(g),c=new b(e.x,w.y,g),u=new b(l.x,w.y,g);e=new b(w.x,e.y,g);w=new b(w.x,l.y,g);return{lon:q(d.radius,c,u),lat:q(d.radius,e,w)}};a.getLatDeltaForDistance=function(w,e){return p.rad2deg(w/
e)};a.getLonDeltaForDistance=function(w,e,l){e/=l;w=p.deg2rad(w);e=Math.sin(e/2);w=Math.cos(w);w=2*p.asinClamped(Math.sqrt(e*e/(w*w)));return p.rad2deg(w)};a.getMaxCameraAltitude=function(w,e){w=p.deg2rad(w/2);return(1-Math.sin(w))*e/Math.sin(w)};a.longitudeToTimezone=f;a.pointToTimezone=function(w,e){return f(w.longitude,e)};a.positionToTimezoneInfo=function(w,e){e||(e={hours:0,minutes:0,seconds:0});e.hours=f(w[0],!0);w=e.hours%1;e.hours-=w;e.minutes=60*w;w=e.minutes%1;e.minutes-=w;e.seconds=Math.round(60*
w);return e};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/SunCalc".split(" "),function(a,p,b,r,q,y,f){function w(t,h,m,n){const z=c,k=b.identity(d);if(1===m)f.SunCalc.getPosition(t,0,0,z),q.set(n,0,0,-1),b.rotateX(k,k,-z.azimuth),b.rotateY(k,k,-z.altitude);else{var v=l.planarDirection;m=v.globalAngles;v=
(Math.abs(h[2])-v.localAltitude)/(v.globalAltitude-v.localAltitude);v=p.clamp(v,0,1);1>v?(f.SunCalc.getPosition(t,h[1],h[0],z),z.azimuth=(1-v)*z.azimuth+v*m.azimuth,z.altitude=(1-v)*z.altitude+v*m.altitude):(z.azimuth=m.azimuth,z.altitude=m.altitude);q.set(n,0,-1,0);b.rotateZ(k,k,-z.azimuth);b.rotateX(k,k,-z.altitude)}q.transformMat4(n,n,k)}function e(t,h,m,n){const z=[];for(let k=0;k<m.length;k++)z[k]=(n[k]-m[k])*t/h+m[k];return z}const l={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,
ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},g=y.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258),d=r.create(),c={azimuth:0,altitude:0},u=new Date(0);a.ColorAndIntensity=function(){this.ambient={color:y.fromValues(1,1,1),intensity:.55};this.diffuse={color:y.fromValues(1,1,1),intensity:.55,directionToLightSource:y.clone(g)};
this.noonFactor=.5;this.globalFactor=0};a.computeColorAndIntensity=function(t,h,m,n){var z=h[2];q.set(n.ambient.color,1,1,1);n.ambient.intensity=l.global.ambient;q.set(n.diffuse.color,1,1,1);n.diffuse.intensity=l.global.diffuse;var k=p.clamp((Math.abs(z)-l.local.altitude)/(l.global.altitude-l.local.altitude),0,1);n.globalFactor=k;z=f.SunCalc.getTimes(t,h[1],h[0]);if(1>k){{var v=t.valueOf();if(z.polarException===f.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN){var x=v-36E5*(t.getHours()+48)-6E4*t.getMinutes();
var C=x+432E6}else z.polarException===f.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(x=v-2,C=v-1):(x=z.sunrise.valueOf(),C=z.sunset.valueOf());var A=C-x;var B=x+A/2;var D=A/4;var E=B-D;D=B+D;var G=.06*A;A=x-G/2;x+=G/2;const K=C-G/2,M=C+G/2;C=l.local;const H=[.01,C.ambientAtNight],J=[.8,.8,1],O=[.01,.01,.01],I=[C.diffuseAtTwilight,C.ambientAtTwilight],F=[1,.75,.75],L=[.8,.8,1],N=[.9*C.diffuseAtNoon,C.ambientAtNoon],R=[1,.98,.98],S=[.98,.98,1],P=[C.diffuseAtNoon,C.ambientAtNoon],Q=[1,1,1],V=[1,1,1];C=[0,0];
let ca=[0,0,0];G=[0,0,0];v<A||v>M?(C=H,ca=O,G=J):v<x?(G=x-A,C=e(v-A,G,H,I),ca=e(v-A,G,O,F),G=e(v-A,G,J,L)):v<E?(G=E-x,C=e(v-x,G,I,N),ca=e(v-x,G,F,R),G=e(v-x,G,L,S)):v<B?(G=B-E,C=e(v-E,G,N,P),ca=e(v-E,G,R,Q),G=e(v-E,G,S,V)):v<D?(G=D-B,C=e(v-B,G,P,N),ca=e(v-B,G,Q,R),G=e(v-B,G,V,S)):v<K?(G=K-D,C=e(v-D,G,N,I),ca=e(v-D,G,R,F),G=e(v-D,G,S,L)):v<M&&(G=M-K,C=e(v-K,G,I,H),ca=e(v-K,G,F,O),G=e(v-K,G,L,J));v=C[0];B=y.fromValues(ca[0],ca[1],ca[2]);E=C[1];D=y.fromValues(G[0],G[1],G[2])}q.lerp(n.ambient.color,D,
n.ambient.color,k);n.ambient.intensity=p.lerp(E,n.ambient.intensity,k);q.lerp(n.diffuse.color,B,n.diffuse.color,k);n.diffuse.intensity=p.lerp(v,n.diffuse.intensity,k)}k=t.valueOf();z.polarException===f.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(v=k-36E5*(t.getHours()+48)-6E4*t.getMinutes(),z=v+432E6):z.polarException===f.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(v=k-2,z=k-1):(v=z.sunrise.valueOf(),z=z.sunset.valueOf());z=1-p.clamp(Math.abs(k-(v+(z-v)/2))/432E5,0,1);n.noonFactor=z;w(t,h,m,n.diffuse.directionToLightSource)};
a.computeDirectionsOverTime=function(t,h,m,n,z){t=t.getTime();h=h.getTime()-t;h=Math.floor(h/m)+1;const k=Array(h);for(let v=0;v<h;++v)u.setTime(t+m*v),k[v]=y.create(),w(u,n,z,k[v]);return k};a.computeShadowsEnabled=function(t,h){return 1===h?!0:Math.abs(t)<l.planarDirection.localAltitude};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/SunCalc":function(){define(["exports"],function(a){var p={exports:{}};(function(b){(function(r){r=r();void 0!==r&&(b.exports=r)})(function(){function r(B){return new Date(864E5*
(B+.5-2440588))}function q(B,D){return n(u(B)*t(x)-h(D)*u(x),t(B))}function y(B,D){return m(u(D)*t(x)+t(D)*u(x)*u(B))}function f(B,D,E){return n(u(B),t(B)*u(D)-h(E)*t(D))}function w(B,D,E){return m(u(D)*u(E)+t(D)*t(E)*t(B))}function e(B){return k*(1.9148*u(B)+.02*u(2*B)+3E-4*u(3*B))}function l(B,D){B=k*(357.5291+.98560028*B);var E=e(B);B=B+E+102.9372*k+c;D||(D={dec:0,ra:0});D.dec=y(B,0);D.ra=q(B,0);return D}function g(B,D,E){return 2451545+B+.0053*u(D)-.0069*u(2*E)}function d(B){var D=k*(134.963+
13.064993*B),E=k*(93.272+13.22935*B);B=k*(218.316+13.176396*B)+6.289*k*u(D);E=5.128*k*u(E);D=385001-20905*t(D);return{ra:q(B,E),dec:y(B,E),dist:D}}var c=Math.PI,u=Math.sin,t=Math.cos,h=Math.tan,m=Math.asin,n=Math.atan2,z=Math.acos,k=c/180,v={dec:0,ra:0},x=23.4397*k,C={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(B,D,E,G){E=k*-E;D*=k;var K=B.valueOf()/864E5-.5+2440588-2451545;B=l(K,v);E=k*(280.16+360.9856235*K)-E-B.ra;G||(G={azimuth:0,altitude:0});G.azimuth=f(E,D,B.dec);
G.altitude=w(E,D,B.dec);return G}},A=[[-.83,"sunrise","sunset"]];C.addTime=function(B,D,E){A.push([B,D,E])};C.getTimes=function(B,D,E){function G(S){var P=M,Q=I;S=z((u(S)-u(P)*u(Q))/(t(P)*t(Q)));return g(9E-4+(S+K)/(2*c)+H,J,O)}var K=k*-E,M=k*D,H=Math.round(B.valueOf()/864E5-.5+2440588-2451545-9E-4-K/(2*c));B=9E-4+(0+K)/(2*c)+H;var J=k*(357.5291+.98560028*B);D=e(J);var O=J+D+102.9372*k+c,I=y(O,0);B=g(B,J,O);D={solarNoon:r(B),nadir:r(B-.5),polarException:C.POLAR_EXCEPTION.NORMAL};var F;E=0;for(F=A.length;E<
F;E+=1){var L=A[E];var N=G(L[0]*k);var R=B-(N-B);D[L[1]]=r(R);D[L[2]]=r(N)}D.polarException=function(S){S=(u(S)-u(M)*u(I))/(t(M)*t(I));return-1>S?C.POLAR_EXCEPTION.MIDNIGHT_SUN:1<S?C.POLAR_EXCEPTION.POLAR_NIGHT:C.POLAR_EXCEPTION.NORMAL}(A[0][0]*k);return D};C.getMoonPosition=function(B,D,E){E=k*-E;D*=k;var G=B.valueOf()/864E5-.5+2440588-2451545;B=d(G);E=k*(280.16+360.9856235*G)-E-B.ra;G=w(E,D,B.dec);G+=.017*k/h(G+10.26*k/(G+5.1*k));return{azimuth:f(E,D,B.dec),altitude:G,distance:B.dist}};C.getMoonFraction=
function(B){var D=B.valueOf()/864E5-.5+2440588-2451545;B=l(D);D=d(D);B=z(u(B.dec)*u(D.dec)+t(B.dec)*t(D.dec)*t(B.ra-D.ra));B=n(149598E3*u(B),D.dist-149598E3*t(B));return(1+t(B))/2};return C})})(p);a.SunCalc=p.exports})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/vec3f64"],function(a,p){a.AmbientLight=function(b=p.create()){this.intensity=b};a.FillLight=function(b=p.create(),r=p.fromValues(.57735,.57735,.57735)){this.intensity=b;this.direction=
r};a.MainLight=function(b=p.create(),r=p.fromValues(.57735,.57735,.57735),q=!0){this.intensity=b;this.direction=r;this.castShadows=q};a.SphericalHarmonicsAmbientLight=function(){this.r=[0];this.g=[0];this.b=[0]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K){b=function(H){function J(){var I=H.apply(this,arguments)||this;I._handles=new r;return I}a._inheritsLoose(J,H);var O=J.prototype;O.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};O.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};O.connect=function(){const I=
this.view;this._source=new x.BrowserEventSource(this.view.surface,I.input);var F=[new D.ImmediateDoubleClick,new E.PointerClickHoldAndDrag,new G.SingleAndDoubleClick,new B.Drag(this.view.navigation),new K.VerticalTwoFingerDrag];this._inputManager=F=new C.InputManager({eventSource:this._source,recognizers:F});F.installHandlers("prevent-context-menu",[new A.PreventContextMenu],C.ViewEventPriorities.INTERNAL);this._modeDragPan=new m.PinchAndPanNavigation(I,"primary");this._modeDragRotate=new d.DragRotate(I,
"secondary",0);this._modeDragZoom=new c.DragZoom(I,"tertiary");F.installHandlers("navigation",[new n.PointerDownCancelAnimation(I),new g.DoubleClickZoom(I),new u.GamepadNavigation(I),new t.KeyboardNavigation(I,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new h.MouseWheelZoom(I),new k.SingleKeyResetTilt(I,"p"),new z.SingleKeyResetHeading(I,"n"),new d.DragRotate(I,"primary",
1,["b"]),new d.DragRotate(I,"secondary",0,["b"]),new m.PinchAndPanNavigation(I,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new v.TwoFingerTilt(I)],C.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(F);this._updateMode();q.init(this.view.navigation,"browserTouchPanEnabled",L=>{this._source.browserTouchPanningEnabled=!L})};O._updateMode=function(){var I=this.primaryDragAction;I=M.get(this.mode).get(I);this._modeDragPan&&(this._modeDragPan.pointerAction=I.pan);
this._modeDragRotate&&(this._modeDragRotate.pointerAction=I.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=I.zoom)};a._createClass(J,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(I){"pan"!==I&&"rotate"!==I||I===this._get("primaryDragAction")||(this._set("primaryDragAction",I),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},set:function(I){"default"!==I&&"pro"!==I||I===this._get("mode")||(this._set("mode",I),this._updateMode())}},
{key:"test",get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}}]);return J}(b);p.__decorate([y.property()],b.prototype,"view",void 0);p.__decorate([y.property({value:"pan"})],b.prototype,"primaryDragAction",null);p.__decorate([y.property({value:"default"})],b.prototype,"mode",null);p.__decorate([y.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],b.prototype,"hasPendingInputs",void 0);
p.__decorate([y.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],b.prototype,"latestPointerType",void 0);p.__decorate([y.property()],b.prototype,"_inputManager",void 0);b=p.__decorate([l.subclass("esri.views.3d.input.SceneInputManager")],b);const M=new Map;p=new Map;y=new Map;p.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});p.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});y.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});y.set("rotate",
{pan:"tertiary",rotate:"primary",zoom:"secondary"});M.set("default",p);M.set("pro",y);return b})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,p,b,r,q,y,f){y=function(w){function e(l,g){var d=w.call(this,!0)||this;d.view=
l;d.registerIncoming("double-click",g,c=>d.handleDoubleClick(c));return d}p._inheritsLoose(e,w);e.prototype.handleDoubleClick=function(l){const g=l.data;if(f.eventMatchesPointerAction(g,"primary")){const d=this.view.state.isGlobal?new r.ZoomStepController({view:this.view,mode:"animation"}):new q.ZoomStepController({view:this.view,mode:"animation"});this.view.state.switchCameraController(d);d.zoomStep(Math.log(.5)/Math.log(.6),b.createScreenPointArray(g.x,g.y));l.stopPropagation()}};return e}(y.InputHandler);
a.DoubleClickZoom=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/time ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../chunks/sphere ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x){a.ZoomStepController=function(A){function B(){var E=A.apply(this,arguments)||this;E.zoomLocation=g.create();E.tmpCamera=new z;E.tmpViewDir=g.create();E.tmpRayDir={origin:g.create(),direction:g.create()};E.targetOnSphere=g.create();E.tmpCenter=g.create();E.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new z,interactionDirection:null,tiltMode:0};E.sphere=c.create();return E}p._inheritsLoose(B,A);var D=
B.prototype;D.initialize=function(){this.intersector=new k.Intersector(this.view.state.viewingMode)};D.zoomStep=function(E,G){if(this.active){var K=this.view.state,{interactionStartCamera:M}=this.constraintOptions;this.animation.finished?M.copyFrom(K.camera):this.animation.cameraAt(1,M);var H=M=!1;this.intersectionHelper.intersectScreen(G,this.zoomLocation)&&(M=0<E?!0:!1,H=!0);this.tmpCamera.copyFrom(K.camera);M?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&
(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:l.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,E,this.zoomLocation,G,H);this.begin(this.tmpCamera)}};D.animationSettings=function(){return{apex:null,duration:q.Milliseconds(600),easing:v.outExpo}};D.updateCamera=function(E,G,K,M,H){var J=d.getReferenceEllipsoid(this.view.spatialReference);if(h.decideNavigationMode(E,
M,H,J)===h.NavigationMode.Horizontal||r("disable-feature:context-navigation")){G=.6**G;this.sphere[3]=l.length(K);l.subtract(this.tmpViewDir,E.center,E.eye);H=l.length(this.tmpViewDir);J=H*G;1>=G&&4>J&&(J=4,G=J/H);if(1E-6>Math.abs(H-J))return;H=l.length(E.center);this.sphere[3]!==H&&(E.center=l.scale(C,E.center,(this.sphere[3]+G*(H-this.sphere[3]))/H));l.scale(this.tmpViewDir,this.tmpViewDir,-G);E.eye=l.add(C,E.center,this.tmpViewDir);u.applyAll(this.view,E,this.constraintOptions);1E-12<l.squaredDistance(K,
E.center)&&n.intersectScreen(this.sphere,E,M,this.targetOnSphere)&&h.panToPosition(this.sphere,E,K,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{H=.6**Math.abs(G);J=0<G?1:-1;m.fromScreenAtEye(E,M,this.tmpRayDir);l.normalize(this.tmpRayDir.direction,this.tmpRayDir.direction);var O;this.view.camera.position.hasZ&&(O=Math.abs(this.view.camera.position.z));O=Math.max(12*O,20);M=this.view._stage.renderView.getMinimalDepthForArea(M[0],M[1],this.view.state.camera,60);O=O>M?
M:O;l.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,O);l.add(K,this.tmpRayDir.origin,this.tmpRayDir.direction);K=O*H;0<G&&4>K&&(K=4,H=K/O);if(1E-6>Math.abs(O-K))return;l.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,J*(1-H));E.eye=l.add(C,E.eye,this.tmpRayDir.direction);E.center=l.add(C,E.center,this.tmpRayDir.direction)}x.applySurfaceCollisionConstraint(this.view,E)};return B}(t.PointToPointAnimationController);a.ZoomStepController=b.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],
a.ZoomStepController);const C=g.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ../../../chunks/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),function(a,p,b,r,q,y,f,w){const e=[{type:1,error:function(g,d,c){return f.getTiltConstraintError(g,d,c)*d.distance},apply:f.applyTiltConstraint},{type:2,
error:b.getAltitudeConstraintError,apply:b.applyAltitudeConstraint},{type:4,error:q.getDistanceConstraintError,apply:q.applyDistanceConstraint}],l={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};a.applyAltitudeConstraint=b.applyAltitudeConstraint;a.getAltitudeConstraintError=b.getAltitudeConstraintError;a.applyDistanceConstraint=q.applyDistanceConstraint;a.getDistanceConstraintError=q.getDistanceConstraintError;a.applySurfaceCollisionConstraint=
y.applySurfaceCollisionConstraint;a.applyTiltConstraint=f.applyTiltConstraint;a.getTiltConstraintError=f.getTiltConstraintError;a.applyAll=function(g,d,c=l,u=d){let t=!1;u!==d&&u.copyFrom(d);u.computeUp(g.state.viewingMode);for(d=0;5>d;d++){let m=0;for(var h of e)if(r.hasConstraintType(c.selection,h.type)){const n=Math.abs(h.error(g,u,c));h.apply(g,u,c)&&(t=!0,m+=n)}if(0===m)break}h=r.hasConstraintType(c.selection,8);a:switch(c.interactionType){case 4:c=1;break a;case 5:c=g.state.isGlobal?2:1;break a;
default:c=0}h&&y.applySurfaceCollisionConstraint(g,u,c)&&(t=!0);t&&u.computeUp(g.state.viewingMode);return t};a.pixelDistanceToInteractionFactor=function(g,d){g="number"===typeof g?g:p.distance(g,d);return w.inOutCubic(Math.min(1,g/150))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ../../support/intersectionUtils".split(" "),
function(a,p,b,r,q,y,f,w){function e(h,m,n=f.defaultApplyOptions){var z=h.state.constraints.altitude;z=h.state.isGlobal&&z?2===n.interactionType&&f.hasConstraintType(n.selection,1)?!1:!0:!1;if(!z)return 0;var k=h.state.constraints.altitude;z=g;z.min=k.min;z.max=k.max;k=n.interactionType;if(0!==k){var {min:v,max:x}=z,{interactionStartCamera:C,interactionFactor:A}=n;n=2===k||1===k;k=e(h,C);var B=0===k?0:h.renderCoordsHelper.getAltitude(C.eye);z.min=v;z.max=x;f.adjustRangeForInteraction(k,B,n,A,.05*
B,z)}h=h.renderCoordsHelper.getAltitude(m.eye);h=p.clamp(h,z.min,z.max)-h;return 1E-6>=Math.abs(h)?0:h}function l(h,m,n,z){h.renderCoordsHelper.worldUpAtPosition(m.eye,z);r.scale(z,z,n);return z}const g={min:0,max:0},d=q.create(),c=q.create(),u=q.create(),t=q.create();a.applyAltitudeConstraint=function(h,m,n=f.defaultApplyOptions){const z=e(h,m,n);if(0===z)return!1;const k=h.renderCoordsHelper,v=k.getAltitude(m.eye)+z;n=f.interactionDirectionTowardsConstraintMinimization(m,n.interactionDirection,
l(h,m,p.sign(z),c),d);h=r.copy(u,m.viewForward);n=k.intersectInfiniteManifold(y.wrap(m.eye,n),v,t);m.eye=b.isSome(n)?n:k.setAltitude(t,v,m.eye);m.center=w.closestPointOnRay(t,m.eye,h,m.center);return!0};a.getAltitudeConstraintError=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3"],function(a,p,b){a.adjustRangeForInteraction=function(r,q,y,f,w,e){0!==r&&(y?(e.min=Math.min(e.min,
q),e.max=Math.max(e.max,q)):null!=f?(e.min-=Math.max(0,(q-e.min)*(1-f)),e.max+=Math.max(0,(q-e.max)*(1-f))):w&&(e.min-=Math.max(0,q-e.min-w),e.max+=Math.max(0,q-e.max-w)))};a.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};a.hasConstraintType=function(r,q){return 0!==(r&q)};a.interactionDirectionTowardsConstraintMinimization=function(r,q,y,f){q=q||r.viewForward;b.copy(f,q);b.scale(f,f,p.sign(b.dot(q,y)));return f};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec2f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/plane"],function(a,p,b,r,q){function y(e,l,g,d){const c=w;e?(g&&d&&(c.len=b.distance(l,g)),b.copy(c.dir,e)):d?(c.len=b.distance(l,g),b.subtract(c.dir,g,l),b.scale(c.dir,c.dir,1/c.len)):(b.subtract(c.dir,g,l),b.normalize(c.dir,c.dir));return c}function f(e,l,g,d){d.clip[0]=0;d.clip[1]=
g?d.len:Number.MAX_VALUE;for(g=0;g<e.length;g++){{var c=e[g],u=l;var t=d;const h=b.dot(q.normal(c),t.dir);c=-q.signedDistance(c,u);0>c&&0<=h?t=!1:-1E-6<h&&1E-6>h?t=0<c:!(0>c||0>h)||0>c&&0>h?(c/=h,0<h?c<t.clip[1]&&(t.clip[1]=c):c>t.clip[0]&&(t.clip[0]=c),t=t.clip[0]<=t.clip[1]):t=!0}if(!t)return!1}return!0}const w={dir:r.create(),len:0,clip:p.create()};a.closestPointOnRay=function(e,l,g,d){d=b.dot(g,b.subtract(e,d,l));return b.add(e,l,b.scale(e,g,d))};a.frustumLineSegment=function(e,l,g,d){d=y(d,l,
g,!0);return f(e,l,g,d)};a.frustumPoint=function(e,l){for(let g=0;6>g;g++)if(0<q.signedDistance(e[g],l))return!1;return!0};a.frustumRay=function(e,l,g,d){g=y(d,l,g,!1);return f(e,l,null,g)};a.frustumSphere=function(e,l,g){const d=l[0],c=l[1];l=l[2];return e[0][0]*d+e[0][1]*c+e[0][2]*l+e[0][3]>g||e[1][0]*d+e[1][1]*c+e[1][2]*l+e[1][3]>g||e[2][0]*d+e[2][1]*c+e[2][2]*l+e[2][3]>g||e[3][0]*d+e[3][1]*c+e[3][2]*l+e[3][3]>g||e[4][0]*d+e[4][1]*c+e[4][2]*l+e[4][3]>g||e[5][0]*d+e[5][1]*c+e[5][2]*l+e[5][3]>g?
!1:!0};a.planeSphere=function(e,l,g){return e[0]*l[0]+e[1]*l[1]+e[2]*l[2]+e[3]<g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common".split(" "),function(a,p,b,r,q,y,f){function w(t,h,m=f.defaultApplyOptions){if(!t.state.isLocal)return 0;var n=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||
Infinity===n)return 0;e.min=0;e.max=n;n=e;var z=m.interactionType;if(0!==z){var {min:k,max:v}=n,{interactionStartCamera:x,interactionFactor:C}=m;m=1===z||4===z;z=w(t,x);var A=0===z?0:b.distance(x.eye,t.pointsOfInterest.surfaceOrigin.renderLocation);n.min=k;n.max=v;f.adjustRangeForInteraction(z,A,m,C,.05*A,n)}t=b.distance(h.eye,t.pointsOfInterest.surfaceOrigin.renderLocation);t=e.max-t;return-1E-6<=t?0:t}const e={min:0,max:0},l=r.create(),g=r.create(),d=r.create(),c=r.create(),u=r.create();a.applyDistanceConstraint=
function(t,h,m=f.defaultApplyOptions){var n=w(t,h,m);if(0===n)return!1;var z=t.pointsOfInterest.surfaceOrigin;n=b.distance(h.eye,t.pointsOfInterest.surfaceOrigin.renderLocation)+n;const k=b.copy(l,h.eye);m=f.interactionDirectionTowardsConstraintMinimization(h,m.interactionDirection,b.direction(c,h.eye,t.pointsOfInterest.surfaceOrigin.renderLocation),d);if(!y.intersectRay(y.fromCenterAndRadius(z.renderLocation,n),q.wrap(h.eye,m),u))return!1;h.eye=u;z=b.subtract(g,h.eye,k);h.center=b.add(u,h.center,
z);z=t.renderCoordsHelper.getAltitude(h.center);t=t.renderCoordsHelper.intersectInfiniteManifold(h.ray,z,u);p.isSome(t)&&(h.center=t);return!0};a.getDistanceConstraintError=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(a,p,b,r){const q=b.create(),y=b.create();a.applySurfaceCollisionConstraint=function(f,w,e=0){var l=f.state.constraints;
if(!l.collision.enabled)return!1;var g=r.surfaceElevationBelowRenderLocation(f,w.eye);const d=f.renderCoordsHelper.getAltitude(w.eye);l=g+l.collision.elevationMargin;if(d>=l)return!1;g=p.length(w.eye);p.subtract(q,w.center,w.eye);w.eye=f.renderCoordsHelper.setAltitude(y,l,w.eye);1===e?w.center=p.add(q,w.eye,q):2===e&&(w.center=p.scale(q,w.center,(g-d+l)/g));return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),
function(a,p,b,r,q,y,f){function w(t,h){return t.elevationProvider?p.unwrapOr(t.elevationProvider.getElevation(h[0],h[1],h[2],t.renderCoordsHelper.spatialReference,"ground"),0):0}function e(t,h,m){if(!t.state.isGlobal)return!1;const n=w(t,h);({far:t}=t.stateManager.constraintsManager.nearFarHeuristic.compute(h,m,t.renderDataExtent,n,u));t*=t;return b.squaredDistance(h,m)>t}const l={},g=r.create(),d=r.create(),c=r.create(),u={near:0,far:0};a.cameraOnContentAlongViewDirection=function(t,h,m,n){const z=
t.state.camera.clone();h&&(z.eye=h,z.center=m,z.up=n);h=z.ray;m=l[t.viewingMode];m||(m=new f.Intersector(t.state.viewingMode),m.options.backfacesTerrain=!t.state.isGlobal,m.options.invisibleTerrain=!0,l[t.viewingMode]=m);({isGlobal:n}=t.state);t.sceneIntersectionHelper.intersectRay(h,m,d)&&!e(t,h.origin,d)?h=!0:!t.renderCoordsHelper.intersectManifold(h,0,d)||e(t,h.origin,d)?n?(m=q.getReferenceEllipsoid(t.spatialReference).radius,m=b.dot(h.origin,h.origin)-m*m,b.scale(d,h.direction,(0<m?Math.sqrt(m)/
3:1)/b.length(h.direction)),b.add(d,d,h.origin),h=!0):h=!1:h=!0;h||b.copy(d,z.center);m=t.state.constraints;n=m.minimumPoiDistance;b.squaredDistance(z.eye,d)<n&&(h=m.collision.enabled,b.copy(c,z.viewForward),b.scale(c,c,n),h?z.eye=b.subtract(g,d,c):b.add(d,z.eye,c),t=t.renderCoordsHelper,n=t.getAltitude(z.eye),m=m.collision.elevationMargin,h&&n<m&&(b.subtract(c,d,z.eye),z.eye=t.setAltitude(g,m,z.eye),b.add(d,z.eye,c)));z.center=d;return z};a.eyeWithinExtent=function(t,h,m,n){return p.isSome(t.renderCoordsHelper.fromRenderCoords(h.eye,
g,n))&&y.containsPoint(m,g)};a.surfaceElevationBelowRenderLocation=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./IntersectorInterfaces ./intersectorUtils ./verticalOffsetUtils ../materials/renderers/utils".split(" "),function(a,
p,b,r,q,y,f,w,e,l,g,d){b=function(){function c(t){this.options=new e.IntersectorOptions;this.results=new l.IntersectorResults;this.transform=new g.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this.verticalOffset=null;this._ray={origin:f.create(),direction:f.create()};this._rayEndPoint=f.create();this._rayStartPointTransformed=f.create();this._rayEndPointTransformed=f.create();this.viewingMode=null==t?1:t}var u=c.prototype;u.reset=function(t,h){this.resetWithRay(w.fromPoints(t,
h,this._ray))};u.resetWithRay=function(t){t!==this._ray&&w.copy(t,this._ray);0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;y.add(this._rayEndPoint,this._ray.origin,this._ray.direction);this._numObjectsTested=0;this.results.init(this._ray)};u.intersect=function(t=null,h,m,n,z,k){this.point=h;this.camera=m;this.filterPredicate=z;this.tolerance=null==n?1E-5:n;h=g.getVerticalOffsetObject3D(this.verticalOffset);
if(r.isSome(t)&&0<t.length){const v=k?x=>{k(x)&&this.intersectObject(x)}:x=>{this.intersectObject(x)};for(const x of t)t=x.getSpatialQueryAccelerator&&x.getSpatialQueryAccelerator(),r.isSome(t)?(r.isSome(h)?t.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,v,h):t.forEachAlongRay(this._ray.origin,this._ray.direction,v),this.options.selectionMode&&this.options.hud&&t.forEachDegenerateObject(v)):x.objects.forAll(C=>v(C))}this.sortResults()};u.intersectObject=function(t){this._numObjectsTested++;
const h=t.geometryRecords;if(h){var m=t.id,n=t.transformation,z=g.getVerticalOffsetObject3D(this.verticalOffset);for(const v of h){const {geometry:x,material:C,instanceParameters:A}=v;if(d.isInstanceHidden(A))continue;var k=x.id;this.transform.setAndInvalidateLazyTransforms(n,v.getShaderTransformation());y.transformMat4(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse);y.transformMat4(this._rayEndPointTransformed,this._rayEndPoint,this.transform.inverse);const B=this.transform.transform;
r.isSome(z)&&(z.objectTransform=this.transform);C.intersect(x,A,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,(D,E,G,K,M,H)=>{if(0<=D&&(!r.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEndPoint,D))){var J=`Object3D ${m}`;M?(null==this.results.hud.dist||D<this.results.hud.dist)&&this.results.hud.set(t,J,D,E,q.IDENTITY,K,H,k,G):((null==this.results.min.drapedLayerOrder||K>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||
D<this.results.min.dist)&&this.results.min.set(t,J,D,E,B,K,null,k,G),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||K<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||D>this.results.max.dist)&&this.results.max.set(t,J,D,E,B,K,null,k,G),2===this.options.store&&(M=new l.IntersectorResult(this._ray),M.set(t,J,D,E,B,K,null,k,G),this.results.all.push(M)))}},v.shaderTransformation)}}};u.sortResults=function(){this.results.all.sort((t,h)=>t.dist!==h.dist?t.dist-h.dist:
t.drapedLayerOrder!==h.drapedLayerOrder?(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==h.drapedLayerOrder?h.drapedLayerOrder:Number.MAX_VALUE):(void 0!==h.drapedLayerGraphicOrder?h.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE))};p._createClass(c,[{key:"ray",get:function(){return this._ray}},{key:"rayBeginPoint",get:function(){return this._ray.origin}},{key:"rayEndPoint",get:function(){return this._rayEndPoint}}]);
return c}();b.DEFAULT_TOLERANCE=1E-5;a.Intersector=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(a){a.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=2};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../chunks/boundedPlane ../../../../geometry/support/ray ./Object3D".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){let d=function(){function m(){this.min=new c;this.max=new c;this.hud=new c;this.ground=new c}m.prototype.init=function(n){this.min.init(n);this.max.init(n);this.hud.init(n);this.ground.init(n);this.all=[]};return m}(),c=function(){function m(z){this.normal=y.create();this.transformation=r.create();this._ray=l.create();this.init(z)}var n=m.prototype;n.getIntersectionPoint=function(z){if(!this.hasIntersectionPoint)return!1;q.scale(t,this.ray.direction,this.dist);q.add(z,
this.ray.origin,t);return!0};n.getTransformedNormal=function(z){q.copy(h,this.normal);h[3]=0;f.transformMat4(h,h,this.transformation);q.copy(z,h);q.normalize(z,z);return z};n.init=function(z){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";z?l.copy(z,this._ray):this._ray=l.create()};n.set=function(z,k,v,x,C,A,B,D,E,G){z instanceof g.Object3D&&(z={type:"stage",obj:z});this.dist=v;q.copy(this.normal,
x);b.copy(this.transformation,C);this.target=z;this.name=k;this.drapedLayerOrder=A;this.center=B?y.clone(B):null;this.geometryId=D;this.triangleNr=E;this.drapedLayerGraphicOrder=G};n.copyFrom=function(z){l.copy(z.ray,this._ray);this.dist=z.dist;this.target=z.target;this.name=z.name;this.drapedLayerOrder=z.drapedLayerOrder;this.center=z.center?y.clone(z.center):null;this.geometryId=z.geometryId;this.triangleNr=z.triangleNr;this.intersector=z.intersector;this.drapedLayerGraphicOrder=z.drapedLayerGraphicOrder;
q.copy(this.normal,z.normal);b.copy(this.transformation,z.transformation)};p._createClass(m,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return q.scale(t,this.ray.direction,this.dist),q.length(t)}}]);return m}();const u=y.create(),t=y.create(),h=w.create();a.IntersectorResult=c;a.IntersectorResults=d;a.sliceFilterPredicate=function(m){return(n,z,k)=>{q.lerp(u,n,z,k);
return!e.extrusionContainsPoint(m,u)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./ContentObject ./GeometryRecord ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),function(a,p,b,r,q,y,f,
w,e,l,g,d,c,u){l=function(m){function n(k={}){var v=m.call(this)||this;v.type=1;v._geometryRecords=[];v._geometries=[];v._objectTransformation=q.create();v._bvObjectSpace=new h;v._bvWorldSpace=new h;v._bvDirty=!0;v._hasVolatileTransformation=!1;v._visible=!0;v.castShadow=null!=k.castShadow?k.castShadow:!0;v.metadata=k.metadata;v.metadata&&v.metadata.isElevationSource&&(v.metadata.lastValidElevationBB=new t);v.transformation=q.create();const {geometries:x,materials:C,transformations:A,origins:B}=k;
if(!Array.isArray(x))return p._assertThisInitialized(v);c.assert(C.length===x.length,"Object3D: materials don't match geometries");c.assert(A.length===x.length,"Object3D: transformations don't match geometries");v._geometryRecords.length=x.length;v._geometries.length=x.length;for(k=0;k<x.length;k++)v._geometries[k]=x[k],v._geometryRecords[k]=g.GeometryRecord.pool.acquire(x[k],C[k],q.clone(A[k]),{highlights:null,occludees:null,visible:!0},B&&B[k]);return v}p._inheritsLoose(n,m);var z=n.prototype;z.dispose=
function(){this._geometryRecords.length=0;this._geometries.length=0};z.getNumGeometryRecords=function(){return this._geometryRecords.length};z.getGeometryRecord=function(k){c.assert(0<=k&&k<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this._geometryRecords[k]};z.addGeometry=function(k,v,x,C,A,B){x=x?x:q.IDENTITY;this._geometries.push(k);k=g.GeometryRecord.pool.acquire(k,v,x,C||{highlights:null,occludees:null,visible:!0},A,B);this._geometryRecords.push(k);
this._hasVolatileTransformation=this._hasVolatileTransformation||b.isSome(k.shaderTransformation);this._emit("objectGeometryAdded",{object:this,record:k});this._invalidateBoundingVolume();return k};z.removeGeometry=function(k){const v=this._geometryRecords.splice(k,1)[0];this._hasVolatileTransformation=b.isSome(v.shaderTransformation)?this._geometryRecords.some(x=>b.isSome(x.shaderTransformation)):this._hasVolatileTransformation;v.dispose();this._geometries.splice(k,1);this._emit("objectGeometryRemoved",
{object:this,record:v});this._invalidateBoundingVolume();return v};z.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};z.geometryVertexAttrsUpdated=function(k){this._emit("vertexAttrsUpdated",{object:this,record:this._geometryRecords[k]});this._invalidateBoundingVolume()};z.setVisible=function(k){this._visible=k;for(const v of this._geometryRecords)v.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)};z.maskOccludee=function(){const k=
new d.Object3DStateID(1);for(const v of this._geometryRecords)v.instanceParameters.occludees=u.addObject3DStateID(v.instanceParameters.occludees,k);this._emit("occlusionChanged",this);return k};z.removeOcclude=function(k){for(const v of this._geometryRecords)v.instanceParameters.occludees=u.removeObject3DStateID(v.instanceParameters.occludees,k);this._emit("occlusionChanged",this)};z.highlight=function(){const k=new d.Object3DStateID(0);for(const v of this._geometryRecords)v.instanceParameters.highlights=
u.addObject3DStateID(v.instanceParameters.highlights,k);this._emit("highlightChanged",this);return k};z.removeHighlight=function(k){for(const v of this._geometryRecords)v.instanceParameters.highlights=u.removeObject3DStateID(v.instanceParameters.highlights,k);this._emit("highlightChanged",this)};z.getCombinedStaticTransformation=function(k,v){return r.multiply(b.unwrapOr(v,q.create()),this.transformation,k.getStaticTransformation())};z.getCombinedShaderTransformation=function(k,v){v=v||q.create();
r.multiply(v,this.transformation,k.getShaderTransformation());return v};z.hasVolativeTransformation=function(){return this._hasVolatileTransformation};z._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var k=0;k<this._geometryRecords.length;++k){var v=this._geometryRecords[k],x=this._geometries[k].boundingInfo;b.isSome(x)&&(this._calculateTransformedBoundingVolume(x,this._bvObjectSpace,v.getShaderTransformation()),
this._calculateTransformedBoundingVolume(x,this._bvWorldSpace,this.getCombinedShaderTransformation(v)))}y.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);y.lerp(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);k=f.create();v=f.create();x=e.maxScale(this.transformation);for(let D=0;D<this._geometryRecords.length;++D){var C=this._geometries[D].boundingInfo;if(!b.isNone(C)){var A=this._geometryRecords[D].getShaderTransformation(),B=e.maxScale(A);
y.transformMat4(k,C.getCenter(),A);A=y.distance(k,this._bvObjectSpace.bounds);C=C.getBSRadius()*B;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],A+C);y.transformMat4(v,k,this.transformation);B=y.distance(v,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],B+C*x)}}this._bvDirty=!1}};z._calculateTransformedBoundingVolume=function(k,v,x){const C=k.getBBMin();k=k.getBBMax();const A=f.clone(C),B=f.clone(k);y.transformMat4(A,A,x);y.transformMat4(B,
B,x);for(var D=0;3>D;++D)v.min[D]=Math.min(v.min[D],A[D],B[D]),v.max[D]=Math.max(v.max[D],A[D],B[D]);for(D=0;3>D;++D){y.copy(A,C);y.copy(B,k);A[D]=k[D];B[D]=C[D];y.transformMat4(A,A,x);y.transformMat4(B,B,x);for(let E=0;3>E;++E)v.min[E]=Math.min(v.min[E],A[E],B[E]),v.max[E]=Math.max(v.max[E],A[E],B[E])}};z._invalidateBoundingVolume=function(){this._bvDirty=!0;b.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)};z._emit=function(k,v){b.isSome(this._parentLayer)&&
this._parentLayer.events.emit(k,v)};p._createClass(n,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._objectTransformation},set:function(k){r.copy(this._objectTransformation,k);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(k){c.assert(null==this._parentLayer||null==k,"Object3D can only be added to a single Layer");
this._parentLayer=k}},{key:"isVisible",get:function(){return this._visible}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();return this._bvObjectSpace}},{key:"test",get:function(){const k=this;return{hasGeometry:v=>-1<k._geometries.indexOf(v),getGeometryIndex:v=>k._geometries.indexOf(v)}}}]);return n}(l.ContentObject);let t=function(){function m(){this.min=f.fromValues(Number.MAX_VALUE,
Number.MAX_VALUE,Number.MAX_VALUE);this.max=f.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}m.prototype.isEmpty=function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return m}(),h=function(m){function n(){var z=m.apply(this,arguments)||this;z.bounds=w.create();return z}p._inheritsLoose(n,m);n.prototype.init=function(){y.set(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);y.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);
w.clear(this.bounds)};return n}(t);a.Object3D=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/uid ../../../../chunks/vec3".split(" "),function(a,p,b,r,q,y){let f=function(){function w(){this._disposed=!1}var e=w.prototype;e.acquire=function(l,g,d,c,u,t){this.id=q.generateUID();this.geometry=l;this.material=
g;this.transformation=d;this.instanceParameters=c;this.origin=u;this._shaderTransformation=t;this._disposed=!1};e.release=function(){this._disposed=!1};e.dispose=function(){this._disposed=!0};e.getStaticTransformation=function(){return this.transformation};e.getShaderTransformation=function(){return b.isSome(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation};e.computeAttachmentOrigin=function(l){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,
l):this.geometry.computeAttachmentOrigin(l))?(y.transformMat4(l,l,this.getStaticTransformation()),!0):!1};p._createClass(w,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}}]);return w}();f.pool=new r(f);a.GeometryRecord=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,p){a.Object3DStateID=function(b){this.channel=
b;this.id=p.generateUID()};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../lib/doublePrecisionUtils ../../lib/Util".split(" "),function(a,p,b,r,q,y){const f=new Float64Array(3),w=new Float32Array(6),e=r.create();a.acquireMaterials=function(l,g){const d=new Map;d.set(0,g.acquire(l,0));d.set(1,g.acquire(l,7));d.set(4,g.acquire(l,
3));d.set(3,g.acquire(l,2));d.set(2,g.acquire(l,1));d.set(5,g.acquire(l,4));d.set(7,g.acquire(l,3));d.set(6,g.acquire(l,3));return d};a.addObject3DStateID=function(l,g){p.isNone(l)&&(l=[]);l.push(g);return l};a.calculateTransformRelativeToOrigin=function(l,g,d){const c=l.origin.vec3;y.setMatrixTranslation3(e,-c[0],-c[1],-c[2]);p.isSome(l.transformation)?b.multiply(g,e,l.transformation):b.copy(g,e);d&&(b.invert(d,g),b.transpose(d,d))};a.encodeDoubleVec3=function(l,g,d,c,u){f[0]=l.get(g,0);f[1]=l.get(g,
1);f[2]=l.get(g,2);q.encodeDoubleArray(f,w,3);d.set(u,0,w[0]);c.set(u,0,w[1]);d.set(u,1,w[2]);c.set(u,1,w[3]);d.set(u,2,w[4]);c.set(u,2,w[5])};a.isInstanceHidden=function(l){return p.isSome(l)?!l.visible:!1};a.releaseMaterials=function(l,g){g.release(l,0);g.release(l,7);g.release(l,3);g.release(l,2);g.release(l,1);g.release(l,4)};a.removeObject3DStateID=function(l,g){if(p.isNone(l))return l;l=l.filter(d=>d!==g);return 0===l.length?null:l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["exports"],
function(a){function p(q,y,f){for(let w=0;w<f;++w)y[2*w]=q[w],y[2*w+1]=q[w]-y[2*w]}const b=new Float64Array(1),r=new Float32Array(2);a.decodeDoubleArray=function(q,y,f){for(let w=0;w<f;++w)y[w]=q[2*w]+q[2*w+1]};a.encodeDouble=function(q,y){r[0]=q;r[1]=q-r[0];y[0]=r[0];y[1]=r[1]};a.encodeDoubleArray=p;a.encodeDoubleArraySplit=function(q,y,f,w){for(let e=0;e<w;++e)b[0]=q[e],p(b,r,1),y[e]=r[0],f[e]=r[1]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../chunks/sphere".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){let t=function(){function A(){this._transform=f.create();this._transformInverse=new h({value:this._transform},y.invert,f.create);this._transformInverseTranspose=new h(this._transformInverse,y.transpose,f.create);this._transformTranspose=new h({value:this._transform},y.transpose,f.create);this._transformInverseRotation=new h({value:this._transform},r.normalFromMat4Legacy,q.create)}var B=A.prototype;B.invalidateLazyTransforms=function(){this._transformInverse.invalidate();
this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};B.setTransformMatrix=function(D){y.copy(this._transform,D)};B.multiplyTransform=function(D){y.multiply(this._transform,this._transform,D)};B.set=function(D){y.copy(this._transform,D);this.invalidateLazyTransforms()};B.setAndInvalidateLazyTransforms=function(D,E){this.setTransformMatrix(D);this.multiplyTransform(E);this.invalidateLazyTransforms()};p._createClass(A,[{key:"transform",
get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return A}(),h=function(){function A(B,D,E){this.original=B;this.update=D;this.dirty=!0;this.transform=E()}A.prototype.invalidate=function(){this.dirty=
!0};p._createClass(A,[{key:"value",get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform}}]);return A}(),m=function(){function A(D=0){this.offset=D;this.tmpVertex=d.create()}var B=A.prototype;B.applyToVertex=function(D,E,G){const K=D+this.localOrigin[0],M=E+this.localOrigin[1],H=G+this.localOrigin[2],J=this.offset/Math.sqrt(K*K+M*M+H*H);this.tmpVertex[0]=D+K*J;this.tmpVertex[1]=E+M*J;this.tmpVertex[2]=G+H*J;return this.tmpVertex};B.applyToAabb=
function(D){var E=D[0]+this.localOrigin[0];const G=D[1]+this.localOrigin[1],K=D[2]+this.localOrigin[2],M=D[3]+this.localOrigin[0],H=D[4]+this.localOrigin[1],J=D[5]+this.localOrigin[2],O=this.offset/Math.sqrt(E*E+G*G+K*K);D[0]+=E*O;D[1]+=G*O;D[2]+=K*O;E=this.offset/Math.sqrt(M*M+H*H+J*J);D[3]+=M*E;D[4]+=H*E;D[5]+=J*E;return D};return A}(),n=function(){function A(D=0){this.offset=D;this.componentLocalOriginLength=0;this.tmpVertex=d.create();this.mbs=c.create();this.obb={center:d.create(),halfSize:g.create(),
quaternion:null}}var B=A.prototype;B.applyToVertex=function(D,E,G){const K=G+this.componentLocalOriginLength,M=this.offset/Math.sqrt(D*D+E*E+K*K);this.tmpVertex[0]=D+D*M;this.tmpVertex[1]=E+E*M;this.tmpVertex[2]=G+K*M;return this.tmpVertex};B.applyToAabb=function(D){var E=D[0];const G=D[1],K=D[2]+this.componentLocalOriginLength,M=D[3],H=D[4],J=D[5]+this.componentLocalOriginLength,O=this.offset/Math.sqrt(E*E+G*G+K*K);D[0]+=E*O;D[1]+=G*O;D[2]+=K*O;E=this.offset/Math.sqrt(M*M+H*H+J*J);D[3]+=M*E;D[4]+=
H*E;D[5]+=J*E;return D};B.applyToMbs=function(D){const E=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]),G=this.offset/E;this.mbs[0]=D[0]+D[0]*G;this.mbs[1]=D[1]+D[1]*G;this.mbs[2]=D[2]+D[2]*G;this.mbs[3]=D[3]+D[3]*this.offset/E;return this.mbs};B.applyToObb=function(D){var E=D.center;const G=this.offset/Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);this.obb.center[0]=E[0]+E[0]*G;this.obb.center[1]=E[1]+E[1]*G;this.obb.center[2]=E[2]+E[2]*G;l.transformQuat(this.obb.halfSize,D.halfSize,D.quaternion);l.add(this.obb.halfSize,
this.obb.halfSize,D.center);E=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*E;this.obb.halfSize[1]+=this.obb.halfSize[1]*E;this.obb.halfSize[2]+=this.obb.halfSize[2]*E;l.subtract(this.obb.halfSize,this.obb.halfSize,D.center);w.conjugate(C,D.quaternion);l.transformQuat(this.obb.halfSize,this.obb.halfSize,C);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?-1:
1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=D.quaternion;return this.obb};p._createClass(A,[{key:"localOrigin",set:function(D){this.componentLocalOriginLength=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2])}}]);return A}(),z=function(){function A(D=0){this.offset=D;this.sphere=u.create();this.tmpVertex=d.create()}var B=A.prototype;B.applyToVertex=function(D,E,G){const K=this.objectTransform.transform;let M=K[0]*D+K[4]*E+K[8]*G+
K[12],H=K[1]*D+K[5]*E+K[9]*G+K[13];D=K[2]*D+K[6]*E+K[10]*G+K[14];E=this.offset/Math.sqrt(M*M+H*H+D*D);M+=M*E;H+=H*E;D+=D*E;E=this.objectTransform.inverse;this.tmpVertex[0]=E[0]*M+E[4]*H+E[8]*D+E[12];this.tmpVertex[1]=E[1]*M+E[5]*H+E[9]*D+E[13];this.tmpVertex[2]=E[2]*M+E[6]*H+E[10]*D+E[14];return this.tmpVertex};B.applyToMinMax=function(D,E){const G=this.offset/Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);D[0]+=D[0]*G;D[1]+=D[1]*G;D[2]+=D[2]*G;D=this.offset/Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);E[0]+=
E[0]*D;E[1]+=E[1]*D;E[2]+=E[2]*D};B.applyToAabb=function(D){var E=this.offset/Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);D[0]+=D[0]*E;D[1]+=D[1]*E;D[2]+=D[2]*E;E=this.offset/Math.sqrt(D[3]*D[3]+D[4]*D[4]+D[5]*D[5]);D[3]+=D[3]*E;D[4]+=D[4]*E;D[5]+=D[5]*E;return D};B.applyToBoundingSphere=function(D){const E=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]),G=this.offset/E;this.sphere[0]=D[0]+D[0]*G;this.sphere[1]=D[1]+D[1]*G;this.sphere[2]=D[2]+D[2]*G;this.sphere[3]=D[3]+D[3]*this.offset/E;return this.sphere};
return A}();const k=new z,v=new n,x=new m,C=e.create();a.I3SVerticalOffsetGlobalViewingMode=n;a.IntersectorTransform=t;a.Object3DVerticalOffsetGlobalViewingMode=z;a.TERRAIN_ID="terrain";a.TerrainVerticalOffsetGlobalViewingMode=m;a.getVerticalOffsetI3S=function(A){return b.isSome(A)?(v.offset=A,v):null};a.getVerticalOffsetObject3D=function(A){return b.isSome(A)?(k.offset=A,k):null};a.getVerticalOffsetTerrain=function(A){return b.isSome(A)?(x.offset=A,x):null};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../chunks/sphere ./common ../../state/utils/viewUtils".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d){function c(A,B,D=g.defaultApplyOptions,E=!0){C.eyeCenterDistance=0;C.requiresTwoSteps=!1;const G=
u(A,B,D,void 0,C);if(0===G)return!1;q.identity(n);q.rotate(n,n,-G,B.viewRight);switch(D.tiltMode){case 1:f.transformMat4(m,B.viewForward,n);f.scale(m,m,C.eyeCenterDistance);B.center=f.add(z,B.eye,m);break;case 0:f.subtract(m,B.center,B.eye);f.transformMat4(m,m,n);B.eye=f.subtract(z,B.center,m);break;default:p.neverReached(D.tiltMode)}B.up=f.transformMat4(z,B.up,n);return C.requiresTwoSteps&&E?c(A,B,D,!1):!0}function u(A,B,D=g.defaultApplyOptions,E=g.defaultApplyOptions,G){if(!A.state.constraints.tilt)return 0;
var K=A.state.constraints.tilt(B.distance,v);if(0!==D.interactionType){var {interactionStartCamera:M,interactionFactor:H}=D,{min:J,max:O}=K,I=u(A,M,g.defaultApplyOptions,D),F=0===I?0:d.viewAngle(A.renderCoordsHelper,M.center,M.eye);K.min=J;K.max=O;2===D.interactionType?(g.hasConstraintType(D.selection,2)&&h(A,M,K),g.adjustRangeForInteraction(I,F,!0,H,k,K)):g.adjustRangeForInteraction(I,F,!1,H,k,K)}2===E.interactionType&&g.hasConstraintType(E.selection,2)&&h(A,E.interactionStartCamera,K);if(1===D.tiltMode||
1===E.tiltMode){a:switch(G&&(G.requiresTwoSteps=!1),A.viewingMode){case "global":D=x;I=A.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;E=I+e.getReferenceEllipsoid(A.spatialReference).radius;I=A.renderCoordsHelper.intersectManifold(B.ray,I,z);D.eyeCenterDistance=B.distance;D.centerIsOnSurface=!1;r.isSome(I)?(D.eyeCenterDistance=f.distance(B.eye,I),D.tiltAtCenter=d.viewAngle(A.renderCoordsHelper,I,B.eye),D.centerIsOnSurface=!0):A.state.isLocal?D.tiltAtCenter=d.viewAngle(A.renderCoordsHelper,
B.center,B.eye):(l.closestPointOnSilhouette(l.fromRadius(E),B.ray,z),D.eyeCenterDistance=f.distance(B.eye,z),D.tiltAtCenter=b.acosClamped(-f.dot(B.viewForward,f.normalize(z,z))));D.radius=E;D.eyeRadius=f.length(B.eye);D.constraints=A.state.constraints;B=b.clamp(D.tiltAtCenter,K.min,K.max);if(1E-9<Math.abs(D.tiltAtCenter-B)){if(D.centerIsOnSurface){{const {constraints:L,eyeCenterDistance:N,tiltAtCenter:R}=D;B=R;A=L.clampTilt(N,R);K=t(D,A);if(L.clampTilt(K,R)!==A)for(K=0;10>K&&1E-9<Math.abs(A-B);)E=
(B+A)/2,I=t(D,E),I=L.clampTilt(I,E),1E-9<Math.abs(I-E)?B=E:A=E,K++;B=A}K=B;A=b.asinClamped(D.radius/D.eyeRadius*Math.sin(D.tiltAtCenter));K=b.asinClamped(D.radius/D.eyeRadius*Math.sin(K));A=D.eyeRadius>D.radius?A-K:K-A}else B=D.constraints.clampTilt(D.eyeCenterDistance,D.tiltAtCenter),G&&B<Math.PI/2&&(G.requiresTwoSteps=!0,B=Math.PI/2-1E-5),A=D.tiltAtCenter-Math.PI/2-(B-Math.PI/2);G&&(G.eyeCenterDistance=t(D,B));G=A}else G=0;break a;case "local":E=d.viewAngle(A.renderCoordsHelper,B.center,B.eye);
D=b.clamp(E,K.min,K.max);K=E-D;1E-9<Math.abs(K)?(G&&(E=A.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,A=A.renderCoordsHelper.getAltitude(B.eye)-E,D=Math.cos(D),G.eyeCenterDistance=1E-4<Math.abs(D)?A/D:B.distance),G=K):G=0;break a;default:p.neverReached(A.viewingMode),G=void 0}return G}G=d.viewAngle(A.renderCoordsHelper,B.center,B.eye);D=b.clamp(G,K.min,K.max);G-=D;G=1E-9<Math.abs(G)?G:0;return G}function t(A,B){if(!A.centerIsOnSurface)return A.eyeCenterDistance;B=Math.PI-b.clamp(B,
0,Math.PI);const D=b.asinClamped(A.radius/A.eyeRadius*Math.sin(B)),E=Math.sin(Math.PI-B-D)/Math.sin(B);return A.eyeRadius<A.radius&&1<E?Math.sin(Math.PI-B-(Math.PI-D))/Math.sin(B)*A.eyeRadius:E*A.eyeRadius}function h(A,B,D){if(!A.state.isLocal){var E=A.state.constraints;if(E.altitude){var G=f.squaredLength(B.center),K=Math.sqrt(G);B=B.distance;var M=e.getReferenceEllipsoid(A.spatialReference).radius;A=E.altitude.min+M;E=E.altitude.max+M;A=(A*A-B*B-G)/(-2*K*B);D.min=Math.max(D.min,Math.min(Math.PI-
b.acosClamped((E*E-B*B-G)/(-2*K*B)),D.max));D.max=Math.min(D.max,Math.PI-b.acosClamped(A))}}}const m=w.create(),n=y.create(),z=w.create(),k=b.deg2rad(5),v={min:0,max:0},x={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},C={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=c;a.getTiltConstraintError=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils",
"../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,p,b,r){const q=r.create(),y=r.create();a.viewAngle=function(f,w,e){f.worldUpAtPosition(w,q);b.subtract(y,e,w);f=b.length(y);return 0===f?0:p.acosClamped(b.dot(y,q)/f)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function p(R){return R}function b(R){const S=2*(R-Math.sqrt((R-1)*R)),P=S/2/R;return Q=>Q<P?R*Q*Q:S*Q-S+1}function r(R,S){return(P,Q)=>P<S?S*R(P/
S,Q):1-R((1-P)/(1-S),Q)*(1-S)}const q=R=>R*R,y=R=>1-q(1-R),f=R=>.5>R?q(2*R)/2:(1-q(1-2*(R-.5))+1)/2,w=R=>R*R*R,e=R=>1-w(1-R),l=R=>.5>R?w(2*R)/2:(1-w(1-2*(R-.5))+1)/2,g=R=>R*R*R*R,d=R=>1-g(1-R),c=R=>.5>R?g(2*R)/2:(1-g(1-2*(R-.5))+1)/2,u=R=>R*R*R*R*R,t=R=>1-u(1-R),h=R=>.5>R?u(2*R)/2:(1-u(1-2*(R-.5))+1)/2,m=R=>-Math.cos(R*Math.PI/2)+1,n=R=>1-m(1-R),z=R=>.5>R?m(2*R)/2:(1-m(1-2*(R-.5))+1)/2,k=R=>2**(10*(R-1)),v=R=>1-2**(10*(1-R-1)),x=R=>.5>R?2**(10*(2*R-1))/2:(1-2**(10*(1-2*(R-.5)-1))+1)/2,C=R=>-(Math.sqrt(1-
R*R)-1),A=R=>1-C(1-R),B=R=>.5>R?C(2*R)/2:(1-C(1-2*(R-.5))+1)/2,D=r(b(1),1),E=r(b(1),0),G=r(b(1),.5),K=r(b(2),1),M=r(b(2),0),H=r(b(2),.5),J=r(b(3),1),O=r(b(3),0),I=r(b(3),.5),F=r(b(4),1),L=r(b(4),0),N=r(b(4),.5);a.EasingFunctions={linear:p,"in-quad":q,"out-quad":y,"in-out-quad":f,"in-coast-quad":D,"out-coast-quad":E,"in-out-coast-quad":G,"in-cubic":w,"out-cubic":e,"in-out-cubic":l,"in-coast-cubic":K,"out-coast-cubic":M,"in-out-coast-cubic":H,"in-quart":g,"out-quart":d,"in-out-quart":c,"in-coast-quart":J,
"out-coast-quart":O,"in-out-coast-quart":I,"in-quint":u,"out-quint":t,"in-out-quint":h,"in-coast-quint":F,"out-coast-quint":L,"in-out-coast-quint":N,"in-sine":m,"out-sine":n,"in-out-sine":z,"in-expo":k,"out-expo":v,"in-out-expo":x,"in-circ":C,"out-circ":A,"in-out-circ":B};a.inCirc=C;a.inCoastCubic=K;a.inCoastQuad=D;a.inCoastQuart=J;a.inCoastQuint=F;a.inCubic=w;a.inExpo=k;a.inOutCirc=B;a.inOutCoastCubic=H;a.inOutCoastQuad=G;a.inOutCoastQuart=I;a.inOutCoastQuint=N;a.inOutCubic=l;a.inOutExpo=x;a.inOutQuad=
f;a.inOutQuart=c;a.inOutQuint=h;a.inOutSine=z;a.inQuad=q;a.inQuart=g;a.inQuint=u;a.inSine=m;a.linear=p;a.outCirc=A;a.outCoastCubic=M;a.outCoastQuad=E;a.outCoastQuart=O;a.outCoastQuint=L;a.outCubic=e;a.outExpo=v;a.outQuad=y;a.outQuart=d;a.outQuint=t;a.outSine=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){a.PointToPointAnimationController=function(n){function z(v){v=n.call(this,v)||this;v.view=null;v.mode="interaction";v.hasTarget=!1;return v}p._inheritsLoose(z,n);var k=z.prototype;k.initialize=function(){this.animation=new g.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new l};k.begin=function(v,x){this.hasTarget=!0;x=this.animationSettings(x);h.copyFrom(this.view.state.camera);const C=new u.Intersector(this.view.state.viewingMode);
this.intersectionHelper.intersectRay(h.ray,C,m)&&(h.center=m);this.animation.update(h,v,x);this.animation.finished&&this.finish()};k.finish=function(){this.animation.currentTime=this.animation.time;n.prototype.finish.call(this)};k.stepController=function(v,x){this.hasTarget&&this.animation.step(v,x)};k.onControllerEnd=function(v){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,v),this.animation.currentTime=this.animation.time);n.prototype.onControllerEnd.call(this,
v)};k.animationSettings=function(v={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...v,easing:"string"===typeof v.easing?t.EasingFunctions[v.easing]:v.easing}};p._createClass(z,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",get:function(){return this.hasTarget&&this.animation.finished}}]);
return z}(d.AnimationController);b.__decorate([r.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"view",void 0);b.__decorate([r.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);a.PointToPointAnimationController=b.__decorate([w.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const h=new c,m=e.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(a,p,b,r,q,y,f,w){const e=q.create();q=function(){function l(d){this.currentTime=b.Milliseconds(0);this._animation=new w.Animation(()=>new y(d));this._current=new y(d)}var g=l.prototype;g.update=function(d,c,u){const t=this._animation.definition.source,h=this._animation.definition.target,m=r.subtract(e,c.center,d.center),n=r.length(m);1E-5<=n?(m[0]/=n,m[1]/=n,m[2]/=n):(m[0]=0,m[1]=1,m[0]=0);r.copy(t.lookAtDirection,m);r.copy(h.lookAtDirection,m);t.copyFromRenderCamera(d);h.copyFromRenderCamera(c);
this._current.copyFrom(t);this._animation.update(t,h,u);this.currentTime=b.Milliseconds(0);d.almostEquals(c)&&(this.currentTime=this._animation.time)};g.cameraAt=function(d,c){this._animation.cameraAt(d,this._current);c=c||new f;this._current.copyToRenderCamera(c);return c};g.step=function(d,c){this.finished||(this.currentTime=b.Milliseconds(this.currentTime+b.MillisecondsFromSeconds(d)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,c)};
p._createClass(l,[{key:"finished",get:function(){return this.currentTime>=this._animation.time}},{key:"time",get:function(){return this._animation.time}}]);return l}();a.Animation=q;a["default"]=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/mathUtils".split(" "),function(a,p,b,r,q,y){const f=
q.create(),w=q.create(),e=q.create(),l=q.create(),g=q.create(),d=q.create();var c=q.fromValues(0,0,1),u=q.fromValues(0,1,0),t=q.fromValues(1,0,0);const h=b.create();return function(){function m(z=1){this.viewingMode=z;this.center=q.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=q.clone(u)}var n=m.prototype;n.pixelsPerPanAtZoom=function(z){return this.size/2/(this._zoomToPanScale*z)};n.zoomAtPixelsPerPan=function(z){return this.size/2/(this._zoomToPanScale*z)};n.pixelsPerRotateAtZoom=
function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};n.compareTo=function(z,k){k||(k={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(1===this.viewingMode){var v=r.length(this.center);const x=r.length(z.center);v=(v+x)/2;k.pan=y.angle(this.center,z.center)*v}else k.pan=r.distance(this.center,z.center);v=Math.abs(z.yaw-this.yaw);v>=Math.PI&&(v=2*Math.PI-v);k.rotate=Math.max(v,Math.abs(z.pitch-this.pitch));k.sourceZoom=this.distance;k.targetZoom=z.distance;return k};n.interpolate=
function(z,k,v){1===this.viewingMode?y.slerp(z.center,k.center,v.pan,this.center):r.lerp(this.center,z.center,k.center,v.pan);this.distance=a.lerp(z.distance,k.distance,v.zoom);this.pitch=a.lerp(z.pitch,k.pitch,v.rotate);z=z.yaw;k=k.yaw;Math.abs(k-z)>=Math.PI&&(z+=2*(z<k?1:-1)*Math.PI);this.yaw=a.lerp(z,k,v.rotate)};n.copyFrom=function(z){r.copy(this.center,z.center);this.pitch=z.pitch;this.yaw=z.yaw;this.distance=z.distance;r.copy(this.lookAtDirection,z.lookAtDirection);this.size=z.size;this.copyFromCommon(z);
this.viewingMode=z.viewingMode};n.copyFromRenderCamera=function(z){const k=this._lookAtOrientation(z.center,h);r.copy(this.center,z.center);r.subtract(l,z.center,z.eye);r.transformMat3(l,l,k);r.transformMat3(g,z.up,k);this.distance=r.length(l);l[0]/=this.distance;l[1]/=this.distance;l[2]/=this.distance;this.pitch=this._eyeUpToPitch(l);this.yaw=this._eyeUpToYaw(l,g);this.size=Math.sqrt(z.width*z.width+z.height*z.height);this.copyFromCommon(z)};n.copyFromCommon=function(z){this.fov=z.fov;this._zoomToPanScale=
Math.atan(.5*this.fov)};n.copyToRenderCamera=function(z){const k=this._lookAtOrientation(this.center,h);p.transpose(k,k);this._axisAngleVec3(t,this.pitch-Math.PI/2,u,l);this._axisAngleVec3(c,this.yaw,l);this._axisAngleVec3(t,this.pitch-Math.PI/2,c,g);this._axisAngleVec3(c,this.yaw,g);r.scale(l,l,this.distance);r.transformMat3(l,l,k);r.transformMat3(g,g,k);z.center=this.center;z.eye=r.subtract(l,this.center,l);z.up=g};n._axisAngleVec3=function(z,k,v,x=v){const C=Math.cos(k);k=Math.sin(k);r.scale(f,
v,C);r.cross(w,z,v);r.scale(w,w,k);r.scale(e,z,(1-C)*r.dot(z,v));return r.add(x,r.add(x,f,w),e)};n._lookAtOrientation=function(z,k=b.create()){this._upAtLookAt(z,e);r.cross(f,this.lookAtDirection,e);r.normalize(f,f);0===f[0]&&0===f[1]&&0===f[2]&&r.copy(f,t);r.cross(w,e,f);r.normalize(w,w);k[0]=f[0];k[1]=w[0];k[2]=e[0];k[3]=f[1];k[4]=w[1];k[5]=e[1];k[6]=f[2];k[7]=w[2];k[8]=e[2];return k};n._upAtLookAt=function(z,k){return 2===this.viewingMode?r.copy(k,c):r.normalize(k,z)};n._eyeUpToPitch=function(z){return Math.PI-
y.angle(c,z)};n._eyeUpToYaw=function(z,k){.5>Math.abs(k[2])?(r.copy(d,k),0<z[2]&&r.scale(d,d,-1)):r.copy(d,z);r.cross(w,d,c);r.normalize(w,w);return y.angle(t,w,c)};return m}()})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ./Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){const n=p.getLogger("esri.views.3d.webgl-engine.lib.Camera");p=function(){function A(D=null,E=null,G=null){this._viewUp=g.create();this._viewForward=g.create();this._viewRight=g.create();this._ray=t.create();this._viewport=c.fromValues(0,0,1,1);this._padding=c.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=e.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=f.create();this._projectionDirty=!0;this._projectionMatrix=f.create();this._viewProjectionDirty=
!0;this._viewProjectionMatrix=f.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=f.create();this._frustumDirty=!0;this._frustum=u.create();this._fullViewport=c.create();this.pixelRatio=1;this.relativeElevation=0;r.isSome(D)&&l.copy(this._ray.origin,D);this._center=r.isSome(E)?g.clone(E):g.create();this._up=r.isSome(G)?g.clone(G):g.fromValues(0,0,1)}var B=A.prototype;B.depthNDCToWorld=function(D){return 2*this.near*this.far/(this.far+this.near-(2*D-1)*(this.far-this.near))};
B.copyFrom=function(D){l.copy(this._ray.origin,D.eye);l.copy(this._center,D.center);l.copy(this._up,D.up);d.copy(this._viewport,D.viewport);d.copy(this._padding,D.padding);w.copy(this._nearFar,D.nearFar);this._fov=D.fov;this.relativeElevation=D.relativeElevation;this._viewDirty=D._viewDirty;this._viewDirty||(y.copy(this._viewMatrix,D.viewMatrix),l.copy(this._viewRight,D.viewRight),l.copy(this._viewUp,D.viewUp),l.copy(this._viewForward,D.viewForward));D._projectionDirty?this._projectionDirty=!0:(y.copy(this._projectionMatrix,
D.projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=D._frustumDirty;this._frustumDirty||(u.copy(D.frustum,this._frustum),this._frustumDirty=!1);D._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(y.copy(this._viewInverseTransposeMatrix,D.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);d.copy(this._fullViewport,D.fullViewport);this.pixelRatio=D.pixelRatio;return this};B.copyViewFrom=function(D){this.eye=D.eye;
this.center=D.center;this.up=D.up};B.clone=function(){return(new A).copyFrom(this)};B.equals=function(D){return l.exactEquals(this.eye,D.eye)&&l.exactEquals(this._center,D.center)&&l.exactEquals(this._up,D.up)&&d.exactEquals(this._viewport,D.viewport)&&d.exactEquals(this._padding,D.padding)&&w.exactEquals(this._nearFar,D.nearFar)&&this._fov===D.fov&&this.pixelRatio===D.pixelRatio&&this.relativeElevation===D.relativeElevation};B.almostEquals=function(D){if(this.pixelRatio!==D.pixelRatio||.001<=Math.abs(D.fov-
this._fov))return!1;const E=1-1E-10;l.sub(v,D.eye,D.center);l.sub(x,this.eye,this._center);const G=l.dot(v,x),K=l.sqrLen(v),M=l.sqrLen(x);return G*G>=E*K*M&&l.sqrDist(D.eye,this.eye)<2.5E-7*Math.max(K,M)&&.5>d.squaredDistance(D.padding,this._padding)&&.5>d.squaredDistance(D.viewport,this._viewport)};B.computeRenderPixelSizeAt=function(D){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(D))};B.computeRenderPixelSizeAtDist=function(D){return D*this.perRenderPixelRatio};B.computeScreenPixelSizeAt=
function(D){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(D))};B.viewDirectionDistance=function(D){return Math.abs(h.projectPointSignedLength(this.viewForward,l.subtract(v,D,this.eye)))};B.computeScreenPixelSizeAtDist=function(D){return D*this.perScreenPixelRatio};B.computeDistanceFromRadius=function(D,E){return D/Math.tan(Math.min(this.fovX,this.fovY)/(2*(E||1)))};B.getScreenCenter=function(D=q.createScreenPointArray()){D[0]=(this.padding[3]+this.width/2)/this.pixelRatio;D[1]=
(this.padding[0]+this.height/2)/this.pixelRatio;return D};B.getRenderCenter=function(D,E=.5,G=.5){D[0]=this.padding[3]+this.width*E;D[1]=this.padding[2]+this.height*G;D[2]=.5;return D};B.setGLViewport=function(D){const E=this.viewport,G=this.padding;D.setViewport(E[0]-G[3],E[1]-G[2],E[2]+G[1]+G[3],E[3]+G[0]+G[2])};B.applyProjection=function(D,E,G=!1){D!==z&&l.copy(z,D);z[3]=1;G&&(E[2]=-z[2]);d.transformMat4(z,z,this.projectionMatrix);l.scale(z,z,1/Math.abs(z[3]));D=this.fullViewport;E[0]=b.lerp(0,
D[0]+D[2],.5+.5*z[0]);E[1]=b.lerp(0,D[1]+D[3],.5+.5*z[1]);G||(E[2]=.5*(z[2]+1));return E};B.projectToScreen=function(D,E){this.projectToRenderScreen(D,C);this.renderToScreen(C,E)};B.projectToRenderScreen=function(D,E){z[0]=D[0];z[1]=D[1];z[2]=D[2];z[3]=1;d.transformMat4(z,z,this.viewProjectionMatrix);if(0===z[3])return null;l.scale(z,z,1/Math.abs(z[3]));D=this.fullViewport;"x"in E?(E.x=b.lerp(0,D[0]+D[2],.5+.5*z[0]),E.y=b.lerp(0,D[1]+D[3],.5+.5*z[1])):(E[0]=b.lerp(0,D[0]+D[2],.5+.5*z[0]),E[1]=b.lerp(0,
D[1]+D[3],.5+.5*z[1]),2<E.length&&(E[2]=.5*(z[2]+1)));return E};B.unprojectFromScreen=function(D,E){return this.unprojectFromRenderScreen(this.screenToRender(D,C),E)};B.unprojectFromRenderScreen=function(D,E){y.multiply(k,this.projectionMatrix,this.viewMatrix);if(!y.invert(k,k))return null;const G=this.fullViewport;z[0]=2*(D[0]-G[0])/G[2]-1;z[1]=2*(D[1]-G[1])/G[3]-1;z[2]=2*D[2]-1;z[3]=1;d.transformMat4(z,z,k);if(0===z[3])return null;E[0]=z[0]/z[3];E[1]=z[1]/z[3];E[2]=z[2]/z[3];return E};B.constrainWindowSize=
function(D,E,G,K=G){D*=this.pixelRatio;E*=this.pixelRatio;return[Math.max(D-G/2,0),Math.max(this.fullHeight-E-K/2,0),G- -Math.min(D-G/2,0)- -Math.min(this.fullWidth-D-G/2,0),K- -Math.min(this.fullHeight-E-K/2,0)- -Math.min(E-K/2,0)]};B.computeUp=function(D){1===D?this.computeUpGlobal():this.computeUpLocal()};B.screenToRender=function(D,E){const G=this.fullHeight-D[1]*this.pixelRatio;E[0]=D[0]*this.pixelRatio;E[1]=G;return E};B.renderToScreen=function(D,E){const G=(this.fullHeight-D[1])/this.pixelRatio;
E[0]=D[0]/this.pixelRatio;E[1]=G};B.computeUpGlobal=function(){l.subtract(v,this.center,this.eye);const D=l.length(this.center);1>D?(l.set(this._up,0,0,1),this._markViewDirty()):Math.abs(l.dot(v,this.center))>.9999*l.length(v)*D||(l.cross(this._up,v,this.center),l.cross(this._up,this._up,v),l.normalize(this._up,this._up),this._markViewDirty())};B.computeUpLocal=function(){l.direction(v,this.eye,this.center);.9999>=Math.abs(v[2])&&(l.scale(v,v,v[2]),l.set(this._up,-v[0],-v[1],1-v[2]),l.normalize(this._up,
this._up),this._markViewDirty())};B._compareAndSetView=function(D,E){"number"===typeof D[0]&&isFinite(D[0])&&"number"===typeof D[1]&&isFinite(D[1])&&"number"===typeof D[2]&&isFinite(D[2])?l.exactEquals(D,E)||(l.copy(E,D),this._markViewDirty()):n.warn("Camera vector contains invalid number, ignoring value")};B._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};B._recomputeFrustum=function(){this._frustumDirty&&(u.fromMatrix(this.viewMatrix,this.projectionMatrix,
this._frustum),this._frustumDirty=!1)};B._ensureViewClean=function(){this._viewDirty&&(y.lookAt(this._viewMatrix,this.eye,this._center,this._up),l.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),l.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),l.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};a._createClass(A,[{key:"eye",get:function(){return this._ray.origin},
set:function(D){this._compareAndSetView(D,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(D){this._compareAndSetView(D,this._center)}},{key:"ray",get:function(){l.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(D){this._compareAndSetView(D,this._up)}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},set:function(D){y.copy(this._viewMatrix,D);this._viewDirty=
!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(D){this._nearFar[0]!==D&&(this._nearFar[0]=D,this._frustumDirty=
this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(D){this._nearFar[1]!==D&&(this._nearFar[1]=D,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(D){this.x=D[0];this.y=D[1];this.width=D[2];this.height=D[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(D){D+=this._padding[3];this._viewport[0]!==D&&(this._viewport[0]=D,this._frustumDirty=
this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(D){D+=this._padding[2];this._viewport[1]!==D&&(this._viewport[1]=D,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(D){this._viewport[2]!==D&&(this._viewport[2]=D,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(D){this._viewport[3]!==
D&&(this._viewport[3]=D,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(D){this.width=D-(this._padding[1]+this._padding[3])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(D){this.height=D-(this._padding[0]+this._padding[2])}},{key:"fullViewport",get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[3];
this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(D){if(this._padding[0]!==D[0]||this._padding[1]!==D[1]||this._padding[2]!==D[2]||this._padding[3]!==D[3])this._viewport[0]+=D[3]-this._padding[3],this._viewport[1]+=D[2]-this._padding[2],this._viewport[2]-=D[1]+D[3]-
(this._padding[1]+this._padding[3]),this._viewport[3]-=D[0]+D[2]-(this._padding[0]+this._padding[2]),d.copy(this._padding,D),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(y.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){const D=this.width,E=this.height,
G=this.near*Math.tan(this.fovY/2),K=G*this.aspect;y.frustum(this._projectionMatrix,-K*(1+2*this._padding[3]/D),K*(1+2*this._padding[1]/D),-G*(1+2*this._padding[2]/E),G*(1+2*this._padding[0]/E),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(D){y.copy(this._projectionMatrix,D);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(D){this._fov=D;this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0}},{key:"fovX",get:function(){return m.fovd2fovx(this._fov,this.width,this.height)},set:function(D){this._fov=m.fovx2fovd(D,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovY",get:function(){return m.fovd2fovy(this._fov,this.width,this.height)},set:function(D){this._fov=m.fovy2fovd(D,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"distance",get:function(){return l.distance(this._center,
this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)y.invert(this._viewInverseTransposeMatrix,this.viewMatrix),y.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/
2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&0<=this.relativeElevation}}]);return A}();const z=c.create(),k=f.create(),v=g.create(),x=g.create(),C=q.createRenderScreenPointArray3();return p})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),
function(a,p,b,r,q,y,f,w,e,l){function g(n){return n?[e.create(n[0]),e.create(n[1]),e.create(n[2]),e.create(n[3]),e.create(n[4]),e.create(n[5])]:[e.create(),e.create(),e.create(),e.create(),e.create(),e.create()]}function d(){return[q.create(),q.create(),q.create(),q.create(),q.create(),q.create(),q.create(),q.create()]}function c(n,z){e.fromPoints(z[4],z[0],z[3],n[0]);e.fromPoints(z[1],z[5],z[6],n[1]);e.fromPoints(z[4],z[5],z[1],n[2]);e.fromPoints(z[3],z[2],z[6],n[3]);e.fromPoints(z[0],z[1],z[2],
n[4]);e.fromPoints(z[5],z[4],z[7],n[5])}function u(n,z){for(let k=0;6>k;k++)if(!e.clip(n[k],z))return!1;return!0}const t=[f.fromValues(-1,-1,-1,1),f.fromValues(1,-1,-1,1),f.fromValues(1,1,-1,1),f.fromValues(-1,1,-1,1),f.fromValues(-1,-1,1,1),f.fromValues(1,-1,1,1),f.fromValues(1,1,1,1),f.fromValues(-1,1,1,1)],h=new p.ObjectStack(w.create),m=d();a.computePlanes=c;a.copy=function(n,z=g()){for(let k=0;6>k;k++)e.copy(n[k],z[k])};a.create=g;a.createPoints=d;a.fromMatrix=function(n,z,k,v=m){n=b.multiply(l.sm4d.get(),
z,n);b.invert(n,n);for(z=0;8>z;++z){const x=y.transformMat4(l.sv4d.get(),t[z],n);r.set(v[z],x[0]/x[3],x[1]/x[3],x[2]/x[3])}c(k,v)};a.intersectClipRay=function(n,z){for(let k=0;6>k;k++)if(!e.clipInfinite(n[k],z))return!1;return!0};a.intersectsAABB=function(n,z){for(let k=0;6>k;k++)if(e.isAABBFullyInside(n[k],z))return!1;return!0};a.intersectsLineSegment=function(n,z,k){return u(n,w.fromLineSegmentAndDirection(z,k,h.get()))};a.intersectsPoint=function(n,z){for(let k=0;6>k;k++)if(0<e.signedDistance(n[k],
z))return!1;return!0};a.intersectsRay=function(n,z){return u(n,w.fromRay(z,h.get()))};a.intersectsSphere=function(n,z){for(let k=0;6>k;k++){const v=n[k];if(v[0]*z[0]+v[1]*z[1]+v[2]*z[2]+v[3]>=z[3])return!1}return!0};a.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","./ray","./vectorStacks"],
function(a,p,b,r,q){function y(g){return g?{ray:r.create(g.ray),c0:g.c0,c1:g.c1}:{ray:r.create(),c0:0,c1:Number.MAX_VALUE}}function f(g,d,c,u=y()){r.copy(g,u.ray);u.c0=d;u.c1=c;return u}function w(g,d,c=y()){const u=b.length(g.vector);r.fromValues(g.origin,d,c.ray);c.c0=0;c.c1=u;return c}function e(g,d,c){return b.add(c,g.ray.origin,b.scale(c,g.ray.direction,d))}const l=new p.ObjectStack(()=>({c0:0,c1:0,ray:null}));a.copy=function(g,d=y()){return f(g.ray,g.c0,g.c1,d)};a.create=y;a.fromLineSegment=
function(g,d=y()){const c=b.normalize(q.sv3d.get(),g.vector);return w(g,c,d)};a.fromLineSegmentAndDirection=w;a.fromRay=function(g,d=y()){r.copy(g,d.ray);d.c0=0;d.c1=Number.MAX_VALUE;return d};a.fromValues=f;a.getAt=e;a.getEnd=function(g,d){return e(g,g.c1,d)};a.getStart=function(g,d){return e(g,g.c0,d)};a.wrap=function(g,d,c){const u=l.get();u.ray=g;u.c0=d;u.c1=c;return u};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),
function(a,p,b,r,q,y,f){const w={zoom:0,pan:0,rotate:0};let e=function(){function l(d){this.createCamera=d;this._time=b.Milliseconds(0);this.definition=new q.Definition(d);this.path=new f.Path}var g=l.prototype;g.update=function(d,c,u){this.definition.update(d,c,u);this.path.update(this.definition,u);this._time=this._applyTimeSettings(b.MillisecondsFromSeconds(this.path.time),u);this._easing=u.easing?u.easing:1E3<=this._time?r.inOutCoastQuad:r.outExpo};g.cameraAt=function(d,c){c=c||this.createCamera();
d=Math.min(Math.max(0,d),1);d=this._normalizedEasing(d);d=this.path.interpolateComponentsAt(d,w);c.interpolate(this.definition.source,this.definition.target,d);return c};g._normalizedEasing=function(d){const c=this._easing(0,this._time),u=this._easing(1,this._time);return(this._easing(d,this._time)-c)/(u-c)};g._applyTimeSettings=function(d,c){const u=null!=c.speedFactor?c.speedFactor:1;null!=c.duration?d=c.duration:null!=c.speedFactor&&(d=b.Milliseconds(d/u));return b.Milliseconds(Math.min(Math.max(null!=
c.minDuration?c.minDuration:y.defaultSettings.minDuration/u,d),null!=c.maxDuration?c.maxDuration:y.defaultSettings.maxDuration/u))};p._createClass(l,[{key:"time",get:function(){return this._time}}]);return l}();a.Animation=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(a,p,b){let r=function(){function q(f){this.createCamera=f;this.compared={sourceZoom:0,
targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:b.defaultSettings.desiredScreenFlow};this.source=f();this.target=f()}var y=q.prototype;y.clone=function(){const f=new q(this.createCamera);f.copyFrom(this);return f};y.copyFrom=function(f){this.update(f.source,f.target,f.settings)};y.update=function(f,w,e){this.source!==f&&this.source.copyFrom(f);this.target!==w&&this.target.copyFrom(w);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=
e.desiredScreenFlow?e.desiredScreenFlow:b.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};y.halfWindowPanAtZoom=function(f){f=this.target.pixelsPerPanAtZoom(f);return this.halfWindowSize/f};p._createClass(q,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<
this.compared.rotate}}]);return q}();a.Definition=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],function(a,p){p={desiredScreenFlow:2,minDuration:p.Milliseconds(500),maxDuration:p.Milliseconds(8E3)};a.defaultSettings=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),
function(a,p,b,r,q,y){r=function(f){function w(l,g){var d=f.call(this)||this;d._preallocSegments=[new q.Segment,new q.Segment,new q.Segment];d.update(l,g);return d}p._inheritsLoose(w,f);var e=w.prototype;e.update=function(l,g){if(l){this.definition?this.definition.copyFrom(l):this.definition=l.clone();var d=null;g&&g.apex&&(d=y.optimalDistance(l,g.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==d?this._updateWithoutApex():this._updateWithApex(d,g.apex)}};e.segmentInterpolateComponentsAt=
function(l,g,d){d=l.interpolateComponentsAt(g,d);l===this._ascensionSegment?d.zoom=b.outQuad(d.zoom):l===this._descensionSegment&&(d.zoom=b.inQuad(d.zoom));return d};e._updateWithApex=function(l,g){const [d,c,u]=this._preallocSegments,t=null!=g.ascensionFactor?g.ascensionFactor:.5;g=Math.min(1-t,null!=g.ascensionFactor?g.descensionFactor:.5);const h=1-t-g;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.targetZoom=l;d.definition.compared.pan=
this.definition.compared.pan*t;d.definition.compared.rotate=this.definition.compared.rotate*t;d.update();this._ascensionSegment=d;this.segments.push(d);0<h&&(c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone(),c.definition.copyFrom(this.definition),c.definition.compared.sourceZoom=l,c.definition.compared.targetZoom=l,c.definition.compared.pan=this.definition.compared.pan*h,c.definition.compared.rotate=this.definition.compared.rotate*h,c.update(),this.segments.push(c));
u.definition?u.definition.copyFrom(this.definition):u.definition=this.definition.clone();u.definition.compared.sourceZoom=l;u.definition.compared.pan=this.definition.compared.pan*g;u.definition.compared.rotate=this.definition.compared.rotate*g;u.update();this._descensionSegment=u;this.segments.push(u)};e._updateWithoutApex=function(){const [l]=this._preallocSegments;l.update(this.definition);this.segments.push(l)};return w}(r.Path);a.Path=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,p,b){let r=function(){function q(){this.segments=[]}var y=q.prototype;y.interpolateComponentsAt=function(f,w){f=Math.min(Math.max(f,0),1);f*=this.time;var e=0,l=0;const g=this.definition;for(let d=0;d<this.segments.length;d++){const c=this.segments[d],u=c.definition;if(f<=c.time||d===this.segments.length-1)return w=this.segmentInterpolateComponentsAt(c,f/c.time,w),w.pan=g.hasPan?(e+u.compared.pan*w.pan)/g.compared.pan:1,
w.rotate=g.hasRotate?(l+u.compared.rotate*w.rotate)/g.compared.rotate:1,f=w.zoom*(u.compared.targetZoom-u.compared.sourceZoom)+u.compared.sourceZoom,e=this.segments[0].definition.compared.sourceZoom,l=this.segments[this.segments.length-1].definition.compared.targetZoom,w.zoom=g.hasZoom?(f-e)/(l-e):1,w;f-=c.time;e+=u.compared.pan;l+=u.compared.rotate}};y.segmentInterpolateComponentsAt=function(f,w,e){return f.interpolateComponentsAt(w,e)};p._createClass(q,[{key:"time",get:function(){return this.segments.reduce((f,
w)=>b.Seconds(f+w.time),b.Seconds(0))}}]);return q}();a.Path=r;a["default"]=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,p,b){let r=function(){function q(f){f&&this.update(f)}var y=q.prototype;y.update=function(f){f&&(this.definition?this.definition.copyFrom(f):this.definition=f.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};
y._updatePrecomputedVariables=function(){var f=this.definition;const w=f.compared,e=w.sourceZoom,l=w.targetZoom;this._zoomSign=e>l?1:-1;this._panPixelsAtSource=w.pan*f.source.pixelsPerPanAtZoom(e);f=(f.source.pixelsPerRotateAtZoom(e)+f.target.pixelsPerRotateAtZoom(l))/2;this._rotatePixels=w.rotate*f};y._updatePixelFlow=function(){var f=this.definition.compared.sourceZoom,w=this.definition.compared.targetZoom;const {hasZoom:e,hasPan:l,hasRotate:g}=this.definition;var d=0,c=0;e&&(l&&(d=(w/f-1)/(-1/
(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),g&&(c=Math.log(f/w)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;f=this.definition.desiredPixelFlow;e&&l&&g?(w=d+c+d*c,this._zoomPixelFlow=d*c/w*f,this._panPixelFlow=c/w*f,this._rotatePixelFlow=d/w*f):e&&l?(c=1+d,this._zoomPixelFlow=d/c*f,this._panPixelFlow=1/c*f):e&&g?(d=1+c,this._zoomPixelFlow=c/d*f,this._rotatePixelFlow=
1/d*f):l&&g?(d=this._panPixelsAtSource/this._rotatePixels,c=1+d,this._panPixelFlow=d/c*f,this._rotatePixelFlow=1/c*f):l?this._panPixelFlow=f:e?this._zoomPixelFlow=f:g&&(this._rotatePixelFlow=f);this._time=g?this.rotateTime:e?this.zoomTime:l?this.panTime:b.Seconds(0)};y._interpolateComponentsZoom=function(f){if(0===f||1===f)return f;if(this.definition.hasZoom){const w=this.definition.compared.sourceZoom,e=this.definition.compared.targetZoom;return(w*(w/e)**-f-w)/(e-w)}return f};y._interpolateComponentsPan=
function(f){if(0===f||1===f)return f;if(this.definition.hasPan&&this.definition.hasZoom){const w=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(w*f*this._time)-1)/(w*Math.LN2)}return f};y._interpolateComponentsRotate=function(f){return f};y.interpolateComponentsAt=function(f,w){f=Math.min(Math.max(f,0),1);const e=this._interpolateComponentsZoom(f),l=this._interpolateComponentsPan(f);f=this._interpolateComponentsRotate(f);
w?(w.zoom=e,w.pan=l,w.rotate=f):w={zoom:e,pan:l,rotate:f};return w};p._createClass(q,[{key:"time",get:function(){return this._time}},{key:"rotateTime",get:function(){return this.definition.hasRotate?b.Seconds(this._rotatePixels/this._rotatePixelFlow):b.Seconds(0)}},{key:"zoomTime",get:function(){return this.definition.hasZoom?b.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):b.Seconds(0)}},
{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const f=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return b.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*f+1)/(f*this._zoomPixelFlow))}return b.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return b.Seconds(0)}}]);return q}();a.Segment=r;a["default"]=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports",
"./functions"],function(a,p){function b(r,q){const y=Math.max(r.compared.sourceZoom,r.compared.targetZoom);r=r.source.zoomAtPixelsPerPan(r.desiredPixelFlow/r.compared.pan)/2;return r<y?null!=q.maximumDistance?y+(q.maximumDistance-y)/2:1.5*y:q.maximumDistance?Math.min(q.maximumDistance,r):r}a.optimalDistance=function(r,q){let y=b(r,q);const f={ascensionFactor:null!=q.ascensionFactor?q.ascensionFactor:.5,descensionFactor:null!=q.descensionFactor?q.descensionFactor:.5};var w=0===f.ascensionFactor,e=
0===f.descensionFactor;const l=w?p.tAscensionZoomOnly:p.tAscensionZoomPan,g=w?p.dtAscensionZoomOnly:p.dtAscensionZoomPan,d=w?p.ddtAscensionZoomOnly:p.ddtAscensionZoomPan,c=e?p.tDescensionZoomOnly:p.tDescensionZoomPan,u=e?p.dtDescensionZoomOnly:p.dtDescensionZoomPan,t=e?p.ddtDescensionZoomOnly:p.ddtDescensionZoomPan;w=x=>l(r,x,f)+p.tPanion(r,x,f)+c(r,x,f);e=x=>g(r,x,f)+p.dtPanion(r,x,f)+u(r,x,f);const h=x=>d(r,x,f)+p.ddtPanion(r,x,f)+t(r,x,f);let m=w(y);const n=p.tBaseLine(r),z=q.maximumIterations||
20,k=null!=q.maximumDistance?q.maximumDistance:Infinity;for(q=0;q<z;q++){var v=(e(y)+1E-6)/h(y);if(isNaN(v)||y>=k&&0>v){if(!isFinite(k))return null;y=k;m=w(y);break}y-=v;if(y<r.compared.sourceZoom||y<r.compared.targetZoom)return null;v=w(y);if(.005>=Math.abs(v-m)/m)break;m=v}return m>.7*n||y<r.compared.sourceZoom||y<r.compared.targetZoom?null:y};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=
function(p,b){return-p.halfWindowSize/(b*b*p.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(p,b,r){const q=b-p.compared.sourceZoom,y=1/q,f=1/b,w=Math.log(p.compared.sourceZoom*f);r=(r.ascensionFactor*Math.LN2*p.compared.pan+p.halfWindowPanAtZoom(q))/p.halfWindowPanAtZoom(1);return p.halfWindowSize*y*(-2*y*f*r+2*y*w+2*f-2*w*r/(q*q)-r/(b*b))/(p.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(p,b){return-p.halfWindowSize/(b*b*p.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=
function(p,b,r){const q=b-p.compared.targetZoom,y=1/q,f=1/b,w=Math.log(b/p.compared.targetZoom);r=(p.halfWindowPanAtZoom(b)+r.descensionFactor*Math.LN2*p.compared.pan-p.halfWindowPanAtZoom(p.compared.targetZoom))/p.halfWindowPanAtZoom(1);return p.halfWindowSize*y*(-2*y*f*r-2*y*w+2*f+2*w*r/(q*q)-r/(b*b))/(p.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(p,b,r){return-2*p.compared.pan*p.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(p.desiredPixelFlow*p.halfWindowPanAtZoom(b*b*b))};a.dtAscensionZoomOnly=
function(p,b){return p.halfWindowSize/(b*p.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(p,b,r){const q=1/b,y=Math.log(p.compared.sourceZoom*q),f=1/p.desiredPixelFlow,w=1/Math.LN2;b-=p.compared.sourceZoom;const e=1/b;r=(r.ascensionFactor*Math.LN2*p.compared.pan+p.halfWindowPanAtZoom(b))/p.halfWindowPanAtZoom(1);return p.halfWindowSize*q*f*w*e*r-p.halfWindowSize*y*f*w*e+p.halfWindowSize*y*f*w*r/(b*b)};a.dtDescensionZoomOnly=function(p,b){return p.halfWindowSize/(b*p.desiredPixelFlow*Math.LN2)};
a.dtDescensionZoomPan=function(p,b,r){const q=Math.log(b/p.compared.targetZoom),y=1/p.desiredPixelFlow,f=1/Math.LN2,w=-b+p.compared.targetZoom,e=1/w;r=(-p.halfWindowPanAtZoom(b)-r.descensionFactor*Math.LN2*p.compared.pan+p.halfWindowPanAtZoom(p.compared.targetZoom))/p.halfWindowPanAtZoom(1);return-p.halfWindowSize*q*y*f*e+p.halfWindowSize*q*y*f*r/(w*w)+p.halfWindowSize*y*f*e*r/b};a.dtPanion=function(p,b,r){return p.compared.pan*p.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(p.desiredPixelFlow*
p.halfWindowPanAtZoom(b*b))};a.tAscensionZoomOnly=function(p,b){return-p.halfWindowSize*Math.log(p.compared.sourceZoom/b)/(p.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(p,b,r){const q=p.halfWindowPanAtZoom(b-p.compared.sourceZoom);return-p.halfWindowSize*(r.ascensionFactor*Math.LN2*p.compared.pan+q)*Math.log(p.compared.sourceZoom/b)/(p.desiredPixelFlow*Math.LN2*q)};a.tBaseLine=function(p){const b=Math.LN2*p.compared.pan,r=p.halfWindowPanAtZoom(p.compared.sourceZoom-p.compared.targetZoom),
q=p.halfWindowSize*Math.log(p.compared.sourceZoom/p.compared.targetZoom)/(p.desiredPixelFlow*Math.LN2*r);return p.compared.sourceZoom<=p.compared.targetZoom?q*(b-r):q*(b+r)};a.tDescensionZoomOnly=function(p,b){return p.halfWindowSize*Math.log(b/p.compared.targetZoom)/(p.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(p,b,r){return p.halfWindowSize*(-p.halfWindowPanAtZoom(b)-r.descensionFactor*Math.LN2*p.compared.pan+p.halfWindowPanAtZoom(p.compared.targetZoom))*Math.log(b/p.compared.targetZoom)/
(p.desiredPixelFlow*Math.LN2*p.halfWindowPanAtZoom(-b+p.compared.targetZoom))};a.tPanion=function(p,b,r){return-p.compared.pan*p.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(p.desiredPixelFlow*p.halfWindowPanAtZoom(b))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){a.AnimationController=function(c){function u(){return c.apply(this,arguments)||this}p._inheritsLoose(u,c);var t=u.prototype;t.onControllerStart=function(){this.state=d.State.Running;r.isSome(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};t.updateStateFromViewAnimation=function(){!r.isSome(this.viewAnimation)||this.state!==d.State.Ready&&this.state!==d.State.Running||(this.viewAnimation.state===
g.State.FINISHED?this.finish():this.viewAnimation.state===g.State.STOPPED&&(this.state=d.State.Stopped))};t.onControllerEnd=function(){r.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===d.State.Finished?this.viewAnimation.finish():this.state===d.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===d.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(q.createAbortError()))};t.finish=function(){this.finishController()};p._createClass(u,[{key:"canStop",
get:function(){return!0}},{key:"asyncResult",get:function(){return this._asyncResult},set:function(h){this._asyncResult&&(this._asyncResult.reject(q.createAbortError()),this._asyncResult=null);this.state===d.State.Finished||this.state===d.State.Stopped?this.state===d.State.Finished?h.resolve():h.reject(q.createAbortError()):this._asyncResult=h}}]);return u}(d.CameraController);a.AnimationController=b.__decorate([l.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,p,b,r,q,y,f,w,e){a.State=void 0;(function(l){l.Ready=
"ready";l.Rejected="rejected";l.Running="running";l.Stopped="stopped";l.Finished="finished"})(a.State||(a.State={}));a.CameraController=function(l){function g(){var c=l.apply(this,arguments)||this;c.state=a.State.Ready;return c}p._inheritsLoose(g,l);var d=g.prototype;d.stopController=function(){return this.canStop?(this.state=a.State.Stopped,!0):!1};d.finishController=function(){this.state=a.State.Finished};p._createClass(g,[{key:"active",get:function(){return this.state===a.State.Running}},{key:"isInteractive",
get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return g}(r);b.__decorate([q.property({readOnly:!0})],a.CameraController.prototype,"active",null);b.__decorate([q.property()],a.CameraController.prototype,"state",void 0);a.CameraController=b.__decorate([e.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/mathUtils ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k){function v(Ia,va,ma){const ta=h.sm4d.get();q.identity(ta);q.rotate(ta,ta,ma[3],g.axis(ma));e.subtract(pa,Ia.eye,va);e.transformMat4(pa,pa,ta);Ia.eye=e.add(pa,pa,va);e.subtract(pa,Ia.center,va);e.transformMat4(pa,pa,ta);Ia.center=e.add(pa,pa,va);Ia.up=e.transformMat4(pa,Ia.up,ta)}function x(Ia,va){e.set(va,0,0,0);for(const ma of Ia)e.add(va,va,ma);e.scale(va,va,1/Ia.length)}function C(Ia,va,ma,ta){return Math.sin(Ia/e.length(va))*(ma+ta.radius)}function A(Ia,
va,ma,ta){ma=n.fromScreenAtEye(va,ma,Ma);if(b.isNone(ma))return!1;u.closestPointOnSilhouette(Ia,ma,S);return u.intersectRay(Ia,ma,ta)?e.squaredDistance(S,ma.origin)<e.squaredDistance(ta,ma.origin)?(e.copy(ta,S),!1):!0:(e.subtract(P,va.eye,va.center),e.normalize(P,P),c.fromNormalAndOffset(P,-e.dot(e.normalize(P,P),S),Q),c.intersectRay(Q,ma,ta),!1)}function B(Ia,va,ma,ta,Ea,Ca){e.cross(Fa,Ia,va);e.subtract(ua,Ia,va);e.length(Ia)<=Ea||!ta.aboveGround?(e.cross(ma,ua,ta.eye),Ia=e.dot(Ia,va)/(e.length(Ia)*
e.length(va)),Ca=Math.cos(p.clamp(m.cyclicalPI.normalize(p.deg2rad(Ca)),0,N)),va=-p.acosClamped(Ia)-Math.max(0,e.length(va)-Ea)/(Ca*Ea)):(e.subtract(V,ta.eye,ta.center),e.cross(ma,ua,V),va=-e.length(ua)/Ea);e.normalize(ma,ma);e.scale(ma,ma,e.length(Fa));return va}function D(Ia,va,ma,ta){ta=Math.cos(p.clamp(m.cyclicalPI.normalize(p.deg2rad(ta)),0,N));va=va>ma?-(va-ma)/(ta*ma):va<-ma?Math.PI-(va+ma)/(ta*ma):p.acosClamped(va/ma);return((Ia>ma?-(Ia-ma)/(ta*ma):Ia<-ma?Math.PI-(Ia+ma)/(ta*ma):p.acosClamped(Ia/
ma))-va)*ma}function E(Ia,va,ma,ta,Ea,Ca,ka,sa,Ja,Ta){Ja=D(Ia[2],va[2],ka[3],Ja);va=Ta?D(Ia[0],va[0],ka[3],180):va[0]-Ia[0];Ia=Math.sin(sa)*va-Math.cos(sa)*Ja;sa=Math.cos(sa)*va+Math.sin(sa)*Ja;e.normalize(pa,Ea);Ea=Ta?Ia/Math.sqrt(Math.abs(ka[3]**2-e.dot(ma,pa)**2)):Ia/ka[3];ma=sa/Math.sqrt(Math.abs(ka[3]**2-e.dot(ma,ta)**2));f.set(Ca,Ea,ma)}function G(Ia,va,ma,ta,Ea,Ca,ka,sa,Ja,Ta){e.cross(Fa,Ia,va);d.coordinateSystemFromOneAxisAndNormalVector(Ca.up,Ca.eye,ha,fa,aa);d.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],Ca.eye,ca,ba,Z);e.copy(ma,ba);e.copy(ta,ca);e.normalize(ma,ma);e.scale(ma,ma,e.length(Fa));d.vectorCoordinates(Ia,e.normalize(fa,fa),e.normalize(aa,aa),e.normalize(ha,ha),W);d.vectorCoordinates(va,fa,aa,ha,U);E(W,U,Ia,ca,ba,Ea,ka,sa,Ja,Ta)}function K(Ia,va,ma,ta,Ea,Ca,ka){q.identity(Y);q.identity(ea);q.identity(ia);q.rotate(Y,Y,Ea,ta);q.rotate(ea,ea,ka,Ca);q.multiply(ia,Y,ea);e.subtract(va,Ia,ma);e.transformMat4(va,va,ia);e.add(va,va,ma)}function M(Ia,va,ma,ta,Ea,Ca){q.identity(Y);q.identity(ea);
q.identity(ia);q.rotate(Y,Y,ta,ma);q.rotate(ea,ea,Ca,Ea);q.multiply(ia,Y,ea);e.subtract(pa,Ia.eye,va);e.transformMat4(pa,pa,ia);Ia.eye=e.add(pa,pa,va);e.subtract(pa,Ia.center,va);e.transformMat4(pa,pa,ia);Ia.center=e.add(pa,pa,va);e.subtract(pa,Ia.up,va);e.transformMat4(pa,pa,ia);Ia.up=e.add(pa,pa,va)}function H(Ia,va,ma,ta,Ea,Ca,ka=L.Pole,sa=L.Angle){Ia=Math.abs(Ia[2])<ma*ka||Math.abs(va)>ma;return(Math.abs(ta)>Math.PI-sa||Math.abs(ta)<sa)&&Ia&&Ca.aboveGround&&Ea<L.Tilt?!0:!1}function J(Ia,va,ma,
ta,Ea,Ca){Ca?(g.fromPoints(ma,ta,T),v(va,Ia,T)):(ma=B(ma,ta,La,va,Ia[3],Ea),v(va,Ia,g.wrapAxisAngle(La,ma)))}function O(Ia,va,ma,ta,Ea,Ca,ka){const sa=ka?20:1;e.copy(la,ta);wa.copyFrom(va);let Ja;for(let Ta=0;Ta<sa&&1E-12<e.squaredDistance(ma,la);Ta++)if(ta=e.squaredDistance(ma,la),G(ma,la,ba,ca,X,wa,Ia,Ea,Ca,ka),M(wa,Ia,ca,X[1],ba,X[0]),K(la,la,Ia,ca,X[1],ba,X[0]),Ja=e.squaredDistance(ma,la),Ja<ta||0===Ta)va.copyFrom(wa);else break}const I=r.createScreenPointArray();a.NavigationMode=void 0;(function(Ia){Ia[Ia.Vertical=
0]="Vertical";Ia[Ia.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const F={Elevation:3E4,Angle:p.deg2rad(6)},L={Pole:.95,Angle:p.deg2rad(18),Tilt:45},N=p.deg2rad(80),R=l.create(),S=l.create(),P=l.create(),Q=c.create(),V=l.create(),ca=l.create(),ba=l.create(),Z=l.create(),ha=l.create(),fa=l.create(),aa=l.create(),W=l.create(),U=l.create(),X=w.create(),T=g.create(),Y=y.create(),ea=y.create(),ia=y.create(),la=l.create(),pa=l.create(),ua=l.create(),wa=new k,Fa=l.create(),La=l.create(),
Ma={origin:l.create(),direction:l.create()},Sa={origin:l.create(),direction:l.create()};a.PreservingHeadingThreshold=L;a.TiltThresholdPanningSpeed=N;a.VerticalPanTresholds=F;a.applyPanPlanar=function(Ia,va,ma){e.subtract(R,ma,va);Ia.eye=e.subtract(pa,Ia.eye,R);Ia.center=e.subtract(pa,Ia.center,R)};a.applyPanSphericalDirectRotation=J;a.applyPanSphericalPreserveHeading=O;a.applyRotation=v;a.applyRotationWithTwoAxes=M;a.applyZoomOnSphere=function(Ia,va,ma){va.getScreenCenter(I);z.intersectScreen(Ia,
va,I,pa)&&(va.center=pa);Ia=va.distance;ma*=Ia;1E-6>Math.abs(Ia-ma)||(ma=e.scale(h.sv3d.get(),va.viewForward,ma),va.eye=e.subtract(pa,va.center,ma))};a.applyZoomToPoint=function(Ia,va,ma,ta){const Ea=h.sv3d.get();ma=1-ma;e.subtract(Ea,va,Ia.eye);const Ca=e.length(Ea);let ka=Ca*(1-ma);0<=ma&&ka<ta&&(ka=ta,ma=-(ka-Ca)/Ca);1E-6>Math.abs(Ca-ka)||(e.scale(Ea,Ea,ma),Ia.eye=e.add(pa,Ia.eye,Ea),Ia.center=e.lerp(pa,Ia.center,va,ma))};a.centroid=x;a.centroidOnSphere=function(Ia,va,ma){x(va,ma);e.normalize(ma,
ma);e.scale(ma,ma,Ia)};a.decideNavigationMode=function(Ia,va,ma,ta){if(e.length(Ia.eye)-ta.radius>F.Elevation)return a.NavigationMode.Horizontal;if(!ma)return a.NavigationMode.Vertical;n.fromScreenAtEye(Ia,va,Sa);return-p.sign(Ia.relativeElevation)*(.5*Math.PI+t.angle(Ia.eye,Sa.direction))<F.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.intersectPlaneFromScreenPoint=function(Ia,va,ma,ta){return c.intersectRay(Ia,n.fromScreen(va,ma,Ma),ta)};a.lengthFromPoints=D;a.normalizeCoordinate=
function(Ia,va,ma){ma[0]=va[0]/(Ia.fullWidth/Ia.pixelRatio);ma[1]=va[1]/(Ia.fullHeight/Ia.pixelRatio);return ma};a.normalizeRotationDelta=function(Ia){for(;Ia>Math.PI;)Ia-=2*Math.PI;for(;Ia<-Math.PI;)Ia+=2*Math.PI;return Ia};a.offSurfaceTiltToEyeTiltGlobal=function(Ia,va,ma,ta){return C(Math.PI/2,va,ma,ta)+(Ia-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=C;a.panMotionToRotationMatrix=function(Ia,va,ma,ta,Ea,Ca,ka,sa,Ja){if(H(Ia.center,e.dot(Ia.up,Ia.center),e.length(Ia.center),-m.cyclicalPI.normalize(p.deg2rad(Ca)),
ka,va))switch(Ia=-m.cyclicalPI.normalize(p.deg2rad(Ea)),{eye:Ea}=va,d.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Ea,ca,ba,Z),Ea=ma.translation[0]*ta.pan,Ca="zoom"===Ja.mode?0:ma.translation[1]*ta.pan,va=Math.max(Math.sqrt(Math.abs(1-e.dot(va.center,ca)**2/e.length(va.center)**2)),.5),ka=-Math.cos(Ia)*Ca+Math.sin(Ia)*Ea,q.rotate(sa.pan.matrix,sa.pan.matrix,(Math.sin(Ia)*Ca+Math.cos(Ia)*Ea)/va,ca),sa.pan.enabled=!0,Ja.mode){case "pan":q.rotate(sa.pan.matrix,sa.pan.matrix,ka,ba);sa.pan.enabled=
!0;break;case "zoom":sa.zoom=-ma.translation[1]*ta.zoom}else{{const {eye:Ta,viewRight:da}=va;va=e.cross(h.sv3d.get(),da,Ta);Ia=ma.translation[0]*ta.pan;0!==Ia&&(q.rotate(sa.pan.matrix,sa.pan.matrix,-Ia,va),sa.pan.enabled=!0);switch(Ja.mode){case "pan":ma=ma.translation[1]*ta.pan;0!==ma&&(q.rotate(sa.pan.matrix,sa.pan.matrix,ma,da),sa.pan.enabled=!0);break;case "zoom":sa.zoom=-ma.translation[1]*ta.zoom}}}};a.panToPosition=function(Ia,va,ma,ta,Ea,Ca,ka){H(ma,e.dot(va.up,ma),Ia[3],-m.cyclicalPI.normalize(p.deg2rad(Ea)),
Ca,va,L.Pole,L.Angle)?O(Ia,va,ma,ta,-m.cyclicalPI.normalize(p.deg2rad(Ea)),Ca,ka):J(Ia,va,ma,ta,Ca,ka)};a.pickPointAndInitSphere=function(Ia,va,ma,ta,Ea){const Ca=l.create(),ka=u.create();let sa=!0,Ja=!0;Ia.intersectScreen(ma,Ca)?ka[3]=e.length(Ca):(Ja=!1,ka[3]=va.aboveGround?Math.max(e.length(va.center),.9*Ea.radius):e.length(va.eye)-va.relativeElevation,ta?A(ka,va,ma,Ca):sa=z.intersectScreen(ka,va,ma,Ca));return{sphere:ka,scenePickPoint:sa?Ca:null,hasGeometryIntersection:Ja}};a.preserveHeadingThreshold=
H;a.rotatePointAroundTwoAxes=K;a.rotationAngleAndAxisDirectRotation=B;a.rotationAnglesAndAxesHeadingPreserving=G;a.rotationAnglesHeadingPreserving=E;a.rotationFromPointsAroundAxis=function(Ia,va,ma){const ta=h.sv3d.get(),Ea=h.sv3d.get(),Ca=h.sv3d.get();e.copy(Ea,Ia);e.copy(Ca,va);Ia=e.dot(Ea,ma);va=e.dot(Ca,ma);e.scale(ta,ma,Ia);e.subtract(Ea,Ea,ta);e.normalize(Ea,Ea);e.scale(ta,ma,va);e.subtract(Ca,Ca,ta);e.normalize(Ca,Ca);Ia=e.dot(Ea,Ca);e.cross(ta,ma,Ea);ma=e.dot(Ca,ta);return Math.atan2(ma,Ia)};
a.sphereOrPlanePointFromScreenPoint=A;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../projectionEllipsoid ../../chunks/boundedPlane ../../chunks/sphere".split(" "),function(a,p,b,r,q,y,f){function w(t){return{operations:t,value:t.create()}}function e(t,h,m=w(t)){m.operations=t;t.copy(h,m.value);return m}function l(t,h,m,n){return t.operations.setAltitudeAt(t.value,h,
m,n)}const g=2**50,d=r.create(),c={operations:null,value:null},u=r.create();a.altitudeAt=function(t,h){return t.operations.altitudeAt(t.value,h)};a.axisAt=function(t,h,m,n){return t.operations.axisAt(t.value,h,m,n)};a.closestPoint=function(t,h,m){return t.operations.closestPoint(t.value,h,m)};a.closestPointOnSilhouette=function(t,h,m){return t.operations.closestPointOnSilhouette(t.value,h,m)};a.coordinateSystemFromOneAxisAndNormalVector=function(t,h,m,n,z){b.copy(m,t);b.copy(u,h);b.normalize(u,u);
b.cross(n,u,m);b.cross(z,n,m)};a.create=function(t){const {value:h,operations:m}=t;return{operations:m,value:m.create(h)}};a.createFromOperations=w;a.createGlobal=function(t){return e(f.sphere,f.fromValues(0,0,0,q.getReferenceEllipsoid(t).radius))};a.createLocal=function(){return e(y.boundedPlane,y.fromValues([0,0,0],[g,0,0],[0,g,0]))};a.distanceToSilhouette=function(t,h){return t.operations.distanceToSilhouette(t.value,h)};a.elevate=function(t,h,m){return t.operations.elevate(t.value,h,m.value)};
a.fromValues=e;a.intersectRay=function(t,h,m){return t.operations.intersectRay(t.value,h,m)};a.intersectRayClosestSilhouette=function(t,h,m){return t.operations.intersectRayClosestSilhouette(t.value,h,m)};a.intersectsRay=function(t,h){return t.operations.intersectRay(t.value,h,null)};a.normalAt=function(t,h,m){return t.operations.axisAt(t.value,h,2,m)};a.setAltitudeAt=l;a.setAltitudeOfTransformation=function(t,h,m,n){h!==n&&p.copy(n,h);b.set(d,n[12],n[13],n[14]);l(t,d,m,d);n[12]=d[0];n[13]=d[1];n[14]=
d[2];return n};a.setExtent=function(t,h,m){t.operations.setExtent(t.value,h,m.value);return m};a.vectorCoordinates=function(t,h,m,n,z){z[0]=b.dot(t,h);z[1]=b.dot(t,m);z[2]=b.dot(t,n);return z};a.wrap=function(t,h){c.operations=t;c.value=h;return c};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks".split(" "),
function(a,p,b,r,q,y,f){function w(l,g,d=y.create()){const c=b.castRenderScreenPointArray3(r.copy(f.sv3d.get(),g));c[2]=0;if(!l.unprojectFromRenderScreen(c,d.origin))return null;g=b.castRenderScreenPointArray3(r.copy(f.sv3d.get(),g));g[2]=1;l=l.unprojectFromRenderScreen(g,f.sv3d.get());if(p.isNone(l))return null;q.subtract(d.direction,l,d.origin);return d}function e(l,g,d=y.create()){q.copy(d.origin,l.eye);g=q.set(f.sv3d.get(),g[0],g[1],1);l=l.unprojectFromRenderScreen(g,f.sv3d.get());if(p.isNone(l))return null;
q.subtract(d.direction,l,d.origin);return d}a.fromRender=w;a.fromRenderAtEye=e;a.fromScreen=function(l,g,d=y.create()){return w(l,l.screenToRender(g,b.castRenderScreenPointArray3(f.sv3d.get())),d)};a.fromScreenAtEye=function(l,g,d=y.create()){return e(l,l.screenToRender(g,b.castRenderScreenPointArray3(f.sv3d.get())),d)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports","../../../../geometry/support/ray","../../../../chunks/sphere",
"./ray"],function(a,p,b,r){const q=p.create();a.intersectScreen=function(y,f,w,e){f=r.fromScreenAtEye(f,w,q);return b.intersectRay(y,f,e)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../support/featureFlags ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){a.ZoomStepController=function(z){function k(){var x=z.apply(this,arguments)||this;x.zoomLocation=g.create();x.tmpCamera=new t;x.tmpRayDir=g.create();x.tmpCenter=g.create();x.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new t,interactionDirection:null,tiltMode:0};return x}p._inheritsLoose(k,z);var v=k.prototype;v.zoomStep=function(x,C){if(this.active){var A=this.view.state,{interactionStartCamera:B}=this.constraintOptions;
this.animation.finished?B.copyFrom(A.camera):this.animation.cameraAt(1,B);this.tmpCamera.copyFrom(A.camera);A=new h.Intersector(this.view.state.viewingMode);0<x?(this.intersectionHelper.intersectScreenFreePointFallback(C,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,A,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,A,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:l.copy(this.zoomLocation,this.tmpCamera.center);
x=.6**x;!d.disableContextNavigation()&&(C=this.view._stage.renderView.getMinimalDepthForArea(C[0],C[1],this.view.state.camera,60),A=Math.max(14*Math.abs(this.view.camera.position.z),20),C=C?Math.min(C,A):A)&&(A=g.create(),l.subtract(A,this.zoomLocation,this.tmpCamera.eye),C<l.length(A)&&(l.normalize(A,A),l.add(this.zoomLocation,this.tmpCamera.eye,l.scale(A,A,C))));this.updateCamera(this.tmpCamera,x,this.zoomLocation);this.begin(this.tmpCamera)}};v.animationSettings=function(){return{apex:null,duration:r.Milliseconds(600),
easing:m.outExpo}};v.updateCamera=function(x,C,A){l.subtract(this.tmpRayDir,A,x.eye);const B=l.length(this.tmpRayDir);let D=B*C;1>=C&&4>D&&(D=4,C=D/B);1E-6>Math.abs(B-D)||(l.scale(this.tmpRayDir,this.tmpRayDir,C),x.eye=l.subtract(n,A,this.tmpRayDir),x.center=l.lerp(n,x.center,A,1-C),c.applyAll(this.view,x,this.constraintOptions))};return k}(u.PointToPointAnimationController);a.ZoomStepController=b.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);
const n=g.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(p,b){if("touch"===p.pointerType)return!1;switch(b){case "primary":return 0===p.button;case "secondary":return 2===p.button;case "tertiary":return 1===p.button}};a.eventMatchesPointerAction=function(p,b){switch(b){case "primary":return"touch"===p.pointerType||0===p.button;case "secondary":return"touch"!==p.pointerType&&
2===p.button;case "tertiary":return"touch"!==p.pointerType&&1===p.button}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,p,b,r,q,y){q=function(f){function w(e,l,g,d){var c=f.call(this,!0)||this;c.view=e;c.pointerAction=l;c.pivot=
g;c.registerIncoming("drag",d,u=>c.handleDrag(u));return c}p._inheritsLoose(w,f);w.prototype.handleDrag=function(e){const l=e.data;if(!(1<l.pointers.size)&&y.eventMatchesMousePointerAction(e.data,this.pointerAction)){var g=b.createScreenPointArray(l.center.x,l.center.y);switch(l.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new r.RotateController({view:this.view,pivot:this.pivot});this.view.state.switchCameraController(this.cameraController);
this.cameraController.begin(g);break;case "update":this.cameraController&&this.cameraController.update(g);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}};return w}(q.InputHandler);a.DragRotate=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v){a.RotateController=function(C){function A(D){D=C.call(this,D)||this;D.view=null;D.pivot=0;D.lastPoint=u.create();D.tmpWorldUp=h.create();D.tmpViewDir=h.create();D.tmpRotCurPoint=u.create();D.tmpTransf=d.create();D.tmpAxis=h.create();D.tmpPivotPoint=h.create();D.pivotPos=h.create();D.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};return D}p._inheritsLoose(A,C);
var B=A.prototype;B.initialize=function(){this.rotScale=0===this.pivot?3:1.5};B.begin=function(D){if(this.active){switch(this.pivot){case 1:t.copy(this.pivotPos,this.startCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case 0:this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos)||t.copy(this.pivotPos,this.startCamera.center),r("disable-feature:context-navigation")||this.constrainPivotPoint(D),
this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.startCamera;v.normalizeCoordinate(this.startCamera,D,this.lastPoint)}};B.constrainPivotPoint=function(D){const E=this.startCamera,G=h.create();t.subtract(G,this.pivotPos,E.eye);let K=t.length(G);this.view.camera.position.hasZ&&(K=Math.min(K,7*Math.abs(this.view.camera.position.z)));var M=m.getReferenceEllipsoid(this.view.spatialReference),
H=y.createScreenPointArray(E.width/E.pixelRatio*.5,E.height/E.pixelRatio*.5);M=v.decideNavigationMode(this.startCamera,H,!0,M);H=this.view._stage.renderView.getMinimalDepthForArea(E.fullWidth/E.pixelRatio*.5,E.fullHeight/E.pixelRatio*.5,E,225,90);D=this.view._stage.renderView.getMinimalDepthForArea(D[0],D[1],E,90);if(void 0!==H||void 0!==D)H=void 0===H?D:H,D=void 0===D||M===v.NavigationMode.Horizontal?H:D,K=H>D?D:H;t.normalize(G,G);t.copy(this.pivotPos,t.add(this.tmpPivotPoint,E.eye,t.scale(this.tmpPivotPoint,
G,K)))};B.update=function(D){if(this.active){switch(this.pivot){case 1:this.currentCamera.center=this.applyRotation(this.currentCamera,D,this.currentCamera.center,this.pivotPos);break;case 0:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this.applyRotation(this.currentCamera,D,this.currentCamera.eye,this.pivotPos)}n.applyAll(this.view,this.currentCamera,this.constraintOptions)}};B.end=function(){this.active&&this.finishController()};B.applyRotation=function(D,E,G,K){this.view.renderCoordsHelper.worldUpAtPosition(K,
this.tmpWorldUp);v.normalizeCoordinate(D,E,this.tmpRotCurPoint);E=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;let M=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;t.subtract(this.tmpViewDir,G,K);G=t.length(this.tmpViewDir);G=q.acosClamped(t.dot(this.tmpViewDir,this.tmpWorldUp)/G);if(1===this.pivot){const H=.5*Math.PI-G,J=.495*Math.PI;E=H-Math.max(-J,Math.min(J,H+-.5*E))}E=q.clamp(E+G,z.TiltDefault.min,z.TiltDefault.max)-G;g.identity(this.tmpTransf);t.cross(this.tmpAxis,D.up,
this.tmpViewDir);0===this.pivot&&(M=-M);g.rotate(this.tmpTransf,this.tmpTransf,M,this.tmpWorldUp);g.rotate(this.tmpTransf,this.tmpTransf,E,this.tmpAxis);t.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);D.up=t.transformMat4(x,D.up,this.tmpTransf);t.add(x,K,this.tmpViewDir);c.copy(this.lastPoint,this.tmpRotCurPoint);return x};p._createClass(A,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return A}(k.InteractiveController);b.__decorate([f.property({constructOnly:!0})],
a.RotateController.prototype,"view",void 0);b.__decorate([f.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=b.__decorate([l.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const x=h.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,p,b,r,q,y,f,w,e,l){a.InteractiveController=function(g){function d(){var u=g.apply(this,arguments)||this;u.startCamera=new l;u.currentCamera=new l;return u}p._inheritsLoose(d,g);var c=d.prototype;c.stepController=function(u,t){t.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(t)};c.onControllerStart=function(u){this.state=e.State.Running;this.startCamera.copyFrom(u);this.currentCamera.copyFrom(u)};c.onControllerEnd=function(u){u.copyViewFrom(this.currentCamera)};p._createClass(d,
[{key:"isInteractive",get:function(){return!0}}]);return d}(e.CameraController);a.InteractiveController=b.__decorate([w.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,p,b,r,q,y,f){y=function(w){function e(l,g,d){var c=w.call(this,!0)||this;c.view=l;c.pointerAction=g;c.registerIncoming("drag",d,u=>c.handleDrag(u));return c}p._inheritsLoose(e,w);e.prototype.handleDrag=function(l){const g=l.data;if(!(1<g.pointers.size)&&f.eventMatchesMousePointerAction(l.data,this.pointerAction)){var d=b.createScreenPointArray(g.center.x,g.center.y);switch(g.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
this.view.state.isGlobal?new r.ZoomController({view:this.view}):new q.ZoomController({view:this.view});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}l.stopPropagation()}};return e}(y.InputHandler);a.DragZoom=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v){a.ZoomController=function(C){function A(D){D=C.call(this,D)||this;D.view=null;D.pickPoint=c.create();D.tmpP0=g.create();D.panAxisAngle=t.create();D.tmpRayDir=c.create();D.targetOnSphere=c.create();D.tmpRay={origin:c.create(),direction:c.create()};D.dragBeginPoint=q.createScreenPointArray();D.normalizedAnchorPoint=g.create();D.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};D.sphere=h.create();D.hasPickPoint=!1;return D}p._inheritsLoose(A,C);var B=A.prototype;B.begin=function(D){if(this.active){l.copy(this.dragBeginPoint,D);z.normalizeCoordinate(this.startCamera,D,this.normalizedAnchorPoint);var E=u.getReferenceEllipsoid(this.view.spatialReference),G=z.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,D,!1,E);this.navMode=z.decideNavigationMode(this.startCamera,D,G.hasGeometryIntersection,E);if(this.navMode===z.NavigationMode.Horizontal||r("disable-feature:context-navigation"))this.hasPickPoint=
!!G.scenePickPoint,this.pickPoint=G.scenePickPoint,this.sphere=G.sphere;else{k.fromScreenAtEye(this.startCamera,D,this.tmpRay);d.normalize(this.tmpRay.direction,this.tmpRay.direction);let K;this.view.camera.position.hasZ&&(K=Math.abs(this.view.camera.position.z));E=30*K;D=this.view._stage.renderView.getMinimalDepthForArea(D[0],D[1],this.view.state.camera,70);E=E>D?D:E;this.hasPickPoint=!0;d.scale(this.tmpRay.direction,this.tmpRay.direction,E);d.add(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=
this.startCamera}};B.update=function(D){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this.navMode===z.NavigationMode.Horizontal||r("disable-feature:context-navigation")){d.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var E=d.length(this.tmpRayDir);z.normalizeCoordinate(this.currentCamera,D,this.tmpP0);var G=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),K=E*
2**G;const M=this.view.state.constraints.minimumPoiDistance;0>G&&K<M&&(K=M);if(1E-6>Math.abs(E-K))return;this.hasPickPoint&&K<E&&(G=1-(1-K/E)*(1-this.sphere[3]/d.length(this.currentCamera.center)),this.currentCamera.center=d.scale(x,this.currentCamera.center,G));d.scale(this.tmpRayDir,this.tmpRayDir,-K/E);this.currentCamera.eye=d.add(x,this.currentCamera.center,this.tmpRayDir);this.constraintOptions.interactionFactor=m.pixelDistanceToInteractionFactor(this.dragBeginPoint,D);m.applyAll(this.view,this.currentCamera,
this.constraintOptions);this.hasPickPoint&&(z.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),t.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),z.applyRotation(this.currentCamera,this.sphere,this.panAxisAngle))}else{E=d.length(this.tmpRay.direction);z.normalizeCoordinate(this.currentCamera,D,this.tmpP0);D=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);K=E*2**D;G=this.view.state.constraints.minimumPoiDistance;0>D&&K<G&&(K=
G);if(1E-6>Math.abs(E-K))return;d.scale(this.tmpRayDir,this.tmpRay.direction,1-K/E);this.currentCamera.eye=d.add(x,this.currentCamera.eye,this.tmpRayDir);this.currentCamera.center=d.add(x,this.currentCamera.center,this.tmpRayDir)}v.applySurfaceCollisionConstraint(this.view,this.currentCamera)}};B.end=function(){this.active&&this.finishController()};p._createClass(A,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return A}(n.InteractiveController);b.__decorate([y.property({constructOnly:!0})],
a.ZoomController.prototype,"view",void 0);a.ZoomController=b.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const x=c.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n){a.ZoomController=function(k){function v(C){C=k.call(this,C)||this;C.view=null;C.tmpP=u.create();C.tmpDir=u.create();C.tmpN=u.create();C.tmpP0=d.create();C.tmpPoi=u.create();C.tmpRayDir=u.create();C.dragBeginPoint=q.createScreenPointArray();C.normalizedAnchorPoint=d.create();C.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:u.create(),tiltMode:0};C.plane=t.create();return C}p._inheritsLoose(v,
k);var x=v.prototype;x.begin=function(C){if(this.active){g.copy(this.dragBeginPoint,C);n.normalizeCoordinate(this.startCamera,C,this.normalizedAnchorPoint);this.intersectionHelper.intersectScreenFreePointFallback(C,this.tmpP);c.subtract(this.tmpDir,this.tmpP,this.startCamera.eye);c.normalize(this.tmpDir,this.tmpDir);var A;this.view.camera.position.hasZ&&(A=Math.abs(this.view.camera.position.z));A*=30;C=this.view._stage.renderView.getMinimalDepthForArea(C[0],C[1],this.view.state.camera,70);c.scale(this.tmpDir,
this.tmpDir,A>C?C:A);c.add(this.tmpP,this.startCamera.eye,this.tmpDir);c.subtract(this.tmpN,this.startCamera.eye,this.startCamera.center);c.normalize(this.tmpN,this.tmpN);0>this.tmpN[1]&&c.negate(this.tmpN,this.tmpN);t.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane);this.constraintOptions.interactionStartCamera=this.startCamera}};x.update=function(C){if(this.active){n.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||c.copy(this.tmpPoi,this.currentCamera.center);
n.normalizeCoordinate(this.currentCamera,C,this.tmpP0);var A=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);g.copy(this.normalizedAnchorPoint,this.tmpP0);c.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var B=c.length(this.tmpRayDir),D=B*(1-A);c.copy(this.constraintOptions.interactionDirection,this.tmpRayDir);c.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,r.sign(A)/B);var E=this.view.state.constraints.minimumPoiDistance;0<=A&&D<E&&(D=
E,A=-(D-B)/B);1E-6>Math.abs(B-D)||(c.scale(this.tmpRayDir,this.tmpRayDir,A),this.currentCamera.eye=c.add(z,this.currentCamera.eye,this.tmpRayDir),c.lerp(z,this.currentCamera.center,this.tmpPoi,A),z[2]=this.tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],z[2]):Math.min(this.startCamera.center[2],z[2]),this.currentCamera.center=z,this.constraintOptions.interactionFactor=h.pixelDistanceToInteractionFactor(this.dragBeginPoint,C),h.applyAll(this.view,this.currentCamera,this.constraintOptions))}};
x.end=function(){this.active&&this.finishController()};p._createClass(v,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return v}(m.InteractiveController);b.__decorate([y.property({constructOnly:!0})],a.ZoomController.prototype,"view",void 0);a.ZoomController=b.__decorate([l.subclass("esri.views.3d.state.controllers.local.ZoomController")],a.ZoomController);const z=u.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(a,p,b,r,q,y){y=function(f){function w(l){var g=f.call(this,!0)||this;g.view=l;g.watchHandles=new b;g.handle=g.registerIncoming("gamepad",d=>g.handleEventGamepad(d));g.handle.pause();return g}p._inheritsLoose(w,f);var e=w.prototype;e.onInstall=function(l){f.prototype.onInstall.call(this,l);this.watchHandles.add([r.init(this.view.navigation.gamepad,"enabled",g=>{g?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=
null))}),this.view.navigation.gamepad.watch("device",g=>{this.cameraControllerGamepad&&g&&this.cameraControllerGamepad.gamepadDevice!==g&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])};e.onUninstall=function(){this.watchHandles.removeAll();f.prototype.onUninstall.call(this)};e.handleEventGamepad=function(l){var g=this.view.navigation.gamepad.device;if(!g||l.data.device===g)if((g=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||q.GamepadKeyboardController.activatesFor(this.view,
l.data))g||(g=new q.GamepadKeyboardController({view:this.view,gamepadDevice:l.data.device}),this.view.state.switchCameraController(g)&&(this.cameraControllerGamepad=g)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===l.data.device&&this.cameraControllerGamepad.handleEventGamepad(l.data)};return w}(y.InputHandler);a.GamepadNavigation=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G){a.GamepadKeyboardController=function(N){function R(P){P=N.call(this,P)||this;P.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};P.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];P.tmpCamera=new E;P.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new E,interactionFactor:0,interactionDirection:null,tiltMode:1};return P}p._inheritsLoose(R,N);var S=R.prototype;S.handleEventGamepad=function(P){const Q=G.extractTransformation(P,
this.view.navigation.gamepad,this.transformation);("end"===P.action||G.isZeroTransformation(Q))&&this.finishController()};S.activateDirection=function(P){this.keysButtonState[P]=1;G.extractTransformationKeyboard(this.keysButtonState,this.transformation)};S.deactivateDirection=function(P){this.keysButtonState[P]=0;P=G.extractTransformationKeyboard(this.keysButtonState,this.transformation);G.isZeroTransformation(P)&&this.finishController()};S.onControllerStart=function(P){this.filteredSurfaceElevation=
this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;N.prototype.onControllerStart.call(this,P)};S.updateFilteredSurfaceElevation=function(P){this.filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*P};S.stepController=function(P,Q){this.updateStartHeading();this.updateFilteredSurfaceElevation(P);this.currentCamera.copyViewFrom(Q);this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);
this.calculateControlTransformation(P,this.currentCamera,O);this.applyDisabledMovementTypes(O);this.applyPan(O.pan);this.applyRotate(O.rotate);this.applyZoom(O.zoom);this.applyAscend(O.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;k.applyAll(this.view,this.currentCamera,this.constraintOptions);N.prototype.stepController.call(this,P,Q)};S.updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};S.applyRotate=
function(P){if(P.enabled){var Q=this.currentCamera;u.subtract(I,Q.center,Q.eye);u.transformMat4(I,I,P.matrix);Q.center=u.add(I,I,Q.eye);Q.up=u.transformMat4(I,Q.up,P.matrix);this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;k.applyAll(this.view,Q,this.constraintOptions)}};S.applyPan=function(P,Q=this.currentCamera){P.enabled&&(Q.eye=u.transformMat4(I,Q.eye,P.matrix),Q.center=u.transformMat4(I,Q.center,P.matrix),this.view.state.isGlobal&&(Q.up=u.transformMat4(I,Q.up,P.matrix)),
this.constraintOptions.interactionType=4,this.constraintOptions.selection=15,k.applyAll(this.view,Q,this.constraintOptions))};S.applyZoom=function(P){if(P){var Q=this.currentCamera.viewForward;this.currentCamera.eye=u.add(I,this.currentCamera.eye,u.scale(z.sv3d.get(),Q,P));u.copy(F,Q);u.negate(F,F);this.constraintOptions.interactionDirection=F;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;k.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=
null}};S.applyAscend=function(P){if(P){var Q=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,z.sv3d.get());this.constraintOptions.interactionDirection=u.copy(F,Q);this.view.state.isGlobal?(Q=u.length(this.currentCamera.eye),P=(Q+P)/Q,this.currentCamera.eye=u.scale(I,this.currentCamera.eye,P),this.currentCamera.center=u.scale(I,this.currentCamera.center,P)):(P=u.scale(z.sv3d.get(),Q,P),this.currentCamera.eye=u.add(I,this.currentCamera.eye,P),this.currentCamera.center=u.add(I,
this.currentCamera.center,P));this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;k.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;k.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};S.calculateControlTransformation=function(P,Q,V){V.zoom=0;V.ascend=0;V.pan.enabled=!1;d.identity(V.pan.matrix);V.rotate.enabled=
!1;d.identity(V.rotate.matrix);P=this.computeVelocities(P);this.view.state.isLocal?this.calculateControlTransformationLocal(P,Q,V):this.calculateControlTransformationGlobal(P,Q,V)};S.updateCameraCenter=function(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,I)};S.calculateControlTransformationLocal=function(P,Q,V){const {viewRight:ca,viewForward:ba}=Q,Z=this.transformation;
var ha=this.view.navigation.gamepad,fa=u.set(z.sv3d.get(),ba[0],ba[1],0);u.normalize(fa,fa);var aa=Z.translation[0]*P.pan;0!==aa&&(aa=u.scale(z.sv3d.get(),ca,aa),d.translate(V.pan.matrix,V.pan.matrix,aa),V.pan.enabled=!0);switch(ha.mode){case "pan":ha=-Z.translation[1]*P.pan;0!==ha&&(fa=u.scale(z.sv3d.get(),fa,ha),d.translate(V.pan.matrix,V.pan.matrix,fa),V.pan.enabled=!0);V.zoom=Z.zoom*P.zoom;break;case "zoom":V.zoom=(-Z.translation[1]+Z.zoom)*P.zoom;break;default:r.neverReached(ha.mode)}V.ascend=
Z.translation[2]*P.ascend;fa=-Z.heading*P.rotate;0!==fa&&(d.rotate(V.rotate.matrix,V.rotate.matrix,fa,this.view.renderCoordsHelper.worldUpAtPosition(Q.eye,z.sv3d.get())),V.rotate.enabled=!0);P=Z.tilt*P.rotate;Q=A.viewAngle(this.view.renderCoordsHelper,Q.center,Q.eye);if(Q=q.clamp(Q+P,v.TiltDefault.min,v.TiltDefault.max)-Q)d.rotate(V.rotate.matrix,V.rotate.matrix,Q,ca),V.rotate.enabled=!0};S.calculateControlTransformationGlobal=function(P,Q,V){const {eye:ca,viewRight:ba}=Q,Z=this.transformation;var ha=
this.view.navigation.gamepad,fa=u.cross(z.sv3d.get(),ba,ca);u.normalize(fa,fa);u.negate(fa,fa);C.panMotionToRotationMatrix(this.startCamera,Q,Z,P,this.view.camera.heading,this.headingStart,this.view.camera.tilt,V,ha);this.tmpCamera.copyFrom(this.currentCamera);this.applyPan(O.pan,this.tmpCamera);ha=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;V.ascend=Z.translation[2]*P.ascend;fa=-Z.heading*P.rotate;0!==fa&&(d.rotate(V.rotate.matrix,V.rotate.matrix,fa,this.tmpCamera.eye),
V.rotate.enabled=!0);Q=this.clampTiltDeltaGlobalToValidRange(Z.tilt*P.rotate,Q.ray,ha);0!==Q&&(d.rotate(V.rotate.matrix,V.rotate.matrix,Q,this.tmpCamera.viewRight),V.rotate.enabled=!0);V.zoom+=Z.zoom*P.zoom};S.clampTiltDeltaGlobalToValidRange=function(P,Q,V){const ca=h.getReferenceEllipsoid(this.view.spatialReference),ba=C.onSurfaceTiltToEyeTiltGlobal(v.TiltDefault.min,Q.origin,V,ca);var Z=0;let ha=0;Z=z.sv3d.get();this.view.renderCoordsHelper.intersectManifold(Q,V,Z)?(Z=A.viewAngle(this.view.renderCoordsHelper,
Z,Q.origin),Z=C.onSurfaceTiltToEyeTiltGlobal(Z,Q.origin,V,ca),ha=C.onSurfaceTiltToEyeTiltGlobal(v.TiltDefault.max,Q.origin,V,ca)):(n.closestPointOnSilhouette(n.fromRadius(V+ca.radius),Q,Z),Z=q.acosClamped(-u.dot(Q.direction,u.normalize(Z,Z))),Z=C.offSurfaceTiltToEyeTiltGlobal(Z,Q.origin,V,ca),ha=C.offSurfaceTiltToEyeTiltGlobal(v.TiltDefault.max,Q.origin,V,ca));return q.clamp(Z+P,ba,ha)-Z};S.getPointAbsoluteSurfaceElevation=function(P,Q,V){const {renderCoordsHelper:ca}=this.view,ba=ca.getAltitude(P);
Q+=Math.abs(ba-Q);ca.setAltitude(V,Q,P);return Q};S.clampedDistanceToSurface=function(P,Q){const {renderCoordsHelper:V}=this.view,{camera:ca}=this.view.state;var {direction:ba}=B.headingTiltToDirectionUp(this.view,Q,0,80,L);ba=V.intersectManifoldClosestSilhouette(m.wrap(Q,ba),P,z.sv3d.get());ba=u.distance(Q,ba);P=V.intersectManifoldClosestSilhouette(m.wrap(Q,u.direction(z.sv3d.get(),Q,ca.center)),P,z.sv3d.get());Q=u.distance(Q,P);return Math.min(ba,Q)};S.computeHeadingRotateRadius=function(P){const {renderCoordsHelper:Q,
state:V}=this.view,{camera:ca,isGlobal:ba}=V;var Z=Q.intersectManifoldClosestSilhouette(ca.ray,this.filteredSurfaceElevation,z.sv3d.get());if(ba){const ha=u.subtract(z.sv3d.get(),P,Z);Z=u.length(ha);u.scale(ha,ha,1/Z);P=u.normalize(z.sv3d.get(),P);P=q.acosClamped(u.dot(P,ha));return Z*Math.sin(Math.min(M,P))}P=u.copy(z.sv3d.get(),P);Q.setAltitude(P,this.filteredSurfaceElevation);return u.distance(Z,P)};S.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:5};S.computeVelocities=
function(P){var Q=this.filteredSurfaceElevation,V=Q+h.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:ca,isGlobal:ba}=this.view.state;var Z=z.sv3d.get();const ha=this.getPointAbsoluteSurfaceElevation(ca.eye,Q,Z);var fa=this.clampedDistanceToSurface(Q,Z);const aa=ca.width/2,W=.75*ca.width,U=.75*ca.width;var X=fa*Math.tan(.5*ca.fovX)/aa;V=X/V;Z=X/this.computeHeadingRotateRadius(Z);X=(ba?V:X)*W*P;Q=ha-Q;Q=Math.max(this.minimumAscendVelocity()*P,2**(W*P/aa)*Q-Q);fa=2**(W*P/aa)*
fa-fa;P*=q.clamp(Z*U,H,J);return{pan:X,ascend:Q,zoom:fa,rotate:P}};S.applyDisabledMovementTypes=function(P){!y.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(P.zoom=this.disableMovements.zoom?0:P.zoom,P.ascend=this.disableMovements.ascend?0:P.ascend,P.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&d.identity(P.pan.matrix),P.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&d.identity(P.rotate.matrix))};
R.activatesFor=function(P,Q){P=G.extractTransformation(Q,P.navigation.gamepad,K);return!("end"===Q.action||G.isZeroTransformation(P))};return R}(x.InteractiveController);b.__decorate([f.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"view",void 0);b.__decorate([f.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);b.__decorate([f.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=
b.__decorate([g.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],a.GamepadKeyboardController);const K={translation:[0,0,0],heading:0,tilt:0,zoom:0},M=q.deg2rad(80),H=q.deg2rad(30),J=q.deg2rad(80),O={zoom:0,ascend:0,pan:{enabled:!1,matrix:c.create()},rotate:{enabled:!1,matrix:c.create()}},I=t.create(),F=t.create(),L=D.createDirectionUp();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Point ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ./mathUtils ../../support/spatialReferenceSupport".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v){function x(fa){return"global"===fa.viewingMode?m.cameraUtilsSpherical:h.cameraUtilsPlanar}function C(fa,aa,W){const U=fa.state.camera,X=U.width/2/U.pixelRatio;1===fa.renderCoordsHelper.viewingMode&&null!=W&&(aa*=Math.cos(q.deg2rad(W)));aa/=fa.renderCoordsHelper.unitInMeters;return X/(96*39.37/aa)/Math.tan(U.fovX/2)}function A(fa,aa,W){const U=fa.state.camera;aa=96*39.37/(U.width/2/U.pixelRatio/(aa*Math.tan(U.fovX/2)));1===fa.renderCoordsHelper.viewingMode&&
(aa/=Math.cos(q.deg2rad(W)));return aa*=fa.renderCoordsHelper.unitInMeters}function B(fa,aa,W,U,X,T){if(N(T)){const Y=new ha(T.signal);O(fa,U.heading,U.tilt,aa,W,X,Y);Y.resolver.promise.then(ea=>{ea=L(fa,ea,U.fov);if(y.isNone(ea))T.resolver.reject();else return T.resolver.resolve(ea)},ea=>T.resolver.reject(ea))}else return aa=O(fa,U.heading,U.tilt,aa,W,X),L(fa,aa,U.fov,T)}function D(fa,aa,W,U,X){return x(fa).directionToHeadingTilt(aa,W,U,X)}function E(fa,aa){return!!(fa.basemapTerrain&&fa.renderCoordsHelper.fromRenderCoords(aa,
V,fa.spatialReference)&&y.unwrapOr(z.getElevationAtPoint(fa.elevationProvider,V),0)>V.z-1)}function G(fa,aa,W){return K.apply(this,arguments)}function K(){K=p._asyncToGenerator(function*(fa,aa,W){if(!fa.renderCoordsHelper.fromRenderCoords(aa,V,fa.spatialReference))return!1;fa=yield fa.elevationProvider.queryElevation(V.x,V.y,V.z,V.spatialReference,"ground",W);return y.unwrapOr(fa,0)>V.z-1});return K.apply(this,arguments)}function M(fa,aa,W){return H.apply(this,arguments)}function H(){H=p._asyncToGenerator(function*(fa,
aa,W){const U=e.create();aa?aa instanceof l?(g.projectPointToVector(aa,U,fa.renderSpatialReference),null==aa.z&&null!=fa.basemapTerrain&&(aa=yield fa.elevationProvider.queryElevation(aa.x,aa.y,aa.z,aa.spatialReference,"ground",W),y.isSome(aa)&&fa.renderCoordsHelper.setAltitude(U,aa))):w.copy(U,aa):w.copy(U,fa.state.camera.center);return U});return H.apply(this,arguments)}function J(fa,aa){const W=e.create();aa&&aa instanceof l?(g.projectPointToVector(aa,W,fa.renderSpatialReference),null==aa.z&&null!=
fa.basemapTerrain&&(aa=z.getElevationAtPoint(fa.elevationProvider,aa),y.isSome(aa)&&fa.renderCoordsHelper.setAltitude(W,aa))):aa?w.copy(W,aa):w.copy(W,fa.state.camera.center);return W}function O(fa,aa,W,U,X,T,Y){const ea=U&&U instanceof l?U:null;if(N(Y))return M(fa,U,Y.signal).then(ia=>{I(fa,aa,W,ea,ia,X,T,Y)},ia=>Y.resolver.reject(ia)),null;U=J(fa,U);return I(fa,aa,W,ea,U,X,T,Y)}function I(fa,aa,W,U,X,T,Y,ea){if(y.isNone(U)&&(U=g.projectVectorToPoint(X,fa.renderSpatialReference,fa.spatialReference||
c.WGS84),y.isNone(U)))return null;T=Math.max(T,fa.state.constraints.minimumPoiDistance);var ia=F(fa,aa,W,X,T,Y);const la=x(fa).eyeForCenterWithHeadingTilt,pa=la(X,T,ia.heading,ia.tilt);if(1===Y&&"global"===fa.viewingMode&&0<W){const ua=()=>{var wa=T,Fa=T;var La=fa.state.constraints.tilt(Fa);Fa=x(fa).eyeTiltToLookAtTilt(W,X,Fa);Fa=Math.min(Fa,.5*Math.PI);La=La.min*(1-.7)+.7*Fa;wa=x(fa).lookAtTiltToEyeTilt(La,X,wa);Y=1>W-wa?0:1;return I(fa,aa,wa,U,X,T,Y,ea)};ia=fa.map.ground.navigationConstraint;if(!ia||
"stay-above"===ia.type){if(E(fa,pa.eye))return ua();if(N(ea))return G(fa,pa.eye,ea.signal).then(wa=>{if(wa)return ua();ea.resolver.resolve({eye:pa.eye,up:pa.up,center:e.clone(X),heading:pa.heading,tilt:pa.tilt});return null}),null}}ia=!ea||N(ea)?{center:e.create(),eye:e.create(),up:e.create(),tilt:0,heading:0}:ea;ia.eye=pa.eye;ia.up=pa.up;ia.center=e.clone(X);ia.heading=pa.heading;ia.tilt=pa.tilt;N(ea)&&ea.resolver.resolve(ia);return ia}function F(fa,aa,W,U,X,T){var Y=0;if(T=1===T)if(Y=fa.pointsOfInterest.centerOnSurfaceFrequent.distance,
8<Math.log(X/Y)/Math.LN2)T=!0;else{var ea=fa.renderSpatialReference,ia=fa.spatialReference||c.WGS84;T=g.projectVectorToPoint(U,ea,ia);ea=g.projectVectorToPoint(fa.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,ea,ia);y.isNone(T)||y.isNone(ea)?T=!1:(Y*=Math.tan(.5*fa.state.camera.fov),T=5<ea.distance(T)/Y)}T?(aa=0,T=fa.state.constraints.tilt(X),T.max=Math.min(T.max,.5*Math.PI),T=T.min*(1-.7)+.7*T.max,W=x(fa).eyeTiltToLookAtTilt(W,U,X),Y=Math.min(W,T)):Y=x(fa).eyeTiltToLookAtTilt(W,U,X);W=
Y=fa.state.constraints.clampTilt(X,Y);W=x(fa).lookAtTiltToEyeTilt(W,U,X);return{heading:aa,tilt:W}}function L(fa,aa,W,U){if(y.isNone(aa))return null;fa=g.projectVectorToPoint(aa.eye,fa.renderSpatialReference,fa.spatialReference||c.WGS84);return y.isNone(fa)?null:y.isSome(U)?(U.position=fa,U.heading=aa.heading,U.tilt=aa.tilt,U.fov=W,U):new b(fa,aa.heading,aa.tilt,W)}function N(fa){return fa&&"resolver"in fa}const R=r.getLogger("esri.views.3d.support.cameraUtils"),S=e.create(),P=e.create(),Q={heading:0,
tilt:0},V=new l,ca=new k.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),ba=new k.Cyclical(-180,180),Z=e.create();let ha=function(fa){this.signal=fa;this.resolver=f.createResolver()};a.AsyncContext=ha;a.computeScale=function(fa,aa,W){const U=fa.renderSpatialReference;aa||(aa=fa.state.camera);var X=c.WGS84;aa instanceof b?(X=aa.position.latitude,g.projectPointToVector(aa.position,S,U),g.projectPointToVector(W,P,U),aa=w.distance(S,P)):(g.projectVectorToVector(aa.center,U,P,X),X=P[1],aa=aa.distance);
return A(fa,aa,X)};a.directionToHeadingTilt=D;a.distanceToScale=A;a.externalToInternal=function(fa,aa){if(y.isNone(aa))return null;var W=fa.renderSpatialReference;const U=x(fa).headingTiltToDirectionUp,X=e.create();if(!g.projectPointToVector(aa.position,X,W))return null;W=U(X,aa.heading,aa.tilt);w.scale(W.direction,W.direction,fa.state.camera.distance);w.add(W.direction,W.direction,X);fa=t.cameraOnContentAlongViewDirection(fa,X,W.direction,W.up);fa.fov=q.deg2rad(aa.fov);return fa};a.fromCenterDistance=
B;a.fromCenterScale=function(fa,aa,W,U,X,T){W=C(fa,W,aa.latitude);return B(fa,aa,W,U,X,T)};a.fromExtent=function(fa,aa,W,U,X,T=null){var Y=null!=aa.zmax&&null!=aa.zmin;let ea;if("global"===fa.viewingMode){if(!v.isSpatialReferenceSupported(aa.spatialReference,"global"))return N(T)&&T.resolver.reject(),null;var ia=new l(aa.xmin,aa.ymin,aa.spatialReference);const ua=new l(aa.xmax,aa.ymax,aa.spatialReference),wa=aa.spatialReference.isGeographic?ba:ca;var la=new l({x:wa.center(ia.x,ua.x),y:(ua.y+ia.y)/
2,z:Y?(aa.zmax+aa.zmin)/2:null,spatialReference:aa.spatialReference});const Fa=d.getReferenceEllipsoid(aa.spatialReference);var pa=n.getGreatCircleSpanAt(la,ia,ua);ea=pa.lon;pa=pa.lat;wa.diff(ia.x,ua.x)>wa.range/2&&(ea+=Fa.halfCircumference);ea=Math.min(ea,Fa.halfCircumference);pa=Math.min(pa,Fa.halfCircumference)}else la=y.unwrapOr(fa.renderSpatialReference,aa.spatialReference),la.equals(aa.spatialReference)||(aa=g.project(aa,la)),ea=aa.xmax-aa.xmin,pa=aa.ymax-aa.ymin,la=new l({x:aa.xmin+.5*ea,y:aa.ymin+
.5*pa,z:Y?(aa.zmax+aa.zmin)/2:null,spatialReference:la});ia=fa.state.camera;aa=Math.max(1/Math.tan(ia.fovX/2)*ea*.5,1/Math.tan(ia.fovY/2)*pa*.5,1/Math.tan(ia.fov/2)*(Y?aa.zmax-aa.zmin:0)*.5)/1;if(N(T))Y=new ha(T.signal),O(fa,W,U,la,aa,X,Y),Y.resolver.promise.then(ua=>{ua=L(fa,ua,fa.camera.fov);if(y.isNone(ua))T.resolver.reject();else return T.resolver.resolve(ua)},ua=>T.resolver.reject(ua));else return W=O(fa,W,U,la,aa,X),L(fa,W,fa.camera.fov,T)};a.getObserverForPointAtDistance=O;a.headingTiltToDirectionUp=
function(fa,aa,W,U,X){return x(fa).headingTiltToDirectionUp(aa,W,U,X)};a.internalToExternal=function(fa,aa,W){const U=fa.renderSpatialReference,X=D(fa,aa.eye,aa.viewForward,aa.up,Q);fa=fa.spatialReference||c.WGS84;g.projectVectorToVector(aa.eye,U,Z,fa)||(fa=c.WGS84,g.projectVectorToVector(aa.eye,U,Z,fa));if(y.isNone(W))return new b(new l(Z,fa),X.heading,X.tilt,q.rad2deg(aa.fov));W.position.x=Z[0];W.position.y=Z[1];W.position.z=Z[2];W.position.spatialReference=fa;W.heading=X.heading;W.tilt=X.tilt;
W.fov=q.rad2deg(aa.fov);return W};a.observerToCamera=L;a.scaleToDistance=C;a.scaleToResolution=function(fa,aa){return fa.spatialReference?u.getResolutionForScale(aa,fa.spatialReference):void 0};a.scaleToZoom=function(fa,aa){var W;if(fa=null==(W=fa.basemapTerrain)?void 0:W.tilingScheme)return fa.levelAtScale(aa);R.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(fa,aa,W){const U=g.projectVectorToPoint(W,fa.renderSpatialReference,fa.spatialReference||
c.WGS84);if(y.isNone(U))return null;var X=Math.tan(aa.fovX/2),T=Math.tan(aa.fovY/2);aa=w.dist(aa.eye,W);X*=2*aa;T*=2*aa;return"global"===fa.viewingMode?m.toExtent(fa,U,X,T):h.toExtent(fa,U,X,T)};a.zoomToScale=function(fa,aa){var W;if(fa=null==(W=fa.basemapTerrain)?void 0:W.tilingScheme)return fa.scaleAtLevel(aa);R.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection ../views/3d/support/cameraUtilsInternal".split(" "),
function(a,p,b,r,q,y,f,w,e){function l(v,x,C,A=e.createDirectionUp()){b.identity(n);const {direction:B,up:D}=A;b.rotateZ(n,n,-p.deg2rad(x));b.rotateX(n,n,p.deg2rad(C));q.transformMat4(B,m,n);q.scale(B,B,-1);q.transformMat4(D,h,n);return A}function g(v,x,C,A){return e.directionToHeadingTilt(x,C,A,m,h)}function d(v,x,C,A){const B=l(v,C,A),D=y.create();q.scale(D,B.direction,-x);q.add(D,D,v);return{up:B.up,eye:D,heading:C,tilt:A}}function c(v){return p.rad2deg(v)}function u(v){return p.deg2rad(v)}function t(v,
x,C,A,B){const D=v.renderSpatialReference;v=v.map&&v.spatialReference||x.spatialReference;w.projectPointToVector(x,z,D);w.projectPointToVector(x,k,D);z[0]-=C/2;k[0]+=C/2;z[1]-=A/2;k[1]+=A/2;w.projectVectorToVector(z,D,z,v);w.projectVectorToVector(k,D,k,v);B?(B.xmin=z[0],B.ymin=z[1],B.xmax=k[0],B.ymax=k[1],B.spatialReference=v):B=new f(z[0],z[1],k[0],k[1],v);return B}const h=y.fromValues(0,1,0),m=y.fromValues(0,0,1),n=r.create(),z=y.create(),k=y.create();r=Object.freeze({__proto__:null,headingTiltToDirectionUp:l,
directionToHeadingTilt:g,eyeForCenterWithHeadingTilt:d,lookAtTiltToEyeTilt:c,eyeTiltToLookAtTilt:u,toExtent:t});a.cameraUtilsPlanar=r;a.directionToHeadingTilt=g;a.eyeForCenterWithHeadingTilt=d;a.eyeTiltToLookAtTilt=u;a.headingTiltToDirectionUp=l;a.lookAtTiltToEyeTilt=c;a.toExtent=t})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,p,b,r){const q=r.create(),y=r.create();a.createDirectionUp=
function(){return{direction:r.create(),up:r.create()}};a.directionToHeadingTilt=function(f,w,e,l,g){let d=b.normalize(q,f),c=b.dot(d,l);const u=0<c;c=Math.abs(c);.99<c&&(c=Math.abs(b.dot(w,l)),.99>c?(b.copy(d,w),u&&b.scale(d,d,-1)):d=null);w=0;d&&(b.scale(y,l,b.dot(l,d)),b.subtract(d,d,y),w=b.dot(d,g)/(b.length(d)*b.length(g)),b.cross(y,d,g),w=(0<b.dot(y,l)?1:-1)*p.rad2deg(p.acosClamped(w)));f=p.rad2deg(p.acosClamped(-b.dot(l,f)/b.length(f)));if(!e)return{heading:w,tilt:f};e.heading=w;e.tilt=f;return e};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projectionEllipsoid ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils ../views/3d/support/mathUtils".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d,c){function u(G,K,M,H=g.createDirectionUp()){q.cross(D,G,x);0===q.dot(D,
D)&&q.cross(D,G,C);b.identity(B);b.rotate(B,B,-p.deg2rad(K),G);b.rotate(B,B,-p.deg2rad(M),D);const {up:J,direction:O}=H;q.cross(J,D,G);q.normalize(J,J);q.transformMat4(J,J,B);q.normalize(O,G);q.negate(O,O);q.transformMat4(O,O,B);return H}function t(G,K,M,H){const J=D,O=E;q.normalize(J,G);q.cross(E,J,x);0===q.dot(E,E)&&q.cross(E,J,C);q.cross(O,E,J);return g.directionToHeadingTilt(K,M,H,J,O)}function h(G,K,M,H){const J={eye:y.create(),up:null,tilt:H,heading:M},O=D;O[0]=G[0];O[1]=G[2];O[2]=-G[1];M=p.deg2rad(M);
var I=p.deg2rad(H);H=Math.sin(M);M=Math.cos(M);var F=Math.sin(I),L=Math.cos(I);const N=q.length(O);if(1E-8>Math.abs(I))I=K+N;else{var R=N/F,S=p.asinClamped(K/R);I=R*Math.sin(Math.PI-I-S)}L*=K;R=K*K*F*F;S=M*M*R;const P=I-L,Q=P*P;var V=S*(S+Q-O[1]*O[1]);if(0>V)return q.scale(J.eye,O,I/N),J.tilt=0,J;var ca=Math.sqrt(V);const ba=O[1]*P;V=S+Q;ca=0<M?-ca+ba:ca+ba;if(1E-8>Math.abs(V))return 1E-8>N?(J.eye[0]=0,J.eye[1]=0,J.eye[2]=K):q.scale(J.eye,O,I/N),J.tilt=0,m(J.eye),n(J,G);J.eye[1]=ca/V;K*=F;ca=J.eye[1]*
J.eye[1];F=1-ca;V=Math.sqrt(F);R=S*ca+H*H*R-2*M*K*J.eye[1]*V*P+F*Q;if(1E-8>Math.abs(R))return q.scale(J.eye,O,I/N),J.tilt=0,m(J.eye),n(J,G);J.eye[0]=(F*(I*O[0]-L*O[0])-K*V*(O[0]*J.eye[1]*M+O[2]*H))/R;J.eye[2]=(F*(I*O[2]-L*O[2])-K*V*(O[2]*J.eye[1]*M-O[0]*H))/R;q.scale(J.eye,J.eye,I);m(J.eye);return n(J,G)}function m(G){const K=G[1];G[1]=-G[2];G[2]=K}function n(G,K){K=u(K,G.heading,G.tilt);G.up=K.up;return G}function z(G,K,M){K=q.length(K);M=p.asinClamped(M/(Math.sqrt(M*M+K*K-2*M*K*Math.cos(Math.PI-
G))/Math.sin(G)));return p.rad2deg(G-M)}function k(G,K,M){G=p.deg2rad(G);K=q.length(K);return p.asinClamped(M/(K/Math.sin(G)))+G}function v(G,K,M,H,J){function O(N){const R=Math.PI/2;N=c.cyclical2PI.normalize(N,-R);N>R&&(N=Math.PI-N);return N}var I=K.latitude;K=K.longitude;var F=d.getLonDeltaForDistance(I,M,w.getReferenceEllipsoid(G.spatialReference).radius)/2;M=K-F;K+=F;I=p.deg2rad(I);F=w.getReferenceEllipsoid(G.spatialReference).radius;I=(1+Math.sin(I))/(1-Math.sin(I));const L=(I+1)*Math.tan(H/
F/2);I=1.5*Math.PI-2*Math.atan(.5*(L+Math.sqrt(4*I+L*L)));H=I+H/F;I=O(I);H=O(H);H<I&&(F=H,H=I,I=F);I=Math.max(p.rad2deg(I),-90);H=Math.min(p.rad2deg(H),90);K=A.monotonic(M,K);180<K-M&&(F=(K-M-180)/2,M+=F,K-=F);F=G.spatialReference&&G.spatialReference.isGeographic?G.spatialReference:e.WGS84;J?(J.xmin=M,J.ymin=I,J.xmax=K,J.ymax=H,J.spatialReference=F):J=new f(M,I,K,H,F);G.spatialReference&&G.spatialReference.isWebMercator&&l.geographicToWebMercator(J,!1,J);return J}const x=y.fromValues(0,0,1),C=q.normalize(y.create(),
y.fromValues(1,1,1)),A=new c.Cyclical(-180,180),B=r.create(),D=y.create(),E=y.create();r=Object.freeze({__proto__:null,headingTiltToDirectionUp:u,directionToHeadingTilt:t,eyeForCenterWithHeadingTilt:h,lookAtTiltToEyeTilt:z,eyeTiltToLookAtTilt:k,toExtent:v});a.cameraUtilsSpherical=r;a.directionToHeadingTilt=t;a.eyeForCenterWithHeadingTilt=h;a.eyeTiltToLookAtTilt=k;a.headingTiltToDirectionUp=u;a.lookAtTiltToEyeTilt=z;a.toExtent=v})},"esri/views/support/spatialReferenceSupport":function(){define(["exports"],
function(a){a.isSpatialReferenceSupported=function(p,b){return null==p?!1:"2d"===b?!0:"local"===b?p.isGeographic?p.isWGS84||4490===p.wkid:!0:p.isWebMercator||p.isWGS84||4490===p.wkid||104971===p.wkid||104905===p.wkid||104903===p.wkid};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,p){function b(r){let q=r*r;0>r&&(q*=-1);return q}a.extractTransformation=function(r,q,y){const f=r.state;
r=r.device;q="forward-down"===q.tiltDirection?1:-1;"standard"===r.deviceType?(y.translation[0]=b(f.axes[0]),y.translation[1]=b(f.axes[1]),y.translation[2]=b(f.buttons[7])-b(f.buttons[6]),y.heading=b(f.axes[2]),y.tilt=b(f.axes[3])):"spacemouse"===r.deviceType&&(y.translation[0]=1.2*b(f.axes[0]),y.translation[1]=1.2*b(f.axes[1]),y.translation[2]=2*-b(f.axes[2]),y.heading=1.2*b(f.axes[5]),y.tilt=1.2*b(f.axes[3]));y.tilt*=q;p.scale(y.translation,y.translation,1);return y};a.extractTransformationKeyboard=
function(r,q){q.translation[0]=r[1]-r[0];q.translation[1]=r[3]-r[2];q.translation[2]=r[4]-r[5];q.heading=r[7]-r[6];q.tilt=r[8]-r[9];q.zoom=r[10]-r[11];return q};a.isZeroTransformation=function(r){return 0===r.translation[0]&&0===r.translation[1]&&0===r.translation[2]&&0===r.heading&&0===r.tilt&&0===r.zoom};a.quadraticAccentuation=b;a.resetTransformation=function(r){r.translation[0]=0;r.translation[1]=0;r.translation[2]=0;r.heading=0;r.tilt=0;return r};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,p,b,r){r=function(q){function y(w,e){var l=q.call(this,!0)||this;l.view=w;l.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:2};l.keyToNumber={[e.left]:0,[e.right]:1,[e.forward]:2,[e.backward]:3,[e.up]:4,[e.down]:5,[e.headingLeft]:6,[e.headingRight]:7,[e.tiltUp]:8,[e.tiltDown]:9,
[e.zoomIn]:10,[e.zoomOut]:11};l.registerIncoming("key-down",null,g=>l.handleKeyDown(g));l.registerIncoming("key-up",null,g=>l.handleKeyUp(g));l.registerIncoming("blur",null,()=>l.handleBlur());return l}p._inheritsLoose(y,q);var f=y.prototype;f.handleKeyDown=function(w){if(!w.data.native.ctrlKey&&!w.data.native.metaKey){var e=this.keyToNumber[w.data.key];null!=e&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new b.GamepadKeyboardController({view:this.view,
disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(e),w.stopPropagation()))}};f.handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};f.handleKeyUp=function(w){if(!w.data.native.ctrlKey&&!w.data.native.metaKey){var e=this.keyToNumber[w.data.key];
null!=e&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(e),w.stopPropagation())}};return y}(r.InputHandler);a.KeyboardNavigation=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(a,p,b,r,q,y){y=function(f){function w(e,l){var g=f.call(this,!0)||this;g.view=e;g.registerIncoming("mouse-wheel",l,d=>g.handleMouseWheel(d));return g}p._inheritsLoose(w,f);w.prototype.handleMouseWheel=function(e){if(this.view.navigation.mouseWheelZoomEnabled){var l=e.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new r.ZoomStepController({view:this.view,mode:"interaction"}):new q.ZoomStepController({view:this.view,mode:"interaction"}),
this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*l.deltaY,b.createScreenPointArray(l.x,l.y));e.preventDefault();e.stopPropagation()}};return w}(y.InputHandler);a.MouseWheelZoom=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,p,b,r,q,y){q=function(f){function w(l,g,d){var c=f.call(this,!0)||this;c.view=l;c.pointerAction=g;c.lastEndTimestamp=0;c.lastTimestamp=0;c.registerIncoming("drag",d,u=>c.handleDrag(u));return c}p._inheritsLoose(w,f);var e=w.prototype;e.handleDrag=function(l){if("mouse"!==l.data.pointerType||y.eventMatchesMousePointerAction(l.data,this.pointerAction)){var g=l.timestamp-this.lastEndTimestamp;g=this.momentum&&this.momentum.active&&40>g;switch(l.data.action){case "start":case "update":if(g)break;
this.controller&&this.controller.active?2<l.data.timestamp-this.lastTimestamp&&(this.controller.update(l.data),this.lastTimestamp=l.timestamp):this.startController(l);break;case "end":case "removed":this.endController(l,!0);break;case "added":this.endController(l,!1),this.startController(l)}l.stopPropagation()}};e.endController=function(l,g){this.controller&&this.controller.active&&(this.lastEndTimestamp=l.timestamp,l=this.controller.end(l.data),g&&l&&(this.momentum=l,this.view.state.switchCameraController(this.momentum)));
this.controller=null};e.startController=function(l){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(l.data);this.lastTimestamp=l.timestamp};e.createController=function(){return this.view.state.isGlobal?new b.PinchAndPanController({view:this.view}):new r.PinchAndPanController({view:this.view})};return w}(q.InputHandler);a.PinchAndPanNavigation=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../../../support/featureFlags ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O){a.PinchAndPanController=function(I){function F(N){N=I.call(this,N)||this;N.view=null;N.smoothRotation=new k.ExponentialFalloff(.05);N.rotationAxis=c.create();N.panningPlane=h.create();N.smoothScaling=new k.ExponentialFalloff(.05);N.zoomCenterScreen=q.createScreenPointArray();N.zoomMomentumEstimator=new O.ZoomMomentumEstimator;N.rotationMomentumEstimator=new J.RotationMomentumEstimator;N.panSphericalMomentumEstimator=new H.PanSphericalMomentumEstimator;
N.panPlanarMomentumEstimator=new M.PanPlanarMomentumEstimator;N.adjustedSphere=m.create();N.tmp3d=c.create();N.tmpScreenPointArray=q.createScreenPointArray();N.beginScreenPoint=q.createScreenPointArray();N.beginScenePoint=c.create();N.screenPickPoint=q.createScreenPointArray();N.navMode=E.NavigationMode.Horizontal;N.tmpInteractionDirection=c.create();N.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new K,interactionDirection:null,tiltMode:0};return N}
p._inheritsLoose(F,I);var L=F.prototype;L.begin=function(N){if(this.active){var R=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=R;this.rotationMomentumEstimator.enabled=R;this.panPlanarMomentumEstimator.enabled=R;this.panSphericalMomentumEstimator.enabled=R;this.beginHeading=-G.cyclicalPI.normalize(r.deg2rad(this.view.camera.heading));this.beginRadius=N.radius;this.pointerCount=N.pointers.size;this.beginAngle=N.angle;this.smoothRotation.reset();q.screenPointObjectToArray(N.center,
this.screenPickPoint);g.copy(this.beginScreenPoint,this.screenPickPoint);R=u.getReferenceEllipsoid(this.view.spatialReference);var S=E.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,this.screenPickPoint,!0,R);this.scenePickPoint=S.scenePickPoint;this.sphere=S.sphere;d.copy(this.beginScenePoint,this.scenePickPoint);this.navMode=E.decideNavigationMode(this.startCamera,this.screenPickPoint,S.hasGeometryIntersection,R);this.navMode===E.NavigationMode.Vertical&&this.preparePlanarPanMode(N);
this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};L.preparePlanarPanMode=function(N){var R=d.negate(this.tmp3d,this.startCamera.viewForward);h.fromPositionAndNormal(this.scenePickPoint,R,this.panningPlane);var S=q.createScreenPointArray(this.screenPickPoint[0],0);R=c.create();var P=d.length(this.startCamera.eye);this.adjustedSphere[3]=P<this.sphere[3]?P-100:this.sphere[3];E.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.startCamera,S,R);S=q.createRenderScreenPointArray3();
this.startCamera.projectToRenderScreen(R,S);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*S[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&h.fromPositionAndNormal(this.scenePickPoint,h.normal(this.panningPlane),this.panningPlane);if(!n.disableContextNavigation()){R=c.create();S=c.create();P=c.create();d.subtract(R,this.scenePickPoint,this.currentCamera.eye);d.normalize(R,R);var Q=5*Math.max(Math.abs(this.view.camera.position.z),50);const V=this.view._stage.renderView.getMinimalDepthForArea(this.screenPickPoint[0],
this.screenPickPoint[1],this.view.state.camera,80);Q=V?Math.min(V,Q):Q;d.copy(P,d.add(S,this.currentCamera.eye,d.scale(S,R,Q)));this.panningPlane[3]=-d.dot(this.panningPlane,P);this.startCamera.center=d.add(S,this.startCamera.eye,d.scale(S,this.startCamera.viewForward,Q))}N=q.screenPointObjectToArray(N.center,this.tmpScreenPointArray);E.intersectPlaneFromScreenPoint(this.panningPlane,this.startCamera,N,this.beginScenePoint)};L.update=function(N){if(this.active){this.currentCamera.copyFrom(this.startCamera);
var R=1<N.pointers.size;this.navMode===E.NavigationMode.Horizontal?(R&&this.zoomSpherical(N),this.panningSpherical(N),R&&this.rotateSpherical(N)):(R&&this.zoomPlanar(N),this.panningPlanar(N),R&&this.rotatePlanar(N))}};L.end=function(N){N.pointers.size===this.pointerCount&&this.update(N);this.finishController();if(N=this.zoomMomentumEstimator.evaluateMomentum())return this.navMode===E.NavigationMode.Horizontal?new D.ZoomSphericalMomentumController({view:this.view,momentum:N,screenCenter:this.zoomCenterScreen,
sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new B.ZoomPlanarMomentumController({view:this.view,momentum:N,zoomCenter:this.beginScenePoint});if(N=this.rotationMomentumEstimator.evaluateMomentum())return new A.RotationMomentumController({view:this.view,momentum:N,center:this.sphere,axis:this.rotationAxis});if(this.navMode===E.NavigationMode.Horizontal){if(N=this.panSphericalMomentumEstimator.evaluateMomentum())return new C.PanSphericalMomentumController({view:this.view,momentum:N})}else if(N=
this.panPlanarMomentumEstimator.evaluateMomentum())return new x.PanPlanarMomentumController({view:this.view,momentum:N});return null};L.zoomSpherical=function(N){const R=this.beginRadius/N.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(N.radius,40),120);this.smoothScaling.update(R);E.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);q.screenPointObjectToArray(N.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*N.timestamp);
this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(N.radius-this.beginRadius);z.applyAll(this.view,this.currentCamera,this.constraintOptions)};L.panningSpherical=function(N){const R=q.screenPointObjectToArray(N.center,this.tmpScreenPointArray);E.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,R,this.tmp3d);E.preserveHeadingThreshold(this.beginScenePoint,d.dot(this.currentCamera.up,this.beginScenePoint),this.sphere[3],
this.beginHeading,this.view.camera.tilt,this.startCamera)?(E.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(R,this.tmp3d,.001*N.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(E.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(R,
this.tmp3d,.001*N.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(this.screenPickPoint,R);z.applyAll(this.view,this.currentCamera,this.constraintOptions)};L.rotateSpherical=function(N){d.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||d.negate(this.rotationAxis,this.rotationAxis);var R=this.smoothRotation.value,S=E.normalizeRotationDelta(N.angle-
R);R+=S;this.smoothRotation.gain=.00125*Math.min(Math.max(N.radius,40),120);this.smoothRotation.update(R);S=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(S,.001*N.timestamp);E.applyRotation(this.currentCamera,this.sphere,t.wrapAxisAngle(this.rotationAxis,S));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(N.radius*R);z.applyAll(this.view,this.currentCamera,this.constraintOptions)};L.panningPlanar=function(N){const R=
q.screenPointObjectToArray(N.center,this.tmpScreenPointArray);E.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,R,this.tmp3d)&&(E.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(R,this.tmp3d,.001*N.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(this.beginScreenPoint,R),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,
this.tmpInteractionDirection),z.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};L.zoomPlanar=function(N){const R=this.beginRadius/N.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(N.radius,40),120);this.smoothScaling.update(R);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*N.timestamp);E.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(N.radius-this.beginRadius);z.applyAll(this.view,this.currentCamera,this.constraintOptions)};L.rotatePlanar=function(N){d.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||d.negate(this.rotationAxis,this.rotationAxis);var R=this.smoothRotation.value;let S=N.angle-R;S=E.normalizeRotationDelta(S);this.smoothRotation.gain=.00125*Math.min(Math.max(N.radius,40),
120);this.smoothRotation.update(R+S);R=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(R,.001*N.timestamp);E.applyRotation(this.currentCamera,this.sphere,t.wrapAxisAngle(this.rotationAxis,R));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(N.radius*R);z.applyAll(this.view,this.currentCamera,this.constraintOptions)};p._createClass(F,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return F}(v.InteractiveController);b.__decorate([y.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=b.__decorate([l.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/util":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,p){let b=function(){function r(y){this._gain=y}var q=r.prototype;q.reset=
function(y){this._value=y};q.update=function(y){this._value=void 0===this._value?y:this._gain*y+(1-this._gain)*this._value};p._createClass(r,[{key:"gain",set:function(y){this._gain=y}},{key:"value",get:function(){return void 0===this._value?0:this._value}}]);return r}();a.ExponentialFalloff=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){a.PanPlanarMomentumController=function(c){function u(t){t=c.call(this,t)||this;t.interactionType=4;t.tmpPan=l.create();return t}p._inheritsLoose(u,c);u.prototype.momentumStep=function(t,h){t=this.momentum.value(t);e.scale(this.tmpPan,this.momentum.direction,t);h.eye=e.subtract(d,h.eye,this.tmpPan);h.center=e.subtract(d,h.center,this.tmpPan);this.constraintOptions.interactionDirection=this.tmpPan};return u}(g.MomentumController);b.__decorate([r.property({constructOnly:!0})],
a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=b.__decorate([w.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const d=l.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){a.MomentumController=function(c){function u(h){h=c.call(this,h)||this;h.view=null;h.beginCamera=new d;h.elapsedTimeSec=0;h.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new d,interactionDirection:null,tiltMode:0};return h}p._inheritsLoose(u,c);var t=u.prototype;t.initialize=function(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new e};t.onControllerStart=function(h){this.beginCamera.copyFrom(h);
this.constraintOptions.interactionStartCamera=this.beginCamera;c.prototype.onControllerStart.call(this,h)};t.stepController=function(h,m){m.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=h;this.momentumStep(this.elapsedTimeSec,m);l.applyAll(this.view,m,this.constraintOptions)};p._createClass(u,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this.elapsedTimeSec)}}]);return u}(g.AnimationController);b.__decorate([r.property({constructOnly:!0})],a.MomentumController.prototype,
"view",void 0);a.MomentumController=b.__decorate([w.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){const c=l.create(),u=l.create();a.PanSphericalMomentumController=function(t){function h(m){m=t.call(this,m)||this;m.interactionType=4;return m}p._inheritsLoose(h,t);h.prototype.momentumStep=function(m,n){const z=this.momentum.value1(m);m=this.momentum.value2(m);e.copy(u,n.eye);e.normalize(u,u);e.cross(this.momentum.axis2,u,this.momentum.axis1);d.applyRotationWithTwoAxes(n,c,this.momentum.axis1,z,this.momentum.axis2,m)};return h}(g.MomentumController);b.__decorate([r.property({constructOnly:!0})],
a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=b.__decorate([w.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){a.RotationMomentumController=function(c){function u(t){t=c.call(this,t)||this;t.interactionType=2;return t}p._inheritsLoose(u,c);u.prototype.momentumStep=function(t,h){t=this.momentum.value(t);d.applyRotation(h,this.center,l.wrapAxisAngle(this.axis,t))};p._createClass(u,[{key:"center",set:function(t){this._set("center",e.clone(t))}},{key:"axis",set:function(t){this._set("axis",e.clone(t))}}]);return u}(g.MomentumController);b.__decorate([r.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);b.__decorate([r.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);b.__decorate([r.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=b.__decorate([w.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){a.ZoomPlanarMomentumController=function(c){function u(t){t=c.call(this,t)||this;t.interactionType=1;t.constraintOptions.interactionDirection=l.create();return t}p._inheritsLoose(u,c);u.prototype.momentumStep=function(t,h){e.copy(this.constraintOptions.interactionDirection,h.eye);t=this.momentum.valueDelta(0,t);d.applyZoomToPoint(h,this.zoomCenter,t,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=e.direction(this.constraintOptions.interactionDirection,
h.eye,this.constraintOptions.interactionDirection)};p._createClass(u,[{key:"zoomCenter",set:function(t){this._set("zoomCenter",l.clone(t))}}]);return u}(g.MomentumController);b.__decorate([r.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);b.__decorate([r.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=b.__decorate([w.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
a.ZoomPlanarMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){a.ZoomSphericalMomentumController=function(h){function m(z){z=h.call(this,z)||this;z.interactionType=1;z.radius=0;z.tmpSceneCenter=l.create();z.tmpZoomAxisAngle=g.create();z.sphere=d.create();return z}p._inheritsLoose(m,h);var n=m.prototype;n.initialize=function(){this.sphere[3]=this.radius};n.momentumStep=function(z,k){z=this.momentum.valueDelta(0,z);t.applyZoomOnSphere(this.sphere,k,z);this.constraintOptions.interactionType=1;c.applyAll(this.view,k,this.constraintOptions);
t.sphereOrPlanePointFromScreenPoint(this.sphere,k,this.screenCenter,this.tmpSceneCenter);g.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);t.applyRotation(k,this.sphere,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};p._createClass(m,[{key:"screenCenter",set:function(z){this._set("screenCenter",r.createScreenPointArray(z[0],z[1]))}},{key:"sceneCenter",set:function(z){this._set("sceneCenter",l.clone(z))}}]);return m}(u.MomentumController);b.__decorate([q.property({constructOnly:!0})],
a.ZoomSphericalMomentumController.prototype,"momentum",void 0);b.__decorate([q.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);b.__decorate([q.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);b.__decorate([q.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],
a.ZoomSphericalMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,p,b,r,q,y){let f=function(w){function e(l,g,d,c,u){l=w.call(this,l,g,d)||this;l.sceneVelocity=c;l.direction=u;return l}p._inheritsLoose(e,w);e.prototype.value=function(l){return w.prototype.valueFromInitialVelocity.call(this,
this.sceneVelocity,l)};return e}(y.Momentum);y=function(){function w(l=300,g=12,d=.84){this.minimumInitialVelocity=l;this.stopVelocity=g;this.friction=d;this.enabled=!0;this.time=new q.FilteredFiniteDifference(.6);this.screen=[new q.FilteredFiniteDifference(.4),new q.FilteredFiniteDifference(.4)];this.scene=[new q.FilteredFiniteDifference(.6),new q.FilteredFiniteDifference(.6),new q.FilteredFiniteDifference(.6)];this.tmpDirection=r.create()}var e=w.prototype;e.add=function(l,g,d){!this.enabled||this.time.hasLastValue&&
.015>this.time.computeDelta(d)||(this.screen[0].update(l[0]),this.screen[1].update(l[1]),this.scene[0].update(g[0]),this.scene[1].update(g[1]),this.scene[2].update(g[2]),this.time.update(d))};e.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};e.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var l=this.screen[0].filteredDelta;const g=this.screen[1].filteredDelta;
l=Math.sqrt(l*l+g*g)/this.time.filteredDelta;return Math.abs(l)<this.minimumInitialVelocity?null:this.createMomentum(l,this.stopVelocity,this.friction)};e.createMomentum=function(l,g,d){b.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const c=b.length(this.tmpDirection);0<c&&b.scale(this.tmpDirection,this.tmpDirection,1/c);return new f(l,g,d,c/this.time.filteredDelta,this.tmpDirection)};return w}();a.PanPlanarMomentum=f;a.PanPlanarMomentumEstimator=
y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,p){let b=function(){function r(y){this.gain=y}var q=r.prototype;q.update=function(y){if(this.hasLastValue){const f=this.computeDelta(y);this.updateDelta(f)}this.lastValue=y};q.reset=function(){this.filteredDelta=this.lastValue=void 0};q.computeDelta=function(y){return y-this.lastValue};q.updateDelta=function(y){this.filteredDelta=
this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*y:y};p._createClass(r,[{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}}]);return r}();a.FilteredFiniteDifference=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,p){let b=function(){function r(y,f,w){this._initialVelocity=
y;this._stopVelocity=f;this._friction=w;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}var q=r.prototype;q.isFinished=function(y){return y>this.duration};q.value=function(y){return this.valueFromInitialVelocity(this._initialVelocity,y)};q.valueDelta=function(y,f){const w=this.value(y);return this.value(y+f)-w};q.valueFromInitialVelocity=function(y,f){f=Math.min(f,this.duration);const w=1-this.friction;return y*(w**f-1)/Math.log(w)};
p._createClass(r,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);return r}();a.Momentum=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(a,p,b,
r,q,y,f,w,e){let l=function(g){function d(u,t,h,m,n,z=0,k){u=g.call(this,u,t,h)||this;u.angularVelocity1=m;u.axis1=n;u.angularVelocity2=z;u.axis2=k;return u}p._inheritsLoose(d,g);var c=d.prototype;c.value1=function(u){return g.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,u)};c.value2=function(u){return g.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,u)};return d}(e.Momentum);e=function(){function g(c=300,u=12,t=.84){this.minimumInitialVelocity=c;this.stopVelocity=
u;this.friction=t;this.enabled=!0;this.tmpAxis1=q.create();this.tmpAxis2=q.create();this.tmpAngles=b.create();this.time=new f.FilteredFiniteDifference(.3);this.screen=[new f.FilteredFiniteDifference(.4),new f.FilteredFiniteDifference(.4)];this.angle1=new w.FilteredValue(.6);this.angle2=new w.FilteredValue(.6);this.axis1=q.create();this.axis2=q.create();this.lastScene=q.create()}var d=g.prototype;d.addMomentumDirectRotation=function(c,u,t,h,m,n){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(t))return;
h=y.rotationAngleAndAxisDirectRotation(this.lastScene,u,this.tmpAxis2,h,m,n);this.angle2.update(0);1E-5>r.squaredLength(this.tmpAxis2)?h=0:r.normalize(this.axis1,this.tmpAxis2);this.angle1.update(h);r.copy(this.lastScene,u)}this.screen[0].update(c[0]);this.screen[1].update(c[1]);this.time.update(t)}};d.addMomentumPreserveHeading=function(c,u,t,h,m,n,z){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(t))return;y.rotationAnglesAndAxesHeadingPreserving(this.lastScene,u,this.tmpAxis2,
this.tmpAxis1,this.tmpAngles,h,m,n,z,!1);1E-5>r.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),r.normalize(this.axis1,this.tmpAxis1),r.normalize(this.axis2,this.tmpAxis2));r.copy(this.lastScene,u)}this.screen[0].update(c[0]);this.screen[1].update(c[1]);this.time.update(t)}};d.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};
d.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var c=this.screen[0].filteredDelta;const u=this.screen[1].filteredDelta;c=Math.sqrt(c*c+u*u)/this.time.filteredDelta;return Math.abs(c)<this.minimumInitialVelocity?null:this.createMomentum(c,this.stopVelocity,this.friction)};d.createMomentum=function(c,u,t){return new l(c,u,t,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return g}();
a.PanSphericalMomentum=l;a.PanSphericalMomentumEstimator=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,p){let b=function(){function r(y){this.gain=y}var q=r.prototype;q.update=function(y){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*y:y};q.reset=function(){this.filteredValue=void 0};p._createClass(r,[{key:"hasFilteredValue",get:function(){return void 0!==
this.filteredValue}}]);return r}();a.FilteredValue=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,p,b){b=function(r){function q(y=3,f=.01,w=.95,e=12){return r.call(this,y,f,w,e)||this}p._inheritsLoose(q,r);q.prototype.add=function(y,f){if(this.value.hasLastValue){const w=this.value.lastValue;for(y-=w;y>Math.PI;)y-=2*Math.PI;for(;y<-Math.PI;)y+=
2*Math.PI;y=w+y}r.prototype.add.call(this,y,f)};return q}(b.MomentumEstimator);a.RotationMomentumEstimator=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,p,b,r){let q=function(){function y(w=2.5,e=.01,l=.95,g=12){this.minimumInitialVelocity=w;this.stopVelocity=e;this.friction=l;this.maxVelocity=g;this.enabled=!0;this.value=new b.FilteredFiniteDifference(.8);
this.time=new b.FilteredFiniteDifference(.3)}var f=y.prototype;f.add=function(w,e){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(e))return;if(this.value.hasFilteredDelta){const l=this.value.computeDelta(w);0>this.value.filteredDelta*l&&this.value.reset()}}this.time.update(e);this.value.update(w)}};f.reset=function(){this.value.reset();this.time.reset()};f.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let w=this.value.filteredDelta/
this.time.filteredDelta;w=p.clamp(w,-this.maxVelocity,this.maxVelocity);return Math.abs(w)<this.minimumInitialVelocity?null:this.createMomentum(w,this.stopVelocity,this.friction)};f.createMomentum=function(w,e,l){return new r.Momentum(w,e,l)};return y}();a.MomentumEstimator=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(a,p,b,r){let q=
function(y){function f(e,l,g){return y.call(this,e,l,g)||this}p._inheritsLoose(f,y);var w=f.prototype;w.value=function(e){e=y.prototype.value.call(this,e);return Math.exp(e)};w.valueDelta=function(e,l){const g=y.prototype.value.call(this,e);e=y.prototype.value.call(this,e+l);return Math.exp(e-g)};return f}(b.Momentum);b=function(y){function f(e=2.5,l=.01,g=.95,d=12){return y.call(this,e,l,g,d)||this}p._inheritsLoose(f,y);var w=f.prototype;w.add=function(e,l){y.prototype.add.call(this,Math.log(e),
l)};w.createMomentum=function(e,l,g){return new q(e,l,g)};return f}(r.MomentumEstimator);a.ZoomMomentum=q;a.ZoomMomentumEstimator=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../support/featureFlags ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D){const E=d.fromValues(0,0,1);var G=16/180*Math.PI;a.PinchAndPanController=function(K){function M(J){J=K.call(this,J)||this;J.view=null;J.rotationValueSmooth=new m.ExponentialFalloff(.05);J.scalingValueSmooth=new m.ExponentialFalloff(.05);J.planeHorizontal=u.create();J.planeVertical=u.create();J.rotationMomentumEstimator=new B.RotationMomentumEstimator;J.panMomentumEstimator=new A.PanPlanarMomentumEstimator(300,12,.9);J.zoomMomentumEstimator=
new D.ZoomMomentumEstimator;J.beginCenter=d.create();J.tmpPoints=[];J.beginCenterScreen=q.createScreenPointArray();J.tmpCentroid3d=d.create();J.tmpCentroid2d=q.createScreenPointArray();J.tmp2d=q.createScreenPointArray();J.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new C,interactionDirection:null,tiltMode:0};return J}p._inheritsLoose(M,K);var H=M.prototype;H.begin=function(J){if(this.active){var O=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=
O;this.rotationMomentumEstimator.enabled=O;this.panMomentumEstimator.enabled=O;this.beginRadius=J.radius;this.pointerCount=J.pointers.size;this.beginAngle=J.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();q.screenPointObjectToArray(J.center,this.beginCenterScreen);u.fromNormalAndOffset(E,0,this.planeHorizontal);O=d.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,O);var I=d.create();g.negate(I,this.startCamera.viewForward);var F=d.create();
g.copy(F,E);var L=g.dot(I,F);this.panMode=r.asinClamped(0>L?-L:L)>=G?x.NavigationMode.Horizontal:x.NavigationMode.Vertical;u.setOffsetFromPoint(this.planeHorizontal,O,this.planeHorizontal);this.startCamera.aboveGround||u.negate(this.planeHorizontal,this.planeHorizontal);if(this.panMode===x.NavigationMode.Vertical){g.scale(F,F,L);g.subtract(this.planeVertical,I,F);g.normalize(this.planeVertical,this.planeVertical);u.setOffsetFromPoint(this.planeVertical,O,this.planeVertical);if(!t.disableContextNavigation()){I=
d.create();F=d.create();L=d.create();g.subtract(I,O,this.currentCamera.eye);g.normalize(I,I);O=5*Math.max(Math.abs(this.view.camera.position.z),50);const N=this.view._stage.renderView.getMinimalDepthForArea(this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,80);g.copy(L,g.add(F,this.currentCamera.eye,g.scale(F,I,N?Math.min(N,O):O)));this.planeVertical[3]=-g.dot(this.planeVertical,L)}this.computePlanePoints(J.pointers,this.planeVertical,this.startCamera,this.tmpPoints)}else this.computePlanePoints(J.pointers,
this.planeHorizontal,this.startCamera,this.tmpPoints);x.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};H.update=function(J){if(this.active){this.currentCamera.copyFrom(this.startCamera);var O=1<J.pointers.size,I=this.panMode===x.NavigationMode.Horizontal?this.planeHorizontal:this.planeVertical,F=this.beginCenter;if(O){var L=this.beginRadius/J.radius;this.scalingValueSmooth.gain=.001875*Math.min(Math.max(J.radius,40),120);this.scalingValueSmooth.update(L);
x.applyZoomToPoint(this.currentCamera,F,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*J.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=h.pixelDistanceToInteractionFactor(Math.abs(J.radius-this.beginRadius));h.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(J.pointers,I,this.currentCamera,this.tmpPoints);x.centroid(this.tmpPoints,
this.tmpCentroid3d);q.screenPointObjectToArray(J.center,this.tmpCentroid2d);x.applyPanPlanar(this.currentCamera,F,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*J.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=h.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d);h.applyAll(this.view,this.currentCamera,this.constraintOptions);O&&(O=this.planeHorizontal,I=this.rotationValueSmooth.value,
L=x.normalizeRotationDelta(J.angle-I),I+=L,this.rotationValueSmooth.gain=.00125*Math.min(Math.max(J.radius,40),120),this.rotationValueSmooth.update(I),I=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(I,.001*J.timestamp),x.applyRotation(this.currentCamera,F,c.wrapAxisAngle(O,I)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=h.pixelDistanceToInteractionFactor(Math.abs(J.radius*I)),h.applyAll(this.view,this.currentCamera,this.constraintOptions))}};
H.end=function(J){J.pointers.size===this.pointerCount&&this.update(J);this.finishController();return(J=this.zoomMomentumEstimator.evaluateMomentum())?new v.ZoomPlanarMomentumController({view:this.view,momentum:J,zoomCenter:this.beginCenter}):(J=this.rotationMomentumEstimator.evaluateMomentum())?new k.RotationMomentumController({view:this.view,momentum:J,center:this.beginCenter,axis:u.normal(this.planeHorizontal)}):(J=this.panMomentumEstimator.evaluateMomentum())?new z.PanPlanarMomentumController({view:this.view,
momentum:J}):null};H.computePlanePoints=function(J,O,I,F){F.length=J.size;const L=this.tmp2d;let N=0;J.forEach(R=>{L[0]=R.x;L[1]=R.y;void 0===F[N]&&(F[N]=d.create());x.intersectPlaneFromScreenPoint(O,I,L,F[N]);N+=1});return F};p._createClass(M,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return M}(n.InteractiveController);b.__decorate([y.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=b.__decorate([l.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],
a.PinchAndPanController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,p,b){b=function(r){function q(y,f){var w=r.call(this,!0)||this;w.view=y;w.registerIncoming("pointer-down",f,()=>w.view.state.stopActiveCameraController());return w}p._inheritsLoose(q,r);return q}(b.InputHandler);a.PointerDownCancelAnimation=b;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,p,b){b=function(r){function q(y,f,w){f=r.call(this,f,w)||this;f.view=y;return f}p._inheritsLoose(q,r);q.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>{})};return q}(b.SingleKey);a.SingleKeyResetHeading=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,p,b){b=function(r){function q(y,f){var w=r.call(this,!0)||this;w.key=y;w.registerIncoming("key-down",f,e=>w._handleKeyDown(e));return w}p._inheritsLoose(q,r);q.prototype._handleKeyDown=function(y){y.data.key===this.key&&(this.activate(),y.stopPropagation())};return q}(b.InputHandler);a.SingleKey=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,p,b){b=function(r){function q(y,f,w){f=r.call(this,f,w)||this;f.view=y;return f}p._inheritsLoose(q,r);q.prototype.activate=function(){this.view.goTo({tilt:0}).catch(()=>{})};return q}(b.SingleKey);a.SingleKeyResetTilt=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../state/controllers/RotateController",
"../../../input/InputHandler"],function(a,p,b,r,q){q=function(y){function f(w,e=!1){var l=y.call(this,!0)||this;l.view=w;l.invert=e;l.registerIncoming("vertical-two-finger-drag",g=>l.handleTwoFinger(g));return l}p._inheritsLoose(f,y);f.prototype.handleTwoFinger=function(w){var e,l,g;const d=b.createScreenPointArray(0,w.data.delta*(this.invert?-1:1));switch(w.data.action){case "begin":null==(e=this.cameraController)?void 0:e.end();this.cameraController=new r.RotateController({view:this.view,pivot:0});
this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":null==(l=this.cameraController)?void 0:l.update(d);break;case "end":null==(g=this.cameraController)?void 0:g.end(),this.cameraController=null}};return f}(q.InputHandler);a.TwoFingerTilt=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),
function(a,p,b,r,q,y){const f=b("trident"),w=b("edge"),e=b("chrome"),l=b("ff"),g=b("safari");b=function(){function c(t,h){this.input=h;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=t;t.getAttribute("tabindex")||t.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,
"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new q.GamepadSource(t,this.input);this._gamepadSource.onEvent=m=>this._callback("gamepad",m)}var u=c.prototype;u.destroy=function(){this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(t=>
{this._releasePointerCaptureSafe(t)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};u.setPointerCapture=function(t,h){h?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))};u._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};u._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};u._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");
this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};u._releasePointerCaptureSafe=function(t){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(t)||this._element.releasePointerCapture(t)}catch(h){}};u._updateNormalizedPointerLikeEvent=function(t,h){t=y.createScreenPointFromNativeEvent(this._element,t);c.test.disableSubpixelCoordinates&&(t.x=Math.round(t.x),t.y=Math.round(t.y));h.x=t.x;h.y=
t.y;return h};u._handleKey=function(t,h){const m=r.eventKey(h);m&&"key-up"===t&&this._keyDownState.delete(m);h={native:h,key:m,repeat:m&&this._keyDownState.has(m)};m&&"key-down"===t&&this._keyDownState.add(h.key);this._callback(t,h)};u._handlePointer=function(t,h){h=this._updateNormalizedPointerLikeEvent(h,{native:h,x:0,y:0,pointerType:h.pointerType,button:h.button,buttons:h.buttons,eventId:this._eventId++});this._callback(t,h)};u._handlePointerPreventDefault=function(t,h){const m=this._updateNormalizedPointerLikeEvent(h,
{native:h,x:0,y:0,pointerType:h.pointerType,button:h.button,buttons:h.buttons,eventId:this._eventId++});h.preventDefault();this._callback(t,m)};u._handleMouseWheel=function(t,h){let m=h.deltaY;switch(h.deltaMode){case 0:if(f||w)m=m/document.documentElement.clientHeight*600;break;case 1:m*=30;break;case 2:m*=900}f||w?m*=.7:e||g?m*=.6:l&&(m*=1.375);const n=Math.abs(m);100<n&&(m=m/n*200/(1+Math.exp(-.02*(n-100))));h=this._updateNormalizedPointerLikeEvent(h,{native:h,x:0,y:0,deltaY:m});this._callback(t,
h)};u._handlePointerCaptureLost=function(t,h){this._activePointerCaptures.delete(h.pointerId);this._handleDefault(t,h)};u._handleDefault=function(t,h){const m={native:h};h.preventDefault();this._callback(t,m)};u._preventAltKeyDefault=function(t){"Alt"===t.key&&t.preventDefault()};u._preventMultiTouchPanning=function(t){1<t.touches.length&&t.preventDefault()};p._createClass(c,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(t){this._browserTouchPanningEnabled=
t;this._updateTouchAction();this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(t){this._callback=t}},{key:"activeEvents",set:function(t){for(const h in this._active)t&&t.has(h)||(this._element.removeEventListener(d[h],this._active[h]),delete this._active[h]);t&&t.forEach(h=>{if(!this._active[h]&&d[h]){const m=(this._eventHandlers[h]||this._handleDefault).bind(this,h);this._element.addEventListener(d[h],m);this._active[h]=m}});this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}}]);
return c}();b.test={disableSubpixelCoordinates:!1};const d={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=b;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,p,b,r,q){let y=function(){function f(e,l){this.element=e;this.input=l;this._hasEventListeners=!1;this.onConnectGamepad=g=>{this.connectGamepad(g.gamepad)};this.onDisconnectGamepad=g=>{g=g.gamepad;const d=g.index,c=this.inputDevices[d];c&&(this.emitGamepadEvent(g,q.extractState(c),!1),this.inputDevices.splice(d,
1),this.latestUpdate.splice(d,1),this.input.gamepad.devices.remove(c),this.ensurePollingState())};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;e=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&e)this.forEachGamepad(g=>this.connectGamepad(g)),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState()}var w=f.prototype;w.destroy=function(){this.hasEventListeners=
!1;this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))};w.connectGamepad=function(e){const l=new r(e);"unknown"!==l.deviceType&&(this.inputDevices[e.index]=l,this.input.gamepad.devices.add(l));this.ensurePollingState()};w.ensurePollingState=function(){this.eventsEnabled?this.startPolling():this.stopPolling()};w.startPolling=function(){null==this.frameTask&&(this.frameTask=b.addFrameTask({update:()=>
this.readGamepadState()}))};w.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};w.readGamepadState=function(){const e=document.hasFocus(),l=this.element.contains(document.activeElement),g="document"===this.input.gamepad.enabledFocusMode&&!e||"view"===this.input.gamepad.enabledFocusMode&&!l;this.forEachGamepad(d=>{var c=this.inputDevices[d.index];if(c){var u=this.latestUpdate[d.index];c=q.extractState(c);var t=g||q.stateIdle(c);u&&(u.timestamp===
d.timestamp||!u.active&&t||q.stateEqual(u.state,c))||this.emitGamepadEvent(d,c,!t)}})};w.forEachGamepad=function(e){const l=window.navigator.getGamepads();for(let g=0;g<l.length;g++){const d=l[g];this.validate(d)&&e(d)}};w.emitGamepadEvent=function(e,l,g){var d=this.latestUpdate[e.index];if((d=d&&d.active)||g)this.latestUpdate[e.index]={timestamp:e.timestamp,state:l,active:g},this.callback&&this.callback({device:this.inputDevices[e.index],state:l,action:!d&&g?"start":d&&g?"update":"end"})};w.validate=
function(e){if(!e||!e.connected)return!1;for(let l=0;l<e.axes.length;l++)if(isNaN(e.axes[l]))return!1;return!0};p._createClass(f,[{key:"hasEventListeners",set:function(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(e){this.callback=e}}]);return f}();a.GamepadSource=y;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/input/gamepad/GamepadState":function(){define(["exports","../../../core/mathUtils"],function(a,p){a.extractState=function(b){const r=b.native;return r?{buttons:r.buttons.map(q=>q.pressed?q.value?q.value:1:0),axes:r.axes.map(q=>{{var y=b.axisThreshold;const f=Math.abs(q);q=f<y?0:p.sign(q)*(f-y)/(1-y)}return q})}:{buttons:[],axes:[]}};a.stateEqual=function(b,r){if(b.axes.length!==r.axes.length||b.buttons.length!==r.buttons.length)return!1;for(var q=0;q<b.axes.length;q++)if(b.axes[q]!==r.axes[q])return!1;
for(q=0;q<b.buttons.length;q++)if(b.buttons[q]!==r.buttons[q])return!1;return!0};a.stateIdle=function(b){for(var r=0;r<b.axes.length;r++)if(0!==b.axes[r])return!1;for(r=0;r<b.buttons.length;r++)if(0!==b.buttons[r])return!1;return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler"],function(a,p,b){b=function(r){function q(){var y=r.call(this,!0)||this;y.registerIncoming("context-menu",
f=>{f.data.native.preventDefault()});return y}p._inheritsLoose(q,r);return q}(b.InputHandler);a.PreventContextMenu=b;a["default"]=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../core/time ../InputHandler ./support".split(" "),function(a,p,b,r,q,y){function f(g){const d=[];g.forEach(c=>{d.push(b.createScreenPoint(c.event.x,c.event.y))});return y.fitCircleLSQ(d)}
function w(g){const d=f(g);let c=0;g.forEach(u=>{var t=l(u,d);for(t-=u.lastAngle;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;t=u.lastAngle+t;u.lastAngle=t;c+=t-u.initialAngle});c/=g.size||1;return{angle:c,radius:d.radius,center:d.center}}function e(g){const d=new Map;g.forEach((c,u)=>d.set(u,c.event));return d}function l(g,d){g=g.event;return Math.atan2(g.y-d.center.y,g.x-d.center.x)}q=function(g){function d(u){var t=g.call(this,!1)||this;t.navigationTouch=u;t.startStateModifiers=new Set;
t.activePointerMap=new Map;t.isDragging=!1;t.isCurrentDragSuppressed=!1;t.drag=t.registerOutgoing("drag");t.registerIncoming("pointer-drag",t.handlePointerDrag.bind(p._assertThisInitialized(t)));t.registerIncoming("pointer-up",t.handlePointerUpAndPointerLost.bind(p._assertThisInitialized(t)));t.registerIncoming("pointer-capture-lost",t.handlePointerUpAndPointerLost.bind(p._assertThisInitialized(t)));t.registerIncoming("pointer-cancel",t.handlePointerUpAndPointerLost.bind(p._assertThisInitialized(t)));
return t}p._inheritsLoose(d,g);var c=d.prototype;c.createPayload=function(u,t,h,m){return{action:u,pointerType:this.pointerType,button:this.mouseButton,buttons:t.buttons,timestamp:m,pointers:e(this.activePointerMap),pointer:t,angle:h.angle,radius:h.radius,center:h.center}};c.addPointer=function(u){var t=u.native.pointerId;const h=w(this.activePointerMap).angle;u={event:u,initialAngle:0,lastAngle:0};this.activePointerMap.set(t,u);t=l(u,f(this.activePointerMap));u.initialAngle=t;u.lastAngle=t;this.updatePointerAngles(h)};
c.updatePointer=function(u){if(!u||null!=u.x||null!=u.y){var t=this.activePointerMap.get(u.native.pointerId);t?t.event=u:this.addPointer(u)}};c.removePointer=function(u){const t=w(this.activePointerMap).angle;this.activePointerMap.delete(u);this.updatePointerAngles(t)};c.updatePointerAngles=function(u){const t=w(this.activePointerMap);this.activePointerMap.forEach(h=>{h.initialAngle=l(h,t)-u;h.lastAngle=l(h,t)-u})};c.emitEvent=function(u,t,h){const m=w(this.activePointerMap);this.drag.emit(this.createPayload(u,
t,m,h),void 0,this.startStateModifiers)};c.handlePointerUpAndPointerLost=function(u){const t=u.data.native.pointerId,h=r.Milliseconds(u.timestamp);this.activePointerMap.get(t)&&(1===this.activePointerMap.size?(this.updatePointer(u.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",u.data,h),this.isCurrentDragSuppressed=this.isDragging=!1,this.removePointer(t)):(this.removePointer(t),this.emitEvent("removed",u.data,r.Milliseconds(u.timestamp))))};c.handlePointerDrag=function(u){const t=u.data,
h=t.currentEvent,m=r.Milliseconds(u.timestamp);switch(t.action){case "start":case "update":this.isDragging?this.activePointerMap.has(h.native.pointerId)?(this.updatePointer(h),!this.isCurrentDragSuppressed&&this.emitEvent("update",h,m)):(this.addPointer(h),this.emitEvent("added",h,m),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(h),this.pointerType=u.data.startEvent.pointerType,this.mouseButton=u.data.startEvent.button,this.startStateModifiers=u.modifiers,this.isDragging=!0,
this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",h,m))}};p._createClass(d,[{key:"isSuppressed",get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}]);return d}(q.InputHandler);a.Button=void 0;(function(g){g[g.Left=0]="Left";g[g.Middle=1]="Middle";g[g.Right=2]="Right";g[g.Back=3]="Back";g[g.Forward=4]="Forward";g[g.Undefined=-1]="Undefined"})(a.Button||
(a.Button={}));a.Drag=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,p){a.euclideanDistance=function(b,r){const q=r.x-b.x;b=r.y-b.y;return Math.sqrt(q*q+b*b)};a.fitCircleLSQ=function(b,r){r?(r.radius=0,r.center.x=0,r.center.y=0):r={radius:0,center:p.createScreenPoint()};if(0===b.length)return r;if(1===b.length)return r.center.x=b[0].x,r.center.y=b[0].y,r;if(2===b.length){const [h,m]=
b,[n,z]=[m.x-h.x,m.y-h.y];r.radius=Math.sqrt(n*n+z*z)/2;r.center.x=(h.x+m.x)/2;r.center.y=(h.y+m.y)/2;return r}let q=0,y=0;for(r=0;r<b.length;r++)q+=b[r].x,y+=b[r].y;q/=b.length;y/=b.length;var f=b.map(h=>h.x-q),w=b.map(h=>h.y-y);let e=r=0;var l=0,g=0,d=0,c=0,u=0;for(var t=0;t<f.length;t++){const h=f[t],m=w[t],n=h*h,z=m*m;r+=n;e+=z;l+=h*m;g+=n*h;d+=z*m;c+=h*z;u+=m*n}f=r;w=l;t=e;g=.5*(g+c);d=.5*(d+u);u=f*t-l*w;c=(g*t-d*w)/u;d=(f*d-l*g)/u;u=p.createScreenPoint(c+q,d+y);return{radius:Math.sqrt(c*c+d*
d+(r+e)/b.length),center:u}};a.manhattanDistance=function(b,r){return Math.abs(r.x-b.x)+Math.abs(r.y-b.y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),function(a,p,b,r,q,y){r=function(f){function w(l=q.DefaultParameters.maximumDoubleClickDelay,g=q.DefaultParameters.maximumDoubleClickDistance,
d=q.DefaultParameters.maximumDoubleTouchDelay,c=q.DefaultParameters.maximumDoubleTouchDistance,u=b["default"]){var t=f.call(this,!1)||this;t.maximumDoubleClickDelay=l;t.maximumDoubleClickDistance=g;t.maximumDoubleTouchDelay=d;t.maximumDoubleTouchDistance=c;t._clock=u;t._pointerState=new Map;t._immediateDoubleClick=t.registerOutgoing("immediate-double-click");t.registerIncoming("pointer-down",t._handlePointerDown.bind(p._assertThisInitialized(t)));t.registerIncoming("pointer-up",h=>{t._handlePointerLoss(h,
"pointer-up")});t.registerIncoming("pointer-capture-lost",h=>{t._handlePointerLoss(h,"pointer-capture-lost")});t.registerIncoming("pointer-cancel",h=>{t._handlePointerLoss(h,"pointer-cancel")});return t}p._inheritsLoose(w,f);var e=w.prototype;e.onUninstall=function(){this._pointerState.forEach(l=>{l.immediateDoubleClick&&l.immediateDoubleClick.timeoutHandle.remove()});f.prototype.onUninstall.call(this)};e._handlePointerDown=function(l){l=l.data;const g=this._pointerId(l);this._pointerState.has(g)||
(this._pointerState.set(g,{downButton:l.native.button,immediateDoubleClick:null}),this.startCapturingPointer(l.native))};e._handlePointerLoss=function(l,g){const d=l.data;var c=this._pointerId(d);if((c=this._pointerState.get(c))&&"pointer-up"===g&&c.downButton===d.native.button)if(g=c.immediateDoubleClick){g.timeoutHandle.remove();const u="touch"===l.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;y.manhattanDistance(g,l.data)>u?this._startImmediateDoubleClick(l,
c):(this._immediateDoubleClick.emit(l.data,void 0,g.modifiers),this._removeState(d))}else this._startImmediateDoubleClick(l,c)};e._startImmediateDoubleClick=function(l,g){g.immediateDoubleClick={x:l.data.x,y:l.data.y,modifiers:l.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(l.data),"touch"===l.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};e._pointerId=function(l){l=l.native;return"mouse"===l.pointerType?`${l.pointerId}:${l.button}`:`${l.pointerType}`};
e._removeState=function(l){const g=this._pointerId(l);this._pointerState.delete(g);this.stopCapturingPointer(l.native);this.refreshHasPendingInputs()};return w}(r.InputHandler);a.ImmediateDoubleClick=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../InputHandler ./support".split(" "),function(a,p,b,r,q,y){const f={maximumDoubleClickDelay:250,
maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};q=function(w){function e(g=f.maximumDoubleClickDelay,d=f.maximumDoubleClickDistance,c=f.maximumDoubleTouchDelay,u=f.maximumDoubleTouchDistance,t=b["default"]){var h=w.call(this,!1)||this;h.maximumDoubleClickDelay=g;h.maximumDoubleClickDistance=d;h.maximumDoubleTouchDelay=c;h.maximumDoubleTouchDistance=u;h._clock=t;h._pointerState=new Map;h._click=h.registerOutgoing("click");h._doubleClick=h.registerOutgoing("double-click");
h.registerIncoming("immediate-click",h._handleImmediateClick.bind(p._assertThisInitialized(h)));h.registerIncoming("pointer-drag",h._handlePointerDrag.bind(p._assertThisInitialized(h)));h.registerIncoming("drag",h._handleDrag.bind(p._assertThisInitialized(h)));return h}p._inheritsLoose(e,w);var l=e.prototype;l.onUninstall=function(){this._pointerState.forEach(g=>{null!=g.doubleClickTimeout&&(g.doubleClickTimeout.remove(),g.doubleClickTimeout=null)})};l._pointerId=function(g){g=g.native;return"mouse"===
g.pointerType?`${g.pointerId}:${g.button}`:`${g.pointerType}`};l._handleImmediateClick=function(g){const d=g.data,c=this._pointerId(d),u=this._pointerState.get(c);if(u){const t="touch"===d.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;y.manhattanDistance(u.event.data,d)>t?(this._clearDoubleClickTimeout(c,!0),this._startClick(g)):(this._clearDoubleClickTimeout(c,!1),this._doubleClick.emit(u.event.data,void 0,u.event.modifiers))}else this._startClick(g)};l._startClick=
function(g){const d=this._pointerId(g.data);this._pointerState.set(d,{event:g,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(d),"touch"===g.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};l._handlePointerDrag=function(g){g=this._pointerId(g.data.currentEvent);this._clearDoubleClickTimeout(g,!0)};l._handleDrag=function(g){g=this._pointerId(g.data.pointer);this._clearDoubleClickTimeout(g,!0)};l._clearDoubleClickTimeout=
function(g,d){const c=this._pointerState.get(g);c&&(c.doubleClickTimeout.remove(),c.doubleClickTimeout=null,d&&this._doubleClickTimeoutExceeded(g),this._pointerState.delete(g),this.refreshHasPendingInputs())};l._doubleClickTimeoutExceeded=function(g){const d=this._pointerState.get(g);this._click.emit(d.event.data,void 0,d.event.modifiers);d.doubleClickTimeout=null;this._pointerState.delete(g);this.refreshHasPendingInputs()};p._createClass(e,[{key:"hasPendingInputs",get:function(){return r.someMap(this._pointerState,
g=>null!=g.doubleClickTimeout)}}]);return e}(q.InputHandler);a.DefaultParameters=f;a.SingleAndDoubleClick=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/clock","../InputHandler","./support"],function(a,p,b,r,q){const y={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};r=function(f){function w(l=
y.maximumClickDelay,g=y.movementUntilMouseDrag,d=y.movementUntilPenDrag,c=y.movementUntilTouchDrag,u=y.holdDelay,t=b["default"]){var h=f.call(this,!1)||this;h.maximumClickDelay=l;h.movementUntilMouseDrag=g;h.movementUntilPenDrag=d;h.movementUntilTouchDrag=c;h.holdDelay=u;h._clock=t;h._pointerState=new Map;h._pointerDrag=h.registerOutgoing("pointer-drag");h._immediateClick=h.registerOutgoing("immediate-click");h._pointerHold=h.registerOutgoing("hold");h.registerIncoming("pointer-down",h._handlePointerDown.bind(p._assertThisInitialized(h)));
h.registerIncoming("pointer-up",m=>{h._handlePointerLoss(m,"pointer-up")});h.registerIncoming("pointer-capture-lost",m=>{h._handlePointerLoss(m,"pointer-capture-lost")});h.registerIncoming("pointer-cancel",m=>{h._handlePointerLoss(m,"pointer-cancel")});h._moveHandle=h.registerIncoming("pointer-move",h._handlePointerMove.bind(p._assertThisInitialized(h)));h._moveHandle.pause();return h}p._inheritsLoose(w,f);var e=w.prototype;e.onUninstall=function(){this._pointerState.forEach(l=>{null!=l.holdTimeout&&
(l.holdTimeout.remove(),l.holdTimeout=null)});f.prototype.onUninstall.call(this)};e._handlePointerDown=function(l){const g=l.data,d=g.native.pointerId;var c=null;0===this._pointerState.size&&(c=this._clock.setTimeout(()=>{const u=this._pointerState.get(d);u&&(u.isDragging||(this._pointerHold.emit(u.previousEvent,void 0,l.modifiers),u.holdEmitted=!0),u.holdTimeout=null)},this.holdDelay));c={startEvent:g,previousEvent:g,startTimestamp:l.timestamp,isDragging:!1,downButton:g.native.button,holdTimeout:c,
modifiers:new Set};this._pointerState.set(d,c);this.startCapturingPointer(g.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(l)};e._createPointerDragData=function(l,g,d){return{action:l,startEvent:g.startEvent,previousEvent:g.previousEvent,currentEvent:d}};e._handlePointerMove=function(l){const g=l.data,d=this._pointerState.get(g.native.pointerId);if(d){if(d.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",d,g),void 0,d.modifiers);else{const c=
q.euclideanDistance(g,d.startEvent),u=this._getDragThreshold(g.native.pointerType);c>u&&this.startDragging(l)}d.previousEvent=g}};e._getDragThreshold=function(l){switch(l){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};e.startDragging=function(l){const g=l.data,d=g.native.pointerId;this._pointerState.forEach(c=>{null!=c.holdTimeout&&(c.holdTimeout.remove(),c.holdTimeout=null);c.isDragging||(c.modifiers=l.modifiers,
c.isDragging=!0,d===c.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",c,g)):this._pointerDrag.emit(this._createPointerDragData("start",c,c.previousEvent),l.timestamp))})};e._handlePointerLoss=function(l,g){const d=l.data,c=d.native.pointerId,u=this._pointerState.get(c);u&&(null!=u.holdTimeout&&(u.holdTimeout.remove(),u.holdTimeout=null),u.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",u,"pointer-up"===g?d:u.previousEvent),void 0,u.modifiers):
"pointer-up"===g&&u.downButton===d.native.button&&l.timestamp-u.startTimestamp<=this.maximumClickDelay&&!u.holdEmitted&&this._immediateClick.emit(d),this._pointerState.delete(c),this.stopCapturingPointer(d.native),0===this._pointerState.size&&this._moveHandle.pause())};return w}(r.InputHandler);a.DefaultParameters=y;a.PointerClickHoldAndDrag=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../DragEventSeparator","../InputHandler"],function(a,p,b,r){r=function(q){function y(w=20,e=40){var l=q.call(this,!1)||this;l._threshold=w;l._maxDelta=e;l.state="ready";l.emittedArtificalEnd2=!1;l._vertical=l.registerOutgoing("vertical-two-finger-drag");l._artificalDrag=l.registerOutgoing("drag");l.dragEventSeparator=new b.DragEventSeparator({start:(g,d)=>l.observeStart(g,d),update:(g,d,c)=>l.observeUpdate(g,d,c),end:(g,d)=>l.observeEnd(d)});l.registerIncoming("drag",g=>l.dragEventSeparator.handle(g));
return l}p._inheritsLoose(y,q);var f=y.prototype;f.observeStart=function(w,e){1===w&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center}),e.stopPropagation());this.state=2===w?"ready":"failed"};f.observeUpdate=function(w,e,l){"failed"!==this.state&&
2===w&&("active"===this.state?(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"update"}),e.stopPropagation()):this.checkMovementWithinLimits(e.data,l.data)?this.checkVerticalThresholdReached(e.data,l.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=e.data.center,this._artificalDrag.emit({action:"end",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,
angle:e.data.angle,radius:e.data.radius,center:e.data.center}),this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),e.stopPropagation()):this.state="failed")};f.observeEnd=function(w){"active"===this.state&&(this._vertical.emit({delta:w.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",w.stopPropagation())};f.checkMovementWithinLimits=function(w,e){let l=-Infinity,g=Infinity,d=-Infinity,c=Infinity;e.pointers.forEach(n=>{l=Math.max(l,
n.x);g=Math.min(g,n.x);d=Math.max(d,n.y);c=Math.min(c,n.y)});let u=-Infinity,t=Infinity,h=-Infinity,m=Infinity;w.pointers.forEach(n=>{u=Math.max(u,n.x);t=Math.min(t,n.x);h=Math.max(h,n.y);m=Math.min(m,n.y)});return Math.abs(w.center.x-e.center.x)<this._threshold&&Math.abs(u-t-(l-g))<=this._maxDelta&&Math.abs(h-m-(d-c))<=this._maxDelta};f.checkVerticalThresholdReached=function(w,e){let l=Math.abs(w.center.y-e.center.y);w.pointers.forEach((g,d)=>{d=e.pointers.get(d);l=Math.min(l,Math.abs(g.y-d.y))});
return l>=this._threshold};p._createClass(y,[{key:"failed",get:function(){return"failed"===this.state}}]);return y}(r.InputHandler);a.VerticalTwoFingerDrag=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){let p=function(){function b(q){this.callbacks=q;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=()=>!0)}var r=b.prototype;r.handle=function(q){const y=q.data,f=y.pointers.size;switch(y.action){case "start":this.currentCount=
f;this.emitStart(q);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=f;this.emitStart(q);break;case "update":this.emitUpdate(q);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=f;this.emitStart(q);break;case "end":this.emitEnd(q),this.currentCount=0}this.previousEvent=q};r.emitStart=function(q){this.startEvent=q;this.callbacks.condition(this.currentCount,q)&&this.callbacks.start(this.currentCount,q,this.startEvent)};r.emitUpdate=function(q){this.callbacks.condition(this.currentCount,
q)&&this.callbacks.update(this.currentCount,q,this.startEvent)};r.emitEnd=function(q){this.callbacks.condition(this.currentCount,q)&&this.callbacks.end(this.currentCount,q,this.startEvent);this.startEvent=null};return b}();a.DragEventSeparator=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){function m(z){z=z.layer;return!(!z||!z.featureReduction||"selection"!==z.featureReduction.type)}function n(z){(z=z.graphics3DGraphics)&&z.forEach(k=>k.clearVisibilityFlag(3))}a.GraphicsDeconflictor=function(z){function k(){var x=z.apply(this,arguments)||this;x._handles=new r;x._contexts=new Map;x._viewState=new u.DeconflictorViewState;x.visibilityGroup=0;x._iconMarginFactor=-.1;return x}p._inheritsLoose(k,z);var v=k.prototype;v.initialize=function(){this._handles.add([this.view.watch("state.camera",
()=>{this.updateViewState();this.setDirty()}),this.view.watch("map.ground.opacity",(x,C)=>{1!==x&&1!==C||this.setDirty()}),f.init(this.view,"slicePlane",()=>{this.updateSlicePlane();this.slicePlaneChanged()})]);this._frameTask=this.view.resourceController.scheduler.registerTask(h.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new t.LabelDeconflictor({view:this.view,parent:this})};v.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&
(this._frameTask.remove(),this._frameTask=null)};v.setDirty=function(){0<this._contexts.size&&(z.prototype.setDirty.call(this),this._labels.setDirty())};v.runTask=function(x){z.prototype.runTask.call(this,x);this.running||this._labels.setDirty()};v.setInitialIconVisibilityFlag=function(x,C){x=!(this._graphicSupportsDeconfliction(C)&&m(x));C.setVisibilityFlag(3,x,0)};v.updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this.updateSlicePlane())};
v.updateSlicePlane=function(){const x=this.view?this.view.slicePlane:null;y.isSome(x)&&c.transform(x,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=y.isSome(x)};v.slicePlaneChanged=function(){q.someMap(this._contexts,(x,C)=>C.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};v.addGraphicsOwner=function(x){let C=this._contexts.get(x);null==C&&(C=new Map,this._contexts.set(x,C),this.setDirty());return{addGraphic:A=>this.addGraphic(x,C,A),removeGraphic:A=>
this.removeGraphic(C,A),labelingInfoChange:()=>this._labels.enabledChanged(x,C),featureReductionChange:()=>this.enabledChanged(x,C),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(x,C),clear:()=>C.forEach(A=>this.removeGraphic(C,A.graphics3DGraphic))}};v.removeGraphicsOwner=function(x){const C=this._contexts.get(x);C&&(C.forEach(A=>this.removeGraphic(C,A.graphics3DGraphic)),this._contexts.delete(x),this.setDirty())};v.addGraphic=function(x,C,A){const B=A.graphic.uid;A=new u.DeconflictorGraphic(A,
x.symbolCreationContext.slicePlaneEnabled);C.set(B,A);m(x)&&this.addToActiveGraphics(A);x.labelsEnabled&&this._labels.addToActiveGraphics(A)};v.removeGraphic=function(x,C){C=C.graphic.uid;const A=x.get(C);A&&(this.removeFromActiveGraphics(A),this._labels.removeFromActiveGraphics(A),x.delete(C),this.setDirty())};v.enabledChanged=function(x,C){const A=m(x);A||n(x);this.modifyGraphics(C,A)};v._slicePlaneEnabledChanged=function(x,C){const A=x.symbolCreationContext.slicePlaneEnabled;C.forEach(B=>B.slicePlaneEnabled=
A);this.setDirty()};v.getGraphicsLayers=function(x){return x.graphics};v._graphicSupportsDeconfliction=function(x){if(x.isDraped)return!1;x=x.graphics;if(!x||!x.length)return!1;for(const C of x)if(this.layerSupportsDeconfliction(C))return!0;return!1};p._createClass(k,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(x){this._iconMarginFactor=x;this.setDirty()}}]);
return k}(u.Deconflictor);a.GraphicsDeconflictor=b.__decorate([d.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ../../support/debugFlags ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K){function*M(aa){if(Map.prototype.entries){aa=aa.entries();for(let W=aa.next();!W.done;W=aa.next())yield W.value[1]}else yield*aa.values()}function*H(aa,W,U){W.clear();aa.forEach((T,Y)=>{const ea=W.pushNew();ea.id=Y;ea.prio=T.info?-T.info[U].distance:Number.MAX_VALUE});yield;const X=W.iterableSort((T,Y)=>Y.prio-T.prio);for(let T=X.next();!T.done;T=X.next())yield;W.forAll(T=>{const Y=aa.get(T.id);Y&&(aa.delete(T.id),aa.set(T.id,Y))});
W.clear()}const J=m.create(),O=z.create(),I=z.create(),F=m.create(),L=u.create(),N=A.create(),R=C.create(),S=m.create(),P=v.create();let Q=function(){this.aabr=v.create();this.distance=0;this.visible=this.culled=!1},V=function(){function aa(){this.active=new Map;this.visible=new Map}aa.prototype.clear=function(){this.active.clear();this.visible.clear()};return aa}(),ca=function(){},ba=function(){this.sortArray=new f({allocator:aa=>aa||new ca})},Z=function(){function aa(){this.camera=new E;this.slicePlane=
x.create();this.slicePlaneEnabled=!1}aa.prototype.copyFrom=function(W){this.camera.copyFrom(W.camera);x.copy(W.slicePlane,this.slicePlane);this.slicePlaneEnabled=W.slicePlaneEnabled};return aa}();a.Deconflictor=function(aa){function W(){var X=aa.apply(this,arguments)||this;X._dirty=!1;X._runningViewState=new Z;X._state=0;X.graphics=new V;X.iterators=new ba;X.accBinsNumX=15;X.accBinsNumY=20;X.accBinsSizeX=0;X.accBinsSizeY=0;X.accBins=null;X.accNumTests=0;return X}p._inheritsLoose(W,aa);var U=W.prototype;
U.destroy=function(){this.graphics.clear();this.iterators=null};U.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};U.runTask=function(X){switch(this._state){case 0:this.startUpdate(),X.madeProgress();case 1:if(this._state=1,!this.processActiveGraphics(X))break;case 2:if(this._state=2,!this.sortVisibleGraphics(X))break;case 3:if(this._state=3,!this.deconflictVisibleGraphics(X))break;default:B.drawAccelerationStruct(this,this.graphics.visible),
this._state=0,this.notifyChange("updating")}};U.modifyGraphics=function(X,T){T?X.forEach(Y=>this.addToActiveGraphics(Y)):X.forEach(Y=>this.removeFromActiveGraphics(Y));this.setDirty()};U.layerSupportsDeconfliction=function(X){if(y.isNone(X)||"object3d"!==X.type)return!1;X=X.stageObject;return 1===(X?X.getNumGeometryRecords():0)&&X.getGeometryRecord(0).material instanceof K.HUDMaterial?!0:!1};U.startUpdate=function(){B.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);
const {fullWidth:X,fullHeight:T}=this._runningViewState.camera;this.initBins(X,T);this.resetIterators()};U.addToActiveGraphics=function(X){X.info[this.visibilityGroup]=new Q;this.graphics.active.set(X.graphics3DGraphic.graphic.uid,X);this.setDirty()};U.removeFromActiveGraphics=function(X){this.removeFromVisibleGraphics(X);{const T=X.graphics3DGraphic;T.destroyed||T.clearVisibilityFlag(3,this.visibilityGroup)}delete X.info[this.visibilityGroup];this.graphics.active.delete(X.graphics3DGraphic.graphic.uid);
this.setDirty()};U.addToVisibleGraphics=function(X){this.graphics.visible.set(X.graphics3DGraphic.graphic.uid,X)};U.removeFromVisibleGraphics=function(X){this.graphics.visible.delete(X.graphics3DGraphic.graphic.uid)};U.processActiveGraphics=function(X){const T=this.ensureActiveGraphicsIterator(),Y=c.invert(L,this._runningViewState.camera.projectionMatrix),ea="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?N:null;let ia=0;y.isSome(ea)&&
(h.transformMat4(ea,m.ZEROS,this._runningViewState.camera.viewMatrix),ea[3]=k.getReferenceEllipsoid(this.view.spatialReference).radius,ia=A.distanceToSilhouette(ea,m.ZEROS));for(;!X.done;){X.madeProgress();var la=T.next();if(la.done)return this.resetActiveGraphicsIterator(),!0;const pa=(la=la.value)&&la.info[this.visibilityGroup];pa&&(this.collectGraphics3DGraphics(la,Y,ea,ia),pa.culled?this.removeFromVisibleGraphics(la):this.addToVisibleGraphics(la))}return!1};U.sortVisibleGraphics=function(X){const T=
this.ensureSortGraphicsIterator();for(;!X.done;){const Y=T.next();X.madeProgress();if(Y.done)return this.resetSortGraphicsIterator(),!0}return!1};U.deconflictVisibleGraphics=function(X){const T=this.ensureVisibleGraphicsIterator(),Y=1===this.visibilityGroup;for(;!X.done;){X.madeProgress();var ea=T.next();if(ea.done)return this.resetVisibleGraphicsIterator(),!0;ea=ea.value;const la=ea.info[this.visibilityGroup];if(la&&!la.culled){var ia=ea.graphics3DGraphic;(ia=(!Y||ia.isVisible())&&!this.isConflicted(ea))&&
this.addToBins(ea);la.visible=ia;this.setGraphicVisibility(ea,ia);B.drawPoly(la,ia)}}return!1};U.resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;this.iterators.sort=null};U.ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=M(this.graphics.active));return this.iterators.active};U.resetActiveGraphicsIterator=function(){this.iterators.active=null};U.ensureVisibleGraphicsIterator=function(){this.iterators.visible||(this.iterators.visible=
M(this.graphics.visible));return this.iterators.visible};U.resetVisibleGraphicsIterator=function(){this.iterators.visible=null};U.ensureSortGraphicsIterator=function(){this.iterators.sort||(this.iterators.sort=H(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};U.resetSortGraphicsIterator=function(){this.iterators.sort=null};U.collectGraphics3DGraphics=function(X,T,Y,ea){var ia=X.graphics3DGraphic;if(!ia.destroyed){var la=X.info[this.visibilityGroup];
if(ia.isVisible(0,3)){var pa=this.getGraphicsLayers(ia);v.empty(la.aabr);ia=null;for(const ua of pa)if(this.layerSupportsDeconfliction(ua)){pa=ua.stageObject.getGeometryRecord(0).material;if(y.isNone(ia)){ia=this.getProjectionInfo(ua,T,fa);if(ia.isOutsideScreen||this.isCulledBySlice(X,J)||y.isSome(Y)&&this.isCulledByHorizon(ia,Y,ea)){la.culled=!0;return}!D.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&la.visible&&(ia.distance*=.7)}this.expandBoundingRect(la,ua,pa,ia)}y.isNone(ia)?la.culled=!0:(la.distance=
ia.distance,la.culled=!1)}else la.culled=!0}};U.getProjectionInfo=function(X,T,Y){const ea=this._runningViewState.camera;X=X.stageObject;var ia=X.getGeometryRecord(0);const la=ia.material;var pa=A.getCenter(X.boundingVolumeWorldSpace.bounds);h.transformMat4(J,pa,ea.viewMatrix);pa=ia.geometry.vertexAttributes;ia=pa.get("normal").data;pa=pa.get("auxpos1").data;la.applyShaderOffsetsView(J,ia,X.transformation,pa,ea,Y.scaleInfo,J);n.set(O,J[0],J[1],J[2],1);n.transformMat4(I,O,ea.projectionMatrix);h.scale(Y.positionNDC,
I,1/I[3]);la.applyShaderOffsetsNDC(Y.positionNDC,pa,ea,Y.positionNDC,F);Y.distanceWithoutPolygonOffset=ea.depthNDCToWorld(F[2]);Y.distance=F[2]===Y.positionNDC[2]?Y.distanceWithoutPolygonOffset:ea.depthNDCToWorld(Y.positionNDC[2]);n.set(I,Y.positionNDC[0],Y.positionNDC[1],Y.positionNDC[2],1);n.transformMat4(O,I,T);n.scale(O,O,1/O[3]);h.set(Y.positionView,J[0],J[1],J[2]);return Y};U.isCulledByHorizon=function(X,T,Y){h.copy(R.direction,X.positionView);h.set(R.origin,0,0,0);return A.intersectRay(T,R,
S)?X.distanceWithoutPolygonOffset>Y:!1};U.isCulledBySlice=function(X,T){return X.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&x.extrusionContainsPoint(this._runningViewState.slicePlane,T)};U.expandBoundingRect=function(X,T,Y,{positionNDC:ea,scaleInfo:ia}){const la=this._runningViewState.camera;T=T.getScreenSize(ha);G.applyPrecomputedScaleFactor(T,ia.factor,T);T[0]*=la.pixelRatio;T[1]*=la.pixelRatio;Y=v.offset(Y.calculateRelativeScreenBounds(T,ia.factorAlignment.scale,P),q.lerp(0,la.fullWidth,
.5+.5*ea[0]),q.lerp(0,la.fullHeight,.5+.5*ea[1]));ea=this.iconMarginFactor;0!==ea&&(ea*=Math.min(v.width(Y),v.height(Y)),Y[0]-=ea,Y[1]-=ea,Y[2]+=ea,Y[3]+=ea);v.expand(X.aabr,Y,X.aabr)};U.isConflicted=function(X){const T=X.graphics3DGraphic.graphic.uid;X=X.info[this.visibilityGroup];for(let Y=Math.floor(X.aabr[0]/this.accBinsSizeX);Y<=Math.floor(X.aabr[2]/this.accBinsSizeX);Y++)if(!(0>Y||Y>=this.accBinsNumX))for(let ea=Math.floor(X.aabr[1]/this.accBinsSizeY);ea<=Math.floor(X.aabr[3]/this.accBinsSizeY);ea++){if(0>
ea||ea>=this.accBinsNumY)continue;const ia=this.accBins[Y][ea];for(let la=0;la<ia.length;la++){const pa=ia.data[la],ua=pa.info[this.visibilityGroup];if(ua&&ua.visible&&pa.graphics3DGraphic.graphic.uid!==T&&(this.accNumTests++,v.intersects(ua.aabr,X.aabr)))return!0}}return!1};U.initBins=function(X,T){if(null==this.accBins){this.accBins=[];for(var Y=0;Y<this.accBinsNumX;Y++){this.accBins.push([]);var ea=this.accBins[this.accBins.length-1];for(let ia=0;ia<this.accBinsNumY;ia++)ea.push(new f)}}else for(Y=
0;Y<this.accBinsNumX;Y++)for(ea=0;ea<this.accBinsNumY;ea++)this.accBins[Y][ea].clear();this.accBinsSizeX=X/this.accBinsNumX;this.accBinsSizeY=T/this.accBinsNumY;this.accNumTests=0};U.addToBins=function(X){var T=X.info[this.visibilityGroup],Y=Math.floor(T.aabr[0]/this.accBinsSizeX);const ea=Math.floor(T.aabr[2]/this.accBinsSizeX),ia=Math.floor(T.aabr[1]/this.accBinsSizeY);for(T=Math.floor(T.aabr[3]/this.accBinsSizeY);Y<=ea;Y++)if(!(0>Y||Y>=this.accBinsNumX))for(let la=ia;la<=T;la++)0>la||la>=this.accBinsNumY||
this.accBins[Y][la].push(X)};U.setGraphicVisibility=function(X,T){X=X.graphics3DGraphic;X.destroyed||(X.setVisibilityFlag(3,T,this.visibilityGroup),1===this.visibilityGroup&&this.view.labeler.setLabelGraphicVisibility(X,T))};p._createClass(W,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},{key:"updating",get:function(){return 0!==this._state||this._dirty}},{key:"updatingProgress",get:function(){if(!this.updating)return 1;const X=this._state/4;return this._dirty?
.5*X:X}},{key:"running",get:function(){return this.view.ready&&null!=this.view.state&&this.updating}}]);return W}(r);b.__decorate([w.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);b.__decorate([w.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=b.__decorate([d.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);const ha=t.create(),fa=new (function(){function aa(){this.positionView=m.create();this.positionNDC=
m.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}p._createClass(aa,[{key:"isOutsideScreen",get:function(){const W=this.positionNDC;return-1>W[0]||-1>W[1]||-1>W[2]||1<=W[0]||1<=W[1]}}]);return aa}());a.DeconflictorGraphic=function(aa,W,U={}){this.graphics3DGraphic=aa;this.slicePlaneEnabled=W;this.info=U};a.DeconflictorViewState=Z;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,p){function b(g,d,c,u,t){w&&(w(),w=null);const h=e.height,m=l;m.beginPath();m.lineWidth=1;m.strokeStyle=t;m.moveTo(g,h-c);m.lineTo(d,h-c);m.stroke();m.lineTo(d,h-u);m.stroke();m.lineTo(d,h-c);m.stroke();m.lineTo(g,h-c);m.stroke();m.lineTo(g,h-c);m.stroke();m.closePath()}let r=!1,q=!1,y=!1,f=!1,w=null,e,l;a.drawAccelerationStruct=function(g,d){if(q&&l){w&&
(w(),w=null);var c=l,u=0;for(let t=0;t<g.accBinsNumX;t++)for(let h=0;h<g.accBinsNumY;h++){const m=g.accBins[t][g.accBinsNumY-1-h];u+=m.length;const n=t*g.accBinsSizeX,z=(t+1)*g.accBinsSizeX,k=h*g.accBinsSizeY,v=(h+1)*g.accBinsSizeY;c.fillText(m.length.toFixed(),n+5,k+15);b(n,z,k,v,"blue")}c.fillText("total totalShownLabels: "+u,70,40);c.fillText("total visible labels: "+d.size,70,50);c.fillText("total numTests: "+g.accNumTests,70,30)}};a.drawPoly=function(g,d){r&&(d&&y||!d&&f)&&b(g.aabr[0],g.aabr[2],
g.aabr[1],g.aabr[3],d?"green":"red")};a.prepare=function(g){y=p.DECONFLICTOR_SHOW_VISIBLE;f=p.DECONFLICTOR_SHOW_INVISIBLE;r=y||f;q=p.DECONFLICTOR_SHOW_GRID;w=null;r||q?w=()=>{{null==e&&(e=document.createElement("canvas"),e.setAttribute("id","canvas2d"),g.surface.parentElement.style.position="relative",g.surface.parentElement.appendChild(e));const d=g.height*g.pixelRatio;e.setAttribute("width",`${g.width*g.pixelRatio}px`);e.setAttribute("height",`${d}px`);e.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${g.width}px;height:${g.height}px`);
l=e.getContext("2d");l.clearRect(0,0,g.width,g.height);l.font="12px Arial"}}:e&&(e.parentElement.removeChild(e),e=null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/debugFlags":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w){b=function(e){function l(){var g=e.apply(this,arguments)||this;g.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;g.SCENEVIEW_LOCKING_LOG=!1;g.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0;g.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;g.DECONFLICTOR_SHOW_VISIBLE=!1;g.DECONFLICTOR_SHOW_INVISIBLE=!1;g.DECONFLICTOR_SHOW_GRID=!1;g.LABELS_SHOW_BORDER=!1;g.OVERLAY_DRAW_DEBUG_TEXTURE=!1;g.OVERLAY_SHOW_CENTER=!1;g.SHOW_POI=!1;g.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;g.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1;
g.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;g.DRAW_MESH_GEOMETRY_NORMALS=!1;g.FEATURE_TILE_FETCH_SHOW_TILES=!1;g.FEATURE_TILE_TREE_SHOW_TILES=!1;g.TERRAIN_TILE_TREE_SHOW_TILES=!1;g.I3S_TREE_SHOW_TILES=!1;g.I3S_SHOW_MODIFICATIONS=!1;g.ENABLE_PROFILE_DEPTH_RANGE=!1;g.DISABLE_FAST_UPDATES=!1;g.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;g.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;g.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;g.ENABLE_CONTINUOUS_LINE_PATTERNS=!1;return g}a._inheritsLoose(l,e);return l}(b);
p.__decorate([r.property()],b.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);p.__decorate([r.property()],b.prototype,"SCENEVIEW_LOCKING_LOG",void 0);p.__decorate([r.property()],b.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0);p.__decorate([r.property()],b.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);p.__decorate([r.property()],b.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);p.__decorate([r.property()],b.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);p.__decorate([r.property()],
b.prototype,"DECONFLICTOR_SHOW_GRID",void 0);p.__decorate([r.property()],b.prototype,"LABELS_SHOW_BORDER",void 0);p.__decorate([r.property()],b.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);p.__decorate([r.property()],b.prototype,"OVERLAY_SHOW_CENTER",void 0);p.__decorate([r.property()],b.prototype,"SHOW_POI",void 0);p.__decorate([r.property()],b.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);p.__decorate([r.property()],b.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);p.__decorate([r.property()],
b.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);p.__decorate([r.property()],b.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);p.__decorate([r.property()],b.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);p.__decorate([r.property()],b.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);p.__decorate([r.property()],b.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);p.__decorate([r.property()],b.prototype,"I3S_TREE_SHOW_TILES",void 0);p.__decorate([r.property()],b.prototype,"I3S_SHOW_MODIFICATIONS",
void 0);p.__decorate([r.property()],b.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);p.__decorate([r.property()],b.prototype,"DISABLE_FAST_UPDATES",void 0);p.__decorate([r.property()],b.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);p.__decorate([r.property()],b.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);p.__decorate([r.property()],b.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);p.__decorate([r.property()],b.prototype,"ENABLE_CONTINUOUS_LINE_PATTERNS",void 0);
b=p.__decorate([w.subclass("esri.views.3d.support.DebugFlags")],b);return new b})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils"],function(a,p,b){function r(g,d,c){const u=c.parameters;c=c.paddingPixelsOverride;e.scale=Math.min(u.divisor/(d-u.offset),1);e.factor=Math.abs(g*g*g);e.minPixelSize=u.minPixelSize;e.paddingPixels=c;return e}function q(g,d){return 0===g?d.minPixelSize:d.minPixelSize*
(1+2*d.paddingPixels/g)}function y(g,d){return Math.max(b.lerp(g*d.scale,g,d.factor),q(g,d))}let f=function(){function g(c,u,t,h={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},m){this.viewingMode=c;this.description=u;this.ellipsoidRadius=t;this.parameters=h;this._paddingPixelsOverride=m;2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=
this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}var d=g.prototype;d.update=function(c){if(this.parameters&&this.parameters.camera.fovY===c.fovY&&this.parameters.camera.distance===c.distance)return!1;this.calculateParameters(c,this.ellipsoidRadius,this.parameters);return!0};d.overridePadding=function(c){return c!==this.paddingPixelsOverride?new g(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,
c):this};d.calculateParameters=function(c,u,t){const {scaleStart:h,scaleFallOffRange:m,minPixelSize:n}=this.description,{fovY:z,distance:k}=c;var v=this.calculateCurvatureDependentParameters(c,u);u=this.coverageCompensation(c,u,v);const {tiltAngle:x,scaleFallOffFactor:C}=v,A=Math.sin(x)*k,B=.5*Math.PI-x-z*(.5-h*u);v=A/Math.cos(B);u=(v-A/Math.cos(B+z*m*u)*C)/(1-C);t.camera.fovY=c.fovY;t.camera.distance=c.distance;t.offset=u;t.divisor=v-u;t.minPixelSize=n;return t};d.calculateCurvatureDependentParametersLocal=
function(c,u,t=l){t.tiltAngle=this.description.curvatureDependent.min.tiltAngle;t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return t};d.calculateCurvatureDependentParametersGlobal=function(c,u,t=l){const h=this.description.curvatureDependent;c=1+c.distance/u;c=Math.sqrt(c*c-1);const [m,n]=[h.min.curvature,h.max.curvature];c=b.clamp((c-m)/(n-m),0,1);const [z,k]=[h.min,h.max];t.tiltAngle=b.lerp(z.tiltAngle,k.tiltAngle,c);t.scaleFallOffFactor=b.lerp(z.scaleFallOffFactor,
k.scaleFallOffFactor,c);return t};d.surfaceCoverageCompensationLocal=function(c,u,t){return(c.fovY-t.tiltAngle)/c.fovY};d.surfaceCoverageCompensationGlobal=function(c,u,t){const h=u*u;t=t.tiltAngle+.5*Math.PI;const {fovY:m,distance:n}=c;c=n*n+h-2*Math.cos(t)*n*u;const z=Math.sqrt(c);return(Math.acos(Math.sqrt(c-h)/z)-Math.asin(u/(z/Math.sin(t)))+.5*m)/m};p._createClass(g,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return g}();
const w={curvatureDependent:{min:{curvature:b.deg2rad(10),tiltAngle:b.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:b.deg2rad(70),tiltAngle:b.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},e={scale:0,factor:0,minPixelSize:0,paddingPixels:0},l={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(g,d,c=[0,0]){d=Math.min(Math.max(d.scale,q(g[1],d)/g[1]),1);c[0]=g[0]*d;c[1]=g[1]*d;return c};a.applyScaleFactor=y;a.applyScaleFactorVec2=function(g,
d,c=[0,0]){const u=Math.min(Math.max(d.scale,q(g[1],d)/g[1]),1);c[0]=b.lerp(g[0]*u,g[0],d.factor);c[1]=b.lerp(g[1]*u,g[1],d.factor);return c};a.getLabelSettings=function(g,d){const {curvatureDependent:c,scaleStart:u,scaleFallOffRange:t}=w;return new f(g,{curvatureDependent:{min:{curvature:c.min.curvature,tiltAngle:c.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:c.max.curvature,tiltAngle:c.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:u,scaleFallOffRange:t,minPixelSize:14},d)};a.getSettings=
function(g,d){return new f(g,w,d)};a.precomputeScaleFactor=function(g,d,c,u){g=r(g,d,c);g.minPixelSize=0;g.paddingPixels=0;g=y(1,g);u.scale=g;u.factor=0;u.minPixelSize=c.parameters.minPixelSize;u.paddingPixels=c.paddingPixelsOverride};a.scale=function(g,d,c,u){return y(g,r(d,c,u))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/utils ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D){function E(U,X,T,Y=O){l.copy(Y,U.anchorPos);Y[0]*=-X[0];Y[1]*=-X[1];Y[0]+=U.screenOffset[0]*T;Y[1]+=U.screenOffset[1]*T;return Y}function G(U,X,T,Y,ea,ia,la,pa){X=X-ea-(0<pa[0]?Y[0]*pa[0]:0);let ua=X+Y[0]+2*ea;T=T-ea-(0<pa[1]?Y[1]*pa[1]:0);ea=T+Y[1]+2*ea;la.textureIsSignedDistanceField&&(la=la.distanceFieldBoundingBox,X+=Y[0]*la[0],T+=Y[1]*la[1],ua-=Y[0]*(1-la[2]),ea-=Y[1]*(1-la[3]),X-=ia,ua+=ia,T-=ia,ea+=ia);return U[0]>X&&U[0]<ua&&U[1]>
T&&U[1]<ea}let K=function(U){function X(Y){Y=U.call(this,Y,fa)||this;Y.techniqueConfig=new D.HUDMaterialTechniqueConfiguration;return Y}p._inheritsLoose(X,U);var T=X.prototype;T.getTechniqueConfig=function(Y,ea){this.techniqueConfig.output=Y;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.screenCenterOffsetUnitsEnabled=
"screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;this.techniqueConfig.isDraped=this.params.isDraped;this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled;this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField;this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.params.vvColorEnabled;0===Y&&(this.techniqueConfig.debugDrawBorder=
!!this.params.debugDrawBorder);4===Y&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.params.depthEnabled;this.techniqueConfig.transparencyPassType=ea?ea.transparencyPassType:3;this.techniqueConfig.multipassGeometryEnabled=ea?ea.multipassGeometryEnabled:!1;this.techniqueConfig.multipassTerrainEnabled=ea?ea.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=ea?ea.cullAboveGround:!1;return this.techniqueConfig};
T.intersect=function(Y,ea,ia,la,pa,ua,wa,Fa,La){La?this.intersectDrapedHudGeometry(Y,ua,wa,Fa):this.intersectHudGeometry(Y,ea,ia,la,wa,Fa)};T.intersectDrapedHudGeometry=function(Y,ea,ia,la){const pa=Y.vertexAttributes.get("position"),ua=Y.vertexAttributes.get("size"),wa=this.params,Fa=B.calculateAnchorPosForRendering(wa);let La=1;var Ma=1;r.isSome(la)&&(Ma=la(ba),La=Ma[0],Ma=Ma[5]);La*=Y.screenToWorldRatio;Ma*=Y.screenToWorldRatio;la=2*Y.screenToWorldRatio;for(let Ia=0;Ia<pa.data.length/pa.size;Ia++){var Sa=
Ia*pa.size;const va=pa.data[Sa];Sa=pa.data[Sa+1];const ma=Ia*ua.size;Z[0]=ua.data[ma]*La;Z[1]=ua.data[ma+1]*Ma;let ta;wa.textureIsSignedDistanceField&&(ta=wa.outlineSize*Y.screenToWorldRatio/2);G(ea,va,Sa,Z,la,ta,wa,Fa)&&ia()}};T.intersectHudGeometry=function(Y,ea,ia,la,pa,ua){if(la.options.selectionMode&&la.options.hud&&!A.isInstanceHidden(ea)){ea=this.params;var wa=1,Fa=1;y.fromMat4(S,ia);if(r.isSome(ua)){Fa=ua(ba);wa=Fa[0];Fa=Fa[5];{ua=S;var La=ua[0],Ma=ua[1],Sa=ua[2],Ia=ua[3],va=ua[4],ma=ua[5],
ta=ua[6],Ea=ua[7],Ca=ua[8],ka=1/Math.sqrt(La*La+Ma*Ma+Sa*Sa);const sa=1/Math.sqrt(Ia*Ia+va*va+ma*ma),Ja=1/Math.sqrt(ta*ta+Ea*Ea+Ca*Ca);ua[0]=La*ka;ua[1]=Ma*ka;ua[2]=Sa*ka;ua[3]=Ia*sa;ua[4]=va*sa;ua[5]=ma*sa;ua[6]=ta*Ja;ua[7]=Ea*Ja;ua[8]=Ca*Ja}}ua=Y.vertexAttributes.get("position");La=Y.vertexAttributes.get("size");Ma=Y.vertexAttributes.get("normal");Y=Y.vertexAttributes.get("auxpos1");v.assert(3<=ua.size);Sa=la.point;Ia=la.camera;va=B.calculateAnchorPosForRendering(ea);wa*=Ia.pixelRatio;Fa*=Ia.pixelRatio;
ma="screen"===this.params.centerOffsetUnits;for(ta=0;ta<ua.data.length/ua.size;ta++)if(Ea=ta*ua.size,d.set(I,ua.data[Ea],ua.data[Ea+1],ua.data[Ea+2]),d.transformMat4(I,I,ia),Ea=ta*La.size,Z[0]=La.data[Ea]*wa,Z[1]=La.data[Ea+1]*Fa,d.transformMat4(I,I,Ia.viewMatrix),Ea=ta*Y.size,d.set(V,Y.data[Ea+0],Y.data[Ea+1],Y.data[Ea+2]),ma||(I[0]+=V[0],I[1]+=V[1],0!==V[2]&&(Ea=V[2],d.normalize(V,I),d.subtract(I,I,d.scale(V,V,Ea)))),Ea=ta*Ma.size,d.set(F,Ma.data[Ea],Ma.data[Ea+1],Ma.data[Ea+2]),this.normalAndViewAngle(F,
S,Ia,ca),this.applyVerticalOffsetTransformationView(I,ca,Ia,J),Ia.applyProjection(I,L),-1<L[0]){Ea=Math.floor(L[0])+this.params.screenOffset[0];Ca=Math.floor(L[1])+this.params.screenOffset[1];ma&&(Ea+=V[0],0!==V[1]&&(Ca+=k.applyScaleFactor(V[1],J.factorAlignment)));k.applyPrecomputedScaleFactor(Z,J.factor,Z);ka=1*Ia.pixelRatio;let sa;ea.textureIsSignedDistanceField&&(sa=ea.outlineSize*Ia.pixelRatio/2);G(Sa,Ea,Ca,Z,ka,sa,ea,va)&&(Ca=la.ray,d.transformMat4(R,I,w.invert(Q,Ia.viewMatrix)),L[0]=Sa[0],
L[1]=Sa[1],Ia.unprojectFromRenderScreen(L,I)&&(Ea=c.create(),d.copy(Ea,Ca.direction),ka=1/d.length(Ea),d.scale(Ea,Ea,ka),Ca=d.distance(Ca.origin,I)*ka,pa(Ca,Ea,-1,1,!0,R)))}}};T.computeAttachmentOrigin=function(Y,ea){var ia=Y.vertexAttributes;if(!ia)return!1;ia=ia.get("position");Y=Y.indices.get("position");return m.computeAttachmentOriginPoints(ia,Y,ea)};T.createBufferWriter=function(){return new W(this)};T.normalAndViewAngle=function(Y,ea,ia,la){u.isMat4(ea)&&(ea=y.fromMat4(P,ea));d.transformMat3(la.normal,
Y,ea);d.transformMat4(la.normal,la.normal,ia.viewInverseTransposeMatrix);la.cosAngle=d.dot(N,ha);return la};T.updateScaleInfo=function(Y,ea,ia){const la=this.params;la.screenSizePerspective?k.precomputeScaleFactor(ia,ea,la.screenSizePerspective,Y.factor):(Y.factor.scale=1,Y.factor.factor=0,Y.factor.minPixelSize=0,Y.factor.paddingPixels=0);la.screenSizePerspectiveAlignment?k.precomputeScaleFactor(ia,ea,la.screenSizePerspectiveAlignment,Y.factorAlignment):(Y.factorAlignment.factor=Y.factor.factor,Y.factorAlignment.scale=
Y.factor.scale,Y.factorAlignment.minPixelSize=Y.factor.minPixelSize,Y.factorAlignment.paddingPixels=Y.factor.paddingPixels)};T.applyShaderOffsetsView=function(Y,ea,ia,la,pa,ua,wa){ea=this.normalAndViewAngle(ea,ia,pa,ca);this.applyVerticalGroundOffsetView(Y,ea,pa,wa);this.applyVerticalOffsetTransformationView(wa,ea,pa,ua);this.applyPolygonOffsetView(wa,ea,la[3],pa,wa);this.applyCenterOffsetView(wa,la,wa);return wa};T.applyShaderOffsetsNDC=function(Y,ea,ia,la,pa){this.applyCenterOffsetNDC(Y,ea,ia,la);
r.isSome(pa)&&d.copy(pa,la);this.applyPolygonOffsetNDC(la,ea,ia,la);return la};T.applyPolygonOffsetView=function(Y,ea,ia,la,pa){var ua=la.aboveGround?1:-1;ia=b.sign(ia);0===ia&&(ia=ua);ua*=ia;if(0>=this.params.shaderPolygonOffset)return d.copy(pa,Y);ea=b.clamp(Math.abs(ea.cosAngle),.01,1);la=1-Math.sqrt(1-ea*ea)/ea/la.viewport[2];0<ua?d.scale(pa,Y,la):d.scale(pa,Y,1/la);return pa};T.applyVerticalGroundOffsetView=function(Y,ea,ia,la){const pa=d.length(Y),ua=ia.aboveGround?1:-1;ia=.5*ia.computeRenderPixelSizeAtDist(pa);
ea=d.scale(I,ea.normal,ua*ia);d.add(la,Y,ea);return la};T.applyVerticalOffsetTransformationView=function(Y,ea,ia,la){const pa=this.params;if(!pa.verticalOffset||!pa.verticalOffset.screenLength){if(pa.screenSizePerspective||pa.screenSizePerspectiveAlignment){var ua=d.length(Y);this.updateScaleInfo(la,ua,ea.cosAngle)}else la.factor.scale=1,la.factorAlignment.scale=1;return Y}ua=d.length(Y);ia=C.verticalOffsetAtDistance(ia,ua,pa.verticalOffset,ea.cosAngle,pa.screenSizePerspectiveAlignment||pa.screenSizePerspective);
this.updateScaleInfo(la,ua,ea.cosAngle);d.scale(ea.normal,ea.normal,ia);return d.add(Y,Y,ea.normal)};T.applyCenterOffsetView=function(Y,ea,ia){const la="screen"!==this.params.centerOffsetUnits;ia!==Y&&d.copy(ia,Y);la&&(ia[0]+=ea[0],ia[1]+=ea[1],ea[2]&&(d.normalize(F,ia),d.add(ia,ia,d.scale(F,F,ea[2]))));return ia};T.applyCenterOffsetNDC=function(Y,ea,ia,la){const pa="screen"!==this.params.centerOffsetUnits;la!==Y&&d.copy(la,Y);pa||(la[0]+=ea[0]/ia.fullWidth*2,la[1]+=ea[1]/ia.fullHeight*2);return la};
T.applyPolygonOffsetNDC=function(Y,ea,ia,la){const pa=this.params.shaderPolygonOffset;Y!==la&&d.copy(la,Y);pa&&(Y=ia.aboveGround?1:-1,ea=Y*b.sign(ea[3]),la[2]-=(ea||Y)*pa);return la};T.getGLMaterial=function(Y){if(0===Y.output||7===Y.output)return new M(Y);if(4===Y.output)return new H(Y)};T.calculateRelativeScreenBounds=function(Y,ea,ia=t.create()){E(this.params,Y,ea,ia);ia[2]=ia[0]+Y[0];ia[3]=ia[1]+Y[1];return ia};return X}(z.Material);n=function(U){function X(Y){Y=U.call(this,{...Y,...Y.material.params})||
this;Y.updateParameters();return Y}p._inheritsLoose(X,U);var T=X.prototype;T.beginSlot=function(Y){return Y===(this._material.params.drawInSecondSlot?20:19)||23===Y};T.updateParameters=function(Y){this.updateTexture(this._material.params.textureId);this.selectProgram(Y)};T.selectProgram=function(Y){this._technique=this._techniqueRep.releaseAndAcquire(D.HUDMaterialTechnique,this._material.getTechniqueConfig(this._output,Y),this._technique)};T.ensureParameters=function(Y){this.updateParameters(Y)};
T.bind=function(Y){this.bindTextures(this._technique.program);this.bindTextureScale(this._technique.program);this._technique.bindPass(this._material.params,Y)};return X}(n);let M=function(U){function X(Y){Y=U.call(this,Y)||this;Y._isOcclusionSlot=!1;return Y}p._inheritsLoose(X,U);var T=X.prototype;T.beginSlot=function(Y){if(23===Y)return!0;const ea=this._material.params.drawInSecondSlot?20:19;if(this._material.params.occlusionTest)return this._isOcclusionSlot=12===Y,12===Y||Y===ea;this._isOcclusionSlot=
!1;return Y===ea};T.selectProgram=function(Y){this._technique=this._techniqueRep.releaseAndAcquire(D.HUDMaterialTechnique,this._material.getTechniqueConfig(this._output,Y),this._technique);this._occlusionTechnique=this._techniqueRep.releaseAndAcquire(D.HUDMaterialTechnique,this._material.getTechniqueConfig(6,Y),this._occlusionTechnique)};T.bind=function(Y){const ea=this.technique;this._isOcclusionSlot||(this.bindTextures(ea.program),this.bindTextureScale(ea.program));ea.bindPass(this._material.params,
Y)};p._createClass(X,[{key:"technique",get:function(){return this._isOcclusionSlot?this._occlusionTechnique:this._technique}}]);return X}(n),H=function(U){function X(T){return U.call(this,{...T,output:4})||this}p._inheritsLoose(X,U);return X}(n);const J={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},O=g.create(),I=c.create(),F=c.create(),L=q.createRenderScreenPointArray3(),N=c.create(),R=c.create(),S=f.create(),P=f.create(),
Q=e.create(),V=c.create(),ca={normal:N,cosAngle:0},ba=e.create(),Z=[0,0],ha=c.fromValues(0,0,1),fa={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,
0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:g.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...z.materialParametersDefaults},aa=h.newLayout().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");
let W=function(){function U(T){this.material=T;this.vertexBufferLayout=aa}var X=U.prototype;X.allocate=function(T){return this.vertexBufferLayout.createBuffer(T)};X.elementCount=function(T){return 6*T.indices.get("position").length};X.write=function(T,Y,ea,ia){x.writePosition(Y.indices.get("position"),Y.vertexAttributes.get("position").data,T.transformation,ea.position,ia,6);x.writeNormal(Y.indices.get("normal"),Y.vertexAttributes.get("normal").data,T.invTranspTransformation,ea.normal,ia,6);var la=
Y.vertexAttributes.get("uv0").data;if(null==la||4>la.length){la=this.material.params;var pa=T=0;var ua=la.texCoordScale[0];la=la.texCoordScale[1]}else T=la[0],pa=la[1],ua=la[2],la=la[3];ua=Math.min(1.99999,ua+1);la=Math.min(1.99999,la+1);var wa=Y.indices.get("position").length,Fa=ea.uv0,La=ia;for(var Ma=0;Ma<wa;++Ma)Fa.set(La,0,T),Fa.set(La,1,pa),La+=1,Fa.set(La,0,ua),Fa.set(La,1,pa),La+=1,Fa.set(La,0,ua),Fa.set(La,1,la),La+=1,Fa.set(La,0,ua),Fa.set(La,1,la),La+=1,Fa.set(La,0,T),Fa.set(La,1,la),La+=
1,Fa.set(La,0,T),Fa.set(La,1,pa),La+=1;x.writeColor(Y.indices.get("color"),Y.vertexAttributes.get("color").data,4,ea.color,ia,6);T=Y.indices.get("size");pa=Y.vertexAttributes.get("size").data;ua=T.length;la=ea.size;wa=ia;for(Fa=0;Fa<ua;++Fa){La=pa[2*T[Fa]];Ma=pa[2*T[Fa]+1];for(let Sa=0;6>Sa;++Sa)la.set(wa,0,La),la.set(wa,1,Ma),wa+=1}Y.indices.get("auxpos1")&&Y.vertexAttributes.get("auxpos1")&&x.writeBufferVec4(Y.indices.get("auxpos1"),Y.vertexAttributes.get("auxpos1").data,ea.auxpos1,ia,6);Y.indices.get("auxpos2")&&
Y.vertexAttributes.get("auxpos2")&&x.writeBufferVec4(Y.indices.get("auxpos2"),Y.vertexAttributes.get("auxpos2").data,ea.auxpos2,ia,6)};return U}();a.HUDMaterial=K;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function p(r){return r instanceof Float32Array&&16<=r.length}function b(r){return Array.isArray(r)&&16<=r.length}a.isMat4=function(r){return p(r)||b(r)};a.isMat4f32=p;a.isMat4f64=b;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./GLMaterial"],function(a,p,b){return function(r){function q(f){var w=r.call(this,f)||this;w._textureIDs=new Set;w._textureRepository=f.textureRep;w._textureId=f.textureId;w._initTransparent=!!f.initTextureTransparent;w._texture=w._acquire(w._textureId);w._textureNormal=w._acquire(f.normalTextureId);w._textureEmissive=w._acquire(f.emissiveTextureId);
w._textureOcclusion=w._acquire(f.occlusionTextureId);w._textureMetallicRoughness=w._acquire(f.metallicRoughnessTextureId);return w}a._inheritsLoose(q,r);var y=q.prototype;y.dispose=function(){this._textureIDs.forEach(f=>this._textureRepository.release(f));this._textureIDs.clear()};y.updateTexture=function(f){f!==this._textureId&&(this._release(this._textureId),this._textureId=f,this._texture=this._acquire(this._textureId))};y.bindTextures=function(f){p.isSome(this._texture)&&f.bindTexture(this._texture.glTexture,
"tex");p.isSome(this._textureNormal)&&f.bindTexture(this._textureNormal.glTexture,"normalTexture");p.isSome(this._textureEmissive)&&f.bindTexture(this._textureEmissive.glTexture,"texEmission");p.isSome(this._textureOcclusion)&&f.bindTexture(this._textureOcclusion.glTexture,"texOcclusion");p.isSome(this._textureMetallicRoughness)&&f.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")};y.bindTextureScale=function(f){const w=p.isSome(this._texture)&&this._texture.glTexture;w&&
w.descriptor.textureCoordinateScaleFactor?f.setUniform2fv("textureCoordinateScaleFactor",w.descriptor.textureCoordinateScaleFactor):f.setUniform2f("textureCoordinateScaleFactor",1,1)};y._acquire=function(f){if(!p.isNone(f))return this._textureIDs.add(f),this._textureRepository.acquire(f,this._initTransparent)};y._release=function(f){p.isNone(f)||(this._textureIDs.delete(f),this._textureRepository.release(f))};return q}(b)})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./AutoDisposable"],function(a,p){return function(b){function r(y){var f=b.call(this)||this;f._material=y.material;f._techniqueRep=y.techniqueRep;f._output=y.output;return f}a._inheritsLoose(r,b);var q=r.prototype;q.getPipelineState=function(y,f){return this.technique.pipeline};q.ensureResources=function(y){return 2};q.ensureParameters=function(y){};a._createClass(r,[{key:"technique",get:function(){return this._technique}}]);return r}(p.AutoDisposable)})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers"],function(a,p){const b=q=>function(y){function f(){var w=y.apply(this,arguments)||this;w._isDisposed=!1;return w}p._inheritsLoose(f,y);f.prototype.dispose=function(){for(const e of null!=(w=this._managedDisposables)?w:[]){var w;w=this[e];this[e]=null;w&&"function"===typeof w.dispose&&w.dispose()}this._isDisposed=!0};p._createClass(f,[{key:"isDisposed",get:function(){return this._isDisposed}}]);return f}(q);let r=function(q){function y(){return q.apply(this,
arguments)||this}p._inheritsLoose(y,q);return y}(b(function(){return function(){}}()));a.AutoDisposable=r;a.AutoDisposableMixin=b;a.autoDispose=function(){return(q,y)=>{if(!q.hasOwnProperty("_managedDisposables")){var f,w;q._managedDisposables=null!=(f=null==(w=q._managedDisposables)?void 0:w.slice())?f:[]}q._managedDisposables.unshift(y)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./ContentObject ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),
function(a,p,b,r,q,y){r=function(f){function w(l,g){var d=f.call(this)||this;d.type=3;d.supportsEdges=!1;d._visible=!0;d._renderPriority=0;d._insertOrder=0;d._vertexAttributeLocations=q.Default3D;d._params=y.copyParameters(l,g);d.validateParameterValues(d._params);return d}p._inheritsLoose(w,f);var e=w.prototype;e.dispose=function(){};e.update=function(l){return!1};e.setParameterValues=function(l){y.updateParameters(this._params,l)&&(this.validateParameterValues(this._params),this.parametersChanged())};
e.validateParameterValues=function(l){};e.isVisibleInPass=function(l){return!0};e.isVisible=function(){return this._visible};e.parametersChanged=function(){b.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)};p._createClass(w,[{key:"params",get:function(){return this._params}},{key:"visible",get:function(){return this._visible},set:function(l){l!==this._visible&&(this._visible=l,this.parametersChanged())}},{key:"renderOccluded",get:function(){return this.params.renderOccluded}},
{key:"renderPriority",get:function(){return this._renderPriority},set:function(l){l!==this._renderPriority&&(this._renderPriority=l,this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},set:function(l){l!==this._insertOrder&&(this._insertOrder=l,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return w}(r.ContentObject);a.Material=r;a.materialParametersDefaults={renderOccluded:1};a.materialPredicate=
function(f,w){return f.isVisible()&&f.isVisibleInPass(w.pass)&&0!==(f.renderOccluded&w.renderOccludedMask)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/screenSizePerspectiveUtils ../../lib/Util ../renderers/utils".split(" "),function(a,
p,b,r,q,y,f,w,e){function l(C,A,B,D,E,G){if(!b.isNone(C)){var K=c(A,B,z);y.setMin(n,C.getBBMin());y.setMax(n,C.getBBMax());b.isSome(E)&&E.applyToAabb(n);if(u(n,A,K,D)){const {primitiveIndices:M,indices:H,position:J}=C;K=M?M.length:H.length/3;if(1E3<K&&(C=C.getChildren(),void 0!==C)){for(K=0;8>K;++K)void 0!==C[K]&&l(C[K],A,B,D,E,G);return}g(A,B,0,K,H,J,M,E,G)}}}function g(C,A,B,D,E,G,K,M,H){if(K){var J=G.data;G=G.stride||G.size;var O=C[0],I=C[1];C=C[2];var F=A[0]-O,L=A[1]-I;for(A=A[2]-C;B<D;++B){var N=
K[B],R=3*N,S=G*E[R++],P=J[S++],Q=J[S++],V=J[S];S=G*E[R++];var ca=J[S++],ba=J[S++],Z=J[S];S=G*E[R];R=J[S++];var ha=J[S++];S=J[S];b.isSome(M)&&([P,Q,V]=M.applyToVertex(P,Q,V,B),[ca,ba,Z]=M.applyToVertex(ca,ba,Z,B),[R,ha,S]=M.applyToVertex(R,ha,S,B));ca-=P;ba-=Q;Z-=V;R-=P;ha-=Q;S-=V;var fa=L*S-ha*A,aa=A*R-S*F;const U=F*ha-R*L;var W=ca*fa+ba*aa+Z*U;if(!(Math.abs(W)<=Number.EPSILON)){P=O-P;Q=I-Q;V=C-V;fa=P*fa+Q*aa+V*U;if(0<W){if(0>fa||fa>W)continue}else if(0<fa||fa<W)continue;aa=Q*Z-ba*V;V=V*ca-Z*P;Q=
P*ba-ca*Q;P=F*aa+L*V+A*Q;if(0<W){if(0>P||fa+P>W)continue}else if(0<P||fa+P<W)continue;V=(R*aa+ha*V+S*Q)/W;0<=V&&(ca=d(ca,ba,Z,R,ha,S,k),H(V,ca,N))}}}else{K=G.data;J=G.stride||G.size;G=C[0];O=C[1];I=C[2];C=A[0]-G;F=A[1]-O;L=A[2]-I;for(let U=B,X=3*B;U<D;++U)if(R=J*E[X++],Q=K[R++],V=K[R++],Z=K[R],R=J*E[X++],A=K[R++],B=K[R++],N=K[R],R=J*E[X++],ca=K[R++],ba=K[R++],R=K[R],b.isSome(M)&&([Q,V,Z]=M.applyToVertex(Q,V,Z,U),[A,B,N]=M.applyToVertex(A,B,N,U),[ca,ba,R]=M.applyToVertex(ca,ba,R,U)),A-=Q,B-=V,N-=Z,
ca-=Q,ba-=V,R-=Z,S=F*R-ba*L,P=L*ca-R*C,W=C*ba-ca*F,ha=A*S+B*P+N*W,!(Math.abs(ha)<=Number.EPSILON)){Q=G-Q;V=O-V;Z=I-Z;S=Q*S+V*P+Z*W;if(0<ha){if(0>S||S>ha)continue}else if(0<S||S<ha)continue;P=V*N-B*Z;Z=Z*A-N*Q;V=Q*B-A*V;Q=C*P+F*Z+L*V;if(0<ha){if(0>Q||S+Q>ha)continue}else if(0<Q||S+Q<ha)continue;Z=(ca*P+ba*Z+R*V)/ha;0<=Z&&(A=d(A,B,N,ca,ba,R,k),H(Z,A,U))}}}function d(C,A,B,D,E,G,K){r.set(v,C,A,B);r.set(x,D,E,G);r.cross(K,v,x);r.normalize(K,K);return K}function c(C,A,B){return r.set(B,1/(A[0]-C[0]),1/
(A[1]-C[1]),1/(A[2]-C[2]))}function u(C,A,B,D){return t(C,A,B,D,Infinity)}function t(C,A,B,D,E){var G=(C[0]-D-A[0])*B[0],K=(C[3]+D-A[0])*B[0];let M=Math.min(G,K);G=Math.max(G,K);K=(C[1]-D-A[1])*B[1];const H=(C[4]+D-A[1])*B[1];G=Math.min(G,Math.max(K,H));if(0>G)return!1;M=Math.max(M,Math.min(K,H));if(M>G)return!1;K=(C[2]-D-A[2])*B[2];C=(C[5]+D-A[2])*B[2];G=Math.min(G,Math.max(K,C));if(0>G)return!1;M=Math.max(M,Math.min(K,C));return M>G?!1:M<E}function h(C,A){A=A?h(A):{};for(const B in C){let D=C[B];
D&&D.forEach&&(D=m(D));null==D&&B in A||(A[B]=D)}return A}function m(C){const A=[];C.forEach(B=>A.push(B));return A}const n=y.create(),z=q.create(),k=q.create(),v=q.create(),x=q.create();a.bindScreenSizePerspective=function(C,A,B){if(C){var D=C.parameters;A.setUniform4f(B,D.divisor,D.offset,D.minPixelSize,C.paddingPixelsOverride)}};a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=c;a.computeNormal=d;a.copyParameters=h;a.intersectAabbInvDir=u;a.intersectAabbInvDirBefore=t;a.intersectDrapedRenderLineGeometry=
function(C,A,B,D,E){if(A.options.selectionMode){A=C.vertexAttributes.get("position").data;var G=C.vertexAttributes.get("size"),K=B[0];B=B[1];C=(((G&&G.data[0])+D)/2+4)*C.screenToWorldRatio;D=Number.MAX_VALUE;for(G=0;G<A.length-5;G+=3){var M=A[G],H=A[G+1],J=K-M,O=B-H;M=A[G+3]-M;H=A[G+4]-H;const I=p.clamp((M*J+H*O)/(M*M+H*H),0,1);J=M*I-J;O=H*I-O;O=J*J+O*O;O<D&&(D=O)}D<C*C&&E()}};a.intersectTriangleGeometry=function(C,A,B,D,E,G,K){e.isInstanceHidden(A)||(C.boundingInfo?(w.assert(0===C.primitiveType),
l(C.boundingInfo,D,E,B.tolerance,G,K)):(A=C.indices.get("position"),C=C.vertexAttributes.get("position"),g(D,E,0,A.length/3,A,C,void 0,G,K)))};a.intersectTriangles=g;a.updateParameters=function(C,A){let B=!1;for(const D in A){const E=A[D];void 0!==E&&(B=!0,Array.isArray(E)?C[D]=E.slice():C[D]=E)}return B};a.verticalOffsetAtDistance=function(C,A,B,D,E){let G=(B.screenLength||0)*C.pixelRatio;E&&(G=f.scale(G,D,A,E));return p.clamp(G*Math.tan(.5*C.fovY)/(.5*C.fullHeight)*A,B.minWorldLength||0,null!=B.maxWorldLength?
B.maxWorldLength:Infinity)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../chunks/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util"],function(a,p,b,r){function q(d,c,u,t){const h=u.typedBuffer;u=u.typedBufferStride;const m=d.length;t*=u;for(let n=0;n<m;++n){const z=2*d[n];h[t]=c[z];h[t+1]=c[z+1];t+=u}}function y(d,c,u,t,h){const m=u.typedBuffer;u=u.typedBufferStride;
const n=d.length;t*=u;if(null==h||1===h)for(h=0;h<n;++h){var z=3*d[h];m[t]=c[z];m[t+1]=c[z+1];m[t+2]=c[z+2];t+=u}else for(z=0;z<n;++z){const k=3*d[z];for(let v=0;v<h;++v)m[t]=c[k],m[t+1]=c[k+1],m[t+2]=c[k+2],t+=u}}function f(d,c,u,t,h=1){const m=u.typedBuffer;u=u.typedBufferStride;const n=d.length;t*=u;if(1===h)for(h=0;h<n;++h){var z=4*d[h];m[t]=c[z];m[t+1]=c[z+1];m[t+2]=c[z+2];m[t+3]=c[z+3];t+=u}else for(z=0;z<n;++z){const k=4*d[z];for(let v=0;v<h;++v)m[t]=c[k],m[t+1]=c[k+1],m[t+2]=c[k+2],m[t+3]=
c[k+3],t+=u}}function w(d,c,u,t,h,m=1){if(u){var n=t.typedBuffer;t=t.typedBufferStride;var z=d.length,k=u[0],v=u[1],x=u[2],C=u[4],A=u[5],B=u[6],D=u[8],E=u[9],G=u[10],K=u[12],M=u[13];u=u[14];h*=t;if(1===m)for(m=0;m<z;++m){var H=3*d[m],J=c[H],O=c[H+1];H=c[H+2];n[h]=k*J+C*O+D*H+K;n[h+1]=v*J+A*O+E*H+M;n[h+2]=x*J+B*O+G*H+u;h+=t}else for(J=0;J<z;++J){O=3*d[J];var I=c[O],F=c[O+1];const L=c[O+2];O=k*I+C*F+D*L+K;H=v*I+A*F+E*L+M;I=x*I+B*F+G*L+u;for(F=0;F<m;++F)n[h]=O,n[h+1]=H,n[h+2]=I,h+=t}}else y(d,c,t,h,
m)}function e(d,c,u,t,h,m=1){if(u){var n=t.typedBuffer;t=t.typedBufferStride;var z=d.length,k=u[0],v=u[1],x=u[2],C=u[4],A=u[5],B=u[6],D=u[8],E=u[9],G=u[10];u=!p.isOrthoNormal(u);h*=t;if(1===m)for(m=0;m<z;++m){var K=3*d[m],M=c[K],H=c[K+1],J=c[K+2];K=k*M+C*H+D*J;var O=v*M+A*H+E*J;M=x*M+B*H+G*J;u&&(H=K*K+O*O+M*M,.999999>H&&1E-6<H&&(H=1/Math.sqrt(H),K*=H,O*=H,M*=H));n[h+0]=K;n[h+1]=O;n[h+2]=M;h+=t}else for(K=0;K<z;++K){O=3*d[K];H=c[O];J=c[O+1];const I=c[O+2];O=k*H+C*J+D*I;M=v*H+A*J+E*I;H=x*H+B*J+G*I;
u&&(J=O*O+M*M+H*H,.999999>J&&1E-6<J&&(J=1/Math.sqrt(J),O*=J,M*=J,H*=J));for(J=0;J<m;++J)n[h+0]=O,n[h+1]=M,n[h+2]=H,h+=t}}else y(d,c,t,h,m)}function l(d,c,u,t,h,m=1){if(u){var n=t.typedBuffer;t=t.typedBufferStride;var z=d.length,k=u[0],v=u[1],x=u[2],C=u[4],A=u[5],B=u[6],D=u[8],E=u[9],G=u[10];u=!p.isOrthoNormal(u);h*=t;if(1===m)for(m=0;m<z;++m){var K=4*d[m],M=c[K],H=c[K+1],J=c[K+2];K=c[K+3];var O=k*M+C*H+D*J,I=v*M+A*H+E*J;M=x*M+B*H+G*J;u&&(H=O*O+I*I+M*M,.999999>H&&1E-6<H&&(H=1/Math.sqrt(H),O*=H,I*=
H,M*=H));n[h+0]=O;n[h+1]=I;n[h+2]=M;n[h+3]=K;h+=t}else for(K=0;K<z;++K){O=4*d[K];H=c[O];J=c[O+1];const F=c[O+2];O=c[O+3];I=k*H+C*J+D*F;M=v*H+A*J+E*F;H=x*H+B*J+G*F;u&&(J=I*I+M*M+H*H,.999999>J&&1E-6<J&&(J=1/Math.sqrt(J),I*=J,M*=J,H*=J));for(J=0;J<m;++J)n[h+0]=I,n[h+1]=M,n[h+2]=H,n[h+3]=O,h+=t}}else f(d,c,t,h,m)}function g(d,c,u,t,h,m=1){const n=t.typedBuffer;t=t.typedBufferStride;const z=d.length;h*=t;if(1===m)if(4===u)for(m=0;m<z;++m)u=4*d[m],n[h]=c[u],n[h+1]=c[u+1],n[h+2]=c[u+2],n[h+3]=c[u+3],h+=
t;else{if(3===u)for(m=0;m<z;++m)u=3*d[m],n[h]=c[u],n[h+1]=c[u+1],n[h+2]=c[u+2],n[h+3]=255,h+=t}else if(4===u)for(u=0;u<z;++u){var k=4*d[u];for(var v=0;v<m;++v)n[h]=c[k],n[h+1]=c[k+1],n[h+2]=c[k+2],n[h+3]=c[k+3],h+=t}else if(3===u)for(u=0;u<z;++u)for(k=3*d[u],v=0;v<m;++v)n[h]=c[k],n[h+1]=c[k+1],n[h+2]=c[k+2],n[h+3]=255,h+=t}a.writeBufferMat3f=function(d,c,u,t){const h=u.typedBuffer;u=u.typedBufferStride;const m=d.length;t*=u;for(let n=0;n<m;++n){const z=9*d[n];for(let k=0;9>k;++k)h[t+k]=c[z+k];t+=
u}};a.writeBufferMat4f=function(d,c,u,t){const h=u.typedBuffer;u=u.typedBufferStride;const m=d.length;t*=u;for(let n=0;n<m;++n){const z=16*d[n];for(let k=0;16>k;++k)h[t+k]=c[z+k];t+=u}};a.writeBufferVec2=q;a.writeBufferVec3=y;a.writeBufferVec4=f;a.writeColor=g;a.writeDefaultAttributes=function(d,c,u,t,h,m){for(const z of c.fieldNames){c=d.vertexAttributes.get(z);const k=d.indices.get(z);if(c&&k)switch(z){case "position":r.assert(3===c.size);var n=h.getField(z,b.BufferViewVec3f);n&&w(k,c.data,u,n,
m);break;case "normal":r.assert(3===c.size);(n=h.getField(z,b.BufferViewVec3f))&&e(k,c.data,t,n,m);break;case "uv0":r.assert(2===c.size);(n=h.getField(z,b.BufferViewVec2f))&&q(k,c.data,n,m);break;case "color":r.assert(3===c.size||4===c.size);(n=h.getField(z,b.BufferViewVec4u8))&&g(k,c.data,c.size,n,m);break;case "symbolColor":r.assert(3===c.size||4===c.size);(n=h.getField(z,b.BufferViewVec4u8))&&g(k,c.data,c.size,n,m);break;case "tangent":r.assert(4===c.size),(n=h.getField(z,b.BufferViewVec4f))&&
l(k,c.data,t,n,m)}}};a.writeNormal=e;a.writePosition=w;a.writeTangent=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){function m(v){const x=new h.ShaderBuilder;var C=v.signedDistanceFieldEnabled;x.include(y.AlignPixel);x.include(f.HUD,v);x.include(q.Slice,v);if(6===v.output)return x.include(w.HUDOcclusionPass,v),x;x.include(u.ScreenSizePerspective);x.fragment.include(c.RgbaFloatEncoding);x.fragment.include(d.ColorConversion);x.include(l.VisualVariables,v);x.varyings.add("vcolor","vec4");x.varyings.add("vtc","vec2");x.varyings.add("vsize","vec2");v.binaryHighlightOcclusionEnabled&&
x.varyings.add("voccluded","float");x.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4");C&&x.vertex.uniforms.add("outlineColor","vec4");v.screenSizePerspectiveEnabled&&x.vertex.uniforms.add("screenSizePerspective","vec4");(v.debugDrawBorder||v.binaryHighlightOcclusionEnabled)&&x.varyings.add("debugBorderCoords","vec4");x.attributes.add("uv0","vec2");x.attributes.add("color","vec4");x.attributes.add("size","vec2");
x.attributes.add("auxpos2","vec4");x.vertex.code.add(t.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${v.screenSizePerspectiveEnabled?t.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:t.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${v.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${v.occlusionTestEnabled||v.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${v.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var A=t.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const B=v.pixelSnappingEnabled?C?t.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:t.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:t.glsl`posProj += quadOffset;`;x.vertex.code.add(t.glsl`
      ${v.occlusionTestEnabled?"if (visible) {":""}
      ${A}
      ${v.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${t.glsl.float(g.symbolAlphaCutoff)};
      ${C?`alphaDiscard = alphaDiscard && outlineColor.a < ${t.glsl.float(g.symbolAlphaCutoff)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${B}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${v.debugDrawBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${v.occlusionTestEnabled?t.glsl`} else { vtc = vec2(0.0);
        ${v.debugDrawBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `);x.fragment.uniforms.add("tex","sampler2D");C&&(x.fragment.uniforms.add("outlineColor","vec4"),x.fragment.uniforms.add("outlineSize","float"));A=v.debugDrawBorder?t.glsl`(isBorder > 0.0 ? 0.0 : ${t.glsl.float(g.defaultMaskAlphaCutoff)})`:t.glsl.float(g.defaultMaskAlphaCutoff);C=t.glsl`
    ${v.debugDrawBorder?t.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${C?t.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${A} ||
          fillPixelColor.a + outlinePixelColor.a < ${t.glsl.float(g.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${A}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:t.glsl`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${A}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${v.debugDrawBorder?t.glsl`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;7===v.output&&x.fragment.code.add(t.glsl`
      void main() {
        ${C}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `);0===v.output&&x.fragment.code.add(t.glsl`
    void main() {
      ${C}
      ${v.FrontFacePass?"gl_FragColor.rgb /\x3d gl_FragColor.a;":""}
    }
    `);4===v.output&&(x.include(e.OutputHighlight),x.fragment.code.add(t.glsl`
    void main() {
      ${C}
      ${v.binaryHighlightOcclusionEnabled?t.glsl`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return x}function n(v,x,C){v.setUniform4fv("materialColor",x.color);x.textureIsSignedDistanceField&&(0>=x.outlineColor[3]||0>=x.outlineSize?(v.setUniform4fv("outlineColor",r.ZEROS),v.setUniform1f("outlineSize",0)):(v.setUniform4fv("outlineColor",x.outlineColor),v.setUniform1f("outlineSize",x.outlineSize)));v.setUniform2f("screenOffset",2*x.screenOffset[0]*C,2*x.screenOffset[1]*C);v.setUniform2fv("anchorPos",z(x))}function z(v,x=k){if(v.textureIsSignedDistanceField){var C=v.anchorPos;v=v.distanceFieldBoundingBox;
x[0]=C[0]*(v[2]-v[0])+v[0];x[1]=C[1]*(v[3]-v[1])+v[1]}else p.copy(x,v.anchorPos);return x}const k=b.create();b=Object.freeze({__proto__:null,build:m,bindHUDMaterialUniforms:n,calculateAnchorPosForRendering:z});a.HUDMaterialShader=b;a.bindHUDMaterialUniforms=n;a.build=m;a.calculateAnchorPosForRendering=z})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define(["exports","../../../../../core/maybe","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../shaderModules/interfaces"],
function(a,p,b,r,q){function y(w,e,l,g){e.slicePlaneEnabled&&(p.isSome(l)?(g?(b.subtract(f,l.origin,g),w.setUniform3fv("slicePlaneOrigin",f)):w.setUniform3fv("slicePlaneOrigin",l.origin),w.setUniform3fv("slicePlaneBasis1",l.basis1),w.setUniform3fv("slicePlaneBasis2",l.basis2)):(w.setUniform3fv("slicePlaneBasis1",r.ZEROS),w.setUniform3fv("slicePlaneBasis2",r.ZEROS),w.setUniform3fv("slicePlaneOrigin",r.ZEROS)))}const f=r.create();a.Slice=function(w,e){if(e.slicePlaneEnabled){w.extensions.add("GL_OES_standard_derivatives");
e.sliceEnabledForVertexPrograms&&(w.vertex.uniforms.add("slicePlaneOrigin","vec3"),w.vertex.uniforms.add("slicePlaneBasis1","vec3"),w.vertex.uniforms.add("slicePlaneBasis2","vec3"));w.fragment.uniforms.add("slicePlaneOrigin","vec3");w.fragment.uniforms.add("slicePlaneBasis1","vec3");w.fragment.uniforms.add("slicePlaneBasis2","vec3");var l=q.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,g=q.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
if (sliceByFactors(factors)) {
return color;
}
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;g=e.sliceHighlightDisabled?q.glsl`#define highlightSlice(_color_, _pos_) (_color_)`:q.glsl`
        ${g}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;e.sliceEnabledForVertexPrograms&&w.vertex.code.add(l);w.fragment.code.add(l);w.fragment.code.add(g)}else l=q.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,e.sliceEnabledForVertexPrograms&&w.vertex.code.add(l),w.fragment.code.add(l)};a.bindSliceUniforms=y;a.bindSliceUniformsWithOrigin=function(w,e,l){y(w,e,l.slicePlane,l.origin)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["exports","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(a,p,b){a.HUD=function(r,q){r.include(p.ScreenSizePerspective);
r.attributes.add("position","vec3");r.attributes.add("normal","vec3");r.attributes.add("auxpos1","vec4");r.vertex.uniforms.add("proj","mat4");r.vertex.uniforms.add("view","mat4");r.vertex.uniforms.add("viewNormal","mat4");r.vertex.uniforms.add("viewport","vec4");r.vertex.uniforms.add("camPos","vec3");r.vertex.uniforms.add("polygonOffset","float");r.vertex.uniforms.add("cameraGroundRelative","float");r.vertex.uniforms.add("pixelRatio","float");r.vertex.uniforms.add("perDistancePixelRatio","float");
r.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float");q.verticalOffsetEnabled&&r.vertex.uniforms.add("verticalOffset","vec4");q.screenSizePerspectiveEnabled&&r.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4");r.vertex.uniforms.add("hudVisibilityTexture","sampler2D");r.vertex.constants.add("smallOffsetAngle","float",.984807753012208);r.vertex.code.add(b.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);r.vertex.code.add(b.glsl`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`);q.isDraped||r.vertex.code.add(b.glsl`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`);r.vertex.code.add(b.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${q.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${q.screenSizePerspectiveEnabled?q.verticalOffsetEnabled||1===q.screenCenterOffsetUnitsEnabled?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${q.verticalOffsetEnabled?q.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${q.verticalOffsetEnabled?b.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==q.screenCenterOffsetUnitsEnabled?b.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===q.screenCenterOffsetUnitsEnabled?q.screenSizePerspectiveEnabled?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${1===q.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);r.vertex.code.add(b.glsl`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (uRenderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};a.bindHUDUniforms=function(r,q){r.setUniform1f("uRenderTransparentlyOccludedHUD",0===q.renderTransparentlyOccludedHUD?1:1===q.renderTransparentlyOccludedHUD?0:.75)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../materials/internal/MaterialUtil"],function(a,p,b){a.ScreenSizePerspective=function(r){r.vertex.code.add(p.glsl`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`);r.vertex.code.add(p.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);r.vertex.code.add(p.glsl`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`);r.vertex.code.add(p.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`);r.vertex.code.add(p.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);r.vertex.code.add(p.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
}`);r.vertex.code.add(p.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.bindScreenSizePerspectiveUniforms=function(r,q){q.screenSizePerspective&&(b.bindScreenSizePerspective(q.screenSizePerspective,r,"screenSizePerspective"),b.bindScreenSizePerspective(q.screenSizePerspectiveAlignment||q.screenSizePerspective,r,"screenSizePerspectiveAlignment"))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../shading/MultipassGeometryTest.glsl",
"../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,p,b,r,q){a.HUDOcclusionPass=function(y,f){f.multipassGeometryEnabled&&y.vertex.include(b.multipassGeometryTest);f.multipassTerrainEnabled&&y.varyings.add("depth","float");y.vertex.code.add(q.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${f.multipassGeometryEnabled?q.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${f.multipassTerrainEnabled?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);f.multipassTerrainEnabled&&y.fragment.include(p.ReadLinearDepth);y.fragment.uniforms.add("terrainDepthTexture","sampler2D");y.fragment.uniforms.add("cameraNearFar","vec2");y.fragment.uniforms.add("inverseViewport","vec2");y.fragment.include(r.RgbaFloatEncoding);y.fragment.code.add(q.glsl`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${f.multipassTerrainEnabled?q.glsl`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/interfaces"],function(a,p,b){a.bindMultipassGeometryTexture=function(r,q){q.multipassGeometryEnabled&&q.geometryLinearDepthTexture&&r.bindTexture(q.geometryLinearDepthTexture,"geometryDepthTexture")};a.multipassGeometryTest=function(r){r.include(p.ReadLinearDepth);r.uniforms.add("geometryDepthTexture",
"sampler2D");r.uniforms.add("cameraNearFar","vec2");r.code.add(b.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../chunks/vec4f64","../../shaderModules/interfaces"],function(a,p,b){const r=p.fromValues(1,1,0,1),q=p.fromValues(1,0,1,1);a.OutputHighlight=function(y){y.fragment.uniforms.add("depthTex","sampler2D");y.fragment.uniforms.add("highlightViewportPixelSz","vec4");y.fragment.constants.add("occludedHighlightFlag","vec4",r).add("unoccludedHighlightFlag",
"vec4",q);y.fragment.code.add(b.glsl`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)};a.bindOutputHighlight=function(y,f){y.bindTexture(f.highlightDepthTexture,"depthTex");y.setUniform4f("highlightViewportPixelSz",0,0,f.inverseViewport[0],f.inverseViewport[1])};a.occludedHighlightFlag=r;a.unoccludedHighlightFlag=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){function b(r,q){q.vvSizeEnabled&&(r.setUniform3fv("vvSizeMinSize",
q.vvSizeMinSize),r.setUniform3fv("vvSizeMaxSize",q.vvSizeMaxSize),r.setUniform3fv("vvSizeOffset",q.vvSizeOffset),r.setUniform3fv("vvSizeFactor",q.vvSizeFactor));q.vvColorEnabled&&(r.setUniform1fv("vvColorValues",q.vvColorValues),r.setUniform4fv("vvColorColors",q.vvColorColors))}a.VisualVariables=function(r,q){q.vvInstancingEnabled&&(q.vvSize||q.vvColor)&&r.attributes.add("instanceFeatureAttribute","vec4");q.vvSize?(r.vertex.uniforms.add("vvSizeMinSize","vec3"),r.vertex.uniforms.add("vvSizeMaxSize",
"vec3"),r.vertex.uniforms.add("vvSizeOffset","vec3"),r.vertex.uniforms.add("vvSizeFactor","vec3"),r.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),r.vertex.uniforms.add("vvSymbolAnchor","vec3"),r.vertex.code.add(p.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.vertex.code.add(p.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${q.vvInstancingEnabled?p.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.vertex.code.add(p.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);q.vvColor?(r.vertex.constants.add("vvColorNumber","int",8),r.vertex.code.add(p.glsl`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${q.vvInstancingEnabled?p.glsl`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):r.vertex.code.add(p.glsl`vec4 vvColor() { return vec4(1.0); }`)};a.bindVisualVariablesUniforms=b;a.bindVisualVariablesUniformsForSymbols=function(r,q){b(r,q);q.vvSizeEnabled&&(r.setUniform3fv("vvSymbolAnchor",q.vvSymbolAnchor),r.setUniformMatrix3fv("vvSymbolRotationMatrix",q.vvSymbolRotationMatrix))};a.bindVisualVariablesUniformsWithOpacity=function(r,q){b(r,q);q.vvOpacityEnabled&&(r.setUniform1fv("vvOpacityValues",q.vvOpacityValues),r.setUniform1fv("vvOpacityOpacities",q.vvOpacityOpacities))};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.DiscardOrAdjustAlpha=function(b,r){const q=b.fragment;switch(r.alphaDiscardMode){case 0:q.code.add(p.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < ${p.glsl.float(.001)}) { discard; } }
      `);break;case 1:q.code.add(p.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case 2:q.uniforms.add("textureAlphaCutoff","float");q.code.add(p.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case 3:b.fragment.uniforms.add("textureAlphaCutoff","float"),b.fragment.code.add(p.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}};a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/HUDMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v){t=function(A){function B(){return A.apply(this,arguments)||this}b._inheritsLoose(B,A);var D=B.prototype;D.initializeProgram=function(E){var G=B.shader.get();const K=this.configuration;G=G.build({output:K.output,FrontFacePass:2===K.transparencyPassType,viewingMode:E.viewingMode,occlusionTestEnabled:K.occlusionTestEnabled,signedDistanceFieldEnabled:K.sdf,slicePlaneEnabled:K.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,
debugDrawBorder:K.debugDrawBorder,binaryHighlightOcclusionEnabled:K.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:K.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:K.screenSizePerspective,verticalOffsetEnabled:K.verticalOffset,pixelSnappingEnabled:K.pixelSnappingEnabled,vvSize:K.vvSize,vvColor:K.vvColor,vvInstancingEnabled:!1,isDraped:K.isDraped,multipassGeometryEnabled:K.multipassGeometryEnabled,multipassTerrainEnabled:K.multipassTerrainEnabled,cullAboveGround:K.cullAboveGround});
return new z.Program(E.rctx,G,m.Default3D)};D.bindPass=function(E,G){c.bindProjectionMatrix(this.program,G.camera.projectionMatrix);this.program.setUniform1f("cameraGroundRelative",G.camera.aboveGround?1:-1);this.program.setUniform1f("perDistancePixelRatio",Math.tan(G.camera.fovY/2)/(G.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",G.camera.viewInverseTransposeMatrix);this.program.setUniform1f("polygonOffset",E.shaderPolygonOffset);y.bindVerticalOffsetUniforms(this.program,
E,G);d.bindScreenSizePerspectiveUniforms(this.program,E);this.program.setUniform1f("pixelRatio",G.camera.pixelRatio||1);c.bindViewport(this.program,G);6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",G.camera.nearFar),this.program.setUniform2fv("inverseViewport",G.inverseViewport),e.bindMultipassGeometryTexture(this.program,G),l.bindMultipassTerrainTexture(this.program,G)):(f.bindHUDUniforms(this.program,G),k.bindHUDMaterialUniforms(this.program,E,G.camera.pixelRatio||1),
g.bindVisualVariablesUniforms(this.program,E),this.configuration.occlusionTestEnabled&&this.program.bindTexture(G.hudVisibilityTexture,"hudVisibilityTexture"));4===this.configuration.output&&w.bindOutputHighlight(this.program,G)};D.bindDraw=function(E){c.bindView(this.program,E);c.bindCameraPosition(this.program,E.origin,E.camera.viewInverseTransposeMatrix);q.bindSliceUniformsWithOrigin(this.program,this.configuration,E);this.program.rebindTextures()};D.setPipelineState=function(E){const G=this.configuration,
K=3===E,M=this.configuration.polygonOffsetEnabled&&x,H=!K&&2!==E||4===G.output?null:(G.depthEnabled||6===G.output)&&v.defaultDepthWriteParams;return v.makePipelineState({blending:0===G.output||7===G.output||4===G.output?K?C:n.OITBlending(E):null,depthTest:{func:515},depthWrite:H,colorWrite:v.defaultColorWriteParams,polygonOffset:M})};D.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};b._createClass(B,[{key:"primitiveType",get:function(){return 6===
this.configuration.output?0:4}}]);return B}(t.ShaderTechnique);t.shader=new u.ReloadableShaderModule(k.HUDMaterialShader,()=>new Promise(function(A,B){a(["./HUDMaterial.glsl"],A,B)}));const x={factor:0,units:-4},C=v.simpleBlendingParams(1,771);u=function(A){function B(){var D=A.apply(this,arguments)||this;D.output=0;D.occlusionTestEnabled=!0;D.sdf=!1;D.vvSize=!1;D.vvColor=!1;D.verticalOffset=!1;D.screenSizePerspective=!1;D.screenCenterOffsetUnitsEnabled=0;D.debugDrawBorder=!0;D.binaryHighlightOcclusion=
!0;D.slicePlaneEnabled=!1;D.polygonOffsetEnabled=!1;D.depthEnabled=!0;D.transparencyPassType=3;D.pixelSnappingEnabled=!0;D.isDraped=!1;D.multipassGeometryEnabled=!1;D.multipassTerrainEnabled=!1;D.cullAboveGround=!1;return D}b._inheritsLoose(B,A);return B}(h.ShaderTechniqueConfiguration);r.__decorate([h.parameter({count:8})],u.prototype,"output",void 0);r.__decorate([h.parameter()],u.prototype,"occlusionTestEnabled",void 0);r.__decorate([h.parameter()],u.prototype,"sdf",void 0);r.__decorate([h.parameter()],
u.prototype,"vvSize",void 0);r.__decorate([h.parameter()],u.prototype,"vvColor",void 0);r.__decorate([h.parameter()],u.prototype,"verticalOffset",void 0);r.__decorate([h.parameter()],u.prototype,"screenSizePerspective",void 0);r.__decorate([h.parameter({count:2})],u.prototype,"screenCenterOffsetUnitsEnabled",void 0);r.__decorate([h.parameter()],u.prototype,"debugDrawBorder",void 0);r.__decorate([h.parameter()],u.prototype,"binaryHighlightOcclusion",void 0);r.__decorate([h.parameter()],u.prototype,
"slicePlaneEnabled",void 0);r.__decorate([h.parameter()],u.prototype,"polygonOffsetEnabled",void 0);r.__decorate([h.parameter()],u.prototype,"depthEnabled",void 0);r.__decorate([h.parameter({count:4})],u.prototype,"transparencyPassType",void 0);r.__decorate([h.parameter()],u.prototype,"pixelSnappingEnabled",void 0);r.__decorate([h.parameter()],u.prototype,"isDraped",void 0);r.__decorate([h.parameter()],u.prototype,"multipassGeometryEnabled",void 0);r.__decorate([h.parameter()],u.prototype,"multipassTerrainEnabled",
void 0);r.__decorate([h.parameter()],u.prototype,"cullAboveGround",void 0);p.HUDMaterialTechnique=t;p.HUDMaterialTechniqueConfiguration=u;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["exports","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(a,p,b){function r(y,f,w,e=q){e.screenLength=y.screenLength;e.perDistance=Math.tan(.5*f)/(.5*w);e.minWorldLength=y.minWorldLength;
e.maxWorldLength=y.maxWorldLength;return e}const q={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0};a.VerticalOffset=function(y,f){const w=y.vertex.code;f.verticalOffsetEnabled?(y.vertex.uniforms.add("verticalOffset","vec4"),f.screenSizePerspectiveEnabled&&(y.include(p.ScreenSizePerspective),y.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),w.add(b.glsl`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===f.viewingMode?b.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:b.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${f.screenSizePerspectiveEnabled?b.glsl`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:b.glsl`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):w.add(b.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.bindVerticalOffsetUniforms=function(y,f,w){f.verticalOffset&&(f=r(f.verticalOffset,w.camera.fovY,w.camera.fullViewport[3]),y.setUniform4f("verticalOffset",f.screenLength*(w.camera.pixelRatio||1),f.perDistance,f.minWorldLength,f.maxWorldLength))};a.calculateVerticalOffsetFactors=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,p){a.bindMultipassTerrainTexture=function(b,r){r.multipassTerrainEnabled&&r.terrainLinearDepthTexture&&b.bindTexture(r.terrainLinearDepthTexture,"terrainDepthTexture")};a.multipassTerrainTest=function(b,r){b.fragment.uniforms.add("terrainDepthTexture","sampler2D");b.fragment.uniforms.add("cameraNearFar","vec2");b.fragment.uniforms.add("inverseViewport","vec2");b.fragment.code.add(p.glsl`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, cameraNearFar);
      if(fragmentDepth ${r.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","../../../webgl/renderState"],function(a,p){const b=p.separateBlendingParams(770,1,771,771),r=p.simpleBlendingParams(1,1),q=p.simpleBlendingParams(0,771),y={factor:-1,units:-2};a.OITBlending=function(f){return 2===f?null:1===f?q:r};a.OITDepthTest=function(f){return 3===f||2===f?513:515};a.OITDepthWrite=function(f){return 2===f?p.defaultDepthWriteParams:
null};a.OITPolygonOffset=y;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=q;a.blendingColor=r;a.blendingDefault=b;a.getOITPolygonOffset=function(f){return f?y:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ./Deconflictor".split(" "),
function(a,p,b,r,q,y,f,w,e){a.LabelDeconflictor=function(l){function g(){var c=l.apply(this,arguments)||this;c.visibilityGroup=1;c.iconMarginFactor=0;c._lastDeconfliction=0;return c}p._inheritsLoose(g,l);var d=g.prototype;d.runTask=function(c){if(!this.parent.running){var u=performance.now();if(2===c.state||2E3<u-this._lastDeconfliction)l.prototype.runTask.call(this,c),0===this.state&&(this._lastDeconfliction=u)}};d.enabledChanged=function(c,u){this.modifyGraphics(u,c.labelsEnabled)};d.getGraphicsLayers=
function(c){return c.labelGraphics};p._createClass(g,[{key:"viewState",get:function(){return this.parent.viewState}}]);return g}(e.Deconflictor);b.__decorate([r.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=b.__decorate([w.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/Scheduler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/time ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/PromiseQueue ./debugFlags".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){function n(M){return k.has(M)?k.get(M):"number"===typeof M?M:1}const z=q.getLogger("esri.views.support.Scheduler");a.TaskPriority=void 0;(function(M){M.RESOURCE_CONTROLLER="schedule";M.SLIDE="slide";M.STREAM_DATA_LOADER="stream loader";M.ELEVATION_QUERY="elevation query";M.TERRAIN_SURFACE="terrain";M.SURFACE_GEOMETRY_UPDATES="surface geometry updates";M.GRAPHICS_CORE="Graphics3D";M.I3S_CONTROLLER="I3S";M.POINT_CLOUD_LAYER="point cloud";M.FEATURE_TILE_FETCHER=
"feature fetcher";M.OVERLAY="overlay";M.STAGE="stage";M.GRAPHICS_DECONFLICTOR="graphics deconflictor";M.FILTER_VISIBILITY="Graphics3D filter visibility";M.SCALE_VISIBILITY="Graphics3D scale visibility";M.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";M.POINT_OF_INTEREST_FREQUENT="POI frequent";M.POINT_OF_INTEREST_INFREQUENT="POI infrequent";M.LABELER="labeler";M.FEATURE_QUERY_ENGINE="feature query";M.FEATURE_TILE_TREE="feature tile tree";M.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";M.ELEVATION_ALIGNMENT=
"elevation alignment";M.TEXT_TEXTURE_ATLAS="text texture atlas";M.TEXTURE_UNLOAD="texture unload";M.LINE_OF_SIGHT_TOOL="line of sight tool";M.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";M.ELEVATION_PROFILE="elevation profile";M.SNAPPING="snapping";M.SHADOW_ACCUMULATOR="shadow accumulator";M[M.TEST_PRIO=1]="TEST_PRIO"})(a.TaskPriority||(a.TaskPriority={}));const k=new Map([[a.TaskPriority.RESOURCE_CONTROLLER,0],[a.TaskPriority.SLIDE,0],[a.TaskPriority.STREAM_DATA_LOADER,0],[a.TaskPriority.ELEVATION_QUERY,
0],[a.TaskPriority.TERRAIN_SURFACE,1],[a.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[a.TaskPriority.GRAPHICS_CORE,2],[a.TaskPriority.I3S_CONTROLLER,2],[a.TaskPriority.POINT_CLOUD_LAYER,2],[a.TaskPriority.FEATURE_TILE_FETCHER,2],[a.TaskPriority.OVERLAY,4],[a.TaskPriority.STAGE,4],[a.TaskPriority.GRAPHICS_DECONFLICTOR,4],[a.TaskPriority.FILTER_VISIBILITY,4],[a.TaskPriority.SCALE_VISIBILITY,4],[a.TaskPriority.FRUSTUM_VISIBILITY,4],[a.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[a.TaskPriority.POINT_OF_INTEREST_INFREQUENT,
30],[a.TaskPriority.LABELER,8],[a.TaskPriority.FEATURE_QUERY_ENGINE,8],[a.TaskPriority.FEATURE_TILE_TREE,16],[a.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[a.TaskPriority.ELEVATION_ALIGNMENT,12],[a.TaskPriority.TEXT_TEXTURE_ATLAS,12],[a.TaskPriority.TEXTURE_UNLOAD,12],[a.TaskPriority.LINE_OF_SIGHT_TOOL,16],[a.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[a.TaskPriority.SNAPPING,0],[a.TaskPriority.SHADOW_ACCUMULATOR,30]]),v=l.Milliseconds(6.5),x=l.Milliseconds(1),C=l.Milliseconds(30),A=l.Milliseconds(1E3/
30),B=l.Milliseconds(100);var D;(function(M){let H=function(I){function F(N){var R=I.call(this,N)||this;R.updating=!0;R.performanceInfo={total:new f("total"),tasks:new Map};R._frameTaskTimes=new Map;R._budget=null;R._state=1;R._tasks=new w;R._runQueue=new w;R._load=0;R._idleStateCallbacks=new w;R._idleUpdatesStartFired=!1;R._maxReschedule=K;R._forceTask=!1;R._debug=!1;R._debugHandle=g.init(m,"SCHEDULER_LOG_SLOW_TASKS",Q=>R._debug=Q);R._budget=new O(N.nowFunc);for(const Q of Object.keys(a.TaskPriority))R.performanceInfo.tasks.set(a.TaskPriority[Q],
new f(a.TaskPriority[Q]));let S;const P=p._assertThisInitialized(R);R._test={get state(){return y.isNone(S)?P._state:S},set state(Q){S=Q},FRAME_SAFETY_BUDGET:v,INTERACTING_BUDGET:A,IDLE_BUDGET:B,get budget(){return P._budget.budget},usedBudget:0,updateTask:Q=>R._updateTask(Q),getState:Q=>R._getState(Q),getRuntime:Q=>R._getRuntime(Q),resetRuntimes:()=>R._resetRuntimes(),getRunning:()=>R._getRunning()};return R}p._inheritsLoose(F,I);var L=F.prototype;L.destroy=function(){this._debugHandle&&this._debugHandle.remove()};
L.registerTask=function(N,R){const S=n(N);R=new J(this,N,R,S);this._tasks.push(R);this.performanceInfo.tasks.has(N)||this.performanceInfo.tasks.set(N,new f(N));return R};L.registerIdleStateCallbacks=function(N,R){const S={idleBegin:N,idleEnd:R};this._idleStateCallbacks.push(S);2===this.state&&this._idleUpdatesStartFired&&S.idleBegin();const P=this;return{remove:()=>this._removeIdleStateCallbacks(S),set idleBegin(Q){P._idleUpdatesStartFired&&(S.idleEnd(),2===P._state&&Q());S.idleBegin=Q},set idleEnd(Q){S.idleEnd=
Q}}};L.updateBudget=function(N){this._test.usedBudget=0;let R=v,S=N.frameDuration,P=x;switch(this.state){case 2:R=l.Milliseconds(0);S=l.Milliseconds(Math.max(B,N.frameDuration));P=C;break;case 1:S=l.Milliseconds(Math.max(A,N.frameDuration))}S=l.Milliseconds(S-N.elapsedFrameTime-R);if(2!==this.state&&S<x&&!this._forceTask)return this._forceTask=!0,!1;S=l.Milliseconds(Math.max(S,P));this._budget.reset(S,this.state);this._maxReschedule=K;this._updateLoad();return this._schedule()};L.frame=function(){this._forceTask=
!1;switch(this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(N=>N.idleBegin()));this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed};L.stopFrame=function(){this._budget.reset(l.Milliseconds(0),this._state);this._budget.madeProgress()};L._removeIdleStateCallbacks=function(N){this._idleUpdatesStartFired&&N.idleEnd();this._idleStateCallbacks.removeUnordered(N)};L.removeTask=
function(N){this._tasks.removeUnordered(N);this._runQueue.removeUnordered(N)};L._updateTask=function(N){this._tasks.forAll(R=>{R.name===N&&R.setPriority(N)})};L._getState=function(N){if(this._runQueue.some(S=>S.name===N))return a.TaskState.SCHEDULED;let R=a.TaskState.IDLE;this._tasks.forAll(S=>{S.name===N&&S.needsUpdate&&(1>=S.schedulePriority?R=a.TaskState.READY:R!==a.TaskState.READY&&(R=a.TaskState.WAITING))});return R};L._getRuntime=function(N){let R=0;this._tasks.forAll(S=>{S.name===N&&(R+=S.runtime)});
return R};L._resetRuntimes=function(){this._tasks.forAll(N=>N.runtime=0)};L._getRunning=function(){const N=new Map;this._tasks.forAll(S=>{S.needsUpdate&&N.set(S.name,(N.get(S.name)||0)+1)});if(0===N.size)return null;let R="";N.forEach((S,P)=>{R=1<S?R+` ${S}x ${P}`:R+` ${P}`});return R};L._runIdle=function(){this._run()};L._runInteracting=function(){this._run()};L._runAnimating=function(){this._run()};L._updateLoad=function(){const N=this._tasks.reduce((R,S)=>S.needsUpdate?++R:R,0);this._load=.9*this._load+
N*(1-.9)};L._schedule=function(){if(0>=this._maxReschedule)return!1;this._runQueue.filterInPlace(N=>{if(N.needsUpdate)return!0;N.schedulePriority=N.basePriority;return!1});for(this._tasks.forAll(N=>{0===N.basePriority&&N.needsUpdate&&!this._runQueue.some(R=>R===N)&&this._runQueue.unshift(N)});0===this._runQueue.length;){let N=!1,R=0;this._tasks.forAll(S=>{if(S.needsUpdate&&0!==S.schedulePriority&&0!==S.basePriority)switch(N=!0,R=Math.max(R,S.basePriority),S.schedulePriority){case 1:S.schedulePriority=
0;this._runQueue.push(S);break;default:--S.schedulePriority}});if(!N)return this.updating=!1;this._maxReschedule===K&&(this._maxReschedule=R);--this._maxReschedule}return this.updating=!0};L._run=function(){const N=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var R=this._budget.now();const S=this._runQueue.pop();this._budget.resetProgress();try{S.task.runTask(this._budget)}catch(P){z.error(`Exception in task "${S.name}"`,P)}S.schedulePriority=S.basePriority;R=this._budget.now()-
R;S.runtime+=R;this._frameTaskTimes.set(S.priority,this._frameTaskTimes.get(S.priority)+R);this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",S.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms");if(0>=this._budget.remaining){this._recordFrameTaskTimes(this._budget.now()-N);return}}while(this._schedule());this._recordFrameTaskTimes(this._budget.now()-N)};L._startFrameTaskTimes=function(){for(const N of Object.keys(a.TaskPriority))this._frameTaskTimes.set(a.TaskPriority[N],
0)};L._recordFrameTaskTimes=function(N){this._frameTaskTimes.forEach((R,S)=>this.performanceInfo.tasks.get(S).record(R));this.performanceInfo.total.record(N)};p._createClass(F,[{key:"now",get:function(){return this.nowFunc()}},{key:"load",get:function(){return this._load}},{key:"state",get:function(){return y.isNone(this._test.state)?this._state:this._test.state},set:function(N){this._state!==N&&(this._state=N,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(R=>
R.idleEnd())))}},{key:"test",get:function(){return this._test}}]);return F}(r);b.__decorate([d.property()],H.prototype,"updating",void 0);b.__decorate([d.property()],H.prototype,"nowFunc",void 0);H=b.__decorate([t.subclass("esri.views.support.Scheduler")],H);M.Scheduler=H;let J=function(I){function F(N,R,S,P){var Q=I.call(this,{})||this;Q._scheduler=N;Q.name=R;Q._basePriority=P;Q.runtime=0;Q._queue=new h;Q.updating=!1;Q.schedulePriority=Q._basePriority;Q.task=y.isSome(S)?S:{running:!1,runTask:V=>
Q.processQueue(V)};return Q}p._inheritsLoose(F,I);var L=F.prototype;L.normalizeCtorArgs=function(){return{}};L.remove=function(){this.processQueue(E);this._scheduler.removeTask(this);this.schedule=G.schedule;this.reschedule=G.reschedule};L.setPriority=function(N){this.name=N;N=n(N);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=N;this._basePriority=N};L.schedule=function(N,R,S){this.updating=!0;return this._queue.push(N,R,S)};L.reschedule=function(N,R,S){this.updating=
!0;return this._queue.unshift(N,R,S)};L.processQueue=function(N){for(;!N.done&&this._queue.process();)N.madeProgress();this.updating=0<this._queue.length};p._createClass(F,[{key:"basePriority",get:function(){return this._basePriority}},{key:"priority",get:function(){return this.name},set:function(N){this.setPriority(N)}},{key:"needsUpdate",get:function(){return this.updating||this.task.running}}]);return F}(r);b.__decorate([d.property()],J.prototype,"updating",void 0);J=b.__decorate([t.subclass("esri.views.support.SchedulerTask")],
J);let O=function(){function I(L){this.now=L;this._budget=this._begin=0;this._state=2;this._didWork=!1;this._enabled=!0}var F=I.prototype;F.run=function(L){if(this.done)return!1;!0===L()&&(this._didWork=!0);return!0};F.madeProgress=function(){this._didWork=!0};F.reset=function(L,N){this._begin=this.now();this._budget=L;this._state=N;this._didWork=!1};F.resetProgress=function(){this._didWork=!1};p._createClass(I,[{key:"done",get:function(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}},
{key:"budget",get:function(){return this._budget}},{key:"state",get:function(){return this._state}},{key:"enabled",get:function(){return this._enabled},set:function(L){this._enabled=L}},{key:"remaining",get:function(){return Math.max(this._budget-this.elapsed,0)}},{key:"elapsed",get:function(){return this.now()-this._begin}},{key:"hasProgressed",get:function(){return this._didWork}}]);return I}();M.Budget=O})(D||(D={}));a.TaskState=void 0;(function(M){M.SCHEDULED="s";M.READY="r";M.WAITING="w";M.IDLE=
"i"})(a.TaskState||(a.TaskState={}));const E=(()=>{const M=new D.Budget(()=>performance.now());M.enabled=!1;return M})(),G=new (function(){function M(){}var H=M.prototype;H.remove=function(){};H.processQueue=function(){};H.schedule=function(J,O,I){try{if(e.isAborted(O)){const F=e.createAbortError();return I?Promise.resolve(I(F)):Promise.reject(F)}return e.when(J())}catch(F){return Promise.reject(F)}};H.reschedule=function(J,O,I){return this.schedule(J,O,I)};return M}()),K=Number.MAX_SAFE_INTEGER;
a.ImmediateTask=G;a.getTaskPriority=n;a.newScheduler=function(M){return new D.Scheduler({nowFunc:M})};a.noBudget=E;a.taskPriorities=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/PromiseQueue":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils"],function(a,p){let b=function(r,q,y,f,w){this.resolve=r;this.reject=q;this.callback=y;this.signal=f;this.abortCallback=w};return function(){function r(){this._tasks=[]}var q=r.prototype;q.push=function(y,
f,w){return new Promise((e,l)=>this._tasks.push(new b(e,l,y,f,w)))};q.unshift=function(y,f,w){return new Promise((e,l)=>this._tasks.unshift(new b(e,l,y,f,w)))};q.process=function(){if(0===this._tasks.length)return!1;const y=this._tasks.shift();try{const f=p.isAborted(y.signal);if(f&&!y.abortCallback)y.reject(p.createAbortError());else{const w=f?y.abortCallback(p.createAbortError()):y.callback();p.isPromise(w)?w.then(y.resolve,y.reject):y.resolve(w)}}catch(f){y.reject(f)}return!0};q.cancelAll=function(){const y=
p.createAbortError();for(const f of this._tasks)if(f.abortCallback){const w=f.abortCallback(y);f.resolve(w)}else f.reject(y);this._tasks.length=0};a._createClass(r,[{key:"length",get:function(){return this._tasks.length}}]);return r}()})},"esri/views/support/debugFlags":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w){b=function(e){function l(){var g=e.apply(this,arguments)||this;g.SCHEDULER_LOG_SLOW_TASKS=!1;g.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1;return g}a._inheritsLoose(l,e);return l}(b);p.__decorate([r.property()],b.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);p.__decorate([r.property()],b.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);b=p.__decorate([w.subclass("esri.views.support.DebugFlags")],b);return new b})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DGraphicCreationContext ./graphicSymbolUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K){const M=f.getLogger("esri.views.3d.layers.graphics.Labeler");a.Labeler=function(J){function O(){var F=J.apply(this,arguments)||this;F._dirty=!1;F._labels=new Map;F._labelsToAdd=new Map;F._labelsToRemove=new Map;F._labelingContexts=[];return F}p._inheritsLoose(O,J);var I=O.prototype;I.setup=function(){this.dispose();this._handles=new y;this._handles.add([this.view.watch("state.camera",()=>this.setDirty()),this.view.watch("pixelRatio",
()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(K.TaskPriority.LABELER,this)]);this._textTextureAtlas=new E["default"]({view:this.view});this._hudMaterialCollection=new A.MaterialCollection(this.view._stage);this._calloutMaterialCollection=new A.MaterialCollection(this.view._stage)};I.dispose=function(){this._handles=e.destroyMaybe(this._handles);this._textTextureAtlas=e.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=e.disposeMaybe(this._hudMaterialCollection);
this._calloutMaterialCollection=e.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear();this._labelsToAdd.clear();this._labelsToRemove.clear()};I._activateLabelingContext=function(F){F.labels.forEach((L,N)=>{this._labels.set(N,L);L.graphics3DGraphic.setVisibilityFlag(0,!0,1)});F.active=!0};I._deactivateLabelingContext=function(F){F.labels.forEach((L,N)=>{L.graphics3DGraphic.setVisibilityFlag(0,!1,1);this.setLabelGraphicVisibility(L.graphics3DGraphic,!1);
this._labels.delete(N)});F.active=!1};I._addLabelTextureToAtlas=function(F){for(const L of F.graphics3DGraphic.labelGraphics){if(!L._labelClass)continue;const N=F.textRenderers[L._labelIndex];N&&this._textTextureAtlas.addTextTexture(N,L.stageObject)}F.rendered=!0};I._removeLabelTextureFromAtlas=function(F){for(const L of F.graphics3DGraphic.labelGraphics){if(!L._labelClass)continue;const N=F.textRenderers[L._labelIndex];N&&this._textTextureAtlas.removeTextTexture(N,L.stageObject)}F.rendered=!1};I.runTask=
function(F){this._updateLabels(F);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(F)};I._updateLabels=function(F){if(this._dirty){this._dirty=!1;for(const L of this._labelingContexts)if(L.active&&m.areLabelsVisible(L.layer)){if(!L.labelClassContexts||!L.labelClassContexts.length){if(null===L.labelClassContexts){this._deactivateLabelingContext(L);continue}this._createLabelClassContext(L);if(L.labelClassPromise&&L.labelClassAbortController){this._dirty=!0;continue}if(!L.labelClassContexts||
!L.labelClassContexts.length)continue}w.someMap(L.labelsToInitialize,(N,R)=>{this._ensureGraphics3DResources(N)&&(this._labels.set(R,N),this.deconflictor.setDirty(),F.madeProgress());if(N.visible&&N.hasTextTextureResources||!N.visible&&N.hasGraphics3DResources)L.labelsToInitialize.delete(R),F.madeProgress();return F.done})&&(this._dirty=!0)}this._labelsToRemove.forEach(L=>this._removeLabelTextureFromAtlas(L));this._labelsToAdd.forEach(L=>this._addLabelTextureToAtlas(L));this._labelsToRemove.clear();
this._labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};I._createLabelClassContextAsync=function(){var F=p._asyncToGenerator(function*(L){var N=this;const R=L.labelClassAbortController.signal;yield L.layer.when();l.throwIfAborted(R);L.scaleVisibility&&L.scaleVisibility.updateScaleRangeActive();const S=L.graphics3DCore;var P=S.layer;if((P=P.labelingInfo&&P.labelingInfo.filter(ca=>!!ca.symbol))&&0!==P.length){var Q=Array(P.length),V=!1;yield q.forEach(P,function(){var ca=p._asyncToGenerator(function*(ba,
Z){var ha=ba.symbol;const fa=v.getGraphics3DSymbol(S.getOrCreateGraphics3DSymbol(ha));if(e.isNone(fa))M.error("Failed to create Graphics3DSymbol for label");else{yield fa.load();l.throwIfAborted(R);var aa=null;n.isCalloutSupport(ha)&&ha.hasVisibleCallout()&&(aa=z.make(ha,S.symbolCreationContext),yield aa.load(),l.throwIfAborted(R));ha=yield q.result(h.createLabelFunction(ba,L.layer.fieldsIndex,N.view.spatialReference));l.throwIfAborted(R);!0===ha.ok?Q[Z]={labelClass:ba,labelFunction:ha.value,graphics3DSymbol:fa,
graphics3DCalloutSymbolLayer:aa,calloutSymbolLayerIndex:0,textRenderParameters:N._createTextRenderParameters(fa.symbol)}:(M.error(`Label expression failed to evaluate: ${ha.error}`),V=!0)}});return function(ba,Z){return ca.apply(this,arguments)}}());l.throwIfAborted(R);V||(L.labelClassContexts=Q)}});return function(L){return F.apply(this,arguments)}}();I._createLabelClassContext=function(){var F=p._asyncToGenerator(function*(L){L.labelClassPromise||(L.labelClassPromise=this._createLabelClassContextAsync(L).catch(N=>
{if(l.isAbortError(N))throw N;L.labelClassContexts=null}).then(()=>{L.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return L.labelClassPromise});return function(L){return F.apply(this,arguments)}}();I._createTextRenderParameters=function(F){return(F=F.symbolLayers.getItemAt(0))&&"text"===F.type?D.TextRenderParameters.fromSymbol(F,this.view.pixelRatio):null};I._destroyLabelClassContext=function(F){for(var L of F.labelClassContexts)--L.graphics3DSymbol.referenced,
L.graphics3DSymbol=null;L=F.labelClassAbortController;F.labelClassAbortController=l.createAbortController();L&&L.abort();F.labelClassContexts=[];F.labelClassPromise=null;this.notifyChange("updating")};I._createTextSymbolGraphic=function(F,L,N,R,S){F={text:F.text,centerOffset:N.centerOffset,translation:N.translation,elevationOffset:N.elevationOffset,screenOffset:N.screenOffset,anchor:N.anchor,centerOffsetUnits:N.centerOffsetUnits,verticalOffset:N.verticalOffset,debugDrawBorder:C.LABELS_SHOW_BORDER,
displayWidth:F.displayWidth,displayHeight:F.displayHeight};H.graphic=L;H.renderingInfo=null;H.layer=R;return S.createLabel(H,F,this._hudMaterialCollection,this._textTextureAtlas)};I._createLineCalloutGraphic=function(F,L,N,R,S){L={symbol:L,translation:R.translation,elevationOffset:R.elevationOffset,screenOffset:R.screenOffset,centerOffset:R.centerOffset,centerOffsetUnits:R.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};H.graphic=F;H.renderingInfo=L;H.layer=S;return N.createGraphics3DGraphic(H)};
I._ensureGraphics3DResources=function(F){if(F.hasGraphics3DResources)return!1;const L=F.graphics3DGraphic;if(L.destroyed)return!1;this._ensureTextTextureResources(F);const N=F.labelingContext,R=N.labelClassContexts;if(!R||0===R.length||!N.emptySymbolLabelSupported&&0===L.graphics.length)return!1;var S=!1,P=L.graphic;const Q=N.layer;var V=m.areLabelsVisible(N.layer);const ca=this.view._stage;for(let Z=0;Z<R.length;Z++){const ha=F.textRenderers[Z];if(!ha)continue;const fa=R[Z];var ba=fa.graphics3DSymbol;
let aa=null;ba.symbol&&"label-3d"===ba.symbol.type&&(aa=ba.symbol);const W=ba.symbolLayers[0];if(!W)continue;const U=fa.labelClass;ba=x.get({graphics3DGraphic:L,labelSymbol:aa,labelClass:U,disablePlacement:N.disablePlacement});if(!e.isNone(ba)){W.setElevationInfoOverride(N.elevationInfoOverride);S=this._createTextSymbolGraphic(ha,P,ba,Q,W);if(!S)return!1;S._labelClass=U;S._labelIndex=Z;L.addLabelGraphic(S,ca,N.stageLayer);L.setVisibilityFlag(0,V,1);L.clearVisibilityFlag(1,1);L.setVisibilityFlag(3,
!1,1);S=!0;(V=fa.graphics3DCalloutSymbolLayer)&&ba.hasLabelVerticalOffset&&(V.setElevationInfoOverride(N.elevationInfoOverride),P=this._createLineCalloutGraphic(P,aa,V,ba,Q))&&(fa.calloutSymbolLayerIndex=L.labelGraphics.length,L.addLabelGraphic(P,ca,N.stageLayer));break}}N.scaleVisibility&&S&&N.scaleVisibility.updateGraphicLabelScaleVisibility(L);return F.hasGraphics3DResources=!0};I._destroyGraphics3DResources=function(F){const L=F.labelingContext.labelClassContexts;for(const N of F.graphics3DGraphic.labelGraphics){if(null==
N._labelClass)continue;const R=L[N._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=R)R.onRemoveGraphic(N)}F.graphics3DGraphic.clearLabelGraphics();F.hasGraphics3DResources=!1};I._ensureTextTextureResources=function(F){if(!F.hasTextTextureResources){var L=F.labelingContext,N=L.labelClassContexts;if(N&&0!==N.length){var R=F.graphics3DGraphic.graphic;for(let S=0;S<N.length;S++){const P=N[S];F.textRenderers[S]=null;if(!P.textRenderParameters)continue;const Q=P.labelFunction;let V;if("arcade"===
Q.type)try{const ca=Q.needsHydrationToEvaluate()?t.hydrateGraphic(R,L.layer):R;V=Q.evaluate(ca)}catch(ca){V=null}else V=Q.evaluate(R);e.isNone(V)||""===V||/^\s+$/.test(V)||(F.textRenderers[S]=new B.TextRenderer(V,P.textRenderParameters))}F.hasTextTextureResources=!0}}};I._destroyTextTextureResources=function(F){F.textRenderers=[];F.hasTextTextureResources=!1};I._addGraphic=function(F,L){const N={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:F,graphics3DGraphic:L,
textRenderers:[]};L=L.graphic.uid;F.labels.set(L,N);F.labelsToInitialize.set(L,N);this.setDirty();this.deconflictor.setDirty()};I._removeGraphic=function(F,L){L=L.graphic.uid;const N=F.labels.get(L);N&&(this._destroyGraphic(N,L),F.labels.delete(L),F.labelsToInitialize.delete(L),this.setDirty(),this.deconflictor.setDirty())};I._destroyGraphic=function(F,L){this._labels.has(L)&&(this._labels.delete(L),this._labelsToAdd.delete(L),this._labelsToRemove.delete(L));F.hasTextTextureResources&&(this._removeLabelTextureFromAtlas(F),
this._destroyTextTextureResources(F));F.hasGraphics3DResources&&this._destroyGraphics3DResources(F)};I._labelingInfoChange=function(){var F=p._asyncToGenerator(function*(L,N){if(N)for(const R of N){if(N=L.labels.get(R))this._removeGraphic(L,N.graphics3DGraphic),this._addGraphic(L,N.graphics3DGraphic)}else return this._visibilityInfoChange(L),this._resetLabels(L),this._createLabelClassContext(L)});return function(L,N){return F.apply(this,arguments)}}();I._globalPropertyChanged=function(F,L){for(const N of L.labelClassContexts){const R=
new Map;L.labels.forEach(S=>{S=S.graphics3DGraphic;R.set(S.graphic.uid,S)});e.unwrap(N.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(F,R,S=>S.labelGraphics[0]);N.graphics3DCalloutSymbolLayer&&N.graphics3DCalloutSymbolLayer.globalPropertyChanged(F,R,S=>S.labelGraphics[N.calloutSymbolLayerIndex])}};I._visibilityInfoChange=function(F){const L=F.layer.labelsVisible;L&&!F.active&&this._activateLabelingContext(F);!L&&F.active&&this._deactivateLabelingContext(F);this.setDirty()};I._resetAllLabels=
function(){for(const F of this._labelingContexts)this._resetLabels(F)};I._resetLabels=function(F){F.labels.forEach((L,N)=>{this._destroyGraphic(L,N);L.visible=!1;L.rendered=!1;F.labelsToInitialize.set(N,L)});this._destroyLabelClassContext(F);this.setDirty();this.deconflictor.setDirty()};I._findLabelingContext=function(F){for(const L of this._labelingContexts)if(L.graphics3DCore===F)return L;return null};I.addGraphicsOwner=function(F,L,N){const R=N&&N.emptySymbolLabelSupported||!1,S=N&&N.elevationInfoOverride||
null;N=N&&N.disablePlacement||null;if(!this._findLabelingContext(F)){var P=F.layer,Q={graphics3DCore:F,layer:P,scaleVisibility:L,emptySymbolLabelSupported:R,elevationInfoOverride:S,disablePlacement:N,active:P.labelsVisible,labelClassPromise:null,labelClassAbortController:l.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new G.WebGLLayer({isPickable:!0},P.uid)};this.view._stage.add(Q.stageLayer);this._labelingContexts.push(Q);this.setDirty();return{addGraphic:V=>
this._addGraphic(Q,V),removeGraphic:V=>this._removeGraphic(Q,V),featureReductionChange:()=>{},layerLabelsEnabled:()=>m.areLabelsVisible(Q.layer),labelingInfoChange:V=>this._labelingInfoChange(Q,V),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",Q),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",Q),visibilityInfoChange:()=>this._visibilityInfoChange(Q),reset:()=>this._resetLabels(Q),clear:()=>{}}}};I.removeGraphicsOwner=function(F){const L=this._findLabelingContext(F);
L&&(F=this._labelingContexts.indexOf(L),this._labelingContexts.splice(F,1),L.labels.forEach(N=>this._removeGraphic(L,N.graphics3DGraphic)),this.view._stage.remove(L.stageLayer),L.stageLayer=null,this.setDirty())};I.setLabelGraphicVisibility=function(F,L){F=F.graphic.uid;const N=this._labels.get(F);N&&N.visible!==L&&(L&&!N.rendered?(this._labelsToAdd.set(F,N),this._labelsToRemove.delete(F),N.hasTextTextureResources||N.labelingContext.labelsToInitialize.set(F,N)):!L&&N.rendered&&(this._labelsToRemove.set(F,
N),this._labelsToAdd.delete(F)),N.visible=L,this.setDirty())};I.setDirty=function(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))};p._createClass(O,[{key:"running",get:function(){var F;return this.view.ready?this._dirty||(null==(F=this._textTextureAtlas)?void 0:F.updating)||this.deconflictor.running:!1}},{key:"updating",get:function(){var F;return this._dirty||(null==(F=this._textTextureAtlas)?void 0:F.updating)||this.deconflictor.updating||this._labelingContexts.some(L=>
L.labelClassPromise&&!!L.labelClassAbortController)}},{key:"updatingProgress",get:function(){if(!this.updating||!this._textTextureAtlas)return 1;const F=0<this._labelingContexts.length?this._labelingContexts.reduce((L,N)=>L+(N.labelClassPromise&&N.labelClassAbortController?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*F+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>
this._resetAllLabels()}}}]);return O}(r);b.__decorate([g.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);b.__decorate([g.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);b.__decorate([g.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);b.__decorate([g.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=b.__decorate([u.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const H=new k(null,null,null);Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../Graphic ../../core/has ../../core/lang ../../core/maybe ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures".split(" "),function(a,p,b,r,q,y,f,w){function e(n){return"declaredClass"in n}function l(n){return"declaredClass"in n}function g(n){return"declaredClass"in n}function d(n){return q.isNone(n)?null:e(n)?n:f.fromJSON(c(n))}function c(n){const z=n.spatialReference.toJSON();
switch(n.type){case "point":{const {x:k,y:v,z:x,m:C}=n;return{x:k,y:v,z:x,m:C,spatialReference:z}}case "polygon":{const {rings:k,hasZ:v,hasM:x}=n;return{rings:u(k),hasZ:v,hasM:x,spatialReference:z}}case "polyline":{const {paths:k,hasZ:v,hasM:x}=n;return{paths:u(k),hasZ:v,hasM:x,spatialReference:z}}case "extent":{const {xmin:k,xmax:v,ymin:x,ymax:C,zmin:A,zmax:B,mmin:D,mmax:E,hasZ:G,hasM:K}=n;return{xmin:k,xmax:v,ymin:x,ymax:C,zmin:A,zmax:B,mmin:D,mmax:E,hasZ:G,hasM:K,spatialReference:z}}case "multipoint":{const {points:k,
hasZ:v,hasM:x}=n;return{points:m(k)?t(k):k,hasZ:v,hasM:x,spatialReference:z}}}}function u(n){return h(n)?n.map(z=>t(z)):n}function t(n){return n.map(z=>y.toArray(z))}function h(n){for(const z of n)if(0!==z.length)return m(z);return!1}function m(n){return n.length&&(y.isFloat32Array(n[0])||y.isFloat64Array(n[0]))}a.clonePoint=function(n,z){if(!n)return null;if(l(n)){if(null==z)return n.clone();if(l(z))return z.copy(n)}null!=z?(z.x=n.x,z.y=n.y,z.spatialReference=n.spatialReference,n.hasZ?(z.z=n.z,z.hasZ=
n.hasZ):(z.z=null,z.hasZ=!1),n.hasM?(z.m=n.m,z.hasM=!0):(z.m=null,z.hasM=!1)):(z=w.makeDehydratedPoint(n.x,n.y,n.z,n.spatialReference),n.hasM&&(z.m=n.m,z.hasM=!0));return z};a.hydrateGeometry=d;a.hydrateGraphic=function(n,z){if(!n)return null;if(g(n))return n;z=new p({layer:z,sourceLayer:z});z.visible=n.visible;z.symbol=r.clone(n.symbol);z.attributes=r.clone(n.attributes);z.geometry=d(n.geometry);return z};a.isHydratedGeometry=e;a.isHydratedGraphic=g;a.isHydratedPoint=l;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/maybe ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d,c){function u(k,v,x){if(r.isNone(k))return null;
switch(v){case "point":return{x:k.x,y:k.y,z:k.z,m:k.m,hasZ:null!=k.z,hasM:null!=k.m,type:"point",spatialReference:x};case "polyline":return{paths:k.paths,hasZ:!!k.hasZ,hasM:!!k.hasM,type:"polyline",spatialReference:x};case "polygon":return{rings:k.rings,hasZ:!!k.hasZ,hasM:!!k.hasM,type:"polygon",spatialReference:x};case "multipoint":return{points:k.points,hasZ:!!k.hasZ,hasM:!!k.hasM,type:"multipoint",spatialReference:x}}}function t(k){if(r.isNone(k))return 0;let v=32;switch(k.type){case "point":v+=
42;break;case "polyline":case "polygon":{var x=0;const C=2+(k.hasZ?1:0)+(k.hasM?1:0);k="polyline"===k.type?k.paths:k.rings;for(const A of k)x+=A.length;v+=8*x*C+64;v+=128*x;v=v+34+32*(k.length+1);break}case "multipoint":x=k.points.length;v+=8*x*(2+(k.hasZ?1:0)+(k.hasM?1:0))+64;v+=128*x;v=v+34+32;break;case "extent":v+=98;k.hasM&&(v+=32);k.hasZ&&(v+=32);break;case "mesh":v+=q.estimateSize(k.vertexAttributes.position),v+=q.estimateSize(k.vertexAttributes.normal),v+=q.estimateSize(k.vertexAttributes.uv),
v+=q.estimateSize(k.vertexAttributes.tangent)}return v}function h(k,v){w.empty(v);"mesh"===k.type&&(k=k.extent);switch(k.type){case "point":v[0]=v[3]=k.x;v[1]=v[4]=k.y;k.hasZ&&(v[2]=v[5]=k.z);break;case "polyline":for(var x=0;x<k.paths.length;x++)w.expandWithNestedArray(v,k.paths[x],k.hasZ);break;case "polygon":for(x=0;x<k.rings.length;x++)w.expandWithNestedArray(v,k.rings[x],k.hasZ);break;case "multipoint":w.expandWithNestedArray(v,k.points,k.hasZ);break;case "extent":v[0]=k.xmin,v[1]=k.ymin,v[3]=
k.xmax,v[4]=k.ymax,null!=k.zmin&&(v[2]=k.zmin),null!=k.zmax&&(v[5]=k.zmax)}}function m(k,v){e.empty(v);"mesh"===k.type&&(k=k.extent);switch(k.type){case "point":v[0]=v[2]=k.x;v[1]=v[3]=k.y;break;case "polyline":for(var x=0;x<k.paths.length;x++)e.expandWithNestedArray(v,k.paths[x]);break;case "polygon":for(x=0;x<k.rings.length;x++)e.expandWithNestedArray(v,k.rings[x]);break;case "multipoint":e.expandWithNestedArray(v,k.points);break;case "extent":v[0]=k.xmin,v[1]=k.ymin,v[2]=k.xmax,v[3]=k.ymax}}const n=
w.create(),z=e.create();a.equals=c.equals;a.DehydratedFeatureClass=function(k,v,x){this.uid=k;this.geometry=v;this.attributes=x;this.visible=!0;this.centroid=this.objectId=null};a.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null};a.computeAABB=h;a.computeAABR=m;a.estimateGeometryObjectSize=
t;a.estimateSize=function(k){let v;v=32+p.estimateAttributesObjectSize(k.attributes);return v=v+3+(8+t(k.geometry))};a.expandAABB=function(k,v){h(k,n);w.expandWithAABB(v,n)};a.expandAABR=function(k,v){r.isSome(k)&&(m(k,z),e.expand(v,z,v))};a.fromFeatureSetJSON=function(k){const v=g.featureGeometryTypeKebabDictionary.fromJSON(k.geometryType),x=f.fromJSON(k.spatialReference),C=k.transform,A=k.features.map(B=>{var D=k.objectIdFieldName;B={uid:y.generateUID(),objectId:D&&B.attributes?B.attributes[D]:
null,attributes:B.attributes,geometry:u(B.geometry,v,x),visible:!0};D=B.geometry;if(r.isSome(D)&&C)switch(D.type){case "point":B.geometry=l.unquantizePoint(C,D,D,D.hasZ,D.hasM);break;case "multipoint":B.geometry=l.unquantizeMultipoint(C,D,D,D.hasZ,D.hasM);break;case "polygon":B.geometry=l.unquantizePolygon(C,D,D,D.hasZ,D.hasM);break;case "polyline":B.geometry=l.unquantizePolyline(C,D,D,D.hasZ,D.hasM);break;case "extent":B.geometry=D;break;case "mesh":B.geometry=D}return B});return{geometryType:v,
features:A,spatialReference:x,fields:k.fields?k.fields.map(B=>d.fromJSON(B)):null,objectIdFieldName:k.objectIdFieldName,globalIdFieldName:k.globalIdFieldName,geohashFieldName:k.geohashFieldName,geometryProperties:k.geometryProperties,hasZ:k.hasZ,hasM:k.hasM,exceededTransferLimit:k.exceededTransferLimit,transform:null}};a.fromJSONGeometry=u;a.getObjectId=function(k,v){return null!=k.objectId?k.objectId:k.attributes&&v?k.attributes[v]:null};a.hasGeometry=function(k){return r.isSome(k.geometry)};a.hasVertices=
function(k){if(r.isNone(k))return!1;switch(k.type){case "extent":case "point":return!0;case "polyline":for(const v of k.paths)if(0<v.length)return!0;return!1;case "polygon":for(const v of k.rings)if(0<v.length)return!0;return!1;case "multipoint":return 0<k.points.length;case "mesh":return!k.loaded||0<k.vertexAttributes.position.length}};a.isFeatureGeometry=function(k){return g.isFeatureGeometryType(k.type)};a.makeDehydratedPoint=function(k,v,x,C){return{x:k,y:v,z:x,hasZ:null!=x,hasM:!1,spatialReference:C,
type:"point"}};a.numVertices=function(k){if(r.isNone(k))return 0;switch(k.type){case "point":return 1;case "polyline":var v=0;for(var x of k.paths)v+=x.length;return v;case "polygon":x=0;for(v of k.rings)x+=v.length;return x;case "multipoint":return k.points.length;case "extent":return 2;case "mesh":return(k=k.vertexAttributes&&k.vertexAttributes.position)?k.length/3:0}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/byteSizeEstimations":function(){define(["exports"],function(a){function p(b){return 32+
b.length}a.estimateAttributesObjectSize=function(b){if(!b)return 0;let r=32;for(const q in b)if(b.hasOwnProperty(q)){const y=b[q];switch(typeof y){case "string":r+=p(y);break;case "number":r+=16;break;case "boolean":r+=4}}return r};a.estimateFixedArraySize=function(b,r){return 32+b.length*r};a.estimateNumberByteSize=function(){return 16};a.estimateStringByteSize=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","../../core/maybe",
"./jsonUtils"],function(a,p,b){function r({scale:E,translate:G},K){return Math.round((K-G[0])/E[0])}function q({scale:E,translate:G},K){return Math.round((G[1]-K)/E[1])}function y(E,G,K){const M=[];let H,J,O,I;for(let F=0;F<K.length;F++){const L=K[F];if(0<F){if(O=r(E,L[0]),I=q(E,L[1]),O!==H||I!==J)M.push(G(L,O-H,I-J)),H=O,J=I}else H=r(E,L[0]),J=q(E,L[1]),M.push(G(L,H,J))}return 0<M.length?M:null}function f(E,G,K,M){return y(E,K?M?D:B:M?B:A,G)}function w(E,G,K,M){const H=[];K=K?M?D:B:M?B:A;for(M=0;M<
G.length;M++){const J=y(E,K,G[M]);J&&3<=J.length&&H.push(J)}return H.length?H:null}function e(E,G,K,M){const H=[];K=K?M?D:B:M?B:A;for(M=0;M<G.length;M++){const J=y(E,K,G[M]);J&&2<=J.length&&H.push(J)}return H.length?H:null}function l({scale:E,translate:G},K){return K*E[0]+G[0]}function g({scale:E,translate:G},K){return G[1]-K*E[1]}function d(E,G,K){const M=Array(K.length);if(!K.length)return M;const [H,J]=E.scale;let O=l(E,K[0][0]);E=g(E,K[0][1]);M[0]=G(K[0],O,E);for(let I=1;I<K.length;I++){const F=
K[I];O+=F[0]*H;E-=F[1]*J;M[I]=G(F,O,E)}return M}function c(E,G,K){const M=Array(K.length);for(let H=0;H<K.length;H++)M[H]=d(E,G,K[H]);return M}function u(E,G,K,M){return d(E,K?M?D:B:M?B:A,G)}function t(E,G,K,M){return c(E,K?M?D:B:M?B:A,G)}function h(E,G,K,M){return c(E,K?M?D:B:M?B:A,G)}function m(E,G,K){let [M,H]=K[0],J=Math.min(M,G[0]),O=Math.min(H,G[1]),I=Math.max(M,G[2]);G=Math.max(H,G[3]);for(let F=1;F<K.length;F++){const [L,N]=K[F];M+=L;H+=N;0>L&&(J=Math.min(J,M));0<L&&(I=Math.max(I,M));0>N?
O=Math.min(O,H):0<N&&(G=Math.max(G,H))}E[0]=J;E[1]=O;E[2]=I;E[3]=G;return E}function n(E,G){if(!G.length)return null;E[0]=E[1]=Number.POSITIVE_INFINITY;E[2]=E[3]=Number.NEGATIVE_INFINITY;for(let K=0;K<G.length;K++)m(E,E,G[K]);return E}function z(E,G,K,M,H){G.xmin=r(E,K.xmin);G.ymin=q(E,K.ymin);G.xmax=r(E,K.xmax);G.ymax=q(E,K.ymax);G!==K&&(M&&(G.zmin=K.zmin,G.zmax=K.zmax),H&&(G.mmin=K.mmin,G.mmax=K.mmax));return G}function k(E,G,K,M,H){G.points=f(E,K.points,M,H);return G}function v(E,G,K,M,H){G.x=
r(E,K.x);G.y=q(E,K.y);G!==K&&(M&&(G.z=K.z),H&&(G.m=K.m));return G}function x(E,G,K,M,H){E=w(E,K.rings,M,H);if(!E)return null;G.rings=E;return G}function C(E,G,K,M,H){E=e(E,K.paths,M,H);if(!E)return null;G.paths=E;return G}const A=(E,G,K)=>[G,K],B=(E,G,K)=>[G,K,E[2]],D=(E,G,K)=>[G,K,E[2],E[3]];a.equals=function(E,G){if(E===G||null==E&&null==G)return!0;if(null==E||null==G)return!1;let K,M,H,J;E&&"upperLeft"===E.originPosition?(K=E.translate[0],M=E.translate[1],E=E.scale[0]):(K=E.extent.xmin,M=E.extent.ymax,
E=E.tolerance);G&&"upperLeft"===G.originPosition?(H=G.translate[0],J=G.translate[1],G=G.scale[0]):(H=G.extent.xmin,J=G.extent.ymax,G=G.tolerance);return K===H&&M===J&&E===G};a.getQuantizedBoundsCoordsArray=m;a.getQuantizedBoundsCoordsArrayArray=n;a.getQuantizedBoundsPaths=function(E){return n([0,0,0,0],E)};a.getQuantizedBoundsPoints=function(E){const G=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return m(G,G,E)};a.getQuantizedBoundsRings=function(E){return n([0,
0,0,0],E)};a.quantizeBounds=function(E,G,K){G[0]=r(E,K[0]);G[3]=q(E,K[1]);G[2]=r(E,K[2]);G[1]=q(E,K[3]);return G};a.quantizeExtent=z;a.quantizeGeometry=function(E,G){return E&&G?b.isPoint(G)?v(E,{},G,!1,!1):b.isPolyline(G)?C(E,{},G,!1,!1):b.isPolygon(G)?x(E,{},G,!1,!1):b.isMultipoint(G)?k(E,{},G,!1,!1):b.isExtent(G)?z(E,{},G,!1,!1):null:null};a.quantizeMultipoint=k;a.quantizePaths=e;a.quantizePoint=v;a.quantizePoints=f;a.quantizePolygon=x;a.quantizePolyline=C;a.quantizeRings=w;a.quantizeX=r;a.quantizeY=
q;a.toQuantizationTransform=function(E){return E?{originPosition:"upper-left"===E.originPosition?"upperLeft":"lower-left"===E.originPosition?"lowerLeft":E.originPosition,scale:E.tolerance?[E.tolerance,E.tolerance]:[1,1],translate:E.extent?[E.extent.xmin,E.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(E,G,K){return K?(G[0]=l(E,K[0]),G[1]=g(E,K[3]),G[2]=l(E,K[2]),G[3]=g(E,K[1]),G):[l(E,G[0]),g(E,G[3]),l(E,G[2]),g(E,G[1])]};a.unquantizeCoordsArray=d;a.unquantizeCoordsArrayArray=c;a.unquantizeExtent=
function(E,G,K,M,H){G.xmin=l(E,K.xmin);G.ymin=g(E,K.ymin);G.xmax=l(E,K.xmax);G.ymax=g(E,K.ymax);G!==K&&(M&&(G.zmin=K.zmin,G.zmax=K.zmax),H&&(G.mmin=K.mmin,G.mmax=K.mmax));return G};a.unquantizeMultipoint=function(E,G,K,M,H){p.isSome(K)&&(G.points=u(E,K.points,M,H));return G};a.unquantizePaths=t;a.unquantizePoint=function(E,G,K,M,H){if(p.isNone(K))return G;G.x=l(E,K.x);G.y=g(E,K.y);G!==K&&(M&&(G.z=K.z),H&&(G.m=K.m));return G};a.unquantizePoints=u;a.unquantizePolygon=function(E,G,K,M,H){p.isSome(K)&&
(G.rings=h(E,K.rings,M,H));return G};a.unquantizePolyline=function(E,G,K,M,H){p.isSome(K)&&(G.paths=t(E,K.paths,M,H));return G};a.unquantizeRings=h;a.unquantizeX=l;a.unquantizeY=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has","../../core/maybe"],function(a,p,b){function r(l,g){if(l===g)return!0;if(null==l||null==g||l.length!==g.length)return!1;for(let d=0;d<l.length;d++){const c=l[d],u=g[d];if(c.length!==
u.length)return!1;for(let t=0;t<c.length;t++)if(c[t]!==u[t])return!1}return!0}function q(l,g){if(l===g)return!0;if(null==l||null==g||l.length!==g.length)return!1;for(let d=0;d<l.length;d++)if(!r(l[d],g[d]))return!1;return!0}function y(l,g){return f(l.spatialReference,g.spatialReference)?l.x===g.x&&l.y===g.y&&l.z===g.z&&l.m===g.m:!1}function f(l,g){return l===g||l&&g&&l.equals(g)}function w(l,g){if(l===g)return!0;if(b.isNone(l)||b.isNone(g)||l.type!==g.type)return!1;switch(l.type){case "point":return y(l,
g);case "extent":return l=l.hasZ!==g.hasZ||l.hasM!==g.hasM?!1:f(l.spatialReference,g.spatialReference)?l.xmin===g.xmin&&l.ymin===g.ymin&&l.zmin===g.zmin&&l.xmax===g.xmax&&l.ymax===g.ymax&&l.zmax===g.zmax:!1,l;case "polyline":return l=l.hasZ!==g.hasZ||l.hasM!==g.hasM?!1:f(l.spatialReference,g.spatialReference)?q(l.paths,g.paths):!1,l;case "polygon":return l=l.hasZ!==g.hasZ||l.hasM!==g.hasM?!1:f(l.spatialReference,g.spatialReference)?q(l.rings,g.rings):!1,l;case "multipoint":return l=l.hasZ!==g.hasZ||
l.hasM!==g.hasM?!1:f(l.spatialReference,g.spatialReference)?r(l.points,g.points):!1,l;case "mesh":return!1}}function e(l,g){if(l===g)return!0;if(!l||!g)return!1;const d=Object.keys(l),c=Object.keys(g);if(d.length!==c.length)return!1;for(const u of d)if(l[u]!==g[u])return!1;return!0}a.equals=function(l,g){return l===g?!0:null!=l&&null!=g&&l.objectId===g.objectId&&w(l.geometry,g.geometry)&&e(l.attributes,g.attributes)?!0:!1};a.pointEquals=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(a,p,b,r,q,y,f,w,e,l){function g(){g=b._asyncToGenerator(function*(h,m,n){if(!h||!h.symbol)return u;const z=h.where,k=e.getLabelExpression(h);h=z?yield new Promise(function(v,x){a(["../../core/sql/WhereClause"],v,x)}):null;if("arcade"===k.type){const v=yield l.createLabelExpression(k.expression,n,m);n={type:"arcade",evaluate(x){try{const C=v.evaluate({$feature:"attributes"in x?v.repurposeFeature(x):v.repurposeAdapter(x)});if(null!=C)return C.toString()}catch(C){c.error(new r("bad-arcade-expression",
"Encountered an error when evaluating label expression for feature",{feature:x,expression:k}))}return null},needsHydrationToEvaluate(){return null==e.getSingleFieldArcadeExpression(k.expression)}}}else n={type:"simple",evaluate(v){return k.expression.replace(/{[^}]*}/g,x=>{var C=x.slice(1,-1);C=m.get(C);if(!C)return x;x=null;"attributes"in v?v&&v.attributes&&(x=v.attributes[C.name]):x=v.field(C.name);return null==x?"":d(x,C)})}};if(z){let v;try{v=h.WhereClause.create(z,m)}catch(C){return u}const x=
n.evaluate;n.evaluate=C=>v.testFeature(C,"attributes"in C?void 0:t)?x(C):null}return n});return g.apply(this,arguments)}function d(h,m){if(null==h)return"";const n=m.domain;if(n)if("codedValue"===n.type||"coded-value"===n.type)for(var z of n.codedValues){if(z.code===h)return z.name}else if("range"===n.type){z=+h;const k="range"in n?n.range[1]:n.maxValue;if(("range"in n?n.range[0]:n.minValue)<=z&&z<=k)return n.name}"date"===m.type||"esriFieldTypeDate"===m.type?h=y.formatDate(h,y.convertDateFormatToIntlOptions("short-date")):
w.isNumericField(m)&&(h=f.formatNumber(+h));return h?h:""}const c=q.getLogger("esri.layers.support.labelFormatUtils"),u={type:"simple",evaluate(){return null}},t={getAttribute(h,m){return h.field(m)}};p.createLabelFunction=function(h,m,n){return g.apply(this,arguments)};p.formatField=d;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils",
"./Graphics3DLineCalloutSymbolLayer"],function(a,p,b,r){const q=p.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),y={line:r.Graphics3DLineCalloutSymbolLayer};a.make=function(f,w){if(!b.isCalloutSupport(f))return q.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${f.type}' does not support callouts`),null;if(!f.callout)return null;const e=y[f.callout.type];return e?new e(f,w):(q.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${f.callout.type}`),
null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Material ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){l=function(v){function x(A,B){A=v.call(this,A,null,B,k)||this;A._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};A.ensureDrapedStatus(!1);return A}p._inheritsLoose(x,v);var C=x.prototype;C.doLoad=function(){var A=p._asyncToGenerator(function*(){this._material=new h.LineCalloutMaterial(this.materialParameters);this._context.stage.add(this._material)});return function(){return A.apply(this,arguments)}}();C.destroy=function(){v.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};C.perInstanceMaterialParameters=function(A){const B=this.materialParameters;B.screenOffset=A.screenOffset||[0,0];B.centerOffsetUnits=A.centerOffsetUnits||"world";return B};C._defaultElevationInfoNoZ=function(){return z};C.createGraphics3DGraphic=function(A){const B=A.renderingInfo;A=A.graphic;const D=this.setGraphicElevationContext(A,new w.ElevationContext,B.elevationOffset||0);var E=B.symbol;const G="on-the-ground"===this._elevationContext.mode&&
("cim"===E.type||!E.symbolLayers.some(K=>"object"===K.type||"text"===K.type));if("label-3d"!==E.type&&G)return null;E=g.computeCentroid(A.geometry);return r.isNone(E)?null:this._createAs3DShape(E,D,B,A.uid)};C.layerOpacityChanged=function(){if(r.isNone(this._material))return!0;this._material.setParameterValues(this.materialParameters);return!0};C.layerElevationInfoChanged=function(A,B,D){D=f.elevationModeChangeUpdateType(x.elevationModeChangeTypes,D,this._elevationContext.mode);if(D!==f.SymbolUpdateType.UPDATE)return D;
A.forEach(E=>{const G=B(E);r.isSome(G)&&this.updateGraphicElevationContext(E.graphic,G)});return D};C.slicePlaneEnabledChanged=function(){if(r.isNone(this._material))return!0;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};C.physicalBasedRenderingChanged=function(){return!0};C.pixelRatioChanged=function(){return!0};C.setGraphicElevationContext=function(A,B,D=0){A=v.prototype.setGraphicElevationContext.call(this,A,B);A.addOffsetRenderUnits(D);return A};
C.updateGraphicElevationContext=function(A,B){this.setGraphicElevationContext(A,B.elevationContext,B.metadata.elevationOffset);B.needsElevationUpdates=f.needsElevationUpdates2D(B.elevationContext.mode)};C.updateGeometry=function(A,B){return!1};C.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:c.emptySymbolComplexity.memory}};C.createVertexData=function(A){const {translation:B,centerOffset:D}=A;return[["position",B?{size:3,
data:[B[0],B[1],B[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["auxpos1",D?{size:4,data:[D[0],D[1],D[2],D[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]};C._getOrCreateMaterial=function(A){const B=this.perInstanceMaterialParameters(A),D=h.LineCalloutMaterial.uniqueMaterialIdentifier(B);if(r.isSome(this._material)&&D===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(A.materialCollection){let E=
A.materialCollection.get(D);r.isNone(E)&&(E=new h.LineCalloutMaterial(B),A.materialCollection.add(D,E));return{material:E,isUnique:!1}}return{material:new h.LineCalloutMaterial(B),isUnique:!0}};C._createAs3DShape=function(A,B,D,E){var G=[new u.Geometry(this.createVertexData(D),n,1)];const K=this._getOrCreateMaterial(D);E=d.createStageObjectForHUD(this._context,A,G,[K.material],null,null,B,this._context.layer.uid,E);if(null===E)return null;G=new e.Graphics3DObject3DGraphicLayer(this,E.object,G,K.isUnique?
[K.material]:null,null,y.perObjectElevationAligner,B);G.metadata={elevationOffset:D.elevationOffset||0};G.alignedSampledElevation=E.sampledElevation;G.needsElevationUpdates=f.needsElevationUpdates2D(B.mode);d.extendPointGraphicElevationContext(G,A,this._context.elevationProvider);return G};p._createClass(x,[{key:"materialParameters",get:function(){const A=this.symbol;var B=A.callout;const D=r.isSome(B.color)?b.toUnitRGBA(B.color):[0,0,0,0];D[3]*=this._getLayerOpacity();const E=q.pt2px(B.size||0);
let G=null;if(A.verticalOffset){const {screenLength:M,minWorldLength:H,maxWorldLength:J}=A.verticalOffset;G={screenLength:q.pt2px(M),minWorldLength:H||0,maxWorldLength:null!=J?J:Infinity}}B=r.isSome(B.border)&&r.isSome(B.border.color)?b.toUnitRGBA(B.border.color):null;const K="object"===A.symbolLayers.getItemAt(0).type;return{color:D,size:E,verticalOffset:G,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,
0],centerOffsetUnits:"world",borderColor:B,occlusionTest:!K,shaderPolygonOffset:K?0:void 0,depthHUDAlignStart:"label-3d"===A.type,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:t.materialParametersDefaults.renderOccluded}}}]);return x}(l.Graphics3DSymbolLayer);l.elevationModeChangeTypes={definedChanged:f.SymbolUpdateType.UPDATE,staysOnTheGround:f.SymbolUpdateType.UPDATE,onTheGroundChanged:f.SymbolUpdateType.RECREATE};const m=new Uint16Array([0]),n=[["position",m],["normal",m],["auxpos1",
m]],z={mode:"relative-to-ground",offset:0},k={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};a.Graphics3DLineCalloutSymbolLayer=l;a["default"]=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){const d=r.create(),c=y.create(),u=y.create(),t=y.create(),h=r.create(),m=y.create(),n={verticalDistanceToGround:0,sampledElevation:0};a.perLodInstanceElevationAligner=function(z,k,v,x){const C=z.graphics3DSymbolLayer.lodRenderer;if(p.isNone(C))return 0;const A=k.centerPointInElevationSR;let B=0,D=0;const E="absolute-height"!==k.mode;B=w.evaluateElevationAlignmentAtPoint(A,v,k,x,E?n:null);E&&(D=n.sampledElevation);k=C.instanceData;z=z.instanceIndex;k.getGlobalTransform(z,
h);v=q.set(m,h[12],h[13],h[14]);l.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(c[0]=A.x,c[1]=A.y,c[2]=B,f.computeTranslationToOriginAndRotation(A.spatialReference,c,h,x.spatialReference)&&k.setGlobalTransform(z,h)):x.setAltitudeOfTransformation(B,h);x=.01/x.unitInMeters;(l.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(h[12]-v[0])>=x||Math.abs(h[13]-v[1])>=x||Math.abs(h[14]-v[2])>=x)&&k.setGlobalTransform(z,h);return D};a.perObjectElevationAligner=function(z,k,v,x){z=z.stageObject;const C=k.centerPointInElevationSR;
let A=0,B=0;if(z.metadata.usesVerticalDistanceToGround)A=w.evaluateElevationAlignmentAtPoint(C,v,k,x,n),e.updateVertexAttributeAuxpos1w(z,n.verticalDistanceToGround),B=n.sampledElevation;else{const D="absolute-height"!==k.mode;A=w.evaluateElevationAlignmentAtPoint(C,v,k,x,D?n:null);D&&(B=n.sampledElevation)}k=b.copy(d,z.transformation);v=q.set(m,k[12],k[13],k[14]);l.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(c[0]=C.x,c[1]=C.y,c[2]=A,f.computeTranslationToOriginAndRotation(C.spatialReference,c,
k,x.spatialReference)&&(z.transformation=k)):x.setAltitudeOfTransformation(A,k);x=.01/x.unitInMeters;if(Math.abs(k[12]-v[0])>=x||Math.abs(k[13]-v[1])>=x||Math.abs(k[14]-v[2])>=x)z.transformation=k;return B};a.perVertexElevationAligner=function(z,k,v,x){z=z.stageObject;const C=v.spatialReference,A=z.geometryRecords,B=A.length,D="absolute-height"!==k.mode;let E=0;for(let O=0;O<B;O++){var G=A[O].geometry,K=A[O].getShaderTransformation();u[0]=K[12];u[1]=K[13];u[2]=K[14];G.invalidateBoundingInfo();var M=
G.getMutableAttribute("position");K=M.data;var H=G.vertexAttributes.get("mapPos").data;G=M.size;M=K.length/G;H=new g.SamplePosition(H,C);let I=0,F=!1,L=0;for(let N=0;N<M;N++){t[0]=K[I];t[1]=K[I+1];t[2]=K[I+2];var J=w.evaluateElevationAlignmentAtPoint(H,v,k,x,D?n:null);D&&(L+=n.sampledElevation);l.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(K[I]=H.array[H.offset],K[I+1]=H.array[H.offset+1],K[I+2]=J,f.projectBuffer(K,C,I,K,x.spatialReference,I,1),K[I]-=u[0],K[I+1]-=u[1],K[I+2]-=u[2]):(c[0]=K[I]+u[0],
c[1]=K[I+1]+u[1],c[2]=K[I+2]+u[2],x.setAltitude(c,J),K[I]=c[0]-u[0],K[I+1]=c[1]-u[1],K[I+2]=c[2]-u[2]);if(l.TESTS_DISABLE_UPDATE_THRESHOLDS)F=!0;else if(J=.01/x.unitInMeters,Math.abs(t[0]-K[I])>=J||Math.abs(t[1]-K[I+1])>=J||Math.abs(t[2]-K[I+2])>=J)F=!0;I+=G;H.offset+=3}E+=L/M;F&&z.geometryVertexAttrsUpdated(O)}return E/B};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),
function(a,p,b,r,q,y,f,w,e,l){function g(h,m,n,z,k){const v=(w.isDehydratedPoint(h)?h.z:l.isSamplePosition(h)?h.array[h.offset+2]:h[2])||0;switch(n.mode){case "on-the-ground":return n=b.unwrapOr(l.getElevationAtPoint(m,h,"ground"),0),k&&(k.verticalDistanceToGround=0,k.sampledElevation=n),n;case "relative-to-ground":return h=b.unwrapOr(l.getElevationAtPoint(m,h,"ground"),0),n=n.geometryZWithOffset(v,z),k&&(k.verticalDistanceToGround=n,k.sampledElevation=h),n+h;case "relative-to-scene":return h=b.unwrapOr(l.getElevationAtPoint(m,
h,"scene"),0),n=n.geometryZWithOffset(v,z),k&&(k.verticalDistanceToGround=n,k.sampledElevation=h),n+h;case "absolute-height":return n=n.geometryZWithOffset(v,z),k&&(z=b.unwrapOr(l.getElevationAtPoint(m,h,"ground"),0),k.verticalDistanceToGround=n-z,k.sampledElevation=z),n;default:return p.neverReached(n.mode),0}}a.SymbolUpdateType=void 0;(function(h){h[h.NONE=0]="NONE";h[h.UPDATE=1]="UPDATE";h[h.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||(a.SymbolUpdateType={}));const d={"absolute-height":{applyElevationAlignmentBuffer:function(h,
m,n,z,k,v,x,C){v=C.calculateOffsetRenderUnits(x);C=C.featureExpressionInfoContext;m*=3;z*=3;for(x=0;x<k;++x){const A=h[m+1],B=h[m+2];n[z+0]=h[m+0];n[z+1]=A;n[z+2]=null==C?B+v:v;m+=3;z+=3}return 0},requiresAlignment:function(h){const m=h.featureExpressionInfoContext;return 0!==h.meterUnitOffset||null!=m}},"on-the-ground":{applyElevationAlignmentBuffer:function(h,m,n,z,k,v){let x=0;const C=v.spatialReference;m*=3;z*=3;for(let A=0;A<k;++A){const B=h[m+0],D=h[m+1],E=b.unwrapOr(v.getElevation(B,D,h[m+
2],C,"ground"),0);x+=E;n[z+0]=B;n[z+1]=D;n[z+2]=E;m+=3;z+=3}return x/k},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(h,m,n,z,k,v,x,C){let A=0;x=C.calculateOffsetRenderUnits(x);C=C.featureExpressionInfoContext;const B=v.spatialReference;m*=3;z*=3;for(let D=0;D<k;++D){const E=h[m+0],G=h[m+1],K=h[m+2],M=b.unwrapOr(v.getElevation(E,G,K,B,"ground"),0);A+=M;n[z+0]=E;n[z+1]=G;n[z+2]=null==C?K+M+x:M+x;m+=3;z+=3}return A/k},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(h,
m,n,z,k,v,x,C){let A=0;x=C.calculateOffsetRenderUnits(x);C=C.featureExpressionInfoContext;const B=v.spatialReference;m*=3;z*=3;for(let D=0;D<k;++D){const E=h[m+0],G=h[m+1],K=h[m+2],M=b.unwrapOr(v.getElevation(E,G,K,B,"scene"),0);A+=M;n[z+0]=E;n[z+1]=G;n[z+2]=null==C?K+M+x:M+x;m+=3;z+=3}return A/k},requiresAlignment:()=>!0}},c=q.create(),u={verticalDistanceToGround:0,sampledElevation:0},t=y.create();a.applyElevationAlignmentForHUD=function(h,m,n,z,k){n=g(m,n,k,z,u);e.updateVertexAttributeAuxpos1w(h,
u.verticalDistanceToGround);k=u.sampledElevation;const v=r.copy(c,h.transformation);t[0]=m.x;t[1]=m.y;t[2]=n;f.computeTranslationToOriginAndRotation(m.spatialReference,t,v,z.spatialReference)?h.transformation=v:console.warn("Could not locate symbol object properly, it might be misplaced");return k};a.applyPerVertexElevationAlignment=function(h,m,n,z,k,v,x,C,A,B,D){const E=d[D.mode];let G=0;if(f.projectBuffer(h,m,n,z,A.spatialReference,k,C)&&(E.requiresAlignment(D)?(G=E.applyElevationAlignmentBuffer(z,
k,v,x,C,A,B,D),h=v,k=x):h=z,f.projectBuffer(h,A.spatialReference,k,v,B.spatialReference,x,C)))return G};a.elevationModeChangeUpdateType=function(h,m,n){return null==m||null==n?h.definedChanged:"on-the-ground"===m&&"on-the-ground"===n?h.staysOnTheGround:m===n||"on-the-ground"!==m&&"on-the-ground"!==n?a.SymbolUpdateType.UPDATE:h.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=g;a.needsElevationUpdates2D=function(h){return"relative-to-ground"===h||"relative-to-scene"===h};a.needsElevationUpdates3D=
function(h){return"absolute-height"!==h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){function m(k){var v=k.paths[0];if(!v||0===v.length)return null;v=u.getPointOnPath(v,u.getPathLength(v)/2);return t.makeDehydratedPoint(v[0],v[1],v[2],k.spatialReference)}function n(k,v,x){x=x?k:h.clonePoint(k);return v&&k?l.projectPoint(k,x,v)?x:null:x}function z(k){if(Array.isArray(k)){for(const v of k)if(!z(v))return!1;return!0}return null==k||0<=k}y={"bottom-left":y.fromValues(0,0),bottom:y.fromValues(.5,0),"bottom-right":y.fromValues(1,0),left:y.fromValues(0,
.5),center:y.fromValues(.5,.5),right:y.fromValues(1,.5),"top-left":y.fromValues(0,1),top:y.fromValues(.5,1),"top-right":y.fromValues(1,1)};a.computeCentroid=function(k,v){if("point"===k.type)return n(k,v,!1);if(h.isHydratedGeometry(k))switch(k.type){case "extent":return n(k.center,v,!1);case "polygon":return n(k.centroid,v,!1);case "polyline":return n(m(k),v,!0);case "mesh":return n(k.origin,v,!1)}else switch(k.type){case "extent":var x=p.isFinite(k.zmin);k=t.makeDehydratedPoint(.5*(k.xmax+k.xmin),
.5*(k.ymax+k.ymin),x?.5*(k.zmax+k.zmin):void 0,k.spatialReference);return n(k,v,!0);case "polygon":return(x=k.rings[0])&&0!==x.length?(x=c.ringsCentroid(k.rings,k.hasZ),k=t.makeDehydratedPoint(x[0],x[1],x[2],k.spatialReference)):k=null,n(k,v,!0);case "polyline":return n(m(k),v,!0)}};a.computeObjectRotation=function(k,v,x,C=q.create()){k=k||0;v=v||0;x=x||0;0!==k&&r.rotateZ(C,C,-k/180*Math.PI);0!==v&&r.rotateX(C,C,v/180*Math.PI);0!==x&&r.rotateY(C,C,x/180*Math.PI);return C};a.computeObjectScale=function(k=
f.ONES,v,x,C=1){const A=Array(3);if(b.isNone(v)||b.isNone(x))A[0]=1,A[1]=1,A[2]=1;else{let D=0;for(let E=2;0<=E;E--){const G=k[E];let K;const M=null!=G,H=0===E&&!B&&!M,J=x[E];"symbol-value"===G||H?K=0!==J?v[E]/J:1:M&&"proportional"!==G&&isFinite(G)&&(K=0!==J?G/J:1);if(null!=K){var B=A[E]=K;D=Math.max(D,Math.abs(K))}}for(k=2;0<=k;k--)null==A[k]?A[k]=B:0===A[k]&&(A[k]=.001*D)}for(B=2;0<=B;B--)A[B]/=C;return f.fromArray(A)};a.demResolutionForBoundingBox=function(k,v){return null!=v.minDemResolution?
v.minDemResolution:g.isPoint(k)?v.minDemResolutionForPoints:.01*g.maximumDimension(k)};a.enlargeExtent=function(k,v,x,C=0){if(k){v||(v=d.create());let A=.5*k.width*(x-1);x=.5*k.height*(x-1);k.width<1E-7*k.height?A+=x/20:k.height<1E-7*k.width&&(x+=A/20);w.set(v,k.xmin-A-C,k.ymin-x-C,k.xmax+A+C,k.ymax+x+C);return v}return null};a.isValidSize=z;a.mixinColorAndOpacity=function(k,v){const x=e.clone(e.ONES);b.isSome(k)&&(x[0]=k[0],x[1]=k[1],x[2]=k[2]);b.isSome(v)?x[3]=v:b.isSome(k)&&3<k.length&&(x[3]=k[3]);
return x};a.namedAnchorToHUDMaterialAnchorPos=y;a.overrideColor=function(k,v,x,C,A,B=[0,0,0,0]){for(let D=0;3>D;++D)b.isSome(k)&&null!=k[D]?B[D]=k[D]:b.isSome(x)&&null!=x[D]?B[D]=x[D]:B[D]=A[D];b.isSome(v)?B[3]=v:b.isSome(C)?B[3]=C:B[3]=A[3];return B};a.updateVertexAttributeAuxpos1w=function(k,v){for(let x=0;x<k.geometries.length;++x){const C=k.geometries[x].getMutableAttribute("auxpos1");C&&C.data[3]!==v&&(C.data[3]=v,k.geometryVertexAttrsUpdated(x))}};a.validateSymbolLayerSize=function(k){null!=
k.isPrimitive&&(k=[k.width,k.depth,k.height]);return z(k)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,p,b,r,q){let y=function(){function f(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";
this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var w=f.prototype;w.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};w.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e};w.geometryZWithOffset=function(e,l){l=this.calculateOffsetRenderUnits(l);return null!=this.featureExpressionInfoContext?l:e+l};w.calculateOffsetRenderUnits=function(e){let l=
this._meterUnitOffset;const g=this.featureExpressionInfoContext;null!=g&&(l+=q.execute(g)*this._metersPerElevationInfoUnit);return l/e.unitInMeters+this._renderUnitOffset};w.setFromElevationInfo=function(e){this.mode=e.mode;this.unit=r.supportsUnit(e.unit)?e.unit:"meters";this.offsetElevationInfoUnits=b.unwrapOr(e.offset,0)};w.updateFeatureExpressionInfoContext=function(e,l,g){if(b.isNone(e))this._featureExpressionInfoContext=null;else{var d=e&&e.arcade;d&&b.isSome(l)&&b.isSome(g)?(this._featureExpressionInfoContext=
q.clone(e),q.setContextFeature(this._featureExpressionInfoContext,q.createFeature(d.modules,l,g))):this._featureExpressionInfoContext=e}};f.fromElevationInfo=function(e){const l=new f;b.isSome(e)&&l.setFromElevationInfo(e);return l};p._createClass(f,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e;this._metersPerElevationInfoUnit=
r.getMetersPerUnit(e)}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}}]);return f}();a.ElevationContext=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../layers/graphics/hydratedFeatures",
"../../../../support/arcadeOnDemand"],function(a,p,b,r,q){function y(){y=p._asyncToGenerator(function*(w,e,l){w=w&&w.expression;if("string"!==typeof w)return null;var g="0"===w?0:null;if(null!=g)return{cachedResult:g};g=yield q.loadArcade();const d=g.arcadeUtils;w=d.createSyntaxTree(w);return d.dependsOnView(w)?(null!=l&&l.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:d.createFunction(w),context:d.createExecContext(null,{sr:e}),modules:g}}});
return y.apply(this,arguments)}const f=b.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");a.clone=function(w){return{cachedResult:w.cachedResult,arcade:w.arcade?{func:w.arcade.func,context:w.arcade.modules.arcadeUtils.createExecContext(null,{sr:w.arcade.context.spatialReference}),modules:w.arcade.modules}:null}};a.createContext=function(w,e,l){return y.apply(this,arguments)};a.createContextWithoutExpressionSupport=function(w){w=w&&w.expression;return"string"===typeof w&&(w="0"===
w?0:null,null!=w)?{cachedResult:w}:null};a.createFeature=function(w,e,l){return w.arcadeUtils.createFeature(e.attributes,e.geometry,l)};a.execute=function(w){if(null!=w){if(null!=w.cachedResult)return w.cachedResult;var e=w.arcade;e=w.arcade.modules.arcadeUtils.executeFunction(e.func,e.context);"number"!==typeof e&&(e=w.cachedResult=0);return e}return 0};a.extractExpressionInfo=function(w,e=!1){const l=(w=w&&w.featureExpressionInfo)&&w.expression;e||"0"===l||(w=null);return w};a.setContextFeature=
function(w,e){null!=w&&null==w.cachedResult&&(e&&w.arcade?(e._geometry&&(e._geometry=r.hydrateGeometry(e._geometry)),w.arcade.modules.arcadeUtils.updateExecContext(w.arcade.context,e)):f.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./featureExpressionInfoUtils ./graphicUtils".split(" "),
function(a,p,b,r,q,y,f,w,e){function l(h){return h.isVisible?h.params.transparent?1:2:0}let g=function(){function h(n,z,k,v,x,C,A,B=null){this.graphics3DSymbolLayer=n;this.stageObject=z;this._uniqueGeometries=k;this._uniqueMaterials=v;this._uniqueTextures=x;this.elevationAligner=C;this.elevationContext=A;this._edgeState=B;this.type="object3d";this.stage=this.stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=
!1;this.graphics3DSymbolLayer=n;this.stageObject=z}var m=h.prototype;m.initialize=function(n,z){this.stageLayer=z;this.stage=n;n.addMany(this._uniqueMaterials);n.addMany(this._uniqueGeometries);n.addMany(this._uniqueTextures);n.add(this.stageObject)};m.destroy=function(){var n=this.stage;this.stageLayer&&(n.removeMany(this._uniqueMaterials),n.removeMany(this._uniqueGeometries),n.removeMany(this._uniqueTextures));n.remove(this.stageObject);this._addedToStage&&(this.stageLayer.remove(this.stageObject),
this._addedToStage=!1);n=this.stage.renderView.ensureEdgeView();n.hasObject(this.stageObject)&&n.removeObject(this.stageObject);this.stageObject.dispose();this._visible=!1;this.stage=this.stageLayer=null};m.layerOpacityChanged=function(n,z){if(!b.isNone(this._edgeState)){var k=l(this._edgeState.baseMaterial),v=!1;for(const x of this._edgeState.edgeMaterials)x.objectTransparency!==k&&(x.objectTransparency=k,v=!0);v&&this.resetEdgeObject(z);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,
[n])}};m.slicePlaneEnabledChanged=function(n,z){b.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:n},!z),this._edgeState.properties.slicePlaneEnabled=n)};m.setVisibility=function(n){if(null!=this.stage&&this._visible!==n&&((this._visible=n)?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),b.isSome(this._edgeState))){const z=
this.stage.renderView.ensureEdgeView();z.hasObject(this.stageObject)?z.updateObjectVisibility(this.stageObject,n):n&&this.addOrUpdateEdgeObject(z,!1)}};m.alignWithElevation=function(n,z,k,v){null!=this.elevationAligner&&(b.isSome(k)&&w.setContextFeature(this.elevationContext.featureExpressionInfoContext,k),n=this.elevationAligner(this,this.elevationContext,n,z),null!=n&&(this.alignedSampledElevation=n),this.resetEdgeObject(v))};m.getCenterObjectSpace=function(n=q.create()){return r.copy(n,f.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};
m.getBoundingBoxObjectSpace=function(n=y.create()){const z=this.stageObject.boundingVolumeObjectSpace;y.setMin(n,z.min);y.setMax(n,z.max);return n};m.computeAttachmentOrigin=function(n){if(this.useObjectOriginAsAttachmentOrigin){var z=this.stageObject.transformation;n.render.origin[0]+=z[12];n.render.origin[1]+=z[13];n.render.origin[2]+=z[14];n.render.num++}else for(z of this.stageObject.geometryRecords)z.computeAttachmentOrigin(u)&&(r.transformMat4(u,u,this.stageObject.transformation),r.add(n.render.origin,
n.render.origin,u),n.render.num++)};m.getProjectedBoundingBox=function(){var n=p._asyncToGenerator(function*(z,k,v,x,C){C=this.getBoundingBoxObjectSpace(C);var A=t,B=y.isPoint(C)?1:A.length;for(var D=0;D<B;D++){const E=A[D];c[0]=C[E[0]];c[1]=C[E[1]];c[2]=C[E[2]];r.transformMat4(c,c,this.stageObject.transformation);d[3*D]=c[0];d[3*D+1]=c[1];d[3*D+2]=c[2]}if(!z(d,0,B))return null;y.empty(C);z=null;this.calculateRelativeScreenBounds&&(z=this.calculateRelativeScreenBounds());for(A=0;A<3*B;A+=3){for(D=
0;3>D;D++)C[D]=Math.min(C[D],d[A+D]),C[D+3]=Math.max(C[D+3],d[A+D]);z&&v.push({location:d.slice(A,A+3),screenSpaceBoundingRect:z})}if(k&&k.service&&"absolute-height"!==this.elevationContext.mode){y.center(C,u);v="relative-to-scene"===this.elevationContext.mode?"scene":"ground";B=0;if(k.useViewElevation)B=b.unwrapOr(k.service.getElevation(u[0],u[1],v),0);else try{const E=e.demResolutionForBoundingBox(C,k);B=b.unwrapOr(yield k.service.queryElevation(u[0],u[1],x,E,v),0)}catch(E){}y.offset(C,0,0,-this.alignedSampledElevation+
B)}return C});return function(z,k,v,x,C){return n.apply(this,arguments)}}();m.addObjectState=function(n,z){0===n&&z.addObject(this.stageObject,this.stageObject.highlight());1===n&&z.addObject(this.stageObject,this.stageObject.maskOccludee())};m.removeObjectState=function(n){n.removeObject(this.stageObject)};m.resetEdgeObject=function(n){if(!b.isNone(this._edgeState)){var z=this.stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(z,n):z.removeObject(this.stageObject)}};m.addOrUpdateEdgeObject=
function(n,z){const k=this._edgeState;if(!b.isNone(k)){var v=l(k.baseMaterial);for(const x of k.edgeMaterials)x.objectTransparency=v;n.addOrUpdateObject3D(this.stageObject,k.edgeMaterials,k.properties,!z).then(()=>{var x;return null==(x=this.stageLayer)?void 0:x.sync()})}};p._createClass(h,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",get:function(){return this._visible}}]);return h}();const d=[0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=q.create(),u=q.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=g;a["default"]=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./Loadable ./symbolComplexity".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){function h(v,x){v=null!=v?x.attributes[v]:0;return null!=v&&isFinite(v)?v:0}const m=q.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");r=function(v){function x(A,B,D,E){var G=v.call(this,D.schedule)||this;G._context=D;G._elevationInfoOverride=null;G.complexity=null;G.logger=m;G._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};G.symbol=A;G.symbolLayer=B;G._renderPriority=E.renderPriority;G._renderPriorityStep=E.renderPriorityStep;
G._elevationContext=new g.ElevationContext;G.complexity=G.computeComplexity();G._updateDrivenProperties(E.ignoreDrivers);G._updateElevationContext();return G}p._inheritsLoose(x,v);var C=x.prototype;C.getCachedSize=function(){return null};C._logGeometryCreationWarnings=function(A,B,D,E){const G="polygons"in A?A.polygons:null;E=`${E} geometry failed to be created`;let K=null;A.projectionSuccess?!B.length||1===B.length&&!B[0].length?K=`${E} (no ${D} were defined)`:Array.isArray(B)&&Array.isArray(B[0])?
G&&0===G.length&&"rings"===D&&0<B.length&&2<B[0].length&&(K=`${E} (filled rings should use clockwise winding - try reversing the order of vertices)`):K=`${E} (${D} should be defined as a 2D array)`:K=`${E} (failed to project geometry to view spatial reference)`;K&&m.warnOncePerTick(K)};C._validateGeometry=function(A,B=null,D=null){return f.isSome(B)&&!B.includes(A.type)?(this.logger.warn("unsupported geometry type for "+D+` symbol: ${A.type}`),!1):"point"!==A.type||y.isFinite(A.x)&&y.isFinite(A.y)?
!0:(m.warn("point coordinate is not a valid number, graphic skipped"),!1)};C._defaultElevationInfoNoZ=function(){return n};C._defaultElevationInfoZ=function(){return z};C._updateElevationContext=function(){f.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):
this._elevationContext.reset()};C.getDefaultElevationInfo=function(A){return A.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};C.getGeometryElevationMode=function(A,B=this.getDefaultElevationInfo(A)){return this._elevationContext.mode||B.mode};C.setElevationInfoOverride=function(A){this._elevationInfoOverride=A;this._updateElevationContext()};C.setGraphicElevationContext=function(A,B){var D=f.unwrap(A.geometry);const E=this.getDefaultElevationInfo(D);B.unit=null!=this._elevationContext.unit?
this._elevationContext.unit:E.unit;B.mode=this.getGeometryElevationMode(D,E);B.offsetMeters=f.unwrapOr(this._elevationContext.meterUnitOffset,f.unwrapOr(E.offset,0));if(D=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===B.mode)B.mode="relative-to-ground",B.offsetMeters=0;B.updateFeatureExpressionInfoContext(D?d.zeroContext:this._elevationContext.featureExpressionInfoContext,A,this._context.layer);return B};C.prepareSymbolLayerPatch=function(A){};C.updateGeometry=function(A,B){return!1};
C.onRemoveGraphic=function(A){};C._updateDrivenProperties=function(A){const B={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};A||(A=this._context.renderer)&&"visualVariables"in A&&A.visualVariables&&A.visualVariables.forEach(D=>{switch(D.type){case "color":B.color=!0;if(D.stops)for(let E=0;E<D.stops.length;E++){const G=D.stops[E].color;G&&(B.opacity=!0,1>G.a&&(B.opacityAlwaysOpaque=!1))}break;case "opacity":B.opacity=!0;B.opacityAlwaysOpaque=!1;break;case "size":B.size=!0}});this._drivenProperties=
B};C._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;const A=this._context.layer.opacity;return null==A?1:A};C._getCombinedOpacity=function(A,B=k){let D=1;this.draped||(D*=this._getLayerOpacity());if(this._drivenProperties.opacity)return D;f.isSome(A)?D*=A.a:B.hasIntrinsicColor||(D=0);return D};C._getCombinedOpacityAndColor=function(A,B=k){B=this._getCombinedOpacity(A,B);if(this._drivenProperties.color)return c.mixinColorAndOpacity(null,
B);A=f.isSome(A)?b.toUnitRGB(A):w.ONES;return c.mixinColorAndOpacity(A,B)};C._getVertexOpacityAndColor=function(A,B=null){A=c.mixinColorAndOpacity(this._drivenProperties.color?A.color:null,this._drivenProperties.opacity?A.opacity:null);f.isSome(B)&&(A[0]*=B,A[1]*=B,A[2]*=B,A[3]*=B);return A};C.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};C.computeComplexity=function(){return t.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};C.destroy=function(){this.abortLoad()};
C.globalPropertyChanged=function(A,B,D){switch(A){case "opacity":return this.layerOpacityChanged(B,D);case "elevationInfo":return A=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(B,D,A)===l.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(B,D);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};C.updateGraphics3DGraphicElevationInfo=
function(A,B,D){let E=l.SymbolUpdateType.UPDATE;A.forEach(G=>{const K=B(G);f.isSome(K)?(this.setGraphicElevationContext(G.graphic,K.elevationContext),K.needsElevationUpdates=D(K.elevationContext.mode)):E=l.SymbolUpdateType.RECREATE});return E};C.applyRendererDiff=function(A,B){return!1};C.getFastUpdateAttrValues=function(A){if(!this._fastUpdates.enabled)return null;const B=this._fastUpdates.visualVariables,D=B.size?h(B.size.field,A):0,E=B.color?h(B.color.field,A):0;A=B.opacity?h(B.opacity.field,A):
0;return e.fromValues(D,E,A,0)};C.ensureDrapedStatus=function(A){if(null==this._draped)return this._draped=A,!0;A!==this.draped&&m.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};p._createClass(x,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},
{key:"draped",get:function(){return this._draped}}]);return x}(u.Loadable);const n={mode:"on-the-ground",offset:0,unit:"meters"},z={mode:"absolute-height",offset:0,unit:"meters"},k={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=r;a["default"]=r;a.getAttributeValue=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],function(a,p,b){let r=function(){function q(f){this.schedule=
f;this._abortController=null;this._loadStatus=0;this.logger=this._loader=this._loadError=null}var y=q.prototype;y.load=function(f,w){if(1===this._loadStatus)return f&&f(),this._loader;if(2===this._loadStatus)return w&&w(this._loadError),this._loader;this._loader||(this._abortController=b.createAbortController(),this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=1},e=>{this._loadError=e;this._abortController=null;this._loadStatus=2;!b.isAbortError(e)&&
this.logger&&e.message&&this.logger.warn(e.message);throw e;}));this._loader.then(f,w).catch(()=>{});return this._loader};y.abortLoad=function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2);this._loader=null};p._createClass(q,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return q}();a.Loadable=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(a,p,b,r,q,y,f){function w(t){let h=0,m=0,n=0,z=!1,k=0;const v={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const x of t)b.isNone(x)||(h+=x.primitivesPerFeature,m+=x.primitivesPerCoordinate,n+=x.drawCallsPerFeature,v.bytesPerFeature+=x.memory.bytesPerFeature,v.bytesPerFeatureLabel+=x.memory.bytesPerFeatureLabel,v.bytesPerCoordinate+=x.memory.bytesPerCoordinate,v.draped.bytesPerFeature+=x.memory.bytesPerFeature,
v.draped.bytesPerFeatureLabel+=x.memory.bytesPerFeatureLabel,v.draped.bytesPerCoordinate+=x.memory.bytesPerCoordinate,z=z||x.estimated,++k);return{primitivesPerFeature:h,primitivesPerCoordinate:m,drawCallsPerFeature:n,estimated:z,memory:v,numComplexities:k}}function e(t,h){const m=l(t,h);var n=y.hasEdges(h)?2:0;switch(h.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:n,estimated:!1,memory:m};case "fill":return"mesh-3d"===t.type?{primitivesPerFeature:0,
primitivesPerCoordinate:0,drawCallsPerFeature:n,estimated:!1,memory:m}:b.isSome(h.outline)&&0<h.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:m}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:m};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:m};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,
estimated:!1,memory:m};case "object":return h.resource&&h.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:m}:{...g(h.resource&&h.resource.primitive||r.defaultPrimitive),memory:m};case "path":{var z=t=0;switch(h.profile){case "circle":t=10;break;case "quad":t=4;break;default:p.neverReached(h.profile);return}switch(h.join){case "round":z=3;break;case "miter":case "bevel":z=1;break;default:return}n=2*t;z=t*z*2;let k=-2*z-n;switch(h.cap){case "none":break;
case "butt":case "square":k+=2*(t-1);break;case "round":k+=2*(4*t+t);break;default:return}return{primitivesPerFeature:k,primitivesPerCoordinate:z+n,drawCallsPerFeature:0,estimated:!1,memory:m}}case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:m}}}function l(t,h){t="point-3d"===t.type;switch(h.type){case "extrude":return h.edges&&0<h.edges.size?u.EXTRUDE_EDGES:u.EXTRUDE;case "fill":return b.isSome(h.outline)&&0<h.outline.size?
u.FILL_OUTLINE:u.FILL;case "water":return u.FILL;case "line":return"round"===h.join?u.LINE_ROUND:u.LINE_MITER;case "path":switch(h.join){case "round":switch(h.profile){case "circle":return u.PATH_ROUND_CIRCLE;case "quad":return u.PATH_ROUND_QUAD;default:p.neverReached(h.profile);return}case "miter":case "bevel":switch(h.profile){case "circle":return u.PATH_MITER_CIRCLE;case "quad":return u.PATH_MITER_QUAD;default:p.neverReached(h.profile);return}default:return}case "object":return t?u.OBJECT_POINT:
u.OBJECT_POLYGON;case "icon":case "text":return t?u.ICON_POINT:u.ICON_POLYGON}}function g(t){var h=c[t];if(h)return h;h=q.primitiveLodResources(t,null);h={primitivesPerFeature:f.geometriesFromLodLevelResources(h.levels[0]).reduce((m,n)=>m+n.indices.get("position").length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};return c[t]=h}const d={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,
draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},c={},u={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},
OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,
bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,
bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,
draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,
bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,
bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}};a.averageSymbolComplexities=function(t){t=w(t);0<t.numComplexities&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=
t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities);return t};a.defaultSymbolComplexity=function(t){if("web-style"===t.type)return d;const h=t.symbolLayers.toArray().map(m=>e(t,m));return w(h)};a.defaultSymbolLayerComplexity=e;a.defaultSymbolLayerMemoryComplexity=l;a.emptySymbolComplexity=
d;a.memoryEstimators=u;a.totalSymbolComplexities=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil"],function(a,p,b){const r=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(q){switch(q){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};
a.primitiveLodResources=function(q,y){const f=(w,e,l=!1)=>({levels:w.map(g=>{const d=e(g.tesselation);l&&b.cgToGIS(d);return{components:[{geometry:d,material:y}],faceCount:d.indexCount/3,minScreenSpaceRadius:g.minScreenSpaceRadius}})});switch(q){case "sphere":return f([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],w=>b.createPolySphereGeometry(.5,
w,!0));case "cube":return f([{tesselation:0,minScreenSpaceRadius:0}],()=>b.createBoxGeometry(1));case "cone":return f(r,w=>b.createConeGeometry(1,.5,w,!1),!0);case "inverted-cone":return f(r,w=>b.createConeGeometry(1,.5,w,!0),!0);case "cylinder":return f(r,w=>b.createCylinderGeometry(1,.5,w,[0,0,1],[0,0,.5]));case "tetrahedron":return f([{tesselation:0,minScreenSpaceRadius:0}],()=>b.createTetrahedronGeometry(1),!0);case "diamond":return f([{tesselation:0,minScreenSpaceRadius:0}],()=>b.createDiamondGeometry(1),
!0)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils".split(" "),function(a,p,b,r,q,y,f){function w(d,c){if(r.isNone(d))return null;const u=r.isSome(d.color)?y.fromArray(p.toUnitRGBA(d.color)):y.fromValues(0,0,0,0),t=q.pt2px(d.size),h=q.pt2px(d.extensionLength);switch(d.type){case "solid":return e({color:u,
size:t,extensionLength:h,...c});case "sketch":return{...g,color:u,size:t,extensionLength:h,...c,type:"sketch"}}}function e(d){return{...l,...d,type:"solid"}}const l={color:y.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},g={color:y.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2};a.createMaterial=function(d,c){return w(d&&d.enabled&&d.edges||null,c)};a.createMaterialFromEdges=w;a.createSolidEdgeMaterial=e;a.hasEdges=function(d){return d&&
d.enabled&&(f.isExtrudeSymbol3DLayer(d)||f.isFillSymbol3DLayer(d))&&r.isSome(d.edges)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],function(a){a.isExtrudeSymbol3DLayer=function(p){return"extrude"===p.type};a.isFillSymbol3DLayer=function(p){return"fill"===p.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils"],
function(a,p){function b(r){const q=[];r.components.forEach(y=>{q.push(y.geometry)});return p.unique(q)}a.computeFaceCount=function(r){return b(r).reduce((q,y)=>q+y.indexCount/3,0)};a.geometriesFromLodLevelResources=b;a.geometriesFromLodResources=function(r){const q=[];r.levels.forEach(y=>{y.components.forEach(f=>{q.push(f.geometry)})});return p.unique(q)};a.materialsFromLodResources=function(r){const q=[];r.levels.forEach(y=>{y.components.forEach(f=>{q.push(f.material)})});return p.unique(q)};a.texturesFromLodResources=
function(r){const q=[];r.levels.forEach(y=>{y.components.forEach(f=>{f.textures&&q.push(...f.textures)})});return p.unique(q)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){const d=r.create();a.createStageObjectForHUD=function(c,u,t,h,m,n,z,k,v,x){const C=t?t.length:0;var A=c.clippingExtent;q.projectPointToVector(u,d,c.elevationProvider.spatialReference);if(p.isSome(A)&&!y.containsPoint(A,d))return null;q.projectPointToVector(u,d,c.renderCoordsHelper.spatialReference);A=c.localOriginFactory.getOrigin(d);k=new g.Object3D({castShadow:!1,metadata:{layerUid:k,graphicUid:v,usesVerticalDistanceToGround:!0}});for(v=0;v<C;v++)k.addGeometry(t[v],
h[v],m?m[v]:b.IDENTITY,n,A,x);c=e.applyElevationAlignmentForHUD(k,u,c.elevationProvider,c.renderCoordsHelper,z);return{object:k,sampledElevation:c}};a.extendPointGraphicElevationContext=function(c,u,t){c=c.elevationContext;t=t.spatialReference;q.projectPointToVector(u,d,t);c.centerPointInElevationSR=w.makeDehydratedPoint(d[0],d[1],u.hasZ?d[2]:0,t)};a.geometryToRenderInfo=function(c,u,t,h,m){const n=new Float64Array(3*c.length),z=new Float64Array(n.length);c.forEach((k,v)=>{n[3*v]=k[0];n[3*v+1]=k[1];
n[3*v+2]=2<k.length?k[2]:0});u=e.applyPerVertexElevationAlignment(n,u,0,z,0,n,0,n.length/3,t,h,m);return{numVertices:c.length,position:n,mapPosition:z,projectionSuccess:null!=u,sampledElevation:u}};a.placePointOnGeometry=function(c){switch(c.type){case "point":return c;case "polygon":case "extent":return l.computeCentroid(c);case "polyline":var u=c.paths[0];if(!u||0===u.length)break;u=f.getPointOnPath(u,f.getPathLength(u)/2);return w.makeDehydratedPoint(u[0],u[1],u[2],c.spatialReference);case "mesh":return c.origin}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique".split(" "),function(a,p,b,r,q,y,f,w){let e=function(t){function h(n){n=t.call(this,n,g)||this;n.techniqueConfig=new w.LineCalloutTechniqueConfiguration;n._uniqueMaterialIdentifier=
h.uniqueMaterialIdentifier(n.params);return n}p._inheritsLoose(h,t);var m=h.prototype;m.dispose=function(){};m.getGLMaterial=function(n){return 0===n.output?new l(n):void 0};m.getPassParameters=function(){return this.params};m.getTechniqueConfig=function(n,z){this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.depthHudEnabled=
n;this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.multipassGeometryEnabled=z?z.multipassGeometryEnabled:!1;return this.techniqueConfig};m.intersect=function(){};m.createBufferWriter=function(){return new u};m.validateParameterValues=function(n){n=h.uniqueMaterialIdentifier(n);n!==this._uniqueMaterialIdentifier&&
(this._uniqueMaterialIdentifier=n)};h.uniqueMaterialIdentifier=function(n){return JSON.stringify({screenOffset:n.screenOffset||[0,0],centerOffsetUnits:n.centerOffsetUnits||"world"})};p._createClass(h,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return h}(y.Material),l=function(t){function h(n){n=t.call(this,n)||this;n._isRenderSlot=!0;n.updateParameters();return n}p._inheritsLoose(h,t);var m=h.prototype;m.updateParameters=function(n){this._technique=this._techniqueRep.releaseAndAcquire(w.LineCalloutTechnique,
this._material.getTechniqueConfig(!1,n),this._technique);this._depthTechnique=this._techniqueRep.releaseAndAcquire(w.LineCalloutTechnique,this._material.getTechniqueConfig(!0,n),this._depthTechnique)};m.beginSlot=function(n){switch(n){case 21:return this._isRenderSlot=!0;case 22:return this._isRenderSlot=!1,!0}return!1};m.ensureParameters=function(n){this.updateParameters(n)};m.bind=function(n){this.technique.bindPass(this._material.getPassParameters(),n)};p._createClass(h,[{key:"technique",get:function(){return this._isRenderSlot?
this._technique:this._depthTechnique}}]);return h}(q);const g={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1,...y.materialParametersDefaults},d=r.newLayout().vec3f("position").vec3f("normal").vec2f("uv0").vec4f("auxpos1"),c=[b.fromValues(0,0),b.fromValues(1,0),b.fromValues(0,1),b.fromValues(1,0),b.fromValues(1,1),b.fromValues(0,
1)];let u=function(){function t(){this.vertexBufferLayout=d}var h=t.prototype;h.allocate=function(m){return this.vertexBufferLayout.createBuffer(m)};h.elementCount=function(m){return 6*m.indices.get("position").length};h.write=function(m,n,z,k){f.writePosition(n.indices.get("position"),n.vertexAttributes.get("position").data,m.transformation,z.position,k,6);f.writeNormal(n.indices.get("normal"),n.vertexAttributes.get("normal").data,m.invTranspTransformation,z.normal,k,6);f.writeBufferVec4(n.indices.get("auxpos1"),
n.vertexAttributes.get("auxpos1").data,z.auxpos1,k,6);for(m=0;m<c.length;++m)z.uv0.setVec(k+m,c[m])};return t}();a.LineCalloutMaterial=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function p(){return new Float32Array(2)}function b(t){const h=new Float32Array(2);h[0]=t[0];h[1]=t[1];return h}function r(t,h){const m=new Float32Array(2);m[0]=t;m[1]=h;return m}function q(t,h){return new Float32Array(t,h,2)}function y(){return p()}
function f(){return r(1,1)}function w(){return r(1,0)}function e(){return r(0,1)}const l=p(),g=f(),d=w(),c=e();var u=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,createView:q,zeros:y,ones:f,unitX:w,unitY:e,ZEROS:l,ONES:g,UNIT_X:d,UNIT_Y:c});a.ONES=g;a.UNIT_X=d;a.UNIT_Y=c;a.ZEROS=l;a.clone=b;a.create=p;a.createView=q;a.fromValues=r;a.ones=f;a.unitX=w;a.unitY=e;a.vec2f32=u;a.zeros=y})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../materials/internal/MaterialUtil ../../../../chunks/LineCallout.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){g=function(n){function z(){return n.apply(this,arguments)||this}b._inheritsLoose(z,n);var k=z.prototype;k.initializeProgram=function(v){var x=z.shader.get();const C=this.configuration;x=x.build({occlusionTestEnabled:C.occlusionTestEnabled,verticalOffsetEnabled:C.verticalOffset,screenSizePerspectiveEnabled:C.screenSizePerspective,depthHudEnabled:C.depthHudEnabled,depthHudAlignStartEnabled:C.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:C.screenCenterOffsetUnitsEnabled,
slicePlaneEnabled:C.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:v.viewingMode,isDraped:!1,multipassGeometryEnabled:C.multipassGeometryEnabled});return new u.Program(v.rctx,x,c.Default3D)};k.bindPass=function(v,x){e.bindProjectionMatrix(this.program,x.camera.projectionMatrix);h.LineCallout.bindUniforms(this.program,v,x.camera.pixelRatio||1);y.bindVerticalOffsetUniforms(this.program,v,x);f.bindHUDUniforms(this.program,x);this.program.setUniform2fv("cameraNearFar",
x.camera.nearFar);this.program.setUniform2fv("inverseViewport",x.inverseViewport);w.bindMultipassGeometryTexture(this.program,x);this.program.bindTexture(x.hudVisibilityTexture,"hudVisibilityTexture");this.program.setUniform1f("cameraGroundRelative",x.camera.aboveGround?1:-1);this.program.setUniform1f("polygonOffset",v.shaderPolygonOffset);e.bindViewport(this.program,x);this.program.setUniform1f("perDistancePixelRatio",Math.tan(x.camera.fovY/2)/(x.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",
x.camera.viewInverseTransposeMatrix);this.program.setUniform2f("pixelToNDC",2/x.camera.fullViewport[2],2/x.camera.fullViewport[3]);this.program.setUniform1f("lineSize",Math.ceil(v.size)*(x.camera.pixelRatio||1));t.bindScreenSizePerspective(v.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")};k.bindDraw=function(v){e.bindView(this.program,v);e.bindCameraPosition(this.program,v.origin,v.camera.viewInverseTransposeMatrix);q.bindSliceUniformsWithOrigin(this.program,this.configuration,
v);this.program.rebindTextures()};k.setPipelineState=function(v){v=v?519:513;return this.configuration.depthHudEnabled?m.makePipelineState({depthTest:{func:v},depthWrite:m.defaultDepthWriteParams}):m.makePipelineState({blending:m.separateBlendingParams(1,770,771,771),depthTest:{func:v},colorWrite:m.defaultColorWriteParams})};k.initializePipeline=function(){return this.setPipelineState(this.configuration.multipassGeometryEnabled)};return z}(g.ShaderTechnique);g.shader=new l.ReloadableShaderModule(h.LineCalloutShader,
()=>new Promise(function(n,z){a(["./LineCallout.glsl"],n,z)}));l=function(n){function z(){var k=n.apply(this,arguments)||this;k.occlusionTestEnabled=!0;k.verticalOffset=!1;k.screenSizePerspective=!1;k.depthHudEnabled=!1;k.depthHudAlignStartEnabled=!1;k.screenCenterOffsetUnitsEnabled=0;k.slicePlaneEnabled=!1;k.multipassGeometryEnabled=!1;return k}b._inheritsLoose(z,n);return z}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter()],l.prototype,"occlusionTestEnabled",void 0);r.__decorate([d.parameter()],
l.prototype,"verticalOffset",void 0);r.__decorate([d.parameter()],l.prototype,"screenSizePerspective",void 0);r.__decorate([d.parameter()],l.prototype,"depthHudEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"depthHudAlignStartEnabled",void 0);r.__decorate([d.parameter({count:2})],l.prototype,"screenCenterOffsetUnitsEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"slicePlaneEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"multipassGeometryEnabled",void 0);p.LineCalloutTechnique=
g;p.LineCalloutTechniqueConfiguration=l;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f){function w(g){const d=new f.ShaderBuilder;d.include(b.AlignPixel);d.include(r.HUD,g);d.include(p.Slice,g);d.attributes.add("uv0","vec2");d.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2");d.varyings.add("coverageSampling","vec4");d.varyings.add("lineSizes","vec2");g.multipassGeometryEnabled&&d.varyings.add("depth","float");d.vertex.code.add(y.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${g.occlusionTestEnabled?y.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${g.screenSizePerspectiveEnabled?y.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:y.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${g.multipassGeometryEnabled?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${g.depthHudEnabled?g.depthHudAlignStartEnabled?y.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:y.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${g.screenSizePerspectiveEnabled?y.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:y.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);d.fragment.uniforms.add("color","vec4");d.fragment.uniforms.add("borderColor","vec4");g.multipassGeometryEnabled&&(d.fragment.include(q.multipassGeometryTest,g),d.fragment.uniforms.add("inverseViewport","vec2"));d.fragment.code.add(y.glsl`
    void main() {
      ${g.multipassGeometryEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = color.a * borderColor.a * coverage.y;
      float colorAlpha = color.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${g.depthHudEnabled?y.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:y.glsl`
      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you
      // need to divide by finalAlpha). We avoid the division here by setting the
      // appropriate blending function in the material.
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return d}function e(g,d,c){3===c.length?g.setUniform4f(d,c[0],c[1],c[2],1):g.setUniform4fv(d,c)}a.LineCallout=void 0;(function(g){g.bindUniforms=function(d,c,u){e(d,"color",c.color);d.setUniform1f("pixelRatio",u);d.setUniform2f("screenOffset",c.screenOffset[0]*u,c.screenOffset[1]*u);null!==c.borderColor?(e(d,"borderColor",c.borderColor),d.setUniform1f("borderSize",u)):(d.setUniform4f("borderColor",0,0,0,0),d.setUniform1f("borderSize",0))}})(a.LineCallout||(a.LineCallout={}));var l=Object.freeze({__proto__:null,
build:w,get LineCallout(){return a.LineCallout}});a.LineCalloutShader=l;a.build=w})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(function(){return function(a,p,b){this.graphic=a;this.renderingInfo=p;this.layer=b}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,p,b){a.getGraphics3DSymbol=function(r){return r instanceof b?r.graphics3DSymbol:r instanceof p?r:null};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./Loadable ./symbolComplexity".split(" "),function(a,p,b,r,q,y,f,w,e){const l={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(g){function d(u,t,h){var m=g.call(this,t.schedule)||
this;m._symbol=u;m._context=t;m._backgroundLayers=h;m._destroyed=!1;m.symbolLayers=[];m.referenced=0;m._extentPadding=0;return m}a._inheritsLoose(d,g);var c=d.prototype;c.doLoad=function(){var u=a._asyncToGenerator(function*(t){var h=this;let m=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(m=this._backgroundLayers.concat(m));const n=m.length;for(;this.symbolLayers.length<m.length;)this.symbolLayers.push(null);this.symbolLayers.length=m.length;const z=[];for(let k=0;k<n;k++){const v=
m.getItemAt(k);if(!1===v.enabled)continue;l.renderPriority=1-(1+k)/n;l.renderPriorityStep=1/n;l.ignoreDrivers=v._ignoreDrivers;const x=f.make(this.symbol,v,this._context,l);z.push(r.onAbortOrThrow(t,()=>{this.symbolLayers[k]=null;x.destroy()}));this.symbolLayers[k]=x}yield p.forEach(this.symbolLayers,function(){var k=a._asyncToGenerator(function*(v,x){if(b.isSome(v))try{yield v.load(),h._extentPadding+=Math.max(h._extentPadding,v.extentPadding)}catch{h.symbolLayers[x]=null}});return function(v,x){return k.apply(this,
arguments)}}());for(const k of z)null==k?void 0:k.remove();z.length=0;r.throwIfAborted(t);if(this.symbolLayers.length&&!this.symbolLayers.some(k=>!!k))throw Error();});return function(t){return u.apply(this,arguments)}}();c.getSymbolLayerSize=function(u){u=this.symbolLayers[u];return b.isSome(u)?u.getCachedSize():null};c.createGraphics3DGraphic=function(u,t){const h=u.graphic,m=Array(this.symbolLayers.length);for(let n=0;n<this.symbolLayers.length;n++){const z=this.symbolLayers[n];m[n]=b.isSome(z)?
z.createGraphics3DGraphic(u):null}return new q(h,t||this,m,u.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};c.globalPropertyChanged=function(u,t){const h=this.symbolLayers.length;for(let m=0;m<h;m++){const n=this.symbolLayers[m],z=k=>{k=k.graphics[m];return k instanceof y.Graphics3DObject3DGraphicLayer?k:null};if(b.isSome(n)&&!n.globalPropertyChanged(u,t,z))return!1}return!0};
c.applyRendererDiff=function(u,t){return 1!==this.loadStatus?!1:this.symbolLayers.reduce((h,m)=>h&&(b.isNone(m)||m.applyRendererDiff(u,t)),!0)};c.prepareSymbolPatch=function(u){if(2!==this.loadStatus&&"partial"===u.diff.type){var t=u.diff.diff;if(t.symbolLayers&&"partial"===t.symbolLayers.type){var h=t.symbolLayers.diff;this.symbolLayers.forEach((m,n)=>{if(!b.isNone(m)){var z=h[n];if(z){const k={diff:z,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};m.prepareSymbolLayerPatch(k);u.symbolStatePatches.push(...k.symbolLayerStatePatches);
k.graphics3DGraphicPatches.length&&u.graphics3DGraphicPatches.push((v,x)=>{const C=v.graphics[n];b.isSome(C)&&k.graphics3DGraphicPatches.forEach(A=>A(C,x))})}}})}}};c.updateGeometry=function(u,t){for(let h=0;h<this.symbolLayers.length;h++){const m=this.symbolLayers[h];if(b.isNone(m))continue;const n=u.graphics[h];if(b.isNone(n)||!m.updateGeometry(n,t))return!1}return!0};c.onRemoveGraphic=function(u){for(let t=0;t<this.symbolLayers.length;t++){const h=this.symbolLayers[t];if(b.isNone(h))continue;const m=
u.graphics[t];if(b.isSome(m))h.onRemoveGraphic(m)}};c.getFastUpdateStatus=function(){let u=0,t=0,h=0;this.symbolLayers.forEach(m=>{b.isNone(m)||(0===m.loadStatus?u++:m.isFastUpdatesEnabled()?h++:t++)});return{loading:u,slow:t,fast:h}};c.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(const u of this.symbolLayers)b.isSome(u)&&u.destroy();this.symbolLayers.length=0;this._destroyed=!0}};a._createClass(d,[{key:"symbol",
get:function(){return this._symbol},set:function(u){this._symbol=u;if(this.symbolLayers)for(let t=0;t<u.symbolLayers.length;t++){const h=this.symbolLayers[t];b.isNone(h)||(h.symbol=u,h.symbolLayer=u.symbolLayers.items[t])}}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"complexity",get:function(){return e.totalSymbolComplexities(this.symbolLayers.map(u=>b.get(u,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return d}(w.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/maybe ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./featureExpressionInfoUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){const m=new q(Array,z=>d.set(z,d.ZERO),null,10,5),n=c.create();return function(){function z(v,x,C,A,B){this.graphic=v;this.graphics3DSymbol=x;this.graphics=C;this._labelGraphics=[];this._auxiliaryGraphics=[];var D=Array(2);for(let E=0;E<D.length;E++)D[E]=Array(4);this._visibilityFlags=D;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;this.isElevationSource=!1;++x.referenced;this._featureExpressionFeature=
B?h.createFeature(B,v,A):null;for(const E of C)r.isSome(E)&&(this.isElevationSource=this.isElevationSource||E.isElevationSource)}var k=z.prototype;k.initialize=function(v,x,C){this._layer=x;this._stage=v;this.forEachSymbolLayerGraphic(A=>{A.initialize(v,x,C);A.setVisibility(this.isVisible())})};k.destroy=function(){this.forEachSymbolLayerGraphic(v=>v.destroy());this._auxiliaryGraphics=this.graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};k.clearLabelGraphics=function(){this.forEachLabelGraphic(v=>
v.destroy());this._labelGraphics.length=0};k.addLabelGraphic=function(v,x,C){this._labelGraphics.push(v);v.initialize(x,C);v.setVisibility(this.isVisible(1))};k.addAuxiliaryGraphic=function(v){this._auxiliaryGraphics.push(v);this._layer&&(v.initialize(this._stage,this._layer),v.setVisibility(this.isVisible()))};k.isVisible=function(v=0,x){for(let C=0;C<=v;C++){const A=this._visibilityFlags[C];for(let B=0;B<A.length;++B)if(!1===A[B]&&B!==x)return!1}return!0};k.hasVisibilityFlag=function(v,x){return null!=
this._visibilityFlags[x][v]};k.setVisibilityFlag=function(v,x,C){const A=this.isVisible(C);this._visibilityFlags[C][v]=x;const B=this.isVisible(C);if(A===B)return!1;if(1===C)this.forEachLabelGraphic(D=>D.setVisibility(B));else{this.forEachSymbolLayerGraphic(E=>E.setVisibility(B));const D=this.isVisible(1);this.forEachLabelGraphic(E=>E.setVisibility(D))}return!0};k.clearVisibilityFlag=function(v,x=0){return this.setVisibilityFlag(v,void 0,x)};k.computeExtent=function(v){if(!this._extent){var x=this.graphic.geometry;
if(r.isNone(x))return!1;this._extent=c.create();u.computeAABR(x,this._extent);x=x.spatialReference;if(!x.equals(v)&&!g.projectBoundingRect(this._extent,x,this._extent,v))return this._extent=null,!1}return!0};k.getAsOptimizedGeometry=function(v,x){if(r.isSome(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===v&&this._optimizedGeometry.hasM===x)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,v,x);this._optimizedGeometry.hasZ=
v;this._optimizedGeometry.hasM=x;return this._optimizedGeometry.geometry};k._convertGraphicToOptimizedGeometry=function(v,x,C){v=v.geometry;if("mesh"===v.type||"extent"===v.type)v=l.fromExtent("mesh"===v.type?v.extent:v);return t.convertFromGeometry(v,x,C)};k.computeAttachmentOrigin=function(){const v={render:{origin:e.create(),num:0},draped:{origin:f.create(),num:0}};for(const x of this.graphics)r.isNone(x)||x.computeAttachmentOrigin(v);v.render.num&&w.scale(v.render.origin,v.render.origin,1/v.render.num);
v.draped.num&&y.scale(v.draped.origin,v.draped.origin,1/v.draped.num);return v};k.getProjectedBoundingBox=function(){var v=a._asyncToGenerator(function*(x,C,A,B,D){D||(D={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});D.boundingBox?d.empty(D.boundingBox):D.boundingBox=d.empty();D.requiresDrapedElevation=!1;yield p.forEach(this.graphics,function(){var E=a._asyncToGenerator(function*(G){if(!r.isNone(G)){var K="draped"===G.type?C:x,M=m.acquire();G=yield G.getProjectedBoundingBox(K,
A,D.screenSpaceObjects,B,M);isFinite(G[2])&&isFinite(G[5])||(D.requiresDrapedElevation=!0);G&&d.expandWithAABB(D.boundingBox,M);m.release(M)}});return function(G){return E.apply(this,arguments)}}());return d.allFinite(D.boundingBox)||c.allFinite(d.toRect(D.boundingBox,n))?D:null});return function(x,C,A,B,D){return v.apply(this,arguments)}}();k.needsElevationUpdates=function(){for(const v of this.graphics)if(r.isSome(v)&&("object3d"===v.type||"lod-instance"===v.type)&&v.needsElevationUpdates)return!0;
for(const v of this._labelGraphics)if(v&&v.needsElevationUpdates)return!0;return!1};k.alignWithElevation=function(v,x,C){this.forEachRenderedGraphic(A=>{"object3d"!==A.type&&"lod-instance"!==A.type||A.alignWithElevation(v,x,this._featureExpressionFeature,C)})};k.addObjectStateSet=function(v,x){this.forEachSymbolLayerGraphic(C=>C.addObjectState(v,x))};k.removeObjectState=function(v){this.forEachSymbolLayerGraphic(x=>x.removeObjectState(v))};k.forEachGraphicList=function(v,x){v.forEach(C=>C&&x(C))};
k.forEachSymbolLayerGraphic=function(v){this.forEachGraphicList(this.graphics,v);this.forEachGraphicList(this._auxiliaryGraphics,v)};k.forEachLabelGraphic=function(v){this.forEachGraphicList(this._labelGraphics,v)};k.forEachRenderedGraphic=function(v){this.forEachSymbolLayerGraphic(v);this.forEachLabelGraphic(v)};a._createClass(z,[{key:"labelGraphics",get:function(){return this._labelGraphics}},{key:"extent",get:function(){return this._extent}},{key:"destroyed",get:function(){return null==this.graphics}},
{key:"isDraped",get:function(){let v=!1;this.forEachSymbolLayerGraphic(x=>{"draped"===x.type&&(v=!0)});return v}},{key:"usedMemory",get:function(){let v=b.estimateAttributesObjectSize(this.graphic.attributes);this.forEachSymbolLayerGraphic(x=>{const C=x.graphics3DSymbolLayer.complexity;r.isNone(C)||(x="draped"===x.type?C.memory.draped:C.memory,v+=x.bytesPerFeature,x.bytesPerCoordinate&&(v+=u.numVertices(this.graphic.geometry)*x.bytesPerCoordinate))});return v}}]);return z}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){const d=p.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory"),c={icon:r.Graphics3DIconSymbolLayer,object:f.Graphics3DObjectSymbolLayer,line:q.Graphics3DLineSymbolLayer,path:w.Graphics3DPathSymbolLayer,fill:e.Graphics3DPolygonFillSymbolLayer,extrude:b.Graphics3DExtrudeSymbolLayer,text:l.Graphics3DTextSymbolLayer,water:g.Graphics3DWaterSymbolLayer},u={"mesh-3d":{fill:y.Graphics3DMeshFillSymbolLayer}};a.make=function(t,h,m,n){const z=u[t.type]&&u[t.type][h.type]||
c[h.type];return z?new z(t,h,m,n):(d.error("GraphicsLayerFactory#make",`unknown symbol type ${h.type}`),null)};a.setSymbolClass=function(t,h){c[t]=h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../renderers/support/renderingInfoUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G){function K(ha,fa,aa,W,U,X,T,Y,ea,ia,la,pa,ua,wa){let Fa=0;var La=2*W.count;{var Ma=W.index,Sa=W.count,Ia=aa.length/3,va=ea;l.copy(V,ua);const ma=0<pa?1:-1;Ma*=3;let ta=va;ua=3*ta;let Ea=va+Sa;va=3*Ea;for(let Ca=0;Ca<Sa;++Ca)wa&&(V[0]=ha[Ma+0],V[1]=ha[Ma+1],V[2]=ha[Ma+2],l.normalize(V,V)),U[ua+0]=ha[Ma+0],U[ua+1]=ha[Ma+1],U[ua+2]=ha[Ma+2],X[ua+0]=fa[Ma+0],X[ua+1]=fa[Ma+1],X[ua+2]=fa[Ma+2],T[ua+0]=-ma*V[0],T[ua+1]=-ma*V[1],T[ua+2]=-ma*
V[2],Y[ta]=0,U[va+0]=ha[Ma+0]+pa*V[0],U[va+1]=ha[Ma+1]+pa*V[1],U[va+2]=ha[Ma+2]+pa*V[2],X[va+0]=fa[Ma+0],X[va+1]=fa[Ma+1],X[va+2]=fa[Ma+2],T[va+0]=ma*V[0],T[va+1]=ma*V[1],T[va+2]=ma*V[2],Y[Ea]=pa,ua+=3,va+=3,Ma+=3,ta+=1,Ea+=1;ua=Ma=0;va=3*La;ha=0>pa?ba:ca;fa=0>pa?ca:ba;for(wa=0;wa<Ia;++wa)la[ua+0]=aa[Ma+ha[0]],la[ua+1]=aa[Ma+ha[1]],la[ua+2]=aa[Ma+ha[2]],ia[va+0]=aa[Ma+fa[0]]+Sa,ia[va+1]=aa[Ma+fa[1]]+Sa,ia[va+2]=aa[Ma+fa[2]]+Sa,ua+=3,va+=3,Ma+=3}ea+=2*W.count;La=0;H(U,X,Y,T,Fa,W.pathLengths[0],W.count,
ea,ia,La,pa);ea+=4*W.pathLengths[0];La+=2*W.pathLengths[0];Fa+=W.pathLengths[0];for(aa=1;aa<W.pathLengths.length;++aa)H(U,X,Y,T,Fa,W.pathLengths[aa],W.count,ea,ia,La,pa),ea+=4*W.pathLengths[aa],La+=2*W.pathLengths[aa],Fa+=W.pathLengths[aa]}function M(ha,fa,aa,W,U,X,T){W[X]=W[T];T*=3;X*=3;ha[X+0]=ha[T+0];ha[X+1]=ha[T+1];ha[X+2]=ha[T+2];fa[X+0]=fa[T+0];fa[X+1]=fa[T+1];fa[X+2]=fa[T+2];aa[X+0]=U[0];aa[X+1]=U[1];aa[X+2]=U[2]}function H(ha,fa,aa,W,U,X,T,Y,ea,ia,la){let pa=U,ua=U+1,wa=U+T,Fa=U+T+1,La=Y,
Ma=Y+1,Sa=Y+2*X;Y=Y+2*X+1;0>la&&(pa=U+T+1,Fa=U);ia*=3;for(let Ca=0;Ca<X;++Ca){Ca===X-1&&(0<la?(ua=U,Fa=U+T):(ua=U,pa=U+T));var Ia=ha,va=pa,ma=ua,ta=wa,Ea=I;va*=3;ma*=3;ta*=3;l.set(F,Ia[va++],Ia[va++],Ia[va++]);l.set(L,Ia[ma++],Ia[ma++],Ia[ma++]);l.set(N,Ia[ta++],Ia[ta++],Ia[ta++]);l.subtract(R,L,F);l.subtract(S,N,F);l.cross(Ea,S,R);l.normalize(Ea,Ea);M(ha,fa,W,aa,I,La,pa);M(ha,fa,W,aa,I,Ma,ua);M(ha,fa,W,aa,I,Sa,wa);M(ha,fa,W,aa,I,Y,Fa);ea[ia++]=La;ea[ia++]=Sa;ea[ia++]=Y;ea[ia++]=La;ea[ia++]=Y;ea[ia++]=
Ma;pa++;ua++;wa++;Fa++;La+=2;Ma+=2;Sa+=2;Y+=2}}function J(ha,fa,aa,W){ha=ha.stageObject;const U=ha.geometryRecords,X=U.length,T="absolute-height"!==fa.mode;let Y=0;const ea=ha.transformation,ia=w.invert(e.create(),ea);for(let ua=0;ua<X;ua+=2){const wa=U[ua].geometry,Fa=wa.getMutableAttribute("position").data,La=wa.vertexAttributes.get("size").data;var la=wa.vertexAttributes.get("mapPos").data;la=new B.SamplePosition(la);const Ma=Fa.length/3;let Sa=0,Ia=!1,va=0;const ma=aa.spatialReference;for(let ta=
0;ta<Ma;ta++){P[0]=Fa[Sa];P[1]=Fa[Sa+1];P[2]=Fa[Sa+2];var pa=m.evaluateElevationAlignmentAtPoint(la,aa,fa,W,T?Z:null);T&&(va+=Z.sampledElevation);A.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(l.set(Q,la.array[la.offset+0],la.array[la.offset+1],pa+La[Sa/3]),W.toRenderCoords(Q,ma,Q)):(l.set(Q,Fa[Sa+0],Fa[Sa+1],Fa[Sa+2]),l.transformMat4(Q,Q,ea),W.setAltitude(Q,pa+La[Sa/3]));l.transformMat4(Q,Q,ia);Fa[Sa]=Q[0];Fa[Sa+1]=Q[1];Fa[Sa+2]=Q[2];pa=.01/W.unitInMeters;if(Math.abs(P[0]-Fa[Sa])>=pa||Math.abs(P[1]-
Fa[Sa+1])>=pa||Math.abs(P[2]-Fa[Sa+2])>=pa)Ia=!0;la.offset+=3;Sa+=3}Ia&&(wa.invalidateBoundingInfo(),ha.geometryVertexAttrsUpdated(ua),U[ua+1].geometry.invalidateBoundingInfo(),ha.geometryVertexAttrsUpdated(ua+1));Y+=va/Ma}return Y/X}const O=["polygon","extent"];k=function(ha){function fa(W,U,X,T){W=ha.call(this,W,U,X,T)||this;W.ensureDrapedStatus(!1);return W}p._inheritsLoose(fa,ha);var aa=fa.prototype;aa.doLoad=function(){var W=p._asyncToGenerator(function*(){if(!this._drivenProperties.size){var U=
v.validateSymbolLayerSize(this._getSymbolSize());if(U)throw new b("graphics3dextrudesymbollayer:invalid-size",U);}U=r.get(this.symbolLayer,"material","color");var X=this._getCombinedOpacityAndColor(U);U=g.fromArray(X);X=X[3];const T=1>X||this.needsDrivenTransparentPass;U={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:U,ambient:U,opacity:X,transparent:T,cullFace:T?0:2,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,
offsetTransparentBackfaces:!0};this._material=new G.DefaultMaterial(U);this._bottomMaterial=new G.DefaultMaterial({...U,cullFace:2});this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)});return function(){return W.apply(this,arguments)}}();aa.destroy=function(){ha.prototype.destroy.call(this);this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))};aa.createGraphics3DGraphic=function(W){const U=W.graphic;if(!this._validateGeometry(U.geometry,
O,this.symbolLayer.type))return null;const X=this._getVertexOpacityAndColor(W.renderingInfo,255),T=this.setGraphicElevationContext(U,new n.ElevationContext);return this._createAs3DShape(U,W.renderingInfo,X,T,U.uid)};aa.layerOpacityChanged=function(W,U){var X=r.get(this.symbolLayer,"material","color");X=this._getCombinedOpacity(X);const T=1>X||this.needsDrivenTransparentPass;this._material.setParameterValues({opacity:X,transparent:T});this._bottomMaterial.setParameterValues({opacity:X,transparent:T});
const Y=this._getLayerOpacity();W.forEach(ea=>{ea=U(ea);r.isSome(ea)&&ea.layerOpacityChanged(Y,this._context.isAsync)});return!0};aa.layerElevationInfoChanged=function(W,U){return this.updateGraphics3DGraphicElevationInfo(W,U,m.needsElevationUpdates3D)};aa.slicePlaneEnabledChanged=function(W,U){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._bottomMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});W.forEach(X=>{X=U(X);r.isSome(X)&&
X.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};aa.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._bottomMaterial.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};aa.pixelRatioChanged=function(){return!0};aa._getExtrusionSize=function(W){if(W.size&&this._drivenProperties.size){var U;W=null!=(U=h.getDriverAxisSizeValue(W.size,
2))?U:0}else W=this._getSymbolSize();return W/=this._context.renderCoordsHelper.unitInMeters};aa._getSymbolSize=function(){var W;return null!=(W=this.symbolLayer.size)?W:1};aa._createAs3DShape=function(W,U,X,T,Y){var ea=x.geometryAsPolygon(W.geometry);if(r.isNone(ea))return null;W=x.geometryToRenderInfo(ea,this._context.elevationProvider,this._context.renderCoordsHelper,T);this._logGeometryCreationWarnings(W,ea.rings,"rings","ExtrudeSymbol3DLayer");if(0===ea.rings.length||!ea.rings.some(ra=>0<ra.length))return null;
var ia=v.computeCentroid(ea);if(r.isNone(ia))return null;var la=[];const pa=[],ua=[],wa=c.create(),Fa=e.create(),La=g.create(),Ma=1===this._context.renderCoordsHelper.viewingMode;Ma||this._context.renderCoordsHelper.worldUpAtPosition(null,La);d.computeTranslationToOriginAndRotation(ea.spatialReference,[ia.x,ia.y,0],Fa,this._context.renderCoordsHelper.spatialReference);ea=e.create();w.invert(ea,Fa);ia=f.create();y.normalFromMat4(ia,ea);const {polygons:Sa,mapPosition:Ia,position:va}=W;var ma=va.length/
3;const ta=new Float64Array(18*ma),Ea=new Float64Array(18*ma),Ca=new Float64Array(18*ma);ma=new Float64Array(6*ma);let ka=0;for(let ra=0;ra<Sa.length;++ra){var sa=Sa[ra];const Da=sa.count;if(this._context.clippingExtent&&(c.empty(wa),c.expandWithBuffer(wa,sa.mapPosition),!c.intersectsClippingArea(wa,this._context.clippingExtent)))continue;const Pa=q.earcut(sa.mapPosition,sa.holeIndices,3);if(0===Pa.length)continue;const Qa=new Uint32Array(6*Da+Pa.length);var Ja=new Uint32Array(Pa.length),Ta=6*Da,
da=3*ta.BYTES_PER_ELEMENT;da=new u.BufferViewVec3f64(ta.buffer,ka*da,da,(ka+Ta)*da);var qa=3*Ea.BYTES_PER_ELEMENT;qa=new u.BufferViewVec3f64(Ea.buffer,ka*qa,qa,(ka+Ta)*qa);const na=new Float64Array(Ca.buffer,3*ka*Ca.BYTES_PER_ELEMENT,3*Ta);Ta=new Float64Array(ma.buffer,1*ka*ma.BYTES_PER_ELEMENT,1*Ta);const Aa=this._getExtrusionSize(U);K(va,Ia,Pa,sa,da.typedBuffer,na,qa.typedBuffer,Ta,0,Qa,Ja,Aa,La,Ma);t.transformMat4(da,da,ea);t.transformMat3(qa,qa,ia);ka+=6*Da;sa=this._createExtrudeGeometry(Qa,Qa.length-
Ja.length,{positions:da.typedBuffer,elevation:na,normals:qa.typedBuffer,heights:Ta},X);la.push(sa);pa.push(this._material);ua.push(e.IDENTITY);Ja=this._createExtrudeGeometry(Ja,0,{positions:da.typedBuffer,elevation:na,normals:qa.typedBuffer,heights:Ta},X);la.push(Ja);pa.push(this._bottomMaterial);ua.push(e.IDENTITY)}if(0===la.length)return null;U=new E.Object3D({geometries:la,materials:pa,transformations:ua,metadata:{layerUid:this._context.layer.uid,graphicUid:Y,isElevationSource:!0}});U.transformation=
Fa;X=C.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});X=r.isSome(X)?{baseMaterial:this._material,edgeMaterials:[X],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;la=new z.Graphics3DObject3DGraphicLayer(this,U,la,null,null,J,T,X);la.alignedSampledElevation=W.sampledElevation;la.needsElevationUpdates=m.needsElevationUpdates3D(T.mode);return la};aa._createExtrudeGeometry=function(W,U,X,T){var Y=new Uint32Array(W.length);T=[["position",{size:3,
data:X.positions,exclusive:!0}],["normal",{size:3,data:X.normals,exclusive:!0}],["color",{size:4,data:T,exclusive:!0}],["size",{size:1,data:X.heights,exclusive:!0}]];Y=[["position",W],["normal",W],["color",Y]];X.elevation&&(T.push(["mapPos",{size:3,data:X.elevation}]),Y.push(["mapPos",W]));return new D.Geometry(T,Y,0,U)};return fa}(k.Graphics3DSymbolLayer);const I=g.create(),F=g.create(),L=g.create(),N=g.create(),R=g.create(),S=g.create(),P=g.create(),Q=g.create(),V=g.create(),ca=[0,2,1],ba=[0,1,
2],Z={verticalDistanceToGround:0,sampledElevation:0};a.Graphics3DExtrudeSymbolLayer=k;a["default"]=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/earcut":function(){define(["exports"],function(a){var p={exports:{}};(function(b){(function(r){r=r();void 0!==r&&(b.exports=r)})(function(){function r(E,G,K){K=K||2;var M=G&&G.length,H=M?G[0]*K:E.length,J=q(E,0,H,K,!0),O=[];if(!J||J.next===J.prev)return O;var I;if(M){var F=J;var L=K;J=[];var N;M=0;for(N=G.length;M<N;M++){var R=G[M]*L;
var S=M<N-1?G[M+1]*L:E.length;R=q(E,R,S,L,!1);R===R.next&&(R.steiner=!0);J.push(u(R))}J.sort(e);for(M=0;M<J.length;M++)L=J[M],G=F,(F=g(L,G))?(N=x(F,L),L=y(F,F.next),N=l(N),y(N,N.next),L=l(L),F=l(G===F?L:G)):F=G,F=y(F,F.next);J=F}if(E.length>80*K){var P=I=E[0];var Q=M=E[1];for(L=K;L<H;L+=K)G=E[L],F=E[L+1],G<P&&(P=G),F<Q&&(Q=F),G>I&&(I=G),F>M&&(M=F);I=Math.max(I-P,M-Q);I=0!==I?1/I:0}f(J,O,K,P,Q,I);return O}function q(E,G,K,M,H){if(H===0<D(E,G,K,M))for(H=G;H<K;H+=M)var J=C(H,E[H],E[H+1],J);else for(H=
K-M;H>=G;H-=M)J=C(H,E[H],E[H+1],J);J&&m(J,J.next)&&(E=J.next,A(J),J=E);return J}function y(E,G){if(!E)return E;G||(G=E);do{var K=!1;if(E.steiner||!m(E,E.next)&&0!==h(E.prev,E,E.next))E=E.next;else{G=E.prev;A(E);E=G;if(E===E.next)break;K=!0}}while(K||E!==G);return G}function f(E,G,K,M,H,J,O){if(E){!O&&J&&d(E,M,H,J);for(var I=E,F,L;E.prev!==E.next;){F=E.prev;L=E.next;if(J)var N=w(E,M,H,J);else a:{N=E;var R=N.prev,S=N,P=N.next;if(0<=h(R,S,P))N=!1;else{for(var Q=N.next.next;Q!==N.prev;){if(t(R.x,R.y,
S.x,S.y,P.x,P.y,Q.x,Q.y)&&0<=h(Q.prev,Q,Q.next)){N=!1;break a}Q=Q.next}N=!0}}if(N)G.push(F.i/K),G.push(E.i/K),G.push(L.i/K),A(E),I=E=L.next;else if(E=L,E===I){if(!O)f(y(E),G,K,M,H,J,1);else if(1===O){E=y(E);O=G;I=K;F=E;do L=F.prev,N=F.next.next,!m(L,N)&&n(L,F,F.next,N)&&v(L,N)&&v(N,L)&&(O.push(L.i/I),O.push(F.i/I),O.push(N.i/I),A(F),A(F.next),F=E=N),F=F.next;while(F!==E);E=y(F);f(E,G,K,M,H,J,2)}else if(2===O)a:{O=E;do{for(I=O.next.next;I!==O.prev;){if(F=O.i!==I.i){N=N=N=N=void 0;F=O;L=I;if(N=F.next.i!==
L.i&&F.prev.i!==L.i){b:{N=F;do{if(N.i!==F.i&&N.next.i!==F.i&&N.i!==L.i&&N.next.i!==L.i&&n(N,N.next,F,L)){N=!0;break b}N=N.next}while(N!==F);N=!1}N=!N}if(N){if(N=v(F,L)&&v(L,F)){N=F;R=!1;S=(F.x+L.x)/2;P=(F.y+L.y)/2;do N.y>P!==N.next.y>P&&N.next.y!==N.y&&S<(N.next.x-N.x)*(P-N.y)/(N.next.y-N.y)+N.x&&(R=!R),N=N.next;while(N!==F);N=R}N=N&&(h(F.prev,F,L.prev)||h(F,L.prev,L))||m(F,L)&&0<h(F.prev,F,F.next)&&0<h(L.prev,L,L.next)}F=N}if(F){E=x(O,I);O=y(O,O.next);E=y(E,E.next);f(O,G,K,M,H,J);f(E,G,K,M,H,J);
break a}I=I.next}O=O.next}while(O!==E)}break}}}}function w(E,G,K,M){var H=E.prev,J=E.next;if(0<=h(H,E,J))return!1;var O=H.x>E.x?H.x>J.x?H.x:J.x:E.x>J.x?E.x:J.x,I=H.y>E.y?H.y>J.y?H.y:J.y:E.y>J.y?E.y:J.y,F=c(H.x<E.x?H.x<J.x?H.x:J.x:E.x<J.x?E.x:J.x,H.y<E.y?H.y<J.y?H.y:J.y:E.y<J.y?E.y:J.y,G,K,M);G=c(O,I,G,K,M);K=E.prevZ;for(M=E.nextZ;K&&K.z>=F&&M&&M.z<=G;){if(K!==E.prev&&K!==E.next&&t(H.x,H.y,E.x,E.y,J.x,J.y,K.x,K.y)&&0<=h(K.prev,K,K.next))return!1;K=K.prevZ;if(M!==E.prev&&M!==E.next&&t(H.x,H.y,E.x,E.y,
J.x,J.y,M.x,M.y)&&0<=h(M.prev,M,M.next))return!1;M=M.nextZ}for(;K&&K.z>=F;){if(K!==E.prev&&K!==E.next&&t(H.x,H.y,E.x,E.y,J.x,J.y,K.x,K.y)&&0<=h(K.prev,K,K.next))return!1;K=K.prevZ}for(;M&&M.z<=G;){if(M!==E.prev&&M!==E.next&&t(H.x,H.y,E.x,E.y,J.x,J.y,M.x,M.y)&&0<=h(M.prev,M,M.next))return!1;M=M.nextZ}return!0}function e(E,G){return E.x-G.x}function l(E){if(E.next.prev===E)return E;let G=E;do{const K=G.next;if(K.prev===G||K===G||K===E)break;G=K}while(1);return G}function g(E,G){var K=G,M=E.x,H=E.y,
J=-Infinity;do{if(H<=K.y&&H>=K.next.y&&K.next.y!==K.y){var O=K.x+(H-K.y)*(K.next.x-K.x)/(K.next.y-K.y);if(O<=M&&O>J){J=O;if(O===M){if(H===K.y)return K;if(H===K.next.y)return K.next}var I=K.x<K.next.x?K:K.next}}K=K.next}while(K!==G);if(!I)return null;if(M===J)return I;G=I;O=I.x;var F=I.y,L=Infinity;K=I;do{if(M>=K.x&&K.x>=O&&M!==K.x&&t(H<F?M:J,H,O,F,H<F?J:M,H,K.x,K.y)){var N=Math.abs(H-K.y)/(M-K.x);var R;if((R=v(K,E))&&!(R=N<L)&&(R=N===L)&&!(R=K.x>I.x)&&(R=K.x===I.x)){R=I;var S=K;R=0>h(R.prev,R,S.prev)&&
0>h(S.next,R,R.next)}R&&(I=K,L=N)}K=K.next}while(K!==G);return I}function d(E,G,K,M){var H=E;do{null===H.z&&(H.z=c(H.x,H.y,G,K,M));if(H.prev.next!==H||H.next.prev!==H)return H.prev.next=H,H.next.prev=H,d(E,G,K,M);H.prevZ=H.prev;H=H.nextZ=H.next}while(H!==E);H.prevZ.nextZ=null;H.prevZ=null;E=H;var J,O,I,F=1;do{G=E;M=E=null;for(H=0;G;){H++;K=G;for(J=O=0;J<F&&(O++,K=K.nextZ,K);J++);for(I=F;0<O||0<I&&K;)0!==O&&(0===I||!K||G.z<=K.z)?(J=G,G=G.nextZ,O--):(J=K,K=K.nextZ,I--),M?M.nextZ=J:E=J,J.prevZ=M,M=J;
G=K}M.nextZ=null;F*=2}while(1<H)}function c(E,G,K,M,H){E=32767*(E-K)*H;G=32767*(G-M)*H;E=(E|E<<8)&16711935;E=(E|E<<4)&252645135;E=(E|E<<2)&858993459;G=(G|G<<8)&16711935;G=(G|G<<4)&252645135;G=(G|G<<2)&858993459;return(E|E<<1)&1431655765|((G|G<<1)&1431655765)<<1}function u(E){var G=E,K=E;do{if(G.x<K.x||G.x===K.x&&G.y<K.y)K=G;G=G.next}while(G!==E);return K}function t(E,G,K,M,H,J,O,I){return 0<=(H-O)*(G-I)-(E-O)*(J-I)&&0<=(E-O)*(M-I)-(K-O)*(G-I)&&0<=(K-O)*(J-I)-(H-O)*(M-I)}function h(E,G,K){return(G.y-
E.y)*(K.x-G.x)-(G.x-E.x)*(K.y-G.y)}function m(E,G){return E.x===G.x&&E.y===G.y}function n(E,G,K,M){var H=k(h(E,G,K)),J=k(h(E,G,M)),O=k(h(K,M,E)),I=k(h(K,M,G));return H!==J&&O!==I||0===H&&z(E,K,G)||0===J&&z(E,M,G)||0===O&&z(K,E,M)||0===I&&z(K,G,M)?!0:!1}function z(E,G,K){return G.x<=Math.max(E.x,K.x)&&G.x>=Math.min(E.x,K.x)&&G.y<=Math.max(E.y,K.y)&&G.y>=Math.min(E.y,K.y)}function k(E){return 0<E?1:0>E?-1:0}function v(E,G){return 0>h(E.prev,E,E.next)?0<=h(E,G,E.next)&&0<=h(E,E.prev,G):0>h(E,G,E.prev)||
0>h(E,E.next,G)}function x(E,G){var K=new B(E.i,E.x,E.y),M=new B(G.i,G.x,G.y),H=E.next,J=G.prev;E.next=G;G.prev=E;K.next=H;H.prev=K;M.next=K;K.prev=M;J.next=M;M.prev=J;return M}function C(E,G,K,M){E=new B(E,G,K);M?(E.next=M.next,E.prev=M,M.next.prev=E,M.next=E):(E.prev=E,E.next=E);return E}function A(E){E.next.prev=E.prev;E.prev.next=E.next;E.prevZ&&(E.prevZ.nextZ=E.nextZ);E.nextZ&&(E.nextZ.prevZ=E.prevZ)}function B(E,G,K){this.i=E;this.x=G;this.y=K;this.nextZ=this.prevZ=this.z=this.next=this.prev=
null;this.steiner=!1}function D(E,G,K,M){for(var H=0,J=K-M;G<K;G+=M)H+=(E[J]-E[G])*(E[G+1]+E[J+1]),J=G;return H}r.deviation=function(E,G,K,M){var H=G&&G.length,J=Math.abs(D(E,0,H?G[0]*K:E.length,K));if(H){H=0;for(var O=G.length;H<O;H++)J-=Math.abs(D(E,G[H]*K,H<O-1?G[H+1]*K:E.length,K))}for(H=G=0;H<M.length;H+=3){O=M[H]*K;var I=M[H+1]*K,F=M[H+2]*K;G+=Math.abs((E[O]-E[F])*(E[I+1]-E[O+1])-(E[O]-E[I])*(E[F+1]-E[O+1]))}return 0===J&&0===G?0:Math.abs((G-J)/J)};r.flatten=function(E){for(var G=E[0][0].length,
K={vertices:[],holes:[],dimensions:G},M=0,H=0;H<E.length;H++){for(var J=0;J<E[H].length;J++)for(var O=0;O<G;O++)K.vertices.push(E[H][J][O]);0<H&&(M+=E[H-1].length,K.holes.push(M))}return K};return r})})(p);a.earcut=p.exports})},"esri/chunks/vec32":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,p){function b(e,l,g){if(e.count!==l.count)p.logger.error("source and destination buffers need to have the same number of elements");else{var d=e.count,c=g[0],u=g[1],t=g[2],
h=g[4],m=g[5],n=g[6],z=g[8],k=g[9],v=g[10],x=g[12],C=g[13];g=g[14];var A=e.typedBuffer;e=e.typedBufferStride;var B=l.typedBuffer;l=l.typedBufferStride;for(let E=0;E<d;E++){const G=E*e;var D=E*l;const K=B[D],M=B[D+1];D=B[D+2];A[G]=c*K+h*M+z*D+x;A[G+1]=u*K+m*M+k*D+C;A[G+2]=t*K+n*M+v*D+g}}}function r(e,l,g){if(e.count!==l.count)p.logger.error("source and destination buffers need to have the same number of elements");else{var d=e.count,c=g[0],u=g[1],t=g[2],h=g[3],m=g[4],n=g[5],z=g[6],k=g[7];g=g[8];var v=
e.typedBuffer;e=e.typedBufferStride;var x=l.typedBuffer;l=l.typedBufferStride;for(let A=0;A<d;A++){const B=A*e;var C=A*l;const D=x[C],E=x[C+1];C=x[C+2];v[B]=c*D+h*E+z*C;v[B+1]=u*D+m*E+k*C;v[B+2]=t*D+n*E+g*C}}}function q(e,l,g){const d=Math.min(e.count,l.count),c=e.typedBuffer;e=e.typedBufferStride;const u=l.typedBuffer;l=l.typedBufferStride;for(let t=0;t<d;t++){const h=t*e,m=t*l;c[h]=g*u[m];c[h+1]=g*u[m+1];c[h+2]=g*u[m+2]}}function y(e,l){const g=Math.min(e.count,l.count),d=e.typedBuffer;e=e.typedBufferStride;
const c=l.typedBuffer;l=l.typedBufferStride;for(let h=0;h<g;h++){const m=h*e;var u=h*l;const n=c[u],z=c[u+1];u=c[u+2];var t=Math.sqrt(n*n+z*z+u*u);0<t&&(t=1/t,d[m]=t*n,d[m+1]=t*z,d[m+2]=t*u)}}function f(e,l,g){const d=Math.min(e.count,l.count),c=e.typedBuffer;e=e.typedBufferStride;const u=l.typedBuffer;l=l.typedBufferStride;for(let t=0;t<d;t++){const h=t*e,m=t*l;c[h]=u[m]>>g;c[h+1]=u[m+1]>>g;c[h+2]=u[m+2]>>g}}var w=Object.freeze({__proto__:null,transformMat4:b,transformMat3:r,scale:q,normalize:y,
shiftRight:f});a.normalize=y;a.scale=q;a.shiftRight=f;a.transformMat3=r;a.transformMat4=b;a.vec3=w})},"esri/geometry/support/buffer/math/common":function(){define(["exports","../../../../core/Logger"],function(a,p){p=p.getLogger("esri.views.3d.support.buffer.math");a.logger=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../core/maybe","../visualVariables/support/visualVariableUtils"],
function(a,p,b,r,q){function y(l,g){if(!l||l.symbol)return null;g=g&&g.renderer;return l&&r.isSome(g)&&g.getObservationRenderer?g.getObservationRenderer(l):g}function f(l,g){return w.apply(this,arguments)}function w(){w=p._asyncToGenerator(function*(l,g){if(r.isSome(l.symbol))return l.symbol;const d=y(l,g);return r.isSome(d)&&d.getSymbolAsync(l,{...g,abortOptions:{signal:g.signal}})});return w.apply(this,arguments)}function e(){e=p._asyncToGenerator(function*(l,g){var d=y(l,g),c=yield f(l,g);if(!c)return null;
c={renderer:d,symbol:c};if(!(d&&"visualVariables"in d&&d.visualVariables))return c;g=q.getVisualVariableValues(d,l,g);l=["proportional","proportional","proportional"];for(const {variable:u,value:t}of g)"color"===u.type?c.color=b.toUnitRGBA(t):"size"===u.type?"outline"===u.target?c.outlineSize=t:(g=u.axis,d=u.useSymbolValue?"symbol-value":t,"width"===g?l[0]=d:"depth"===g?l[1]=d:"height"===g?l[2]=d:l[0]="width-and-depth"===g?l[1]=d:l[1]=l[2]=d):"opacity"===u.type?c.opacity=t:"rotation"===u.type&&"tilt"===
u.axis?c.tilt=t:"rotation"===u.type&&"roll"===u.axis?c.roll=t:"rotation"===u.type&&(c.heading=t);if(isFinite(l[0])||isFinite(l[1])||isFinite(l[2]))c.size=l;return c});return e.apply(this,arguments)}a.getDriverAxisSizeValue=function(l,g=0){l=l[g];return"number"===typeof l&&isFinite(l)?l:null};a.getDriverAxisSizeValueAny=function(l){for(let g=0;3>g;g++){const d=l[g];if("number"===typeof d)return isFinite(d)?d:0}return 0};a.getRenderer=y;a.getRenderingInfo=function(l,g){const d=y(l,g);if(r.isSome(l.symbol))var c=
l.symbol;else c=y(l,g),c=r.isSome(c)&&"dot-density"!==c.type?c.getSymbol(l,g):null;if(r.isNone(c))return null;c={renderer:d,symbol:c};if(r.isNone(d)||!("visualVariables"in d)||!d.visualVariables)return c;g=q.getVisualVariableValues(d,l,g);l=["proportional","proportional","proportional"];for(const {variable:u,value:t}of g)switch(u.type){case "color":c.color=t.toRgba();break;case "size":if("outline"===u.target)c.outlineSize=t;else switch(g=u.useSymbolValue?"symbol-value":t,u.axis){case "width":l[0]=
g;break;case "depth":l[1]=g;break;case "height":l[2]=g;break;case "width-and-depth":l[0]=l[1]=g;break;default:l[0]=l[1]=l[2]=g}break;case "opacity":c.opacity=t;break;case "rotation":switch(u.axis){case "tilt":c.tilt=t;break;case "roll":c.roll=t;break;default:c.heading=t}}if("proportional"!==l[0]||"proportional"!==l[1]||"proportional"!==l[2])c.size=l;return c};a.getRenderingInfoAsync=function(l,g){return e.apply(this,arguments)};a.getSymbolAsync=f;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/maybe ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),function(a,p,b,r,q,y,f,w,e,l){function g(c,u,t){const h=[];for(const {index:m,count:n}of c){if(1>=n)continue;c=3*m;const z=c+3*n;h.push({index:m,count:n,
position:u.subarray(c,z),mapPosition:t?t.subarray(c,z):void 0})}return h}function d(c,u,t){const h=[];for(const {index:m,count:n,holeIndices:z,pathLengths:k}of c){if(1>=n)continue;c=3*m;const v=c+3*n,x=z.map(C=>C-m);h.push({index:m,count:n,holeIndices:x,pathLengths:k,position:u.subarray(c,v),mapPosition:t?t.subarray(c,v):void 0})}return h}a.createColorGeometry=function(c){const u=[["position",c.indices]],t=[["position",{size:3,data:c.attributeData.position,exclusive:!0}]];b.isSome(c.attributeData.color)&&
(t.push(["color",{size:4,data:c.attributeData.color,exclusive:!0}]),u.push(["color",new Uint32Array(c.indices.length)]));b.isSome(c.attributeData.uvMapSpace)&&(t.push(["uvMapSpace",{size:4,data:c.attributeData.uvMapSpace,exclusive:!0}]),u.push(["uvMapSpace",c.indices]));b.isSome(c.attributeData.boundingRect)&&(t.push(["boundingRect",{size:9,data:c.attributeData.boundingRect,exclusive:!0}]),u.push(["boundingRect",c.indices]));b.isSome(c.attributeData.mapPosition)&&(t.push(["mapPos",{size:3,data:c.attributeData.mapPosition,
exclusive:!0}]),u.push(["mapPos",c.indices]));return new w.Geometry(t,u)};a.createWaterGeometry=function(c){const u=[["position",c.indices],["uv0",c.indices]],t=[["position",{size:3,data:c.attributeData.position,exclusive:!0}],["uv0",{size:2,data:c.attributeData.uv0,exclusive:!0}]];b.isSome(c.attributeData.mapPosition)&&(t.push(["mapPos",{size:3,data:c.attributeData.mapPosition,exclusive:!0}]),u.push(["mapPos",c.indices]));return new w.Geometry(t,u)};a.geometryAsPolygon=function(c){switch(c.type){case "extent":if(c instanceof
e)return l.fromExtent(c);break;case "polygon":return c}return null};a.geometryToRenderInfo=function(c,u,t,h){const m=q.pathsToTriangulationInfo(c.rings,c.hasZ,1),n=new Float64Array(m.position.length);c=y.applyPerVertexElevationAlignment(m.position,c.spatialReference,0,n,0,m.position,0,m.position.length/3,u,t,h);u=null!=c;return{position:m.position,mapPosition:n,polygons:d(m.polygons,m.position,n),outlines:g(m.outlines,m.position,n),projectionSuccess:u,sampledElevation:c}};a.geometryToRenderInfoDraped=
function(c,u){const t=q.pathsToTriangulationInfo(c.rings,!1,1);c=r.projectBuffer(t.position,c.spatialReference,0,t.position,u,0,t.position.length/3);for(u=2;u<t.position.length;u+=3)t.position[u]=f.DRAPED_Z;return{position:t.position,polygons:d(t.polygons,t.position),outlines:g(t.outlines,t.position),projectionSuccess:c}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/triangulationUtils":function(){define(["exports","../../chunks/earcut","./coordsUtils","./meshUtils/deduplicate"],
function(a,p,b,r){function q(w,e,l){if(1===w.length)return w[0];e=new Float64Array(e);l=new Uint32Array(l);let g=0,d=0,c=0;for(const u of w){for(w=0;w<u.position.length;w++)e[g++]=u.position[w];for(w=0;w<u.faces.length;w++)l[d++]=u.faces[w]+c;c=g/3}return{position:e,faces:l}}function y(w,e,l){const g=w.length,d=Array(g),c=Array(g),u=Array(g);let t=0,h=0,m=0;var n=0;for(var z=0;z<g;++z)n+=w[z].length;n=new Float64Array(3*n);z=0;for(let C=g-1;0<=C;C--){var k=w[C],v=1===l?!b.isClockwise(k,!1,!1):!1;
if(v&&1!==g)d[t++]=k;else{var x=k.length;for(let A=0;A<t;++A)x+=d[A].length;x={index:z,pathLengths:Array(t+1),count:x,holeIndices:Array(t)};x.pathLengths[0]=k.length;0<k.length&&(u[m++]={index:z,count:k.length});z=v?f(k,k.length-1,-1,n,z,k.length,e):f(k,0,1,n,z,k.length,e);for(k=0;k<t;++k)v=d[k],x.holeIndices[k]=z,x.pathLengths[k+1]=v.length,0<v.length&&(u[m++]={index:z,count:v.length}),z=f(v,0,1,n,z,v.length,e);t=0;0<x.count&&(c[h++]=x)}}for(w=0;w<t;++w)l=d[w],0<l.length&&(u[m++]={index:z,count:l.length}),
z=f(l,0,1,n,z,l.length,e);h<g&&(c.length=h);m<g&&(u.length=m);return{position:n,polygons:c,outlines:u}}function f(w,e,l,g,d,c,u){d*=3;for(let t=0;t<c;++t){const h=w[e];g[d++]=h[0];g[d++]=h[1];g[d++]=u?h[2]:0;e+=l}return d/3}a.pathsToTriangulationInfo=y;a.triangulate=function(w){w=y(w.rings,w.hasZ,1);const e=[];let l=0,g=0;for(var d of w.polygons){const u=d.index,t=new Float64Array(w.position.buffer,3*u*w.position.BYTES_PER_ELEMENT,3*d.count);var c=d.holeIndices.map(h=>h-u);c=new Uint32Array(p.earcut(t,
c,3));e.push({position:t,faces:c});l+=t.length;g+=c.length}d=q(e,l,g);w=r.deduplicate(d.position.buffer,6,{originalIndices:d.faces});d.position=new Float64Array(w.buffer);d.faces=w.indices;return d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils"],function(a,p){function b(q,y,f){var w,e=q.byteLength/(4*y),l=new Uint32Array(q,0,e*y);q=new Uint32Array(e);var g=null!=(w=null==f?void 0:f.minReduction)?
w:0;const d=(w=(null==f?void 0:f.originalIndices)||null)?w.length:0;var c=(null==f?void 0:f.componentOffsets)||null;f=0;if(c)for(var u=0;u<c.length-1;u++){var t=c[u+1]-c[u];t>f&&(f=t)}else f=e;var h=Math.floor(1.1*f)+1;if(null==r||r.length<2*h)r=new Uint32Array(p.nextHighestPowerOfTwo(2*h));for(f=0;f<2*h;f++)r[f]=0;f=0;t=(u=!!c&&!!w)?d:e;var m=u?new Uint32Array(d):null,n=0!==g?Math.ceil(7.84*1.96/(g*g)*g*(1-g)):t,z=1,k=c?c[1]:t;for(var v=0;v<t;v++){if(v===n){var x=1-f/v;if(x+1.96*Math.sqrt(x*(1-x)/
v)<g)return null;n*=2}if(v===k){for(k=0;k<2*h;k++)r[k]=0;if(w)for(k=c[z-1];k<c[z];k++)m[k]=q[w[k]];k=c[++z]}x=u?w[v]:v;const D=x*y;var C=0;for(var A=0;A<y;A++)C=l[D+A]+C|0,C=C+(C<<11)+(C>>>2)|0;C>>>=0;A=C%h;let E=f;for(;0!==r[2*A+1];){if(r[2*A]===C){const G=r[2*A+1]-1;var B=G*y;a:{for(let K=0;K<y;K++)if(l[D+K]!==l[B+K]){B=!1;break a}B=!0}if(B){E=q[G];break}}A++;A>=h&&(A-=h)}E===f&&(r[2*A]=C,r[2*A+1]=x+1,f++);q[x]=E}if(0!==g&&1-f/e<g)return null;if(u){for(e=c[z-1];e<m.length;e++)m[e]=q[w[e]];q=m}e=
new Uint32Array(y*f);f=0;for(z=0;z<t;z++)if(q[z]===f){g=l;c=(u?w[z]:z)*y;h=e;m=f*y;n=y;for(v=0;v<n;v++)h[m+v]=g[c+v];f++}if(w&&!u){y=new Uint32Array(d);for(l=0;l<y.length;l++)y[l]=q[w[l]];q=y}return{buffer:e.buffer,indices:q,uniqueCount:f}}let r=null;a.deduplicate=b;a["default"]=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/SetUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec2f64 ../../../chunks/vec3f64 ../support/debugFlags ./Overlay ./OverlayFramebufferObject ./OverlayRenderTarget ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRep ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/RenderContext ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lighting/Lightsources ../webgl-engine/lighting/SceneLighting ../webgl-engine/materials/StippleTextureRepository ../../support/Scheduler ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N,R,S){const P=f.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");a.OverlayRenderer=function(ha){function fa(W){W=ha.call(this,W)||this;W._overlays=null;W._overlayRenderTarget=null;W._hasHighlights=!1;W._rendersOccluded=!1;W._hasWater=!1;W._lighting=new F.SceneLighting;W._handles=new y;W._layerRenderers=new Map;W._sortedLayerRenderersDirty=!1;W._sortedLayerRenderers=new l;W._geometries=new Map;W.worldToPCSRatio=
1;W.events=new q;W.longitudeCyclical=null;return W}p._inheritsLoose(fa,ha);var aa=fa.prototype;aa.initialize=function(){const W=this.view._stage.renderView;this._rctx=W.renderingContext;this._renderContext=new H.OverlayRenderContext(this._rctx);const U=W.waterTextureRepository;this._stippleTextureRepository=new L.StippleTextureRepository(W.renderingContext);this._shaderTechniqueRepository=new A.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,
waterTextureRepository:U});this._handles.add([d.init(U,"loadingState",()=>this.events.emit("content-changed")),d.init(this,"spatialReference",X=>this._localOrigins=new K.GridLocalOriginFactory(X))]);this._materialRepository=new E(W.textureRepository,this._shaderTechniqueRepository);this._materialRepository.onMaterialChanged=X=>{0<(X.renderOccluded&4)!==this._rendersOccluded&&this.updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating")};this._lighting.groundLightingFactor=
1;this._lighting.globalFactor=0;this._lighting.set([new I.AmbientLight(z.fromValues(1,1,1))]);this._bindParameters={slot:23,highlightDepthTexture:G.createEmptyDepthTexture(this._rctx),camera:ca,inverseViewport:n.create(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,
geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null};this._handles.add(this.view.resourceController.scheduler.registerTask(N.TaskPriority.STAGE,this))};aa.dispose=function(){this._handles.destroy();this._layerRenderers.forEach(W=>W.dispose());this._layerRenderers.clear();this._debugTextureTechnique=e.releaseMaybe(this._debugTextureTechnique);this._debugPatternTexture=e.disposeMaybe(this._debugPatternTexture);this._bindParameters.highlightDepthTexture=
e.disposeMaybe(this._bindParameters.highlightDepthTexture);this._shaderTechniqueRepository=e.disposeMaybe(this._shaderTechniqueRepository);this._temporaryFBO=e.disposeMaybe(this._temporaryFBO);this._quadVAO=e.disposeMaybe(this._quadVAO);this.disposeOverlays()};aa.collectUnusedRenderTargetMemory=function(W){let U=!1;if(e.isSome(this._overlayRenderTarget))for(const X of this._overlayRenderTarget.renderTargets)U=this._overlayRenderTarget.validateUsageForTarget(this.overlays[0].validTargets[X.type]||
!this.overlays[1].validTargets[X.type],X,W)||U;return U};aa.ensureDrapeTargets=function(W){e.isSome(this._overlays)&&this._overlays.forEach(U=>{U.hasTargetWithoutRasterImage=g.someSet(W,X=>1===X.drapeTargetType)})};aa.ensureDrapeSources=function(W){e.isSome(this._overlays)&&this._overlays.forEach(U=>{U.hasDrapedFeatureSource=w.someMap(W,(X,T)=>1===T.drapeSourceType);U.hasDrapedRasterSource=w.someMap(W,(X,T)=>0===T.drapeSourceType)})};aa.ensureOverlays=function(W,U){e.isNone(this._overlays)&&(this._overlayRenderTarget=
new C.OverlayRenderTarget(this._rctx),this._overlays=[new v.Overlay(0,this._overlayRenderTarget),new v.Overlay(1,this._overlayRenderTarget)]);this.ensureDrapeTargets(W);this.ensureDrapeSources(U)};aa.disposeOverlays=function(){this._overlays=null;this._overlayRenderTarget=e.disposeMaybe(this._overlayRenderTarget);this.events.emit("textures-disposed")};aa.runTask=function(W,U=()=>!0){let X=!1;for(const [T,Y]of this._layerRenderers){if(W.done)break;U(T)&&(Y.commitChanges()&&(X=!0,W.madeProgress()),
Y.isEmpty&&(this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(T),this._handles.remove(T)))}this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),X=!0);X&&(e.isSome(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())};aa.processSyncLayers=function(){this.runTask(N.noBudget,W=>1===W.updatePolicy)};aa.addGeometries=
function(W,U,X){for(const T of W)e.isNone(T.origin)&&(T.origin=this._localOrigins.getOrigin(T.boundingSphere)),this._geometries.set(T.id,T);this.ensureLayerRenderer(U).add(W);2===X&&this.notifyGraphicGeometryChanged(W,U)};aa.removeGeometries=function(W,U,X){for(var T of W)this._geometries.delete(e.unwrap(T.id));if(T=this._layerRenderers.get(U))T.remove(W),2===X&&this.notifyGraphicGeometryChanged(W,U)};aa.updateGeometries=function(W,U,X){const T=this._layerRenderers.get(U);if(T)switch(T.modify(W,X),
X){case 4:case 2:return this.notifyGraphicGeometryChanged(W,U);case 1:return this.notifyGraphicVisibilityChanged(W,U)}else P.warn("Attempted to update geometry for nonexistent layer")};aa.notifyGraphicGeometryChanged=function(W,U){if(!e.isNone(U.notifyGraphicGeometryChanged))for(const T of W)if(W=T.graphicUid,e.isSome(W)&&W!==X){U.notifyGraphicGeometryChanged(W);var X=W}};aa.notifyGraphicVisibilityChanged=function(W,U){if(!e.isNone(U.notifyGraphicVisibilityChanged))for(const T of W)if(W=T.graphicUid,
e.isSome(W)&&W!==X){U.notifyGraphicVisibilityChanged(W);var X=W}};aa.updateHighlights=function(W,U){(U=this._layerRenderers.get(U))?U.modify(W,8):P.warn("Attempted to update highlights for nonexistent layer")};aa.isEmpty=function(){return 0===this._geometries.size&&!k.OVERLAY_DRAW_DEBUG_TEXTURE};aa.updateLogic=function(W){let U=!1;this._layerRenderers.forEach(X=>U=X.updateLogic(W)||U);return U};aa.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0};aa.drawTarget=function(W,U,X){const T=
W.canvasGeometries;if(0===T.numViews)return!1;X*=W.pixelRatio;this._screenToWorldRatio=X*Math.abs(T.extents[0][2]-T.extents[0][0])/W.resolution;const Y=U.renderPass;if(this.isEmpty()||5===Y&&!this.hasHighlights||3===Y&&!this.hasWater||!W.hasSomeSizedView())return!1;const ea=U.fbo,ia=2*W.resolution,la=W.resolution,pa=1===U.type?2:4===U.type?1:0;if(!ea.isValid())return!1;ea.resize(ia,la);const ua=this._rctx;ca.pixelRatio=X||1;this._renderContext.pass=Y;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;
this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=3===Y?24:23;W.applyViewport(this._rctx);ea.bind(ua);0===W.index&&(ua.setClearColor(0,0,0,0),ua.clearSafe(16384));1===pa&&(this._renderContext.renderOccludedMask=4);if(k.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==pa)for(U=0;U<T.numViews;U++)this.setViewParameters(T.extents[U],W,ca),this.drawDebugTexture(W.resolution,V[W.index]);0<this._layerRenderers.size&&this._sortedLayerRenderers.forAll(({layerView:wa,
renderer:Fa})=>{if(2!==pa||!e.isSome(wa)||0!==wa.drapeSourceType){var La=e.isSome(wa)&&e.isSome(wa.fullOpacity)&&1>wa.fullOpacity&&0===Y;La&&(this.bindTemporaryFramebuffer(this._rctx,ia,la),ua.clearSafe(16384));for(let Ma=0;Ma<T.numViews;Ma++)this.setViewParameters(T.extents[Ma],W,ca),Fa.render(this._renderContext,this._bindParameters);La&&e.isSome(this._temporaryFBO)&&(ea.bind(ua),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),2,e.unwrap(e.unwrap(wa).fullOpacity),
3,W.index))}});ua.bindFramebuffer(null);ea.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};aa.bindTemporaryFramebuffer=function(W,U,X){e.isNone(this._temporaryFBO)&&(this._temporaryFBO=new x.OverlayFramebufferObject(W,!1));this._temporaryFBO.resize(U,X);this._temporaryFBO.bind(W)};aa.reloadShaders=function(){var W=p._asyncToGenerator(function*(){yield this._shaderTechniqueRepository.hotReload()});return function(){return W.apply(this,arguments)}}();aa.intersect=function(W,
U,X){let T=0;this._geometries.forEach(Y=>{if(!X||X(Y)){this.intersectRenderGeometry(Y,U,0,W,T);var ea=this.longitudeCyclical;ea&&(Y.boundingSphere[0]-Y.boundingSphere[3]<ea.min&&this.intersectRenderGeometry(Y,U,ea.range,W,T),Y.boundingSphere[0]+Y.boundingSphere[3]>ea.max&&this.intersectRenderGeometry(Y,U,-ea.range,W,T));T++}})};aa.intersectRenderGeometry=function(W,U,X,T,Y){if(W.instanceParameters.visible){var ea=0;e.isSome(W.transformation)&&(X+=W.transformation[12],ea=W.transformation[13]);ba[0]=
U[0]-X;ba[1]=U[1]-ea;ba[2]=1;Z[0]=U[0]-X;Z[1]=U[1]-ea;Z[2]=0;W.screenToWorldRatio=this._screenToWorldRatio;W.material.intersect(W,null,W.getShaderTransformation(),T,ba,Z,(ia,la,pa)=>{this.addIntersectionResult(pa,W.material.renderPriority,Y,T,W.layerUid,W.graphicUid)},W.calculateShaderTransformation,!0)}};aa.addIntersectionResult=function(W,U,X,T,Y,ea){const ia={type:"external",metadata:{layerUid:Y,graphicUid:ea}};Y=la=>{la.set(ia,null,T.results.ground.dist,T.results.ground.normal,T.results.ground.transformation,
U,null,null,W,X);la.intersector="OverlayRenderer"};(null==T.results.min.drapedLayerOrder||U>=T.results.min.drapedLayerOrder)&&(null==T.results.min.dist||T.results.ground.dist<=T.results.min.dist)&&Y(T.results.min);0!==T.options.store&&(null==T.results.max.drapedLayerOrder||U<T.results.max.drapedLayerOrder)&&(null==T.results.max.dist||T.results.ground.dist>T.results.max.dist)&&Y(T.results.max);2===T.options.store&&(ea=new M.IntersectorResult(T.ray),Y(ea),T.results.all.push(ea))};aa.ensureLayerRenderer=
function(W){let U=this._layerRenderers.get(W);U||(U=new J.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(W,U),this._sortedLayerRenderersDirty=!0,"fullOpacity"in W&&this._handles.add(W.watch("fullOpacity",()=>this.events.emit("content-changed")),W),this._handles.add(d.init(U,"updating",()=>this.notifyChange("updating")),W));return U};aa.updateSortedLayerRenderers=function(){if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=
!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var W=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach(U=>{const X=this._layerRenderers.get(U);X&&(this._sortedLayerRenderers.push(new Q(U,X)),W.delete(X))});W.forEach(U=>this._sortedLayerRenderers.push(new Q(null,U)))}};aa.setViewParameters=function(W,U,X){X.viewport[0]=X.viewport[1]=0;X.viewport[2]=X.viewport[3]=U.resolution;m.ortho(X.projectionMatrix,0,W[2]-W[0],0,W[3]-W[1],X.near,X.far);m.identity(X.viewMatrix);
m.translate(X.viewMatrix,X.viewMatrix,[-W[0],-W[1],0]);this._renderContext.camera=X;this._bindParameters.camera=X;this._bindParameters.inverseViewport[0]=1/X.fullViewport[2];this._bindParameters.inverseViewport[1]=1/X.fullViewport[3]};aa.updateHasWater=function(){const W=w.someMap(this._layerRenderers,U=>U.hasWater);W!==this._hasWater&&(this._hasWater=W,this.events.emit("has-water",W))};aa.updateHasHighlights=function(){const W=w.someMap(this._layerRenderers,U=>U.hasHighlights);W!==this._hasHighlights&&
(this._hasHighlights=W,this.events.emit("has-highlights",W))};aa.updateRendersOccluded=function(){const W=w.someMap(this._layerRenderers,U=>U.rendersOccluded);W!==this._rendersOccluded&&(this._rendersOccluded=W,this.events.emit("renders-occluded",W))};aa.drawDebugTexture=function(W,U){const X=this._rctx;this.ensureDebugPatternResources(W,W);W=this._debugTextureTechnique.program;X.useProgram(W);X.setPipelineState(this._debugTextureTechnique.pipeline);W.setUniform4f("color",U[0],U[1],U[2],1);W.bindTexture(this._debugPatternTexture,
"tex");X.bindVAO(this._quadVAO);X.drawArrays(5,0,S.vertexCount(this._quadVAO,"geometry"))};aa.ensureDebugPatternResources=function(W,U){if(!this._debugPatternTexture){var X=new Uint8Array(W*U*4),T=0;for(let Y=0;Y<U;Y++)for(let ea=0;ea<W;ea++){const ia=Math.floor(ea/10),la=Math.floor(Y/10);2>ia||2>la||10*ia>W-20||10*la>U-20?(X[T++]=255,X[T++]=255,X[T++]=255,X[T++]=255):(X[T++]=255,X[T++]=255,X[T++]=255,ia&1&&la&1?X[T++]=ea&1^Y&1?0:255:X[T++]=ia&1^la&1?0:128)}this._debugPatternTexture=new R(this._rctx,
{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:W,height:U},X);W=new O.TextureTechniqueConfiguration;W.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(O.TextureTechnique,W);this._quadVAO=G.createQuadVAO(this._rctx)}};p._createClass(fa,[{key:"updating",get:function(){return this._sortedLayerRenderersDirty||w.someMap(this._layerRenderers,W=>W.updating)}},{key:"hasOverlays",get:function(){return e.isSome(this._overlays)&&e.isSome(this._overlayRenderTarget)}},
{key:"gpuMemoryUsage",get:function(){return e.isSome(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"overlays",get:function(){return e.unwrapOr(this._overlays,[])}},{key:"running",get:function(){return this.updating}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]);
return fa}(B.AutoDisposableMixin(r));b.__decorate([B.autoDispose()],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);b.__decorate([B.autoDispose()],a.OverlayRenderer.prototype,"_stippleTextureRepository",void 0);b.__decorate([c.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);b.__decorate([c.property()],a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);b.__decorate([c.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);b.__decorate([c.property({type:Boolean,
readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);a.OverlayRenderer=b.__decorate([h.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);let Q=function(ha,fa){this.layerView=ha;this.renderer=fa};const V=[[1,.5,.5],[.5,.5,1]],ca=new D;ca.near=1;ca.far=1E4;ca.relativeElevation=null;const ba=z.create(),Z=z.create();a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=4;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Overlay":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/mathUtils","../../../geometry/support/aaBoundingRect","../webgl-engine/lib/localOrigin"],function(a,p,b,r,q){let y=function(){function f(e,l){this.index=e;this.renderTargets=l;this.extent=r.create();this.resolution=0;this.renderLocalOrigin=q.fromValues(0,0,0,"O");this.pixelRatio=1;this.canvasGeometries={extents:[r.create(),r.create(),r.create()],numViews:0};this.validTargets=null;this.hasTargetWithoutRasterImage=this.hasDrapedRasterSource=this.hasDrapedFeatureSource=!1;this.index=e;
this.validTargets=Array(l.renderTargets.length).fill(!1)}var w=f.prototype;w.getValidTarget=function(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null};w.getColorTexture=function(e){return(e=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4))?e.getTexture():null};w.getNormalTexture=function(e){return(e=1===e?this.renderTargets.getTarget(3):null)?e.getTexture():null};w.draw=function(e,l){const g=this.computeRenderTargetValidityBitfield(),
d=this.needsColorWithoutRasterImage;for(const c of this.renderTargets.renderTargets)this.validTargets[c.type]=1===c.type&&!1===d?!1:e.drawTarget(this,c,l);e=this.computeRenderTargetValidityBitfield();return g^e?0:1};w.computeRenderTargetValidityBitfield=function(){const e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4};w.setupGeometryViewsCyclical=function(e){this.setupGeometryViewsDirect();var l=.001*e.range;if(this.extent[0]-l<=e.min){const g=this.canvasGeometries.extents[this.canvasGeometries.numViews++];
r.offset(this.extent,e.range,0,g)}this.extent[2]+l>=e.max&&(l=this.canvasGeometries.extents[this.canvasGeometries.numViews++],r.offset(this.extent,-e.range,0,l))};w.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1;r.copy(this.canvasGeometries.extents[0],this.extent)};w.hasSomeSizedView=function(){for(let e=0;e<this.canvasGeometries.numViews;e++){const l=this.canvasGeometries.extents[e];if(l[0]!==l[2]&&l[1]!==l[3])return!0}return!1};w.applyViewport=function(e){e.setViewport(0===
this.index?0:this.resolution,0,this.resolution,this.resolution)};p._createClass(f,[{key:"needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}}]);return f}();a.Overlay=y;a.computeOverlayResolution=function(f,w,e){return Math.min(b.nextHighestPowerOfTwo(Math.max(f,w)+256),e)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["exports","../../../../chunks/vec3f64"],
function(a,p){let b=function(r,q){this.vec3=r;this.id=q};a.LocalOrigin=b;a.fromValues=function(r,q,y,f){return new b(p.fromValues(r,q,y),f)};a.fromVector=function(r,q){return new b(p.clone(r),q)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec2f32 ../../webgl/BufferObject ../../webgl/FramebufferObject ../../../core/has ../../webgl/checkWebGLError ../../webgl/enums ../../../chunks/builtins ../../webgl/renderState ../../webgl/Texture ../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){q=function(){function u(h,m){this.size=r.create();this._fbo=null;this._fbo=new y(h,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:m,maxAnisotropy:8,width:0,height:0})}var t=u.prototype;t.dispose=function(){this._fbo=b.disposeMaybe(this._fbo)};t.getTexture=function(){return this._fbo?this._fbo.colorTexture:null};t.isValid=function(){return null!==this._fbo};t.resize=function(h,m){this.size[0]=
h;this.size[1]=m;this._fbo.resize(this.size[0],this.size[1])};t.bind=function(h){h.bindFramebuffer(this._fbo)};t.generateMipMap=function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()};t.disposeRenderTargetMemory=function(){var h;null==(h=this._fbo)?void 0:h.resize(0,0)};p._createClass(u,[{key:"gpuMemoryUsage",get:function(){var h,m;return null!=(h=null==(m=this._fbo)?void 0:m.gpuMemoryUsage)?h:0}}]);return u}();a.OverlayFramebufferObject=q;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./OverlayFramebufferObject"],function(a,p,b){let r=function(){function q(f){this.renderTargets=null;const w=(e,l,g=!0)=>({type:l,fbo:new b.OverlayFramebufferObject(f,g),renderPass:e,valid:!1,lastUsed:Infinity});this.renderTargets=[w(0,0),w(0,1),w(5,2,!1),w(3,3),w(0,4)]}var y=q.prototype;y.getTarget=function(f){return this.renderTargets[f].fbo};y.dispose=
function(){for(const f of this.renderTargets)f.fbo.dispose()};y.disposeRenderTargetMemory=function(){for(const f of this.renderTargets)f.fbo.disposeRenderTargetMemory()};y.validateUsageForTarget=function(f,w,e){if(f)w.lastUsed=e;else if(1E3<e-w.lastUsed)w.fbo.disposeRenderTargetMemory(),w.lastUsed=Infinity;else if(Infinity>w.lastUsed)return!0;return!1};p._createClass(q,[{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((f,w)=>f+w.fbo.gpuMemoryUsage,0)}}]);return q}();a.OverlayRenderTarget=
r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],function(a,p,b){let r=function(y){this.technique=y;this.refZeroFrame=this.refCount=0},q=function(){function y(w){this._context=w;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=-1}var f=y.prototype;f.dispose=function(){this._perConstructorInstances.forEach(w=>
w.forEach(e=>e.technique.dispose()));this._perConstructorInstances.clear()};f.acquire=function(w,e){const l=e.key;let g=this._perConstructorInstances.get(w);g||(g=new Map,this._perConstructorInstances.set(w,g));let d=g.get(l);if(void 0===d){const c=new w(this._context,e,()=>this.release(c));d=new r(c);g.set(l,d)}++d.refCount;return d.technique};f.releaseAndAcquire=function(w,e,l){if(b.isSome(l)){if(e.key===l.key)return l;l.release()}return this.acquire(w,e)};f.release=function(w){b.isNone(w)||(w=
this._perConstructorInstances.get(w.constructor).get(w.key),--w.refCount,0===w.refCount&&(w.refZeroFrame=this._frameCounter))};f.frameUpdate=function(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((w,e)=>{w.forEach((l,g)=>{0===l.refCount&&l.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(l.technique.dispose(),w.delete(g))});0===w.size&&this._perConstructorInstances.delete(e)})};f.hotReload=function(){var w=p._asyncToGenerator(function*(){var e=
this;const l=[];this._perConstructorInstances.forEach((g,d)=>{const c=function(){var u=p._asyncToGenerator(function*(t,h){if(h=h.shader)yield h.reload(),t.forEach(m=>{m.technique.reload(e._context)})});return function(t,h){return u.apply(this,arguments)}}();l.push(c(g,d))});yield Promise.all(l)});return function(){return w.apply(this,arguments)}}();p._createClass(y,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);
return y}();a.ShaderTechniqueRepository=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["../../../../core/Logger","../../../../core/maybe","../core/shaderLibrary/ShaderOutputOptions","./Util"],function(a,p,b,r){const q=a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep");let y=function(){function f(e){this.refCnt=0;this.glMaterial=e}var w=f.prototype;w.incRefCnt=function(){++this.refCnt};w.decRefCnt=function(){--this.refCnt;
r.assert(0<=this.refCnt)};w.getRefCnt=function(){return this.refCnt};w.getGLMaterial=function(){return this.glMaterial};return f}();return function(){function f(e,l,g){this._textureRep=e;this._techniqueRep=l;this.onMaterialChanged=g;this._id2glMaterialRef=new Map}var w=f.prototype;w.dispose=function(){this._textureRep.dispose()};w.acquire=function(e,l){this.ownMaterial(e);const g=b.getShaderOutputID(e.id,l);let d=this._id2glMaterialRef.get(g);if(null==d)return e=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,
textureRep:this._textureRep,output:l}),d=new y(e),d.incRefCnt(),this._id2glMaterialRef.set(g,d),e;d.incRefCnt();return d.getGLMaterial()};w.release=function(e,l){e=b.getShaderOutputID(e.id,l);l=this._id2glMaterialRef.get(e);l.decRefCnt();0===l.getRefCnt()&&((l=l.getGLMaterial())&&l.dispose(),this._id2glMaterialRef.delete(e))};w.materialChanged=function(e){for(const g of b.ShaderOutputTypes)if(5!==g.output&&6!==g.output){var l=this._id2glMaterialRef.get(b.getShaderOutputID(e.id,g.output));l&&l.getGLMaterial()&&
(l=l.getGLMaterial(),l.updateParameters&&l.updateParameters())}if(this.onMaterialChanged)this.onMaterialChanged(e)};w.ownMaterial=function(e){p.isSome(e.materialRepository)&&e.materialRepository!==this&&q.error("Material is already owned by a different material repository");e.materialRepository=this};return f}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["exports"],function(a){const p=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},
{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];a.ShaderOutputTypes=p;a.getShaderOutputID=function(b,r){return b+"_"+p.find(q=>q.output===r).name};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./Geometry ./localOrigin ./Object3D ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){let c=0,u=function(){function m(z){this._originSR=z;this.ROOT_ORIGIN_ID="rg_root_"+c++;this._origins=new Map;this._gridSize=125E4;this._objects=new Map}var n=m.prototype;n.getOrigin=function(z){const k=this._origins.get(this.ROOT_ORIGIN_ID);if(null==k){if(b.isSome(t))return this._origins.set(this.ROOT_ORIGIN_ID,e.fromValues(t[0],t[1],t[2],this.ROOT_ORIGIN_ID)),this.getOrigin(z);z=e.fromValues(z[0]+Math.random()-.5,z[1]+Math.random()-.5,z[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);
this._origins.set(this.ROOT_ORIGIN_ID,z);return z}var v=this._gridSize;const x=Math.round(z[0]/v),C=Math.round(z[1]/v),A=Math.round(z[2]/v),B=`${"rg_"}${x}/${C}/${A}`;let D=this._origins.get(B);const E=.5*v;q.subtract(h,z,k.vec3);h[0]=Math.abs(h[0]);h[1]=Math.abs(h[1]);h[2]=Math.abs(h[2]);if(h[0]<E&&h[1]<E&&h[2]<E)return D&&(v=Math.max(...h),q.subtract(h,z,D.vec3),h[0]=Math.abs(h[0]),h[1]=Math.abs(h[1]),h[2]=Math.abs(h[2]),Math.max(...h)<v)?D:k;D||(D=e.fromValues(x*v,C*v,A*v,B),this._origins.set(B,
D));return D};n._drawOriginBox=function(z,k=[1,1,0,1]){const v=window.view,x=v._stage;var C=k.toString();if(!this._objects.has(C)){this._material=new d.RibbonLineMaterial({width:2,color:k});x.add(this._material);k=new g.WebGLLayer({isPickable:!1});var A=new l.Object3D({castShadow:!1});x.add(A);k.add(A);x.add(k);this._objects.set(C,A)}C=this._objects.get(C);k=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];A=k.length;const B=Array(3*A),D=new Uint16Array(2*(A-1)),E=.5*this._gridSize;for(let G=0;G<A;G++)B[3*
G]=z[0]+(k[G]&1?E:-E),B[3*G+1]=z[1]+(k[G]&2?E:-E),B[3*G+2]=z[2]+(k[G]&4?E:-E),0<G&&(D[2*G]=G-1,D[2*G+1]=G);f.projectBuffer(B,this._originSR,0,B,v.renderSpatialReference,0,A);z=new w.Geometry([["position",{size:3,data:B,exclusive:!0}]],[["position",D]],2);x.add(z);C.addGeometry(z,this._material,r.IDENTITY)};p._createClass(m,[{key:"test",get:function(){const z=this;return{get gridSize(){return z._gridSize},set gridSize(k){z._gridSize=k}}}}]);return m}(),t=null;const h=y.create();a.GridLocalOriginFactory=
u;a.setTestRootOrigin=function(m){t=m};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./DirtyEvents ./Octree".split(" "),function(a,p,b,r,q,y,f,w,e){f=function(l){function g(c,u=""){var t,h,m;var n=l.call(this)||this;n.apiLayerUid=u;n.type=0;n.events=new b;n.isSliceable=
!1;n._objects=new y;n._stageHandles=new r;n.apiLayerUid=u;n.isVisible=null!=(t=null==c?void 0:c.isVisible)?t:!0;n.isPickable=null!=(h=null==c?void 0:c.isPickable)?h:!0;n.updatePolicy=null!=(m=null==c?void 0:c.updatePolicy)?m:0;return n}p._inheritsLoose(g,l);var d=g.prototype;d.destroy=function(){this.detachStage();this._stage=null};d.attachStage=function(c){this.detachStage();this._stage=c;for(const u of w.DirtyEventNames)this._stageHandles.add(this.events.on(u,t=>c.handleEvent(u,t)))};d.detachStage=
function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};d.add=function(c){this._objects.push(c);c.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:c});q.isSome(this._octree)&&this._octree.add([c])};d.remove=function(c){this._objects.removeUnordered(c)&&(c.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:c}),q.isSome(this._octree)&&this._octree.remove([c]))};d.addMany=function(c){this._objects.pushArray(c);for(const u of c)u.parentLayer=
this;this.events.emit("layerObjectsAdded",{layer:this,objects:c});q.isSome(this._octree)&&this._octree.add(c)};d.removeMany=function(c){const u=[];this._objects.removeUnorderedMany(c,c.length,u);if(0!==u.length){for(const t of u)t.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:u});q.isSome(this._octree)&&this._octree.remove(u)}};d.sync=function(){q.isSome(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)};d.notifyObjectBBChanged=function(c,u){q.isSome(this._octree)&&
this._octree.update(c,u)};d.getSpatialQueryAccelerator=function(){q.isNone(this._octree)&&50<this._objects.length&&this._createOctree();return this._octree};d.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",this)};d.invalidateSpatialQueryAccelerator=function(){this._octree=q.destroyMaybe(this._octree)};d._createOctree=function(){this._octree=new e(c=>c.boundingVolumeWorldSpace.bounds);this._octree.add(this._objects.data,
this._objects.length)};p._createClass(g,[{key:"objects",get:function(){return this._objects}}]);return g}(f.ContentObject);a.WebGLLayer=f;a.isWebGLLayer=function(l){return q.isSome(l)&&0===l.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved vertexAttrsUpdated".split(" ");
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(a,p,b,r,q,y,f,w,e,l){function g(F,L,N){N[0]=F[0]+L;N[1]=F[1]+L;N[2]=F[2]+L}function d(F,L,
N,R){if(1===L)F=N(F[0]),e.copy(F,R);else{B[0]=Infinity;B[1]=Infinity;B[2]=Infinity;D[0]=-Infinity;D[1]=-Infinity;D[2]=-Infinity;for(let V=0;V<L;V++){var S=N(F[V]);if(h(S[3])){var P=B,Q=S;P[0]=Math.min(P[0],Q[0]-Q[3]);P[1]=Math.min(P[1],Q[1]-Q[3]);P[2]=Math.min(P[2],Q[2]-Q[3]);P=D;P[0]=Math.max(P[0],S[0]+S[3]);P[1]=Math.max(P[1],S[1]+S[3]);P[2]=Math.max(P[2],S[2]+S[3])}}q.lerp(R,B,D,.5);R[3]=Math.max(D[0]-B[0],D[1]-B[1],D[2]-B[2])/2}}function c(F,L,N){if(!O.length)for(var R=0;8>R;++R)O.push({index:0,
distance:0});for(R=0;8>R;++R){const S=z[R];O.data[R].index=R;O.data[R].distance=t(F,L,S)}O.sort((S,P)=>S.distance-P.distance);for(F=0;8>F;++F)N[F]=O.data[F].index}function u(F,L){let N=Infinity,R=null;for(let S=0;8>S;++S){const P=t(F,L,k[S]);P<N&&(N=P,R=k[S])}return R}function t(F,L,N){return L*(F[0]*N[0]+F[1]*N[1]+F[2]*N[2])}function h(F){return!isNaN(F)&&-Infinity!==F&&Infinity!==F&&0<F}let m=function(){function F(N,R){this._objectToBoundingSphere=N;this._maximumObjectsPerNode=10;this._maximumDepth=
20;this._degenerateObjects=new Set;this._root=new n;this._objectCount=0;R&&(void 0!==R.maximumObjectsPerNode&&(this._maximumObjectsPerNode=R.maximumObjectsPerNode),void 0!==R.maximumDepth&&(this._maximumDepth=R.maximumDepth))}var L=F.prototype;L.destroy=function(){this._degenerateObjects.clear();n.clearPool();x[0]=null;E.prune();O.prune()};L.add=function(N,R=N.length){this._objectCount+=R;this._grow(N,R);const S=n.acquire();for(let P=0;P<R;P++){const Q=N[P];this._isDegenerate(Q)?this._degenerateObjects.add(Q):
(S.init(this._root),this._add(Q,S))}n.release(S)};L.remove=function(N,R=null){this._objectCount-=N.length;const S=n.acquire();for(const P of N)N=p.isSome(R)?R:e.copy(this._objectToBoundingSphere(P),G),h(N[3])?(S.init(this._root),this._remove(P,N,S)):this._degenerateObjects.delete(P);n.release(S);this._shrink()};L.update=function(N,R){if(h(R[3])||!this._isDegenerate(N))x[0]=N,N=x,this.remove(N,R),this.add(N)};L.forEachAlongRay=function(N,R,S){const P=w.wrap(N,R);this._forEachNode(this._root,Q=>{if(!this._intersectsNode(P,
Q))return!1;Q=Q.node;Q.terminals.forAll(V=>{this._intersectsObject(P,V)&&S(V)});null!==Q.residents&&Q.residents.forAll(V=>{this._intersectsObject(P,V)&&S(V)});return!0})};L.forEachAlongRayWithVerticalOffset=function(N,R,S,P){const Q=w.wrap(N,R);this._forEachNode(this._root,V=>{if(!this._intersectsNodeWithOffset(Q,V,P))return!1;V=V.node;V.terminals.forAll(ca=>{this._intersectsObjectWithOffset(Q,ca,P)&&S(ca)});null!==V.residents&&V.residents.forAll(ca=>{this._intersectsObjectWithOffset(Q,ca,P)&&S(ca)});
return!0})};L.forEach=function(N){this._forEachNode(this._root,R=>{R=R.node;R.terminals.forAll(N);null!==R.residents&&R.residents.forAll(N);return!0});this._degenerateObjects.forEach(N)};L.forEachDegenerateObject=function(N){this._degenerateObjects.forEach(N)};L.findClosest=function(N,R,S,P=()=>!0,Q=Infinity){let V=Infinity,ca=Infinity,ba=null;const Z=u(N,R),ha=fa=>{--Q;if(P(fa)){var aa=this._objectToBoundingSphere(fa);if(f.intersectsSphere(S,aa)){var W=t(N,R,e.getCenter(aa)),U=W-aa[3];aa=W+aa[3];
U<V&&(V=U,ca=aa,ba=fa)}}};this._forEachNodeDepthOrdered(this._root,fa=>{if(0>=Q||!f.intersectsSphere(S,fa.bounds))return!1;q.scale(A,Z,fa.halfSize);q.add(A,A,fa.bounds);if(t(N,R,A)>ca)return!1;fa=fa.node;fa.terminals.forAll(aa=>ha(aa));null!==fa.residents&&fa.residents.forAll(aa=>ha(aa));return!0},N,R);return ba};L.forEachInDepthRange=function(N,R,S,P,Q,V,ca){let ba=-Infinity,Z=Infinity;const ha={setRange:X=>{1===S?(ba=Math.max(ba,X.near),Z=Math.min(Z,X.far)):(ba=Math.max(ba,-X.far),Z=Math.min(Z,
-X.near))}};ha.setRange(P);const fa=t(R,S,N),aa=u(R,S),W=u(R,-S),U=X=>{if(ca(X)){var T=this._objectToBoundingSphere(X),Y=e.getCenter(T);Y=t(R,S,Y)-fa;var ea=Y+T[3];Y-T[3]>Z||ea<ba||!f.intersectsSphere(V,T)||Q(X,ha)}};this._forEachNodeDepthOrdered(this._root,X=>{if(!f.intersectsSphere(V,X.bounds))return!1;q.scale(A,aa,X.halfSize);q.add(A,A,X.bounds);if(t(R,S,A)-fa>Z)return!1;q.scale(A,W,X.halfSize);q.add(A,A,X.bounds);if(t(R,S,A)-fa<ba)return!1;X=X.node;X.terminals.forAll(T=>U(T));null!==X.residents&&
X.residents.forAll(T=>U(T));return!0},R,S)};L.forEachNode=function(N){this._forEachNode(this._root,R=>N(R.node,R.bounds,R.halfSize))};L._intersectsNode=function(N,R){g(R.bounds,2*-R.halfSize,B);g(R.bounds,2*R.halfSize,D);return l.rayBoxTest(N.origin,N.direction,B,D)};L._intersectsNodeWithOffset=function(N,R,S){g(R.bounds,2*-R.halfSize,B);g(R.bounds,2*R.halfSize,D);S.applyToMinMax(B,D);return l.rayBoxTest(N.origin,N.direction,B,D)};L._intersectsObject=function(N,R){R=this._objectToBoundingSphere(R);
return 0<R[3]?e.intersectsRay(R,N):!0};L._intersectsObjectWithOffset=function(N,R,S){R=this._objectToBoundingSphere(R);return 0<R[3]?e.intersectsRay(S.applyToBoundingSphere(R),N):!0};L._forEachNode=function(N,R){N=n.acquire().init(N);const S=[N];for(;0!==S.length;){N=S.pop();if(R(N)&&!N.isLeaf())for(let P=0;P<N.node.children.length;P++)N.node.children[P]&&S.push(n.acquire().init(N).advance(P));n.release(N)}};L._forEachNodeDepthOrdered=function(N,R,S,P=1){N=n.acquire().init(N);const Q=[N];for(c(S,
P,I);0!==Q.length;){N=Q.pop();if(R(N)&&!N.isLeaf())for(S=7;0<=S;--S)P=I[S],N.node.children[P]&&Q.push(n.acquire().init(N).advance(P));n.release(N)}};L._remove=function(N,R,S){E.clear();R=S.advanceTo(R,(P,Q)=>{E.push(P.node);E.push(Q)})?S.node.terminals:S.node.residents;R.removeUnordered(N);if(0===R.length)for(N=E.length-2;0<=N&&this._purge(E.data[N],E.data[N+1]);N-=2);};L._nodeIsEmpty=function(N){if(0!==N.terminals.length)return!1;if(null!==N.residents)return 0===N.residents.length;for(let R=0;R<
N.children.length;R++)if(N.children[R])return!1;return!0};L._purge=function(N,R){0<=R&&(N.children[R]=null);return this._nodeIsEmpty(N)?(null===N.residents&&(N.residents=new r({shrink:!0})),!0):!1};L._add=function(N,R){R.advanceTo(this._objectToBoundingSphere(N))?R.node.terminals.push(N):(R.node.residents.push(N),R.node.residents.length>this._maximumObjectsPerNode&&R.depth<this._maximumDepth&&this._split(R))};L._split=function(N){const R=N.node.residents;N.node.residents=null;for(let S=0;S<R.length;S++){const P=
n.acquire().init(N);this._add(R.getItemAt(S),P);n.release(P)}};L._grow=function(N,R){0!==R&&(d(N,R,S=>this._objectToBoundingSphere(S),K),h(K[3])&&!this._fitsInsideTree(K)&&(this._nodeIsEmpty(this._root.node)?(e.copy(K,this._root.bounds),this._root.halfSize=1.25*K[3]):(N=this._rootBoundsForRootAsSubNode(K),this._placingRootViolatesMaxDepth(N)?this._rebuildTree(K,N):this._growRootAsSubNode(N),n.release(N))))};L._rebuildTree=function(N,R){q.copy(M,R.bounds);M[3]=R.halfSize;d([N,M],2,S=>S,H);N=n.acquire().init(this._root);
this._root.initFrom(null,H,1.25*H[3]);this._forEachNode(N,S=>{this.add(S.node.terminals.data,S.node.terminals.length);null!==S.node.residents&&this.add(S.node.residents.data,S.node.residents.length);return!0});n.release(N)};L._placingRootViolatesMaxDepth=function(N){const R=Math.log(N.halfSize/this._root.halfSize)*Math.LOG2E;let S=0;this._forEachNode(this._root,P=>{S=Math.max(S,P.depth);return S+R<=this._maximumDepth});return S+R>this._maximumDepth};L._rootBoundsForRootAsSubNode=function(N){var R=
N[3];let S=-Infinity;const P=this._root.bounds,Q=this._root.halfSize;for(var V=0;3>V;V++){var ca=Math.max(0,Math.ceil((P[V]-Q-(N[V]-R))/(2*Q)));const ba=Math.max(0,Math.ceil((N[V]+R-(P[V]+Q))/(2*Q)))+1;S=Math.max(S,2**Math.ceil(Math.log(ca+ba)*Math.LOG2E));J[V].min=ca;J[V].max=ba}for(N=0;3>N;N++)R=J[N].min,V=J[N].max,ca=(S-(R+V))/2,R+=Math.ceil(ca),V+=Math.floor(ca),C[N]=P[N]-Q-R*Q*2+(V+R)*Q;C[3]=S*Q*v;return n.acquire().initFrom(null,C,S*Q,0)};L._growRootAsSubNode=function(N){const R=this._root.node;
q.copy(K,this._root.bounds);K[3]=this._root.halfSize;this._root.init(N);N.advanceTo(K,null,!0);N.node.children=R.children;N.node.residents=R.residents;N.node.terminals=R.terminals};L._shrink=function(){for(;;){const N=this._findShrinkIndex();if(-1===N)break;this._root.advance(N);this._root.depth=0}};L._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let N=null;const R=this._root.node.children;let S=0,P=0;for(;P<R.length&&null==N;)S=P++,N=R[S];for(;P<
R.length;)if(R[P++])return-1;return S};L._isDegenerate=function(N){N=this._objectToBoundingSphere(N)[3];return!h(N)};L._fitsInsideTree=function(N){const R=this._root.bounds,S=this._root.halfSize;return N[3]<=S&&N[0]>=R[0]-S&&N[0]<=R[0]+S&&N[1]>=R[1]-S&&N[1]<=R[1]+S&&N[2]>=R[2]-S&&N[2]<=R[2]+S};a._createClass(F,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",
get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return F}(),n=function(){function F(){this.bounds=e.create();this.halfSize=0;this.initFrom(null,null,0,0)}var L=F.prototype;L.init=function(N){return this.initFrom(N.node,N.bounds,N.halfSize,N.depth)};L.initFrom=function(N,R,S,P=this.depth){this.node=p.isSome(N)?N:F.createEmptyNode();p.isSome(R)&&e.copy(R,this.bounds);this.halfSize=
S;this.depth=P;return this};L.advance=function(N){let R=this.node.children[N];R||(R=F.createEmptyNode(),this.node.children[N]=R);this.node=R;this.halfSize/=2;this.depth++;N=z[N];this.bounds[0]+=N[0]*this.halfSize;this.bounds[1]+=N[1]*this.halfSize;this.bounds[2]+=N[2]*this.halfSize;this.bounds[3]=this.halfSize*v;return this};L.advanceTo=function(N,R,S=!1){for(;;){if(this.isTerminalFor(N))return R&&R(this,-1),!0;if(this.isLeaf()){if(!S)return R&&R(this,-1),!1;this.node.residents=null}const P=this._childIndex(N);
R&&R(this,P);this.advance(P)}};L.isLeaf=function(){return null!=this.node.residents};L.isTerminalFor=function(N){return N[3]>this.halfSize/2};L._childIndex=function(N){const R=this.bounds;return(R[0]<N[0]?1:0)+(R[1]<N[1]?2:0)+(R[2]<N[2]?4:0)};F.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new r({shrink:!0}),residents:new r({shrink:!0})}};F.acquire=function(){return F._pool.acquire()};F.release=function(N){F._pool.release(N)};F.clearPool=function(){F._pool.prune()};
return F}();n._pool=new b(n);const z=[y.fromValues(-1,-1,-1),y.fromValues(1,-1,-1),y.fromValues(-1,1,-1),y.fromValues(1,1,-1),y.fromValues(-1,-1,1),y.fromValues(1,-1,1),y.fromValues(-1,1,1),y.fromValues(1,1,1)],k=[y.fromValues(-1,-1,-1),y.fromValues(-1,-1,1),y.fromValues(-1,1,-1),y.fromValues(-1,1,1),y.fromValues(1,-1,-1),y.fromValues(1,-1,1),y.fromValues(1,1,-1),y.fromValues(1,1,1)],v=Math.sqrt(3),x=[null],C=e.create(),A=y.create(),B=y.create(),D=y.create(),E=new r,G=e.create(),K=e.create(),M=e.create(),
H=e.create(),J=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],O=new r,I=[0,0,0,0,0,0,0,0];return m})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./VisualVariableMaterialParameters ./renderers/utils ../shaders/RibbonLineTechnique".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z){function k(ha,fa,aa,W,U){for(let X=0;X<U;X++)aa[W++]=ha[fa++];return W}function v(ha,fa,aa){fa=fa.get("position").data;aa=aa?aa.get("position"):null;return ha.isClosed?aa?2<aa.length:6<fa.length:!1}const x=b.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");b=function(ha){function fa(W){W=ha.call(this,W,A)||this;W._vertexAttributeLocations=z.ribbonVertexAttributeLocations;W.techniqueConfig=new z.RibbonLineTechniqueConfiguration;W.layout=
W.createLayout();return W}p._inheritsLoose(fa,ha);var aa=fa.prototype;aa.isClosed=function(W,U){return this.params.isClosed?U?2<U.length:6<W.length:!1};aa.dispose=function(){};aa.getPassParameters=function(){return this.params};aa.getTechniqueConfig=function(W,U){this.techniqueConfig.output=W;W=q.isSome(U)&&23===U.slot;this.techniqueConfig.draped=W;W=q.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=W;this.techniqueConfig.stippleIntegerRepeatsEnabled=W&&this.params.stippleIntegerRepeats;
this.techniqueConfig.stippleOffColorEnabled=W&&q.isSome(this.params.stippleOffColor);this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.roundJoins="round"===this.params.join;this.techniqueConfig.roundCaps="round"===this.params.cap;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;
this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.params.innerWidth&&q.isSome(this.params.innerColor);this.techniqueConfig.falloffEnabled=0<this.params.falloff;this.techniqueConfig.occluder=8===this.params.renderOccluded;this.techniqueConfig.transparencyPassType=U?U.transparencyPassType:3;this.techniqueConfig.multipassTerrainEnabled=
U?U.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=U?U.cullAboveGround:!1;return this.techniqueConfig};aa.intersect=function(W,U,X,T,Y,ea,ia,la,pa){pa?this.intersectDrapedLineGeometry(W,T,ea,ia):this.intersectLineGeometry(W,U,X,T,this.params.width,ia)};aa.intersectDrapedLineGeometry=function(W,U,X,T){if(U.options.selectionMode){U=W.vertexAttributes.get("position").data;var Y=W.vertexAttributes.get("size"),ea=this.params.width;this.params.vvSizeEnabled?(Y=W.vertexAttributes.get("sizeFeatureAttribute").data[0],
ea*=r.clamp(this.params.vvSizeOffset[0]+Y*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])):Y&&(ea*=Y.data[0]);Y=X[0];X=X[1];W=(ea/2+4)*W.screenToWorldRatio;ea=Number.MAX_VALUE;for(let wa=0;wa<U.length-5;wa+=3){var ia=U[wa],la=U[wa+1],pa=Y-ia,ua=X-la;ia=U[wa+3]-ia;la=U[wa+4]-la;const Fa=r.clamp((ia*pa+la*ua)/(ia*ia+la*la),0,1);pa=ia*Fa-pa;ua=la*Fa-ua;ua=pa*pa+ua*ua;ua<ea&&(ea=ua)}ea<W*W&&T()}};aa.intersectLineGeometry=function(W,U,X,T,Y,ea){if(T.options.selectionMode&&
!n.isInstanceHidden(U))if(h.isTranslationMatrix(X)){var ia=W.vertexAttributes;U=ia.get("position").data;if(this.params.vvSizeEnabled){var la=ia.get("sizeFeatureAttribute").data[0];Y*=r.clamp(this.params.vvSizeOffset[0]+la*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else ia.has("size")&&(Y*=ia.get("size").data[0]);la=T.camera;var pa=M;f.copy(pa,T.point);Y=Y*la.pixelRatio/2+4*la.pixelRatio;w.set(P[0],pa[0]-Y,pa[1]+Y,0);w.set(P[1],pa[0]+Y,pa[1]+Y,0);w.set(P[2],
pa[0]+Y,pa[1]-Y,0);w.set(P[3],pa[0]-Y,pa[1]-Y,0);for(var ua=0;4>ua;ua++)if(!la.unprojectFromRenderScreen(P[ua],Q[ua]))return;g.fromPoints(la.eye,Q[0],Q[1],V);g.fromPoints(la.eye,Q[1],Q[2],ca);g.fromPoints(la.eye,Q[2],Q[3],ba);g.fromPoints(la.eye,Q[3],Q[0],Z);ua=Number.MAX_VALUE;W=v(this.params,ia,W.indices)?U.length-2:U.length-5;for(ia=0;ia<W;ia+=3){D[0]=U[ia]+X[12];D[1]=U[ia+1]+X[13];D[2]=U[ia+2]+X[14];var wa=(ia+3)%U.length;E[0]=U[wa]+X[12];E[1]=U[wa+1]+X[13];E[2]=U[wa+2]+X[14];if(!(0>g.signedDistance(V,
D)&&0>g.signedDistance(V,E)||0>g.signedDistance(ca,D)&&0>g.signedDistance(ca,E)||0>g.signedDistance(ba,D)&&0>g.signedDistance(ba,E)||0>g.signedDistance(Z,D)&&0>g.signedDistance(Z,E))){la.projectToRenderScreen(D,H);la.projectToRenderScreen(E,J);if(0>H[2]&&0<J[2])w.subtract(G,D,E),wa=la.frustum,wa=-g.signedDistance(wa[4],D)/w.dot(G,g.normal(wa[4])),w.scale(G,G,wa),w.add(D,D,G),la.projectToRenderScreen(D,H);else if(0<H[2]&&0>J[2])w.subtract(G,E,D),wa=la.frustum,wa=-g.signedDistance(wa[4],E)/w.dot(G,
g.normal(wa[4])),w.scale(G,G,wa),w.add(E,E,G),la.projectToRenderScreen(E,J);else if(0>H[2]&&0>J[2])continue;H[2]=0;J[2]=0;wa=l.distance2(l.fromPoints(H,J,F),pa);wa<ua&&(ua=wa,w.copy(O,D),w.copy(I,E))}}X=T.rayBeginPoint;T=T.rayEndPoint;ua<Y*Y&&(U=Number.MAX_VALUE,l.closestLineSegmentPoint(l.fromPoints(O,I,F),l.fromPoints(X,T,L),K)&&(w.subtract(K,K,X),U=w.length(K),w.scale(K,K,1/U),U/=w.distance(X,T)),ea(U,K))}else x.error("intersection assumes a translation-only matrix")};aa.computeAttachmentOrigin=
function(W,U){const X=W.vertexAttributes;if(!X)return null;W=W.indices;const T=X.get("position");return c.computeAttachmentOriginLines(T,W?W.get("position"):null,W&&v(this.params,X,W),U)};aa.createLayout=function(){const W=d.newLayout().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");this.params.vvSizeEnabled?W.f32("sizeFeatureAttribute"):W.f32("size");this.params.vvColorEnabled?W.f32("colorFeatureAttribute"):W.vec4f("color");this.params.vvOpacityEnabled&&
W.f32("opacityFeatureAttribute");return W};aa.createBufferWriter=function(){return new B(this.layout,this.params)};aa.getGLMaterial=function(W){return 0===W.output||7===W.output||4===W.output||1===W.output?new C(W):void 0};aa.validateParameterValues=function(W){"miter"!==W.join&&(W.miterLimit=0);this.requiresTransparent(W)&&(W.transparent=!0)};aa.requiresTransparent=function(W){return!!(1>(W.color&&W.color[3])||0<W.innerWidth&&this.colorRequiresTransparent(W.innerColor)||W.stipplePattern&&this.colorRequiresTransparent(W.stippleOffColor)||
0<W.falloff)};aa.colorRequiresTransparent=function(W){return q.isSome(W)&&1>W[3]&&0<W[3]};return fa}(t.Material);let C=function(ha){function fa(W){W=ha.call(this,W)||this;W.updateParameters();return W}p._inheritsLoose(fa,ha);var aa=fa.prototype;aa.updateParameters=function(W){this._technique=this._techniqueRep.releaseAndAcquire(z.RibbonLineTechnique,this._material.getTechniqueConfig(this._output,W),this._technique)};aa.beginSlot=function(W){return 23===W?!0:this._technique.configuration.occluder?
3===W||10===W||11===W:0===this._output||7===this._output?(this.targetSlot=this._technique.configuration.writeDepth?5:8,W===this.targetSlot):3===W};aa._updateOccludeeState=function(W){W.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:W.hasOccludees})};aa.ensureParameters=function(W){0!==this._output&&7!==this._output||this._updateOccludeeState(W);this.updateParameters(W)};aa.bind=function(W){this._technique.bindPass(this._material.getPassParameters(),
W)};aa.getPipelineState=function(W,U){return this._technique.getPipelineState(W,U)};return fa}(u);const A={width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...t.materialParametersDefaults,...m.Default};let B=function(){function ha(aa,W){this.params=W;this.numJoinSubdivisions=
0;this.vertexBufferLayout=aa;switch(this.params.join){case "miter":case "bevel":this.numJoinSubdivisions=W.stipplePattern?1:0;break;case "round":this.numJoinSubdivisions=1}}var fa=ha.prototype;fa.isClosed=function(aa){return v(this.params,aa.vertexAttributes,aa.indices)};fa.numCapSubdivisions=function(aa){if(this.isClosed(aa))return 0;switch(this.params.cap){case "butt":return 0;case "square":return 1;case "round":return 3}};fa.allocate=function(aa){return this.vertexBufferLayout.createBuffer(aa)};
fa.elementCount=function(aa){var W=2*this.numCapSubdivisions(aa)+2,U=aa.indices.get("position").length/2+1;const X=this.isClosed(aa);W=X?2:2*W;var T=X?0:1;U=X?U:U-1;if(aa.vertexAttributes.has("subdivisions"))for(aa=aa.vertexAttributes.get("subdivisions").data;T<U;++T)W+=4+2*aa[T];else W+=(U-T)*(2*this.numJoinSubdivisions+4);return W+2};fa.write=function(aa,W,U,X){const T=N,Y=R,ea=S;var ia=W.vertexAttributes.get("position").data,la=W.indices&&W.indices.get("position");const pa=this.numCapSubdivisions(W);
la&&la.length!==2*(ia.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");la=null;W.vertexAttributes.has("subdivisions")&&(la=W.vertexAttributes.get("subdivisions").data);let ua=1,wa=0;this.params.vvSizeEnabled?wa=W.vertexAttributes.get("sizeFeatureAttribute").data[0]:W.vertexAttributes.has("size")&&(ua=W.vertexAttributes.get("size").data[0]);let Fa=[1,1,1,1],La=0;this.params.vvColorEnabled?La=W.vertexAttributes.get("colorFeatureAttribute").data[0]:W.vertexAttributes.has("color")&&
(Fa=W.vertexAttributes.get("color").data);let Ma=0;this.params.vvOpacityEnabled&&(Ma=W.vertexAttributes.get("opacityFeatureAttribute").data[0]);const Sa=ia.length/3;aa=aa.transformation;const Ia=new Float32Array(U.buffer);U=this.vertexBufferLayout.stride/4;let va=X*U;X=va;let ma=0;const ta=(sa,Ja,Ta,da,qa,ra,Da,Pa)=>{Ia[va++]=Ja[0];Ia[va++]=Ja[1];Ia[va++]=Ja[2];Ia[va++]=da;Ia[va++]=Pa;Ia[va++]=ra+qa/10;Ia[va++]=sa[0];Ia[va++]=sa[1];Ia[va++]=sa[2];Ia[va++]=Ta[0];Ia[va++]=Ta[1];Ia[va++]=Ta[2];this.params.vvSizeEnabled?
Ia[va++]=wa:Ia[va++]=ua;this.params.vvColorEnabled?Ia[va++]=La:(sa=Math.min(4*Da,Fa.length-4),Ia[va++]=Fa[sa+0],Ia[va++]=Fa[sa+1],Ia[va++]=Fa[sa+2],Ia[va++]=Fa[sa+3]);this.params.vvOpacityEnabled&&(Ia[va++]=Ma)};va+=U;w.set(Y,ia[0],ia[1],ia[2]);aa&&w.transformMat4(Y,Y,aa);if(W=this.isClosed(W)){var Ea=ia.length-3;w.set(T,ia[Ea],ia[Ea+1],ia[Ea+2]);aa&&w.transformMat4(T,T,aa)}else{w.copy(T,Y);w.set(ea,ia[3],ia[4],ia[5]);aa&&w.transformMat4(ea,ea,aa);for(Ea=0;Ea<pa;++Ea){var Ca=1-Ea/pa;ta(T,Y,ea,Ca,
1,-4,0,ma);ta(T,Y,ea,Ca,1,4,0,ma)}ta(T,Y,ea,0,0,-4,0,ma);ta(T,Y,ea,0,0,4,0,ma);w.copy(T,Y);w.copy(Y,ea)}Ca=W?0:1;Ea=W?Sa:Sa-1;for(let sa=Ca;sa<Ea;sa++){var ka=(sa+1)%Sa*3;w.set(ea,ia[ka+0],ia[ka+1],ia[ka+2]);aa&&w.transformMat4(ea,ea,aa);ma+=w.distance(T,Y);ta(T,Y,ea,0,1,-1,sa,ma);ta(T,Y,ea,0,1,1,sa,ma);ka=la?la[sa]:this.numJoinSubdivisions;for(let Ja=0;Ja<ka;++Ja){const Ta=(Ja+1)/(ka+1);ta(T,Y,ea,Ta,1,-2,sa,ma);ta(T,Y,ea,Ta,1,2,sa,ma)}ta(T,Y,ea,1,0,-2,sa,ma);ta(T,Y,ea,1,0,2,sa,ma);w.copy(T,Y);w.copy(Y,
ea)}if(W)w.set(ea,ia[3],ia[4],ia[5]),aa&&w.transformMat4(ea,ea,aa),ma+=w.distance(T,Y),ta(T,Y,ea,0,1,-1,Ca,ma),ta(T,Y,ea,0,1,1,Ca,ma);else for(ma+=w.distance(T,Y),ta(T,Y,ea,0,1,-5,Ea,ma),ta(T,Y,ea,0,1,5,Ea,ma),ia=0;ia<pa;++ia)la=(ia+1)/pa,ta(T,Y,ea,la,1,-5,Ea,ma),ta(T,Y,ea,la,1,5,Ea,ma);k(Ia,X+U,Ia,X,U);va=k(Ia,va-U,Ia,va,U)};return ha}();const D=e.create(),E=e.create(),G=e.create(),K=e.create(),M=e.create(),H=y.createRenderScreenPointArray3(),J=y.createRenderScreenPointArray3(),O=e.create(),I=e.create(),
F=l.create(),L=l.create(),N=e.create(),R=e.create(),S=e.create(),P=[y.createRenderScreenPointArray3(),y.createRenderScreenPointArray3(),y.createRenderScreenPointArray3(),y.createRenderScreenPointArray3()],Q=[e.create(),e.create(),e.create(),e.create()],V=g.create(),ca=g.create(),ba=g.create(),Z=g.create();a.RibbonLineMaterial=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["../../../../chunks/mat3f64",
"../../../../chunks/vec3f32"],function(a,p){var b;(b||(b={})).Default={vvSizeEnabled:!1,vvSizeMinSize:p.fromValues(1,1,1),vvSizeMaxSize:p.fromValues(100,100,100),vvSizeOffset:p.fromValues(0,0,0),vvSizeFactor:p.fromValues(1,1,1),vvSizeValue:p.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,
0],vvSymbolRotationMatrix:a.create()};return b})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/RibbonLine.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n){const z=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]);d=function(v){function x(A,B,D){B=v.call(this,A,B,D)||this;B.stippleTextureRepository=A.stippleTextureRepository;return B}b._inheritsLoose(x,v);var C=x.prototype;C.initializeProgram=function(A){var B=x.shader.get();const D=this.configuration;B=B.build({OITEnabled:0===
D.transparencyPassType,output:D.output,slicePlaneEnabled:D.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:D.draped,stippleEnabled:D.stippleEnabled,stippleOffColorEnabled:D.stippleOffColorEnabled,stippleUVMaxEnabled:D.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:D.stippleIntegerRepeatsEnabled,roundCaps:D.roundCaps,roundJoins:D.roundJoins,vvColor:D.vvColor,vvSize:D.vvSize,vvInstancingEnabled:!0,vvOpacity:D.vvOpacity,falloffEnabled:D.falloffEnabled,innerColorEnabled:D.innerColorEnabled,
multipassTerrainEnabled:D.multipassTerrainEnabled,cullAboveGround:D.cullAboveGround});return new t.Program(A.rctx,B,z)};C.dispose=function(){v.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};C.bindPass=function(A,B){l.bindProjectionMatrix(this.program,B.camera.projectionMatrix);4===this.configuration.output&&f.bindOutputHighlight(this.program,B);B.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",
B.inverseViewport),w.bindMultipassTerrainTexture(this.program,B));this.program.setUniform1f("intrinsicWidth",A.width);this.program.setUniform4fv("intrinsicColor",A.color);this.program.setUniform1f("miterLimit","miter"!==A.join?0:A.miterLimit);this.program.setUniform2fv("cameraNearFar",B.camera.nearFar);this.program.setUniform1f("pixelRatio",B.camera.pixelRatio);this.program.setUniform2f("screenSize",B.camera.fullViewport[2],B.camera.fullViewport[3]);e.bindVisualVariablesUniformsWithOpacity(this.program,
A);if(this.stipplePattern!==A.stipplePattern){var D=A.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,D);this.stipplePattern=D}if(this.configuration.stippleEnabled){const {pixelSize:E,sdfNormalizer:G}=q.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1};this.program.setUniform1f("stipplePatternSDFNormalizer",G);this.configuration.draped?(this.program.setUniform1f("stipplePatternPixelSizeInv",1/E),this.program.setUniform1f("worldToScreenRatio",
1/B.screenToWorldRatio)):this.program.setUniform1f("stipplePatternPixelSizeInv",1/(E*B.camera.pixelRatio));this.configuration.stippleOffColorEnabled&&(D=q.unwrap(A.stippleOffColor),this.program.setUniform4f("stippleOffColor",D[0],D[1],D[2],3<D.length?D[3]:1))}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",A.falloff);this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",q.unwrapOr(A.innerColor,A.color)),this.program.setUniform1f("innerWidth",A.innerWidth*
B.camera.pixelRatio))};C.bindDraw=function(A){l.bindView(this.program,A);y.bindSliceUniformsWithOrigin(this.program,this.configuration,A);this.program.rebindTextures()};C.setPipelineState=function(A,B){const D=this.configuration,E=3===A,G=2===A;return n.makePipelineState({blending:0===D.output||7===D.output?E?u.blendingDefault:u.OITBlending(A):null,depthTest:{func:u.OITDepthTest(A)},depthWrite:E?!D.transparent&&D.writeDepth&&n.defaultDepthWriteParams:u.OITDepthWrite(A),colorWrite:n.defaultColorWriteParams,
stencilWrite:D.sceneHasOcludees?h.stencilWriteMaskOn:null,stencilTest:D.sceneHasOcludees?B?h.stencilToolMaskBaseParams:h.stencilBaseAllZerosParams:null,polygonOffset:E||G?D.polygonOffset&&k:u.OITPolygonOffset})};C.initializePipeline=function(){const A=this.configuration,B=A.polygonOffset&&k;A.occluder&&(this._occluderPipelineTransparent=n.makePipelineState({blending:u.blendingDefault,polygonOffset:B,depthTest:h.depthCompareAlways,depthWrite:null,colorWrite:n.defaultColorWriteParams,stencilWrite:null,
stencilTest:h.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=n.makePipelineState({blending:u.blendingDefault,polygonOffset:B,depthTest:h.depthCompareAlways,depthWrite:null,colorWrite:n.defaultColorWriteParams,stencilWrite:h.stencilWriteMaskOff,stencilTest:h.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=n.makePipelineState({blending:null,polygonOffset:B,depthTest:h.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:h.stencilWriteMaskOn,stencilTest:h.stencilToolMaskBaseParams}));
this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,!1)};C.getPipelineState=function(A,B){return B?this._occludeePipelineState:this.configuration.occluder?11===A?this._occluderPipelineTransparent:10===A?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline};b._createClass(x,[{key:"primitiveType",get:function(){return 5}}]);return x}(d.ShaderTechnique);d.shader=new g.ReloadableShaderModule(m.RibbonLineShader,
()=>new Promise(function(v,x){a(["./RibbonLine.glsl"],v,x)}));const k={factor:0,units:-4};g=function(v){function x(){var C=v.apply(this,arguments)||this;C.output=0;C.occluder=!1;C.slicePlaneEnabled=!1;C.transparent=!1;C.polygonOffset=!1;C.writeDepth=!1;C.draped=!1;C.stippleEnabled=!1;C.stippleOffColorEnabled=!1;C.stippleIntegerRepeatsEnabled=!1;C.roundCaps=!1;C.roundJoins=!1;C.vvSize=!1;C.vvColor=!1;C.vvOpacity=!1;C.falloffEnabled=!1;C.innerColorEnabled=!1;C.sceneHasOcludees=!1;C.transparencyPassType=
3;C.multipassTerrainEnabled=!1;C.cullAboveGround=!1;return C}b._inheritsLoose(x,v);return x}(c.ShaderTechniqueConfiguration);r.__decorate([c.parameter({count:8})],g.prototype,"output",void 0);r.__decorate([c.parameter()],g.prototype,"occluder",void 0);r.__decorate([c.parameter()],g.prototype,"slicePlaneEnabled",void 0);r.__decorate([c.parameter()],g.prototype,"transparent",void 0);r.__decorate([c.parameter()],g.prototype,"polygonOffset",void 0);r.__decorate([c.parameter()],g.prototype,"writeDepth",
void 0);r.__decorate([c.parameter()],g.prototype,"draped",void 0);r.__decorate([c.parameter()],g.prototype,"stippleEnabled",void 0);r.__decorate([c.parameter()],g.prototype,"stippleOffColorEnabled",void 0);r.__decorate([c.parameter()],g.prototype,"stippleIntegerRepeatsEnabled",void 0);r.__decorate([c.parameter()],g.prototype,"roundCaps",void 0);r.__decorate([c.parameter()],g.prototype,"roundJoins",void 0);r.__decorate([c.parameter()],g.prototype,"vvSize",void 0);r.__decorate([c.parameter()],g.prototype,
"vvColor",void 0);r.__decorate([c.parameter()],g.prototype,"vvOpacity",void 0);r.__decorate([c.parameter()],g.prototype,"falloffEnabled",void 0);r.__decorate([c.parameter()],g.prototype,"innerColorEnabled",void 0);r.__decorate([c.parameter()],g.prototype,"sceneHasOcludees",void 0);r.__decorate([c.parameter({count:4})],g.prototype,"transparencyPassType",void 0);r.__decorate([c.parameter()],g.prototype,"multipassTerrainEnabled",void 0);r.__decorate([c.parameter()],g.prototype,"cullAboveGround",void 0);
p.RibbonLineTechnique=d;p.RibbonLineTechniqueConfiguration=g;p.ribbonVertexAttributeLocations=z;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports"],function(a){a.depthCompareAlways={func:519};a.depthCompareLess={func:513};a.renderWhenBitIsNotSet=p=>({function:{func:517,ref:p,mask:p},operation:{fail:7680,zFail:7680,zPass:7680}});a.replaceBitWhenDepthTestPasses=p=>({function:{func:519,ref:p,mask:p},operation:{fail:7680,zFail:7680,
zPass:7681}});a.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}};a.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}};a.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};a.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn=
{mask:255};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/support/debugFlags ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){function u(h){const m=new c.ShaderBuilder;m.extensions.add("GL_OES_standard_derivatives");m.include(e.PiUtils);m.include(r.RibbonVertexPosition,h);m.include(f.LineStipple,h);1===h.output&&m.include(q.OutputDepth,h);m.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2");m.attributes.add("position","vec3");m.attributes.add("subdivisionFactor","float");m.attributes.add("uv0",
"vec2");m.attributes.add("auxpos1","vec3");m.attributes.add("auxpos2","vec3");m.varyings.add("vColor","vec4");m.varyings.add("vpos","vec3");m.varyings.add("linearDepth","float");h.multipassTerrainEnabled&&m.varyings.add("depth","float");const n=h.draped&&p.ENABLE_CONTINUOUS_LINE_PATTERNS,z=h.falloffEnabled,k=n&&h.stippleEnabled&&h.roundCaps,v=h.innerColorEnabled||k;k&&m.varyings.add("stippleCapRadius","float");v&&m.varyings.add("vLineDistance","float");z&&m.varyings.add("vLineDistanceNorm","float");
h.falloffEnabled&&m.fragment.uniforms.add("falloff","float");h.innerColorEnabled&&(m.fragment.uniforms.add("innerColor","vec4"),m.fragment.uniforms.add("innerWidth","float"));m.vertex.code.add(d.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);m.vertex.code.add(d.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`);m.vertex.code.add(d.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = cameraNearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -cameraNearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -cameraNearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -cameraNearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -cameraNearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -cameraNearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${h.multipassTerrainEnabled?"depth \x3d pos.z;":""}
      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`);m.vertex.code.add(d.glsl`void main(void) {
float uvY = floor(uv0.y);
float uvZ = fract(uv0.y) * 10.0;
float coverage = 1.0;
vpos = position;
if (uvY == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
bool isStartVertex = abs(abs(uvY)-3.0) == 1.0;
bool isJoin = abs(uvY)-3.0 < 0.0;
float lineWidth = getSize() * pixelRatio;
if (lineWidth < 1.0) {
coverage = lineWidth;
lineWidth = 1.0;
}else{
lineWidth = floor(lineWidth + 0.5);
}
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
vec4 next = view * vec4(auxpos2.xyz, 1.0);
clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);h.stippleEnabled&&m.vertex.code.add(d.glsl`vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uvZ);
vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;
vec2 stippleSegment = stippleSegmentInfo.zw;`);m.vertex.code.add(d.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uvY > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);h.roundJoins?m.vertex.code.add(d.glsl`vec2 startDir;
vec2 endDir;
if (leftLen < 0.001) {
startDir = right;
}
else{
startDir = left;
}
startDir = normalize(startDir);
startDir = PERPENDICULAR(startDir);
if (rightLen < 0.001) {
endDir = left;
}
else{
endDir = right;
}
endDir = normalize(endDir);
endDir = PERPENDICULAR(endDir);
float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
joinDisplacementDir = rotate(startDir, -sign(uvY) * subdivisionFactor * rotationAngle);`):m.vertex.code.add(d.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);m.vertex.code.add(d.glsl`displacementLen = lineWidth;
}
} else {
if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
displacementLen = lineWidth;
capDisplacementDir = isStartVertex ? -right : left;`);h.roundCaps?m.vertex.code.add(d.glsl`float angle = subdivisionFactor*PI*0.5;
joinDisplacementDir *= cos(angle);
capDisplacementDir *= sin(angle);`):m.vertex.code.add(d.glsl`capDisplacementDir *= subdivisionFactor;`);m.vertex.code.add(d.glsl`
  }

  // Displacement (in pixels) caused by join/or cap
  vec2 dpos = joinDisplacementDir * sign(uvY) * displacementLen + capDisplacementDir * displacementLen;

  ${k?d.glsl`stippleCapRadius = lineWidth;`:""}

  ${z||v?d.glsl`float lineDist = lineWidth * sign(uvY) * pos.w;`:""}

  ${v?d.glsl`vLineDistance = lineDist;`:""}
  ${z?d.glsl`vLineDistanceNorm = lineDist / lineWidth;`:""}

  pos.xy += dpos;
  `);h.stippleEnabled&&(n?m.vertex.code.add(d.glsl`{
stipplePatternUv = uv0.x;
float stippleSegmentScreenLength = length(stippleSegment);
float stippleSegmentRenderLength = length(mix(auxpos2 - position, position - auxpos1, uvZ));
if (stippleSegmentScreenLength >= 0.001) {
vec2 stippleDisplacement = pos.xy - stippleSegmentOrigin;
float stippleDisplacementFactor = dot(stippleSegment, stippleDisplacement) / (stippleSegmentScreenLength * stippleSegmentScreenLength);
stipplePatternUv += (stippleDisplacementFactor - uvZ) * stippleSegmentRenderLength;
}
stipplePatternUv *= worldToScreenRatio;
}`):(m.vertex.code.add(d.glsl`{
vec2 posVec = pos.xy - stippleSegmentOrigin;
float stippleSegmentDirectionLength = length(stippleSegment);`),h.stippleIntegerRepeatsEnabled&&m.vertex.code.add(d.glsl`float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;
float roundedNumberOfPatternRepeats = floor(numberOfPatternRepeats);
stipplePatternUvMax = roundedNumberOfPatternRepeats;`),m.vertex.code.add(d.glsl`
        if (stippleSegmentDirectionLength >= 0.001) {
          // Project the vertex position onto the line segment.
          float projectedLength = dot(stippleSegment, posVec) / stippleSegmentDirectionLength * 0.5;
          ${h.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale \x3d roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale \x3d 1.0;"}
          stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;
        } else {
          stipplePatternUv = 1.0;
        }
      }
    `)));m.vertex.code.add(d.glsl`pos.xy = pos.xy / screenSize * pos.w;
vColor = getColor();
vColor.a *= coverage;
gl_Position = pos;
}
}`);h.multipassTerrainEnabled&&(m.fragment.include(y.ReadLinearDepth),m.include(w.multipassTerrainTest,h));m.include(b.Slice,h);m.fragment.uniforms.add("intrinsicColor","vec4");m.fragment.include(g.ColorConversion);m.fragment.code.add(d.glsl`
  void main() {
    discardBySlice(vpos);
    ${h.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
  `);k?m.fragment.code.add(d.glsl`vec2 stipplePosition = vec2(
clamp(stippleCapRadius - getStippleSDF(), 0.0, stippleCapRadius),
vLineDistance
) / stippleCapRadius;
float stippleRadius = dot(stipplePosition, stipplePosition);
float stippleAlpha = step(stippleRadius, 1.0);`):m.fragment.code.add(d.glsl`float stippleAlpha = getStippleAlpha();`);m.fragment.code.add(d.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`);h.innerColorEnabled&&(m.fragment.uniforms.add("pixelRatio","float"),m.fragment.code.add(d.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`));m.fragment.code.add(d.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`);h.falloffEnabled&&m.fragment.code.add(d.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`);m.fragment.code.add(d.glsl`
    if (finalColor.a < ${d.glsl.float(l.symbolAlphaCutoff)}) {
      discard;
    }

    ${7===h.output?d.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===h.output?d.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===h.output&&h.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${4===h.output?d.glsl`gl_FragColor = vec4(1.0);`:""}
    ${1===h.output?d.glsl`outputDepth(linearDepth);`:""}
  }
  `);return m}var t=Object.freeze({__proto__:null,build:u});a.RibbonLineShader=t;a.build=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.RibbonVertexPosition=function(b,r){b.vertex.uniforms.add("intrinsicWidth","float");r.vvSize?(b.attributes.add("sizeFeatureAttribute","float"),b.vertex.uniforms.add("vvSizeMinSize","vec3"),b.vertex.uniforms.add("vvSizeMaxSize","vec3"),b.vertex.uniforms.add("vvSizeOffset",
"vec3"),b.vertex.uniforms.add("vvSizeFactor","vec3"),b.vertex.code.add(p.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(b.attributes.add("size","float"),b.vertex.code.add(p.glsl`float getSize(){
return intrinsicWidth * size;
}`));r.vvOpacity?(b.attributes.add("opacityFeatureAttribute","float"),b.vertex.constants.add("vvOpacityNumber","int",8),b.vertex.code.add(p.glsl`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):b.vertex.code.add(p.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);r.vvColor?(b.attributes.add("colorFeatureAttribute","float"),b.vertex.constants.add("vvColorNumber","int",8),b.vertex.code.add(p.glsl`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(b.attributes.add("color","vec4"),b.vertex.code.add(p.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,p,b){a.OutputDepth=function(r,q){r.fragment.include(p.RgbaFloatEncoding);3===q.output?(r.extensions.add("GL_OES_standard_derivatives"),r.fragment.code.add(b.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):1===q.output&&r.fragment.code.add(b.glsl`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define(["exports","../../../../support/debugFlags","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,p,b,r){a.LineStipple=function(q,y){q.constants.add("stippleAlphaColorDiscard","float",.001);q.constants.add("stippleAlphaHighlightDiscard","float",.5);if(y.stippleEnabled){{q.fragment.include(b.RgbaFloatEncoding);const f=y.draped&&
p.ENABLE_CONTINUOUS_LINE_PATTERNS;f?q.vertex.uniforms.add("worldToScreenRatio","float"):q.vertex.uniforms.add("stipplePatternPixelSizeInv","float");y.stippleUVMaxEnabled&&q.varyings.add("stipplePatternUvMax","float");q.varyings.add("stipplePatternUv","float");q.fragment.uniforms.add("stipplePatternTexture","sampler2D");q.fragment.uniforms.add("stipplePatternSDFNormalizer","float");f&&q.fragment.uniforms.add("stipplePatternPixelSizeInv","float");y.stippleOffColorEnabled&&q.fragment.uniforms.add("stippleOffColor",
"vec4");f?q.fragment.code.add(r.glsl`float getStippleValue() {
return rgba2float(texture2D(stipplePatternTexture, vec2(mod(stipplePatternUv * stipplePatternPixelSizeInv, 1.0), 0.5)));
}`):q.fragment.code.add(r.glsl`
      float getStippleValue() {
        float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;
        ${y.stippleUVMaxEnabled?"stipplePatternUvClamped \x3d clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":""}
        return rgba2float(texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)));
      }
    `);q.fragment.code.add(r.glsl`float getStippleSDF() {
return (getStippleValue() * 2.0 - 1.0) * stipplePatternSDFNormalizer;
}
float getStippleAlpha() {
return clamp(getStippleSDF() + 0.5, 0.0, 1.0);
}`);y.stippleOffColorEnabled?q.fragment.code.add(r.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):q.fragment.code.add(r.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}}else q.fragment.code.add(r.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./Camera"],function(a,p,b){let r=function(){function y(f){this.rctx=f;this.camera=null;this.lastFrameCamera=new b;this.slot=this.pass=0;this.highlightDepthTexture=null;this.renderOccludedMask=13;this.hasOccludees=!1}y.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=
13};p._createClass(y,[{key:"isHighlightPass",get:function(){return 5===this.pass}}]);return y}(),q=function(y){function f(w,e,l,g,d,c){w=y.call(this,w)||this;w.offscreenRenderingHelper=e;w.scenelightingData=l;w.shadowMap=g;w.ssaoHelper=d;w.sliceHelper=c;return w}p._inheritsLoose(f,y);return f}(r);a.OverlayRenderContext=r;a.RenderContext=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ./ChangeSet ./Material ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){a.SortedRenderGeometryRenderer=function(m){function n(){var k=m.apply(this,arguments)||this;k._pending=new h;k._changes=new d.ChangeSet;k._materialRenderers=new Map;k._sortedMaterialRenderers=new y;k._hasHighlights=!1;k._hasWater=!1;return k}p._inheritsLoose(n,m);var z=n.prototype;z.dispose=function(){this._changes.prune();this._materialRenderers.forEach(k=>k.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear()};z.commitChanges=function(){if(!this.updating)return!1;
this._processAddsRemoves();let k=!1,v=!1,x=!1;u.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((C,A)=>{let B=this._materialRenderers.get(A);!B&&0<C.adds.length&&(B=new t(this.rctx,this.materialRepository,A),this._materialRenderers.set(A,B),x=v=k=!0);if(B){var D=v||B.hasHighlights,E=x||B.hasWater;B.modify(C);v=v||D!==B.hasHighlights;x=x||E!==B.hasWater;B.isEmpty&&(this._materialRenderers.delete(A),B.dispose(),k=!0)}});this._changes.clear();k&&this.updateSortedMaterialRenderers();v&&
(this._hasHighlights=q.someMap(this._materialRenderers,C=>C.hasHighlights));x&&(this._hasWater=q.someMap(this._materialRenderers,C=>C.hasWater));this.notifyChange("updating");return!0};z.add=function(k){if(0!==k.length){var v=this._pending.empty;for(const x of k)this._pending.adds.add(x);v&&this.notifyChange("updating")}};z.remove=function(k){const v=this._pending.empty;for(const x of k)this._pending.adds.has(x)?(this._pending.removed.add(x),this._pending.adds.delete(x)):this._pending.removed.has(x)||
this._pending.removes.add(x);v&&!this._pending.empty&&this.notifyChange("updating")};z.modify=function(k,v){const x=0===this._changes.updates.length;for(const C of k)k=this._changes.updates.pushNew(),k.renderGeometry=C,k.updateType=v;x&&0<this._changes.updates.length&&this.notifyChange("updating")};z.updateLogic=function(k){let v=!1;this._sortedMaterialRenderers.forAll(({materialRenderer:x})=>v=x.updateLogic(k)||v);return v};z.render=function(k,v){for(let x=0;x<this._sortedMaterialRenderers.length;x++){const C=
this._sortedMaterialRenderers.data[x];c.materialPredicate(C.material,k)&&C.materialRenderer.render(v.slot,k.pass,v,null)}};z.updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let k=0;this._materialRenderers.forEach((v,x)=>{x.insertOrder=k++;this._sortedMaterialRenderers.push({material:x,materialRenderer:v})});this._sortedMaterialRenderers.sort((v,x)=>{const C=x.material.renderPriority-v.material.renderPriority;return 0!==C?C:v.material.insertOrder-x.material.insertOrder})};
z._processAddsRemoves=function(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let k=0;k<this._changes.updates.length;)this._pending.has(this._changes.updates.data[k].renderGeometry)?this._changes.updates.removeUnorderedIndex(k):k++;this._pending.clear()};p._createClass(n,[{key:"updating",get:function(){return!this._pending.empty||0<this._changes.updates.length}},
{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return q.someMap(this._materialRenderers,k=>k.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);return n}(r);b.__decorate([f.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",void 0);b.__decorate([f.property()],
a.SortedRenderGeometryRenderer.prototype,"materialRepository",void 0);b.__decorate([f.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);a.SortedRenderGeometryRenderer=b.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);let h=function(){function m(){this.adds=new Set;this.removes=new Set;this.removed=new Set}var n=m.prototype;n.has=function(z){return this.adds.has(z)||this.removes.has(z)||this.removed.has(z)};
n.clear=function(){this.adds.clear();this.removes.clear();this.removed.clear()};p._createClass(m,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}}]);return m}();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,p){let b=function(){function q(){this.adds=new p;this.removes=new p;this.updates=new p({allocator:f=>f||new r,deallocator:f=>
{f.renderGeometry=null;return f}})}var y=q.prototype;y.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};y.prune=function(){this.adds.prune();this.removes.prune();this.updates.prune()};return q}(),r=function(){};a.ChangeSet=b;a.MaterialChangeSet=function(){this.adds=[];this.removes=[];this.updates=[]};a.RenderGeometryUpdate=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,
p){a.splitRenderGeometryChangeSetByMaterial=function(b){const r=new Map,q=y=>{let f=r.get(y);f||(f=new p.MaterialChangeSet,r.set(y,f));return f};b.adds.forAll(y=>{1<=y.data.indexCount&&q(y.material).adds.push(y)});b.removes.forAll(y=>{1<=y.data.indexCount&&q(y.material).removes.push(y)});b.updates.forAll(y=>{1<=y.renderGeometry.data.indexCount&&q(y.renderGeometry.material).updates.push(y)});return r};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../lib/ResizableFloat32Array ../../lib/Util ../WaterGLMaterial ./Instance ./utils ../../statistics/RendererPerformanceInfo ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){function h(x,C,A,B){const D=new Map,E=C.vertexBufferLayout.stride/4,G=(K,M)=>{var H=K.origin;if(!b.isNone(H)){var J=x.get(H.id),O=D.get(H.id);null==O&&(O={optimalCount:null==J?0:J.optimalCount,sparseCount:null==J?0:J.buffer.size,toAdd:[],toRemove:[],origin:H.vec3},D.set(H.id,O));H=C.elementCount(K.data)*E;M?(O.optimalCount+=H,O.sparseCount+=H,O.toAdd.push(K)):(O.optimalCount-=H,O.toRemove.push(K))}};for(const K of A)G(K,!0);for(const K of B)G(K,!1);return D}
let m=function(){function x(A,B,D){this.type="MergedRenderer";this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this._rctx=A;this._material=D;this._materialRep=B;this._glMaterials=g.acquireMaterials(this._material,this._materialRep);this._bufferWriter=D.createBufferWriter()}var C=x.prototype;C.dispose=function(){g.releaseMaterials(this._material,this._materialRep);this._dataByOrigin&&(this._dataByOrigin.forEach(A=>{A.vao.dispose(!0);A.vao=null}),this._dataByOrigin.clear(),this._dataByOrigin=
null);this._glMaterials&&(this._glMaterials.forEach(A=>{A&&A.dispose()}),this._glMaterials.clear(),this._glMaterials=null)};C.modify=function(A){this.updateGeometries(A.updates);this.addAndRemoveGeometries(A.adds,A.removes);this.updateRenderCommands()};C.addAndRemoveGeometries=function(A,B){const D=this._bufferWriter,E=D.vertexBufferLayout,G=E.stride/4,K=this._dataByOrigin,M=h(K,D,A,B);M.forEach((H,J)=>{M.delete(J);var O=H.optimalCount;const I=H.sparseCount;let F=K.get(J);if(null==F)w.assert(0<O),
F=this.createData(E,O,H.origin),K.set(J,F);else if(0===O){F.vao.dispose(!0);F.vao=null;K.delete(J);return}const L=O<H.sparseCount/2;J=n;const N=F.buffer.size,R=F.buffer.array;O=F.buffer.resize(L?O:I,!1);L||O?this.removeAndRebuild(F,H.toRemove,G,R,J):0<H.toRemove.length?(this.removeByErasing(F,H.toRemove,G,J),0<H.toAdd.length&&(J.end=N)):(J.begin=N,J.end=N);O=z;w.setMatrixTranslation3(O,-H.origin[0],-H.origin[1],-H.origin[2]);this.append(F,H.toAdd,G,O,J);H=F.vao.vertexBuffers.geometry;if(H.byteSize!==
F.buffer.array.buffer.byteLength)H.setData(F.buffer.array);else{const {begin:S,end:P}=J;S<P&&(J=4*S,H.setSubData(F.buffer.array,J,J,4*P))}F.drawCommandsDirty=!0})};C.updateGeometries=function(A){const B=this._bufferWriter,D=B.vertexBufferLayout.stride/4;for(const K of A){var E=K.updateType;A=K.renderGeometry;const M=this._dataByOrigin.get(A.origin.id),H=M&&M.instances.get(A.id);if(!H)break;E&1&&(H.isVisible=A.instanceParameters.visible);if(E&9){var G=A.instanceParameters.visible;H.hasHighlights=!!A.instanceParameters.highlights&&
G}E&16&&(H.hasOccludees=!!A.instanceParameters.occludees);E&6&&(E=M.buffer.array,G=M.vao,g.calculateTransformRelativeToOrigin(A,k,v),B.write({transformation:k,invTranspTransformation:v},A.data,B.vertexBufferLayout.createView(E.buffer),H.from),w.assert(H.from+B.elementCount(A.data)===H.to,"material VBO layout has changed"),G.vertexBuffers.geometry.setSubData(E,H.from*D*4,H.from*D*4,H.to*D*4));M.drawCommandsDirty=!0}};C.updateRenderCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(B=>
{B.hasHiddenInstances=!1;B.hasHighlights=!1;B.hasOccludees=!1;p.someMap(B.instances,D=>{D.isVisible?(D.hasHighlights&&(this._hasHighlights=!0,B.hasHighlights=!0),D.hasOccludees&&(this._hasOccludees=!0,B.hasOccludees=!0)):B.hasHiddenInstances=!0;return B.hasHiddenInstances&&B.hasHighlights&&B.hasOccludees})});const A=B=>{B.drawCommandsDefault=null;B.drawCommandsHighlight=null;B.drawCommandsOccludees=null;B.drawCommandsShadowHighlightRest=null;B.stats={default:0,highlight:0,occludees:0,shadowHighlightRest:0};
if(0!==B.instances.size)if(B.hasOccludees||B.hasHighlights||B.hasHiddenInstances){var D=l.sortInstancesAccordingToRange([...B.instances.values()]);B.drawCommandsDefault=[];B.drawCommandsHighlight=[];B.drawCommandsOccludees=[];B.drawCommandsShadowHighlightRest=[];for(const E of D)E.isVisible&&(E.hasOccludees?l.addOrMerge(B.drawCommandsOccludees,E):l.addOrMerge(B.drawCommandsDefault,E),E.hasHighlights?l.addOrMerge(B.drawCommandsHighlight,E):l.addOrMerge(B.drawCommandsShadowHighlightRest,E));D=E=>{let G=
0;for(const K of E)G+=K.count;return G/3};B.stats={default:D(B.drawCommandsDefault),highlight:D(B.drawCommandsHighlight),occludees:D(B.drawCommandsOccludees),shadowHighlightRest:D(B.drawCommandsShadowHighlightRest)}}else D=4*B.buffer.size/u.getStride(B.vao.layout.geometry),B.drawCommandsDefault=[{first:0,count:D}],B.stats={default:D,highlight:0,occludees:0,shadowHighlightRest:0}};this._dataByOrigin.forEach(B=>{B.drawCommandsDirty&&(A(B),B.drawCommandsDirty=!1)})};C.updateLogic=function(A){return this._material.update(A)};
C.render=function(A,B,D,E){const G=this._rctx,K=this._glMaterials.get(B),M=5===B||7===B,H=6===B,J=!(M||H);if(!K||2!==K.ensureResources(G)||null!=A&&!K.beginSlot(A)||M&&!this._hasHighlights)return!1;K.ensureParameters(D);const O=K.getPipelineState(A,!1);G.setPipelineState(O);const I=K.technique;G.useProgram(I.program);K.bind(D);let F=!1;this._dataByOrigin.forEach(L=>{if(!(b.isNone(L.drawCommandsDefault)&&b.isNone(L.drawCommandsHighlight)&&b.isNone(L.drawCommandsOccludees)&&b.isNone(L.drawCommandsShadowHighlightRest)||
M&&!L.hasHighlights)){D.origin=L.origin;I.bindDraw(D,{},{});I.ensureAttributeLocations(L.vao);G.bindVAO(L.vao);var N=I.primitiveType,R=M?L.drawCommandsHighlight:H&&(L.hasOccludees||L.hasHighlights||L.hasHiddenInstances)?L.drawCommandsShadowHighlightRest:L.drawCommandsDefault;b.isSome(R)&&(this.renderCommands(G,N,R),d.addToRenderStats(R.length,M?L.stats.highlight:H&&(L.hasOccludees||L.hasHighlights||L.hasHiddenInstances)?L.stats.shadowHighlightRest:L.stats.default,E),F=!0);if(J&&(R=L.drawCommandsOccludees,
b.isSome(R))){const S=K.getPipelineState(A,!0);G.setPipelineState(S);this.renderCommands(G,N,R);G.setPipelineState(O);d.addToRenderStats(R.length,L.stats.occludees,E);F=!0}}});return F};C.renderCommands=function(A,B,D){for(let E=0;E<D.length;E++)A.drawArrays(B,D[E].first,D[E].count)};C.createData=function(A,B,D){return{instances:new Map,vao:new t(this._rctx,this._material.vertexAttributeLocations,{geometry:y.glLayout(A)},{geometry:c.createVertex(this._rctx,35044)}),buffer:new f.ResizableFloat32Array(B),
optimalCount:0,origin:D,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,drawCommandsShadowHighlightRest:null,stats:{default:0,highlight:0,occludees:0,shadowHighlightRest:0}}};C.removeAndRebuild=function(A,B,D,E,G){for(const I of B){B=I.id;const F=A.instances.get(B);A.optimalCount-=(F.to-F.from)*D;A.instances.delete(B)}let K=0;const M=A.buffer.array;G.begin=0;G.end=0;let H=-1,J=-1,O=0;A.instances.forEach(I=>
{const F=I.from*D,L=I.to*D,N=L-F;H!==J&&J!==F?(M.set(E.subarray(H,J),O),O+=J-H,H=F):-1===H&&(H=F);J=L;I.from=K/D;K+=N;I.to=K/D});H!==J&&M.set(E.subarray(H,J),O);G.end=K};C.removeByErasing=function(A,B,D,E){E.begin=Infinity;E.end=-Infinity;let G=-1,K=-1;for(const H of B){B=H.id;var M=A.instances.get(B);const J=M.from*D;M=M.to*D;G!==K&&K!==J?(A.buffer.erase(G,K),G=J):-1===G&&(G=J);K=M;A.instances.delete(B);A.optimalCount-=M-J;J<E.begin&&(E.begin=J);M>E.end&&(E.end=M)}G!==K&&A.buffer.erase(G,K)};C.append=
function(A,B,D,E,G){const K=this._bufferWriter;for(const H of B){var M=b.isSome(H.transformation)?r.multiply(k,E,H.transformation):E;r.invert(v,M);r.transpose(v,v);B=G.end;K.write({transformation:M,invTranspTransformation:v},H.data,K.vertexBufferLayout.createView(A.buffer.array.buffer),G.end/D);M=K.elementCount(H.data)*D;const J=B+M;w.assert(null==A.instances.get(H.id));const O=H.instanceParameters.visible;B=new l.Instance(B/D,J/D,O,!!H.instanceParameters.highlights&&O,!!H.instanceParameters.occludees);
A.instances.set(H.id,B);A.optimalCount+=M;G.end+=M}};a._createClass(x,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&p.someMap(this._glMaterials,A=>A instanceof e.WaterGLMaterial)}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&1!==this._material.renderOccluded}},{key:"test",get:function(){return{material:this._material,
glMaterials:this._glMaterials}}}]);return x}();const n={begin:0,end:0},z=q.create(),k=q.create(),v=q.create();return m})},"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils"],function(a,p,b){let r=function(){function q(f){null==f?f=16:65536>f&&(f=b.nextHighestPowerOfTwo(f));this._array=new Float32Array(f);this._size=0}var y=q.prototype;y.resize=function(f,w){this._size=f;if(this._size>this._array.length){for(f=
this._array.length||1;f<this._size;)f*=2;f=new Float32Array(f);w&&f.set(this._array);this._array=f;return!0}var e=2*this._size;if(e<=this._array.length){for(f=this._array.length;f>=e;)f=Math.floor(f/2);e=new Float32Array(f);w&&e.set(this._array.subarray(0,f));this._array=e;return!0}return!1};y.append=function(f){const w=this._size;this.resize(this._size+f.length,!0);this._array.set(f,w)};y.erase=function(f,w){for(;f<w;++f)this._array[f]=0};p._createClass(q,[{key:"array",get:function(){return this._array}},
{key:"size",get:function(){return this._size}}]);return q}();a.ResizableFloat32Array=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../lib/GLMaterial","./WaterTechnique"],function(a,p,b,r){b=function(q){function y(w){w=q.call(this,w)||this;w.updateParameters();return w}p._inheritsLoose(y,q);var f=y.prototype;f.updateParameters=function(w){this._technique=this._techniqueRep.releaseAndAcquire(r.WaterTechnique,
this._material.getTechniqueConfig(this._output,w),this._technique)};f.beginSlot=function(w){if(2===this._output)return 24===w;if(5===this._output)return 23===w;if(4===this._output)return 3===w||23===w;let e=3;this._material.params.transparent&&(e=this._material.params.writeDepth?5:8);return w===e};f.setElapsedTimeUniform=function(w){w.setUniform1f("timeElapsed",.001*this._material.animation.time*this._material.params.animationSpeed)};f._updateShadowState=function(w){w.shadowMappingEnabled!==this._material.params.receiveShadows&&
this._material.setParameterValues({receiveShadows:w.shadowMappingEnabled})};f._updateSSRState=function(w){w.ssrEnabled!==this._material.params.ssrEnabled&&this._material.setParameterValues({ssrEnabled:w.ssrEnabled})};f.ensureResources=function(w){return this._technique.ensureResource(w)};f.ensureParameters=function(w){0===this._output&&(this._updateShadowState(w),this._updateSSRState(w));this.updateParameters(w)};f.bind=function(w){this._technique.bindPass(this._material.params,w);2!==this._output&&
0!==this._output||this.setElapsedTimeUniform(this._technique.program)};return y}(b);a.WaterGLMaterial=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z){c=function(k){function v(C,A,B){A=k.call(this,C,A,B)||this;A._textureRepository=C.waterTextureRepository;return A}b._inheritsLoose(v,k);var x=v.prototype;x.initializeProgram=function(C){var A=v.shader.get();const B=this.configuration;A=A.build({OITEnabled:0===B.transparencyPassType,output:B.output,viewingMode:C.viewingMode,slicePlaneEnabled:B.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:B.receiveShadows,
pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:B.useSSR,highStepCount:!0,multipassTerrainEnabled:B.multipassTerrainEnabled,cullAboveGround:B.cullAboveGround});return new m.Program(C.rctx,A,t.Default3D)};x.ensureResource=function(C){this._textureRepository.ready||this._textureRepository.updating||this._textureRepository.loadTextures(C);return this._textureRepository.ready?2:1};x.bindPass=function(C,A){g.bindProjectionMatrix(this.program,A.camera.projectionMatrix);A.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",
A.camera.nearFar),this.program.setUniform2fv("inverseViewport",A.inverseViewport),f.bindMultipassTerrainTexture(this.program,A));0===this.configuration.output&&(A.lighting.setUniforms(this.program,!1),e.bindSSRUniforms(this.program,A));if(0===this.configuration.output||2===this.configuration.output)l.bindWaterDistortionUniforms(this.program,C),this._textureRepository.bind(this.program);this.program.setUniform4fv("waterColor",C.color);4===this.configuration.output&&y.bindOutputHighlight(this.program,
A)};x.bindDraw=function(C){g.bindView(this.program,C);this.program.rebindTextures();0!==this.configuration.output&&7!==this.configuration.output||g.bindCameraPosition(this.program,C.origin,C.camera.viewInverseTransposeMatrix);0===this.configuration.output&&w.bindReadShadowMapUniforms(this.program,C);0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||q.bindSliceUniformsWithOrigin(this.program,this.configuration,C)};x.setPipelineState=function(C){const A=this.configuration,
B=3===C,D=2===C;return z.makePipelineState({blending:2!==A.output&&4!==A.output&&A.transparent?B?h.blendingDefault:h.OITBlending(C):null,depthTest:{func:h.OITDepthTest(C)},depthWrite:B?A.writeDepth&&z.defaultDepthWriteParams:h.OITDepthWrite(C),colorWrite:z.defaultColorWriteParams,polygonOffset:B||D?null:h.getOITPolygonOffset(A.enableOffset)})};x.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};return v}(c.ShaderTechnique);c.shader=new d.ReloadableShaderModule(n.WaterSurface,
()=>new Promise(function(k,v){a(["../shaders/WaterSurface.glsl"],k,v)}));d=function(k){function v(){var x=k.apply(this,arguments)||this;x.output=0;x.receiveShadows=!1;x.slicePlaneEnabled=!1;x.transparent=!1;x.enableOffset=!0;x.writeDepth=!1;x.useSSR=!1;x.isDraped=!1;x.transparencyPassType=3;x.multipassTerrainEnabled=!1;x.cullAboveGround=!1;return x}b._inheritsLoose(v,k);return v}(u.ShaderTechniqueConfiguration);r.__decorate([u.parameter({count:8})],d.prototype,"output",void 0);r.__decorate([u.parameter()],
d.prototype,"receiveShadows",void 0);r.__decorate([u.parameter()],d.prototype,"slicePlaneEnabled",void 0);r.__decorate([u.parameter()],d.prototype,"transparent",void 0);r.__decorate([u.parameter()],d.prototype,"enableOffset",void 0);r.__decorate([u.parameter()],d.prototype,"writeDepth",void 0);r.__decorate([u.parameter()],d.prototype,"useSSR",void 0);r.__decorate([u.parameter()],d.prototype,"isDraped",void 0);r.__decorate([u.parameter({count:4})],d.prototype,"transparencyPassType",void 0);r.__decorate([u.parameter()],
d.prototype,"multipassTerrainEnabled",void 0);r.__decorate([u.parameter()],d.prototype,"cullAboveGround",void 0);p.WaterTechnique=c;p.WaterTechniqueConfiguration=d;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,p,b){a.ReadShadowMap=function(r){r.fragment.include(p.RgbaFloatEncoding);r.fragment.uniforms.add("uShadowMapTex",
"sampler2D");r.fragment.uniforms.add("uShadowMapNum","int");r.fragment.uniforms.add("uShadowMapDistance","vec4");r.fragment.uniforms.add("uShadowMapMatrix","mat4",4);r.fragment.uniforms.add("uDepthHalfPixelSz","float");r.fragment.code.add(b.glsl`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = uShadowMapDistance;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= uShadowMapNum) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);
}`)};a.bindReadShadowMapUniforms=function(r,q){q.shadowMappingEnabled&&(q.shadowMap.bind(r),q.shadowMap.bindView(r,q.origin))};a.bindReadShadowMapView=function(r,q){q.shadowMappingEnabled&&q.shadowMap.bindView(r,q.origin)};a.bindReadShadowMapViewCustomOrigin=function(r,q,y){q.shadowMappingEnabled&&q.shadowMap.bindView(r,y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl",
"./Reprojection.glsl","../../shaderModules/interfaces"],function(a,p,b,r){a.ScreenSpaceReflections=function(q,y){q.fragment.uniforms.add("nearFar","vec2");q.fragment.uniforms.add("depthMapView","sampler2D");q.fragment.uniforms.add("ssrViewMat","mat4");q.fragment.uniforms.add("invResolutionHeight","float");q.fragment.include(p.ReadLinearDepth);q.include(b.Reprojection);q.fragment.code.add(r.glsl`
  const int maxSteps = ${y.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};a.bindSSRUniforms=function(q,y){y.ssrEnabled&&(q.bindTexture(y.linearDepthTexture,"depthMapView"),q.setUniform2fv("nearFar",y.camera.nearFar),q.setUniformMatrix4fv("ssrViewMat",y.camera.viewMatrix),q.setUniform1f("invResolutionHeight",1/y.camera.height),b.bindReprojectionUniforms(q,y))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.Reprojection=
function(b){b.fragment.uniforms.add("lastFrameColorMap","sampler2D");b.fragment.uniforms.add("reprojectionMat","mat4");b.fragment.uniforms.add("rpProjectionMat","mat4");b.fragment.code.add(p.glsl`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)};a.bindReprojectionUniforms=function(b,r){b.bindTexture(r.lastFrameColorTexture,"lastFrameColorMap");b.setUniformMatrix4fv("reprojectionMat",r.reprojectionMat);b.setUniformMatrix4fv("rpProjectionMat",r.camera.projectionMatrix)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define(["exports","./FoamRendering.glsl","../../shaderModules/interfaces"],function(a,p,b){a.WaterDistortion=function(r){r.fragment.uniforms.add("texWaveNormal",
"sampler2D");r.fragment.uniforms.add("texWavePerturbation","sampler2D");r.fragment.uniforms.add("waveParams","vec4");r.fragment.uniforms.add("waveDirection","vec2");r.include(p.FoamIntensity);r.fragment.code.add(b.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.bindWaterDistortionUniforms=function(r,q){r.setUniform4f("waveParams",q.waveStrength,q.waveTextureRepeat,q.flowStrength,q.flowOffset);r.setUniform2f("waveDirection",q.waveDirection[0]*q.waveVelocity,q.waveDirection[1]*q.waveVelocity)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.FoamColor=function(b){b.fragment.code.add(p.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(b){b.fragment.code.add(p.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){function h(n){const z=new t.ShaderBuilder;z.include(r.Transform,{linearDepth:!1});z.attributes.add("position","vec3");z.attributes.add("uv0","vec2");z.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3");z.vertex.uniforms.add("waterColor","vec4");if(0===n.output||7===n.output)z.include(w.NormalUtils,n),z.include(p.ForwardLinearDepth,n),z.varyings.add("vuv","vec2"),z.varyings.add("vpos","vec3"),z.varyings.add("vnormal","vec3"),z.varyings.add("vtbnMatrix",
"mat3"),n.multipassTerrainEnabled&&z.varyings.add("depth","float"),z.vertex.code.add(u.glsl`
      void main(void) {
        if (waterColor.a < ${u.glsl.float(d.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${n.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${0===n.output?"forwardLinearDepth();":""}
      }
    `);n.multipassTerrainEnabled&&(z.fragment.include(y.ReadLinearDepth),z.include(f.multipassTerrainTest,n));7===n.output&&(z.include(b.Slice,n),z.fragment.uniforms.add("waterColor","vec4"),z.fragment.code.add(u.glsl`
        void main() {
          discardBySlice(vpos);
          ${n.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `));0===n.output&&(z.include(g.WaterDistortion,n),z.include(b.Slice,n),n.receiveShadows&&z.include(e.ReadShadowMap,n),z.include(l.Water,n),z.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),z.fragment.include(c.ColorConversion),z.fragment.code.add(u.glsl`
      void main() {
        discardBySlice(vpos);
        ${n.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - camPos);
        float shadow = ${n.receiveShadows?u.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${n.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));2===n.output&&(z.include(w.NormalUtils,n),z.include(g.WaterDistortion,n),z.include(b.Slice,n),z.varyings.add("vpos","vec3"),z.varyings.add("vuv","vec2"),z.vertex.code.add(u.glsl`
        void main(void) {
          if (waterColor.a < ${u.glsl.float(d.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),z.fragment.uniforms.add("timeElapsed","float"),z.fragment.code.add(u.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`));5===n.output&&(z.varyings.add("vpos","vec3"),z.vertex.code.add(u.glsl`
        void main(void) {
          if (waterColor.a < ${u.glsl.float(d.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),z.fragment.uniforms.add("waterColor","vec4"),z.fragment.code.add(u.glsl`void main() {
gl_FragColor = waterColor;
}`));4===n.output&&(z.include(q.OutputHighlight),z.varyings.add("vpos","vec3"),z.vertex.code.add(u.glsl`
      void main(void) {
        if (waterColor.a < ${u.glsl.float(d.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),z.include(b.Slice,n),z.fragment.code.add(u.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return z}var m=Object.freeze({__proto__:null,build:h});a.WaterSurface=m;a.build=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,p){a.ForwardLinearDepth=function(b,r){0===r.output&&r.receiveShadows?(b.varyings.add("linearDepth","float"),b.vertex.code.add(p.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):1===r.output||3===r.output?(b.varyings.add("linearDepth","float"),b.vertex.uniforms.add("cameraNearFar",
"vec2"),b.vertex.code.add(p.glsl`void forwardLinearDepth() {
linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);
}`)):b.vertex.code.add(p.glsl`void forwardLinearDepth() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.NormalUtils=function(b,r){1===r.viewingMode?b.vertex.code.add(p.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):b.vertex.code.add(p.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);1===r.viewingMode?b.vertex.code.add(p.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):b.vertex.code.add(p.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../../shaderModules/interfaces".split(" "),function(a,p,b,r,q,y){a.Water=function(f,w){f.include(r.PhysicallyBasedRendering,w);f.include(b.Gamma);f.include(p.FoamColor);w.ssrEnabled&&f.include(q.ScreenSpaceReflections,w);f.fragment.constants.add("fresnelSky",
"vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]);f.fragment.code.add(y.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);f.fragment.code.add(y.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {
float reflectionHit = 0.;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}`);w.ssrEnabled?f.fragment.code.add(y.glsl`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);
float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);
vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;
}
float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);
return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);
}`):f.fragment.code.add(y.glsl`return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,p,b,r){a.PhysicallyBasedRendering=function(q,y){const f=q.fragment.code;q.include(b.PiUtils);if(3===y.pbrMode||4===y.pbrMode)f.add(r.glsl`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${y.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),f.add(r.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),f.add(r.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),f.add(r.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),f.add(r.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`);else if(1===y.pbrMode||2===y.pbrMode)q.include(p.AnalyticalSkyModel),f.add(r.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),f.add(r.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),f.add(r.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),f.add(r.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),f.add(r.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),f.add(r.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.AnalyticalSkyModel=function(b){b=b.fragment.code;b.add(p.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);b.add(p.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);b.add(p.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/mat4","../../../../../chunks/mat4f64"],function(a,p,b){a.Instance=function(r,q,y,f,w,e){this.from=r;this.to=q;this.isVisible=y;this.hasHighlights=f;this.hasOccludees=w;this.transformation=e;null!=e&&(this.transformationNormal=b.clone(e),p.invert(this.transformationNormal,this.transformationNormal),p.transpose(this.transformationNormal,
this.transformationNormal))};a.addOrMerge=function(r,q){if(0===r.length)r.push({first:q.from,count:q.to-q.from});else{var y=r[r.length-1];var f=y.first+y.count>=q.from?!0:!1;f?y.count=q.from-y.first+q.to-q.from:r.push({first:q.from,count:q.to-q.from})}};a.sortInstancesAccordingToRange=function(r){return r.sort((q,y)=>q.from===y.from?q.to>y.to?1:q.to<y.to?-1:0:q.from>y.from?1:q.from<y.from?-1:0)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/accessorSupport/utils ../../../webgl/Measurement".split(" "),
function(a,p,b,r,q,y){const f="prepare;shadowmap;lineardepth;normals;ssao;opaque;opaque edges;transparent;transparent edges;hudvisibility;transparent terrain;atmosphere;laserline;occluded;antialiasing;highlights;hudOccluded;hudNotoccluded".split(";");let w=function(){function g(){this.drawCalls=this.triangles=0}g.prototype.reset=function(){this.drawCalls=this.triangles=0};return g}(),e=function(g){function d(){var c=g.call(this,"total")||this;c.total=0;c.frameCount=0;return c}p._inheritsLoose(d,g);
return d}(r),l=function(){function g(){this._enableGPUTimer=this._lastSample=this._startTime=0;this.totalTime=new e;this.gpuTime=new r("gpu",9);this.renderPassTimings=f.map(c=>new r(c));this.stats=new w}var d=g.prototype;d.enableGPUTimer=function(){++this._enableGPUTimer;return{remove:q.once(()=>--this._enableGPUTimer)}};d.prerender=function(c){this._startTime=this._lastSample=performance.now();this._enableGPUTimer&&(this._gpuTimer=y.startMeasurement(c))};d.advance=function(c){const u=performance.now();
this.renderPassTimings[c].record(u-this._lastSample);this._lastSample=u};d.postrender=function(){b.isSome(this._gpuTimer)&&(this._gpuTimer.stop(u=>b.isSome(u)&&this.gpuTime.record(u),16),this._gpuTimer=null);const c=performance.now()-this._startTime;this.totalTime.record(c);this.totalTime.total+=c;this.totalTime.frameCount++};return g}();a.RenderStats=w;a.RenderTime=e;a.RendererPerformanceInfo=l;a.addToRenderStats=function(g,d,c){b.isSome(c)&&(c.drawCalls+=g,c.triangles+=d)};a.performanceStatsCategories=
f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Measurement":function(){define(["exports","../../core/maybe"],function(a,p){let b=function(){function y(w){this.timer=w;this.start=w.createQuery();w.createTimestamp(this.start)}var f=y.prototype;f.stop=function(w,e=50){this.end=this.timer.createQuery();this.timer.createTimestamp(this.end);this.checkQueryResult(w,e)};f.checkQueryResult=function(w,e){if(this.timer.resultAvailable(this.end))if(this.timer.disjoint())w(null);else{var l=
this.timer.getResult(this.start),g=this.timer.getResult(this.end);w((g-l)/1E6)}else setTimeout(()=>this.checkQueryResult(w,e),e)};return y}(),r=function(){function y(w){this.timer=w;this.query=w.createQuery();q=!0;this.timer.beginTimeElapsed(this.query)}var f=y.prototype;f.stop=function(w,e=50){this.timer.endTimeElapsed();q=!1;this.checkQueryResult(w,e)};f.checkQueryResult=function(w,e){var l=this.timer.resultAvailable(this.query);const g=this.timer.disjoint();l&&!g?(l=this.timer.getResult(this.query),
w(l/1E6)):g?w(null):setTimeout(()=>this.checkQueryResult(w,e),e)};return y}(),q=!1;a.startMeasurement=function(y){y=y.capabilities.disjointTimerQuery;return p.isNone(y)?null:0<y.timestampBits()?new b(y):q?null:new r(y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){f=function(d){function c(){return d.apply(this,arguments)||this}b._inheritsLoose(c,d);var u=c.prototype;u.initializeProgram=function(t){const h=c.shader.get().build();return new l.Program(t.rctx,h,e.Default3D)};u.initializePipeline=function(){return this.configuration.hasAlpha?g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),colorWrite:g.defaultColorWriteParams}):g.makePipelineState({colorWrite:g.defaultColorWriteParams})};return c}(f.ShaderTechnique);
f.shader=new y.ReloadableShaderModule(q.TextureOnlyShader,()=>new Promise(function(d,c){a(["../core/shaderLibrary/util/TextureOnly.glsl"],d,c)}));q=function(d){function c(){var u=d.apply(this,arguments)||this;u.hasAlpha=!1;return u}b._inheritsLoose(c,d);return c}(w.ShaderTechniqueConfiguration);r.__decorate([w.parameter()],q.prototype,"hasAlpha",void 0);p.TextureTechnique=f;p.TextureTechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/TextureOnly.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,p,b,r){function q(){const f=new r.ShaderBuilder;f.include(p.ScreenSpacePass);f.fragment.uniforms.add("tex","sampler2D");f.fragment.uniforms.add("color","vec4");f.fragment.code.add(b.glsl`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * color;
}`);return f}var y=Object.freeze({__proto__:null,build:q});a.TextureOnlyShader=y;a.build=q})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["exports","../shaderModules/interfaces"],function(a,p){a.ScreenSpacePass=function(b){b.attributes.add("position","vec2");b.varyings.add("uv","vec2");b.vertex.code.add(p.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(a,p,b,r,q,y){let f=function(){function e(){this._shOrder=2;this._ambientBoost=.4;this._oldSunlight={direction:r.create(),ambient:{color:r.create(),intensity:1},diffuse:{color:r.create(),intensity:1}};this.groundLightingFactor=
this.globalFactor=.5;this._sphericalHarmonics=new q.SphericalHarmonicsAmbientLight;this._mainLight={intensity:r.create(),direction:r.fromValues(1,0,0),castShadows:!1}}var l=e.prototype;l.setLightDirectionUniform=function(g){g.setUniform3fv("lightingMainDirection",this._mainLight.direction)};l.setUniforms=function(g,d=!1){g.setUniform1f("lightingFixedFactor",d?(1-this.groundLightingFactor)*(1-this.globalFactor):0);g.setUniform1f("lightingGlobalFactor",this.globalFactor);this.setLightDirectionUniform(g);
g.setUniform3fv("lightingMainIntensity",this._mainLight.intensity);g.setUniform1f("ambientBoostFactor",this._ambientBoost);d=this._sphericalHarmonics;0===this._shOrder?g.setUniform3f("lightingAmbientSH0",d.r[0],d.g[0],d.b[0]):1===this._shOrder?(g.setUniform4f("lightingAmbientSH_R",d.r[0],d.r[1],d.r[2],d.r[3]),g.setUniform4f("lightingAmbientSH_G",d.g[0],d.g[1],d.g[2],d.g[3]),g.setUniform4f("lightingAmbientSH_B",d.b[0],d.b[1],d.b[2],d.b[3])):2===this._shOrder&&(g.setUniform3f("lightingAmbientSH0",d.r[0],
d.g[0],d.b[0]),g.setUniform4f("lightingAmbientSH_R1",d.r[1],d.r[2],d.r[3],d.r[4]),g.setUniform4f("lightingAmbientSH_G1",d.g[1],d.g[2],d.g[3],d.g[4]),g.setUniform4f("lightingAmbientSH_B1",d.b[1],d.b[2],d.b[3],d.b[4]),g.setUniform4f("lightingAmbientSH_R2",d.r[5],d.r[6],d.r[7],d.r[8]),g.setUniform4f("lightingAmbientSH_G2",d.g[5],d.g[6],d.g[7],d.g[8]),g.setUniform4f("lightingAmbientSH_B2",d.b[5],d.b[6],d.b[7],d.b[8]))};l.set=function(g){y.combineLights(g,this._shOrder,this._mainLight,this._sphericalHarmonics);
b.copy(this._oldSunlight.direction,this._mainLight.direction);g=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*g;this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*g;this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*g;b.scale(this._oldSunlight.diffuse.color,this._mainLight.intensity,g);b.copy(w,this._oldSunlight.diffuse.color);b.scale(w,w,this._ambientBoost*this.globalFactor);b.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,
w)};p._createClass(e,[{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"old",get:function(){return this._oldSunlight}}]);return e}();const w=r.create();a.SceneLighting=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(a,p,b,r,q,y){function f(k){return(k+
1)*(k+1)}function w(k){return p.clamp(Math.floor(Math.sqrt(k)-1),0,2)}function e(k,v,x){const C=k[0],A=k[1];k=k[2];x=x||[];x.length=f(v);0<=v&&(x[0]=.28209479177);1<=v&&(x[1]=.4886025119*C,x[2]=.4886025119*k,x[3]=.4886025119*A);2<=v&&(x[4]=1.09254843059*C*A,x[5]=1.09254843059*A*k,x[6]=.31539156525*(3*k*k-1),x[7]=1.09254843059*C*k,x[8]=.54627421529*(C*C-A*A));return x}function l(k,v){k=f(k);v=v||{r:[],g:[],b:[]};v.r.length=v.g.length=v.b.length=k;for(let x=0;x<k;x++)v.r[x]=v.g[x]=v.b[x]=0;return v}
function g(k,v){const x=w(v.r.length);for(const C of k)b.negate(n,C.direction),e(n,x,h),q.elementwiseProduct(h,z),q.scalarProduct(h,C.intensity[0],m),q.add(v.r,m),q.scalarProduct(h,C.intensity[1],m),q.add(v.g,m),q.scalarProduct(h,C.intensity[2],m),q.add(v.b,m);return v}function d(k,v){e(n,0,h);for(const x of k)v.r[0]+=h[0]*z[0]*x.intensity[0]*4*Math.PI,v.g[0]+=h[0]*z[0]*x.intensity[1]*4*Math.PI,v.b[0]+=h[0]*z[0]*x.intensity[2]*4*Math.PI;return v}const c=[],u=[],t=[],h=[0],m=[0],n=r.create(),z=[3.141593,
2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(k,v,x,C){l(v,C);b.set(x.intensity,0,0,0);v=!1;c.length=0;u.length=0;t.length=0;for(const A of k)A instanceof y.MainLight&&!v?(b.copy(x.direction,A.direction),x.intensity[0]=A.intensity[0],x.intensity[1]=A.intensity[1],x.intensity[2]=A.intensity[2],x.castShadows=A.castShadows,v=!0):A instanceof y.MainLight||A instanceof y.FillLight?c.push(A):A instanceof y.AmbientLight?u.push(A):A instanceof y.SphericalHarmonicsAmbientLight&&
t.push(A);g(c,C);d(u,C);for(const A of t)q.add(C.r,A.r),q.add(C.g,A.g),q.add(C.b,A.b)};a.computeCoefficients=e;a.initSHCoefficients=l;a.numberOfCoefficients=f;a.orderFromNumberOfCoefficients=w;a.projectAmbientLights=d;a.projectFillLights=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(p,b,r){r=r||p;r.length=p.length;for(let q=0;q<p.length;q++)r[q]=p[q]+b[q];return r};a.dotProduct=function(p,
b){let r=0;for(let q=0;q<p.length;q++)r+=p[q]*b[q];return r};a.elementwiseProduct=function(p,b,r){r=r||p;r.length=p.length;for(let q=0;q<p.length;q++)r[q]=p[q]*b[q];return r};a.scalarProduct=function(p,b,r){r=r||p;r.length=p.length;for(let q=0;q<p.length;q++)r[q]=p[q]*b;return r};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/StippleTextureRepository":function(){define("exports ../../../../core/maybe ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../../chunks/builtins ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject ../lib/Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){b=function(){function u(h){this._rctx=h;this.cache=new Map}var t=u.prototype;t.dispose=function(){this.cache.forEach(h=>h.texture=p.disposeMaybe(h.texture));this.cache.clear()};t.acquire=function(h){if(p.isNone(h))return null;const m=this.patternId(h),n=this.cache.get(m);if(n)return n.refCount++,n.bind;const {encodedData:z,sdfNormalizer:k}=this.patternToTextureData(h,2),v=z.length/4,x=v/2,C={refCount:1,texture:null,bind:A=>{p.isNone(C.texture)&&(C.texture=new g(this._rctx,
{width:v,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},z));A.bindTexture(C.texture,"stipplePatternTexture");return{pixelSize:x,sdfNormalizer:k}}};this.cache.set(m,C);return C.bind};t.release=function(h){if(!p.isNone(h)){h=this.patternId(h);var m=this.cache.get(h);m&&(m.refCount--,0===m.refCount&&(p.isSome(m.texture)&&m.texture.dispose(),this.cache.delete(h)))}};t.swap=function(h,m){m=this.acquire(m);this.release(h);return m};t.patternId=function(h){return h.join(",")};
t.patternToTextureData=function(h,m){var n=Math.floor(h.reduce((x,C)=>x+C)*m);const z=.5*(h.reduce((x,C)=>Math.max(x,C))+1)*m;n=new Uint8Array(4*n);let k=1,v=0;for(const x of h){h=x*m;for(let C=0;C<h;C++)c.packFloatRGBA(k*(Math.min(C,h-C)+.5)/z*.5+.5,n,v),v+=4;k=-k}return{encodedData:n,sdfNormalizer:z}};return u}();a.StippleTextureRepository=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/util/AlphaDiscard.glsl ../lib/GLMaterialTexture ../lib/Material ../lib/OrderIndependentTransparency ../lib/verticalOffsetUtils ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){let h=function(E){function G(M){var H=E.call(this,M,n)||this;H.supportsEdges=!0;H.techniqueConfig=new u.DefaultMaterialTechniqueConfiguration;H.vertexBufferLayout=G.getVertexBufferLayout(H.params);H.instanceBufferLayout=M.instanced?G.getInstanceBufferLayout(H.params):null;return H}p._inheritsLoose(G,E);var K=G.prototype;K.isVisibleInPass=function(M){return 4===M||6===M||7===M?this.params.castShadows:!0};K.isVisible=function(){var M=this.params;if(!E.prototype.isVisible.call(this)||
0===M.layerOpacity)return!1;var H=M.instanced;const J=M.vertexColors,O=M.symbolColors;H=!!H&&-1<H.indexOf("color");const I=M.vvColorEnabled,F="replace"===M.colorMixMode,L=0<M.opacity;M=M.externalColor&&0<M.externalColor[3];return J&&(H||I||O)?F?!0:L:J?F?M:L:H||I||O?F?!0:L:F?M:L};K.getTechniqueConfig=function(M,H){this.techniqueConfig.output=M;this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.params.textureId;this.techniqueConfig.vertexTangents=
this.params.vertexTangents;this.techniqueConfig.instanced=!!this.params.instanced;this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled;
this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals?!0:!1;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.cullFace=this.params.slicePlaneEnabled?0:this.params.cullFace;this.techniqueConfig.multipassTerrainEnabled=H?H.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=
H?H.cullAboveGround:!1;if(0===M||7===M)this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.techniqueConfig.doubleSidedMode=this.params.treeRendering?2:this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&-1<this.params.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=
this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=H&&H.ssaoEnabled?this.params.receiveSSAO:!1,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,
this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=H?H.transparencyPassType:3,this.techniqueConfig.enableOffset=H?H.camera.relativeElevation<l.OITPolygonOffsetLimit:!0;return this.techniqueConfig};K.intersect=function(M,H,J,O,I,F,L){if(null!==this.params.verticalOffset){const R=
O.camera;r.set(B,J[12],J[13],J[14]);J=null;switch(O.viewingMode){case 1:J=r.normalize(C,B);break;case 2:J=r.copy(C,x)}let S=0;if(null!==this.params.verticalOffset){var N=r.subtract(D,B,R.eye);const P=r.length(N);N=r.scale(N,N,1/P);let Q=null;this.params.screenSizePerspective&&(Q=r.dot(J,N));S+=c.verticalOffsetAtDistance(R,P,this.params.verticalOffset,Q,this.params.screenSizePerspective)}r.scale(J,J,S);r.transformMat3(A,J,O.transform.inverseRotation);I=r.subtract(k,I,A);F=r.subtract(v,F,A)}c.intersectTriangleGeometry(M,
H,O,I,F,g.getVerticalOffsetObject3D(O.verticalOffset),L)};K.getGLMaterial=function(M){if(0===M.output||7===M.output||1===M.output||2===M.output||3===M.output||4===M.output)return new m(M)};K.createBufferWriter=function(){return new z(this.vertexBufferLayout,this.instanceBufferLayout)};G.getVertexBufferLayout=function(M){const H=M.textureId||M.normalTextureId||M.metallicRoughnessTextureId||M.emissiveTextureId||M.occlusionTextureId,J=y.newLayout().vec3f("position").vec3f("normal");M.vertexTangents&&
J.vec4f("tangent");H&&J.vec2f("uv0");M.vertexColors&&J.vec4u8("color");M.symbolColors&&J.vec4u8("symbolColor");return J};G.getInstanceBufferLayout=function(M){let H=y.newLayout();H=M.instancedDoublePrecision?H.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):H.mat4f("model").mat4f("modelNormal");M.instanced&&-1<M.instanced.indexOf("color")&&(H=H.vec4f("instanceColor"));M.instanced&&-1<M.instanced.indexOf("featureAttribute")&&(H=H.vec4f("instanceFeatureAttribute"));
return H};return G}(e.Material),m=function(E){function G(M){M=E.call(this,{...M,...M.material.params})||this;M.updateParameters();return M}p._inheritsLoose(G,E);var K=G.prototype;K.updateParameters=function(M){const H=this._material.params;this.updateTexture(H.textureId);this._technique=this._techniqueRep.releaseAndAcquire(H.treeRendering?t.RealisticTreeTechnique:u.DefaultMaterialTechnique,this._material.getTechniqueConfig(this._output,M),this._technique)};K.selectPipelines=function(){};K._updateShadowState=
function(M){M.shadowMappingEnabled!==this._material.params.shadowMappingEnabled&&this._material.setParameterValues({shadowMappingEnabled:M.shadowMappingEnabled})};K._updateOccludeeState=function(M){M.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:M.hasOccludees})};K.ensureParameters=function(M){if(0===this._output||7===this._output)this._updateShadowState(M),this._updateOccludeeState(M);this.updateParameters(M)};K.bind=function(M){this._technique.bindPass(this._material.params,
M);this.bindTextures(this._technique.program)};K.beginSlot=function(M){return M===(this._material.params.transparent?this._material.params.writeDepth?5:8:3)||23===M};K.getPipelineState=function(M,H){return this._technique.getPipelineState(H)};return G}(w);const n={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],
ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:2,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,
100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:b.create(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:f.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...e.materialParametersDefaults};let z=function(){function E(K,M){this.vertexBufferLayout=K;this.instanceBufferLayout=
M}var G=E.prototype;G.allocate=function(K){return this.vertexBufferLayout.createBuffer(K)};G.elementCount=function(K){return K.indices.get("position").length};G.write=function(K,M,H,J){d.writeDefaultAttributes(M,this.vertexBufferLayout,K.transformation,K.invTranspTransformation,H,J)};return E}();const k=q.create(),v=q.create(),x=q.fromValues(0,0,1),C=q.create(),A=q.create(),B=q.create(),D=q.create();a.DefaultMaterial=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../materials/internal/MaterialUtil ../../../../chunks/DefaultMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B){m=function(D){function E(){return D.apply(this,arguments)||this}b._inheritsLoose(E,D);var G=E.prototype;G.initializeProgram=function(K){var M=E.shader.get();const H=this.configuration;M=M.build({OITEnabled:0===H.transparencyPassType,output:H.output,viewingMode:K.viewingMode,receiveShadows:H.receiveShadows,slicePlaneEnabled:H.slicePlaneEnabled,sliceHighlightDisabled:H.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:H.symbolColors,
vvSize:H.vvSize,vvColor:H.vvColor,vvInstancingEnabled:!0,instanced:H.instanced,instancedColor:H.instancedColor,instancedDoublePrecision:H.instancedDoublePrecision,pbrMode:H.usePBR?H.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:H.hasMetalnessAndRoughnessTexture,hasEmissionTexture:H.hasEmissionTexture,hasOcclusionTexture:H.hasOcclusionTexture,hasNormalTexture:H.hasNormalTexture,hasColorTexture:H.hasColorTexture,receiveAmbientOcclusion:H.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:H.normalsTypeDerivate?
3:0,doubleSidedMode:H.doubleSidedMode,vertexTangents:H.vertexTangents,attributeTextureCoordinates:H.hasMetalnessAndRoughnessTexture||H.hasEmissionTexture||H.hasOcclusionTexture||H.hasNormalTexture||H.hasColorTexture?1:0,textureAlphaPremultiplied:H.textureAlphaPremultiplied,attributeColor:H.vertexColors,screenSizePerspectiveEnabled:H.screenSizePerspective,verticalOffsetEnabled:H.verticalOffset,offsetBackfaces:H.offsetBackfaces,doublePrecisionRequiresObfuscation:u.doublePrecisionRequiresObfuscation(K.rctx),
alphaDiscardMode:H.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:H.multipassTerrainEnabled,cullAboveGround:H.cullAboveGround});return new v.Program(K.rctx,M,z.Default3D)};G.bindPass=function(K,M){var H,J;t.bindProjectionMatrix(this.program,M.camera.projectionMatrix);const O=this.configuration.output;(1===this.configuration.output||M.multipassTerrainEnabled||3===O)&&this.program.setUniform2fv("cameraNearFar",M.camera.nearFar);M.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",
M.inverseViewport),l.bindMultipassTerrainTexture(this.program,M));7===O&&(this.program.setUniform1f("opacity",K.opacity),this.program.setUniform1f("layerOpacity",K.layerOpacity),this.program.setUniform4fv("externalColor",K.externalColor),this.program.setUniform1i("colorMixMode",C.colorMixModes[K.colorMixMode]));0===O?(M.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",K.ambient),this.program.setUniform3fv("diffuse",K.diffuse),this.program.setUniform4fv("externalColor",K.externalColor),
this.program.setUniform1i("colorMixMode",C.colorMixModes[K.colorMixMode]),this.program.setUniform1f("opacity",K.opacity),this.program.setUniform1f("layerOpacity",K.layerOpacity),this.configuration.usePBR&&g.bindPBRUniforms(this.program,K,this.configuration.isSchematic)):4===O&&e.bindOutputHighlight(this.program,M);c.bindVisualVariablesUniformsForSymbols(this.program,K);w.bindVerticalOffsetUniforms(this.program,K,M);C.bindScreenSizePerspective(K.screenSizePerspective,this.program,"screenSizePerspectiveAlignment");
2!==K.textureAlphaMode&&3!==K.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",K.textureAlphaCutoff);null==(H=M.shadowMap)?void 0:H.bind(this.program);null==(J=M.ssaoHelper)?void 0:J.bind(this.program,M.camera)};G.bindDraw=function(K){const M=this.configuration.instancedDoublePrecision?q.fromValues(K.camera.viewInverseTransposeMatrix[3],K.camera.viewInverseTransposeMatrix[7],K.camera.viewInverseTransposeMatrix[11]):K.origin;t.bindViewCustomOrigin(this.program,M,K.camera.viewMatrix);
this.program.rebindTextures();(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&t.bindCameraPosition(this.program,M,K.camera.viewInverseTransposeMatrix);2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",K.camera.viewInverseTransposeMatrix);this.configuration.instancedDoublePrecision&&
f.InstancedDoublePrecision.bindCustomOrigin(this.program,M);y.bindSliceUniforms(this.program,this.configuration,K.slicePlane,M);0===this.configuration.output&&d.bindReadShadowMapViewCustomOrigin(this.program,K,M)};G.setPipeline=function(K,M){const H=this.configuration,J=3===K,O=2===K;return B.makePipelineState({blending:0!==H.output&&7!==H.output||!H.transparent?null:J?k.blendingDefault:k.OITBlending(K),culling:(H.cullFace?0!==H.cullFace:H.slicePlaneEnabled?!1:!H.transparent&&!H.doubleSidedMode)&&
B.cullingParams(H.cullFace),depthTest:{func:k.OITDepthTest(K)},depthWrite:J||O?H.writeDepth&&B.defaultDepthWriteParams:null,colorWrite:B.defaultColorWriteParams,stencilWrite:H.sceneHasOcludees?x.stencilWriteMaskOn:null,stencilTest:H.sceneHasOcludees?M?x.stencilToolMaskBaseParams:x.stencilBaseAllZerosParams:null,polygonOffset:J||O?null:k.getOITPolygonOffset(H.enableOffset)})};G.initializePipeline=function(){this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0);return this.setPipeline(this.configuration.transparencyPassType,
!1)};G.getPipelineState=function(K){return K?this._occludeePipelineState:this.pipeline};return E}(m.ShaderTechnique);m.shader=new h.ReloadableShaderModule(A.DefaultMaterialShader,()=>new Promise(function(D,E){a(["./DefaultMaterial.glsl"],D,E)}));h=function(D){function E(){var G=D.apply(this,arguments)||this;G.output=0;G.alphaDiscardMode=1;G.doubleSidedMode=0;G.isSchematic=!1;G.vertexColors=!1;G.offsetBackfaces=!1;G.symbolColors=!1;G.vvSize=!1;G.vvColor=!1;G.verticalOffset=!1;G.receiveShadows=!1;G.slicePlaneEnabled=
!1;G.sliceHighlightDisabled=!1;G.receiveAmbientOcclusion=!1;G.screenSizePerspective=!1;G.textureAlphaPremultiplied=!1;G.hasColorTexture=!1;G.usePBR=!1;G.hasMetalnessAndRoughnessTexture=!1;G.hasEmissionTexture=!1;G.hasOcclusionTexture=!1;G.hasNormalTexture=!1;G.instanced=!1;G.instancedColor=!1;G.instancedDoublePrecision=!1;G.vertexTangents=!1;G.normalsTypeDerivate=!1;G.writeDepth=!0;G.sceneHasOcludees=!1;G.transparent=!1;G.enableOffset=!0;G.cullFace=0;G.transparencyPassType=3;G.multipassTerrainEnabled=
!1;G.cullAboveGround=!1;return G}b._inheritsLoose(E,D);return E}(n.ShaderTechniqueConfiguration);r.__decorate([n.parameter({count:8})],h.prototype,"output",void 0);r.__decorate([n.parameter({count:4})],h.prototype,"alphaDiscardMode",void 0);r.__decorate([n.parameter({count:3})],h.prototype,"doubleSidedMode",void 0);r.__decorate([n.parameter()],h.prototype,"isSchematic",void 0);r.__decorate([n.parameter()],h.prototype,"vertexColors",void 0);r.__decorate([n.parameter()],h.prototype,"offsetBackfaces",
void 0);r.__decorate([n.parameter()],h.prototype,"symbolColors",void 0);r.__decorate([n.parameter()],h.prototype,"vvSize",void 0);r.__decorate([n.parameter()],h.prototype,"vvColor",void 0);r.__decorate([n.parameter()],h.prototype,"verticalOffset",void 0);r.__decorate([n.parameter()],h.prototype,"receiveShadows",void 0);r.__decorate([n.parameter()],h.prototype,"slicePlaneEnabled",void 0);r.__decorate([n.parameter()],h.prototype,"sliceHighlightDisabled",void 0);r.__decorate([n.parameter()],h.prototype,
"receiveAmbientOcclusion",void 0);r.__decorate([n.parameter()],h.prototype,"screenSizePerspective",void 0);r.__decorate([n.parameter()],h.prototype,"textureAlphaPremultiplied",void 0);r.__decorate([n.parameter()],h.prototype,"hasColorTexture",void 0);r.__decorate([n.parameter()],h.prototype,"usePBR",void 0);r.__decorate([n.parameter()],h.prototype,"hasMetalnessAndRoughnessTexture",void 0);r.__decorate([n.parameter()],h.prototype,"hasEmissionTexture",void 0);r.__decorate([n.parameter()],h.prototype,
"hasOcclusionTexture",void 0);r.__decorate([n.parameter()],h.prototype,"hasNormalTexture",void 0);r.__decorate([n.parameter()],h.prototype,"instanced",void 0);r.__decorate([n.parameter()],h.prototype,"instancedColor",void 0);r.__decorate([n.parameter()],h.prototype,"instancedDoublePrecision",void 0);r.__decorate([n.parameter()],h.prototype,"vertexTangents",void 0);r.__decorate([n.parameter()],h.prototype,"normalsTypeDerivate",void 0);r.__decorate([n.parameter()],h.prototype,"writeDepth",void 0);r.__decorate([n.parameter()],
h.prototype,"sceneHasOcludees",void 0);r.__decorate([n.parameter()],h.prototype,"transparent",void 0);r.__decorate([n.parameter()],h.prototype,"enableOffset",void 0);r.__decorate([n.parameter({count:3})],h.prototype,"cullFace",void 0);r.__decorate([n.parameter({count:4})],h.prototype,"transparencyPassType",void 0);r.__decorate([n.parameter()],h.prototype,"multipassTerrainEnabled",void 0);r.__decorate([n.parameter()],h.prototype,"cullAboveGround",void 0);p.DefaultMaterialTechnique=m;p.DefaultMaterialTechniqueConfiguration=
h;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define(["exports","../../../../../../chunks/vec3f64","../util/DoublePrecision.glsl","../../shaderModules/interfaces","../../../lib/doublePrecisionUtils"],function(a,p,b,r,q){function y(e,l){l.instanced&&l.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),
e.attributes.add("modelNormal","mat3"));l.instancedDoublePrecision&&(e.vertex.include(b.DoublePrecision,l),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));const g=[r.glsl`
    vec3 calculateVPos() {
      ${l.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `,r.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${l.instancedDoublePrecision?r.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `,r.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${l.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `,r.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${l.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `,l.vertexTangents?r.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${l.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `:r.glsl``];e.vertex.code.add(g[0]);e.vertex.code.add(g[1]);e.vertex.code.add(g[2]);2===l.output&&e.vertex.code.add(g[3]);e.vertex.code.add(g[4])}(function(e){e.Uniforms=function(){};e.bindCustomOrigin=function(l,g){q.encodeDoubleArraySplit(g,f,w,3);l.setUniform3fv("viewOriginHi",f);l.setUniform3fv("viewOriginLo",w)}})(y||(y={}));const f=p.create(),w=p.create();a.InstancedDoublePrecision=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports",
"../../../../../../core/has","../../shaderModules/interfaces","../../../lib/WebGLDriverTest"],function(a,p,b,r){a.DoublePrecision=function({code:q},y){y.doublePrecisionRequiresObfuscation?q.add(b.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):q.add(b.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};a.doublePrecisionRequiresObfuscation=function(q){return p("force-double-precision-obfuscation")?!0:r.testWebGLDriver(q).doublePrecisionRequiresObfuscation};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/WebGLDriverTest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/enums ../../../webgl/checkWebGLError ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject ./doublePrecisionUtils ./Util ../../../webgl/testFloatBufferBlend ../../../webgl/testSVGPremultipliedAlpha".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){function m(k,v){var x=new y(k,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});const C=q.createVertex(k,35044,new Uint16Array([0,0,1,0,0,1,1,1])),A=new d(k,new Map([["position",0]]),{geometry:[{name:"position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:C}),B=r.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),D=r.fromValues(5633271.46742708,
2626873.6381334523,1434963.231608387);v=new f.Program(k,`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${v?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]));var E=new Float32Array(6);c.encodeDoubleArray(B,E,3);var G=new Float32Array(6);c.encodeDoubleArray(D,G,3);k.useProgram(v);v.setUniform3f("u_highA",E[0],E[2],E[4]);v.setUniform3f("u_lowA",E[1],E[3],E[5]);v.setUniform3f("u_highB",G[0],G[2],G[4]);v.setUniform3f("u_lowB",G[1],G[3],G[5]);E=v;G=k.getBoundFramebufferObject();const {x:K,y:M,width:H,height:J}=k.getViewport();
k.bindFramebuffer(x);k.setViewport(0,0,1,1);k.bindVAO(A);k.drawArrays(5,0,4);v=new Uint8Array(4);x.readPixels(0,0,1,1,6408,5121,v);E.dispose();A.dispose(!1);C.dispose();x.dispose();k.setViewport(K,M,H,J);k.bindFramebuffer(G);k=(B[2]-D[2])/25;x=u.unpackFloatRGBA(v);return Math.abs(k-x)}let n=function(){function k(v){this.context=v;this.floatBufferBlendWorking=this.svgAlwaysPremultipliesAlpha=!1;this._doublePrecisionRequiresObfuscation=null;this.floatBufferBlendWorking=t.testFloatBufferBlend(v);h.testSVGPremultipliedAlpha(v).then(x=>
this.svgAlwaysPremultipliesAlpha=!x)}p._createClass(k,[{key:"doublePrecisionRequiresObfuscation",get:function(){if(b.isNone(this._doublePrecisionRequiresObfuscation)){const v=m(this.context,!1),x=m(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==v&&(0===x||5<v/x)}return this._doublePrecisionRequiresObfuscation}}]);return k}(),z=null;a.clearTestWebGLDriver=function(k){b.isSome(z)&&z.context===k&&(z=null)};a.testWebGLDriver=function(k){if(b.isNone(z)||z.context!==k)z=new n(k);return z};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./FramebufferObject ./Program ./renderState ./VertexArrayObject".split(" "),function(a,p,b,r,q,y,f){var w={exports:{}};(function(e){(function(l){l=l();void 0!==l&&(e.exports=l)})(function(){function l(k){if(null==n){n={};z={};for(var v in k)"number"==typeof k[v]&&(n[k[v]]=v,z[v]=k[v])}}function g(){if(null==n)throw"WebGLDebugUtils.init(ctx) not called";
}function d(k){g();var v=n[k];return void 0!==v?"gl."+v:"/*UNKNOWN WebGL ENUM*/ 0x"+k.toString(16)}function c(k,v,x,C){k=m[k];if(void 0!==k&&(k=k[v],void 0!==k&&k[x])){if("object"===typeof k[x]&&void 0!==k[x].enumBitwiseOr){v=k[x].enumBitwiseOr;x=0;k=[];for(var A=0;A<v.length;++A){var B=z[v[A]];0!==(C&B)&&(x|=B,k.push(d(B)))}return x===C?k.join(" | "):d(C)}return d(C)}return null===C?"null":void 0===C?"undefined":C.toString()}function u(k,v,x){k.__defineGetter__(x,function(){return v[x]});k.__defineSetter__(x,
function(C){v[x]=C})}function t(k,v,x,C){function A(K,M){return function(){x&&x(M,arguments);var H=K[M].apply(K,arguments),J=C.getError();0!=J&&(B[J]=!0,v(J,M,arguments));return H}}C=C||k;l(k);v=v||function(K,M,H){for(var J="",O=H.length,I=0;I<O;++I)J+=(0==I?"":", ")+c(M,O,I,H[I]);K="WebGL error "+d(K)+" in "+M+"("+J+")";window.console&&window.console.error?window.console.error(K):window.console&&window.console.log&&window.console.log(K)};var B={},D={},E;for(E in k)if("function"==typeof k[E])if("getExtension"!=
E)D[E]=A(k,E);else{var G=A(k,E);D[E]=function(){var K=G.apply(k,arguments);return t(K,v,x,C)}}else u(D,k,E);D.getError=function(){for(var K in B)if(B.hasOwnProperty(K)&&B[K])return B[K]=!1,K;return k.NO_ERROR};return D}function h(k){var v=k.getParameter(k.MAX_VERTEX_ATTRIBS),x=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,x);for(var C=0;C<v;++C)k.disableVertexAttribArray(C),k.vertexAttribPointer(C,4,k.FLOAT,!1,0,0),k.vertexAttrib1f(C,0);k.deleteBuffer(x);v=k.getParameter(k.MAX_TEXTURE_IMAGE_UNITS);
for(C=0;C<v;++C)k.activeTexture(k.TEXTURE0+C),k.bindTexture(k.TEXTURE_CUBE_MAP,null),k.bindTexture(k.TEXTURE_2D,null);k.activeTexture(k.TEXTURE0);k.useProgram(null);k.bindBuffer(k.ARRAY_BUFFER,null);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,null);k.bindFramebuffer(k.FRAMEBUFFER,null);k.bindRenderbuffer(k.RENDERBUFFER,null);k.disable(k.BLEND);k.disable(k.CULL_FACE);k.disable(k.DEPTH_TEST);k.disable(k.DITHER);k.disable(k.SCISSOR_TEST);k.blendColor(0,0,0,0);k.blendEquation(k.FUNC_ADD);k.blendFunc(k.ONE,k.ZERO);
k.clearColor(0,0,0,0);k.clearDepth(1);k.clearStencil(-1);k.colorMask(!0,!0,!0,!0);k.cullFace(k.BACK);k.depthFunc(k.LESS);k.depthMask(!0);k.depthRange(0,1);k.frontFace(k.CCW);k.hint(k.GENERATE_MIPMAP_HINT,k.DONT_CARE);k.lineWidth(1);k.pixelStorei(k.PACK_ALIGNMENT,4);k.pixelStorei(k.UNPACK_ALIGNMENT,4);k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1);k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);k.UNPACK_COLORSPACE_CONVERSION_WEBGL&&k.pixelStorei(k.UNPACK_COLORSPACE_CONVERSION_WEBGL,k.BROWSER_DEFAULT_WEBGL);
k.polygonOffset(0,0);k.sampleCoverage(1,!1);k.scissor(0,0,k.canvas.width,k.canvas.height);k.stencilFunc(k.ALWAYS,0,4294967295);k.stencilMask(4294967295);k.stencilOp(k.KEEP,k.KEEP,k.KEEP);k.viewport(0,0,k.canvas.width,k.canvas.height);for(k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT|k.STENCIL_BUFFER_BIT);k.getError(););}var m={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},
getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,
6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT",
"DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},
n=null,z=null;return{init:l,mightBeEnum:function(k){g();return void 0!==n[k]},glEnumToString:d,glFunctionArgToString:c,glFunctionArgsToString:function(k,v){for(var x="",C=v.length,A=0;A<C;++A)x+=(0==A?"":", ")+c(k,C,A,v[A]);return x},makeDebugContext:t,makeLostContextSimulatingCanvas:function(k){function v(S){return"function"==typeof S?S:function(P){S.handleEvent(P)}}function x(){for(var S=Object.keys(R),P=0;P<S.length;++P)delete R[S]}function C(){++F;J||I==F&&k.loseContext()}function A(S,P){var Q=
S[P];return function(){C();if(!J)return Q.apply(S,arguments)}}function B(S){return{statusMessage:S,preventDefault:function(){L=!0}}}function D(S){for(var P in S)"function"==typeof S[P]?M[P]=A(S,P):u(M,S,P);M.getError=function(){C();if(!J)for(var ca;ca=E.getError();)R[ca]=!0;for(ca in R)if(R[ca])return delete R[ca],ca;return M.NO_ERROR};var Q="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(P=0;P<Q.length;++P){var V=Q[P];M[V]=function(ca){return function(){C();
if(J)return null;var ba=ca.apply(S,arguments);ba.__webglDebugContextLostId__=H;O.push(ba);return ba}}(S[V])}Q="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");for(P=0;P<Q.length;++P)V=Q[P],M[V]=function(ca){return function(){C();
return J?null:ca.apply(S,arguments)}}(M[V]);Q="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(P=0;P<Q.length;++P)V=Q[P],M[V]=function(ca){return function(){C();return J?!1:ca.apply(S,arguments)}}(M[V]);M.checkFramebufferStatus=function(ca){return function(){C();return J?M.FRAMEBUFFER_UNSUPPORTED:ca.apply(S,arguments)}}(M.checkFramebufferStatus);M.getAttribLocation=function(ca){return function(){C();return J?-1:ca.apply(S,arguments)}}(M.getAttribLocation);
M.getVertexAttribOffset=function(ca){return function(){C();return J?0:ca.apply(S,arguments)}}(M.getVertexAttribOffset);M.isContextLost=function(){return J};return M}var E,G=[],K=[];var M={};var H=1,J=!1,O=[],I=0,F=0,L=!1,N=0,R={};k.getContext=function(S){return function(){var P=S.apply(k,arguments);if(P instanceof WebGLRenderingContext){if(P!=E){if(E)throw"got different context";E=P;M=D(E)}return M}return P}}(k.getContext);(function(S){var P=S.addEventListener;S.addEventListener=function(Q,V,ca){switch(Q){case "webglcontextlost":G.push(v(V));
break;case "webglcontextrestored":K.push(v(V));break;default:P.apply(S,arguments)}}})(k);k.loseContext=function(){if(!J){J=!0;I=0;for(++H;E.getError(););x();R[E.CONTEXT_LOST_WEBGL]=!0;var S=B("context lost"),P=G.slice();setTimeout(function(){for(var Q=0;Q<P.length;++Q)P[Q](S);0<=N&&setTimeout(function(){k.restoreContext()},N)},0)}};k.restoreContext=function(){J&&K.length&&setTimeout(function(){if(!L)throw"can not restore. webglcontestlost listener did not call event.preventDefault";for(var S=0;S<
O.length;++S){var P=O[S];P instanceof WebGLBuffer?E.deleteBuffer(P):P instanceof WebGLFramebuffer?E.deleteFramebuffer(P):P instanceof WebGLProgram?E.deleteProgram(P):P instanceof WebGLRenderbuffer?E.deleteRenderbuffer(P):P instanceof WebGLShader?E.deleteShader(P):P instanceof WebGLTexture&&E.deleteTexture(P)}h(E);J=!1;F=0;L=!1;S=K.slice();P=B("context restored");for(var Q=0;Q<S.length;++Q)S[Q](P)},0)};k.loseContextInNCalls=function(S){if(J)throw"You can not ask a lost contet to be lost";I=F+S};k.getNumCalls=
function(){return F};k.setRestoreTimeout=function(S){N=S};return k},resetToInitialState:h}})})(w);a.testFloatBufferBlend=function(e){var l,g,d;if(!e.gl)return!1;if("webgl"===e.webglVersion){var c,u;return(null==(c=e.capabilities.textureFloat)?void 0:c.textureFloat)&&(null==(u=e.capabilities.colorBufferFloat)?void 0:u.textureFloat)}if(!((null==(l=e.capabilities.textureFloat)?0:l.textureFloat)&&(null==(g=e.capabilities.colorBufferFloat)?0:g.textureFloat)&&(null==(d=e.capabilities.colorBufferFloat)?
0:d.floatBlend)))return!1;l=new r(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5126,internalFormat:34836,samplingMode:9728,width:1,height:1});g=b.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1]));d=new f(e,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:g});c=new q.Program(e,"\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",
"\n   precision highp float;\n\n   void main() {\n    gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));e.useProgram(c);u=e.getBoundFramebufferObject();const {x:t,y:h,width:m,height:n}=e.getViewport();e.bindFramebuffer(l);e.setViewport(0,0,1,1);e.bindVAO(d);e.drawArrays(5,0,4);var z=y.makePipelineState({blending:p.blendingAlpha});e.setPipelineState(z);e.drawArrays(5,0,4);w.exports.init(e);z=e.gl.getError();e.setViewport(t,h,m,n);e.bindFramebuffer(u);c.dispose();d.dispose(!1);
g.dispose();l.dispose();return 1282===z?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ./BufferObject ./FramebufferObject ./Program ./Texture ./VertexArrayObject".split(" "),function(a,p,b,r,q,y,f){function w(){w=p._asyncToGenerator(function*(e){const l=new Image;
l.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";l.width=5;l.height=5;yield l.decode();if(!e.gl)return!0;const g=new r(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),d=b.createVertex(e,
35044,new Uint16Array([0,0,1,0,0,1,1,1])),c=new f(e,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:d}),u=new q.Program(e,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv \x3d a_pos;\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor \x3d texture2D(u_texture, v_uv);\n  }\n  ",
new Map([["a_pos",0]]));e.useProgram(u);const t=new y(e,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},l);e.bindTexture(t,0);u.setUniform1i("u_texture",0);const h=e.getBoundFramebufferObject(),{x:m,y:n,width:z,height:k}=e.getViewport();e.bindFramebuffer(g);e.setViewport(0,0,1,1);e.bindVAO(c);e.drawArrays(5,0,4);const v=new Uint8Array(4);g.readPixels(0,0,1,1,6408,5121,v);u.dispose();c.dispose(!1);d.dispose();g.dispose();t.dispose();e.setViewport(m,n,z,k);e.bindFramebuffer(h);
l.src="";return 255===v[0]});return w.apply(this,arguments)}a.testSVGPremultipliedAlpha=function(e){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define(["exports","../../../../../../chunks/vec3f32","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/interfaces"],function(a,p,b,r){p=p.fromValues(0,.6,.2);a.PBRSchematicMRRValues=p;a.PhysicallyBasedRenderingParameters=
function(q,y){const f=q.fragment,w=y.hasMetalnessAndRoughnessTexture||y.hasEmissionTexture||y.hasOcclusionTexture;1===y.pbrMode&&w&&q.include(b.VertexTextureCoordinates,y);2===y.pbrMode?f.code.add(r.glsl`const vec3 mrr = vec3(0.0, 0.6, 0.2);
const vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`):(0===y.pbrMode&&f.code.add(r.glsl`float getBakedOcclusion() { return 1.0; }`),1===y.pbrMode&&(f.uniforms.add("emissionFactor","vec3"),f.uniforms.add("mrrFactors","vec3"),f.code.add(r.glsl`vec3 mrr;
vec3 emission;
float occlusion;`),y.hasMetalnessAndRoughnessTexture&&(f.uniforms.add("texMetallicRoughness","sampler2D"),y.supportsTextureAtlas&&f.uniforms.add("texMetallicRoughnessSize","vec2"),f.code.add(r.glsl`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),y.hasEmissionTexture&&(f.uniforms.add("texEmission","sampler2D"),y.supportsTextureAtlas&&f.uniforms.add("texEmissionSize","vec2"),f.code.add(r.glsl`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),y.hasOcclusionTexture?(f.uniforms.add("texOcclusion","sampler2D"),y.supportsTextureAtlas&&f.uniforms.add("texOcclusionSize","vec2"),f.code.add(r.glsl`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):f.code.add(r.glsl`float getBakedOcclusion() { return 1.0; }`),f.code.add(r.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${w?"vtc.uv \x3d vuv0;":""}
      ${y.hasMetalnessAndRoughnessTexture?y.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${y.hasEmissionTexture?y.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${y.hasOcclusionTexture?y.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)))};a.bindPBRUniforms=function(q,y,f=!1){f||(q.setUniform3fv("mrrFactors",y.mrrFactors),q.setUniform3fv("emissionFactor",y.emissiveFactor))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,p,b,r){a.VertexTextureCoordinates=function(q,y){q.include(p.TextureCoordinateAttribute,
y);q.fragment.code.add(r.glsl`
  struct TextureLookupParameter {
    vec2 uv;
    ${y.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `);1===y.attributeTextureCoordinates&&q.fragment.code.add(r.glsl`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return texture2D(tex, params.uv);
}`);2===y.attributeTextureCoordinates&&(q.include(b.TextureAtlasLookup),q.fragment.code.add(r.glsl`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.TextureAtlasLookup=function(b){b.extensions.add("GL_EXT_shader_texture_lod");b.extensions.add("GL_OES_standard_derivatives");b.fragment.code.add(p.glsl`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K){function M(J){const O=new K.ShaderBuilder,I=O.vertex.code,F=O.fragment.code;O.include(D.HeaderComment,{name:"Default Material Shader",output:J.output});O.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");O.include(w.PositionAttribute);O.varyings.add("vpos","vec3");O.include(A.VisualVariables,J);O.include(y.InstancedDoublePrecision,J);O.include(c.VerticalOffset,J);if(0===J.output||
7===J.output)O.include(f.NormalAttribute,J),O.include(q.Transform,{linearDepth:!1}),0===J.normalType&&J.offsetBackfaces&&O.include(b.Offset),O.include(h.ComputeNormalTexture,J),O.include(d.VertexNormal,J),J.instancedColor&&O.attributes.add("instanceColor","vec4"),O.varyings.add("localvpos","vec3"),O.include(l.TextureCoordinateAttribute,J),O.include(p.ForwardLinearDepth,J),O.include(e.SymbolColor,J),O.include(g.VertexColor,J),O.vertex.uniforms.add("externalColor","vec4"),O.varyings.add("vcolorExt",
"vec4"),J.multipassTerrainEnabled&&O.varyings.add("depth","float"),I.add(G.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${J.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${G.glsl.float(B.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${0===J.normalType?G.glsl`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${J.vertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${0===J.normalType&&J.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
        }

        ${J.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `);7===J.output&&(O.include(r.Slice,J),O.include(B.DiscardOrAdjustAlpha,J),J.multipassTerrainEnabled&&(O.fragment.include(t.ReadLinearDepth),O.include(z.multipassTerrainTest,J)),O.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),J.hasColorTexture&&O.fragment.uniforms.add("tex","sampler2D"),O.fragment.include(E.MixExternalColor),F.add(G.glsl`
      void main() {
        discardBySlice(vpos);
        ${J.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${J.hasColorTexture?G.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${J.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:G.glsl`vec4 texColor = vec4(1.0);`}
        ${J.attributeColor?G.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:G.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `));0===J.output&&(O.include(r.Slice,J),O.include(n.EvaluateSceneLighting,J),O.include(m.EvaluateAmbientOcclusion,J),O.include(B.DiscardOrAdjustAlpha,J),J.receiveShadows&&O.include(C.ReadShadowMap,J),J.multipassTerrainEnabled&&(O.fragment.include(t.ReadLinearDepth),O.include(z.multipassTerrainTest,J)),O.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),J.hasColorTexture&&O.fragment.uniforms.add("tex",
"sampler2D"),O.include(x.PhysicallyBasedRenderingParameters,J),O.include(v.PhysicallyBasedRendering,J),O.fragment.include(E.MixExternalColor),O.include(k.Normals,J),F.add(G.glsl`
      void main() {
        discardBySlice(vpos);
        ${J.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${J.hasColorTexture?G.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${J.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:G.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - camPos);
        ${3===J.normalType?G.glsl`
        vec3 normal = screenDerivativeNormal(localvpos);`:G.glsl`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${1===J.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${J.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===J.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${J.attributeColor?G.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:G.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${J.hasNormalTexture?G.glsl`
              mat3 tangentSpace = ${J.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal \x3d normal;"}
        ${1===J.pbrMode||2===J.pbrMode?1===J.viewingMode?G.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:G.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:G.glsl``}
        ${1===J.pbrMode||2===J.pbrMode?G.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${J.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));O.include(u.DefaultMaterialAuxiliaryPasses,J);return O}var H=Object.freeze({__proto__:null,build:M});a.DefaultMaterialShader=H;a.build=M})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,p){a.Offset=function(b){b.vertex.code.add(p.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../util/DecodeNormal.glsl","../../shaderModules/interfaces"],function(a,p,b){a.NormalAttribute=function(r,q){0===q.normalType&&(r.attributes.add("normal","vec3"),r.vertex.code.add(b.glsl`vec3 normalModel() {
return normal;
}`));1===q.normalType&&(r.include(p.DecodeNormal),r.attributes.add("normalCompressed","vec2"),r.vertex.code.add(b.glsl`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`));3===q.normalType&&(r.extensions.add("GL_OES_standard_derivatives"),r.fragment.code.add(b.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.DecodeNormal=function(b){const r=p.glsl`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;b.fragment.code.add(r);b.vertex.code.add(r)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.PositionAttribute=function(b){b.attributes.add("position","vec3");b.vertex.code.add(p.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["exports",
"../../../collections/Component/Material/shader/DecodeSymbolColor.glsl","../../shaderModules/interfaces"],function(a,p,b){a.SymbolColor=function(r,q){q.symbolColor?(r.include(p.DecodeSymbolColor),r.attributes.add("symbolColor","vec4"),r.varyings.add("colorMixMode","mediump float")):r.fragment.uniforms.add("colorMixMode","int");q.symbolColor?r.vertex.code.add(b.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`):r.vertex.code.add(b.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,p){a.DecodeSymbolColor=function(b){b.vertex.code.add(p.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${p.glsl.int(1)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${p.glsl.int(3)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${p.glsl.int(4)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${p.glsl.int(1)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.VertexColor=function(b,r){r.attributeColor?(b.attributes.add("color","vec4"),b.varyings.add("vColor","vec4"),b.vertex.code.add(p.glsl`void forwardVertexColor() { vColor = color; }`),b.vertex.code.add(p.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):b.vertex.code.add(p.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define(["exports","./NormalAttribute.glsl","./VertexPosition.glsl","../../shaderModules/interfaces"],function(a,p,b,r){function q(y,f){0===f.normalType||1===f.normalType?(y.include(p.NormalAttribute,f),y.varyings.add("vNormalWorld","vec3"),y.varyings.add("vNormalView","vec3"),y.vertex.uniforms.add("uTransformNormal_GlobalFromModel",
"mat3"),y.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),y.vertex.code.add(r.glsl`void forwardNormal() {
vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();
vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;
}`)):2===f.normalType?(y.include(b.VertexPosition,f),y.varyings.add("vNormalWorld","vec3"),y.vertex.code.add(r.glsl`
    void forwardNormal() {
      vNormalWorld = ${1===f.viewingMode?r.glsl`normalize(vPositionWorldCameraRelative);`:r.glsl`vec3(0.0, 0.0, 1.0);`}
    }
    `)):y.vertex.code.add(r.glsl`void forwardNormal() {}`)}(function(y){y.bindUniforms=function(f,w){f.setUniformMatrix4fv("viewNormal",w)}})(q||(q={}));a.VertexNormal=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/interfaces".split(" "),
function(a,p,b,r,q,y,f){function w(e,l){e.include(q.PositionAttribute);e.vertex.include(y.DoublePrecision,l);e.varyings.add("vPositionWorldCameraRelative","vec3");e.varyings.add("vPosition_view","vec3");e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3");e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3");e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3");e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3");e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3");
e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3");e.vertex.uniforms.add("uTransform_ProjFromView","mat4");e.vertex.code.add(f.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
uTransform_WorldFromModel_TL,
uTransform_WorldFromModel_TH,
-uTransform_WorldFromView_TL,
-uTransform_WorldFromView_TH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 position_view() {
return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();
}
void forwardPosition() {
vPositionWorldCameraRelative = positionWorldCameraRelative();
vPosition_view = position_view();
gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);
}
vec3 positionWorld() {
return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
}`);e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3");e.fragment.code.add(f.glsl`vec3 positionWorld() {
return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
}`)}(function(e){e.ModelTransform=function(){this.worldFromModel_RS=p.create();this.worldFromModel_TH=r.create();this.worldFromModel_TL=r.create()};e.ViewProjectionTransform=function(){this.worldFromView_TH=r.create();this.worldFromView_TL=r.create();this.viewFromCameraRelative_RS=p.create();this.projFromView=b.create()};e.bindModelTransform=function(l,g){l.setUniformMatrix3fv("uTransform_WorldFromModel_RS",g.worldFromModel_RS);l.setUniform3fv("uTransform_WorldFromModel_TH",g.worldFromModel_TH);l.setUniform3fv("uTransform_WorldFromModel_TL",
g.worldFromModel_TL)};e.bindViewProjTransform=function(l,g){l.setUniform3fv("uTransform_WorldFromView_TH",g.worldFromView_TH);l.setUniform3fv("uTransform_WorldFromView_TL",g.worldFromView_TL);l.setUniformMatrix4fv("uTransform_ProjFromView",g.projFromView);l.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",g.viewFromCameraRelative_RS)}})(w||(w={}));a.VertexPosition=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../../shaderModules/interfaces".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){a.DefaultMaterialAuxiliaryPasses=function(d,c){const u=d.vertex.code,t=d.fragment.code;if(1===c.output||3===c.output)d.include(b.Transform,{linearDepth:!0}),d.include(q.TextureCoordinateAttribute,c),d.include(e.VisualVariables,c),d.include(f.OutputDepth,c),d.include(p.Slice,c),d.vertex.uniforms.add("cameraNearFar","vec2"),d.varyings.add("depth","float"),c.hasColorTexture&&d.fragment.uniforms.add("tex","sampler2D"),u.add(g.glsl`void main(void) {
vpos = calculateVPos();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);
forwardTextureCoordinates();
}`),d.include(l.DiscardOrAdjustAlpha,c),t.add(g.glsl`
      void main(void) {
        discardBySlice(vpos);
        ${c.hasColorTexture?g.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `);2===c.output&&(d.include(b.Transform,{linearDepth:!1}),d.include(r.NormalAttribute,c),d.include(y.VertexNormal,c),d.include(q.TextureCoordinateAttribute,c),d.include(e.VisualVariables,c),c.hasColorTexture&&d.fragment.uniforms.add("tex","sampler2D"),d.vertex.uniforms.add("viewNormal","mat4"),d.varyings.add("vPositionView","vec3"),u.add(g.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${0===c.normalType?g.glsl`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();
      }
    `),d.include(p.Slice,c),d.include(l.DiscardOrAdjustAlpha,c),t.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${c.hasColorTexture?g.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${3===c.normalType?g.glsl`
            vec3 normal = screenDerivativeNormal(vPositionView);`:g.glsl`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `));4===c.output&&(d.include(b.Transform,{linearDepth:!1}),d.include(q.TextureCoordinateAttribute,c),d.include(e.VisualVariables,c),c.hasColorTexture&&d.fragment.uniforms.add("tex","sampler2D"),u.add(g.glsl`void main(void) {
vpos = calculateVPos();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),d.include(p.Slice,c),d.include(l.DiscardOrAdjustAlpha,c),d.include(w.OutputHighlight),t.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${c.hasColorTexture?g.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define(["exports","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/interfaces"],function(a,p,b){a.ComputeNormalTexture=function(r,q){const y=r.fragment;q.vertexTangents?(r.attributes.add("tangent","vec4"),r.varyings.add("vTangent","vec4"),2===q.doubleSidedMode?y.code.add(b.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):y.code.add(b.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(r.extensions.add("GL_OES_standard_derivatives"),y.code.add(b.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`));0!==q.attributeTextureCoordinates&&(r.include(p.VertexTextureCoordinates,q),y.uniforms.add("normalTexture","sampler2D"),y.uniforms.add("normalTextureSize","vec2"),y.code.add(b.glsl`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${q.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.EvaluateAmbientOcclusion=function(b,r){b=b.fragment;r.receiveAmbientOcclusion?(b.uniforms.add("ssaoTex","sampler2D"),b.uniforms.add("viewportPixelSz","vec4"),b.code.add(p.glsl`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
return viewportPixelSz.z < 0.0 ? 1.0 : ssao;
}`)):b.code.add(p.glsl`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./EvaluateMainLighting.glsl ./PhysicallyBasedRendering.glsl ./PiUtils.glsl ./ReadShadowMap.glsl ../../shaderModules/interfaces".split(" "),function(a,p,b,r,q,y,f,w){a.EvaluateSceneLighting=function(e,l){const g=e.fragment;
e.include(r.EvaluateMainLighting);e.include(b.EvaluateAmbientOcclusion,l);0!==l.pbrMode&&e.include(q.PhysicallyBasedRendering,l);e.include(p.EvaluateAmbientLighting,l);l.receiveShadows&&e.include(f.ReadShadowMap,l);g.uniforms.add("lightingGlobalFactor","float");g.uniforms.add("ambientBoostFactor","float");e.include(y.PiUtils);g.code.add(w.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${0===l.pbrMode?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);g.code.add(w.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${1===l.viewingMode?w.glsl`normalize(vPosWorld)`:w.glsl`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);g.code.add(w.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`);if(0===l.pbrMode||4===l.pbrMode)g.code.add(w.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);else if(1===l.pbrMode||2===l.pbrMode)g.code.add(w.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),g.code.add(w.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),g.code.add(w.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = abs(dot(normal, ambientDir));
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),g.code.add(w.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),g.code.add(w.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${2===l.pbrMode?w.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:w.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.Normals=function(b,r){b=b.fragment;b.code.add(p.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);1===r.doubleSidedMode?b.code.add(p.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`):2===r.doubleSidedMode?b.code.add(p.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`):b.code.add(p.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../../../webgl/checkWebGLError"],function(a,p,b){a.HeaderComment=function(r,q){q=p.glsl`
  /*
  *  ${q.name}
  *  ${0===q.output?"RenderOutput: Color":1===q.output?"RenderOutput: Depth":3===q.output?"RenderOutput: Shadow":2===q.output?"RenderOutput: Normal":4===q.output?"RenderOutput: Highlight":""}
  */
  `;b.webglValidateShadersEnabled()&&(r.fragment.code.add(q),r.vertex.code.add(q))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,p,b){a.MixExternalColor=function(r){r.include(p.ColorConversion);r.code.add(b.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${b.glsl.int(1)}) {
        return allMixed;
      }
      else if (mode == ${b.glsl.int(2)}) {
        return internalMixed;
      }
      else if (mode == ${b.glsl.int(3)}) {
        return externalColor;
      }
      else {
        // tint (or something invalid)
        float vIn = rgb2v(internalMixed);
        vec3 hsvTint = rgb2hsv(externalColor);
        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
        return hsv2rgb(hsvOut);
      }
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${b.glsl.int(2)}) {
        return internalMixed;
      }
      else if (mode == ${b.glsl.int(3)}) {
        return externalOpacity;
      }
      else {
        // multiply or tint (or something invalid)
        return allMixed;
      }
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/RealisticTree.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../lib/DefaultVertexAttributeLocations ../lib/Program ./DefaultMaterialTechnique".split(" "),function(a,p,b,r,q,y,f,w,e){e=function(l){function g(){return l.apply(this,arguments)||
this}b._inheritsLoose(g,l);g.prototype.initializeProgram=function(d){var c=g.shader.get();const u=this.configuration;c=c.build({OITEnabled:0===u.transparencyPassType,output:u.output,viewingMode:d.viewingMode,receiveShadows:u.receiveShadows,slicePlaneEnabled:u.slicePlaneEnabled,sliceHighlightDisabled:u.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:u.symbolColors,vvSize:u.vvSize,vvColor:u.vvColor,vvInstancingEnabled:!0,instanced:u.instanced,instancedColor:u.instancedColor,instancedDoublePrecision:u.instancedDoublePrecision,
pbrMode:u.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:u.hasColorTexture,receiveAmbientOcclusion:u.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangents:!1,attributeTextureCoordinates:u.hasColorTexture?1:0,textureAlphaPremultiplied:u.textureAlphaPremultiplied,attributeColor:u.vertexColors,screenSizePerspectiveEnabled:u.screenSizePerspective,verticalOffsetEnabled:u.verticalOffset,
offsetBackfaces:u.offsetBackfaces,doublePrecisionRequiresObfuscation:q.doublePrecisionRequiresObfuscation(d.rctx),alphaDiscardMode:u.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:u.multipassTerrainEnabled,cullAboveGround:u.cullAboveGround});return new w.Program(d.rctx,c,f.Default3D)};return g}(e.DefaultMaterialTechnique);e.shader=new y.ReloadableShaderModule(r.RealisticTreeShader,()=>new Promise(function(l,g){a(["../core/shaderLibrary/default/RealisticTree.glsl"],l,g)}));p.RealisticTreeTechnique=
e;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B){function D(G){const K=new B.ShaderBuilder,M=K.vertex.code,H=K.fragment.code;K.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");K.include(w.PositionAttribute);K.varyings.add("vpos","vec3");K.include(v.VisualVariables,G);K.include(y.InstancedDoublePrecision,G);K.include(d.VerticalOffset,G);if(0===G.output||7===G.output)K.include(f.NormalAttribute,G),K.include(q.Transform,{linearDepth:!1}),
G.offsetBackfaces&&K.include(b.Offset),G.instancedColor&&K.attributes.add("instanceColor","vec4"),K.varyings.add("vNormalWorld","vec3"),K.varyings.add("localvpos","vec3"),G.multipassTerrainEnabled&&K.varyings.add("depth","float"),K.include(l.TextureCoordinateAttribute,G),K.include(p.ForwardLinearDepth,G),K.include(e.SymbolColor,G),K.include(g.VertexColor,G),K.vertex.uniforms.add("externalColor","vec4"),K.varyings.add("vcolorExt","vec4"),M.add(A.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${G.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${A.glsl.float(x.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${G.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
          }
          ${G.multipassTerrainEnabled?A.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);7===G.output&&(K.include(r.Slice,G),K.include(x.DiscardOrAdjustAlpha,G),G.multipassTerrainEnabled&&(K.fragment.include(u.ReadLinearDepth),K.include(m.multipassTerrainTest,G)),K.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),K.fragment.uniforms.add("view","mat4"),G.hasColorTexture&&K.fragment.uniforms.add("tex","sampler2D"),K.fragment.include(C.MixExternalColor),H.add(A.glsl`
      void main() {
        discardBySlice(vpos);
        ${G.multipassTerrainEnabled?A.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${G.hasColorTexture?A.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${G.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:A.glsl`vec4 texColor = vec4(1.0);`}
        ${G.attributeColor?A.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:A.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `));0===G.output&&(K.include(r.Slice,G),K.include(h.EvaluateSceneLighting,G),K.include(t.EvaluateAmbientOcclusion,G),K.include(x.DiscardOrAdjustAlpha,G),G.receiveShadows&&K.include(k.ReadShadowMap,G),G.multipassTerrainEnabled&&(K.fragment.include(u.ReadLinearDepth),K.include(m.multipassTerrainTest,G)),K.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),K.fragment.uniforms.add("view","mat4"),
G.hasColorTexture&&K.fragment.uniforms.add("tex","sampler2D"),K.include(z.PhysicallyBasedRenderingParameters,G),K.include(n.PhysicallyBasedRendering,G),K.fragment.include(C.MixExternalColor),H.add(A.glsl`
      void main() {
        discardBySlice(vpos);
        ${G.multipassTerrainEnabled?A.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${G.hasColorTexture?A.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${G.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:A.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - camPos);
        ${1===G.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${G.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===G.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${G.attributeColor?A.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:A.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${A.glsl`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${1===G.pbrMode||2===G.pbrMode?1===G.viewingMode?A.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:A.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:A.glsl``}
        ${1===G.pbrMode||2===G.pbrMode?A.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${G.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));K.include(c.DefaultMaterialAuxiliaryPasses,G);return K}var E=Object.freeze({__proto__:null,build:D});a.RealisticTreeShader=E;a.build=D})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/has ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N,R,S,P){function Q(fa){return e.isSome(fa)?"cross"===fa||"x"===fa:!1}const V=c.create(),ca=t.fromValues(0,0,1),ba=[.25,.25,.75,.75];q=function(fa){function aa(U,X,T,Y){U=fa.call(this,U,X,T,Y)||this;U._cimLayers=null;U._cimSymbolMaterials=new Map;U._cimSymbolTextures=new Map;U._cimMaterialParametersInfo=null;U._cimRequiredFields=null;U._cimScaleFactorOrFunction=null;U._size=null;U._symbolTextureRatio=1;U._outlineSize=
0;U._texture=null;U._releaseTexture=null;U._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return U}b._inheritsLoose(aa,fa);var W=aa.prototype;W.getCachedSize=function(){return{size:this._getIconSize()}};W.doLoad=function(){var U=b._asyncToGenerator(function*(X){this._validateOrThrow();const T=this._prepareMaterialParameters();var Y=this._getPrimitive();if(e.isSome(Y))this._prepareResourcesPrimitive(T,Y);else{Y=x.getIconHref(this.symbol,this.symbolLayer);const ea=d.dataComponents(Y);
ea&&"application/json"===ea.mediaType?yield this._prepareResourcesCIM(T,JSON.parse(ea.data),X):yield this._prepareResourcesHref(T,Y,X)}});return function(X){return U.apply(this,arguments)}}();W._validateOrThrow=function(){if(!this._drivenProperties.size){var U=H.validateSymbolLayerSize(this._getIconSize());if(U)throw new w("graphics3diconsymbollayer:invalid-size",U);}};W._getIconSize=function(){var U=this.symbolLayer;U=Math.round(null!=U.size?g.pt2px(U.size):16);return this._drivenProperties.size?
Math.max(U,64):U};W._generateTextureCIM=function(U){const X=this._getGraphicHash(U);let T=""===X?null:this._cimSymbolTextures.get(X);T||(U=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,U,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",U.anchorPosition),T=new R.Texture(U.imageData,{width:U.imageData.width,height:U.imageData.height,powerOfTwoResizeMode:2}),this._cimSymbolTextures.set(X,
T),this._context.stage.add(T));return T};W._computeSize=function(U,X){U=U.width/U.height;return 1<U?[X,Math.round(X/U)]:[Math.round(X*U),X]};W._prepareMaterialParameters=function(){const U={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},X=this.symbol;if(X&&"point-3d"===X.type&&X.hasVisibleVerticalOffset()){const {screenLength:T,minWorldLength:Y,maxWorldLength:ea}=X.verticalOffset;U.verticalOffset={screenLength:g.pt2px(T),minWorldLength:Y||0,maxWorldLength:null!=
ea?ea:Infinity}}this._context.screenSizePerspectiveEnabled&&(U.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);U.occlusionTest=!0;U.slicePlaneEnabled=this._context.slicePlaneEnabled;return U};W._prepareResourcesPrimitive=function(U,X){var T=this._getOutlineSize();if(Q(X)&&0===T)throw Error("Nothing to render");this._outlineSize=T;U.color=this._getFillColor();U.outlineColor=this._getOutlineColor();U.outlineSize=this._outlineSize;const Y=this._context.sharedResources.textures.fromData(X,
()=>{switch(X){case "circle":var ea=O.createCircle(128,64);break;case "square":ea=O.createSquare(128,64);break;case "kite":ea=O.createKite(128,64);break;case "cross":ea=O.createCross(128,64);break;case "x":ea=O.createX(128,64);break;case "triangle":ea=O.createTriangle(128,64)}return ea=new R.Texture(ea,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=Y.texture;this._releaseTexture=()=>this._context.sharedResources.textures.release(Y.uid);U.textureIsSignedDistanceField=
!0;U.distanceFieldBoundingBox=ba;U.textureId=this._texture.id;T=this._getIconSize();this._size=[T,T];this._symbolTextureRatio=2;this._createMaterialAndAddToStage(U,this._context.stage)};W._prepareResourcesHref=function(){var U=b._asyncToGenerator(function*(X,T,Y){if(!f("esri-canvas-svg-support")&&d.isSVG(T))throw new w("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize();X.color=this._getFillColor();
X.outlineColor=this._getOutlineColor();X.outlineSize=this._outlineSize;X.textureIsSignedDistanceField=!1;const ea=this._getIconSize();Y=yield y.result(this._context.sharedResources.textures.fromUrl(T,ea*this._context.layerView.view.pixelRatio,{signal:Y}));if(!1===Y.ok)throw l.throwIfAbortError(Y.error),new w("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${T})`);const {uid:ia,texture:la}=Y.value;this._releaseTexture=()=>this._context.sharedResources.textures.release(ia);
this._size=this._computeSize(la.params,ea);X.textureId=la.id;this._createMaterialAndAddToStage(X,this._context.stage)});return function(X,T,Y){return U.apply(this,arguments)}}();W._prepareResourcesCIM=function(){var U=b._asyncToGenerator(function*(X,T,Y){T=new P({data:T});if(!this._context.sharedResources.cimSymbolRasterizer){var ea=(yield new Promise(function(ua,wa){a(["../../../../symbols/cim/CIMSymbolRasterizer"],ua,wa)})).CIMSymbolRasterizer;l.throwIfAborted(Y);this._context.sharedResources.cimSymbolRasterizer||
(this._context.sharedResources.cimSymbolRasterizer=new ea(this._context.renderCoordsHelper.spatialReference,!0))}ea=this._context.layer.fields?this._context.layer.fields.map(ua=>ua.toJSON()):null;this._cimLayers=yield this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(T,ea,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:Y});let ia;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&
this._context.renderer.scaleExpression)if(T=this._context.renderer,isNaN(T.scaleExpression)){const ua=yield k.createRendererExpression(T.scaleExpression,this._context.layer.spatialReference,ea);ia=(wa,Fa,La)=>{wa=C(ua,wa,{$view:La},"esriGeometryPoint",Fa);return null!==wa?wa:1}}else var la=Number(T.scaleExpression);this._cimScaleFactorOrFunction=la||ia||1;la=this._context.renderer?yield this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];l.throwIfAborted(Y);const pa=this._context.layer.fieldsIndex;
this._cimRequiredFields=la.map(ua=>pa.get(ua).name);this._cimMaterialParametersInfo=X;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1});return function(X,T,Y){return U.apply(this,arguments)}}();W._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||
v.defaultPrimitive};W._getOutlineSize=function(){var U=0;U=this.symbolLayer;if(e.isSome(U.outline)&&null!=U.outline.size)return Math.max(g.pt2px(U.outline.size),0);U=this._getPrimitive();U=Q(U)?1.5:0;return Math.max(U,0)};W._getOutlineColor=function(){const U=this._getLayerOpacity(),X=e.get(this.symbolLayer,"outline","color");if(e.isSome(X)){const T=r.toUnitRGB(X);return[T[0],T[1],T[2],X.a*U]}return[0,0,0,0]};W._getFillColor=function(){if(Q(this._getPrimitive()))return A.TRANSPARENT_UNIT;const U=
e.isNone(this._getPrimitive()),X=e.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(X,{hasIntrinsicColor:U})};W._getAnchorPos=function(U,X){return"relative"===U?u.fromValues((X.x||0)+.5,-(X.y||0)+.5):U in H.namedAnchorToHUDMaterialAnchorPos?H.namedAnchorToHUDMaterialAnchorPos[U]:H.namedAnchorToHUDMaterialAnchorPos.center};W._createMaterialAndAddToStage=function(U,X){this._fastUpdates=this._cimLayers?{enabled:!1}:I.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());
this._fastUpdates.enabled&&Object.assign(U,this._fastUpdates.materialParameters);if(this._cimLayers){let T=this._cimSymbolMaterials.get(U.textureId);T||(T=new S.HUDMaterial(U),this._cimSymbolMaterials.set(U.textureId,T),X.add(T));return T}this._material=new S.HUDMaterial(U);X.add(this._material);return this._material};W._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(U=>{U.setParameterValues({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,
shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};W.destroy=function(){fa.prototype.destroy.call(this);this._forEachMaterial(U=>this._context.stage.remove(U));this._material=null;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(U=>this._context.stage.remove(U));this._cimSymbolTextures.clear();this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)};W._getScaleFactor=function(U,X){if(this._drivenProperties.size&&U.size){for(let T=0;3>T;T++){const Y=
U.size[T];Y&&"symbol-value"!==Y&&"proportional"!==Y&&(U.size[T]=g.pt2px(Y))}if("symbol-value"===U.size[0])return 1;if(isFinite(+U.size[0]))return+U.size[0]/X;if(isFinite(+U.size[2]))return+U.size[2]/X}return 1};W.createGraphics3DGraphic=function(U){const X=U.graphic;if(!this._validateGeometry(X.geometry))return null;let T;if(this._cimLayers){if(!this._cimLayers.length)return null;var Y=this._generateTextureCIM(X);T=this._createMaterialAndAddToStage({textureId:Y.id,...this._cimMaterialParametersInfo},
this._context.stage);var ea=[Y.params.width,Y.params.height]}else ea=this._size,T=e.unwrap(this._material);Y=J.placePointOnGeometry(X.geometry);if(e.isNone(Y))return this.logger.warn(`unsupported geometry type for icon symbol: ${X.geometry.type}`),null;var ia=U.renderingInfo;const la=this._getVertexOpacityAndColor(ia);let pa=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(pa=this._getScaleFactor(ia,ea[0]>ea[1]?ea[0]:ea[1]));pa*=this._symbolTextureRatio;ea=[ea[0]*pa,ea[1]*pa];
ia=this.setGraphicElevationContext(X,new E.ElevationContext);this.ensureDrapedStatus("on-the-ground"===ia.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(X,Y,T,la,ea,U.layer.uid):this._createAs3DShape(X,Y,T,la,ea,ia,X.uid)};W.layerOpacityChanged=function(){const U=this._getFillColor(),X=this._getOutlineColor();this._forEachMaterial(T=>{T.setParameterValues({color:U});T.setParameterValues({outlineColor:X})});return!0};W.layerElevationInfoChanged=function(U,
X,T){const Y=this._elevationContext.mode;T=D.elevationModeChangeUpdateType(aa.elevationModeChangeTypes,T,Y);if(T!==D.SymbolUpdateType.UPDATE)return T;const ea=D.needsElevationUpdates2D(Y)||"absolute-height"===Y;return this.updateGraphics3DGraphicElevationInfo(U,X,()=>ea)};W.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(U=>{U.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};W.physicalBasedRenderingChanged=function(){return!0};W.pixelRatioChanged=
function(){return this._getPrimitive()?!0:!1};W.applyRendererDiff=function(U,X){for(const T in U.diff)switch(T){case "visualVariables":if(I.updateFastSymbolUpdatesState(this._fastUpdates,X,this._fastVisualVariableConvertOptions()))e.isSome(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};W._defaultElevationInfoNoZ=function(){return Z};W._createAs3DShape=function(U,X,T,Y,ea,ia,la){const pa=this.getFastUpdateAttrValues(U);
U=pa?wa=>I.evaluateModelTransform(this._fastUpdates.materialParameters,pa,wa):null;Y=[L.createPointGeometry(ca,null,Y,ea,ha,null,pa)];la=J.createStageObjectForHUD(this._context,X,Y,[T],null,null,ia,this._context.layer.uid,la,U);if(null===la)return null;const ua=new K.Graphics3DObject3DGraphicLayer(this,la.object,Y,null,null,B.perObjectElevationAligner,ia);ua.alignedSampledElevation=la.sampledElevation;ua.needsElevationUpdates=D.needsElevationUpdates2D(ia.mode)||"absolute-height"===ia.mode;ua.getScreenSize=
this._createScreenSizeGetter(ea,U);ua.calculateRelativeScreenBounds=wa=>T.calculateRelativeScreenBounds(ua.getScreenSize(),1,wa);J.extendPointGraphicElevationContext(ua,X,this._context.elevationProvider);return ua};W._createAsOverlay=function(U,X,T,Y,ea,ia){T.renderPriority=this._renderPriority;const la=m.create();n.projectPointToVector(X,la,this._context.overlaySR);la[2]=F.DRAPED_Z;X=this._context.clippingExtent;if(e.isSome(X)&&!z.containsPoint(X,la))return null;const pa=this.getFastUpdateAttrValues(U);
X=pa?wa=>I.evaluateModelTransform(this._fastUpdates.materialParameters,pa,wa):null;Y=L.createPointGeometry(ca,la,Y,ea,null,null,pa);U=new N.RenderGeometry(Y,T,ia,U.uid);la[3]=0;h.copy(U.boundingSphere,la);U.calculateShaderTransformation=X;const ua=new G(this,[U],null);ua.getScreenSize=this._createScreenSizeGetter(ea,X);ua.calculateRelativeScreenBounds=wa=>T.calculateRelativeScreenBounds(ua.getScreenSize(),1,wa);return ua};W._createScreenSizeGetter=function(U,X){const T=this._outlineSize+2;if(this._fastUpdates.enabled){const Y=
U[0]/this._symbolTextureRatio,ea=U[1]/this._symbolTextureRatio;return(ia=u.create())=>{const la=X(V);ia[0]=la[0]*Y+T;ia[1]=la[5]*ea+T;return ia}}{const Y=U[0]/this._symbolTextureRatio+T,ea=U[1]/this._symbolTextureRatio+T;return(ia=u.create())=>{ia[0]=Y;ia[1]=ea;return ia}}};W._fastVisualVariableConvertOptions=function(){var U=this._size[0]>this._size[1]?this._size[0]:this._size[1];const X=t.fromValues(U,U,U),T=g.px2pt(1);U*=T;U=t.fromValues(U,U,U);return{modelSize:X,symbolSize:U,unitInMeters:T,transformation:{anchor:t.ZEROS,
scale:t.ONES,rotation:t.ZEROS}}};W._getGraphicHash=function(U){let X="";for(const T of this._cimRequiredFields)X+=T+U.attributes[T];return X};W._forEachMaterial=function(U){e.isSome(this._material)&&U(this._material);this._cimSymbolMaterials.forEach(U)};return aa}(M.Graphics3DSymbolLayer);q.PRIMITIVE_SIZE=[64,64];q.elevationModeChangeTypes={definedChanged:D.SymbolUpdateType.UPDATE,staysOnTheGround:D.SymbolUpdateType.NONE,onTheGroundChanged:D.SymbolUpdateType.RECREATE};const Z={mode:"relative-to-ground",
offset:0},ha=m.fromValues(0,0,0,1);p.Graphics3DIconSymbolLayer=q;p["default"]=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(a,p,b){function r(y){const f={};switch(y){case "esriGeometryPoint":return(w,e,l,g)=>b.unquantizePoint(e,f,w,l,g);case "esriGeometryPolygon":return(w,e,l,g)=>b.unquantizePolygon(e,f,w,l,g);case "esriGeometryPolyline":return(w,
e,l,g)=>b.unquantizePolyline(e,f,w,l,g);case "esriGeometryMultipoint":return(w,e,l,g)=>b.unquantizeMultipoint(e,f,w,l,g);default:return p.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${y}`)),w=>w}}const q=new Map;return function(y,f,w,e,l){if(y.referencesGeometry()&&l){{const {transform:g,hasZ:d,hasM:c}=l;q.has(e)||q.set(e,r(e));e=q.get(e)(f.geometry,g,d,c);f={...f,geometry:e}}}f=y.repurposeFeature(f);try{return y.evaluate({...w,$feature:f})}catch(g){return p.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",
g),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,p){const b=p.ZEROS;p=p.ONES;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=b;a.WHITE_UNIT=p;a.defaultIconElevationOffset=1;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),
function(a,p,b,r,q,y,f){let w=function(){function d(u,t,h){this.graphics3DSymbolLayer=u;this.renderGeometries=t;this.boundingBox=h;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._layerView=null;this.isElevationSource=!1}var c=d.prototype;c.initialize=function(u,t,h){this.stage=u;this._layerView=h;this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer};c.setVisibility=function(u){if(null!=this.stage&&this._visible!==u)if((this._visible=u)&&!this._addedToStage)this._addedToStage=
!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1);else if(u||this._addedToStage){for(const t of this.renderGeometries)t.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1)}};c.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4);this._visible=this._addedToStage=!1;this.stage=null};c.getCenterObjectSpace=function(u=r.create()){return b.set(u,
0,0,0)};c.getBoundingBoxObjectSpace=function(u=q.create()){return q.empty(u)};c.addObjectState=function(u,t){0===u&&(this.renderGeometries.forEach(h=>{const m=h.addHighlight();t.addRenderGeometry(h,m,this)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))};c.removeObjectState=function(u){this.renderGeometries.forEach(t=>{u.removeRenderGeometry(t)})};c.removeRenderGeometryObjectState=function(u,t){u.removeHighlight(t);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,
this._layerView)};c.computeAttachmentOrigin=function(u){for(const t of this.renderGeometries)t.computeAttachmentOrigin(g)&&(u.draped.origin[0]+=g[0],u.draped.origin[1]+=g[1],u.draped.num++)};c.getProjectedBoundingBox=function(){var u=a._asyncToGenerator(function*(t,h,m,n,z){q.empty(z);for(let k=0;k<this.renderGeometries.length;k++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[k],t,e,m),q.expandWithRect(z,e);if(h){q.center(z,g);let k;t=f.demResolutionForBoundingBox(z,h);try{k=
yield h.service.queryElevation(g[0],g[1],n,t,"ground")}catch(v){}p.isSome(k)&&(z[2]=Math.min(z[2],k),z[5]=Math.max(z[5],k))}return z});return function(t,h,m,n,z){return u.apply(this,arguments)}}();c._getRenderGeometryProjectedBoundingRect=function(u,t,h,m){if(this.boundingBox)q.set(l,this.boundingBox);else{u=u.boundingSphere;const n=u[3];l[0]=u[0]-n;l[1]=u[1]-n;l[2]=u[2]-n;l[3]=u[0]+n;l[4]=u[1]+n;l[5]=u[2]+n}t(l,0,2);this.calculateRelativeScreenBounds&&m.push({location:q.center(l),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});
return q.toRect(l,h)};return d}();const e=y.create(),l=q.create(),g=r.create();return w})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/Util"],function(a,p,b){function r(d,c){const u=new Uint8Array(4*d*d),t=d/2-.5;c/=2;for(let m=0;m<d;m++)for(let n=0;n<d;n++){const z=n+d*m;var h=n-t;const k=m-t;h=Math.sqrt(h*h+k*k)-c;h=h/d+.5;b.packFloatRGBA(h,u,4*z)}return u}function q(d,c){return l(d,c,!1)}function y(d,c){return l(d,c,
!0)}function f(d,c){return g(d,c,!1)}function w(d,c){return g(d,c,!0)}function e(d,c){const u=new Uint8Array(4*d*d),t=Math.sqrt(1.25),h=(d-c)/2;for(let m=0;m<d;m++)for(let n=0;n<d;n++){const z=(n-h)/c,k=(m-h+.75)/c;b.packFloatRGBA(Math.max(-(1*z+-.5*k)/t,(z-1+-.5*-k)/t,-k)*c/d+.5,u,4*(m*d+n))}return u}function l(d,c,u){u&&(c/=Math.SQRT2);const t=new Uint8Array(4*d*d);for(let m=0;m<d;m++)for(let n=0;n<d;n++){var h=n-.5*d+.25;let z=-m+.5*d-.75;const k=m*d+n;if(u){const v=(h+z)/Math.SQRT2;z=(z-h)/Math.SQRT2;
h=v}h=Math.max(Math.abs(h),Math.abs(z))-.5*c;h=h/d+.5;b.packFloatRGBA(h,t,4*k)}return t}function g(d,c,u){u&&(c*=Math.SQRT2);c*=.5;const t=new Uint8Array(4*d*d);for(let m=0;m<d;m++)for(let n=0;n<d;n++){var h=n-.5*d;let z=-m+.5*d-1;const k=m*d+n;if(u){const v=(h+z)/Math.SQRT2;z=(z-h)/Math.SQRT2;h=v}h=Math.abs(h);z=Math.abs(z);h=h>z?h>c?Math.sqrt((h-c)*(h-c)+z*z):z:z>c?Math.sqrt(h*h+(z-c)*(z-c)):h;h=h/d+.5;b.packFloatRGBA(h,t,4*k)}return t}a.createCircle=r;a.createCross=f;a.createKite=y;a.createSquare=
q;a.createTriangle=e;a.createType=function(d,c,u){switch(d){case "circle":return r(c,u);case "square":return q(c,u);case "cross":return f(c,u);case "x":return w(c,u);case "kite":return y(c,u);case "triangle":return e(c,u);default:return r(c,u)}};a.createX=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){function d(H){return null!==H&&void 0!==H}function c(H){return"number"===typeof H}function u(H){return"string"===typeof H}function t(H,J){H&&H.push(J)}function h(H,J,O,I=f.create()){H=H||0;J=J||0;O=O||0;0!==H&&y.rotateZ(I,I,-H/180*Math.PI);0!==J&&y.rotateX(I,I,J/180*Math.PI);0!==O&&y.rotateY(I,I,O/180*Math.PI);return I}function m(H,J,O,I,F){const L=H.minSize,N=H.maxSize;if(H.expression)return t(F,"Could not convert size info: expression not supported"),!1;if(H.useSymbolValue)return H=
I.symbolSize[O],J.minSize[O]=H,J.maxSize[O]=H,J.offset[O]=J.minSize[O],J.factor[O]=0,J.type[O]=1,!0;if(d(H.field)){if(d(H.stops)){if(2===H.stops.length&&c(H.stops[0].size)&&c(H.stops[1].size))return n(H.stops[0].size,H.stops[1].size,H.stops[0].value,H.stops[1].value,J,O),J.type[O]=1,!0;t(F,"Could not convert size info: stops only supported with 2 elements");return!1}if(c(L)&&c(N)&&d(H.minDataValue)&&d(H.maxDataValue))return n(L,N,H.minDataValue,H.maxDataValue,J,O),J.type[O]=1,!0;if(null!=l.meterIn[H.valueUnit])return J.minSize[O]=
-Infinity,J.maxSize[O]=Infinity,J.offset[O]=0,J.factor[O]=1/l.meterIn[H.valueUnit],J.type[O]=1,!0;if("unknown"===H.valueUnit)return t(F,"Could not convert size info: proportional size not supported"),!1;t(F,"Could not convert size info: scale-dependent size not supported");return!1}if(!d(H.field)){if(H.stops&&H.stops[0]&&c(H.stops[0].size))return J.minSize[O]=H.stops[0].size,J.maxSize[O]=H.stops[0].size,J.offset[O]=J.minSize[O],J.factor[O]=0,J.type[O]=1,!0;if(c(L))return J.minSize[O]=L,J.maxSize[O]=
L,J.offset[O]=L,J.factor[O]=0,J.type[O]=1,!0}t(F,"Could not convert size info: unsupported variant of sizeInfo");return!1}function n(H,J,O,I,F,L){I=0<Math.abs(I-O)?(J-H)/(I-O):0;F.minSize[L]=0<I?H:J;F.maxSize[L]=0<I?J:H;F.offset[L]=H-O*I;F.factor[L]=I}function z(H,J,O,I){if(H.normalizationField||H.valueRepresentation)return t(I,"Could not convert size info: unsupported property"),null;var F=H.field;if(null!=F&&!u(F))return t(I,"Could not convert size info: field is not a string"),null;if(!J.size)J.size=
{field:H.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(H.field)if(!J.size.field)J.size.field=H.field;else if(H.field!==J.size.field)return t(I,"Could not convert size info: multiple fields in use"),null;switch(H.axis){case "width":return(F=m(H,J.size,0,O,I))?J:null;case "height":return(F=m(H,J.size,2,O,I))?J:null;case "depth":return(F=m(H,J.size,1,O,I))?J:null;case "width-and-depth":return(F=m(H,J.size,0,O,I))&&m(H,J.size,1,O,I),F?J:null;case null:case void 0:case "all":return(F=
(F=(F=m(H,J.size,0,O,I))&&m(H,J.size,1,O,I))&&m(H,J.size,2,O,I))?J:null;default:return t(I,`Could not convert size info: unknown axis "${H.axis}""`),null}}function k(H,J,O){for(let I=0;3>I;++I){let F=J.unitInMeters;1===H.type[I]&&(F*=J.modelSize[I],H.type[I]=2);H.minSize[I]/=F;H.maxSize[I]/=F;H.offset[I]/=F;H.factor[I]/=F}if(0!==H.type[0])J=0;else if(0!==H.type[1])J=1;else if(0!==H.type[2])J=2;else return t(O,"No size axis contains a valid size or scale"),!1;for(O=0;3>O;++O)0===H.type[O]&&(H.minSize[O]=
H.minSize[J],H.maxSize[O]=H.maxSize[J],H.offset[O]=H.offset[J],H.factor[O]=H.factor[J],H.type[O]=H.type[J]);return!0}function v(H,J,O){H[4*J]=O.r/255;H[4*J+1]=O.g/255;H[4*J+2]=O.b/255;H[4*J+3]=O.a}function x(H,J,O){if(H.normalizationField)return t(O,"Could not convert color info: unsupported property"),null;if(u(H.field))if(H.stops){if(8<H.stops.length)return t(O,"Could not convert color info: too many color stops"),null;J.color={field:H.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};H=H.stops;for(O=0;8>O;++O){const I=H[Math.min(O,H.length-1)];J.color.values[O]=I.value;v(J.color.colors,O,I.color)}}else return t(O,"Could not convert color info: missing stops or colors"),null;else if(H.stops&&0<=H.stops.length)for(H=H.stops&&0<=H.stops.length&&H.stops[0].color,J.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},O=0;8>O;O++)J.color.values[O]=Infinity,v(J.color.colors,
O,H);else return t(O,"Could not convert color info: no field and no colors/stops"),null;return J}function C(H,J,O){if(H.normalizationField)return t(O,"Could not convert opacity info: unsupported property"),null;if(u(H.field))if(H.stops){if(8<H.stops.length)return t(O,"Could not convert opacity info: too many opacity stops"),null;J.opacity={field:H.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};H=H.stops;for(O=0;8>O;++O){const I=H[Math.min(O,H.length-1)];J.opacity.values[O]=I.value;
J.opacity.opacityValues[O]=I.opacity}}else return t(O,"Could not convert opacity info: missing stops or opacities"),null;else if(H.stops&&0<=H.stops.length)for(H=H.stops&&0<=H.stops.length&&H.stops[0].opacity,J.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},O=0;8>O;O++)J.opacity.values[O]=Infinity,J.opacity.opacityValues[O]=H;else return t(O,"Could not convert opacity info: no field and no opacities/stops"),null;return J}function A(H,J,O){H=2===O&&"arithmetic"===H.rotationType;
J.offset[O]=H?90:0;J.factor[O]=H?-1:1;J.type[O]=1}function B(H,J,O){if(!u(H.field))return t(O,"Could not convert rotation info: field is not a string"),null;if(!J.rotation)J.rotation={field:H.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(H.field)if(!J.rotation.field)J.rotation.field=H.field;else if(H.field!==J.rotation.field)return t(O,"Could not convert rotation info: multiple fields in use"),null;switch(H.axis){case "tilt":return A(H,J.rotation,0),J;case "roll":return A(H,J.rotation,
1),J;case null:case void 0:case "heading":return A(H,J.rotation,2),J;default:return t(O,`Could not convert rotation info: unknown axis "${H.axis}""`),null}}function D(H,J,O){if(!H)return null;const I=!J.supportedTypes||!!J.supportedTypes.size,F=!J.supportedTypes||!!J.supportedTypes.color,L=!J.supportedTypes||!!J.supportedTypes.rotation,N=!!J.supportedTypes&&!!J.supportedTypes.opacity,R=H.reduce((S,P)=>{if(!S)return S;if(P.valueExpression)return t(O,"Could not convert visual variables: arcade expressions not supported"),
null;switch(P.type){case "size":return I?z(P,S,J,O):S;case "color":return F?x(P,S,O):S;case "opacity":return N?C(P,S,O):null;case "rotation":return L?B(P,S,O):S;default:return null}},{size:null,color:null,opacity:null,rotation:null});return 0<H.length&&R&&!R.size&&!R.color&&!R.opacity&&!R.rotation||R&&R.size&&!k(R.size,J,O)?null:R}function E(H,J,O){if(!!H!==!!J||H&&H.field!==J.field)return!1;if(H&&"rotation"===O)for(O=0;3>O;O++)if(H.type[O]!==J.type[O]||H.offset[O]!==J.offset[O]||H.factor[O]!==J.factor[O])return!1;
return!0}function G(H,J){const O={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},I=H&&null!=H.size;H&&H.size?(O.vvSizeEnabled=!0,O.vvSizeMinSize=H.size.minSize,O.vvSizeMaxSize=H.size.maxSize,O.vvSizeOffset=H.size.offset,O.vvSizeFactor=H.size.factor):H&&I&&(O.vvSizeValue=
J.transformation.scale);H&&I&&(O.vvSymbolAnchor=J.transformation.anchor,O.vvSymbolRotationMatrix=q.create(),y.identity(M),h(J.transformation.rotation[2],J.transformation.rotation[0],J.transformation.rotation[1],M),r.fromMat4(O.vvSymbolRotationMatrix,M));H&&H.color&&(O.vvColorEnabled=!0,O.vvColorValues=H.color.values,O.vvColorColors=H.color.colors);H&&H.opacity&&(O.vvOpacityEnabled=!0,O.vvOpacityValues=H.opacity.values,O.vvOpacityOpacities=H.opacity.opacityValues);return O}var K;(function(H){const J=
f.create(),O=e.create();H.evaluateModelTransform=function(I,F,L){if(!I.vvSizeEnabled)return L;y.copy(J,L);L=I.vvSymbolRotationMatrix;y.set(M,L[0],L[1],L[2],0,L[3],L[4],L[5],0,L[6],L[7],L[8],0,0,0,0,1);y.multiply(J,J,M);for(L=0;3>L;++L)O[L]=b.clamp(I.vvSizeOffset[L]+F[0]*I.vvSizeFactor[L],I.vvSizeMinSize[L],I.vvSizeMaxSize[L]);y.scale(J,J,O);y.translate(J,J,I.vvSymbolAnchor);return J};H.evaluateModelTransformScale=function(I,F,L){if(!F.vvSizeEnabled)return w.set(I,1,1,1);for(let N=0;3>N;++N)I[N]=b.clamp(F.vvSizeOffset[N]+
L[0]*F.vvSizeFactor[N],F.vvSizeMinSize[N],F.vvSizeMaxSize[N]);return I}})(K||(K={}));const M=f.create();p=K.evaluateModelTransform;K=K.evaluateModelTransformScale;a.convertVisualVariables=D;a.evaluateModelTransform=p;a.evaluateModelTransformScale=K;a.getMaterialParams=G;a.initFastSymbolUpdatesState=function(H,J){return!H||g.DISABLE_FAST_UPDATES?{enabled:!1}:(H=D(H.visualVariables,J))?{enabled:!0,visualVariables:H,materialParameters:G(H,J),requiresShaderTransformation:H&&null!=H.size}:{enabled:!1}};
a.updateFastSymbolUpdatesState=function(H,J,O){if(!J||!H.enabled)return!1;const I=H.visualVariables;J=D(J.visualVariables,O);if(!(J&&E(I.size,J.size,"size")&&E(I.color,J.color,"color")&&E(I.rotation,J.rotation,"rotation")&&E(I.opacity,J.opacity,"opacity")))return!1;H.visualVariables=J;H.materialParameters=G(J,O);H.requiresShaderTransformation=J&&null!=J.size;return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../support/mathUtils ./geometryDataUtils ./Object3DStateID ../materials/renderers/utils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){let c=function(){function t(m,n,z=null,k=null,v=r.generateUID(),x=null,C=null,A=!1){this.data=m;this.material=n;this.layerUid=z;this.graphicUid=k;this.id=v;this.boundingInfo=x;this.calculateShaderTransformation=C;this.castShadow=A;this.boundingSphere=w.create();this.instanceParameters={highlights:null,occludees:null,visible:!0};this._transformation=y.create();this._shaderTransformationDirty=!0}var h=t.prototype;h.updateTransformation=function(m){m(this._transformation);
this._shaderTransformationDirty=!0;this.computeBoundingSphere(this._transformation,this.boundingSphere)};h.shaderTransformationChanged=function(){this._shaderTransformationDirty=!0};h.computeBoundingSphere=function(m,n,z=e.maxScale(m)){b.isNone(this.boundingInfo)||(f.transformMat4(n,this.boundingInfo.getCenter(),m),n[3]=this.boundingInfo.getBSRadius()*z)};h.getShaderTransformation=function(){if(b.isNone(this.calculateShaderTransformation))return b.unwrapOr(this.transformation,y.IDENTITY);this._shaderTransformationDirty&&
(this._shaderTransformation||(this._shaderTransformation=y.create()),q.copy(this._shaderTransformation,this.calculateShaderTransformation(b.unwrapOr(this.transformation,y.IDENTITY))),this._shaderTransformationDirty=!1);return this._shaderTransformation};h.computeAttachmentOrigin=function(m){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,m)?(b.isSome(this._transformation)&&f.transformMat4(m,m,this._transformation),!0):!1;const n=this.indices.get("position"),
z=this.vertexAttributes.get("position");return l.computeAttachmentOriginTriangles(z,n,m)?(b.isSome(this._transformation)&&f.transformMat4(m,m,this._transformation),!0):!1};h.addHighlight=function(){const m=new g.Object3DStateID(0),n=this.instanceParameters;n.highlights=d.addObject3DStateID(n.highlights,m);return m};h.removeHighlight=function(m){const n=this.instanceParameters;n.highlights=d.removeObject3DStateID(n.highlights,m)};p._createClass(t,[{key:"transformation",get:function(){return this._transformation}},
{key:"hasShaderTransformation",get:function(){return b.isSome(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}}]);return t}(),u=function(t){function h(){return t.apply(this,arguments)||this}p._inheritsLoose(h,t);return h}(c);a.RenderGeometry=c;a.ValidatedRenderGeometry=u;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./BasisUtil ./ContentObject ./DDSUtil ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v){u=function(x){function C(B,D){var E=x.call(this)||this;E.data=B;E.type=4;E.glTexture=null;E.powerOfTwoStretchInfo=null;E.loadingPromise=null;E.loadingController=null;E.events=new q;E.params=D||{};E.params.mipmap=!1!==E.params.mipmap;E.params.noUnpackFlip=E.params.noUnpackFlip||!1;E.params.preMultiplyAlpha=E.params.preMultiplyAlpha||!1;E.params.wrap=E.params.wrap||{s:10497,t:10497};E.params.powerOfTwoResizeMode=E.params.powerOfTwoResizeMode||1;E.estimatedTexMemRequired=
C.estimateTexMemRequired(E.data,E.params);E.startPreload();return E}p._inheritsLoose(C,x);var A=C.prototype;A.startPreload=function(){const B=this.data;f.isNone(B)||(B instanceof HTMLVideoElement?this.startPreloadVideoElement(B):B instanceof HTMLImageElement&&this.startPreloadImageElement(B))};A.startPreloadVideoElement=function(B){l.isBlobProtocol(B.src)||"auto"===B.preload&&B.crossOrigin||(B.preload="auto",B.crossOrigin="anonymous",B.src=B.src)};A.startPreloadImageElement=function(B){l.isDataProtocol(B.src)||
l.isBlobProtocol(B.src)||B.crossOrigin||(B.crossOrigin="anonymous",B.src=B.src)};C.getDataDimensions=function(B){return B instanceof HTMLVideoElement?{width:B.videoWidth,height:B.videoHeight}:B};C.estimateTexMemRequired=function(B,D){if(f.isNone(B))return 0;if(e.isArrayBuffer(B)||e.isUint8Array(B))return D.encoding===C.KTX2_ENCODING?c.estimateMemoryKTX2(B,D.mipmap):D.encoding===C.BASIS_ENCODING?c.estimateMemoryBasis(B,D.mipmap):B.byteLength;const {width:E,height:G}=B instanceof Image||B instanceof
ImageData||B instanceof HTMLCanvasElement||B instanceof HTMLVideoElement?C.getDataDimensions(B):D;return(D.mipmap?4/3:1)*E*G*(D.components||4)||0};A.dispose=function(){this.data=void 0};A.createDescriptor=function(B){var D;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(D=this.params.maxAnisotropy)?D:
this.params.mipmap?B.parameters.maxMaxAnisotropy:1}};A.load=function(B,D){if(f.isSome(this.glTexture))return this.glTexture;if(f.isSome(this.loadingPromise))return this.loadingPromise;const E=this.data;return f.isNone(E)?this.glTexture=new z(B,this.createDescriptor(B),null):"string"===typeof E?this.loadFromURL(B,D,E):E instanceof Image?this.loadFromImageElement(B,D,E):E instanceof HTMLVideoElement?this.loadFromVideoElement(B,D,E):E instanceof ImageData||E instanceof HTMLCanvasElement?this.loadFromImage(B,
E,D):(e.isArrayBuffer(E)||e.isUint8Array(E))&&this.params.encoding===C.DDS_ENCODING?this.loadFromDDSData(B,E):(e.isArrayBuffer(E)||e.isUint8Array(E))&&this.params.encoding===C.KTX2_ENCODING?this.loadFromKTX2(B,E):(e.isArrayBuffer(E)||e.isUint8Array(E))&&this.params.encoding===C.BASIS_ENCODING?this.loadFromBasis(B,E):e.isUint8Array(E)?this.loadFromPixelData(B,E):e.isArrayBuffer(E)?this.loadFromPixelData(B,new Uint8Array(E)):null};A.frameUpdate=function(B,D,E){if(!(this.data instanceof HTMLVideoElement)||
f.isNone(this.glTexture)||2>this.data.readyState||E===this.data.currentTime)return E;if(f.isSome(this.powerOfTwoStretchInfo)){const {framebuffer:G,vao:K,sourceTexture:M}=this.powerOfTwoStretchInfo;M.setData(this.data);this.drawStretchedTexture(B,D,G,K,M,this.glTexture)}else{const {width:G,height:K}=this.data,{width:M,height:H}=this.glTexture.descriptor;G!==M||K!==H?this.glTexture.updateData(0,0,0,Math.min(G,M),Math.min(K,H),this.data):this.glTexture.setData(this.data)}this.glTexture.descriptor.hasMipmap&&
this.glTexture.generateMipmap();return this.data.currentTime};A.loadFromDDSData=function(B,D){return this.glTexture=t.createDDSTexture(B,this.createDescriptor(B),D)};A.loadFromKTX2=function(B,D){return this.loadAsync(()=>c.createTextureKTX2(B,this.createDescriptor(B),D).then(E=>this.glTexture=E))};A.loadFromBasis=function(B,D){return this.loadAsync(()=>c.createTextureBasis(B,this.createDescriptor(B),D).then(E=>this.glTexture=E))};A.loadFromPixelData=function(B,D){m.assert(0<this.params.width&&0<this.params.height);
const E=this.createDescriptor(B);E.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408;E.width=this.params.width;E.height=this.params.height;return this.glTexture=new z(B,E,D)};A.loadAsync=function(B){const D=w.createAbortController();this.loadingController=D;const E=B(D.signal);this.loadingPromise=E;B=()=>{this.loadingController===D&&(this.loadingController=null);this.loadingPromise===E&&(this.loadingPromise=null)};E.then(B,B);return E};A.loadFromURL=function(B,D,E){var G=
this;return this.loadAsync(function(){var K=p._asyncToGenerator(function*(M){M=yield g.requestImage(E,{signal:M});return G.loadFromImage(B,M,D)});return function(M){return K.apply(this,arguments)}}())};A.loadFromImageElement=function(B,D,E){var G=this;return E.complete?this.loadFromImage(B,E,D):this.loadAsync(function(){var K=p._asyncToGenerator(function*(M){M=yield d.loadImageAsync(E,E.src,!1,M);return G.loadFromImage(B,M,D)});return function(M){return K.apply(this,arguments)}}())};A.loadFromVideoElement=
function(B,D,E){return 2<=E.readyState?this.loadFromImage(B,E,D):this.loadFromVideoElementAsync(B,D,E)};A.loadFromVideoElementAsync=function(B,D,E){return this.loadAsync(G=>new Promise((K,M)=>{const H=()=>{E.removeEventListener("loadeddata",J);E.removeEventListener("error",O);f.isSome(I)&&I.remove()},J=()=>{2<=E.readyState&&(H(),K(this.loadFromImage(B,E,D)))},O=F=>{H();M(F||new r("Failed to load video"))};E.addEventListener("loadeddata",J);E.addEventListener("error",O);const I=w.onAbort(G,()=>O(w.createAbortError()))}))};
A.loadFromImage=function(B,D,E){const G=C.getDataDimensions(D);this.params.width=G.width;this.params.height=G.height;const K=this.createDescriptor(B);K.pixelFormat=3===this.params.components?6407:6408;if(this.requiresPowerOfTwo(B,K)&&(!y.isPowerOfTwo(G.width)||!y.isPowerOfTwo(G.height)))return this.glTexture=this.makePowerOfTwoTexture(B,D,G,K,E);K.width=G.width;K.height=G.height;return this.glTexture=new z(B,K,D)};A.requiresPowerOfTwo=function(B,D){const E="number"===typeof D.wrapMode?33071===D.wrapMode:
33071===D.wrapMode.s&&33071===D.wrapMode.t;return!v(B.gl)&&(D.hasMipmap||!E)};A.makePowerOfTwoTexture=function(B,D,E,G,K){const {width:M,height:H}=E;E=y.nextHighestPowerOfTwo(M);const J=y.nextHighestPowerOfTwo(H);G.width=E;G.height=J;let O;switch(this.params.powerOfTwoResizeMode){case 2:G.textureCoordinateScaleFactor=[M/E,H/J];O=new z(B,G);O.updateData(0,0,0,M,H,D);break;case 1:case null:case void 0:O=this.stretchToPowerOfTwo(B,D,G,K);break;default:b.neverReached(this.params.powerOfTwoResizeMode)}G.hasMipmap&&
O.generateMipmap();return O};A.stretchToPowerOfTwo=function(B,D,E,G){const K=new z(B,E),M=new n(B,{colorTarget:0,depthStencilTarget:0},K);D=new z(B,{target:3553,pixelFormat:E.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!E.flipped,maxAnisotropy:8,preMultiplyAlpha:E.preMultiplyAlpha},D);E=h.createQuadVAO(B);this.drawStretchedTexture(B,G,M,E,D,K);this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:E,sourceTexture:D,framebuffer:M}:(E.dispose(!0),D.dispose(),M.detachColorTexture(),
B.bindFramebuffer(null),M.dispose());return K};A.drawStretchedTexture=function(B,D,E,G,K,M){B.bindFramebuffer(E);E=B.getViewport();B.setViewport(0,0,M.descriptor.width,M.descriptor.height);M=D.program;B.useProgram(M);M.setUniform4f("color",1,1,1,1);M.bindTexture(K,"tex");B.bindVAO(G);B.setPipelineState(D.pipeline);B.drawArrays(5,0,k.vertexCount(G,"geometry"));B.bindFramebuffer(null);B.setViewport(E.x,E.y,E.width,E.height)};A.unload=function(){if(f.isSome(this.powerOfTwoStretchInfo)){const {framebuffer:B,
vao:D,sourceTexture:E}=this.powerOfTwoStretchInfo;D.dispose(!0);E.dispose();B.dispose();this.powerOfTwoStretchInfo=this.glTexture=null}f.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);if(f.isSome(this.loadingController)){const B=this.loadingController;this.loadingPromise=this.loadingController=null;B.abort()}this.events.emit("unloaded")};p._createClass(C,[{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"requiresFrameUpdates",
get:function(){return this.data instanceof HTMLVideoElement}}]);return C}(u.ContentObject);u.DDS_ENCODING="image/vnd-ms.dds";u.KTX2_ENCODING="image/ktx2";u.BASIS_ENCODING="image/x.basis";a.Texture=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,p,b,r,q,y){function f(){return w.apply(this,
arguments)}function w(){w=p._asyncToGenerator(function*(){b.isNone(h)&&(h=r.getBasisTranscoder(),t=yield h);return h});return w.apply(this,arguments)}function e(m,n,z,k,v){n=y.getBytesPerElementFormat(n?37496:37492);return Math.ceil(z*k*n*(v&&1<m?(4**m-1)/(3*4**(m-1)):1))}function l(m){return 1<=m.getNumImages()&&!m.isUASTC()}function g(m){return 1<=m.getFaces()&&m.isETC1S()}function d(){d=p._asyncToGenerator(function*(m,n,z){b.isNone(t)&&(t=yield f());const k=new t.BasisFile(new Uint8Array(z));if(!l(k))return null;
k.startTranscoding();m=u(m,n,k.getNumLevels(0),k.getHasAlpha(),k.getImageWidth(0,0),k.getImageHeight(0,0),(v,x)=>k.getImageTranscodedSizeInBytes(0,v,x),(v,x,C)=>k.transcodeImage(C,0,v,x,0,0));k.close();k.delete();return m});return d.apply(this,arguments)}function c(){c=p._asyncToGenerator(function*(m,n,z){b.isNone(t)&&(t=yield f());const k=new t.KTX2File(new Uint8Array(z));if(!g(k))return null;k.startTranscoding();m=u(m,n,k.getLevels(),k.getHasAlpha(),k.getWidth(),k.getHeight(),(v,x)=>k.getImageTranscodedSizeInBytes(v,
0,0,x),(v,x,C)=>k.transcodeImage(C,v,0,0,x,0,-1,-1));k.close();k.delete();return m});return c.apply(this,arguments)}function u(m,n,z,k,v,x,C,A){const {compressedTextureETC:B,compressedTextureS3TC:D}=m.capabilities,[E,G]=B?k?[1,37496]:[0,37492]:D?k?[3,33779]:[2,33776]:[13,6408];k=n.hasMipmap?z:Math.min(1,z);z=[];for(let K=0;K<k;K++)z.push(new Uint8Array(C(K,E))),A(K,E,z[K]);C=1<z.length;return new q(m,{...n,samplingMode:C?9987:9729,hasMipmap:C,internalFormat:G,width:v,height:x},{type:"compressed",
levels:z})}let t=null,h=null;a.createTextureBasis=function(m,n,z){return d.apply(this,arguments)};a.createTextureKTX2=function(m,n,z){return c.apply(this,arguments)};a.estimateMemoryBasis=function(m,n){if(b.isNone(t))return m.byteLength;m=new t.BasisFile(new Uint8Array(m));n=l(m)?e(m.getNumLevels(0),m.getHasAlpha(),m.getImageWidth(0,0),m.getImageHeight(0,0),n):0;m.close();m.delete();return n};a.estimateMemoryKTX2=function(m,n){if(b.isNone(t))return m.byteLength;m=new t.KTX2File(new Uint8Array(m));
n=g(m)?e(m.getLevels(),m.getHasAlpha(),m.getWidth(),m.getHeight(),n):0;m.close();m.delete();return n};a.loadBasis=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets","../../core/maybe"],function(a,p,b,r){let q;p.getBasisTranscoder=function(){if(r.isNone(q)){const y=f=>b.getAssetUrl(`esri/libs/basisu/${f}`);q=(new Promise(function(f,w){a(["../../chunks/basis_transcoder"],f,w)})).then(function(f){return f.basis_transcoder}).then(({default:f})=>
f({locateFile:y}).then(w=>{w.initializeBasis();delete w.then;return w}))}return q};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports","../../../../core/Logger","../../../../core/mathUtils","../../../webgl/Texture"],function(a,p,b,r){function q(g){return g.charCodeAt(0)+(g.charCodeAt(1)<<8)+(g.charCodeAt(2)<<16)+(g.charCodeAt(3)<<24)}function y(g,d){var c=new Int32Array(g,0,31);if(542327876!==c[0])return f.error("Invalid magic number in DDS header"),
null;if(!(c[20]&4))return f.error("Unsupported format, must contain a FourCC code"),null;var u=c[21];let t;switch(u){case w:u=8;t=33776;break;case e:u=16;t=33778;break;case l:u=16;t=33779;break;default:return f.error("Unsupported FourCC code:",String.fromCharCode(u&255,u>>8&255,u>>16&255,u>>24&255)),null}let h=1,m=c[4],n=c[3];if(0!==(m&3)||0!==(n&3))f.warn("Rounding up compressed texture size to nearest multiple of 4."),m=m+3&-4,n=n+3&-4;const z=m,k=n;c[2]&131072&&!1!==d&&(h=Math.max(1,c[7]));1===
h||b.isPowerOfTwo(m)&&b.isPowerOfTwo(n)||(f.warn("Ignoring mipmaps of non power of two sized compressed texture."),h=1);let v=c[1]+4;const x=[];for(let C=0;C<h;++C)c=(m+3>>2)*(n+3>>2)*u,d=new Uint8Array(g,v,c),x.push(d),v+=c,m=Math.max(1,m>>1),n=Math.max(1,n>>1);return{textureData:{type:"compressed",levels:x},internalFormat:t,width:z,height:k}}const f=p.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),w=q("DXT1"),e=q("DXT3"),l=q("DXT5");a.createDDSTexture=function(g,d,c){const {textureData:u,internalFormat:t,
width:h,height:m}=y(c,d.hasMipmap);d.samplingMode=1<u.levels.length?9987:9729;d.hasMipmap=1<u.levels.length;d.internalFormat=t;d.width=h;d.height=m;return new r(g,d,u)};a.createDDSTextureData=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./lineUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D){const E=["polyline","polygon","extent"];r=function(G){function K(H,J,O,I){H=G.call(this,H,J,O,I)||this;H._uniformSize=1;return H}p._inheritsLoose(K,G);var M=K.prototype;M.doLoad=function(){var H=p._asyncToGenerator(function*(){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=
this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?k.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){const J=null!=this.symbolLayer.size?this.symbolLayer.size:f.px2pt(1);if(0>J)throw new q("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=J}});return function(){return H.apply(this,arguments)}}();M.getMaterialParameters=
function(H){var J=y.get(this.symbolLayer,"material","color");J=this._getCombinedOpacityAndColor(J);this._patternHidesLine&&(J[3]=0);H={width:1,color:J,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:1>J[3]||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:H,stipplePattern:y.applySome(y.unwrapOr(this.symbolLayer.stipplePattern,()=>C.scaleStipplePattern(C.getStipplePatternForLinePattern(this.symbolLayer.pattern),
this.symbolLayer.size)),O=>C.createStipplePattern(O.map(f.pt2px))),stippleOffColor:this.symbolLayer.stippleOffColor?b.toUnitRGBA(this.symbolLayer.stippleOffColor):null,stippleIntegerRepeats:!0};this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(H.width=f.pt2px(1)):(J=null!=this.symbolLayer.size?this.symbolLayer.size:f.px2pt(1),H.width=f.pt2px(J));return this._fastUpdates&&this._fastUpdates.visualVariables?{...H,...this._fastUpdates.materialParameters}:
H};M.destroy=function(){G.prototype.destroy.call(this);this._context.stage.remove(this._lineMaterial);this._lineMaterial=null;this._context.stage.remove(this._ringMaterial);this._ringMaterial=null};M.getDrivenSize=function(H){return this._drivenProperties.size&&H.size?f.pt2px(d.getDriverAxisSizeValueAny(H.size)):1};M.getSizeFeatureAttributeData=function(H){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?n.getAttributeValue(this._fastUpdates.visualVariables.size.field,H):null};
M.getDrivenColor=function(H){const J=l.fromValues(1,1,1,1);this._drivenProperties.color&&H.color&&(J[0]=H.color[0],J[1]=H.color[1],J[2]=H.color[2],0<H.color.length&&(J[3]=H.color[3]));this._drivenProperties.opacity&&H.opacity&&(J[3]=H.opacity);return J};M.getColorFeatureAttributeData=function(H){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?n.getAttributeValue(this._fastUpdates.visualVariables.color.field,H):null};M.getOpacityFeatureAttributeData=function(H){return this._fastUpdates.enabled&&
this._fastUpdates.visualVariables.opacity?n.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,H):null};M.createGraphics3DGraphic=function(H){const J=H.graphic;if(!this._validateGeometry(J.geometry,E,this.symbolLayer.type))return null;const O=this.setGraphicElevationContext(J,new t.ElevationContext);this.ensureDrapedStatus("on-the-ground"===O.mode);return this.draped?this._createAsOverlay(H,this._context.layer.uid):this._createAs3DShape(H,O,J.uid)};M.applyRendererDiff=function(H,J){for(const O in H.diff)switch(O){case "visualVariables":if(k.updateFastSymbolUpdatesState(this._fastUpdates,
J,this._vvConvertOptions))y.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),y.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};M.layerOpacityChanged=function(){y.isSome(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial);y.isSome(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial);return!0};M.updateMaterialLayerOpacity=
function(H){const J=H.params.color;var O=y.get(this.symbolLayer,"material","color");O=this._patternHidesLine?0:this._getCombinedOpacity(O);H.setParameterValues({color:[J[0],J[1],J[2],O],transparent:1>O||this.needsDrivenTransparentPass})};M.layerElevationInfoChanged=function(H,J,O){const I=this._elevationContext.mode;O=u.elevationModeChangeUpdateType(K.elevationModeChangeTypes,O,I);if(O!==u.SymbolUpdateType.UPDATE)return O;const F=u.needsElevationUpdates2D(I);return this.updateGraphics3DGraphicElevationInfo(H,
J,()=>F)};M.slicePlaneEnabledChanged=function(){y.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});y.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};M.physicalBasedRenderingChanged=function(){return!0};M.pixelRatioChanged=function(){return!0};M._getGeometryAsPolygonOrPolyline=function(H){switch(H.type){case "extent":if(H instanceof B)return D.fromExtent(H);
break;case "polygon":case "polyline":return H}return null};M._createAs3DShape=function(H,J,O){const I=this._getGeometryAsPolygonOrPolyline(H.graphic.geometry);var F="polygon"===I.type?I.rings:I.paths,L=[];const N=[],R=[],S=g.create(),P=z.geometryToRenderInfo(I,this._context.elevationProvider,this._context.renderCoordsHelper,J);this._logGeometryCreationWarnings(P,F,"polygon"===I.type?"rings":"paths","LineSymbol3DLayer");for(F=0;F<P.lines.length;F++){const {position:Q,mapPosition:V}=P.lines[F];if(y.isSome(this._context.clippingExtent)&&
(g.empty(S),g.expandWithBuffer(S,V),!g.intersectsClippingArea(S,this._context.clippingExtent)))continue;const ca=this._createGeometry(H,Q,V,I.type);L.push(ca);N.push("polygon"===I.type?this.ringMaterial:this.lineMaterial);R.push(w.IDENTITY)}if(0===L.length)return null;H=new v.Object3D({geometries:L,materials:N,transformations:R,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:O}});L=new m.Graphics3DObject3DGraphicLayer(this,H,L,null,null,c.perVertexElevationAligner,J);L.alignedSampledElevation=
P.sampledElevation;L.needsElevationUpdates=u.needsElevationUpdates2D(J.mode);return L};M._createGeometry=function(H,J,O,I){const F=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;return z.createGeometry({removeDuplicateStartEnd:"polygon"===I?1:0,uniformSize:this._uniformSize,attributeData:{position:J,mapPosition:O,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this.getDrivenSize(H.renderingInfo),color:F?null:this.getDrivenColor(H.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(H.graphic),
colorFeature:this.getColorFeatureAttributeData(H.graphic),opacityFeature:this.getOpacityFeatureAttributeData(H.graphic)}})};M._createAsOverlay=function(H,J){const O=H.graphic,I=this._getGeometryAsPolygonOrPolyline(O.geometry);var F="polygon"===I.type?I.rings:I.paths;const L="polygon"===I.type?this.ringMaterial:this.lineMaterial;L.renderPriority=this._renderPriority;const N=[],R=g.create(),S=g.empty(),P=z.geometryToRenderInfoDraped(I,this._context.overlaySR);this._logGeometryCreationWarnings(P,F,"polygon"===
I.type?"rings":"paths","LineSymbol3DLayer");for(const Q of P.lines)g.empty(R),g.expandWithBuffer(R,Q.position),g.intersectsClippingArea(R,this._context.clippingExtent)&&(g.expandWithAABB(S,R),F=this._createGeometry(H,Q.position,null,I.type),F=new x.RenderGeometry(F,L,J,O.uid),e.set(F.boundingSphere,.5*(R[0]+R[3]),.5*(R[1]+R[4]),0,.5*Math.sqrt((R[3]-R[0])*(R[3]-R[0])+(R[4]-R[1])*(R[4]-R[1]))),N.push(F));return new h(this,N,S)};p._createClass(K,[{key:"lineMaterial",get:function(){y.isNone(this._lineMaterial)&&
(this._lineMaterial=new A.RibbonLineMaterial(this.getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial));return this._lineMaterial}},{key:"ringMaterial",get:function(){y.isNone(this._ringMaterial)&&(this._ringMaterial=new A.RibbonLineMaterial(this.getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial));return this._ringMaterial}},{key:"_patternHidesLine",get:function(){return"none"===this.symbolLayer.pattern}}]);return K}(n.Graphics3DSymbolLayer);r.elevationModeChangeTypes=
{definedChanged:u.SymbolUpdateType.RECREATE,staysOnTheGround:u.SymbolUpdateType.NONE,onTheGroundChanged:u.SymbolUpdateType.RECREATE};a.Graphics3DLineSymbolLayer=r;a["default"]=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/lineUtils":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ./constants ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){function c(m,n,z){const k=[];for(const {index:v,count:x}of m){if(1>=x)continue;m=3*v;const C=m+3*x;k.push({position:n.subarray(m,C),mapPosition:z?z.subarray(m,C):void 0})}return k}const u=y.create(),t=y.create(),h=4/Math.PI;a.createGeometry=function(m){const n=[],z=[];{const {attributeData:{position:D},removeDuplicateStartEnd:E}=m;var k=D.length;k=(k=D[0]===D[k-3]&&D[1]===D[k-2]&&D[2]===D[k-1])&&1===E;var v=D.length/3-(k?1:0),x=new Uint32Array(2*(v-1)),C=k?r.slice(D,
0,D.length-3):D,A=0;for(var B=0;B<v-1;B++)x[A++]=B,x[A++]=B+1;z.push(["position",{size:3,data:C,exclusive:k}]);n.push(["position",x])}k=z[0][1].data;v=new Uint16Array(n[0][1].length);x=m.attributeData.mapPosition;b.isNone(x)||(n.push(["mapPos",n[0][1]]),z.push(["mapPos",{size:3,data:x}]));b.isSome(m.attributeData.colorFeature)||(z.push(["color",{size:4,data:b.unwrapOr(m.attributeData.color,e.WHITE_UNIT)}]),n.push(["color",v]));b.isSome(m.attributeData.sizeFeature)||(z.push(["size",{size:1,data:[b.unwrapOr(m.attributeData.size,
1)]}]),n.push(["size",v]));x=m.attributeData.colorFeature;b.isNone(x)||(z.push(["colorFeatureAttribute",{size:1,data:new Float32Array([x])}]),n.push(["color",v]));x=m.attributeData.sizeFeature;b.isNone(x)||(z.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([x])}]),n.push(["sizeFeatureAttribute",v]));x=m.attributeData.opacityFeature;b.isNone(x)||(z.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([x])}]),n.push(["opacityFeatureAttribute",v]));if("round"===m.join){v=k.length/
3;x=new Float32Array(v);q.set(u,0,0,0);m=b.unwrapOr(m.uniformSize,1);for(C=-1;C<v;++C)A=0>C?v+C:C,B=(C+1)%v,q.set(t,k[3*B]-k[3*A],k[3*B+1]-k[3*A+1],k[3*B+2]-k[3*A+2]),q.normalize(t,t),0<=C&&(A=(Math.PI-p.acosClamped(q.dot(u,t)))*h*(1.863798+-2.0062872/(1+m/18.2313)**.8856294),x[C]=Math.max(Math.floor(A),0)),q.scale(u,t,-1);z.push(["subdivisions",{size:1,data:x}]);n.push(["subdivisions",n[0][1]])}return new d.Geometry(z,n,2)};a.geometryToRenderInfo=function(m,n,z,k){const {position:v,outlines:x}=w.pathsToTriangulationInfo("polygon"===
m.type?m.rings:m.paths,m.hasZ,"polygon"===m.type?1:0),C=new Float64Array(v.length);m=l.applyPerVertexElevationAlignment(v,m.spatialReference,0,C,0,v,0,v.length/3,n,z,k);n=null!=m;return{lines:n?c(x,v,C):[],projectionSuccess:n,sampledElevation:m}};a.geometryToRenderInfoDraped=function(m,n){const {position:z,outlines:k}=w.pathsToTriangulationInfo("polygon"===m.type?m.rings:m.paths,!1,"polygon"===m.type?1:0);m=f.projectBuffer(z,m.spatialReference,0,z,n,0,z.length/3);for(n=2;n<z.length;n+=3)z[n]=g.DRAPED_Z;
return{lines:m?c(k,z):[],projectionSuccess:m}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports","../../../../core/maybe"],function(a,p){function b(y){return p.isNone(y)?y:y.slice()}const r={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},q={dash:r.dash,"dash-dot":[...r.dash,...r.dot],dot:r.dot,"long-dash":r["long-dash"],"long-dash-dot":[...r["long-dash"],...r.dot],"long-dash-dot-dot":[...r["long-dash"],
...r.dot,...r.dot],none:null,"short-dash":r["short-dash"],"short-dash-dot":[...r["short-dash"],...r["short-dot"]],"short-dash-dot-dot":[...r["short-dash"],...r["short-dot"],...r["short-dot"]],"short-dot":r["short-dot"],solid:null};a.createStipplePattern=b;a.createStipplePatternSimple=function(y){return[y,y]};a.getStipplePatternForLinePattern=function(y){return p.applySome(y,f=>b(q[f]))};a.scaleStipplePattern=function(y,f){return p.applySome(y,w=>w.map(e=>e*f))};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/geometryDataUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I){const F=["mesh"];r=function(Z){function ha(aa,W,U,X){aa=Z.call(this,aa,W,U,X)||this;aa._materials=new Map;aa._textures=new Map;aa.ensureDrapedStatus(!1);return aa}p._inheritsLoose(ha,Z);var fa=ha.prototype;fa.doLoad=function(){var aa=p._asyncToGenerator(function*(){G.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new I.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new I.NativeLineMaterial({color:[0,
1,1,1]}))});return function(){return aa.apply(this,arguments)}}();fa.destroy=function(){Z.prototype.destroy.call(this);this._context.stage.removeMany(Array.from(this._materials.values(),aa=>aa.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};fa.createGraphics3DGraphic=function(aa){const W=aa.graphic;if(!this._validateGeometry(W.geometry,F,"fill on mesh-3d"))return null;const U=this.setGraphicElevationContext(W,new C.ElevationContext);
return this._createAs3DShape(W,aa.renderingInfo,U,W.uid)};fa.layerOpacityChanged=function(aa,W){const U=this._getLayerOpacity();this._materials.forEach(X=>{X.material.setParameterValues({layerOpacity:U});const T=X.material.params;this._setMaterialTransparentParameter(T,X);X.material.setParameterValues({transparent:T.transparent})});aa.forEach(X=>{X=W(X);q.isSome(X)&&X.layerOpacityChanged(U,this._context.isAsync)});return!0};fa.layerElevationInfoChanged=function(aa,W){return this.updateGraphics3DGraphicElevationInfo(aa,
W,x.needsElevationUpdates3D)};fa.slicePlaneEnabledChanged=function(aa,W){this._materials.forEach(U=>{U.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});aa.forEach(U=>{U=W(U);q.isSome(U)&&U.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};fa.physicalBasedRenderingChanged=function(){const aa=this._usePBR();this._materials.forEach(W=>W.material.setParameterValues({usePBR:aa}));return!0};fa.pixelRatioChanged=function(){return!0};
fa._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};fa._colorOrTextureUid=function(aa){return q.isNone(aa)?"-":aa instanceof b?aa.toHex():aa.contentHash};fa._materialPropertiesDefault=function(aa,W){const U=this._requiresSymbolVertexColors(),X=!!aa.vertexAttributes.color;aa=!!aa.vertexAttributes.tangent;return{hasSymbolVertexColors:U,hasVertexColors:X,hasVertexTangents:aa,uid:`vc:${X},vt:${aa},vct${W},svc:${U}`}};fa._materialProperties=function(aa,
W,U){aa=this._materialPropertiesDefault(aa,U);if(!W.material)return aa;const {color:X,colorTexture:T,normalTexture:Y,doubleSided:ea,alphaCutoff:ia,alphaMode:la}=W.material;U=this._colorOrTextureUid(X);var pa=this._colorOrTextureUid(T),ua=this._colorOrTextureUid(Y);aa.color=X;aa.colorTexture=T;aa.normalTexture=Y;aa.uid=`${aa.uid},cmuid:${U},ctmuid:${pa},ntmuid:${ua},ds:${ea},ac:${ia},am:${la}`;if(W.material instanceof h){const {metallic:wa,roughness:Fa,metallicRoughnessTexture:La,emissiveColor:Ma,
emissiveTexture:Sa,occlusionTexture:Ia}=W.material;W=this._colorOrTextureUid(La);U=this._colorOrTextureUid(Ma);pa=this._colorOrTextureUid(Sa);ua=this._colorOrTextureUid(Ia);aa.metallic=wa;aa.roughness=Fa;aa.metallicRoughnessTexture=La;aa.emissiveColor=Ma;aa.emissiveTexture=Sa;aa.occlusionTexture=Ia;aa.uid=`${aa.uid},mrm:${wa},mrr:${Fa},mrt:${W},emuid:${U},etmuid:${pa},otmuid:${ua}`}return aa};fa._setInternalColorValueParameters=function(aa,W){W.diffuse=b.toUnitRGB(aa);W.opacity=aa.a};fa._getLoadableTextureResource=
function(aa){return aa.data?aa.data:aa.url};fa._getInternalTextureId=function(aa){aa=this._getInternalTexture(aa,1);return q.isSome(aa)?aa.id:void 0};fa._getInternalTexture=function(aa,W){const U=this._getLoadableTextureResource(aa);if(U){var X=`${aa.contentHash}/${W}`,T=this._textures.get(X);T||(T=new J.Texture(U,{mipmap:!0,wrap:this._castTextureWrap(aa.wrap),noUnpackFlip:!0,preMultiplyAlpha:1!==W}),this._textures.set(X,T),this._context.stage.add(T));return T}};fa._castTextureWrap=function(aa="repeat"){return"string"===
typeof aa?(aa=this._castTextureWrapIndividual(aa),{s:aa,t:aa}):{s:this._castTextureWrapIndividual(aa.horizontal),t:this._castTextureWrapIndividual(aa.vertical)}};fa._castTextureWrapIndividual=function(aa){switch(aa){case "clamp":return 33071;case "mirror":return 33648;default:return 10497}};fa._setInternalMaterialParameters=function(aa,W){q.isSome(aa.color)&&this._setInternalColorValueParameters(aa.color,W);if(q.isSome(aa.colorTexture)){const U=this._getInternalTexture(aa.colorTexture,W.textureAlphaMode);
q.isSome(U)?(W.textureId=U.id,W.textureAlphaPremultiplied=!!U.params.preMultiplyAlpha):W.textureId=void 0}q.isSome(aa.normalTexture)&&(W.normalTextureId=this._getInternalTextureId(aa.normalTexture));q.isSome(aa.emissiveColor)&&(W.emissiveFactor=b.toUnitRGB(aa.emissiveColor));q.isSome(aa.emissiveTexture)&&(W.emissiveTextureId=this._getInternalTextureId(aa.emissiveTexture));q.isSome(aa.occlusionTexture)&&(W.occlusionTextureId=this._getInternalTextureId(aa.occlusionTexture));q.isSome(aa.metallicRoughnessTexture)&&
(W.metallicRoughnessTextureId=this._getInternalTextureId(aa.metallicRoughnessTexture))};fa._setExternalMaterialParameters=function(aa){var W=this._drivenProperties.color;let U=q.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;W?aa.externalColor=d.ONES:(W=q.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,q.isSome(W)?aa.externalColor=b.toUnitRGBA(W):(U=null,aa.externalColor=d.ONES));U&&(aa.colorMixMode=U);aa.castShadows=!!this.symbolLayer.castShadows};
fa._hasTransparentVertexColors=function(aa){aa=aa.vertexAttributes.color;if(q.isNone(aa))return!1;for(let W=3;W<aa.length;W+=4)if(255!==aa[W])return!0;return!1};fa._getOrCreateMaterial=function(aa,W){var U,X,T,Y=null==(U=W.material)?void 0:U.color;U=null==(X=W.material)?void 0:X.colorTexture;X=null==(T=W.material)?void 0:T.alphaMode;T="blend"===X;Y="opaque"!==X&&(this._hasTransparentVertexColors(aa)||q.isSome(Y)&&1>Y.a||q.isSome(U)&&U.transparent||T);aa=this._materialProperties(aa,W,Y);if(T=this._materials.get(aa.uid))return T.material;
Y={material:null,isComponentTransparent:Y,alphaMode:W.material?W.material.alphaMode:"opaque"};T=null==aa.metallicRoughnessTexture&&null==aa.metallic&&null==aa.roughness;U={usePBR:this._usePBR(),isSchematic:T,vertexColors:aa.hasVertexColors,symbolColors:aa.hasSymbolVertexColors,vertexTangents:aa.hasVertexTangents,ambient:g.ZEROS,diffuse:g.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};
T||(U.mrrFactors=[null!=aa.metallic?aa.metallic:1,null!=aa.roughness?aa.roughness:1,.5]);W.material&&(U.doubleSided=W.material.doubleSided,U.cullFace=W.material.doubleSided?0:2,U.textureAlphaCutoff=W.material.alphaCutoff);this._setExternalMaterialParameters(U);this._setMaterialTransparentParameter(U,Y);this._setInternalMaterialParameters(aa,U);W=new O.DefaultMaterial(U);Y.material=W;this._materials.set(aa.uid,Y);this._context.stage.add(W);return W};fa._usePBR=function(){return this._context.physicalBasedRenderingEnabled};
fa._setMaterialTransparentParameter=function(aa,W){aa.transparent=this.needsDrivenTransparentPass||W.isComponentTransparent||1>aa.layerOpacity||1>aa.opacity||aa.externalColor&&1>aa.externalColor[3];aa.textureAlphaMode="auto"===W.alphaMode?aa.transparent?3:1:"opaque"===W.alphaMode?1:"mask"===W.alphaMode?2:0};fa._addDebugNormals=function(aa,W,U,X){var T=W.length,Y=aa.spatialReference.isGeographic?20015077/180:1;const ea=.1*Math.max(aa.extent.width*Y,aa.extent.height*Y,aa.extent.zmax-aa.extent.zmin),
ia=[],la=[];aa=[];Y=[];for(let Ma=0;Ma<T;Ma++){var pa=W[Ma],ua=pa.vertexAttributes.get("position"),wa=pa.vertexAttributes.get("normal");const Sa=pa.indices.get("position");pa=pa.indices.get("normal");ua=ua.data;wa=wa.data;for(let Ia=0;Ia<Sa.length;Ia++){var Fa=3*Sa[Ia];const va=3*pa[Ia];for(var La=0;3>La;La++)ia.push(ua[Fa+La]);for(La=0;3>La;La++)ia.push(ua[Fa+La]+wa[va+La]*ea);la.push(la.length);la.push(la.length);if(0===Ia%3){this._calculateFaceNormal(ua,Sa,Ia,P);this._getFaceVertices(ua,Sa,Ia,
N,R,S);l.add(N,N,R);l.add(N,N,S);l.scale(N,N,1/3);for(Fa=0;3>Fa;Fa++)aa.push(N[Fa]);for(Fa=0;3>Fa;Fa++)aa.push(N[Fa]+P[Fa]*ea);Y.push(Y.length);Y.push(Y.length)}}}T=new K.Geometry([["position",{data:ia,size:3,exclusive:!0}]],[["position",new Uint32Array(la)]],2);W.push(T);U.push(this._debugVertexNormalMaterial);X.push(e.clone(X[0]));T=new K.Geometry([["position",{data:aa,size:3,exclusive:!0}]],[["position",new Uint32Array(Y)]],2);W.push(T);U.push(this._debugFaceNormalMaterial);X.push(e.clone(X[0]))};
fa._createAs3DShape=function(aa,W,U,X){aa=aa.geometry;if("mesh"!==aa.type)return null;W=this._createGeometryInfo(aa,W);if(!W)return null;const {geometries:T,materials:Y,transformations:ea,objectTransformation:ia}=W;G.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(aa,T,Y,ea);X=new H.Object3D({geometries:T,materials:Y,transformations:ea,metadata:{layerUid:this._context.layer.uid,graphicUid:X}});X.transformation=ia;W=v.perObjectElevationAligner;aa=this._createEdgeMaterial();aa=q.isSome(aa)?{baseMaterial:Y[0],
edgeMaterials:[aa],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;aa=new A.Graphics3DObject3DGraphicLayer(this,X,T,null,null,W,U,aa);aa.needsElevationUpdates=x.needsElevationUpdates3D(U.mode);aa.useObjectOriginAsAttachmentOrigin=!0;aa.elevationContext.centerPointInElevationSR=this.getCenterPointInElevationSR(X);aa.alignedSampledElevation=W(aa,aa.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);return aa};fa.getCenterPointInElevationSR=
function(aa){const W=k.makeDehydratedPoint(0,0,0,this._context.elevationProvider.spatialReference);c.projectVectorToDehydratedPoint([aa.transformation[12],aa.transformation[13],aa.transformation[14]],this._context.renderCoordsHelper.spatialReference,W);return W};fa._createComponentNormals=function(aa,W,U,X){switch(U.shading||"flat"){case "source":return this._createComponentNormalsSource(aa,W,U,X);case "flat":return this._createComponentNormalsFlat(aa,X);case "smooth":return this._createComponentNormalsSmooth(aa,
X)}};fa._createComponentNormalsSource=function(aa,W,U,X){if(q.isNone(W))return this._createComponentNormalsFlat(aa,X);let T=!1;if(!U.trustSourceNormals)for(U=0;U<X.length;U+=3){this._calculateFaceNormal(aa,X,U,P);for(let Y=0;3>Y;Y++){const ea=3*X[U+Y];N[0]=W[ea+0];N[1]=W[ea+1];N[2]=W[ea+2];0>l.dot(P,N)&&(W[ea+0]=-W[ea+0],W[ea+1]=-W[ea+1],W[ea+2]=-W[ea+2],T=!0)}}return{normals:W,indices:X,didFlipNormals:T}};fa._createComponentNormalsFlat=function(aa,W){const U=new Float32Array(W.length),X=new Uint32Array(3*
W.length);for(let T=0;T<W.length;T+=3){const Y=this._calculateFaceNormal(aa,W,T,P);for(let ea=0;3>ea;ea++)U[T+ea]=Y[ea],X[T+ea]=T/3}return{normals:U,indices:X,didFlipNormals:!1}};fa._createComponentNormalsSmooth=function(aa,W){const U={};for(var X=0;X<W.length;X+=3){var T=this._calculateFaceNormal(aa,W,X,P);for(var Y=0;3>Y;Y++){var ea=W[X+Y];let ia=U[ea];ia||(ia={normal:g.create(),count:0},U[ea]=ia);l.add(ia.normal,ia.normal,T);ia.count++}}aa=new Float32Array(3*W.length);X=new Uint32Array(3*W.length);
for(T=0;T<W.length;T++){Y=U[W[T]];1!==Y.count&&(l.normalize(Y.normal,Y.normal),Y.count=1);for(ea=0;3>ea;ea++)aa[3*T+ea]=Y.normal[ea];X[T]=T}return{normals:aa,indices:X,didFlipNormals:!1}};fa._getFaceVertices=function(aa,W,U,X,T,Y){const ea=3*W[U+0],ia=3*W[U+1];W=3*W[U+2];X[0]=aa[ea+0];X[1]=aa[ea+1];X[2]=aa[ea+2];T[0]=aa[ia+0];T[1]=aa[ia+1];T[2]=aa[ia+2];Y[0]=aa[W+0];Y[1]=aa[W+1];Y[2]=aa[W+2]};fa._calculateFaceNormal=function(aa,W,U,X){this._getFaceVertices(aa,W,U,N,R,S);l.subtract(R,R,N);l.subtract(S,
S,N);l.cross(N,R,S);l.normalize(X,N);return X};fa._getOrCreateComponents=function(aa){return aa.components?aa.components:ba};fa._createPositionBuffer=function(aa,W){let U=aa.vertexAttributes.position;const X=1===W.reprojection?W.transformBeforeProject:null;q.isSome(X)&&(U=z.transformPosition(U,new Float64Array(U.length),X));if(0===W.reprojection)return W.needsBufferCopy?new Float64Array(U):U;W=q.isSome(X)?U:new Float64Array(U.length);c.projectBuffer(U,aa.spatialReference,0,W,this._context.renderCoordsHelper.spatialReference,
0,U.length/3);return W};fa._createNormalBuffer=function(aa,W,U){let X=aa.vertexAttributes.normal;if(q.isNone(X))return null;var T=1===U.reprojection?U.transformBeforeProject:null;q.isSome(T)&&(X=z.transformNormal(X,new Float32Array(X.length),T));if("local"===this._context.layerView.view.viewingMode||0===U.reprojection)return U.needsBufferCopy&&aa.vertexAttributes.normal===X?new Float32Array(X):X;U=aa.vertexAttributes.position;T=q.isSome(T)?X:new Float32Array(X.length);return z.projectNormalToPCPF(X,
U,W,aa.spatialReference,T)};fa._createTangentBuffer=function(aa,W,U){let X=aa.vertexAttributes.tangent;if(q.isNone(X))return null;var T=1===U.reprojection?U.transformBeforeProject:null;q.isSome(T)&&(X=z.transformTangent(X,new Float32Array(X.length),T));if("local"===this._context.layerView.view.viewingMode||0===U.reprojection)return U.needsBufferCopy&&aa.vertexAttributes.normal===X?new Float32Array(X):X;U=aa.vertexAttributes.position;T=q.isSome(T)?X:new Float32Array(X.length);return z.projectTangentToPCPF(X,
U,W,aa.spatialReference,T)};fa._createColorBuffer=function(aa){return aa.vertexAttributes.color};fa._createSymbolColorBuffer=function(aa){if(this._requiresSymbolVertexColors()){aa=this._getVertexOpacityAndColor(aa);const W=E.parseColorMixMode(q.get(this.symbolLayer,"material","colorMixMode")),U=new Uint8Array(4);E.encodeSymbolColor(aa,W,U);return U}return null};fa._createBuffers=function(aa,W){var U=aa.vertexAttributes&&aa.vertexAttributes.position;if(!U)return this.logger.warn("Mesh geometry must contain position vertex attributes"),
null;var X=aa.vertexAttributes.normal;const T=aa.vertexAttributes.uv;var Y=aa.vertexAttributes.tangent;if(q.isSome(X)&&X.length!==U.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(q.isSome(Y)&&Y.length/4!==U.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(q.isSome(T)&&T.length/2!==U.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),
null;Y=this._computeReprojectionInfo(aa);U=this._createPositionBuffer(aa,Y);X=this._createColorBuffer(aa);W=this._createSymbolColorBuffer(W);const ea=this._createNormalBuffer(aa,U,Y),ia=this._createTangentBuffer(aa,U,Y);aa=0===Y.reprojection&&q.isSome(Y.objectTransformation)?Y.objectTransformation:this._transformOriginLocal(aa,U,ea,ia);Y=0===Y.reprojection&&q.isSome(Y.geometryTransformation)?Y.geometryTransformation:e.create();return{positionBuffer:U,normalBuffer:ea,tangentBuffer:ia,uvBuffer:T,colorBuffer:X,
symbolColorBuffer:W,objectTransformation:aa,geometryTransformation:Y}};fa._computeReprojectionInfo=function(aa){const W=q.isSome(aa.transform)&&aa.transform.geographic?0:2===this._context.renderCoordsHelper.viewingMode?0:1;var U=null;if(q.isSome(aa.transform)){if(0===W)return U=e.create(),c.computeTranslationToOriginAndRotation(aa.spatialReference,aa.transform.origin,U,this._context.renderCoordsHelper.spatialReference),aa=e.clone(aa.transform.localMatrix),{reprojection:W,objectTransformation:U,geometryTransformation:aa,
needsBufferCopy:!1};U=w.fromTranslation(e.create(),aa.transform.origin);w.multiply(U,U,aa.transform.localMatrix);return{reprojection:W,transformBeforeProject:U,needsBufferCopy:!0}}return{reprojection:W,needsBufferCopy:!0}};fa._transformOriginLocal=function(aa,W,U,X){const T=this._context.renderCoordsHelper.spatialReference;var Y=aa.anchor;L[0]=Y.x;L[1]=Y.y;L[2]=Y.z;Y=e.create();c.computeTranslationToOriginAndRotation(aa.spatialReference,L,Y,T);aa=m.BufferViewVec3f64.fromTypedArray(W);w.invert(Q,Y);
n.transformMat4(aa,aa,Q);if(q.isSome(U)||q.isSome(X))y.fromMat4(V,Y),y.transpose(V,V),q.isSome(U)&&(U=m.BufferViewVec3f.fromTypedArray(U),n.transformMat3(U,U,V)),q.isSome(X)&&(X=m.BufferViewVec3f.fromTypedArray(X,4*X.BYTES_PER_ELEMENT),n.transformMat3(X,X,V));return Y};fa._validateFaces=function(aa,W){aa=aa.vertexAttributes.position.length/3;if(W=W.faces){let U=-1;for(let X=0;X<W.length;X++){const T=W[X];T>U&&(U=T)}if(aa<=U)return this.logger.warn(`Vertex index ${U} is out of bounds of the mesh position buffer`),
!1}else if(0!==aa%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};fa._getOrCreateFaces=function(aa,W){return W.faces?W.faces:M.generateDefaultIndexArray(aa.vertexAttributes.position.length/3)};fa._isOutsideClippingArea=function(aa){if(!this._context.clippingExtent)return!1;var W=aa.vertexAttributes&&aa.vertexAttributes.position;if(!W)return!1;const U=this._context.elevationProvider.spatialReference,
X=W.length/3;aa.spatialReference.equals(U)||(W=new Float64Array(W.length),c.projectBuffer(aa.vertexAttributes.position,aa.spatialReference,0,W,U,0,X));u.empty(ca);u.expandWithBuffer(ca,W,0,X);return!u.intersectsClippingArea(ca,this._context.clippingExtent)};fa._createGeometryInfo=function(aa,W){if(!c.canProjectWithoutEngine(aa.spatialReference,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(aa))return null;
W=this._createBuffers(aa,W);if(q.isNone(W))return null;const {positionBuffer:U,uvBuffer:X,colorBuffer:T,symbolColorBuffer:Y,normalBuffer:ea,tangentBuffer:ia,objectTransformation:la,geometryTransformation:pa}=W;var ua=this._getOrCreateComponents(aa);W=[];const wa=[],Fa=[];let La=!1;for(const Sa of ua){if(!this._validateFaces(aa,Sa))return null;ua=this._getOrCreateFaces(aa,Sa);if(0===ua.length)continue;var Ma=this._createComponentNormals(U,ea,Sa,ua);Ma.didFlipNormals&&(La=!0);const Ia=[["position",
{size:3,data:U,exclusive:!0}],["normal",{size:3,data:Ma.normals,exclusive:!0}]];Ma=[["position",ua],["normal",Ma.indices]];q.isSome(T)&&(Ia.push(["color",{size:4,data:T,exclusive:!0}]),Ma.push(["color",ua]));q.isSome(Y)&&(Ia.push(["symbolColor",{size:4,data:Y,exclusive:!0}]),Ma.push(["symbolColor",new Uint16Array(ua.length)]));q.isSome(X)&&(Ia.push(["uv0",{size:2,data:X,exclusive:!0}]),Ma.push(["uv0",ua]));q.isSome(ia)&&(Ia.push(["tangent",{size:4,data:ia,exclusive:!0}]),Ma.push(["tangent",ua]));
ua=new K.Geometry(Ia,Ma);W.push(ua);wa.push(pa);Fa.push(this._getOrCreateMaterial(aa,Sa))}La&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:W,transformations:wa,materials:Fa,objectTransformation:la}};fa._createEdgeMaterial=function(){const aa={opacity:this._getLayerOpacity()};return D.createMaterial(this.symbolLayer,aa)};return ha}(B.Graphics3DSymbolLayer);
const L=g.create(),N=g.create(),R=g.create(),S=g.create(),P=g.create(),Q=e.create(),V=f.create(),ca=u.create(),ba=[new t];a.Graphics3DMeshFillSymbolLayer=r;a["default"]=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){var u;const t=q.getLogger("esri.geometry.support.MeshComponent");b=u=function(h){function m(z){z=h.call(this,z)||this;z.faces=null;z.material=null;z.shading="source";z.trustSourceNormals=!1;return z}a._inheritsLoose(m,h);m.from=function(z){return l.ensureClass(u,z)};var n=m.prototype;n.castFaces=function(z){return c.castArray(z,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},t)};n.castMaterial=function(z){return z&&"object"===typeof z&&("metallic"in
z||"roughness"in z||"metallicRoughnessTexture"in z)?l.ensureClass(d,z):l.ensureClass(g,z)};n.clone=function(){return new u({faces:r.clone(this.faces),shading:this.shading,material:r.clone(this.material),trustSourceNormals:this.trustSourceNormals})};n.cloneWithDeduplication=function(z,k){z={faces:r.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(z,k):null,trustSourceNormals:this.trustSourceNormals};return new u(z)};return m}(b.JSONSupport);p.__decorate([y.property({json:{write:!0}})],
b.prototype,"faces",void 0);p.__decorate([f.cast("faces")],b.prototype,"castFaces",null);p.__decorate([y.property({type:g,json:{write:!0}})],b.prototype,"material",void 0);p.__decorate([f.cast("material")],b.prototype,"castMaterial",null);p.__decorate([y.property({type:String,json:{write:!0}})],b.prototype,"shading",void 0);p.__decorate([y.property({type:Boolean})],b.prototype,"trustSourceNormals",void 0);return b=u=p.__decorate([e.subclass("esri.geometry.support.MeshComponent")],b)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ./MeshTexture".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){var d;r=d=function(c){function u(h){h=c.call(this,h)||this;h.color=null;h.colorTexture=null;h.normalTexture=null;h.alphaMode="auto";h.alphaCutoff=.5;h.doubleSided=!0;return h}a._inheritsLoose(u,c);var t=u.prototype;t.clone=function(){return this.cloneWithDeduplication(null,new Map)};t.cloneWithDeduplication=function(h,m){const n=q.isSome(h)?h.get(this):null;if(n)return n;m=new d(this.clonePropertiesWithDeduplication(m));q.isSome(h)&&h.set(this,m);return m};t.clonePropertiesWithDeduplication=
function(h){return{color:q.isSome(this.color)?this.color.clone():null,colorTexture:q.isSome(this.colorTexture)?this.colorTexture.cloneWithDeduplication(h):null,normalTexture:q.isSome(this.normalTexture)?this.normalTexture.cloneWithDeduplication(h):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};return u}(r.JSONSupport);p.__decorate([y.property({type:b,json:{write:!0}})],r.prototype,"color",void 0);p.__decorate([y.property({type:g,json:{write:!0}})],r.prototype,
"colorTexture",void 0);p.__decorate([y.property({type:g,json:{write:!0}})],r.prototype,"normalTexture",void 0);p.__decorate([y.property({nonNullable:!0,json:{write:!0}})],r.prototype,"alphaMode",void 0);p.__decorate([y.property({nonNullable:!0,json:{write:!0}})],r.prototype,"alphaCutoff",void 0);p.__decorate([y.property({nonNullable:!0,json:{write:!0}})],r.prototype,"doubleSided",void 0);return r=d=p.__decorate([l.subclass("esri.geometry.support.MeshMaterial")],r)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils ../../views/support/screenshotUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){var c;const u=new WeakMap;let t=0;b=c=function(h){function m(z){z=h.call(this,z)||this;z.wrap="repeat";return z}a._inheritsLoose(m,h);var n=m.prototype;n.writeData=function(z,k,v,x){z instanceof HTMLImageElement?(z={type:"image-element",src:g.toJSON(z.src,x),crossOrigin:z.crossOrigin},k[v]=z):z instanceof HTMLCanvasElement?(z=z.getContext("2d").getImageData(0,0,z.width,z.height),z={type:"canvas-element",imageData:this.encodeImageData(z)},k[v]=z):z instanceof HTMLVideoElement?
(z={type:"video-element",src:g.toJSON(z.src,x),autoplay:z.autoplay,loop:z.loop,muted:z.muted,crossOrigin:z.crossOrigin,preload:z.preload},k[v]=z):(z={type:"image-data",imageData:this.encodeImageData(z)},k[v]=z)};n.readData=function(z){switch(z.type){case "image-element":var k=new Image;k.src=z.src;k.crossOrigin=z.crossOrigin;return k;case "canvas-element":return z=this.decodeImageData(z.imageData),k=document.createElement("canvas"),k.width=z.width,k.height=z.height,k.getContext("2d").putImageData(z,
0,0),k;case "image-data":return this.decodeImageData(z.imageData);case "video-element":return k=document.createElement("video"),k.src=z.src,k.crossOrigin=z.crossOrigin,k.autoplay=z.autoplay,k.loop=z.loop,k.muted=z.muted,k.preload=z.preload,k}};n.clone=function(){const z={url:this.url,data:this.data,wrap:this.cloneWrap()};return new c(z)};n.cloneWithDeduplication=function(z){var k=z.get(this);if(k)return k;k=this.clone();z.set(this,k);return k};n.cloneWrap=function(){return"string"===typeof this.wrap?
this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};n.encodeImageData=function(z){let k="";for(let v=0;v<z.data.length;v++)k+=String.fromCharCode(z.data[v]);return{data:btoa(k),width:z.width,height:z.height}};n.decodeImageData=function(z){const k=atob(z.data),v=new Uint8ClampedArray(k.length);for(let x=0;x<k.length;x++)v[x]=k.charCodeAt(x);return d.wrapImageData(v,z.width,z.height)};n.imageDataContainsTransparent=function(z){for(let k=3;k<z.data.length;k+=4)if(255!==z.data[k])return!0;
return!1};m.from=function(z){return"string"===typeof z?new c({url:z}):z instanceof HTMLImageElement||z instanceof HTMLCanvasElement||z instanceof ImageData||z instanceof HTMLVideoElement?new c({data:z}):y.ensureClass(c,z)};a._createClass(m,[{key:"url",get:function(){return this._get("url")||null},set:function(z){this._set("url",z);z&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(z){this._set("data",z);z&&this._set("url",null)}},{key:"transparent",
get:function(){var z=this.data,k=this.url;return z instanceof HTMLCanvasElement?this.imageDataContainsTransparent(z.getContext("2d").getImageData(0,0,z.width,z.height)):z instanceof ImageData?this.imageDataContainsTransparent(z):k&&(z=k.substr(k.length-4,4).toLowerCase(),k=k.substr(0,15).toLocaleLowerCase(),".png"===z||"data:image/png;"===k)?!0:!1},set:function(z){null!=z?this._override("transparent",z):this._clearOverride("transparent")}},{key:"contentHash",get:function(){const z="string"===typeof this.wrap?
this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",k=(v="")=>`d:${v},t:${this.transparent},w:${z}`;if(null!=this.url)return k(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return k(this.data.src);u.has(this.data)||u.set(this.data,++t);return k(u.get(this.data))}return k()}}]);return m}(r.JSONSupport);p.__decorate([q.property({type:String,json:{write:g.write}})],b.prototype,"url",null);p.__decorate([q.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),
q.property()],b.prototype,"data",null);p.__decorate([l.writer("data")],b.prototype,"writeData",null);p.__decorate([w.reader("data")],b.prototype,"readData",null);p.__decorate([q.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);p.__decorate([q.property({json:{write:!0}})],b.prototype,"wrap",void 0);p.__decorate([q.property({readOnly:!0})],b.prototype,"contentHash",null);return b=c=p.__decorate([e.subclass("esri.geometry.support.MeshTexture")],
b)})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils"],function(a,p,b){function r(t,h){const {format:m,quality:n,rotation:z,disableDecorations:k}=t||{};var v=e(t,h.padding);var x=h.width-v.left-v.right;h=h.height-v.top-v.bottom;v={x:0,y:0,width:x,height:h};if(t&&t.area){null!=t.area.x&&(v.x=Math.floor(t.area.x));null!=t.area.y&&(v.y=Math.floor(t.area.y));var C=null!=t.area.width?Math.floor(t.area.width):null,A=null!=t.area.height?Math.floor(t.area.height):
null;v.width=x-v.x;v.height=h-v.y;null!=C&&null!=A?(v.width=Math.min(v.width,C),v.height=Math.min(v.height,A)):null==C&&null!=A?(C=Math.min(v.width,C),v.height*=C/v.width,v.width=C):null!=C&&null==A&&(C=Math.min(v.height,A),v.width*=C/v.height,v.height=C)}v=w(v,t);C=Math.floor(Math.max(v.x,0));A=Math.floor(Math.max(v.y,0));x={x:C,y:A,width:Math.floor(Math.min(v.width,x-C)),height:Math.floor(Math.min(v.height,h-A))};h=x.width/x.height;v=v.width/v.height;v!==h&&(v>h?(h=Math.floor(x.width/v),x={x:x.x,
y:Math.floor(x.y+(x.height-h)/2),width:x.width,height:h}):(h=Math.floor(x.height*v),x={x:Math.floor(x.x+(x.width-h)/2),y:x.y,width:h,height:x.height}));const {width:B,height:D}=f(t,x);a:switch(m){case "png":case "jpg":case "jpeg":h=m;break a;case null:case void 0:h="png";break a;default:h="png"}v=c[h];v=b.clamp(null!=n?n:v,0,100);return{format:h,quality:v,area:x,width:B,height:D,rotation:z,disableDecorations:!!k,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function q(t,
h){return t.toDataURL(d[h.format],h.quality/100)}function y(t,h,m){m||(l||(l=document.createElement("canvas"),l.width=1,l.height=1),m=l);return m.getContext("2d").createImageData(t,h)}function f(t,h){if(!t)return h;const m=t.width;t=t.height;if(null!=m&&null!=t)return{width:Math.floor(m),height:Math.floor(t)};if(null==m&&null==t)return h;h=h.width/h.height;return null==t?{width:Math.floor(m),height:Math.floor(m/h)}:{width:Math.floor(t*h),height:Math.floor(t)}}function w(t,h){if(!h||null==h.width||
null==h.height)return t;h=h.width/h.height;const m=t.width/t.height;if(m===h)return t;if(m<h)return h=Math.floor(t.height*h),t.x-=(h-t.width)/2,t.width=h,t;h=Math.floor(t.width/h);t.y-=(h-t.height)/2;t.height=h;return t}function e(t,h){return!h||t&&t.ignorePadding?u:h}let l=null,g=!0;const d={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},c={png:100,jpg:98,jpeg:98},u={top:0,right:0,bottom:0,left:0};a.completeUserSettings=r;a.createEmptyImageData=function(t,h,m){if(!t||!h)throw Error("Cannot construct image data without dimensions");
if(g)try{return new ImageData(t,h)}catch(n){g=!1}return y(t,h,m)};a.encodeResult=function(t,h,m,n){if(n.premultipliedAlpha){{var z=t.data;const v=z.length;for(let x=0;x<v;x+=4){var k=z[x+3];0<k&&(k/=255,z[x+0]/=k,z[x+1]/=k,z[x+2]/=k)}}}m.width=t.width;m.height=t.height;z=m.getContext("2d");z.putImageData(t,0,0);n.flipY&&(z.save(),z.globalCompositeOperation="copy",z.scale(1,-1),z.translate(0,-z.canvas.height),z.drawImage(z.canvas,0,0),z.restore());t=z.getImageData(0,0,t.width,t.height);h=q(m,h);m.width=
0;m.height=0;return{dataUrl:h,data:t}};a.resampleHermite=function(t,h,m,n=0,z=0,k=t.width-n,v=t.height-z,x=!1){const {data:C}=t,{width:A,height:B,data:D}=h;k/=A;v/=B;const E=Math.ceil(k/2),G=Math.ceil(v/2);t=t.width;for(let H=0;H<B;H++)for(let J=0;J<A;J++){const O=4*(J+(x?B-H-1:H)*A);let I=0,F=0,L=0,N=0,R=0,S=0;const P=(H+.5)*v;for(let Q=Math.floor(H*v);Q<(H+1)*v;Q++){var K=Math.abs(P-(Q+.5))/G;const V=(J+.5)*k;K*=K;for(let ca=Math.floor(J*k);ca<(J+1)*k;ca++){var M=Math.abs(V-(ca+.5))/E;M=Math.sqrt(K+
M*M);if(1<=M)continue;M=2*M*M*M-3*M*M+1;const ba=4*(n+ca+(z+Q)*t);S+=M*C[ba+3];F+=M;!m&&255>C[ba+3]&&(M=M*C[ba+3]/255);L+=M*C[ba];N+=M*C[ba+1];R+=M*C[ba+2];I+=M}}D[O]=L/I;D[O+1]=N/I;D[O+2]=R/I;D[O+3]=S/F}return h};a.screenshotSuperSampleSettings=function(t,h,m){if(!h)return t;const {framebufferWidth:n,framebufferHeight:z,pixelRatio:k,region:v}=t;h=e(t,m);m=h.left+h.right;const x=h.top+h.bottom,C=n-m,A=z-x,B=Math.min(8,Math.min((2048-m)/C,(2048-x)/A));return 1.5>B?t:{...t,framebufferWidth:Math.round(C*
B)+m,framebufferHeight:Math.round(A*B)+x,pixelRatio:k*B,resample:{region:{x:Math.round((v.x-h.left)*B)+h.left,y:Math.round((v.y-h.top)*B)+h.top,width:Math.round(v.width*B),height:Math.round(v.height*B)},width:n,height:z}}};a.toDataUrl=q;a.toRenderSettings=function(t,h){const m=r(t,h),n=m.area,z=m.width/n.width,k=e(m,h.padding),v=k.left+k.right,x=k.top+k.bottom;return{framebufferWidth:Math.floor((h.width-v)*z+v),framebufferHeight:Math.floor((h.height-x)*z+x),region:{x:Math.floor(n.x*z)+k.left,y:Math.floor(n.y*
z)+k.top,width:m.width,height:m.height},format:m.format,quality:m.quality,rotation:m.rotation,pixelRatio:z,layers:t&&t.layers?t.layers:[],disableDecorations:m.disableDecorations,ignoreBackground:m.ignoreBackground,ignorePadding:m.ignorePadding}};a.wrapImageData=function(t,h,m,n){if(!h||!m)throw Error("Cannot construct image data without dimensions");if(g)try{return new ImageData(t,h,m)}catch(z){g=!1}h=y(h,m,n);h.data.set(t,0);return h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){var d;y=d=function(c){function u(h){h=c.call(this,h)||this;h.emissiveColor=null;h.emissiveTexture=null;h.occlusionTexture=null;h.metallic=1;h.roughness=1;h.metallicRoughnessTexture=null;return h}a._inheritsLoose(u,c);var t=u.prototype;t.clone=function(){return this.cloneWithDeduplication(null,new Map)};t.cloneWithDeduplication=function(h,m){const n=r.isSome(h)?h.get(this):null;if(n)return n;m=new d(this.clonePropertiesWithDeduplication(m));r.isSome(h)&&h.set(this,m);
return m};t.clonePropertiesWithDeduplication=function(h){return{...c.prototype.clonePropertiesWithDeduplication.call(this,h),emissiveColor:r.isSome(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:r.isSome(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(h):null,occlusionTexture:r.isSome(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(h):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:r.isSome(this.metallicRoughnessTexture)?
this.metallicRoughnessTexture.cloneWithDeduplication(h):null}};return u}(l);p.__decorate([q.property({type:b,json:{write:!0}})],y.prototype,"emissiveColor",void 0);p.__decorate([q.property({type:g,json:{write:!0}})],y.prototype,"emissiveTexture",void 0);p.__decorate([q.property({type:g,json:{write:!0}})],y.prototype,"occlusionTexture",void 0);p.__decorate([q.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],y.prototype,"metallic",void 0);p.__decorate([q.property({type:Number,
nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],y.prototype,"roughness",void 0);p.__decorate([q.property({type:g,json:{write:!0}})],y.prototype,"metallicRoughnessTexture",void 0);return y=d=p.__decorate([e.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],y)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e,l){function g(h,m,n,z){const {loggerTag:k,stride:v}=m;return 0!==h.length%v?(z.error(k,`Invalid array length, expected a multiple of ${v}`),new n([])):h}function d(h,m,n,z,k){if(!h)return h;if(h instanceof m)return g(h,z,m,k);for(const v of n)if(h instanceof v)return g(new m(h),z,m,k);if(Array.isArray(h))return g(new m(h),z,m,k);n=n.map(v=>`'${v.name}'`);k.error(`Failed to set property, expected one of ${n}, but got ${h.constructor.name}`);return new m([])}function c(h,
m,n){{const z=Array(h.length);for(let k=0;k<h.length;k++)z[k]=h[k];h=z}m[n]=h}var u;const t=y.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=u=function(h){function m(z){z=h.call(this,z)||this;z.color=null;z.position=new Float64Array(0);z.uv=null;z.normal=null;z.tangent=null;return z}p._inheritsLoose(m,h);var n=m.prototype;n.castColor=function(z){return d(z,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},t)};n.castPosition=function(z){z&&z instanceof
Float32Array&&t.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return d(z,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},t)};n.castUv=function(z){return d(z,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},t)};n.castNormal=function(z){return d(z,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},t)};n.castTangent=function(z){return d(z,Float32Array,
[Float64Array],{loggerTag:".tangent\x3d",stride:4},t)};n.clone=function(){const z={position:q.clone(this.position),uv:q.clone(this.uv),normal:q.clone(this.normal),tangent:q.clone(this.tangent),color:q.clone(this.color)};return new u(z)};n.clonePositional=function(){const z={position:q.clone(this.position),normal:q.clone(this.normal),tangent:q.clone(this.tangent),uv:this.uv,color:this.color};return new u(z)};return m}(r.JSONSupport);b.__decorate([f.property({json:{write:c}})],a.MeshVertexAttributes.prototype,
"color",void 0);b.__decorate([w.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);b.__decorate([f.property({nonNullable:!0,json:{write:c}})],a.MeshVertexAttributes.prototype,"position",void 0);b.__decorate([w.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);b.__decorate([f.property({json:{write:c}})],a.MeshVertexAttributes.prototype,"uv",void 0);b.__decorate([w.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);b.__decorate([f.property({json:{write:c}})],
a.MeshVertexAttributes.prototype,"normal",void 0);b.__decorate([w.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);b.__decorate([f.property({json:{write:c}})],a.MeshVertexAttributes.prototype,"tangent",void 0);b.__decorate([w.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=u=b.__decorate([l.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);b=a.MeshVertexAttributes;a.castArray=d;a["default"]=b;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../projectionEllipsoid ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){function t(C,A,B,D,E,G){if(A){var K=B.count,M=l.getSphericalPCPF(E);
if(m(E))for(B=0;B<K;B++)D.getVec(B,z),A.getVec(B,k),e.computeTranslationToOriginAndRotation(M,z,v,M),r.fromMat4(x,v),1===C&&r.transpose(x,x),f.transformMat3(k,k,x),G.setVec(B,k);else for(E=0;E<K;E++){D.getVec(E,z);A.getVec(E,k);e.computeTranslationToOriginAndRotation(M,z,v,M);r.fromMat4(x,v);var H=d.y2lat(B.get(E,1));H=Math.cos(H);0===C&&(H=1/H);x[0]*=H;x[1]*=H;x[2]*=H;x[3]*=H;x[4]*=H;x[5]*=H;1===C&&r.transpose(x,x);f.transformMat3(k,k,x);f.normalize(k,k);G.setVec(E,k)}return G}}function h(C){return m(C)||
C.isWebMercator}function m(C){return C.isWGS84||g.isCGCS2000(C)||g.isMars(C)||g.isMoon(C)}const n=p.getLogger("esri.geometry.support.meshUtils.normalProjection"),z=w.create(),k=w.create(),v=y.create(),x=q.create();a.projectFromPCPF=function(C,A,B){e.projectBuffer(C,l.getSphericalPCPF(B),0,A,B,0,C.length/3);return A};a.projectNormalFromPCPF=function(C,A,B,D,E){if(!h(D))return n.error("Cannot convert to spatial reference from PCPF"),E;t(1,c.BufferViewVec3f.fromTypedArray(C),c.BufferViewVec3f64.fromTypedArray(A),
c.BufferViewVec3f64.fromTypedArray(B),D,c.BufferViewVec3f.fromTypedArray(E));return E};a.projectNormalToPCPF=function(C,A,B,D,E){if(!h(D))return n.error("Cannot convert spatial reference to PCPF"),E;t(0,c.BufferViewVec3f.fromTypedArray(C),c.BufferViewVec3f64.fromTypedArray(A),c.BufferViewVec3f64.fromTypedArray(B),D,c.BufferViewVec3f.fromTypedArray(E));return E};a.projectTangentFromPCPF=function(C,A,B,D,E){if(!h(D))return n.error("Cannot convert to spatial reference from PCPF"),E;t(1,c.BufferViewVec3f.fromTypedArray(C,
16),c.BufferViewVec3f64.fromTypedArray(A),c.BufferViewVec3f64.fromTypedArray(B),D,c.BufferViewVec3f.fromTypedArray(E,16));for(A=3;A<C.length;A+=4)E[A]=C[A];return E};a.projectTangentToPCPF=function(C,A,B,D,E){if(!h(D))return n.error("Cannot convert spatial reference to PCPF"),E;t(0,c.BufferViewVec3f.fromTypedArray(C,4*Float32Array.BYTES_PER_ELEMENT),c.BufferViewVec3f64.fromTypedArray(A),c.BufferViewVec3f64.fromTypedArray(B),D,c.BufferViewVec3f.fromTypedArray(E,4*Float32Array.BYTES_PER_ELEMENT));for(A=
3;A<C.length;A+=4)E[A]=C[A];return E};a.projectToPCPF=function(C,A,B){e.projectBuffer(C,A,0,B,l.getSphericalPCPF(A),0,C.length/3);return B};a.transformNormal=function(C,A,B){if(b.isNone(C))return A;r.normalFromMat4(x,B);C=c.BufferViewVec3f.fromTypedArray(C);B=c.BufferViewVec3f.fromTypedArray(A);u.transformMat3(B,C,x);r.isOrthoNormal(x)||u.normalize(B,B);return A};a.transformPosition=function(C,A,B){if(b.isNone(C))return A;C=c.BufferViewVec3f64.fromTypedArray(C);const D=c.BufferViewVec3f64.fromTypedArray(A);
u.transformMat4(D,C,B);return A};a.transformTangent=function(C,A,B){if(b.isNone(C))return A;r.normalFromMat4(x,B);B=c.BufferViewVec3f.fromTypedArray(C,4*Float32Array.BYTES_PER_ELEMENT);const D=c.BufferViewVec3f.fromTypedArray(A,4*Float32Array.BYTES_PER_ELEMENT);u.transformMat3(D,B,x);r.isOrthoNormal(x)||u.normalize(D,D);if(C!==A)for(B=3;B<C.length;B+=4)A[B]=C[B];return A};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports",
"../../../../core/mathUtils","../../../../core/maybe"],function(a,p,b){a.encodeSymbolColor=function(r,q,y){if(b.isNone(r)||2===q)y[0]=255,y[1]=255,y[2]=255,y[3]=255;else{var f=p.clamp(Math.round(85*r[3]),0,85);q=0===f||4===q?0:3===q?85:170;y[0]=p.clamp(Math.round(255*r[0]),0,255);y[1]=p.clamp(Math.round(255*r[1]),0,255);y[2]=p.clamp(Math.round(255*r[2]),0,255);y[3]=f+q}};a.parseColorMixMode=function(r){switch(r){case "multiply":return 1;case "ignore":return 2;case "replace":return 3;case "tint":return 4;
default:return 1}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/utils ../shaders/NativeLineTechnique".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k){const v=b.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");b=function(V){function ca(Z){Z=V.call(this,Z,A)||this;Z.techniqueConfig=new k.NativeLineTechniqueConfiguration;return Z}p._inheritsLoose(ca,V);var ba=ca.prototype;ba.getTechniqueConfig=function(Z){this.techniqueConfig.output=Z;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.transparent=
1>this.params.color[3]||1>this.params.width;this.techniqueConfig.draped=!1;Z=r.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=Z;this.techniqueConfig.stippleOffColorEnabled=Z&&r.isSome(this.params.stippleOffColor);this.techniqueConfig.stippleIntegerRepeatsEnabled=Z&&this.params.stippleIntegerRepeats;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;return this.techniqueConfig};ba.getPassParameters=function(){return this.params};ba.intersect=function(Z,ha,fa,
aa,W,U,X,T,Y){Y?n.intersectDrapedRenderLineGeometry(Z,aa,U,1,X):this.intersectLineGeometry(Z,ha,fa,aa,X)};ba.intersectLineGeometry=function(Z,ha,fa,aa,W){if(aa.options.selectionMode&&!z.isInstanceHidden(ha))if(t.isTranslationMatrix(fa)){ha=Z.vertexAttributes.get("position").data;var U=aa.camera,X=F;y.copy(X,aa.point);f.set(L[0],X[0]-2,X[1]+2,0);f.set(L[1],X[0]+2,X[1]+2,0);f.set(L[2],X[0]+2,X[1]-2,0);f.set(L[3],X[0]-2,X[1]-2,0);for(Z=0;4>Z;Z++)if(!U.unprojectFromRenderScreen(L[Z],N[Z]))return;l.fromPoints(U.eye,
N[0],N[1],R);l.fromPoints(U.eye,N[1],N[2],S);l.fromPoints(U.eye,N[2],N[3],P);l.fromPoints(U.eye,N[3],N[0],Q);Z=Number.MAX_VALUE;for(let Y=0;Y<ha.length-5;Y+=3)if(B[0]=ha[Y]+fa[12],B[1]=ha[Y+1]+fa[13],B[2]=ha[Y+2]+fa[14],D[0]=ha[Y+3]+fa[12],D[1]=ha[Y+4]+fa[13],D[2]=ha[Y+5]+fa[14],!(0>l.signedDistance(R,B)&&0>l.signedDistance(R,D)||0>l.signedDistance(S,B)&&0>l.signedDistance(S,D)||0>l.signedDistance(P,B)&&0>l.signedDistance(P,D)||0>l.signedDistance(Q,B)&&0>l.signedDistance(Q,D))){U.projectToRenderScreen(B,
K);U.projectToRenderScreen(D,M);if(0>K[2]&&0<M[2]){f.subtract(E,B,D);var T=U.frustum;T=-l.signedDistance(T[4],B)/f.dot(E,l.normal(T[4]));f.scale(E,E,T);f.add(B,B,E);U.projectToRenderScreen(B,K)}else if(0<K[2]&&0>M[2])f.subtract(E,D,B),T=U.frustum,T=-l.signedDistance(T[4],D)/f.dot(E,l.normal(T[4])),f.scale(E,E,T),f.add(D,D,E),U.projectToRenderScreen(D,M);else if(0>K[2]&&0>M[2])continue;K[2]=0;M[2]=0;T=e.distance2(e.fromPoints(K,M,O),X);T<Z&&(Z=T,f.copy(H,B),f.copy(J,D))}fa=aa.rayBeginPoint;aa=aa.rayEndPoint;
4>Z&&(Z=Number.MAX_VALUE,e.closestLineSegmentPoint(e.fromPoints(H,J,O),e.fromPoints(fa,aa,I),G)&&(f.subtract(G,G,fa),Z=f.length(G),f.scale(G,G,1/Z),Z/=f.distance(fa,aa)),W(Z,G))}else v.error("intersection assumes a translation-only matrix")};ba.computeAttachmentOrigin=function(Z,ha){Z=Z.vertexAttributes;if(!Z)return!1;Z=Z.get("position");return d.computeAttachmentOriginLines(Z,null,!1,ha)};ba.createBufferWriter=function(){const Z=this.params.vertexColors?m.PositionColorLayout:m.PositionLayout;return r.isNone(this.params.stipplePattern)?
new m.DefaultBufferWriter(Z):new C(Z.clone().vec3f("auxpos1"))};ba.getGLMaterial=function(Z){return 0===Z.output||4===Z.output?new x(Z):void 0};return ca}(u.Material);let x=function(V){function ca(Z){Z=V.call(this,Z)||this;Z.updateParameters();return Z}p._inheritsLoose(ca,V);var ba=ca.prototype;ba.updateParameters=function(){this._technique=this._techniqueRep.releaseAndAcquire(k.NativeLineTechnique,this._material.getTechniqueConfig(this._output),this._technique)};ba.beginSlot=function(Z){return 3===
Z||23===Z};ba._updateOccludeeState=function(Z){Z.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:Z.hasOccludees}),this.updateParameters())};ba.ensureParameters=function(Z){0===this._output&&this._updateOccludeeState(Z)};ba.bind=function(Z){this._technique.bindPass(this._material.getPassParameters(),Z)};ba.getPipelineState=function(Z,ha){return this._technique.getPipelineState(ha)};return ca}(c),C=function(){function V(ba){this.vertexBufferLayout=
ba}var ca=V.prototype;ca.allocate=function(ba){return this.vertexBufferLayout.createBuffer(ba)};ca.elementCount=function(ba){return ba.indices.get("position").length};ca.write=function(ba,Z,ha,fa){h.writeDefaultAttributes(Z,this.vertexBufferLayout,ba.transformation,ba.invTranspTransformation,ha,fa);this.writeAuxpos1(ba,Z,ha,fa)};ca.writeAuxpos1=function(ba,Z,ha,fa){var aa=ha.getField("auxpos1",g.BufferViewVec3f);ha=Z.indices.get("position");Z=Z.vertexAttributes.get("position").data;ba=ba.transformation;
const W=aa.typedBufferStride;aa=aa.typedBuffer;fa*=W;for(let Y=0;Y<ha.length;Y+=2){var U=3*ha[Y],X=Z[U],T=Z[U+1];const ea=Z[U+2];U=ba[0]*X+ba[4]*T+ba[8]*ea+ba[12];const ia=ba[1]*X+ba[5]*T+ba[9]*ea+ba[13];X=ba[2]*X+ba[6]*T+ba[10]*ea+ba[14];for(T=0;2>T;++T)aa[fa]=U,aa[fa+1]=ia,aa[fa+2]=X,fa+=W}};return V}();const A={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1,...u.materialParametersDefaults},B=w.create(),
D=w.create(),E=w.create(),G=w.create(),K=q.createRenderScreenPointArray3(),M=q.createRenderScreenPointArray3(),H=w.create(),J=w.create(),O=e.create(),I=e.create(),F=w.create(),L=[q.createRenderScreenPointArray3(),q.createRenderScreenPointArray3(),q.createRenderScreenPointArray3(),q.createRenderScreenPointArray3()],N=[w.create(),w.create(),w.create(),w.create()],R=l.create(),S=l.create(),P=l.create(),Q=l.create();a.NativeLineMaterial=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["exports",
"../../../support/buffer/InterleavedLayout","./bufferWriterUtils"],function(a,p,b){const r=p.newLayout().vec3f("position"),q=p.newLayout().vec3f("position").vec2f("uv0");p=p.newLayout().vec3f("position").vec4u8("color");let y=function(){function f(e){this.vertexBufferLayout=e}var w=f.prototype;w.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)};w.elementCount=function(e){return e.indices.get("position").length};w.write=function(e,l,g,d){b.writeDefaultAttributes(l,this.vertexBufferLayout,
e.transformation,e.invTranspTransformation,g,d)};return f}();a.DefaultBufferWriter=y;a.PositionColorLayout=p;a.PositionLayout=r;a.PositionUVLayout=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){l=function(m){function n(k,v,x){v=m.call(this,k,v,x)||this;v.stipplePattern=null;v.stippleTextureBind=null;v.stippleTextureRepository=k.stippleTextureRepository;return v}b._inheritsLoose(n,m);var z=n.prototype;z.initializeProgram=function(k){var v=n.shader.get();const x=this.configuration;v=v.build({output:x.output,attributeColor:x.vertexColors,slicePlaneEnabled:x.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:!1,stippleEnabled:x.stippleEnabled,
stippleOffColorEnabled:x.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:x.stippleIntegerRepeatsEnabled});return new c.Program(k.rctx,v,d.Default3D)};z.dispose=function(){m.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};z.bindPass=function(k,v){w.bindProjectionMatrix(this.program,v.camera.projectionMatrix);if(this.stipplePattern!==k.stipplePattern){const x=k.stipplePattern;this.stippleTextureBind=
this.stippleTextureRepository.swap(this.stipplePattern,x);this.stipplePattern=x}if(this.configuration.stippleEnabled){const {pixelSize:x,sdfNormalizer:C}=q.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1};this.program.setUniform1f("stipplePatternSDFNormalizer",C);this.program.setUniform1i("stipplePatternTexture",0);this.program.setUniform1f("stipplePatternPixelSizeInv",1/(x*v.camera.pixelRatio));this.program.setUniform2f("ndcToPixel",v.camera.fullViewport[2]/
2,v.camera.fullViewport[3]/2)}this.program.setUniform4fv("constantColor",k.color);this.program.setUniform1f("alphaCoverage",Math.min(1,k.width*v.camera.pixelRatio));this.configuration.stippleOffColorEnabled&&(k=q.unwrap(k.stippleOffColor),this.program.setUniform4f("stippleOffColor",k[0],k[1],k[2],3<k.length?k[3]:1));4===this.configuration.output&&f.bindOutputHighlight(this.program,v)};z.bindDraw=function(k){w.bindView(this.program,k);y.bindSliceUniformsWithOrigin(this.program,this.configuration,k);
this.program.rebindTextures()};z.initializePipeline=function(){const k=this.configuration,v=h.separateBlendingParams(770,1,771,771),x=(C,A=null,B=null)=>h.makePipelineState({blending:A,depthTest:u.depthCompareLess,depthWrite:B,colorWrite:h.defaultColorWriteParams,stencilWrite:k.sceneHasOcludees?u.stencilWriteMaskOn:null,stencilTest:k.sceneHasOcludees?C?u.stencilToolMaskBaseParams:u.stencilBaseAllZerosParams:null});return 0===k.output?(this._occludeePipelineState=x(!0,k.transparent||k.stippleEnabled?
v:null,h.defaultDepthWriteParams),x(!1,k.transparent||k.stippleEnabled?v:null,h.defaultDepthWriteParams)):x(!1)};z.getPipelineState=function(k){return k?this._occludeePipelineState:this.pipeline};b._createClass(n,[{key:"primitiveType",get:function(){return 1}}]);return n}(l.ShaderTechnique);l.shader=new e.ReloadableShaderModule(t.NativeLineShader,()=>new Promise(function(m,n){a(["./NativeLine.glsl"],m,n)}));e=function(m){function n(){var z=m.apply(this,arguments)||this;z.output=0;z.slicePlaneEnabled=
!1;z.vertexColors=!1;z.transparent=!1;z.draped=!1;z.stippleEnabled=!1;z.stippleOffColorEnabled=!1;z.stippleIntegerRepeatsEnabled=!1;z.sceneHasOcludees=!1;return z}b._inheritsLoose(n,m);return n}(g.ShaderTechniqueConfiguration);r.__decorate([g.parameter({count:8})],e.prototype,"output",void 0);r.__decorate([g.parameter()],e.prototype,"slicePlaneEnabled",void 0);r.__decorate([g.parameter()],e.prototype,"vertexColors",void 0);r.__decorate([g.parameter()],e.prototype,"transparent",void 0);r.__decorate([g.parameter()],
e.prototype,"draped",void 0);r.__decorate([g.parameter()],e.prototype,"stippleEnabled",void 0);r.__decorate([g.parameter()],e.prototype,"stippleOffColorEnabled",void 0);r.__decorate([g.parameter()],e.prototype,"stippleIntegerRepeatsEnabled",void 0);r.__decorate([g.parameter()],e.prototype,"sceneHasOcludees",void 0);p.NativeLineTechnique=l;p.NativeLineTechniqueConfiguration=e;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e){function l(d){const c=new e.ShaderBuilder;c.include(b.Transform,{linearDepth:!1});c.include(r.VertexColor,d);c.include(y.LineStipple,d);c.vertex.uniforms.add("proj","mat4").add("view","mat4");c.attributes.add("position","vec3");c.varyings.add("vpos","vec3");c.vertex.code.add(w.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`);d.stippleEnabled&&(c.attributes.add("auxpos1","vec3"),c.vertex.uniforms.add("ndcToPixel","vec2"),c.vertex.code.add(w.glsl`
    vec4 vpos2 = transformPosition(proj, view, auxpos1);
    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);

    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;
    ${d.stippleIntegerRepeatsEnabled?"stipplePatternUv \x3d floor(stipplePatternUv + 0.5);":""}

    // Cancel out perspective correct interpolation because we want this length the really represent
    // the screen distance
    stipplePatternUv *= gl_Position.w;
    `));c.vertex.code.add(w.glsl`}`);4===d.output&&c.include(q.OutputHighlight);c.include(p.Slice,d);c.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float");c.fragment.code.add(w.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${d.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${w.glsl.float(f.symbolAlphaCutoff)}) {
      discard;
    }

    ${0===d.output?w.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===d.output?w.glsl`outputHighlight();`:""}
  }
  `);return c}var g=Object.freeze({__proto__:null,build:l});a.NativeLineShader=g;a.build=l})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K){z=function(F){function L(R,S,P,Q){R=F.call(this,R,S,P,Q)||this;R._resources=null;R._optionalFields=[];R._instanceIndexToGraphicUid=new Map;R.hasLoadedPBRTextures=!1;R.ensureDrapedStatus(!1);R.hasLoadedPBRTextures=P.physicalBasedRenderingEnabled;return R}p._inheritsLoose(L,F);var N=L.prototype;N.getCachedSize=function(){const [R,S,P]=r.isSome(this._resources)?this._resources.symbolSize:[1,1,1];return{width:R,depth:S,height:P}};N.doLoad=
function(){var R=p._asyncToGenerator(function*(S){if(!this._drivenProperties.size&&k.validateSymbolLayerSize(this.symbolLayer))throw Error();const P=this.symbolLayer;this._resources=this.isPrimitive?yield this._createResourcesForPrimitive(P.resource?P.resource.primitive:c.defaultPrimitive,S):yield this._createResourcesForUrl(P.resource.href,S);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()});return function(S){return R.apply(this,
arguments)}}();N.setMaterialTransparencyParams=function(R,S=r.get(this.symbolLayer,"material","color")){S=this._getCombinedOpacity(S);const P=1>S||this.needsDrivenTransparentPass;R.transparent=P;R.opacity=S;R.cullFace=P?0:2;return R};N._createResourcesForPrimitive=function(){var R=p._asyncToGenerator(function*(S,P){if(!A.isValidPrimitive(S))throw Error(`Unknown object symbol primitive: ${S}`);var Q=this.symbolLayer;const V=d.create(u.objectSymbolLayerPrimitiveBoundingBox(S)),ca=e.fromArray(d.size(V)),
ba=e.fromArray(u.objectSymbolLayerSizeWithResourceSize(ca,Q)),Z=w.length(ba);var ha={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:e.ONES,diffuse:e.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const fa=ha.usePBR;this.setMaterialTransparencyParams(ha);const aa=this.symbol;if("point-3d"===aa.type&&aa.verticalOffset){const {screenLength:W,
minWorldLength:U,maxWorldLength:X}=aa.verticalOffset;ha.verticalOffset={screenLength:q.pt2px(W),minWorldLength:U||0,maxWorldLength:null!=X?X:Infinity};ha.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ha.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ha.externalColor=l.ONES:(Q=r.isSome(Q.material)&&Q.material.color,Q=r.isSome(Q)?b.toUnitRGBA(Q):l.ONES,ha.externalColor=Q);this._fastUpdates=D.initFastSymbolUpdatesState(this._context.renderer,
this._fastVisualVariableConvertOptions(V,ba,ca,r.none));this._fastUpdates.enabled?(Object.assign(ha,this._fastUpdates.materialParameters),ha.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(ha.instanced.push("color"),this._optionalFields.push("color"));ha=new K.DefaultMaterial(ha);ha=A.primitiveLodResources(S,ha);if(!ha)throw Error(`Unknown object symbol primitive: ${S}`);S=G.materialsFromLodResources(ha).map(W=>({opacity:1,transparent:W.params.transparent}));
Q=this._createStageResources(ha,fa);P=yield this._createLodRenderer(ha,P);return{lodResources:ha,lodRenderer:P,stageResources:Q,symbolSize:ba,extentPadding:Z,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:S,physicalBasedRenderingEnabled:fa,resourceBoundingBox:V,resourceSize:ca,dispose:r.none,pivotOffset:r.none}});return function(S,P){return R.apply(this,arguments)}}();N._createResourcesForUrl=function(){var R=p._asyncToGenerator(function*(S,P){var Q=["transformation"],V={materialParamsMixin:{instanced:Q,
slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=D.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(r.none,r.none,r.none,r.none));this._fastUpdates.enabled?(Object.assign(V.materialParamsMixin,this._fastUpdates.materialParameters),Q.push("featureAttribute"),this._optionalFields.push("featureAttribute")):
this._hasPerInstanceColor()&&(Q.push("color"),this._optionalFields.push("color"));Q=this.symbol;if("point-3d"===Q.type&&Q.verticalOffset){const {screenLength:la,minWorldLength:pa,maxWorldLength:ua}=Q.verticalOffset;V.materialParamsMixin.verticalOffset={screenLength:q.pt2px(la),minWorldLength:pa||0,maxWorldLength:null!=ua?ua:Infinity};V.materialParamsMixin.castShadows=!1}V.signal=P;V.usePBR=this._context.physicalBasedRenderingEnabled;Q=V.usePBR;var ca=yield x.fetch(S,V);S=ca.isEsriSymbolResource;V=
ca.isWosr;const ba=ca.remove,Z=v.makeLodResources(ca.lods);v.fillEstimatedMinScreenSpaceRadius(Z);Z.levels.sort((la,pa)=>la.minScreenSpaceRadius-pa.minScreenSpaceRadius);Z.levels[0].minScreenSpaceRadius=Math.min(2,Z.levels[0].minScreenSpaceRadius);const ha=this._context,fa=this._getExternalColorParameters(this.symbolLayer.material);var aa=r.get(this.symbolLayer,"material","color");const W=this._getCombinedOpacity(aa,{hasIntrinsicColor:!0}),U=this.needsDrivenTransparentPass;var X=G.materialsFromLodResources(Z);
aa=G.materialsFromLodResources(Z).map(la=>({opacity:la.params.opacity||1,transparent:la.params.transparent}));X.forEach(la=>{const pa=la.params;la.setParameterValues(fa);const ua=pa.opacity*W;la.setParameterValues({opacity:ua,transparent:1>ua||U||pa.transparent});ha.screenSizePerspectiveEnabled&&la.setParameterValues({screenSizePerspective:ha.sharedResources.screenSizePerspectiveSettings})});ca=ca.referenceBoundingBox;const T=e.fromArray(d.size(ca)),Y=e.fromArray(Z.levels[0].pivotOffset),ea=e.fromArray(u.objectSymbolLayerSizeWithResourceSize(T,
this.symbolLayer)),ia=w.length(ea);D.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(ca,ea,T,Y))&&X.forEach(la=>la.setParameterValues(this._fastUpdates.materialParameters));X=this._createStageResources(Z,Q);P=yield this._createLodRenderer(Z,P);return{lodResources:Z,lodRenderer:P,stageResources:X,symbolSize:ea,extentPadding:ia,isEsriSymbolResource:S,isWosr:V,originalMaterialParameters:aa,physicalBasedRenderingEnabled:Q,resourceBoundingBox:ca,
resourceSize:T,dispose:ba,pivotOffset:Y}});return function(S,P){return R.apply(this,arguments)}}();N._createStageResources=function(R,S){const P=this._context.stage,Q=G.materialsFromLodResources(R);S!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();P.addMany(Q);S=G.texturesFromLodResources(R);P.addMany(S);R=G.geometriesFromLodResources(R);P.addMany(R);return{materials:Q,textures:S,geometries:R}};N._createLodRenderer=function(){var R=p._asyncToGenerator(function*(S,
P){const Q=this._context.stage;S=new E.LodRenderer(S,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:V=>this._instanceIndexToGraphicUid.get(V),notifyGraphicGeometryChanged:V=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(V)),notifyGraphicVisibilityChanged:V=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(V))},this._fastUpdates.enabled?{applyTransform:(V,ca,ba)=>{V.getFeatureAttribute(ca,O);y.copy(ba,D.evaluateModelTransform(this._fastUpdates.materialParameters,
O,ba))},scaleFactor:(V,ca,ba)=>{ca.getFeatureAttribute(ba,O);return D.evaluateModelTransformScale(V,this._fastUpdates.materialParameters,O)}}:null);S.slicePlane=this._context.slicePlaneEnabled;yield Q.addRenderPlugin(S.slots,S,P);return S});return function(S,P){return R.apply(this,arguments)}}();N._getExternalColorParameters=function(R){const S={};this._drivenProperties.color?S.externalColor=l.ONES:r.isSome(R)&&r.isSome(R.color)?S.externalColor=b.toUnitRGBA(R.color):(S.externalColor=l.ONES,S.colorMixMode=
"ignore");return S};N.destroy=function(){F.prototype.destroy.call(this);const R=this._context.stage;if(r.isSome(this._resources)){R.removeRenderPlugin(this._resources.lodRenderer);const S=this._resources.stageResources;R.removeMany(S.materials);R.removeMany(S.textures);R.removeMany(S.geometries);r.isSome(this._resources.dispose)&&this._resources.dispose()}this._resources=null};N.createGraphics3DGraphic=function(R){const S=R.graphic;if(!this._validateGeometry(S.geometry))return null;const P=C.placePointOnGeometry(S.geometry);
if(r.isNone(P))return this.logger.warn(`unsupported geometry type for icon symbol: ${S.geometry.type}`),null;const Q=this.setGraphicElevationContext(S,new m.ElevationContext);return this._createAs3DShape(S,P,R.renderingInfo,Q,S.uid)};N.notifyDestroyGraphicLayer=function(R){this._instanceIndexToGraphicUid.delete(R.instanceIndex)};N.graphicLayerToGraphicId=function(){return 0};N.layerOpacityChanged=function(){if(r.isNone(this._resources))return!0;const R=this._drivenProperties.opacity,S=!this.isPrimitive,
P=this._resources.stageResources.materials,Q=this._resources.originalMaterialParameters;for(let ba=0;ba<P.length;ba++){const Z=P[ba];var V=r.get(this.symbolLayer,"material","color"),ca=Q[ba];V=this._getCombinedOpacity(V,{hasIntrinsicColor:S})*ca.opacity;ca=1>V||R||ca.transparent;Z.setParameterValues({opacity:V,transparent:ca});this.isPrimitive&&Z.setParameterValues({cullFace:ca?0:2})}return!0};N.layerElevationInfoChanged=function(R,S){return this.updateGraphics3DGraphicElevationInfo(R,S,h.needsElevationUpdates3D)};
N.slicePlaneEnabledChanged=function(){if(r.isNone(this._resources))return!0;this._resources.lodRenderer.slicePlane=this._context.slicePlaneEnabled;for(const R of this._resources.stageResources.materials)R.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};N.physicalBasedRenderingChanged=function(){if(r.isNone(this._resources))return!0;const {stageResources:R,isWosr:S}=this._resources;for(const P of R.materials)this.isPrimitive?P.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0}):S||P.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this.hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this.hasLoadedPBRTextures=!0,!1):!0};N.pixelRatioChanged=function(){return!0};N.applyRendererDiff=function(R,S){if(r.isNone(this._resources))return!0;const {stageResources:{materials:P},lodRenderer:Q,resourceBoundingBox:V,symbolSize:ca,resourceSize:ba,pivotOffset:Z}=this._resources;for(const ha in R.diff)switch(ha){case "visualVariables":if(D.updateFastSymbolUpdatesState(this._fastUpdates,
S,this._fastVisualVariableConvertOptions(V,ca,ba,Z))){for(const fa of P)fa.setParameterValues(this._fastUpdates.materialParameters);Q.notifyShaderTransformationChanged()}else return!1;break;default:return!1}return!0};N.computeComplexity=function(){if(r.isNone(this._resources))return F.prototype.computeComplexity.call(this);const R=G.geometriesFromLodLevelResources(this._resources.lodResources.levels[0]).reduce((P,Q)=>P+Q.indices.get("position").length,0)/3,S=B.defaultSymbolLayerMemoryComplexity(this.symbol,
this.symbolLayer);return{primitivesPerFeature:R,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:S}};N.hasLodRenderer=function(){return r.isSome(this._resources)};N._createAs3DShape=function(R,S,P,Q,V){if(!this.hasLodRenderer()||r.isNone(this._resources))return null;R=this.getFastUpdateAttrValues(R);const ca=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?k.mixinColorAndOpacity(P.color,P.opacity):null;var ba=this._context.clippingExtent;g.projectPointToVector(S,M,this._context.elevationProvider.spatialReference);
if(r.isSome(ba)&&!d.containsPoint(ba,M))return null;ba=this._requiresTerrainElevation(Q);const Z=this._computeGlobalTransform(S,Q,J,ba?I:null);P=this._computeLocalTransform(this._resources,this.symbolLayer,P,H);const ha=this._resources.lodRenderer.instanceData,fa=ha.addInstance();this._instanceIndexToGraphicUid.set(fa,V);ha.setLocalTransform(fa,P,!1);ha.setGlobalTransform(fa,Z);R&&ha.setFeatureAttribute(fa,R);ca&&ha.setColor(fa,ca);V=new n(this,fa,t.perLodInstanceElevationAligner,Q);ba&&(V.alignedSampledElevation=
I.sampledElevation);V.needsElevationUpdates=h.needsElevationUpdates3D(Q.mode);C.extendPointGraphicElevationContext(V,S,this._context.elevationProvider);return V};N._computeGlobalTransform=function(R,S,P,Q){S=h.evaluateElevationAlignmentAtPoint(R,this._context.elevationProvider,S,this._context.renderCoordsHelper,Q);M[0]=R.x;M[1]=R.y;M[2]=S;g.computeTranslationToOriginAndRotation(R.spatialReference,M,P,this._context.renderCoordsHelper.spatialReference);return P};N._computeLocalTransform=function(R,
S,P,Q){y.identity(Q);this._applyObjectRotation(P,!1,Q);this._applyObjectRotation(S,!0,Q);this._applyObjectScale(R,P,Q);this._applyAnchor(R,S,Q);return Q};N._applyObjectScale=function(R,S,P){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(R=k.computeObjectScale(this._drivenProperties.size&&S.size?S.size:R.symbolSize,R.symbolSize,R.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===R[0]&&1===R[1]&&1===R[2]||y.scale(P,P,R))};N.prepareSymbolLayerPatch=function(R){if("partial"===
R.diff.type){var S=R.diff.diff;this._preparePatchTransform(R,S);this._preparePatchColor(R,S)}};N.updateGeometry=function(R,S){if(r.isNone(this._resources))return!0;const P=S&&C.placePointOnGeometry(S);if(r.isNone(P))return!1;S=this.getGeometryElevationMode(S);if(R.elevationContext.mode!==S)return!1;S=this._requiresTerrainElevation(R.elevationContext);this._computeGlobalTransform(P,R.elevationContext,J,S?I:null);S&&(R.alignedSampledElevation=I.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(R.instanceIndex,
J,!0);C.extendPointGraphicElevationContext(R,P,this._context.elevationProvider);return!0};N._preparePatchTransform=function(R,S){if((S.heading||S.tilt||S.roll||S.width||S.height||S.depth||S.anchor||S.anchorPosition)&&!r.isNone(this._resources)){var P=(U,X,T)=>r.unwrapOr(null!=U&&"complete"===U.type?U.newValue:X,T),Q=P(S.heading,this.symbolLayer.heading,0),V=P(S.tilt,this.symbolLayer.tilt,0),ca=P(S.roll,this.symbolLayer.roll,0),ba=P(S.width,this.symbolLayer.width,void 0),Z=P(S.height,this.symbolLayer.height,
void 0),ha=P(S.depth,this.symbolLayer.depth,void 0),fa=P(S.anchor,this.symbolLayer.anchor,void 0);P=P(S.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete S.heading;delete S.tilt;delete S.roll;delete S.width;delete S.height;delete S.depth;delete S.anchor;delete S.anchorPosition;var aa={heading:Q,tilt:V,roll:ca,anchor:fa,anchorPosition:P},W=this._resources;1===this.loadStatus&&R.symbolLayerStatePatches.push(()=>{W.symbolSize=e.fromArray(u.objectSymbolLayerSizeWithResourceSize(W.resourceSize,
{width:ba,height:Z,depth:ha,isPrimitive:this.symbolLayer.isPrimitive}))});R.graphics3DGraphicPatches.push((U,X)=>{X=this._computeLocalTransform(W,aa,X,H);W.lodRenderer.instanceData.setLocalTransform(U.instanceIndex,X,!0)})}};N._preparePatchColor=function(R,S){if(S.material&&"partial"===S.material.type&&(S=S.material.diff,S.color&&"complete"===S.color.type&&null!=S.color.newValue&&null!=S.color.oldValue)){var P=S.color.newValue,Q=r.isSome(P)?b.toUnitRGBA(P):l.ONES;delete S.color;var V=this._resources;
r.isNone(V)||R.graphics3DGraphicPatches.push(ca=>{this._hasPerInstanceColor()?(V.lodRenderer.instanceData.setColor(ca.instanceIndex,Q),ca=this.setMaterialTransparencyParams({},P)):ca=this.setMaterialTransparencyParams({externalColor:Q},P);for(const ba of V.stageResources.materials)ba.setParameterValues(ca)})}};N._requiresTerrainElevation=function(R){return"absolute-height"!==R.mode};N._applyObjectRotation=function(R,S,P){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&
S))return k.computeObjectRotation(R.heading,R.tilt,R.roll,P)};N._computeAnchor=function(R,S,P){const Q=e.create();switch(P.anchor){case "center":w.copy(Q,d.center(R));w.negate(Q,Q);break;case "top":S=d.center(R);w.set(Q,-S[0],-S[1],-R[5]);break;case "bottom":S=d.center(R);w.set(Q,-S[0],-S[1],-R[2]);break;case "relative":S=d.center(R);R=d.size(R);P=(P=P.anchorPosition)?e.fromValues(P.x,P.y,P.z):e.ZEROS;w.multiply(Q,R,P);w.add(Q,Q,S);w.negate(Q,Q);break;default:r.isSome(S)?w.negate(Q,S):w.copy(Q,e.ZEROS)}return Q};
N._applyAnchor=function(R,S,P){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(R=this._computeAnchor(R.resourceBoundingBox,R.pivotOffset,S))&&y.translate(P,P,R)};N._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};N._fastVisualVariableConvertOptions=function(R,S,P,Q){const V=r.isSome(R)?e.fromArray(d.size(R)):e.ONES;R=r.isSome(R)?this._computeAnchor(R,Q,this.symbolLayer):e.ZEROS;Q=this._context.renderCoordsHelper.unitInMeters;
P=k.computeObjectScale(r.isSome(S)?S:void 0,S,P,Q);const ca=e.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:V,symbolSize:r.isSome(S)?S:e.ONES,unitInMeters:Q,transformation:{anchor:R,scale:P,rotation:ca}}};p._createClass(L,[{key:"extentPadding",get:function(){return r.isSome(this._resources)?this._resources.extentPadding:0}},{key:"isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",
get:function(){return r.get(this._resources,"lodRenderer")}}]);return L}(z.Graphics3DSymbolLayer);const M=e.create(),H=f.create(),J=f.create(),O=l.create(),I={verticalDistanceToGround:0,sampledElevation:0};a.Graphics3DObjectSymbolLayer=z;a["default"]=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,p,b,r,q,y,f,w,e){let l=function(){function h(n,z,k,v){this.graphics3DSymbolLayer=n;this.instanceIndex=z;this.elevationAligner=k;this.elevationContext=v;this.type="lod-instance";this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var m=h.prototype;m.initialize=function(){};m.setVisibility=function(n){const z=this.lodRenderer.instanceData;n!==z.getVisible(this.instanceIndex)&&z.setVisible(this.instanceIndex,n)};m.destroy=function(){null!=this.instanceIndex&&
(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};m.alignWithElevation=function(n,z,k){this.elevationAligner&&(f.setContextFeature(this.elevationContext.featureExpressionInfoContext,k),n=this.elevationAligner(this,this.elevationContext,n,z),null!=n&&(this.alignedSampledElevation=n))};m.getCenterObjectSpace=function(n=q.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,t);return r.transformMat4(n,
this.lodRenderer.baseBoundingSphere.center,t)};m.getBoundingBoxObjectSpace=function(n=y.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,t);const z=this.lodRenderer.baseBoundingBox;y.empty(n);for(let k=0;8>k;++k)r.set(d,0===(k&1)?z[0]:z[3],0===(k&2)?z[1]:z[4],0===(k&4)?z[2]:z[5]),r.transformMat4(d,d,t),y.expandWithVec3(n,d);return n};m.computeAttachmentOrigin=function(n){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,t);n.render.origin[0]+=
t[12];n.render.origin[1]+=t[13];n.render.origin[2]+=t[14];n.render.num++};m.getProjectedBoundingBox=function(){var n=a._asyncToGenerator(function*(z,k,v,x,C){C=this.getBoundingBoxObjectSpace(C);var A=u;const B=y.isPoint(C)?1:A.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,t);for(var D=0;D<B;D++){const E=A[D];d[0]=C[E[0]];d[1]=C[E[1]];d[2]=C[E[2]];r.transformMat4(d,d,t);g[3*D]=d[0];g[3*D+1]=d[1];g[3*D+2]=d[2]}if(!z(g,0,B))return null;y.empty(C);z=null;this.calculateRelativeScreenBounds&&
(z=this.calculateRelativeScreenBounds());for(A=0;A<3*B;A+=3){for(D=0;3>D;D++)C[D]=Math.min(C[D],g[A+D]),C[D+3]=Math.max(C[D+3],g[A+D]);z&&v.push({location:g.slice(A,A+3),screenSpaceBoundingRect:z})}if(k&&(y.center(C,c),"absolute-height"!==this.elevationContext.mode)){let E;v=w.demResolutionForBoundingBox(C,k);try{E=yield k.service.queryElevation(c[0],c[1],x,v,"ground")}catch(G){}p.isSome(E)&&y.offset(C,0,0,-this.alignedSampledElevation+E)}return C});return function(z,k,v,x,C){return n.apply(this,
arguments)}}();m.addObjectState=function(n,z){0===n&&(n=new e.Object3DStateID(n),this.addHighlightId(n),z.addExternal(k=>{this.removeHighlightId(k)},n))};m.removeObjectState=function(n){this.highlights&&this.highlights.forEach(z=>n.remove(z))};m.addHighlightId=function(n){this.highlights=this.highlights||new Set;this.highlights.add(n);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};m.removeHighlightId=function(n){this.highlights&&(this.highlights.delete(n),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};a._createClass(h,[{key:"lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return h}();const g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=q.create(),c=q.create(),u=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],t=b.create();return l})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(a,
p){function b(q){const y=[];q.stageResources.geometries.forEach((f,w)=>{y.push({material:q.stageResources.materials[w],geometry:f,textures:q.stageResources.textures})});return{components:y,minScreenSpaceRadius:q.lodThreshold,pivotOffset:q.pivotOffset}}function r(q,y=.05){q=p.computeFaceCount(q);return Math.sqrt(q/(y*Math.PI))}a.estimateMinScreenSpaceRadius=r;a.fillEstimatedMinScreenSpaceRadius=function(q){q.levels.forEach(y=>{y.minScreenSpaceRadius||(y.minScreenSpaceRadius=r(y))})};a.makeLodLevelResources=
b;a.makeLodResources=function(q){return{levels:q.map(y=>b(y))}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../geometry/support/buffer/utils ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../../../chunks/vec22 ../../../../chunks/vec43 ../../../../chunks/vec33".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D){function E(){E=p._asyncToGenerator(function*(M,H){var J=G(b.adjustStaticAGOUrl(M));if("wosr"===J.fileType)return M=yield H.cache?H.cache.loadWOSR(J.url,H):z.load(J.url,H),J=z.processLoadResult(M,H),{lods:[J],referenceBoundingBox:J.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:M.remove};M=yield H.cache?H.cache.loadGLTF(J.url,H,H.usePBR):m.load(new h.DefaultLoadingContext(H.streamDataRequester),J.url,H,H.usePBR);var O=r.get(M.model.meta,
"ESRI_proxyEllipsoid");if(M.meta.isEsriSymbolResource&&r.isSome(O)&&-1!==M.meta.uri.indexOf("/RealisticTrees/"))a:for(var I=0;I<M.model.lods.length;++I){var F=M.model.lods[I];M.customMeta.esriTreeRendering=!0;for(var L of F.parts){F=L.attributes.normal;if(r.isNone(F))break a;const R=L.attributes.position,S=R.count,P=l.create(),Q=l.create(),V=l.create(),ca=t.createBuffer(d.BufferViewVec4u8,S),ba=t.createBuffer(d.BufferViewVec3f,S),Z=f.invert(w.create(),L.transform);for(let ha=0;ha<S;ha++){R.getVec(ha,
Q);F.getVec(ha,P);e.transformMat4(Q,Q,L.transform);e.subtract(V,Q,O.center);e.divide(V,V,O.radius);const fa=V[2];var N=e.length(V);N=Math.min(.45+.55*N*N,1);e.divide(V,V,O.radius);e.transformMat4(V,V,Z);e.normalize(V,V);I+1!==M.model.lods.length&&1<M.model.lods.length&&(-1<fa?e.lerp(V,V,P,.2):e.lerp(V,V,P,Math.min(-4*fa-3.8,1)));ba.setVec(ha,V);ca.set(ha,0,255*N);ca.set(ha,1,255*N);ca.set(ha,2,255*N);ca.set(ha,3,255)}L.attributes.normal=ba;L.attributes.color=ca}}L=M.meta.isEsriSymbolResource?{usePBR:H.usePBR,
isSchematic:!1,treeRendering:M.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:H.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]};H={...H.materialParamsMixin,treeRendering:M.customMeta.esriTreeRendering};if(null!=J.specifiedLodIndex)return O=K(M,L,H,J.specifiedLodIndex),I=O[0].boundingBox,0!==J.specifiedLodIndex&&(I=K(M,L,H,0)[0].boundingBox),{lods:O,referenceBoundingBox:I,isEsriSymbolResource:M.meta.isEsriSymbolResource,isWosr:!1,remove:M.remove};J=K(M,L,H);return{lods:J,referenceBoundingBox:J[0].boundingBox,
isEsriSymbolResource:M.meta.isEsriSymbolResource,isWosr:!1,remove:M.remove}});return E.apply(this,arguments)}function G(M){const H=M.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return H?{fileType:"gltf",url:H[1],specifiedLodIndex:null!=H[4]?Number(H[4]):null}:M.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:M,specifiedLodIndex:null}:{fileType:"unknown",url:M,specifiedLodIndex:null}}function K(M,H,J,O){const I=M.model,F=y.create(),L=[],N=new Map,R=new Map;I.lods.forEach((S,P)=>{if(void 0===O||
P===O){var Q={name:S.name,stageResources:{textures:[],materials:[],geometries:[]},lodThreshold:r.isSome(S.lodThreshold)?S.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:g.empty()};L.push(Q);S.parts.forEach(V=>{var ca=V.material+(V.attributes.normal?"_normal":"")+(V.attributes.color?"_color":"")+(V.attributes.texCoord0?"_texCoord0":"")+(V.attributes.tangent?"_tangent":"");const ba=I.materials.get(V.material),Z=r.isSome(V.attributes.texCoord0);var ha=r.isSome(V.attributes.normal);
a:{switch(ba.alphaMode){case "BLEND":var fa=0;break a;case "MASK":fa=2;break a;case "OPAQUE":case null:case void 0:fa=1;break a}fa=void 0}if(!N.has(ca)){if(Z){if(r.isSome(ba.textureColor)&&!R.has(ba.textureColor)){var aa=I.textures.get(ba.textureColor);R.set(ba.textureColor,new v.Texture(aa.data,{...aa.parameters,preMultiplyAlpha:1!==fa}))}r.isSome(ba.textureNormal)&&!R.has(ba.textureNormal)&&(aa=I.textures.get(ba.textureNormal),R.set(ba.textureNormal,new v.Texture(aa.data,aa.parameters)));r.isSome(ba.textureOcclusion)&&
!R.has(ba.textureOcclusion)&&(aa=I.textures.get(ba.textureOcclusion),R.set(ba.textureOcclusion,new v.Texture(aa.data,aa.parameters)));r.isSome(ba.textureEmissive)&&!R.has(ba.textureEmissive)&&(aa=I.textures.get(ba.textureEmissive),R.set(ba.textureEmissive,new v.Texture(aa.data,aa.parameters)));r.isSome(ba.textureMetallicRoughness)&&!R.has(ba.textureMetallicRoughness)&&(aa=I.textures.get(ba.textureMetallicRoughness),R.set(ba.textureMetallicRoughness,new v.Texture(aa.data,aa.parameters)))}aa=ba.color[0]**
(1/C.COLOR_GAMMA);var W=ba.color[1]**(1/C.COLOR_GAMMA),U=ba.color[2]**(1/C.COLOR_GAMMA),X=ba.emissiveFactor[0]**(1/C.COLOR_GAMMA);const T=ba.emissiveFactor[1]**(1/C.COLOR_GAMMA),Y=ba.emissiveFactor[2]**(1/C.COLOR_GAMMA),ea=r.isSome(ba.textureColor)&&Z?R.get(ba.textureColor):null;N.set(ca,new x.DefaultMaterial({...H,transparent:0===fa,textureAlphaMode:fa,textureAlphaCutoff:ba.alphaCutoff,diffuse:[aa,W,U],ambient:[aa,W,U],opacity:ba.opacity,doubleSided:ba.doubleSided,doubleSidedType:"winding-order",
cullFace:ba.doubleSided?0:2,vertexColors:!!V.attributes.color,vertexTangents:!!V.attributes.tangent,normals:ha?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:r.isSome(ea)?ea.id:void 0,colorMixMode:ba.colorMixMode,normalTextureId:r.isSome(ba.textureNormal)&&Z?R.get(ba.textureNormal).id:void 0,textureAlphaPremultiplied:r.isSome(ea)&&!!ea.params.preMultiplyAlpha,occlusionTextureId:r.isSome(ba.textureOcclusion)&&Z?R.get(ba.textureOcclusion).id:void 0,emissiveTextureId:r.isSome(ba.textureEmissive)&&
Z?R.get(ba.textureEmissive).id:void 0,metallicRoughnessTextureId:r.isSome(ba.textureMetallicRoughness)&&Z?R.get(ba.textureMetallicRoughness).id:void 0,emissiveFactor:[X,T,Y],mrrFactors:[ba.metallicFactor,ba.roughnessFactor,H.mrrFactors[2]],isSchematic:!1,...J}))}a:{ha=V.indices||V.attributes.position.count;switch(V.primitiveType){case 4:ha=n.trianglesToTriangles(ha);break a;case 5:ha=n.triangleStripToTriangles(ha);break a;case 6:ha=n.triangleFanToTriangles(ha);break a}ha=void 0}fa=ha;ha=V.attributes.position.count;
aa=t.createBuffer(d.BufferViewVec3f,ha);c.transformMat4(aa,V.attributes.position,V.transform);aa=[["position",{data:aa.typedBuffer,size:aa.elementCount,exclusive:!0}]];W=[["position",fa]];r.isSome(V.attributes.normal)&&(U=t.createBuffer(d.BufferViewVec3f,ha),q.normalFromMat4(F,V.transform),c.transformMat3(U,V.attributes.normal,F),aa.push(["normal",{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]),W.push(["normal",fa]));r.isSome(V.attributes.tangent)&&(U=t.createBuffer(d.BufferViewVec4f,ha),
q.normalFromMat4(F,V.transform),u.transformMat3(U,V.attributes.tangent,F),aa.push(["tangent",{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]),W.push(["tangent",fa]));r.isSome(V.attributes.texCoord0)&&(U=t.createBuffer(d.BufferViewVec2f,ha),A.normalizeIntegerBuffer(U,V.attributes.texCoord0),aa.push(["uv0",{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]),W.push(["uv0",fa]));r.isSome(V.attributes.color)&&(U=t.createBuffer(d.BufferViewVec4u8,ha),4===V.attributes.color.elementCount?V.attributes.color instanceof
d.BufferViewVec4f?u.scale(U,V.attributes.color,255):V.attributes.color instanceof d.BufferViewVec4u8?B.copy(U,V.attributes.color):V.attributes.color instanceof d.BufferViewVec4u16&&u.scale(U,V.attributes.color,1/256):(B.fill(U,255,255,255,255),X=new d.BufferViewVec3u8(U.buffer,0,4),V.attributes.color instanceof d.BufferViewVec3f?c.scale(X,V.attributes.color,255):V.attributes.color instanceof d.BufferViewVec3u8?D.copy(X,V.attributes.color):V.attributes.color instanceof d.BufferViewVec3u16&&c.scale(X,
V.attributes.color,1/256)),aa.push(["color",{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]),W.push(["color",fa]));V=new k.Geometry(aa,W);Q.stageResources.geometries.push(V);Q.stageResources.materials.push(N.get(ca));Z&&(r.isSome(ba.textureColor)&&Q.stageResources.textures.push(R.get(ba.textureColor)),r.isSome(ba.textureNormal)&&Q.stageResources.textures.push(R.get(ba.textureNormal)),r.isSome(ba.textureOcclusion)&&Q.stageResources.textures.push(R.get(ba.textureOcclusion)),r.isSome(ba.textureEmissive)&&
Q.stageResources.textures.push(R.get(ba.textureEmissive)),r.isSome(ba.textureMetallicRoughness)&&Q.stageResources.textures.push(R.get(ba.textureMetallicRoughness)));Q.numberOfVertices+=ha;ca=V.boundingInfo;r.isSome(ca)&&(g.expandWithVec3(Q.boundingBox,ca.getBBMin()),g.expandWithVec3(Q.boundingBox,ca.getBBMax()))})}});return L}a.fetch=function(M,H){return E.apply(this,arguments)};a.gltfToEngineResources=K;a.parseUrl=G;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec42":function(){define(["exports",
"../geometry/support/buffer/math/common"],function(a,p){function b(w,e,l){if(w.count!==e.count)p.logger.error("source and destination buffers need to have the same number of elements");else{var g=w.count,d=l[0],c=l[1],u=l[2],t=l[3],h=l[4],m=l[5],n=l[6],z=l[7],k=l[8],v=l[9],x=l[10],C=l[11],A=l[12],B=l[13],D=l[14];l=l[15];var E=w.typedBuffer;w=w.typedBufferStride;var G=e.typedBuffer;e=e.typedBufferStride;for(let M=0;M<g;M++){const H=M*w;var K=M*e;const J=G[K],O=G[K+1],I=G[K+2];K=G[K+3];E[H]=d*J+h*O+
k*I+A*K;E[H+1]=c*J+m*O+v*I+B*K;E[H+2]=u*J+n*O+x*I+D*K;E[H+3]=t*J+z*O+C*I+l*K}}}function r(w,e,l){if(w.count!==e.count)p.logger.error("source and destination buffers need to have the same number of elements");else{var g=w.count,d=l[0],c=l[1],u=l[2],t=l[3],h=l[4],m=l[5],n=l[6],z=l[7];l=l[8];var k=w.typedBuffer;w=w.typedBufferStride;var v=e.typedBuffer;e=e.typedBufferStride;for(let C=0;C<g;C++){const A=C*w;var x=C*e;const B=v[x],D=v[x+1],E=v[x+2];x=v[x+3];k[A]=d*B+t*D+n*E;k[A+1]=c*B+h*D+z*E;k[A+2]=u*
B+m*D+l*E;k[A+3]=x}}}function q(w,e,l){const g=Math.min(w.count,e.count),d=w.typedBuffer;w=w.typedBufferStride;const c=e.typedBuffer;e=e.typedBufferStride;for(let u=0;u<g;u++){const t=u*w,h=u*e;d[t]=l*c[h];d[t+1]=l*c[h+1];d[t+2]=l*c[h+2];d[t+3]=l*c[h+3]}}function y(w,e,l){const g=Math.min(w.count,e.count),d=w.typedBuffer;w=w.typedBufferStride;const c=e.typedBuffer;e=e.typedBufferStride;for(let u=0;u<g;u++){const t=u*w,h=u*e;d[t]=c[h]>>l;d[t+1]=c[h+1]>>l;d[t+2]=c[h+2]>>l;d[t+3]=c[h+3]>>l}}var f=Object.freeze({__proto__:null,
transformMat4:b,transformMat3:r,scale:q,shiftRight:y});a.scale=q;a.shiftRight=y;a.transformMat3=r;a.transformMat4=b;a.vec4=f})},"esri/geometry/support/buffer/utils":function(){define("exports ./types ../../../chunks/mat32 ../../../chunks/mat42 ../../../chunks/scalar ../../../chunks/vec22 ../../../chunks/vec33 ../../../chunks/vec43".split(" "),function(a,p,b,r,q,y,f,w){a.mat3=b.mat3;a.mat4=r.mat4;a.scalar=q.scalar;a.vec2=y.vec2;a.vec3=f.vec3;a.vec4=w.vec4;a.createBuffer=function(e,l){return new e(new ArrayBuffer(l*
e.ElementCount*p.elementTypeSize(e.ElementType)))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat32":function(){define(["exports"],function(a){function p(r,q,y){const f=r.typedBuffer;r=r.typedBufferStride;const w=q.typedBuffer,e=q.typedBufferStride;q=y?y.count:q.count;let l=(y&&y.dstIndex?y.dstIndex:0)*r;y=(y&&y.srcIndex?y.srcIndex:0)*e;for(let g=0;g<q;++g){for(let d=0;9>d;++d)f[l+d]=w[y+d];l+=r;y+=e}}var b=Object.freeze({__proto__:null,copy:p});a.copy=p;a.mat3=b})},"esri/chunks/mat42":function(){define(["exports"],
function(a){function p(r,q,y){const f=r.typedBuffer;r=r.typedBufferStride;const w=q.typedBuffer,e=q.typedBufferStride;q=y?y.count:q.count;let l=(y&&y.dstIndex?y.dstIndex:0)*r;y=(y&&y.srcIndex?y.srcIndex:0)*e;for(let g=0;g<q;++g){for(let d=0;16>d;++d)f[l+d]=w[y+d];l+=r;y+=e}}var b=Object.freeze({__proto__:null,copy:p});a.copy=p;a.mat4=b})},"esri/chunks/scalar":function(){define(["exports"],function(a){function p(q,y,f){const w=q.typedBuffer;q=q.typedBufferStride;const e=y.typedBuffer,l=y.typedBufferStride;
y=f?f.count:y.count;let g=(f&&f.dstIndex?f.dstIndex:0)*q;f=(f&&f.srcIndex?f.srcIndex:0)*l;for(let d=0;d<y;++d)w[g]=e[f],g+=q,f+=l}function b(q,y){const f=q.count;y||(y=new q.TypedArrayConstructor(f));for(let w=0;w<f;w++)y[w]=q.get(w);return y}var r=Object.freeze({__proto__:null,copy:p,makeDense:b});a.copy=p;a.makeDense=b;a.scalar=r})},"esri/chunks/vec22":function(){define(["exports","../geometry/support/buffer/types"],function(a,p){function b(f,w,e){const l=f.typedBuffer;f=f.typedBufferStride;const g=
w.typedBuffer,d=w.typedBufferStride;w=e?e.count:w.count;let c=(e&&e.dstIndex?e.dstIndex:0)*f;e=(e&&e.srcIndex?e.srcIndex:0)*d;for(let u=0;u<w;++u)l[c]=g[e],l[c+1]=g[e+1],c+=f,e+=d}function r(f,w,e){const l=f.typedBuffer,g=f.typedBufferStride,d=w.typedBuffer,c=w.typedBufferStride,u=e?e.count:w.count;let t=(e&&e.dstIndex?e.dstIndex:0)*g,h=(e&&e.srcIndex?e.srcIndex:0)*c;if(p.isInteger(w.elementType))if(e=p.maximumValue(w.elementType),p.isSigned(w.elementType))for(w=0;w<u;++w)l[t]=Math.max(d[h]/e,-1),
l[t+1]=Math.max(d[h+1]/e,-1),t+=g,h+=c;else for(w=0;w<u;++w)l[t]=d[h]/e,l[t+1]=d[h+1]/e,t+=g,h+=c;else b(f,w,e);return f}function q(f,w,e,l){var g,d;const c=f.typedBuffer,u=f.typedBufferStride;f=null!=(g=null==l?void 0:l.count)?g:f.count;l=(null!=(d=null==l?void 0:l.dstIndex)?d:0)*u;for(d=0;d<f;++d)c[l]=w,c[l+1]=e,l+=u}var y=Object.freeze({__proto__:null,copy:b,normalizeIntegerBuffer:r,fill:q});a.copy=b;a.fill=q;a.normalizeIntegerBuffer=r;a.vec2=y})},"esri/chunks/vec33":function(){define(["exports"],
function(a){function p(q,y,f){const w=q.typedBuffer;q=q.typedBufferStride;const e=y.typedBuffer,l=y.typedBufferStride;y=f?f.count:y.count;let g=(f&&f.dstIndex?f.dstIndex:0)*q;f=(f&&f.srcIndex?f.srcIndex:0)*l;for(let d=0;d<y;++d)w[g]=e[f],w[g+1]=e[f+1],w[g+2]=e[f+2],g+=q,f+=l}function b(q,y,f,w,e){var l,g;const d=q.typedBuffer,c=q.typedBufferStride;q=null!=(l=null==e?void 0:e.count)?l:q.count;e=(null!=(g=null==e?void 0:e.dstIndex)?g:0)*c;for(g=0;g<q;++g)d[e]=y,d[e+1]=f,d[e+2]=w,e+=c}var r=Object.freeze({__proto__:null,
copy:p,fill:b});a.copy=p;a.fill=b;a.vec3=r})},"esri/chunks/vec43":function(){define(["exports"],function(a){function p(q,y,f){const w=q.typedBuffer;q=q.typedBufferStride;const e=y.typedBuffer,l=y.typedBufferStride;y=f?f.count:y.count;let g=(f&&f.dstIndex?f.dstIndex:0)*q;f=(f&&f.srcIndex?f.srcIndex:0)*l;for(let d=0;d<y;++d)w[g]=e[f],w[g+1]=e[f+1],w[g+2]=e[f+2],w[g+3]=e[f+3],g+=q,f+=l}function b(q,y,f,w,e,l){var g,d;const c=q.typedBuffer,u=q.typedBufferStride;q=null!=(g=null==l?void 0:l.count)?g:q.count;
l=(null!=(d=null==l?void 0:l.dstIndex)?d:0)*u;for(d=0;d<q;++d)c[l]=y,c[l+1]=f,c[l+2]=w,c[l+3]=e,l+=u}var r=Object.freeze({__proto__:null,copy:p,fill:b});a.copy=p;a.fill=b;a.vec4=r})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(a,p,b,r,q,y,f,w){let e=function(){function g(c){this.streamDataRequester=
c}var d=g.prototype;d.loadJSON=function(){var c=p._asyncToGenerator(function*(u,t){return this.load("json",u,t)});return function(u,t){return c.apply(this,arguments)}}();d.loadBinary=function(){var c=p._asyncToGenerator(function*(u,t){return w.isDataProtocol(u)?(f.throwIfAborted(t),w.dataToArrayBuffer(u)):this.load("binary",u,t)});return function(u,t){return c.apply(this,arguments)}}();d.loadImage=function(){var c=p._asyncToGenerator(function*(u,t){return this.load("image",u,t)});return function(u,
t){return c.apply(this,arguments)}}();d.load=function(){var c=p._asyncToGenerator(function*(u,t,h){if(y.isNone(this.streamDataRequester))return(yield b(t,{responseType:l[u]})).data;u=yield r.result(this.streamDataRequester.request(t,u,h));if(!0===u.ok)return u.value;f.throwIfAbortError(u.error);throw new q("",`Request for resource failed: ${u.error}`);});return function(u,t,h){return c.apply(this,arguments)}}();return g}();const l={image:"image",binary:"array-buffer",json:"json"};a.DefaultLoadingContext=
e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),function(a,p,b,r,q,y,f){function w(){w=p._asyncToGenerator(function*(m,n,z={},k=!0){const v=yield f.Resource.load(m,u,n,z),x=`gltf_${c++}`,C={lods:[],materials:new Map,textures:new Map,meta:e(v)};m=!(!v.json.asset.extras||"symbolResource"!==
v.json.asset.extras.ESRI_type);const A=new Map;yield l(v,function(){var B=p._asyncToGenerator(function*(D,E,G,K){var M;const H=null!=(M=A.get(G))?M:0;A.set(G,H+1);var J=void 0!==D.mode?D.mode:4;M=4===J||5===J||6===J?J:null;if(b.isNone(M))u.warnUnsupported("Unsupported primitive mode ("+h[J]+"). Skipping primitive.");else if(v.hasPositions(D)){J=v.getPositionData(D,z);var O=v.getMaterial(D,z,k),I=v.hasNormals(D)?v.getNormalData(D,z):null,F=v.hasTangents(D)?v.getTangentData(D,z):null,L=v.hasTextureCoordinates(D)?
v.getTextureCoordinates(D,z):null,N=v.hasVertexColors(D)?v.getVertexColors(D,z):null;D=v.getIndexData(D,z);E={transform:r.clone(E),attributes:{position:yield J,normal:I?yield I:null,texCoord0:L?yield L:null,color:N?yield N:null,tangent:F?yield F:null},indices:yield D,primitiveType:M,material:d(C,yield O,x)};D=null;b.isSome(C.meta)&&b.isSome(C.meta.ESRI_lod)&&"screenSpaceRadius"===C.meta.ESRI_lod.metric&&(D=C.meta.ESRI_lod.thresholds[G]);C.lods[G]=C.lods[G]||{parts:[],name:K,lodThreshold:D};C.lods[G].parts[H]=
E}else u.warn("Skipping primitive without POSITION vertex attribute.")});return function(D,E,G,K){return B.apply(this,arguments)}}());for(const B of C.lods)B.parts=B.parts.filter(D=>!!D);return{model:C,meta:{isEsriSymbolResource:m,uri:v.uri},customMeta:{}}});return w.apply(this,arguments)}function e(m){let n=null;m.json.nodes.forEach(z=>{z=z.extras;b.isSome(z)&&(z.ESRI_proxyEllipsoid||z.ESRI_lod)&&(n=z)});return n}function l(m,n){return g.apply(this,arguments)}function g(){g=p._asyncToGenerator(function*(m,
n){function z(B,D){return k.apply(this,arguments)}function k(){k=p._asyncToGenerator(function*(B,D){const E=v.nodes[B];B=m.getNodeTransform(B);u.warnUnsupportedIf(null!=E.weights,"Morph targets are not supported.");if(null!=E.mesh){const G=v.meshes[E.mesh];for(const K of G.primitives)A.push(n(K,B,D,G.name))}for(const G of E.children||[])A.push(z(G,D))});return k.apply(this,arguments)}const v=m.json;var x=v.scenes[v.scene||0].nodes;const C=1<x.length,A=[];for(const B of x)x=v.nodes[B],A.push(z(B,0)),
x.extensions&&x.extensions.MSFT_lod&&Array.isArray(x.extensions.MSFT_lod.ids)&&!C&&x.extensions.MSFT_lod.ids.forEach((D,E)=>z(D,E+1));yield Promise.all(A)});return g.apply(this,arguments)}function d(m,n,z){const k=x=>{const C=`${z}_tex_${x&&x.id}${x&&x.name?"_"+x.name:""}`;if(x&&!m.textures.has(C)){const A=y.makeTextureSource(x.data,{wrap:{s:x.wrapS,t:x.wrapT},mipmap:t.some(B=>B===x.minFilter),noUnpackFlip:!0});m.textures.set(C,A)}return C},v=`${z}_mat_${n.id}_${n.name}`;m.materials.has(v)||(n=y.makeMaterialParameters({color:[n.color[0],
n.color[1],n.color[2]],opacity:n.color[3],alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,doubleSided:n.doubleSided,colorMixMode:n.ESRI_externalColorMixMode,textureColor:n.colorTexture?k(n.colorTexture):void 0,textureNormal:n.normalTexture?k(n.normalTexture):void 0,textureOcclusion:n.occlusionTexture?k(n.occlusionTexture):void 0,textureEmissive:n.emissiveTexture?k(n.emissiveTexture):void 0,textureMetallicRoughness:n.metallicRoughnessTexture?k(n.metallicRoughnessTexture):void 0,emissiveFactor:[n.emissiveFactor[0],
n.emissiveFactor[1],n.emissiveFactor[2]],metallicFactor:n.metallicFactor,roughnessFactor:n.roughnessFactor}),m.materials.set(v,n));return v}let c=0;const u=new q.DefaultErrorContext,t=[9987,9985],h="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ");a.load=function(m,n){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["exports","../../../core/Error","../../../core/Logger"],
function(a,p,b){const r=b.getLogger("esri.views.3d.glTF");b=function(){function q(){}var y=q.prototype;y.error=function(f){throw new p("gltf-loader-error",f);};y.errorUnsupported=function(f){throw new p("gltf-loader-unsupported-feature",f);};y.errorUnsupportedIf=function(f,w){f&&this.errorUnsupported(w)};y.assert=function(f,w){f||this.error(w)};y.warn=function(f){r.warn(f)};y.warnUnsupported=function(f){this.warn("[Unsupported Feature] "+f)};y.warnUnsupportedIf=function(f,w){f&&this.warnUnsupported(w)};
return q}();a.DefaultErrorContext=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports"],function(a){a.makeMaterialParameters=function(p={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,
colorMixMode:"multiply",...p}};a.makeTextureSource=function(p,b={}){return{data:p,parameters:{wrap:{s:10497,t:10497,...b.wrap},noUnpackFlip:!0,mipmap:!1,...b}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/MapUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ./BinaryStreamReader ./fillDefaults ./pathUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){function h(G){switch(G.componentType){case 5120:return new g.BufferViewVec2i8(G.raw,G.byteOffset,G.byteStride,G.byteOffset+G.byteStride*G.entryCount);case 5121:return new g.BufferViewVec2u8(G.raw,G.byteOffset,G.byteStride,G.byteOffset+G.byteStride*G.entryCount);case 5122:return new g.BufferViewVec2i16(G.raw,G.byteOffset,G.byteStride,G.byteOffset+G.byteStride*G.entryCount);case 5123:return new g.BufferViewVec2u16(G.raw,G.byteOffset,G.byteStride,G.byteOffset+
G.byteStride*G.entryCount);case 5125:return new g.BufferViewVec2u32(G.raw,G.byteOffset,G.byteStride,G.byteOffset+G.byteStride*G.entryCount);case 5126:return new g.BufferViewVec2f(G.raw,G.byteOffset,G.byteStride,G.byteOffset+G.byteStride*G.entryCount);default:b.neverReached(G.componentType)}}function m(G){return n.apply(this,arguments)}function n(){n=p._asyncToGenerator(function*(G){return new Promise((K,M)=>{const H=new Blob([G]),J=new FileReader;J.onload=()=>{K(JSON.parse(J.result))};J.onerror=O=>
{M(O)};J.readAsText(H)})});return n.apply(this,arguments)}function z(G,K){return k.apply(this,arguments)}function k(){k=p._asyncToGenerator(function*(G,K){return new Promise((M,H)=>{const J=new Blob([G],{type:K}),O=URL.createObjectURL(J),I=new Image;I.addEventListener("load",()=>{URL.revokeObjectURL(O);"decode"in I?I.decode().then(()=>M(I),()=>M(I)):M(I)});I.addEventListener("error",F=>{URL.revokeObjectURL(O);H(F)});I.src=O})});return k.apply(this,arguments)}let v=function(){function G(M,H,J,O,I){this.context=
M;this.errorContext=H;this.uri=J;this.json=O;this.glbBuffer=I;this.bufferLoaders=new Map;this.textureLoaders=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=t.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();H.errorUnsupportedIf(null==O.scenes,"Scenes must be defined.");H.errorUnsupportedIf(null==O.meshes,"Meshes must be defined");H.errorUnsupportedIf(null==O.nodes,"Nodes must be defined.");
this.computeNodeParents()}G.load=function(){var M=p._asyncToGenerator(function*(H,J,O,I){if(q.isDataProtocol(O)){var F=q.dataComponents(O);if("model/gltf-binary"!==F.mediaType)try{const L=JSON.parse(F.isBase64?atob(F.data):F.data);return new G(H,J,O,L)}catch{}F=q.dataToArrayBuffer(O);if(G.isGLBData(F))return this.fromGLBData(H,J,O,F)}if(O.endsWith(".gltf"))return I=yield H.loadJSON(O,I),new G(H,J,O,I);F=yield H.loadBinary(O,I);if(G.isGLBData(F))return this.fromGLBData(H,J,O,F);I=yield H.loadJSON(O,
I);return new G(H,J,O,I)});return function(H,J,O,I){return M.apply(this,arguments)}}();G.isGLBData=function(M){M=new c.BinaryStreamReader(M);return 4<=M.remainingBytes()&&1179937895===M.readUint32()};G.fromGLBData=function(){var M=p._asyncToGenerator(function*(H,J,O,I){I=yield G.parseGLBData(J,I);return new G(H,J,O,I.json,I.binaryData)});return function(H,J,O,I){return M.apply(this,arguments)}}();G.parseGLBData=function(){var M=p._asyncToGenerator(function*(H,J){const O=new c.BinaryStreamReader(J);
H.assert(12<=O.remainingBytes(),"GLB binary data is insufficiently large.");var I=O.readUint32(),F=O.readUint32();const L=O.readUint32();H.assert(1179937895===I,"Magic first 4 bytes do not fit to expected GLB value.");H.assert(J.byteLength>=L,"GLB binary data is smaller than header specifies.");H.errorUnsupportedIf(2!==F,"An unsupported GLB container version was detected. Only version 2 is supported.");J=0;let N,R;for(;8<=O.remainingBytes();)I=O.readUint32(),F=O.readUint32(),0===J?(H.assert(1313821514===
F,"First GLB chunk must be JSON."),H.assert(0<=I,"No JSON data found."),N=yield m(O.readUint8Array(I))):1===J?(H.errorUnsupportedIf(5130562!==F,"Second GLB chunk expected to be BIN."),R=O.readUint8Array(I)):H.warnUnsupported("More than 2 GLB chunks detected. Skipping."),J+=1;N||H.error("No GLB JSON chunk detected.");return{json:N,binaryData:R}});return function(H,J){return M.apply(this,arguments)}}();var K=G.prototype;K.getBuffer=function(){var M=p._asyncToGenerator(function*(H,J){const O=this.json.buffers[H],
I=this.errorContext;if(null==O.uri)return I.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer;H=yield this.getBufferLoader(H,J);I.assert(H.byteLength===O.byteLength,"Buffer byte lengths should match.");return H});return function(H,J){return M.apply(this,arguments)}}();K.getBufferLoader=function(){var M=p._asyncToGenerator(function*(H,J){const O=this.bufferLoaders.get(H);if(O)return O;J=this.context.loadBinary(this.resolveUri(this.json.buffers[H].uri),J).then(I=>new Uint8Array(I));
this.bufferLoaders.set(H,J);return J});return function(H,J){return M.apply(this,arguments)}}();K.getAccessor=function(){var M=p._asyncToGenerator(function*(H,J){var O=this.errorContext;O.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");H=this.json.accessors[H];O.errorUnsupportedIf(null==(null==H?void 0:H.bufferView),"Some accessor does not specify a bufferView.");O.errorUnsupportedIf(H.type in["MAT2","MAT3","MAT4"],`AttributeType ${H.type} is not supported`);O=this.json.bufferViews[H.bufferView];
J=yield this.getBuffer(O.buffer,J);const I=B[H.type],F=D[H.componentType],L=I*F,N=O.byteStride||L;return{raw:J.buffer,byteStride:N,byteOffset:J.byteOffset+(O.byteOffset||0)+(H.byteOffset||0),entryCount:H.count,isDenselyPacked:N===L,componentCount:I,componentByteSize:F,componentType:H.componentType,min:H.min,max:H.max,normalized:!!H.normalized}});return function(H,J){return M.apply(this,arguments)}}();K.getIndexData=function(){var M=p._asyncToGenerator(function*(H,J){if(null==H.indices)return null;
H=yield this.getAccessor(H.indices,J);if(H.isDenselyPacked)switch(H.componentType){case 5121:return new Uint8Array(H.raw,H.byteOffset,H.entryCount);case 5123:return new Uint16Array(H.raw,H.byteOffset,H.entryCount);case 5125:return new Uint32Array(H.raw,H.byteOffset,H.entryCount)}else switch(H.componentType){case 5121:return d.makeDense(this.wrapAccessor(g.BufferViewUint8,H));case 5123:return d.makeDense(this.wrapAccessor(g.BufferViewUint16,H));case 5125:return d.makeDense(this.wrapAccessor(g.BufferViewUint32,
H))}});return function(H,J){return M.apply(this,arguments)}}();K.getPositionData=function(){var M=p._asyncToGenerator(function*(H,J){const O=this.errorContext;O.errorUnsupportedIf(null==H.attributes.POSITION,"No POSITION vertex data found.");H=yield this.getAccessor(H.attributes.POSITION,J);O.errorUnsupportedIf(5126!==H.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+E[H.componentType]);O.errorUnsupportedIf(3!==H.componentCount,"POSITION vertex attribute must have 3 components, but found "+
H.componentCount.toFixed());return this.wrapAccessor(g.BufferViewVec3f,H)});return function(H,J){return M.apply(this,arguments)}}();K.getNormalData=function(){var M=p._asyncToGenerator(function*(H,J){const O=this.errorContext;O.assert(null!=H.attributes.NORMAL,"No NORMAL vertex data found.");H=yield this.getAccessor(H.attributes.NORMAL,J);O.errorUnsupportedIf(5126!==H.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+E[H.componentType]);O.errorUnsupportedIf(3!==H.componentCount,
"NORMAL vertex attribute must have 3 components, but found "+H.componentCount.toFixed());return this.wrapAccessor(g.BufferViewVec3f,H)});return function(H,J){return M.apply(this,arguments)}}();K.getTangentData=function(){var M=p._asyncToGenerator(function*(H,J){const O=this.errorContext;O.assert(null!=H.attributes.TANGENT,"No TANGENT vertex data found.");H=yield this.getAccessor(H.attributes.TANGENT,J);O.errorUnsupportedIf(5126!==H.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+
E[H.componentType]);O.errorUnsupportedIf(4!==H.componentCount,"TANGENT vertex attribute must have 4 components, but found "+H.componentCount.toFixed());return new g.BufferViewVec4f(H.raw,H.byteOffset,H.byteStride,H.byteOffset+H.byteStride*H.entryCount)});return function(H,J){return M.apply(this,arguments)}}();K.getTextureCoordinates=function(){var M=p._asyncToGenerator(function*(H,J){const O=this.errorContext;O.assert(null!=H.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");H=yield this.getAccessor(H.attributes.TEXCOORD_0,
J);O.errorUnsupportedIf(2!==H.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+H.componentCount.toFixed());if(5126===H.componentType)return this.wrapAccessor(g.BufferViewVec2f,H);O.errorUnsupportedIf(!H.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return h(H)});return function(H,J){return M.apply(this,arguments)}}();K.getVertexColors=function(){var M=p._asyncToGenerator(function*(H,J){const O=this.errorContext;O.assert(null!=
H.attributes.COLOR_0,"No COLOR_0 vertex data found.");H=yield this.getAccessor(H.attributes.COLOR_0,J);O.errorUnsupportedIf(4!==H.componentCount&&3!==H.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+H.componentCount.toFixed());if(4===H.componentCount){if(5126===H.componentType)return this.wrapAccessor(g.BufferViewVec4f,H);if(5121===H.componentType)return this.wrapAccessor(g.BufferViewVec4u8,H);if(5123===H.componentType)return this.wrapAccessor(g.BufferViewVec4u16,H)}else if(3===
H.componentCount){if(5126===H.componentType)return this.wrapAccessor(g.BufferViewVec3f,H);if(5121===H.componentType)return this.wrapAccessor(g.BufferViewVec3u8,H);if(5123===H.componentType)return this.wrapAccessor(g.BufferViewVec3u16,H)}O.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+E[H.componentType])});return function(H,J){return M.apply(this,arguments)}}();K.hasPositions=function(M){return void 0!==M.attributes.POSITION};K.hasNormals=function(M){return void 0!==M.attributes.NORMAL};
K.hasVertexColors=function(M){return void 0!==M.attributes.COLOR_0};K.hasTextureCoordinates=function(M){return void 0!==M.attributes.TEXCOORD_0};K.hasTangents=function(M){return void 0!==M.attributes.TANGENT};K.getMaterial=function(){var M=p._asyncToGenerator(function*(H,J,O){var I=this.materialCache.get(H.material);if(!I){I=null!=H.material?u.material(this.json.materials[H.material]):u.material();const F=I.pbrMetallicRoughness,L=this.hasVertexColors(H),N=this.getTexture(F.baseColorTexture,J),R=this.getTexture(I.normalTexture,
J),S=O?this.getTexture(I.occlusionTexture,J):null,P=O?this.getTexture(I.emissiveTexture,J):null;J=O?this.getTexture(F.metallicRoughnessTexture,J):null;H=null!=H.material?H.material:-1;I={alphaMode:I.alphaMode,alphaCutoff:I.alphaCutoff,color:F.baseColorFactor,doubleSided:!!I.doubleSided,colorTexture:yield N,normalTexture:yield R,name:I.name,id:H,occlusionTexture:yield S,emissiveTexture:yield P,emissiveFactor:I.emissiveFactor,metallicFactor:F.metallicFactor,roughnessFactor:F.roughnessFactor,metallicRoughnessTexture:yield J,
vertexColors:L,ESRI_externalColorMixMode:I.extras.ESRI_externalColorMixMode}}return I});return function(H,J,O){return M.apply(this,arguments)}}();K.getTexture=function(){var M=p._asyncToGenerator(function*(H,J){if(!H)return null;this.errorContext.errorUnsupportedIf(0!==(H.texCoord||0),"Only TEXCOORD with index 0 is supported.");const O=H.index,I=this.errorContext;H=this.json.textures[O];const F=u.textureSampler(null!=H.sampler?this.json.samplers[H.sampler]:{});I.errorUnsupportedIf(null==H.source,
"Source is expected to be defined for a texture.");const L=this.json.images[H.source],N=yield this.loadTextureImageData(O,H,J);return r.getOrCreateMapValue(this.textureCache,O,()=>{const R=P=>33071===P||33648===P||10497===P,S=P=>{I.error(`Unexpected TextureSampler WrapMode: ${P}. Using default REPEAT(10497).`);return 10497};return{data:N,wrapS:R(F.wrapS)?F.wrapS:S(F.wrapS),wrapT:R(F.wrapT)?F.wrapT:S(F.wrapT),minFilter:F.minFilter,name:L.name,id:O}})});return function(H,J){return M.apply(this,arguments)}}();
K.getNodeTransform=function(M){if(void 0===M)return C;var H=this.nodeTransformCache.get(M);if(!H){H=this.getNodeTransform(this.getNodeParent(M));const J=this.json.nodes[M];if(J.matrix)H=f.multiply(w.create(),H,J.matrix);else if(J.translation||J.rotation||J.scale)H=w.clone(H),J.translation&&f.translate(H,H,J.translation),J.rotation&&(A[3]=e.getAxisAngle(A,J.rotation),f.rotate(H,H,A[3],A)),J.scale&&f.scale(H,H,J.scale);this.nodeTransformCache.set(M,H)}return H};K.wrapAccessor=function(M,H){return new M(H.raw,
H.byteOffset,H.byteStride,H.byteOffset+H.byteStride*(H.entryCount-1)+H.componentByteSize*H.componentCount)};K.resolveUri=function(M){return q.makeAbsolute(M,this.baseUri)};K.getNodeParent=function(M){return this.nodeParentMap.get(M)};K.checkVersionSupported=function(){const M=y.Version.parse(this.json.asset.version,"glTF");x.validate(M)};K.checkRequiredExtensionsSupported=function(){const M=this.json,H=this.errorContext;M.extensionsRequired&&0!==M.extensionsRequired.length&&H.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+
M.extensionsRequired.join(", "))};K.computeNodeParents=function(){this.json.nodes.forEach((M,H)=>{M.children&&M.children.forEach(J=>{this.nodeParentMap.set(J,H)})})};K.loadTextureImageData=function(){var M=p._asyncToGenerator(function*(H,J,O){const I=this.textureLoaders.get(H);if(I)return I;J=this.createTextureLoader(J,O);this.textureLoaders.set(H,J);return J});return function(H,J,O){return M.apply(this,arguments)}}();K.createTextureLoader=function(){var M=p._asyncToGenerator(function*(H,J){H=this.json.images[H.source];
if(H.uri)return this.context.loadImage(this.resolveUri(H.uri),J);const O=this.errorContext;O.errorUnsupportedIf(null==H.bufferView,"Image bufferView must be defined.");O.errorUnsupportedIf(null==H.mimeType,"Image mimeType must be defined.");const I=this.json.bufferViews[H.bufferView];J=yield this.getBuffer(I.buffer,J);O.errorUnsupportedIf(null!=I.byteStride,"byteStride not supported for image buffer");return z(new Uint8Array(J.buffer,J.byteOffset+(I.byteOffset||0),I.byteLength),H.mimeType)});return function(H,
J){return M.apply(this,arguments)}}();return G}();const x=new y.Version(2,0,"glTF"),C=f.fromXRotation(w.create(),Math.PI/2),A=l.create(),B={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},D={[5120]:1,[5121]:1,[5122]:2,[5123]:2,[5126]:4,[5125]:4},E={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};a.Resource=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(a,p){let b=function(){function r(y,
f,w=""){this.major=y;this.minor=f;this._context=w}var q=r.prototype;q.lessThan=function(y,f){return this.major<y||y===this.major&&this.minor<f};q.since=function(y,f){return!this.lessThan(y,f)};q.validate=function(y){if(this.major!==y.major)throw new p((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:y});};q.clone=function(){return new r(this.major,this.minor,
this._context)};r.parse=function(y,f=""){const [w,e]=y.split(".");var l=/^\s*\d+\s*$/;if(!w||!w.match||!w.match(l))throw new p((f&&f+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:y});if(!e||!e.match||!e.match(l))throw new p((f&&f+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:y});y=parseInt(w,10);l=parseInt(e,10);return new r(y,l,f)};return r}();a.Version=b;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],function(a){let p=function(){function b(q){this.data=q;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}var r=b.prototype;r.readUint32=function(){const q=this.offset4;this.offset4+=1;return this.dataUint32[q]};r.readUint8Array=function(q){const y=4*this.offset4;this.offset4+=q/4;return new Uint8Array(this.data,y,q)};r.remainingBytes=function(){return this.data.byteLength-4*
this.offset4};return b}();a.BinaryStreamReader=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils"],function(a,p){const b={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},r={pbrMetallicRoughness:b,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},q={ESRI_externalColorMixMode:"tint"},y={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};a.material=(f={})=>
{const w={...b,...f.pbrMetallicRoughness};var e={...q,...f.extras};switch(e.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:p.neverReached(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return{...r,...f,pbrMetallicRoughness:w,extras:e}};a.textureSampler=f=>({...y,...f});Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=function(p){let b,
r;p.replace(/^(.*\/)?([^/]*)$/,(q,y,f)=>{b=y||"";r=f||"";return""});return{dirPart:b,filePart:r}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(a,p,b){a.triangleFanToTriangles=function(r){var q="number"===typeof r?r:r.length;if(3>q)return new Uint16Array(0);q-=2;const y=65536>=q?new Uint16Array(3*q):new Uint32Array(3*q);if("number"===typeof r){r=
0;for(var f=0;f<q;++f)y[r++]=0,y[r++]=f+1,y[r++]=f+2;return y}{f=r[0];let w=r[1],e=0;for(let l=0;l<q;++l){const g=r[l+2];y[e++]=f;y[e++]=w;w=y[e++]=g}return y}};a.triangleStripToTriangles=function(r){var q="number"===typeof r?r:r.length;if(3>q)return new Uint16Array(0);q-=2;const y=65536>=q?new Uint16Array(3*q):new Uint32Array(3*q);if("number"===typeof r){r=0;for(var f=0;f<q;f+=1)0===f%2?(y[r++]=f,y[r++]=f+1):(y[r++]=f+1,y[r++]=f),y[r++]=f+2}else{f=0;for(let g=0;g<q;g+=1)if(0===g%2){var w=r[g],e=
r[g+1],l=r[g+2];y[f++]=w;y[f++]=e;y[f++]=l}else w=r[g+1],e=r[g],l=r[g+2],y[f++]=w,y[f++]=e,y[f++]=l}return y};a.trianglesToTriangles=function(r,q=b.generateDefaultIndexArray){return"number"===typeof r?q(r):p.isUint16Array(r)||p.isUint8Array(r)?new Uint32Array(r):r};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){function h(){h=p._asyncToGenerator(function*(G,K){G=yield m(G,K);K=yield C(G.textureDefinitions,K);return{resource:G,textures:K}});return h.apply(this,arguments)}function m(G,K){return n.apply(this,arguments)}function n(){n=p._asyncToGenerator(function*(G,K){const M=f.isSome(K)&&K.streamDataRequester;if(M)return z(G,M,K);G=yield r.result(b(G,f.unwrap(K)));if(!0===G.ok)return G.value.data;w.throwIfAbortError(G.error);v(G.error)});return n.apply(this,arguments)}
function z(G,K,M){return k.apply(this,arguments)}function k(){k=p._asyncToGenerator(function*(G,K,M){G=yield r.result(K.request(G,"json",M));if(!0===G.ok)return G.value;w.throwIfAbortError(G.error);v(G.error.details.url)});return k.apply(this,arguments)}function v(G){throw new q("",`Request for object resource failed: ${G}`);}function x(G){const K=g.empty();G.forEach(M=>{M=M.boundingInfo;f.isSome(M)&&(g.expandWithVec3(K,M.getBBMin()),g.expandWithVec3(K,M.getBBMax()))});return K}function C(G,K){return A.apply(this,
arguments)}function A(){A=p._asyncToGenerator(function*(G,K){const M=[];for(const O in G){var H=G[O],J=H.images[0].data;if(!J){D.warn("Externally referenced texture data is not yet supported");continue}J=H.encoding+";base64,"+J;const I="/textureDefinitions/"+O,F="rgba"===H.channels?H.alphaChannelUsage||"transparency":"none",L={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:1!==B(F)};H=f.isSome(K)&&K.disableTextures?Promise.resolve(null):d.requestImage(J,K);M.push(H.then(N=>({refId:I,image:N,
params:L,alphaChannelUsage:F})))}G=yield Promise.all(M);K={};for(const O of G)K[O.refId]=O;return K});return A.apply(this,arguments)}function B(G){switch(G){case "mask":return 2;case "maskAndTransparency":return 3;case "none":return 1;case "transparency":return 0;default:return 0}}const D=y.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),E=new e.Version(1,2,"wosr");a.createTextureResources=C;a.load=function(G,K){return h.apply(this,arguments)};a.processLoadResult=function(G,K){const M=
[],H=[],J=[],O=[],I=G.resource;var F=e.Version.parse(I.version||"1.0","wosr");E.validate(F);F=I.model.name;const L=I.model.geometries,N=I.materialDefinitions;G=G.textures;let R=0;const S=new Map;for(let fa=0;fa<L.length;fa++){var P=L[fa],Q=P,V=Q.params,ca=V.topology;var ba=!0;V.vertexAttributes||(D.warn("Geometry must specify vertex attributes"),ba=!1);switch(V.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:ca=V.faces;if(!ca)D.warn("Indexed geometries must specify faces"),
ba=!1;else if(V.vertexAttributes)for(const aa in V.vertexAttributes)(V=ca[aa])&&V.values?(null!=V.valueType&&"UInt32"!==V.valueType&&(D.warn(`Unsupported indexed geometry indices type '${V.valueType}', only UInt32 is currently supported`),ba=!1),null!=V.valuesPerElement&&1!==V.valuesPerElement&&(D.warn(`Unsupported indexed geometry values per element '${V.valuesPerElement}', only 1 is currently supported`),ba=!1)):(D.warn(`Indexed geometry does not specify face indices for '${aa}' attribute`),ba=
!1);break;default:D.warn(`Unsupported topology '${ca}'`),ba=!1}Q.params.material||(D.warn("Geometry requires material"),ba=!1);Q=Q.params.vertexAttributes;for(const aa in Q)Q[aa].values||(D.warn("Geometries with externally defined attributes are not yet supported"),ba=!1);if(ba){ba=P.params;ba={id:1,material:ba.material,texture:ba.texture,region:ba.texture};V=P.params.vertexAttributes;Q=[];for(const aa in V)ca=V[aa],Q.push([aa,{data:ca.values,size:ca.valuesPerElement,exclusive:!0}]);V=[];if("PerAttributeArray"!==
P.params.topology){P=P.params.faces;for(const aa in P)V.push([aa,new Uint32Array(P[aa].values)])}if((P=G&&G[ba.texture])&&!S.has(ba.texture)){const {image:aa,params:W}=P;ca=new u.Texture(aa,W);O.push(ca);S.set(ba.texture,ca)}ca=(ca=S.get(ba.texture))?ca.id:void 0;var Z=J[ba.material]?J[ba.material][ba.texture]:null;if(!Z){Z=ba.material.substring(ba.material.lastIndexOf("/")+1);Z=N[Z].params;1===Z.transparency&&(Z.transparency=0);var ha=P&&P.alphaChannelUsage;ha=0<Z.transparency||"transparency"===
ha||"maskAndTransparency"===ha;const aa=P?B(P.alphaChannelUsage):void 0;P={ambient:l.fromArray(Z.diffuse),diffuse:l.fromArray(Z.diffuse),opacity:1-(Z.transparency||0),transparent:ha,textureAlphaMode:aa,textureAlphaCutoff:.33,textureId:ca,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:Z.externalColorMixMode||"tint",textureAlphaPremultiplied:P?!!P.params.preMultiplyAlpha:!1};f.isSome(K)&&K.materialParamsMixin&&Object.assign(P,K.materialParamsMixin);Z=new t.DefaultMaterial(P);J[ba.material]||
(J[ba.material]={});J[ba.material][ba.texture]=Z}H.push(Z);ba=new c.Geometry(Q,V);R+=V.position?V.position.length:0;M.push(ba)}}return{name:F,stageResources:{textures:O,materials:H,geometries:M},pivotOffset:I.model.pivotOffset,boundingBox:x(M),numberOfVertices:R,lodThreshold:null}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],function(a){a.COLOR_GAMMA=2.1;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../../../../../chunks/mat4f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../core/shaderLibrary/output/OutputHighlight.glsl ../Camera ../DefaultVertexAttributeLocations ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../../../webgl/Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C){function A(O,I,F){const L=O.allocateHead();O=O.view;x.encodeDoubleVec3(I.modelOrigin,F,O.modelOriginHi,O.modelOriginLo,L);O.model.copyFrom(L,I.model,F);O.modelNormal.copyFrom(L,I.modelNormal,F);I.color&&O.color&&O.color.copyFrom(L,I.color,F);I.featureAttribute&&O.featureAttribute&&O.featureAttribute.copyFrom(L,I.featureAttribute,F)}let B=function(O){const I=O.baseBoundingSphere.radius;O=O.levels.map(F=>F.minScreenSpaceRadius);return new m.LevelSelector(I,
O)},D=function(){function O(F,L,N,R){this.type="Lod";this.isGround=!1;this._inverseViewport=q.create();this._levels=[];this._defaultRenderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new d;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.canRender=!0;this._symbol=F;this._optionalFields=L;this._metadata=N;this._instanceBufferLayout=k.DefaultMaterial.getInstanceBufferLayout({instancedDoublePrecision:!0,
instanced:L});this._glInstanceBufferLayout=l.glLayout(this._instanceBufferLayout,1);this._instanceData=new t.InstanceData(this._optionalFields,R);this._instanceData.on("instance-added",()=>{this.requestUpdateCycle()});this._instanceData.on("instance-removed",()=>{this.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",S=>{this.requestUpdateCycle();this._metadata.notifyGraphicGeometryChanged(S.index)});this._instanceData.on("instance-visibility-changed",S=>{this.requestUpdateCycle(!0);
this._metadata.notifyGraphicVisibilityChanged(S.index)});this._instanceData.on("instance-highlight-changed",()=>{this.requestUpdateCycle(!0)});this._enableLevelSelection=1<this._symbol.levels.length}var I=O.prototype;I.initializeRenderContext=function(){var F=p._asyncToGenerator(function*(L,N){this._context=L;const R=L.renderContext.rctx;this._levels=yield b.all(this._symbol.levels.map(S=>{this._defaultRenderInstanceData.push(new z.RenderInstanceData(R,this._instanceBufferLayout));this._highlightRenderInstanceData.push(new z.RenderInstanceData(R,
this._instanceBufferLayout));return n.LodLevel.create(L,S,N)}));this._levelSelector=B(this)});return function(L,N){return F.apply(this,arguments)}}();I.uninitializeRenderContext=function(){this.invalidateOctree();this._levels.forEach(F=>F.destroy());this._defaultRenderInstanceData.forEach(F=>F.destroy());this._highlightRenderInstanceData.forEach(F=>F.destroy())};I.prepareRender=function(F,L){e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES||(this._enableLevelSelection&&(F=L.equals(this._lastCamera),this._lastCamera.copyFrom(L),
F||this.requestUpdateCycle()),F=this._needFullCycle?this._instanceData.size:2E3,this._needFullCycle=!1,this.updateInstances(L,F),this.needsUpdates&&this._context.requestRender())};I.render=function(F){var L=F.rctx;const N=4===F.slot?3:6===F.slot?5:null;if(N){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(F.pass))return!1;var R=F.camera;this._inverseViewport[0]=1/R.fullViewport[2];this._inverseViewport[1]=1/R.fullViewport[3];R={slot:N,origin:[0,0,0],camera:R,inverseViewport:this._inverseViewport,
shadowMap:F.shadowMap,shadowMappingEnabled:F.shadowMap.enabled,ssaoHelper:F.ssaoHelper,ssaoEnabled:F.ssaoHelper.enabled,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:F.sliceHelper&&F.sliceHelper.plane,hudVisibilityTexture:F.offscreenRenderingHelper?F.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:F.offscreenRenderingHelper?F.offscreenRenderingHelper.depthTexture:null,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,
lighting:F.scenelightingData,transparencyPassType:F.transparencyPassType,terrainLinearDepthTexture:F.multipassTerrainParams.terrainLinearDepthTexture,geometryLinearDepthTexture:F.multipassGeometryParams.geometryLinearDepthTexture,multipassTerrainEnabled:F.multipassTerrainParams.multipassTerrainEnabled,cullAboveGround:F.multipassTerrainParams.cullAboveGround,multipassGeometryEnabled:F.multipassGeometryParams.multipassGeometryEnabled,highlightColorTexture:null};L.bindVAO();L=6!==F.pass;5!==F.pass&&
7!==F.pass&&this._renderComponents(F,N,R,this._defaultRenderInstanceData);L&&this._renderComponents(F,N,R,this._highlightRenderInstanceData);return!0}};I.intersect=function(F,L,N,R){if(this.baseMaterial.isVisible()){var S=f.create();y.subtract(S,R,N);var P=Q=>{this._instanceData.getCombinedModelTransform(Q,K);F.transform.set(K);y.transformMat4(M,N,F.transform.inverse);y.transformMat4(H,R,F.transform.inverse);const V=this._instanceData.getState(Q),ca=this._instanceData.getLodLevel(Q);u.assert(V&t.StateFlags.ACTIVE,
"invalid instance state");u.assert(0<=ca&&ca<this._levels.length,"invaid lod level");this._levels[ca].intersect(F,L,M,H,Q,this._metadata)};this.baseMaterial.params.verticalOffset?this.octree.forEach(P):this.octree.forEachAlongRay(N,S,P)}};I.queryDepthRange=function(F){return this.queryDepthRangeOctree(F)};I.notifyShaderTransformationChanged=function(){this.invalidateOctree()};I.requestUpdateCycle=function(F=!1){this._updateCyclesWithStaticCamera=-1;F&&(this._needFullCycle=!0);this.needsUpdates&&this._context.requestRender()};
I.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};I.buildOctree=function(){const F=new h.InstanceOctree(this._instanceData,this.baseBoundingSphere);var L=this._instanceData;L=L.view?L.view.state:null;for(let N=0;N<this._instanceData.capacity;++N)L.get(N)&t.StateFlags.ACTIVE&&F.addInstance(N);return F};I.queryDepthRangeOctree=function(F){var L=F.eye;const N=F.viewForward;var R=this.octree.findClosest(N,1,F.frustum);const S=this.octree.findClosest(N,-1,F.frustum);
return null!=R&&null!=S?(this._instanceData.view.boundingSphere.getVec(R,G),y.subtract(G,G,L),R=y.dot(G,N)-G[3],this._instanceData.view.boundingSphere.getVec(S,G),y.subtract(G,G,L),L=y.dot(G,N)+G[3],{near:Math.max(F.near,R),far:Math.min(F.far,L)}):{near:Infinity,far:-Infinity}};I.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._defaultRenderInstanceData.forEach(F=>{F.startUpdateCylce()});this._highlightRenderInstanceData.forEach(F=>{F.startUpdateCylce()});this.needsUpdates&&
this._context.requestRender()};I.updateInstances=function(F,L){const N=this._enableLevelSelection,R=this._levelSelector;R.updateCamera(F);this._defaultRenderInstanceData.forEach(ba=>{ba.beginUpdate()});this._highlightRenderInstanceData.forEach(ba=>{ba.beginUpdate()});F=this._instanceData;const S=this._instanceData.view,P=F.capacity;let Q=this._instanceIndex;L=Math.min(F.size,L);for(let ba=0;ba<L;++ba){0===Q&&this.startUpdateCycle();const Z=S.state.get(Q);var V=0;if(Z&t.StateFlags.ALLOCATED){var ca=
S.lodLevel.get(Q);Z&t.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[ca].freeTail();Z&t.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[ca].freeTail();Z&t.StateFlags.REMOVE?F.freeInstance(Q):Z&t.StateFlags.VISIBLE?(ca=0,N&&(S.modelOrigin.getVec(Q,E),ca=R.selectLevel(E,F.getCombinedMedianScaleFactor(Q))),V=Z&~(t.StateFlags.ACTIVE|t.StateFlags.TRANSFORM_CHANGED),0<=ca&&(Z&t.StateFlags.HIGHLIGHT?(A(this._highlightRenderInstanceData[ca],S,Q),V|=t.StateFlags.HIGHLIGHT_ACTIVE):
(A(this._defaultRenderInstanceData[ca],S,Q),V|=t.StateFlags.DEFAULT_ACTIVE)),S.state.set(Q,V),S.lodLevel.set(Q,ca)):(V=Z&~(t.StateFlags.ACTIVE|t.StateFlags.TRANSFORM_CHANGED),S.state.set(Q,V));this._octree&&(ca=!!(Z&t.StateFlags.ACTIVE),V=!!(V&t.StateFlags.ACTIVE),!ca&&V?this._octree.addInstance(Q):ca&&!V?this._octree.removeInstance(Q):ca&&V&&Z&t.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(Q),this._octree.addInstance(Q)));Q=(Q+1)%P}else Q=(Q+1)%P,L++}this._instanceIndex=Q;this._defaultRenderInstanceData.forEach(ba=>
{ba.endUpdate()});this._highlightRenderInstanceData.forEach(ba=>{ba.endUpdate()})};I._renderComponents=function(F,L,N,R){this.levels.forEach((S,P)=>{S.components.forEach(Q=>{this._renderComponent(F,L,N,R[P],Q,P)})})};I._renderComponent=function(F,L,N,R,S,P){var Q=S.glMaterials.get(F.pass);if(Q&&Q.beginSlot(L)&&0!==R.size){var V=F.rctx,ca=V.capabilities.instancing;Q.ensureParameters(N);var ba=Q.technique,Z=ba.program;L=Q.getPipelineState(L);V.setPipelineState(L);V.useProgram(Z);Q.bind(N);V.bindVAO(S.vao);
ba.ensureAttributeLocations(S.vao);F.isHighlightPass&&g.bindOutputHighlight(Z,N);ba.bindDraw(N,{},{});e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===F.pass&&(Z.setUniform4fv("externalColor",J[Math.min(P,J.length-1)]),Z.setUniform1i("colorMixMode",v.colorMixModes.replace));F=R.capacity;N=R.headIndex;P=R.tailIndex;Q=R.firstIndex;var ha=this._glInstanceBufferLayout;Z=(fa,aa)=>{C.bindVertexBufferLayout(V,c.Default3D,R.buffer,ha,fa);ca.drawArraysInstanced(ba.primitiveType,0,S.vertexCount,aa-fa);C.unbindVertexBufferLayout(V,
c.Default3D,R.buffer,ha)};S.material.params.transparent&&null!=Q?N>P?(u.assert(Q>=P&&Q<=N,"invalid firstIndex"),Z(Q,N),Z(P,Q)):N<P&&(Q<=N?(u.assert(0<=Q&&Q<=N,"invalid firstIndex"),Z(Q,N),Z(P,F),Z(0,Q)):(u.assert(Q>=P&&Q<=F,"invalid firstIndex"),Z(Q,F),Z(0,N),Z(P,Q))):N>P?Z(P,N):N<P&&(Z(0,N),Z(P,F));V.bindVAO(null)}};p._createClass(O,[{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",
get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlane",get:function(){return this._slicePlane},set:function(F){this._slicePlane=F}},{key:"intersectionHandlerId",get:function(){return this._metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){const F={cpu:0,gpu:0};this._defaultRenderInstanceData.forEach(L=>
{L=L.memoryUsage;F.cpu+=L.cpu;F.gpu+=L.gpu});this._highlightRenderInstanceData.forEach(L=>{L=L.memoryUsage;F.cpu+=L.cpu;F.gpu+=L.gpu});return F}},{key:"renderStats",get:function(){const F=this._instanceData.size,L=[];this._levels.forEach((N,R)=>{R=this._defaultRenderInstanceData[R].size+this._highlightRenderInstanceData[R].size;N=N.triangleCount;L.push({renderedInstances:R,renderedTriangles:R*N,trianglesPerInstance:N})});return{totalInstances:F,renderedInstances:L.reduce((N,R)=>N+R.renderedInstances,
0),renderedTriangles:L.reduce((N,R)=>N+R.renderedTriangles,0),levels:L}}},{key:"slots",get:function(){return[4,6]}},{key:"needsHighlight",get:function(){return 0<this._highlightRenderInstanceData.reduce((F,L)=>F+L.size,0)}},{key:"needsUpdates",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}},{key:"octree",get:function(){this._octree||(this._octree=this.buildOctree());return this._octree}}]);return O}();const E=f.create(),G=w.create(),K=r.create(),M=f.create(),
H=f.create(),J=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]];a.LodRenderer=D;a.setLevelSelectorFactory=function(O){B=O};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){a.StateFlags=void 0;(function(z){z[z.ALLOCATED=1]="ALLOCATED";z[z.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";z[z.VISIBLE=4]="VISIBLE";z[z.HIGHLIGHT=8]="HIGHLIGHT";z[z.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";z[z.REMOVE=32]="REMOVE";z[z.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";z[z.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let u=function(z){this.localTransform=z.getField("localTransform",l.BufferViewMat4f64);this.globalTransform=z.getField("globalTransform",
l.BufferViewMat4f64);this.modelOrigin=z.getField("modelOrigin",l.BufferViewVec3f64);this.model=z.getField("model",l.BufferViewMat3f);this.modelNormal=z.getField("modelNormal",l.BufferViewMat3f);this.modelScaleFactors=z.getField("modelScaleFactors",l.BufferViewVec2f);this.boundingSphere=z.getField("boundingSphere",l.BufferViewVec4f64);this.color=z.getField("color",l.BufferViewVec4f);this.featureAttribute=z.getField("featureAttribute",l.BufferViewVec4f);this.state=z.getField("state",l.BufferViewUint8);
this.lodLevel=z.getField("lodLevel",l.BufferViewUint8)};b=function(z){function k(x,C){var A=z.call(this)||this;A._capacity=0;A._size=0;A._next=0;{let B=d.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=x.indexOf("color")&&(B=B.vec4f("color"));0<=x.indexOf("featureAttribute")&&(B=B.vec4f("featureAttribute"));x=B=B.u8("state").u8("lodLevel").alignTo(8)}A._layout=x;A._shaderTransformation=
C;return A}p._inheritsLoose(k,z);var v=k.prototype;v.addInstance=function(){this._size+1>this._capacity&&this.grow();const x=this.findSlot();this._view.state.set(x,a.StateFlags.ALLOCATED);this._size++;this.emit("instance-added",{index:x});return x};v.removeInstance=function(x){const C=this._view.state;c.assert(0<=x&&x<this._capacity&&C.get(x)&a.StateFlags.ALLOCATED,"invalid instance handle");this.getStateFlag(x,a.StateFlags.ACTIVE)?this.setStateFlags(x,a.StateFlags.REMOVE):this.freeInstance(x);this.emit("instance-removed",
{index:x})};v.freeInstance=function(x){const C=this._view.state;c.assert(0<=x&&x<this._capacity&&C.get(x)&a.StateFlags.ALLOCATED,"invalid instance handle");C.set(x,0);this._size--};v.setLocalTransform=function(x,C,A=!0){this._view.localTransform.setMat(x,C);A&&this.updateModelTransform(x)};v.getLocalTransform=function(x,C){this._view.localTransform.getMat(x,C)};v.setGlobalTransform=function(x,C,A=!0){this._view.globalTransform.setMat(x,C);A&&this.updateModelTransform(x)};v.getGlobalTransform=function(x,
C){this._view.globalTransform.getMat(x,C)};v.updateModelTransform=function(x){const C=this._view;var A=t;const B=h;C.localTransform.getMat(x,m);C.globalTransform.getMat(x,n);const D=y.multiply(n,n,m);w.set(A,D[12],D[13],D[14]);C.modelOrigin.setVec(x,A);r.fromMat4(B,D);C.model.setMat(x,B);A=g.scaleFromMatrix(t,D);A.sort();C.modelScaleFactors.set(x,0,A[1]);C.modelScaleFactors.set(x,1,A[2]);r.invert(B,B);r.transpose(B,B);C.modelNormal.setMat(x,B);this.setStateFlags(x,a.StateFlags.TRANSFORM_CHANGED);
this.emit("instance-transform-changed",{index:x})};v.getModelTransform=function(x,C){const A=this._view;A.model.getMat(x,h);A.modelOrigin.getVec(x,t);C[0]=h[0];C[1]=h[1];C[2]=h[2];C[3]=0;C[4]=h[3];C[5]=h[4];C[6]=h[5];C[7]=0;C[8]=h[6];C[9]=h[7];C[10]=h[8];C[11]=0;C[12]=t[0];C[13]=t[1];C[14]=t[2];C[15]=1};v.applyShaderTransformation=function(x,C){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,x,C)};v.getCombinedModelTransform=function(x,C){this.getModelTransform(x,C);this._shaderTransformation&&
this._shaderTransformation.applyTransform(this,x,C);return C};v.getCombinedLocalTransform=function(x,C){this._view.localTransform.getMat(x,C);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,x,C);return C};v.getCombinedMaxScaleFactor=function(x){let C=this._view.modelScaleFactors.get(x,1);this._shaderTransformation&&(x=this._shaderTransformation.scaleFactor(t,this,x),C*=Math.max(x[0],x[1],x[2]));return C};v.getCombinedMedianScaleFactor=function(x){let C=this._view.modelScaleFactors.get(x,
0);this._shaderTransformation&&(x=this._shaderTransformation.scaleFactor(t,this,x),x.sort(),C*=x[1]);return C};v.getModel=function(x,C){this._view.model.getMat(x,C)};v.setFeatureAttribute=function(x,C){this._view.featureAttribute.setVec(x,C)};v.getFeatureAttribute=function(x,C){this._view.featureAttribute.getVec(x,C)};v.setColor=function(x,C){this._view.color.setVec(x,C)};v.getColor=function(x,C){this._view.color.getVec(x,C)};v.setVisible=function(x,C){C!==this.getVisible(x)&&(this.setStateFlag(x,
a.StateFlags.VISIBLE,C),this.emit("instance-visibility-changed",{index:x}))};v.getVisible=function(x){return this.getStateFlag(x,a.StateFlags.VISIBLE)};v.setHighlight=function(x,C){C!==this.getHighlight(x)&&(this.setStateFlag(x,a.StateFlags.HIGHLIGHT,C),this.emit("instance-highlight-changed",{index:x}))};v.getHighlight=function(x){return this.getStateFlag(x,a.StateFlags.HIGHLIGHT)};v.getState=function(x){return this._view.state.get(x)};v.getLodLevel=function(x){return this._view.lodLevel.get(x)};
v.countFlags=function(x){let C=0;for(let A=0;A<this._capacity;++A)this.getState(A)&x&&++C;return C};v.setStateFlags=function(x,C){const A=this._view.state;C|=A.get(x);A.set(x,C)};v.clearStateFlags=function(x,C){const A=this._view.state;C=A.get(x)&~C;A.set(x,C)};v.setStateFlag=function(x,C,A){A?this.setStateFlags(x,C):this.clearStateFlags(x,C)};v.getStateFlag=function(x,C){return!!(this._view.state.get(x)&C)};v.grow=function(){const x=Math.max(1024,Math.floor(2*this._capacity)),C=this._layout.createBuffer(x);
if(this._buffer){const A=new Uint8Array(this._buffer.buffer);(new Uint8Array(C.buffer)).set(A)}this._capacity=x;this._buffer=C;this._view=new u(this._buffer)};v.findSlot=function(){const x=this._view.state;let C=this._next;for(;x.get(C)&a.StateFlags.ALLOCATED;)C=(C+1)%this._capacity;this._next=(C+1)%this._capacity;return C};p._createClass(k,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},
{key:"view",get:function(){return this._view}}]);return k}(b);const t=e.create(),h=q.create(),m=f.create(),n=f.create();a.InstanceData=b;a.InstanceDataView=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(a,p,b,r,q,y,
f){f=function(w){function e(g,d){var c=w.call(this,u=>q.wrap(c._instanceData.view.boundingSphere.getVec(u,c._tmpSphere)),{maximumDepth:25})||this;c._tmpSphere=q.create();c._tmpMat4=b.create();c._instanceData=g;c._boundingSphere=d;return c}p._inheritsLoose(e,w);var l=e.prototype;l.addInstance=function(g){const d=this._instanceData.view.boundingSphere,c=this._instanceData.getCombinedModelTransform(g,this._tmpMat4);r.transformMat4(this._tmpSphere,this._boundingSphere.center,c);this._tmpSphere[3]=this._boundingSphere.radius*
y.maxScale(c);d.setVec(g,this._tmpSphere);this.add([g])};l.removeInstance=function(g){this.remove([g])};return e}(f);a.InstanceOctree=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../Camera"],function(a,p){let b=function(){function r(y,f){this.thresholdScale=1;this._camera=new p;this._worldSpaceRadius=y;this._thresholds=f.map(w=>w)}var q=r.prototype;q.updateCamera=function(y){this._camera.copyFrom(y)};
q.selectLevel=function(y,f){y=this._camera.computeScreenPixelSizeAt(y);f=this._worldSpaceRadius*f/y;y=this._thresholds;let w=-1;for(let e=0;e<y.length;++e)f>=y[e]*this.thresholdScale&&(w=e);return w};return r}();a.LevelSelector=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(a,p,b,r,q,y){let f=function(){function w(l,g){this.minScreenSpaceRadius=l;this.components=g}w.create=function(){var l=p._asyncToGenerator(function*(g,d,c){const u=yield Promise.all(d.components.map(t=>g.schedule(()=>new y.LodComponentData(g,t),c)));return new w(d.minScreenSpaceRadius,u)});return function(g,d,c){return l.apply(this,arguments)}}();var e=w.prototype;e.destroy=function(){this.components.forEach(l=>{l.destroy()})};e.intersect=function(l,g,d,c,u,t){this.components.forEach(h=>{h.intersect(l,
g,d,c,u,t)})};p._createClass(w,[{key:"boundingBox",get:function(){if(!this._boundingBox){const l=q.empty();this.components.forEach(g=>{b.isSome(g.boundingInfo)&&(q.expandWithVec3(l,g.boundingInfo.bbMin),q.expandWithVec3(l,g.boundingInfo.bbMax))});this._boundingBox=l}return this._boundingBox}},{key:"boundingSphere",get:function(){if(!this._boundingSphere){const l=this.boundingBox,g=r.create();q.center(l,g);this._boundingSphere={center:g,radius:.5*q.diameter(l)}}return this._boundingSphere}},{key:"triangleCount",
get:function(){return this.components.reduce((l,g)=>l+g.triangleCount,0)}}]);return w}();a.LodLevel=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../intersectorUtils ../../materials/renderers/utils ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),function(a,p,
b,r,q,y,f,w){let e=function(){function l(d,c){const u=d.renderContext.rctx,t=c.geometry;c=c.material;this.materialRep=d.materialRep;c.setParameterValues({instancedDoublePrecision:!0});d=c.createBufferWriter();const h=d.vertexBufferLayout,m=d.elementCount(t),n=d.allocate(m);d.write({},t,n,0);this.geometry=t;this.material=c;this.glMaterials=y.acquireMaterials(c,this.materialRep);this.vertexBufferLayout=h;this.vbo=f.createVertex(u,35044,n.buffer);this.vao=new w(u,r.Default3D,{geometry:b.glLayout(h)},
{geometry:this.vbo});this.vertexCount=m}var g=l.prototype;g.destroy=function(){y.releaseMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};g.intersect=function(d,c,u,t,h,m){const n=this.geometry.id,z=h.toString();this.material.intersect(this.geometry,null,d.transform.transform,d,u,t,(k,v,x,C)=>{if(0<=k&&(null==c||c(d.rayBeginPoint,d.rayEndPoint,k))){var A={type:"external",metadata:{layerUid:m.layerUid,graphicUid:m.graphicUid(h)}};if(null==d.results.min.drapedLayerOrder||
C>=d.results.min.drapedLayerOrder)if(null==d.results.min.dist||k<d.results.min.dist)d.results.min.set(A,z,k,v,d.transform.transform,C,null,n,x),d.results.min.intersector="LodRenderer";0!==d.options.store&&(null==d.results.max.drapedLayerOrder||C>=d.results.max.drapedLayerOrder)&&(null==d.results.max.dist||k>d.results.max.dist)&&(d.results.max.set(A,z,k,v,d.transform.transform,C,null,n,x),d.results.min.intersector="LodRenderer");if(2===d.options.store){const B=new q.IntersectorResult(d.results.min.ray);
B.set(A,z,k,v,d.transform.transform,C,null,n,x);B.intersector="LodRenderer";d.results.all.push(B)}}})};p._createClass(l,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return l}();a.LodComponentData=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../geometry/support/buffer/BufferView",
"../Util","./BackedBufferObject"],function(a,p,b,r,q){let y=function(w){this.modelOriginHi=w.getField("modelOriginHi",b.BufferViewVec3f);this.modelOriginLo=w.getField("modelOriginLo",b.BufferViewVec3f);this.model=w.getField("model",b.BufferViewMat3f);this.modelNormal=w.getField("modelNormal",b.BufferViewMat3f);this.color=w.getField("instanceColor",b.BufferViewVec4f);this.featureAttribute=w.getField("instanceFeatureAttribute",b.BufferViewVec4f)},f=function(){function w(l,g){this._tailIndex=this._headIndex=
0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=l;this._instanceBufferLayout=g;this._elementSize=g.stride;this._capacity=1}var e=w.prototype;e.destroy=function(){this._buffer&&this._buffer.destroy()};e.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};e.startUpdateCylce=function(){this._captureFirstIndex=!0};e.beginUpdate=function(){r.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};
e.endUpdate=function(){r.assert(this._updating,"not updating");this.size<.3*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};e.allocateHead=function(){r.assert(this._updating,"not updating");this.isFull&&this.grow();const l=this.headIndex;this._captureFirstIndex&&(this._firstIndex=l,this._captureFirstIndex=!1);this.incrementHead();r.assert(this._headIndex!==this._tailIndex,"invalid pointers");
return l};e.freeTail=function(){r.assert(this._updating,"not updating");r.assert(0<this.size,"invalid size");const l=this._tailIndex===this._firstIndex;this.incrementTail();l&&(this._firstIndex=this._tailIndex)};e.grow=function(){this.resize(Math.max(1024,Math.floor(2*this._capacity)))};e.shrink=function(){this.resize(Math.max(1024,Math.floor(.5*this._capacity)))};e.resize=function(l){r.assert(this._updating,"not updating");if(l!==this._capacity){var g=new q(this._rctx,this._elementSize,l);if(this._buffer){this._firstIndex&&
(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const d=this.size,c=this.compactInstances(g);r.assert(c===d,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=c;this._prevHeadIndex=0}this._resized=!0;this._capacity=l;this._buffer=g;this._view=new y(this._instanceBufferLayout.createView(this._buffer.array))}};e.compactInstances=function(l){const g=this._headIndex,d=this._tailIndex;return d<g?(this._buffer.copyRange(d,g,l),g-d):d>g?(this._buffer.copyRange(d,
this._capacity,l),0<g&&this._buffer.copyRange(0,g,l,this._capacity-d),g+(this._capacity-d)):0};e.incrementHead=function(l=1){this._headIndex=(this._headIndex+l)%this._capacity};e.incrementTail=function(l=1){this._tailIndex=(this._tailIndex+l)%this._capacity};e.transferRange=function(l,g){l<g?this._buffer.transferRange(l,g):l>g&&(0<g&&this._buffer.transferRange(0,g),this._buffer.transferRange(l,this._capacity))};p._createClass(w,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",
get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const l=this._headIndex,g=this._tailIndex;return l>=g?l-g:l+this._capacity-g}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},
{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return w}();a.RenderInstanceData=f;a.RenderInstanceDataView=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../webgl/BufferObject"],function(a,p){return function(){function b(q,y,f){this._elementSize=y;this._buffer=p.createVertex(q,35044);this.resize(f)}
var r=b.prototype;r.destroy=function(){this._buffer.dispose()};r.copyRange=function(q,y,f,w=0){q=new Uint8Array(this.array,q*this.elementSize,(y-q)*this.elementSize);(new Uint8Array(f.array,w*this.elementSize)).set(q)};r.transferAll=function(){this._buffer.setData(this._array)};r.transferRange=function(q,y){q*=this._elementSize;this._buffer.setSubData(this._array,q,q,y*this._elementSize)};r.resize=function(q){const y=q*this._elementSize,f=new ArrayBuffer(y);this._array&&(q>=this._capacity?(new Uint8Array(f)).set(new Uint8Array(this._array)):
(new Uint8Array(f)).set((new Uint8Array(this._array)).subarray(0,q*this._elementSize)));this._array=f;this._buffer.setData(y);this._capacity=q};a._createClass(b,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return b}()})},
"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat2 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B){function D(N,R,S){switch(R){case "world":for(const P of N.vertices)e.add(I,P.pos,N.offset),S.worldUpAtPosition(I,O),P.setFrameFromUpVector(O),P.computeRotationAxisAndAngleFromUpVector();break;case "path":e.add(I,N.vertices[0].pos,N.offset);S.worldUpAtPosition(I,O);C.computeMinimumRotationTangentFrame(N,O);for(const P of N.vertices)N=r.sign(e.dot(P.frame.right,P.vRight)),e.cross(P.rotationFrame.up,P.vRight,P.vLeft),e.scale(P.rotationFrame.up,
P.rotationFrame.up,N),e.normalize(P.rotationFrame.up,P.rotationFrame.up),R=e.dot(P.rotationFrame.up,P.frame.up),S=e.dot(P.rotationFrame.up,P.frame.right),e.scale(I,P.frame.up,-S),e.scale(F,P.frame.right,R),e.add(I,I,F),e.normalize(P.rotationFrame.right,I),C.vertexSpaceToProfileSpace(P.rotationRight,P.frame,P.rotationFrame.right),e.negate(I,P.vLeft),P.rotationAngle=-N*(Math.PI-r.acosClamped(e.dot(I,P.vRight))),0<Math.abs(P.rotationAngle)&&(N=r.reciprocalClamped(Math.cos(.5*P.rotationAngle)),y.set(P.miterStretch,
1+(N-1)*P.rotationRight[0]*P.rotationRight[0],(N-1)*P.rotationRight[0]*P.rotationRight[1],(N-1)*P.rotationRight[0]*P.rotationRight[1],1+(N-1)*P.rotationRight[1]*P.rotationRight[1])),P.maxStretchDistance=Math.abs(Math.min(P.vLeftLength,P.vRightLength)*r.reciprocalClamped(Math.cos(.5*(Math.PI-P.rotationAngle))))}}function E(N,R,S){switch(N){case "symbol-value":return S;case "proportional":return R;default:return N}}function G(N,R,S,P){N=N.stageObject;const Q=N.geometryRecords,V=Q.length;var ca=0;H.spatialReference=
P.spatialReference;for(let aa=0;aa<V;aa++){const W=Q[aa].geometry;if(!x.isPathGeometry(W))continue;const U=W.path,X=U.builder.path;J.spatialReference=W.geometrySR;{var ba=X;var Z=R,ha=S,fa=P;let T=0;for(const Y of ba.vertices){const ea=t.evaluateElevationAlignmentAtPoint(Y.posES,ha,Z,fa,L);T+=L.sampledElevation;e.add(O,Y.pos,ba.offset);fa.setAltitude(O,ea);e.subtract(Y.pos,O,ba.offset)}ba.updatePathVertexInformation();ba=T/ba.vertices.length}ca+=ba;"world"!==W.upVectorAlignment&&D(X,W.upVectorAlignment,
P);U.onPathChanged();W.invalidateBoundingInfo();N.geometryVertexAttrsUpdated(aa)}return ca/V}const K=["polyline"];let M=function(N){function R(P,Q,V,ca){P=N.call(this,P,Q,V,ca)||this;P._intrinsicSize=w.fromValues(1,1);P.upVectorAlignment="path";P.stencilWidth=.1;P.ensureDrapedStatus(!1);return P}p._inheritsLoose(R,N);var S=R.prototype;S.doLoad=function(){var P=p._asyncToGenerator(function*(){const Q=q.isSome(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,V=q.isSome(this.symbolLayer.height)?
this.symbolLayer.height:Q;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[Q,1,V],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?k.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};var ca=this.symbolLayer.anchor||
"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");var ba=this.symbolLayer.profile||"circle";switch(ba){default:this._profile=C.Profile.circle(10);break;case "quad":this._profile=C.Profile.rect()}var Z=[0,0];"center"!==ca&&(Z={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[ca],this._profile.translate(Z[0],Z[1]));switch(this.symbolLayer.join||"simple"){case "round":this._extruder=new C.MiterExtruder(0,3);break;case "bevel":this._extruder=
new C.MiterExtruder(0,1);break;case "miter":this._extruder=new C.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new C.SimpleExtruder}ca=this.symbolLayer.cap||"butt";switch(ca){case "none":this._startCap=new C.NoCapBuilder;this._endCap=new C.NoCapBuilder;break;default:this._startCap=new C.TriangulationCapBuilder(this._profile,0);this._endCap=new C.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new C.TriangulationCapBuilder(this._profile,-.5);this._endCap=new C.TriangulationCapBuilder(this._profile,
.5,!0);break;case "round":ba="quad"===ba?!0:!1,this._startCap=new C.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:ba,subdivisions:3}),this._endCap=new C.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:ba,subdivisions:3})}ba=q.get(this.symbolLayer,"material","color");Z=this._getCombinedOpacityAndColor(ba);ba=g.fromArray(Z);Z=Z[3];const ha=1>Z||this.needsDrivenTransparentPass;ca={diffuse:ba,ambient:ba,opacity:Z,transparent:ha,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows,cullFace:ha||"none"===ca?0:2,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(f.set(this._intrinsicSize,Q,V),!z.isValidSize(this._intrinsicSize[0])||!z.isValidSize(this._intrinsicSize[1])))throw new b("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||f.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);
this._fastUpdates.enabled?(Object.assign(ca,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new B.PathMaterial(ca)):(ca.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new A.DefaultMaterial(ca));this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(this._material)});return function(){return P.apply(this,arguments)}}();S.destroy=
function(){N.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};S.createGraphics3DGraphic=function(P){const Q=P.graphic;if(!this._validateGeometry(Q.geometry,K,this.symbolLayer.type))return null;const V=this.setGraphicElevationContext(Q,new h.ElevationContext);return this._createAs3DShape(Q,P.renderingInfo,V,Q.uid)};S.layerOpacityChanged=function(){var P=q.get(this.symbolLayer,"material","color");P=this._getCombinedOpacity(P);this._material.setParameterValues({opacity:P,
transparent:1>P||this.needsDrivenTransparentPass});return!0};S.layerElevationInfoChanged=function(P,Q){return this.updateGraphics3DGraphicElevationInfo(P,Q,t.needsElevationUpdates3D)};S.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};S.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};S.pixelRatioChanged=function(){return!0};
S.applyRendererDiff=function(P,Q){for(const V in P.diff)switch(V){case "visualVariables":if(k.updateFastSymbolUpdatesState(this._fastUpdates,Q,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};S.getVertexData=function(P){let Q=0;const V=P.paths,ca=[],ba=P.spatialReference,Z=this._context.elevationProvider.spatialReference,ha=this._context.renderCoordsHelper.spatialReference;for(var fa of V)Q+=fa.length;fa=
new Float64Array(3*Q);const aa=new Float64Array(3*Q),W=new Float64Array(3*Q);let U=0;for(const X of V){ca.push({index:U,numVertices:X.length});for(const T of X)fa[U++]=T[0],fa[U++]=T[1],fa[U++]=P.hasZ?T[2]:0}P=!0;ba.equals(Z)?this._copyVertices(fa,0,aa,0,Q):P=d.projectBuffer(fa,ba,0,aa,Z,0,Q);Z.equals(ha)?this._copyVertices(aa,0,W,0,Q):d.projectBuffer(aa,Z,0,W,ha,0,Q);return{pathVertexDataInfos:ca,vertexDataGS:fa,vertexDataES:aa,vertexDataRS:W,projectionSuccess:P,terrainElevation:0}};S._copyVertices=
function(P,Q,V,ca,ba){Q*=3;ca*=3;for(let Z=0;Z<ba;++Z)V[ca++]=P[Q++],V[ca++]=P[Q++],V[ca++]=P[Q++]};S._createAs3DShape=function(P,Q,V,ca){var ba=P.geometry,Z=[];const ha=[],fa=[],aa=ba.spatialReference,W=c.create(),U=this._context.renderCoordsHelper;J.spatialReference=aa;const X=this.getVertexData(ba);if(!X.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0<X.pathVertexDataInfos.length){for(ba=
0;ba<X.pathVertexDataInfos.length;++ba){var T=X.pathVertexDataInfos[ba],Y=T.index;T=T.numVertices;if(2>T)continue;if(q.isSome(this._context.clippingExtent)&&(c.empty(W),c.expandWithBuffer(W,X.vertexDataES,3*Y,T),!c.intersectsClippingArea(W,this._context.clippingExtent)))continue;var ea=[];for(var ia=Y;ia<Y+3*T;){const ua=ia++,wa=ia++,Fa=ia++,La=new C.PathVertex;e.set(La.posGS,X.vertexDataGS[ua],X.vertexDataGS[wa],X.vertexDataGS[Fa]);e.set(La.posES,X.vertexDataES[ua],X.vertexDataES[wa],X.vertexDataES[Fa]);
const Ma=t.evaluateElevationAlignmentAtPoint(La.posES,this._context.elevationProvider,V,U,null);e.set(O,X.vertexDataRS[ua],X.vertexDataRS[wa],X.vertexDataRS[Fa]);U.setAltitude(O,Ma);e.set(La.pos,O[0],O[1],O[2]);ea.push(La)}Y=new C.Path(ea);D(Y,this.upVectorAlignment,this._context.renderCoordsHelper);Y=new C.Builder(Y,this._profile,this._extruder,this._startCap,this._endCap);T=null;this._fastUpdates.enabled?(ia=this._fastUpdates.visualVariables,T=ia.size?n.getAttributeValue(ia.size.field,P):0,ea=ia.color?
n.getAttributeValue(ia.color.field,P):0,ia=ia.opacity?n.getAttributeValue(ia.opacity.field,P):0,T=new C.FastUpdatePathGeometry(Y,T,ea,ia)):(T=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(T[0]*=E(Q.size[0],"symbol-value"===Q.size[2]?this.symbolLayer.height||0:Q.size[2],this.symbolLayer.width||0),T[1]*=E(Q.size[2],"symbol-value"===Q.size[0]?this.symbolLayer.width||0:Q.size[0],this.symbolLayer.height||0)),ea=null,this._drivenProperties.color&&(ea=Q.color),this._drivenProperties.opacity&&
null!=Q.opacity&&(ea=ea?[ea[0],ea[1],ea[2],Q.opacity]:[1,1,1,Q.opacity]),Y=new C.StaticPathGeometry(Y),Y.bake(T),ea&&Y.bakeVertexColors(ea),T=Y);const {vertexAttributes:la,indices:pa}=T.createGeometryData();Y=new x.PathGeometry(la,pa,T,aa,this.upVectorAlignment,this.stencilWidth);Z.push(Y);ha.push(this._material);fa.push(T.xform)}if(0<Z.length)return P=new v.Object3D({geometries:Z,materials:ha,transformations:fa,metadata:{layerUid:this._context.layer.uid,graphicUid:ca}}),Z=new m.Graphics3DObject3DGraphicLayer(this,
P,Z,null,null,G,V),Z.alignedSampledElevation=X.terrainElevation,Z.needsElevationUpdates=t.needsElevationUpdates3D(V.mode),Z}else 0!==ba.paths.length&&ba.paths.some(la=>0<la.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};return R}(n.Graphics3DSymbolLayer);const H=u.makeDehydratedPoint(0,0,0,null),J=u.makeDehydratedPoint(0,0,0,null),O=g.create(),I=l.create(),F=l.create(),L={verticalDistanceToGround:0,sampledElevation:0};a.Graphics3DPathSymbolLayer=
M;a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.NUM_ROUND_JOIN_SUBDIVISIONS=3;a["default"]=M;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,p){function b(B,D){B[0]=D[0];B[1]=D[1];B[2]=D[2];B[3]=D[3];return B}function r(B){B[0]=1;B[1]=0;B[2]=0;B[3]=1;return B}function q(B,D,E,G,K){B[0]=D;B[1]=E;B[2]=G;B[3]=K;return B}function y(B,D){if(B===D){const E=D[1];B[1]=D[2];B[2]=E}else B[0]=D[0],B[1]=
D[2],B[2]=D[1],B[3]=D[3];return B}function f(B,D){const E=D[0],G=D[1],K=D[2];D=D[3];let M=E*D-K*G;if(!M)return null;M=1/M;B[0]=D*M;B[1]=-G*M;B[2]=-K*M;B[3]=E*M;return B}function w(B,D){const E=D[0];B[0]=D[3];B[1]=-D[1];B[2]=-D[2];B[3]=E;return B}function e(B){return B[0]*B[3]-B[2]*B[1]}function l(B,D,E){const G=D[0],K=D[1],M=D[2];D=D[3];const H=E[0],J=E[1],O=E[2];E=E[3];B[0]=G*H+M*J;B[1]=K*H+D*J;B[2]=G*O+M*E;B[3]=K*O+D*E;return B}function g(B,D,E){const G=D[0],K=D[1],M=D[2];D=D[3];const H=Math.sin(E);
E=Math.cos(E);B[0]=G*E+M*H;B[1]=K*E+D*H;B[2]=G*-H+M*E;B[3]=K*-H+D*E;return B}function d(B,D,E){const G=D[1],K=D[2],M=D[3],H=E[0];E=E[1];B[0]=D[0]*H;B[1]=G*H;B[2]=K*E;B[3]=M*E;return B}function c(B,D){const E=Math.sin(D);D=Math.cos(D);B[0]=D;B[1]=E;B[2]=-E;B[3]=D;return B}function u(B,D){B[0]=D[0];B[1]=0;B[2]=0;B[3]=D[1];return B}function t(B){return"mat2("+B[0]+", "+B[1]+", "+B[2]+", "+B[3]+")"}function h(B){return Math.sqrt(B[0]**2+B[1]**2+B[2]**2+B[3]**2)}function m(B,D,E,G){B[2]=G[2]/G[0];E[0]=
G[0];E[1]=G[1];E[3]=G[3]-B[2]*E[1];return[B,D,E]}function n(B,D,E){B[0]=D[0]+E[0];B[1]=D[1]+E[1];B[2]=D[2]+E[2];B[3]=D[3]+E[3];return B}function z(B,D,E){B[0]=D[0]-E[0];B[1]=D[1]-E[1];B[2]=D[2]-E[2];B[3]=D[3]-E[3];return B}function k(B,D){return B[0]===D[0]&&B[1]===D[1]&&B[2]===D[2]&&B[3]===D[3]}function v(B,D){const E=B[0],G=B[1],K=B[2];B=B[3];const M=D[0],H=D[1],J=D[2];D=D[3];return Math.abs(E-M)<=p.EPSILON*Math.max(1,Math.abs(E),Math.abs(M))&&Math.abs(G-H)<=p.EPSILON*Math.max(1,Math.abs(G),Math.abs(H))&&
Math.abs(K-J)<=p.EPSILON*Math.max(1,Math.abs(K),Math.abs(J))&&Math.abs(B-D)<=p.EPSILON*Math.max(1,Math.abs(B),Math.abs(D))}function x(B,D,E){B[0]=D[0]*E;B[1]=D[1]*E;B[2]=D[2]*E;B[3]=D[3]*E;return B}function C(B,D,E,G){B[0]=D[0]+E[0]*G;B[1]=D[1]+E[1]*G;B[2]=D[2]+E[2]*G;B[3]=D[3]+E[3]*G;return B}var A=Object.freeze({__proto__:null,copy:b,identity:r,set:q,transpose:y,invert:f,adjoint:w,determinant:e,multiply:l,rotate:g,scale:d,fromRotation:c,fromScaling:u,str:t,frob:h,LDU:m,add:n,subtract:z,exactEquals:k,
equals:v,multiplyScalar:x,multiplyScalarAndAdd:C,mul:l,sub:z});a.LDU=m;a.add=n;a.adjoint=w;a.copy=b;a.determinant=e;a.equals=v;a.exactEquals=k;a.frob=h;a.fromRotation=c;a.fromScaling=u;a.identity=r;a.invert=f;a.mat2=A;a.mul=l;a.multiply=l;a.multiplyScalar=x;a.multiplyScalarAndAdd=C;a.rotate=g;a.scale=d;a.set=q;a.str=t;a.sub=z;a.subtract=z;a.transpose=y})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./Geometry"],function(a,
p,b){b=function(r){function q(y,f,w,e,l,g){y=r.call(this,y,f)||this;y.path=w;y.geometrySR=e;y.upVectorAlignment=l;y.stencilWidth=g;return y}p._inheritsLoose(q,r);return q}(b.Geometry);a.PathGeometry=b;a.isPathGeometry=function(r){return"upVectorAlignment"in r};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil ../materials/internal/MaterialUtil".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){function h(){return{up:g.create(),right:g.create()}}let m=function(){function V(){this.pos=g.create();this.posES=g.create();this.posGS=g.create();this.vRight=g.create();this.vLeft=g.create();this.frame=h();this.rotationFrame=h();this.rotationRight=e.create();this.rotationAngle=0;this.miterStretch=q.create()}var ca=V.prototype;ca.setFrameFromUpVector=function(ba){l.copy(this.frame.up,ba);l.add(L,this.vLeft,this.vRight);l.normalize(L,L);l.scale(F,this.frame.up,
l.dot(L,this.frame.up));l.subtract(S,L,F);l.normalize(S,S);l.cross(this.frame.right,S,this.frame.up)};ca.computeRotationAxisAndAngleFromUpVector=function(){l.copy(this.rotationFrame.up,this.frame.up);l.copy(this.rotationFrame.right,this.frame.right);w.set(this.rotationRight,1,0);l.scale(F,this.frame.up,l.dot(this.frame.up,this.vLeft));l.subtract(F,this.vLeft,F);l.negate(F,F);l.normalize(F,F);l.scale(L,this.frame.up,l.dot(this.frame.up,this.vRight));l.subtract(L,this.vRight,L);l.normalize(L,L);l.cross(N,
this.rotationFrame.up,this.vLeft);this.rotationAngle=b.sign(l.dot(N,this.vRight))*(Math.PI-b.acosClamped(l.dot(F,L)));if(0<Math.abs(this.rotationAngle)){const ba=b.reciprocalClamped(Math.cos(.5*this.rotationAngle));r.set(this.miterStretch,1+(ba-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return V}(),n=function(){function V(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=
[];this.uvIndices=this.uvs=null}var ca=V.prototype;ca.addVertex=function(ba,Z){this.vertices.push(e.clone(ba));this.vertexNormals.push(e.clone(Z));return this.vertices.length-1};ca.addUV=function(ba){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(ba);return this.uvs.length-1};ca.addPole=function(ba,Z=null){this.poles.push({position:e.clone(ba),normal:Z?e.clone(Z):null});return this.poles.length-1};ca.addSegment=function(ba,Z=null,ha=null){this.vertexIndices.push(ba.v0);this.vertexIndices.push(ba.v1);
Z&&(this.uvIndices.push(Z.v0),this.uvIndices.push(Z.v1));ha&&(this.poleIndices.push(ha.v0),this.poleIndices.push(ha.v1))};ca.hasUV=function(){return null!=this.uvs};ca.translate=function(ba,Z){for(const ha of this.vertices)ha[0]+=ba,ha[1]+=Z;for(const ha of this.poles)ha.position[0]+=ba,ha.position[1]+=Z};V.circle=function(ba=20){const Z=new V,ha={v0:0,v1:0};Z.addPole(e.fromValues(0,0));for(var fa=0;fa<ba;++fa){var aa=2*fa*Math.PI/ba,W=Math.cos(aa);const U=Math.sin(aa);aa=e.fromValues(.5*W,.5*U);
W=e.fromValues(W,U);Z.addVertex(aa,W);Z.addUV(fa/ba)}Z.addUV(1);for(fa=0;fa<ba-1;++fa)W={v0:fa,v1:fa+1},Z.addSegment(W,W,ha);Z.addSegment({v0:ba-1,v1:0},{v0:ba-1,v1:ba},ha);return Z};V.rect=function(){const ba=new V,Z=e.fromValues(-.5,-.5),ha=e.fromValues(.5,-.5),fa=e.fromValues(.5,.5),aa=e.fromValues(-.5,.5),W=e.fromValues(0,-1),U=e.fromValues(1,0),X=e.fromValues(0,1),T=e.fromValues(-1,0);ba.addUV(0);ba.addUV(1);ba.addPole(e.fromValues(0,.5),X);ba.addPole(e.fromValues(0,.5));ba.addPole(e.fromValues(0,
-.5));ba.addPole(e.fromValues(0,-.5),W);const Y={v0:0,v1:1};ba.addVertex(Z,W);ba.addVertex(ha,W);ba.addSegment({v0:0,v1:1},Y,{v0:3,v1:3});ba.addVertex(ha,U);ba.addVertex(fa,U);ba.addSegment({v0:2,v1:3},Y,{v0:2,v1:1});ba.addVertex(fa,X);ba.addVertex(aa,X);ba.addSegment({v0:4,v1:5},Y,{v0:0,v1:0});ba.addVertex(aa,T);ba.addVertex(Z,T);ba.addSegment({v0:6,v1:7},Y,{v0:1,v1:2});return ba};p._createClass(V,[{key:"numSegments",get:function(){return this.vertexIndices.length/2}}]);return V}(),z=function(){function V(ca){this.vertices=
[];this.offset=g.create();this.xform=f.create();this.vertices=ca;l.copy(this.offset,this.vertices[Math.floor((ca.length-1)/2)].pos);for(const ba of this.vertices)l.subtract(ba.pos,ba.pos,this.offset);y.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}V.prototype.updatePathVertexInformation=function(){const ca=this.vertices.length;let ba=this.vertices[0];ba.index=0;l.set(ba.vLeft,0,0,0);ba.vLeftLength=0;l.subtract(ba.vRight,this.vertices[1].pos,ba.pos);ba.vRightLength=
l.length(ba.vRight);l.normalize(ba.vRight,ba.vRight);let Z=ba;for(let ha=1;ha<ca;++ha)ba=this.vertices[ha],ba.index=ha,l.copy(ba.vLeft,Z.vRight),ba.vLeftLength=Z.vRightLength,ha<ca-1?(l.subtract(ba.vRight,this.vertices[ha+1].pos,ba.pos),ba.vRightLength=l.length(ba.vRight),l.normalize(ba.vRight,ba.vRight)):(l.copy(ba.vRight,ba.vLeft),ba.vRightLength=ba.vLeftLength),Z=ba};return V}(),k=function(){function V(){}var ca=V.prototype;ca.numProfilesPerJoin=function(){return 1};ca.extrude=function(ba,Z,ha){for(let fa=
0;fa<Z.vertices.length;++fa)ha(ba.index,ba.frame,Z.vertices[fa],Z.vertexNormals[fa],!1)};return V}(),v=function(){function V(ba=.8*Math.PI,Z=1){this.cutoffAngle=ba;this.numBendSubdivisions=Z}var ca=V.prototype;ca.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};ca.extrude=function(ba,Z,ha){var fa=P;if(Math.abs(ba.rotationAngle)>=this.cutoffAngle)for(var aa=0;aa<this.numBendSubdivisions+1;++aa){y.identity(Q);y.rotate(Q,Q,.5*-ba.rotationAngle+aa*ba.rotationAngle/this.numBendSubdivisions,
ba.rotationFrame.up);var W=fa,U=ba.frame,X=Q;l.transformMat4(W.up,U.up,X);l.transformMat4(W.right,U.right,X);for(W=0;W<Z.vertices.length;++W)0<=w.dot(Z.vertices[W],ba.rotationRight)*ba.rotationAngle?ha(ba.index,fa,Z.vertices[W],Z.vertexNormals[W],!1):(w.transformMat2(J,Z.vertices[W],ba.miterStretch),ha(ba.index,ba.frame,J,Z.vertexNormals[W],!0))}else for(fa=0;fa<this.numBendSubdivisions+1;++fa)for(aa=0;aa<Z.vertices.length;++aa)W=0<=w.dot(Z.vertices[aa],ba.rotationRight)*ba.rotationAngle,w.transformMat2(J,
Z.vertices[aa],ba.miterStretch),ha(ba.index,ba.frame,J,Z.vertexNormals[aa],W?!1:!0)};return V}();const x={generateUV:!1};let C=function(){function V(){}V.prototype.rebuildConnectingProfileGeometry=function(ca,ba,Z){for(let ha=0;ha<ba.vertices.length;++ha)Z(ca.index,ca.frame,ba.vertices[ha],ba.vertexNormals[ha],0,0)};return V}(),A=function(V){function ca(){return V.call(this)||this}p._inheritsLoose(ca,V);var ba=ca.prototype;ba.getNumVertices=function(){return 0};ba.getNumIndices=function(){return 0};
ba.rebuildCapGeometry=function(){};ba.buildTopology=function(){};return ca}(C),B=function(V){function ca(Z,ha=0,fa=!1){var aa=V.call(this)||this;aa.profile=Z;aa.profilePlaneOffset=ha;aa.flip=fa;return aa}p._inheritsLoose(ca,V);var ba=ca.prototype;ba.getNumVertices=function(){return this.profile.vertices.length};ba.getNumIndices=function(){return 3*this.profile.numSegments};ba.rebuildConnectingProfileGeometry=function(Z,ha,fa){for(let aa=0;aa<ha.vertices.length;++aa)fa(Z.index,Z.frame,ha.vertices[aa],
ha.vertexNormals[aa],this.profilePlaneOffset,0)};ba.rebuildCapGeometry=function(Z,ha){const fa=O;w.set(fa,0,0);const aa=this.flip?1:-1;for(let W=0;W<this.profile.vertices.length;++W)ha(Z.index,Z.frame,this.profile.vertices[W],fa,this.profilePlaneOffset,aa)};ba.buildTopology=function(Z,ha){Z=this.vertexBufferStart+this.profile.vertexIndices[0];for(let fa=1;fa<this.profile.numSegments;++fa){const aa=this.vertexBufferStart+this.profile.vertexIndices[2*fa],W=this.vertexBufferStart+this.profile.vertexIndices[2*
fa+1];this.flip?ha(W,aa,Z):ha(Z,aa,W)}};return ca}(C),D=function(V){function ca(Z){var ha=V.call(this)||this;ha.flip=!1;ha.sign=0;ha.breakNormals=!1;ha.numSegments=3;ha.profile=Z.profile;ha.flip=Z.flip;ha.sign=ha.flip?1:-1;ha.breakNormals=Z.breakNormals;ha.numSegments=Z.subdivisions;return ha}p._inheritsLoose(ca,V);var ba=ca.prototype;ba.getNumVertices=function(){let Z=0;Z=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(Z+=this.profile.vertices.length);return Z+=this.profile.poles.length};
ba.getNumIndices=function(){let Z;Z=2*this.profile.numSegments*(this.numSegments-1);for(let ha=0;ha<this.profile.numSegments;++ha)Z=this.profile.poleIndices[this.profile.vertexIndices[2*ha]]===this.profile.poleIndices[this.profile.vertexIndices[2*ha+1]]?Z+1:Z+2;return 3*Z};ba.rebuildCapGeometry=function(Z,ha){const fa=Z.frame,aa=.5*this.sign,W=J,U=O;w.set(U,0,0);for(var X=0;X<this.profile.poles.length;++X){var T=this.profile.poles[X];T.normal?ha(Z.index,fa,T.position,T.normal,aa,0):ha(Z.index,fa,
T.position,U,aa,this.sign)}if(this.breakNormals)for(X=0;X<this.profile.vertices.length;++X)ha(Z.index,fa,this.profile.vertices[X],this.profile.vertexNormals[X],0,0);for(X=0;X<this.numSegments-1;++X){var Y=(1-(X+1)/this.numSegments)*Math.PI*.5;T=Math.sin(Y);Y=Math.cos(Y);for(let ea=0;ea<this.profile.vertices.length;++ea){const ia=this.profile.poles[this.profile.poleIndices[ea]];w.subtract(W,this.profile.vertices[ea],ia.position);w.scale(W,W,T);ia.normal?(w.add(W,W,ia.position),ha(Z.index,fa,W,ia.normal,
aa*Y,0)):(w.normalize(U,W),w.scale(U,U,T),w.add(W,W,ia.position),ha(Z.index,fa,W,U,aa*Y,this.sign*Y))}}};ba.buildTopology=function(Z,ha){Z=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;const fa=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let aa=0;aa<this.profile.numSegments;++aa){const W=this.profile.vertexIndices[2*aa],U=this.profile.vertexIndices[2*
aa+1],X=this.vertexBufferStart+this.profile.poleIndices[W],T=this.vertexBufferStart+this.profile.poleIndices[U];let Y=Z+W,ea=Z+U;for(let ia=0;ia<this.numSegments-1;++ia){const la=fa+ia*this.profile.vertices.length+W,pa=fa+ia*this.profile.vertices.length+U;this.flip?(ha(la,ea,Y),ha(ea,la,pa)):(ha(Y,ea,la),ha(pa,la,ea));Y=la;ea=pa}this.flip?(ha(X,ea,Y),X!==T&&ha(X,T,ea)):(ha(Y,ea,X),X!==T&&ha(ea,T,X))}};return ca}(C),E=function(){function V(ba,Z,ha,fa,aa,W=x){this.options=W;this.numUVTotal=this.numNormalsTotal=
this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=Z;this.path=ba;this.extruder=ha;this.startCap=fa;this.endCap=aa;ba=this.path.vertices.length-2;this.numExtrusionProfiles=ha.numProfilesPerJoin()*ba+2;this.numNormalsTotal=this.numVerticesTotal=Z.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;Z=this.startCap.getNumVertices();this.numVerticesTotal+=Z;this.numNormalsTotal+=Z;this.endCap.vertexBufferStart=
this.numVerticesTotal;Z=this.endCap.getNumVertices();this.numVerticesTotal+=Z;this.numNormalsTotal+=Z;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));
this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}var ca=V.prototype;ca.emitVertex=function(ba,Z,ha,fa,aa){this.profileRightAxisData[4*this._extrusionVertexCount]=Z.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=Z.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=Z.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=Z.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=Z.up[1];this.profileUpAxisData[4*
this._extrusionVertexCount+2]=Z.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=ha[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=ha[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=fa[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=fa[1];this.pathVertexData[this._extrusionVertexCount]=ba;aa?(ba=this.path.vertices[ba],this.profileRightAxisData[4*this._extrusionVertexCount+3]=ba.rotationRight[0]*ba.maxStretchDistance,this.profileUpAxisData[4*
this._extrusionVertexCount+3]=ba.rotationRight[1]*ba.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};ca.emitCapVertex=function(ba,Z,ha,fa,aa,W){this.profileRightAxisData[4*this._extrusionVertexCount]=Z.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=Z.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=Z.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=
Z.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=Z.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=Z.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=ha[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=ha[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=fa[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=fa[1];this.pathVertexData[this._extrusionVertexCount]=ba;this.profileRightAxisData[4*this._extrusionVertexCount+
3]=aa;this.profileUpAxisData[4*this._extrusionVertexCount+3]=W;++this._extrusionVertexCount};ca.emitTriangle=function(ba,Z,ha){this.vertexIndices[3*this._triangleCount]=ba;this.vertexIndices[3*this._triangleCount+1]=Z;this.vertexIndices[3*this._triangleCount+2]=ha;this.pathVertexIndices[3*this._triangleCount]=this.pathVertexData[ba];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[Z];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[ha];this.normalIndices[3*this._triangleCount]=
ba;this.normalIndices[3*this._triangleCount+1]=Z;this.normalIndices[3*this._triangleCount+2]=ha;++this._triangleCount};ca.rebuildGeometry=function(){var ba=(fa,aa,W,U,X)=>this.emitVertex(fa,aa,W,U,X);const Z=(fa,aa,W,U,X,T)=>this.emitCapVertex(fa,aa,W,U,X,T);this._extrusionVertexCount=0;for(var ha of this.path.vertices)this.originData[3*ha.index]=ha.pos[0],this.originData[3*ha.index+1]=ha.pos[1],this.originData[3*ha.index+2]=ha.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],
this.profile,Z);for(ha=1;ha<this.path.vertices.length-1;++ha)this.extruder.extrude(this.path.vertices[ha],this.profile,ba);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,Z);this.startCap.rebuildCapGeometry(this.path.vertices[0],Z);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],Z);if(this.profile.hasUV()&&this.options.generateUV)for(ba=0;ba<this.profile.uvs.length;++ba)this.uvData[2*ba]=this.profile.uvs[ba],
this.uvData[2*ba+1]=0};ca.buildTopology=function(){const ba=(W,U,X)=>this.emitTriangle(W,U,X);this._triangleCount=0;const Z=this.profile.vertices.length,ha=this.profile.numSegments,fa=this.numExtrusionProfiles-1;var aa=ha*fa*6;this.startCap.indexBufferStart=aa;this.startCap.firstProfileVertexIndex=0;aa+=this.startCap.getNumIndices();this.endCap.indexBufferStart=aa;this.endCap.firstProfileVertexIndex=Z*(this.numExtrusionProfiles-1);aa+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(aa);
this.normalIndices=new Uint32Array(aa);this.pathVertexIndices=new Uint32Array(aa);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(aa));for(aa=0;aa<ha;++aa){const W=this.profile.vertexIndices[2*aa],U=this.profile.vertexIndices[2*aa+1];for(let X=0;X<fa;++X){const T=X*Z+W,Y=(X+1)*Z+U,ea=X*Z+U;ba(T,(X+1)*Z+W,Y);ba(T,Y,ea)}}this.startCap.buildTopology(this.path.vertices[0],ba);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],ba)};ca.onPathChanged=
function(){this.rebuildGeometry()};return V}(),G=function(){function V(ca){this.builder=ca}V.prototype.onPathChanged=function(){this.builder.onPathChanged()};p._createClass(V,[{key:"xform",get:function(){return this.builder.path.xform}}]);return V}(),K=function(V){function ca(Z){Z=V.call(this,Z)||this;Z.vertexAttributePosition=null;Z.vertexAttributeNormal=null;Z.vertexAttributeColor=null;Z.vertexAttributePosition=new Float32Array(3*Z.builder.numVerticesTotal);Z.vertexAttributeNormal=new Float32Array(3*
Z.builder.numNormalsTotal);Z.vertexAttributeColor=new Uint8Array(4);Z.vertexAttributeColor[0]=255;Z.vertexAttributeColor[1]=255;Z.vertexAttributeColor[2]=255;Z.vertexAttributeColor[3]=255;return Z}p._inheritsLoose(ca,V);var ba=ca.prototype;ba.bakeVertexColors=function(Z){this.vertexAttributeColor[0]=255*Z[0];this.vertexAttributeColor[1]=255*Z[1];this.vertexAttributeColor[2]=255*Z[2];this.vertexAttributeColor[3]=255*(3<Z.length?Z[3]:1)};ba.bake=function(Z){this.size=Z;for(let W=0;W<this.builder.numVerticesTotal;++W){var ha=
this.builder.pathVertexData[W],fa=0===ha||ha===this.builder.path.vertices.length-1;ha*=3;var aa=H;l.set(aa,this.builder.originData[ha++],this.builder.originData[ha++],this.builder.originData[ha]);ha=4*W;const U=F,X=J,T=L,Y=N,ea=R;let ia=0,la=0;l.set(Y,this.builder.profileRightAxisData[ha],this.builder.profileRightAxisData[ha+1],this.builder.profileRightAxisData[ha+2]);l.set(ea,this.builder.profileUpAxisData[ha],this.builder.profileUpAxisData[ha+1],this.builder.profileUpAxisData[ha+2]);w.set(X,this.builder.profileVertexAndNormalData[ha]*
Z[0],this.builder.profileVertexAndNormalData[ha+1]*Z[1]);if(fa)l.cross(T,ea,Y),ia=this.builder.profileRightAxisData[ha+3]*Z[0],la=this.builder.profileUpAxisData[ha+3];else{fa=O;const pa=I;w.set(fa,this.builder.profileRightAxisData[ha+3],this.builder.profileUpAxisData[ha+3]);const ua=w.length(fa);w.normalize(fa,fa);const wa=w.dot(X,fa);if(Math.abs(wa)>ua){w.set(pa,-fa[1],fa[0]);const Fa=w.dot(X,pa);w.scale(fa,fa,ua*b.sign(wa));w.scale(pa,pa,Fa);w.add(X,fa,pa)}l.set(T,0,0,0)}l.set(U,Y[0]*X[0]+ea[0]*
X[1],Y[1]*X[0]+ea[1]*X[1],Y[2]*X[0]+ea[2]*X[1]);this.vertexAttributePosition[3*W]=aa[0]+U[0]+T[0]*ia;this.vertexAttributePosition[3*W+1]=aa[1]+U[1]+T[1]*ia;this.vertexAttributePosition[3*W+2]=aa[2]+U[2]+T[2]*ia;aa=J;w.set(aa,this.builder.profileVertexAndNormalData[ha+2],this.builder.profileVertexAndNormalData[ha+3]);this.vertexAttributeNormal[3*W]=Y[0]*aa[0]+ea[0]*aa[1]+T[0]*la;this.vertexAttributeNormal[3*W+1]=Y[1]*aa[0]+ea[1]*aa[1]+T[1]*la;this.vertexAttributeNormal[3*W+2]=Y[2]*aa[0]+ea[2]*aa[1]+
T[2]*la}};ba.createGeometryData=function(){const Z=[["position",this.builder.vertexIndices],["normal",this.builder.normalIndices]],ha=[["position",{size:3,data:this.vertexAttributePosition,exclusive:!0}],["normal",{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];this.vertexAttributeColor&&(Z.push(["color",new Uint32Array(this.builder.vertexIndices.length)]),ha.push(["color",{size:4,data:this.vertexAttributeColor}]));return{vertexAttributes:ha,indices:Z}};ba.onPathChanged=function(){V.prototype.onPathChanged.call(this);
this.bake(this.size)};ba.intersect=function(Z,ha,fa){const aa=this.builder.vertexIndices;t.intersectTriangles(Z,ha,0,aa.length/3,aa,{size:3,data:this.vertexAttributePosition},void 0,void 0,fa)};return ca}(G),M=function(V){function ca(ba,Z,ha,fa){var aa=V.call(this,ba)||this;aa.sizeAttributeValue=Z;aa.colorAttributeValue=ha;aa.opacityAttributeValue=fa;aa.vvData=null;aa.baked=new K(ba);aa.vvData=new Float32Array(4*aa.builder.path.vertices.length);for(ba=0;ba<aa.builder.path.vertices.length;++ba)aa.vvData[4*
ba]=Z,aa.vvData[4*ba+1]=ha,aa.vvData[4*ba+2]=fa,aa.vvData[4*ba+3]=0===ba||ba===aa.builder.path.vertices.length-1?1:0;return aa}p._inheritsLoose(ca,V);ca.prototype.createGeometryData=function(){return{vertexAttributes:[["position",{size:3,data:this.builder.originData,exclusive:!0}],["profileRight",{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],["profileUp",{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],["profileVertexAndNormal",{size:4,data:this.builder.profileVertexAndNormalData,
exclusive:!0}],["featureValue",{size:4,data:this.vvData,exclusive:!0}]],indices:[["position",this.builder.pathVertexIndices],["profileRight",this.builder.vertexIndices],["profileUp",this.builder.vertexIndices],["profileVertexAndNormal",this.builder.vertexIndices],["featureValue",this.builder.pathVertexIndices]]}};return ca}(G);const H=g.create(),J=e.create(),O=e.create(),I=e.create(),F=g.create(),L=g.create(),N=g.create(),R=g.create(),S=g.create(),P=h(),Q=f.create();a.Builder=E;a.CapBuilder=C;a.Extruder=
function(){};a.FastUpdatePathGeometry=M;a.MiterExtruder=v;a.NoCapBuilder=A;a.Path=z;a.PathGeometryData=G;a.PathVertex=m;a.Profile=n;a.RoundCapBuilder=D;a.SimpleExtruder=k;a.StaticPathGeometry=K;a.TriangulationCapBuilder=B;a.computeMinimumRotationTangentFrame=function(V,ca){let ba=null;const Z=V.vertices.length,ha=g.create(),fa=g.create(),aa=g.create(),W=g.create(),U=g.create(),X=g.create(),T=d.create();let Y=V.vertices[0];l.copy(fa,ca);l.set(ha,0,1,0);u.makeOrthoBasisDirUpFallback(Y.vRight,fa,ha,
ha,aa,fa,.99619469809);l.copy(Y.frame.up,fa);l.copy(Y.frame.right,aa);ba=Y;for(ca=1;ca<Z;++ca){Y=V.vertices[ca];l.add(U,Y.vLeft,Y.vRight);let ea=l.length(U);0<ea?(ea=1/Math.sqrt(ea),U[0]*=ea,U[1]*=ea,U[2]*=ea):(U[0]=Y.vRight[0],U[1]=Y.vRight[1],U[2]=Y.vRight[2]);l.add(X,ba.pos,ba.frame.up);d.fromPositionAndNormal(Y.pos,U,T);d.intersectRay(T,c.wrap(X,Y.vLeft),W)?(l.subtract(W,W,Y.pos),l.normalize(fa,W),l.cross(aa,U,fa),l.normalize(aa,aa)):u.makeOrthoBasisDirUpFallback(U,ba.frame.up,ba.frame.right,
ha,aa,fa,.99619469809);l.copy(Y.frame.up,fa);l.copy(Y.frame.right,aa);ba=Y}};a.makeFrame=h;a.profileSpaceToVertexSpace=function(V,ca,ba){V[0]=ba[0]*ca.right[0]+ba[1]*ca.up[0];V[1]=ba[0]*ca.right[1]+ba[1]*ca.up[1];V[2]=ba[0]*ca.right[2]+ba[1]*ca.up[2]};a.vertexSpaceToProfileSpace=function(V,ca,ba){w.set(V,l.dot(ba,ca.right),l.dot(ba,ca.up))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat2f64":function(){define(["exports"],function(a){function p(){return[1,0,0,1]}function b(f){return[f[0],
f[1],f[2],f[3]]}function r(f,w,e,l){return[f,w,e,l]}function q(f,w){return new Float64Array(f,w,4)}var y=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,createView:q});a.clone=b;a.create=p;a.createView=q;a.fromValues=r;a.mat2f64=y})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/Util ./PathTechnique ./VisualVariableMaterialParameters ./internal/bufferWriterUtils ./internal/MaterialUtil".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){const m=d.assert;d=function(v){function x(A){A=v.call(this,A,z)||this;A.supportsEdges=!0;A._vertexAttributeLocations=c.pathVertexAttributeLocations;A.techniqueConfig=new c.PathTechniqueConfiguration;A.vertexBufferLayout=x.getVertexBufferLayout(A.params);return A}p._inheritsLoose(x,v);var C=x.prototype;C.getTechniqueConfig=function(A,B){this.techniqueConfig.output=A;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.vvColor=this.params.vvColorEnabled;
this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;if(0===A||7===A)this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,
this.techniqueConfig.receiveSSAO=B&&B.ssaoEnabled?this.params.receiveSSAO:!1;this.techniqueConfig.transparencyPassType=B?B.transparencyPassType:3;this.techniqueConfig.multipassTerrainEnabled=B?B.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=B?B.cullAboveGround:!1;return this.techniqueConfig};C.getPassParameters=function(){return this.params};C.isVisibleInPass=function(A){return 4===A||6===A||7===A?this.params.castShadows:!0};C.isVisible=function(){const A=this.params;return v.prototype.isVisible.call(this)?
0<A.opacity:!1};C.intersect=function(A,B,D,E,G,K,M){if(g.isPathGeometry(A)){B=A.path;D=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){var H=this.params.vvSizeOffset,J=this.params.vvSizeFactor;const O=this.params.vvSizeMinSize,I=this.params.vvSizeMaxSize,F=B.sizeAttributeValue;D[0]*=b.clamp(H[0]+F*J[0],O[0],I[0]);D[1]*=b.clamp(H[2]+F*J[2],O[2],I[2])}H=Math.max(D[0],D[1]);A=A.boundingInfo;r.isNone(A)?this._intersectTriangles(B,D,G,K,M):(A=q.fromValues(A.bbMin[0]-H,A.bbMin[1]-
H,A.bbMin[2]-H,A.bbMax[0]+H,A.bbMax[1]+H,A.bbMax[2]+H),H=[K[0]-G[0],K[1]-G[1],K[2]-G[2]],J=Math.sqrt(H[0]*H[0]+H[1]*H[1]+H[2]*H[2]),h.intersectAabbInvDir(A,G,[J/H[0],J/H[1],J/H[2]],E.tolerance)&&this._intersectTriangles(B,D,G,K,M))}};C._intersectTriangles=function(A,B,D,E,G){A.baked.size&&A.baked.size[0]===B[0]&&A.baked.size[1]===B[1]||A.baked.bake(B);A.baked.intersect(D,E,G)};C.computeAttachmentOrigin=function(A,B){A=A.vertexAttributes;if(!A)return null;A=A.get("position");return w.computeAttachmentOriginLines(A,
null,!1,B)};C.createBufferWriter=function(){return new k(this.vertexBufferLayout)};C.getGLMaterial=function(A){if(0===A.output||7===A.output||1===A.output||2===A.output||4===A.output||3===A.output&&this.params.castShadows)return new n(A)};x.getVertexBufferLayout=function(A){let B=f.newLayout().vec3f("position").vec4f("profileRight").vec4f("profileUp").vec4f("profileVertexAndNormal");if(A.vvColorEnabled||A.vvSizeEnabled||A.vvOpacityEnabled)B=B.vec4f("featureValue");return B};return x}(l.Material);
let n=function(v){function x(A){A=v.call(this,A)||this;A.updateParameters();return A}p._inheritsLoose(x,v);var C=x.prototype;C.updateParameters=function(A){this._technique=this._techniqueRep.releaseAndAcquire(c.PathTechnique,this._material.getTechniqueConfig(this._output,A),this._technique)};C.beginSlot=function(A){return A===(this._technique.configuration.transparent?5:3)||23===A};C._updateOccludeeState=function(A){A.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:A.hasOccludees})};
C._updateShadowState=function(A){A.shadowMappingEnabled!==this._technique.configuration.receiveShadows&&this._material.setParameterValues({receiveShadows:A.shadowMappingEnabled})};C.ensureParameters=function(A){if(0===this._output||7===this._output)this._updateShadowState(A),this._updateOccludeeState(A);this.updateParameters(A)};C.bind=function(A){this._technique.bindPass(this._material.getPassParameters(),A)};return x}(e);const z={size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,
0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...u.Default,...l.materialParametersDefaults};let k=function(){function v(C){this.vertexBufferLayout=C}var x=v.prototype;x.allocate=function(C){return this.vertexBufferLayout.createBuffer(C)};x.elementCount=function(C){return C.indices.get("position").length};x.write=function(C,A,B,D){const E=G=>{if(A.vertexAttributes.has(G)){const K=A.vertexAttributes.get(G),
M=A.indices.get(G);m(4===K.size);const H=B.getField(G,y.BufferViewVec4f);if(H)t.writeBufferVec4(M,K.data,H,D);else throw Error("unable to acquire view for "+G);}};E("profileRight");E("profileUp");E("profileVertexAndNormal");this.vertexBufferLayout.hasField("featureValue")&&E("featureValue");t.writeDefaultAttributes(A,this.vertexBufferLayout,C.transformation,C.invTranspTransformation,B,D)};return v}();a.PathMaterial=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n){const z=new Map([["position",0],["profileRight",1],["profileUp",2],["profileVertexAndNormal",3],["featureValue",4]]);d=function(k){function v(){return k.apply(this,arguments)||this}b._inheritsLoose(v,k);var x=v.prototype;x.initializeProgram=function(C){var A=v.shader.get();const B=this.configuration;A=A.build({OITEnabled:0===B.transparencyPassType,output:B.output,viewingMode:C.viewingMode,slicePlaneEnabled:B.slicePlaneEnabled,sliceHighlightDisabled:!1,
sliceEnabledForVertexPrograms:!1,receiveShadows:B.receiveShadows,vvSize:B.vvSize,vvColor:B.vvColor,vvInstancingEnabled:!0,vvOpacity:B.vvOpacity,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:B.receiveSSAO,doubleSidedMode:B.doubleSidedMode,multipassTerrainEnabled:B.multipassTerrainEnabled,cullAboveGround:B.cullAboveGround});return new t.Program(C.rctx,A,z)};x.bindPass=function(C,A){var B,D;l.bindProjectionMatrix(this.program,A.camera.projectionMatrix);this.program.setUniform3fv("size",
C.size);A.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",A.camera.nearFar),this.program.setUniform2fv("inverseViewport",A.inverseViewport),w.bindMultipassTerrainTexture(this.program,A));0!==this.configuration.output&&7!==this.configuration.output||this.program.setUniform1f("opacity",C.opacity);0===this.configuration.output?(A.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",C.ambient),this.program.setUniform3fv("diffuse",C.diffuse),this.program.setUniform3fv("specular",
C.specular),this.program.setUniform1f("opacity",C.opacity)):1!==this.configuration.output&&3!==this.configuration.output||l.bindNearFar(this.program,A.camera.nearFar);y.setVVUniforms(this.program,C);null==(B=A.shadowMap)?void 0:B.bind(this.program);null==(D=A.ssaoHelper)?void 0:D.bind(this.program,A.camera)};x.bindDraw=function(C){l.bindView(this.program,C);q.bindSliceUniformsWithOrigin(this.program,this.configuration,C);this.program.rebindTextures();0!==this.configuration.output&&7!==this.configuration.output||
l.bindCameraPosition(this.program,C.origin,C.camera.viewInverseTransposeMatrix);0===this.configuration.output&&e.bindReadShadowMapView(this.program,C);2===this.configuration.output&&f.VertexNormal.bindUniforms(this.program,C.camera.viewInverseTransposeMatrix)};x.setPipelineState=function(C){const A=this.configuration,B=3===C,D=2===C;return n.makePipelineState({blending:0!==A.output&&7!==A.output||!A.transparent?null:B?u.blendingDefault:u.OITBlending(C),culling:(A.slicePlaneEnabled?!1:!A.transparent&&
0!==A.doubleSidedMode)&&n.frontFaceCullingParams,depthTest:{func:u.OITDepthTest(C)},depthWrite:B||D?n.defaultDepthWriteParams:null,colorWrite:n.defaultColorWriteParams,stencilWrite:A.sceneHasOcludees?h.stencilWriteMaskOn:null,stencilTest:A.sceneHasOcludees?h.stencilBaseAllZerosParams:null,polygonOffset:B||D?null:u.OITPolygonOffset})};x.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};return v}(d.ShaderTechnique);d.shader=new g.ReloadableShaderModule(m.PathShader,
()=>new Promise(function(k,v){a(["../shaders/Path.glsl"],k,v)}));g=function(k){function v(){var x=k.apply(this,arguments)||this;x.output=0;x.doubleSidedMode=0;x.receiveShadows=!1;x.receiveSSAO=!1;x.vvSize=!1;x.vvColor=!1;x.vvOpacity=!1;x.slicePlaneEnabled=!1;x.transparent=!1;x.sceneHasOcludees=!1;x.transparencyPassType=3;x.multipassTerrainEnabled=!1;x.cullAboveGround=!1;return x}b._inheritsLoose(v,k);return v}(c.ShaderTechniqueConfiguration);r.__decorate([c.parameter({count:8})],g.prototype,"output",
void 0);r.__decorate([c.parameter({count:3})],g.prototype,"doubleSidedMode",void 0);r.__decorate([c.parameter()],g.prototype,"receiveShadows",void 0);r.__decorate([c.parameter()],g.prototype,"receiveSSAO",void 0);r.__decorate([c.parameter()],g.prototype,"vvSize",void 0);r.__decorate([c.parameter()],g.prototype,"vvColor",void 0);r.__decorate([c.parameter()],g.prototype,"vvOpacity",void 0);r.__decorate([c.parameter()],g.prototype,"slicePlaneEnabled",void 0);r.__decorate([c.parameter()],g.prototype,
"transparent",void 0);r.__decorate([c.parameter()],g.prototype,"sceneHasOcludees",void 0);r.__decorate([c.parameter({count:4})],g.prototype,"transparencyPassType",void 0);r.__decorate([c.parameter()],g.prototype,"multipassTerrainEnabled",void 0);r.__decorate([c.parameter()],g.prototype,"cullAboveGround",void 0);p.PathTechnique=d;p.PathTechniqueConfiguration=g;p.pathVertexAttributeLocations=z;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define(["exports",
"./PositionAttribute.glsl","../../shaderModules/interfaces"],function(a,p,b){a.PathVertexPosition=function(r,q){r.attributes.add("featureValue","vec4");r.vertex.code.add(b.glsl`bool isCapVertex() {
return featureValue.w == 1.0;
}`);r.vertex.uniforms.add("size","vec3");q.vvSize?(r.vertex.uniforms.add("vvSizeMinSize","vec3"),r.vertex.uniforms.add("vvSizeMaxSize","vec3"),r.vertex.uniforms.add("vvSizeOffset","vec3"),r.vertex.uniforms.add("vvSizeFactor","vec3"),r.vertex.code.add(b.glsl`vec2 getSize() {
return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):r.vertex.code.add(b.glsl`vec2 getSize(){
return size.xy;
}`);q.vvOpacity?(r.vertex.constants.add("vvOpacityNumber","int",8),r.vertex.code.add(b.glsl`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):r.vertex.code.add(b.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);q.vvColor?(r.vertex.constants.add("vvColorNumber","int",8),r.vertex.code.add(b.glsl`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):r.vertex.code.add(b.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);r.include(p.PositionAttribute);r.attributes.add("profileRight","vec4");r.attributes.add("profileUp","vec4");r.attributes.add("profileVertexAndNormal","vec4");r.vertex.code.add(b.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);r.vertex.code.add(b.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);r.vertex.code.add(b.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);r.vertex.code.add(b.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.setVVUniforms=function(r,q){q.vvSizeEnabled&&(r.setUniform3fv("vvSizeMinSize",q.vvSizeMinSize),r.setUniform3fv("vvSizeMaxSize",q.vvSizeMaxSize),r.setUniform3fv("vvSizeOffset",q.vvSizeOffset),r.setUniform3fv("vvSizeFactor",q.vvSizeFactor));q.vvColorEnabled&&(r.setUniform1fv("vvColorValues",q.vvColorValues),r.setUniform4fv("vvColorColors",q.vvColorColors));q.vvOpacityEnabled&&(r.setUniform1fv("vvOpacityValues",q.vvOpacityValues),r.setUniform1fv("vvOpacityOpacities",q.vvOpacityOpacities))};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){function n(k){const v=new m.ShaderBuilder;v.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");v.varyings.add("vpos","vec3");v.include(q.PathVertexPosition,k);if(0===k.output||7===k.output)v.include(r.Transform,{linearDepth:!1}),k.receiveShadows&&v.include(u.ReadShadowMap,k),v.include(p.ForwardLinearDepth,k),v.varyings.add("vnormal","vec3"),v.varyings.add("vcolor","vec4"),k.multipassTerrainEnabled&&v.varyings.add("depth",
"float"),v.vertex.code.add(h.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${k.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${0===k.output?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);k.multipassTerrainEnabled&&(v.fragment.include(w.ReadLinearDepth),v.include(g.multipassTerrainTest,k));7===k.output&&(v.include(b.Slice,k),v.fragment.uniforms.add("camPos","vec3"),v.fragment.uniforms.add("localOrigin","vec3"),v.fragment.uniforms.add("opacity","float"),v.fragment.code.add(h.glsl`
      void main() {
        discardBySlice(vpos);
        ${k.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `));0===k.output&&(v.include(b.Slice,k),v.include(l.EvaluateSceneLighting,k),v.include(e.EvaluateAmbientOcclusion,k),k.receiveShadows&&v.include(u.ReadShadowMap,k),v.include(d.Normals,k),v.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),v.fragment.include(t.ColorConversion),v.fragment.code.add(h.glsl`
      void main() {
        discardBySlice(vpos);
        ${k.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - camPos);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${k.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===k.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${k.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(1===k.output||3===k.output)v.include(r.Transform,{linearDepth:!0}),v.vertex.uniforms.add("nearFar","vec2"),v.varyings.add("depth","float"),v.vertex.code.add(h.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),v.include(b.Slice,k),v.include(y.OutputDepth,k),v.fragment.uniforms.add("timeElapsed","float"),v.fragment.code.add(h.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);2===k.output&&(v.include(r.Transform,{linearDepth:!1}),v.include(c.NormalUtils,k),v.vertex.uniforms.add("viewNormal","mat4"),v.varyings.add("vnormal","vec3"),v.vertex.code.add(h.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),v.include(b.Slice,k),v.fragment.uniforms.add("waterColor","vec4"),v.fragment.code.add(h.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`));4===k.output&&(v.include(r.Transform,{linearDepth:!1}),v.include(c.NormalUtils,k),v.vertex.uniforms.add("viewNormal","mat4"),v.varyings.add("vnormal","vec3"),v.vertex.code.add(h.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),v.include(b.Slice,k),v.include(f.OutputHighlight),v.fragment.code.add(h.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return v}var z=Object.freeze({__proto__:null,build:n});a.PathShader=z;a.build=n})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D){const E=["polyline","polygon","extent"];t=function(H){function J(I,F,L,N){I=H.call(this,I,F,L,N)||this;I._needsUV=!1;I._hasOutline=!1;return I}p._inheritsLoose(J,H);var O=J.prototype;O.doLoad=function(){var I=p._asyncToGenerator(function*(){});return function(){return I.apply(this,arguments)}}();O.ensureMaterials=function(){this.ensureFillMaterial();this.ensureOutlineMaterial()};O.ensureFillMaterial=function(){if(!r.isSome(this._material)){var I=
r.get(this.symbolLayer,"material","color");I=this._getCombinedOpacityAndColor(I);this._material=z.createMaterial(this.symbolLayer,{color:I,transparent:1>I[3]||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped});this._needsUV=this._material instanceof B.PatternMaterial;this._context.stage.add(this._material)}};O.ensureOutlineMaterial=function(){const I=this.symbolLayer.outline;!r.isSome(this._outlineMaterial)&&
this._isValidOutline(I)&&(this._hasOutline=!0,this._outlineMaterial=(F=>{const L=r.mapOr(I.stipplePattern,C.scaleStipplePattern(C.getStipplePatternForLinePattern(I.pattern),q.pt2px(I.size)),R=>C.createStipplePattern(R.map(q.pt2px))),N=I.stippleOffColor?b.toUnitRGBA(I.stippleOffColor):null;return 1.5<F?new D.RibbonLineMaterial({width:F,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:L,stippleIntegerRepeats:!0,stippleOffColor:N,
cap:I.patternCap||"butt"}):new A.NativeLineMaterial({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled,width:F,stipplePattern:L,stippleIntegerRepeats:!0,stippleOffColor:N})})(q.pt2px(I.size)),this._context.stage.add(this._outlineMaterial))};O._isValidOutline=function(I){return r.isSome(I)&&I.size&&0<I.size&&r.isSome(I.color)&&"none"!==I.pattern};O.destroy=function(){H.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);
this._outlineMaterial=null};O.createGraphics3DGraphic=function(I){const F=I.graphic;if(!this._validateGeometry(F.geometry,E,this.symbolLayer.type))return null;I=this._getVertexOpacityAndColor(I.renderingInfo,255);const L=this.setGraphicElevationContext(F,new d.ElevationContext);this.ensureDrapedStatus("on-the-ground"===L.mode);this.ensureMaterials();return this.draped?this._createAsOverlay(F,I):this._createAs3DShape(F,I,L)};O.layerOpacityChanged=function(){if(r.isSome(this._material)){var I=this._material.params.color,
F=r.get(this.symbolLayer,"material","color");F=this._getCombinedOpacity(F);this._material.setParameterValues({color:[I[0],I[1],I[2],F],transparent:1>F||this.needsDrivenTransparentPass})}r.isSome(this._outlineMaterial)&&(I=this._outlineMaterial.params.color,this._outlineMaterial.setParameterValues({color:[I[0],I[1],I[2],this._getOutlineOpacity()]}));return!0};O.layerElevationInfoChanged=function(I,F,L){const N=this._elevationContext.mode;L=g.elevationModeChangeUpdateType(J.elevationModeChangeTypes,
L,N);if(L!==g.SymbolUpdateType.UPDATE)return L;const R=g.needsElevationUpdates2D(N);return this.updateGraphics3DGraphicElevationInfo(I,F,()=>R)};O.slicePlaneEnabledChanged=function(){r.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});r.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};O.physicalBasedRenderingChanged=function(){return!0};O.pixelRatioChanged=
function(){return!0};O._createAs3DShape=function(I,F,L){const N=n.geometryAsPolygon(I.geometry);if(r.isNone(N))return null;K.renderData=n.geometryToRenderInfo(N,this._context.elevationProvider,this._context.renderCoordsHelper,L);K.color=F;F=K.renderData.position.length/3;this._needsUV&&(K.uvMapSpace=new Float32Array(4*F),K.boundingRect=new Float64Array(9*F));K.outNum=0;K.outGeometries=[];K.outTransforms=[];K.outMaterials=[];this._createAs3DShapeFill(K);this._hasOutline&&this._createAs3DShapeOutline(K);
this._logGeometryCreationWarnings(K.renderData,N.rings,"rings","FillSymbol3DLayer");if(0===K.outNum)return null;this._needsUV&&k.createMapSpaceUVCoords(l.BufferViewVec4f.fromTypedArray(K.uvMapSpace),l.BufferViewVec3f64.fromTypedArray(K.renderData.position),this._context.renderCoordsHelper,l.BufferViewMat3f64.fromTypedArray(K.boundingRect));I=new v.Object3D({geometries:K.outGeometries,materials:K.outMaterials,transformations:K.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,
graphicUid:I.uid}});I=new u.Graphics3DObject3DGraphicLayer(this,I,K.outGeometries,null,null,z.uvElevationAligner,L);I.alignedSampledElevation=K.renderData.sampledElevation;I.needsElevationUpdates=g.needsElevationUpdates2D(L.mode);return I};O._createAs3DShapeFill=function(I){var F=I.renderData.polygons;for(const {position:L,mapPosition:N,holeIndices:R,index:S,count:P}of F){if(r.isSome(this._context.clippingExtent)&&(e.empty(G),e.expandWithBuffer(G,N),!e.intersectsClippingArea(G,this._context.clippingExtent)))continue;
F=y.earcut(N,R,3);0!==F.length&&(F=new Uint32Array(F),F=n.createColorGeometry({indices:F,attributeData:{position:L,color:I.color,mapPosition:N,uvMapSpace:this._needsUV?new Float32Array(I.uvMapSpace.buffer,4*S*I.uvMapSpace.BYTES_PER_ELEMENT,4*P):null,boundingRect:this._needsUV?new Float64Array(I.boundingRect.buffer,9*S*I.boundingRect.BYTES_PER_ELEMENT,9*P):null}}),I.outGeometries.push(F),I.outMaterials.push(r.unwrap(this._material)),I.outTransforms.push(f.IDENTITY),I.outNum++)}};O._createAs3DShapeOutline=
function(I){if(this._hasOutline){var F=I.renderData.outlines,L=this._outlineMaterial instanceof A.NativeLineMaterial;for(let N=0;N<F.length;++N){const {mapPosition:R,position:S}=F[N];if(r.isSome(this._context.clippingExtent)&&(e.empty(G),e.expandWithBuffer(G,R),!e.intersectsClippingArea(G,this._context.clippingExtent)))continue;const P=m.createGeometry({removeDuplicateStartEnd:L?0:1,attributeData:{position:S,mapPosition:R}}),Q=P.vertexAttributes.get("position");Q.data===S&&(Q.data=new Float64Array(S));
I.outGeometries.push(P);I.outMaterials.push(r.unwrap(this._outlineMaterial));I.outTransforms.push(f.IDENTITY);I.outNum++}}};O._createAsOverlay=function(I,F){const L=n.geometryAsPolygon(I.geometry);if(r.isNone(L))return null;r.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;r.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);M.renderData=n.geometryToRenderInfoDraped(L,this._context.overlaySR);M.color=F;F=M.renderData.position.length/
3;this._needsUV&&(M.uvMapSpace=new Float32Array(4*F));M.outNum=0;M.outGeometries=[];M.outBoundingBox=e.empty();M.layerUid=this._context.layer.uid;M.graphicsUid=I.uid;this._createAsOverlayFill(M);this._hasOutline&&this._createAsOverlayOutline(M);this._logGeometryCreationWarnings(M.renderData,L.rings,"rings","FillSymbol3DLayer");if(0===M.outNum)return null;this._needsUV&&k.createMapSpaceUVCoordsDraped(l.BufferViewVec4f.fromTypedArray(M.uvMapSpace),l.BufferViewVec3f64.fromTypedArray(M.renderData.position),
this._context.overlaySR);return 0<M.outNum?new c(this,M.outGeometries,M.outBoundingBox):null};O._createAsOverlayFill=function(I){var F=I.renderData.polygons;for(const {position:L,holeIndices:N,index:R,count:S}of F){e.empty(G);e.expandWithBuffer(G,L);if(!e.intersectsClippingArea(G,this._context.clippingExtent))continue;F=y.earcut(L,N,3);if(0===F.length)continue;e.expandWithAABB(I.outBoundingBox,G);F=new Uint32Array(F);F=n.createColorGeometry({indices:F,attributeData:{position:L,color:I.color,uvMapSpace:this._needsUV?
new Float32Array(I.uvMapSpace.buffer,4*R*I.uvMapSpace.BYTES_PER_ELEMENT,4*S):null}});F=new x.RenderGeometry(F,r.unwrap(this._material),I.layerUid,I.graphicsUid);const P=G;w.set(F.boundingSphere,.5*(P[0]+P[3]),.5*(P[1]+P[4]),0,.5*Math.sqrt((P[3]-P[0])*(P[3]-P[0])+(P[4]-P[1])*(P[4]-P[1])));I.outGeometries.push(F);I.outNum++}};O._createAsOverlayOutline=function(I){if(this._hasOutline){var F=I.renderData.outlines;for(let N=0;N<F.length;++N){var {position:L}=F[N];e.empty(G);e.expandWithBuffer(G,L);if(!e.intersectsClippingArea(G,
this._context.clippingExtent))continue;e.expandWithAABB(I.outBoundingBox,G);L=m.createGeometry({removeDuplicateStartEnd:this._outlineMaterial instanceof A.NativeLineMaterial?0:1,attributeData:{position:L}});L=new x.RenderGeometry(L,r.unwrap(this._outlineMaterial),I.layerUid,I.graphicsUid);const R=G;w.set(L.boundingSphere,.5*(R[0]+R[3]),.5*(R[1]+R[4]),0,.5*Math.sqrt((R[3]-R[0])*(R[3]-R[0])+(R[4]-R[1])*(R[4]-R[1])));I.outGeometries.push(L);I.outNum++}}};O._getOutlineOpacity=function(){const I=r.get(this.symbolLayer,
"outline","color");return(this.draped?1:this._getLayerOpacity())*(r.isSome(I)?I.a:0)};O._getOutlineColor=function(){const I=r.get(this.symbolLayer,"outline","color"),F=this._getOutlineOpacity();return h.mixinColorAndOpacity(r.isSome(I)?b.toUnitRGB(I):null,F)};p._createClass(J,[{key:"test",get:function(){return{createAsOverlay:(I,F)=>this._createAsOverlay(I,F),createAs3DShape:(I,F,L)=>this._createAs3DShape(I,F,L)}}}]);return J}(t.Graphics3DSymbolLayer);t.elevationModeChangeTypes={definedChanged:g.SymbolUpdateType.RECREATE,
staysOnTheGround:g.SymbolUpdateType.NONE,onTheGroundChanged:g.SymbolUpdateType.RECREATE};const G=e.create(),K={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},M={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DPolygonFillSymbolLayer=t;a["default"]=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e){function l(u,t,h){if(b.isSome(u)){if("none"===u.style||"solid"===u.style)return"none"===u.style&&(t.color=r.fromValues(0,0,0,0),t.transparent=!0),new w.ColorMaterial(t);t.style=g(u.style);t.draped=h.isDraped;return new e.PatternMaterial(t)}return new w.ColorMaterial(t)}function g(u){switch(u){case "horizontal":return 0;case "vertical":return 1;case "cross":return 2;case "forward-diagonal":return 3;case "backward-diagonal":return 4;case "diagonal-cross":return 5}}function d(u){return u.material instanceof
e.PatternMaterial&&!u.material.params.draped}function c(u,t){if(d(u)){var h=u.geometry.vertexAttributes;u=h.get("position").data;const m=h.get("uvMapSpace").data;h=h.get("boundingRect").data;f.createMapSpaceUVCoords(q.BufferViewVec4f.fromTypedArray(m),q.BufferViewVec3f64.fromTypedArray(u),t,q.BufferViewMat3f64.fromTypedArray(h))}}a.createMaterial=function(u,t,h){return l(u&&u.pattern||null,t,h)};a.createMaterialFromPattern=l;a.parsePatternStyle=g;a.requiresUVUpdates=d;a.updateMapSpaceUVCoords=c;a.uvElevationAligner=
function(u,t,h,m){t=y.perVertexElevationAligner(u,t,h,m);u=u.stageObject.geometryRecords;for(h=0;h<u.length;h++)c(u[h],m);return t};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){function d(M,H,J,O,I,F,L){y.set(M,H*I[0]+J*F[0]+O*L[0],H*I[1]+J*F[1]+O*L[1],H*I[2]+J*F[2]+O*L[2])}const c=f.create(),u=f.create(),t=l.create(),h=f.create(),m=f.create(),n=f.create(),z=q.create(),k=q.create(),v=q.create(),x=f.create(),C=f.create(),A=f.create(),B=b.create(),D=f.create(),E=f.create(),G=f.create(),K=f.create();a.createMapSpaceUVCoords=function(M,H,J,O,I=1){y.set(h,1,0,0);y.set(m,0,1,0);y.set(n,0,0,1);y.set(K,0,0,0);for(var F=0;F<H.count-1;F++)H.getVec(F,
u),y.add(K,K,u);y.scale(c,K,1/(H.count-1));F=H.count-1;if(F=l.fromManyPointsSampleAt(H,t,0,Math.floor(F/3),Math.floor(2/3*F))){p.isSome(J)?(J.basisMatrixAtPosition(c,B),y.set(D,B[0],B[1],B[2]),y.set(E,B[4],B[5],B[6]),y.set(G,B[8],B[9],B[10])):(y.set(D,1,0,0),y.set(E,0,1,0),y.set(G,0,0,1));J=l.normal(t);0>y.dot(J,G)&&y.scale(J,J,-1);y.copy(n,J);F=y.dot(J,E);var L=y.dot(J,D);Math.abs(F)<Math.abs(L)?(y.scaleAndAdd(h,D,J,-L),y.normalize(h,h),y.cross(m,h,J),y.normalize(m,m),y.scale(m,m,-1)):(y.scaleAndAdd(m,
E,J,-F),y.normalize(m,m),y.cross(h,m,J),y.normalize(h,h))}r.set(z,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);r.set(k,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(J=0;J<H.count;J++)H.getVec(J,u),F=y.dot(h,u),L=y.dot(m,u),z[0]=Math.min(z[0],F),z[1]=Math.min(z[1],L),k[0]=Math.max(k[0],F),k[1]=Math.max(k[1],L);J=y.dot(n,c);d(x,z[0],z[1],J,h,m,n);d(C,k[0],z[1],J,h,m,n);d(A,z[0],k[1],J,h,m,n);y.subtract(C,C,x);y.scale(C,C,.5);y.subtract(A,A,x);y.scale(A,A,.5);y.add(x,x,C);y.add(x,x,A);
J=z[1]%I;v[0]=z[0]-z[0]%I;v[1]=z[1]-J;for(J=0;J<H.count;J++)for(H.getVec(J,u),M.setValues(J,(y.dot(h,u)-v[0])/I,(y.dot(m,u)-v[1])/I,v[0]/I,v[1]/I),F=0;3>F;F++)O.set(J,F,x[F]),O.set(J,F+3,C[F]),O.set(J,F+6,A[F])};a.createMapSpaceUVCoordsDraped=function(M,H,J,O=1){if(J.isGeographic){const I=new Float64Array(H.typedBuffer.length),F=3*H.count;for(let L=0;L<F;L+=3)w.lonLatToWebMercatorComparable(H.typedBuffer,L,I,L,e.getReferenceEllipsoid(J));H=g.BufferViewVec3f64.fromTypedArray(I)}r.set(z,Number.POSITIVE_INFINITY,
Number.POSITIVE_INFINITY);for(J=0;J<H.count;J++)H.getVec(J,u),z[0]=Math.min(z[0],u[0]),z[1]=Math.min(z[1],u[1]);J=z[1]%O;v[0]=z[0]-z[0]%O;v[1]=z[1]-J;for(J=0;J<H.count;J++)H.getVec(J,u),M.setValues(J,(u[0]-v[0])/O,(u[1]-v[1])/O,v[0]/O,v[1]/O)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../lib/GLMaterial ../lib/Material ../lib/OrderIndependentTransparency ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/ColorMaterialTechnique".split(" "),
function(a,p,b,r,q,y,f,w){let e=function(d){function c(t){t=d.call(this,t,g)||this;t.supportsEdges=!0;t.techniqueConfig=new w.ColorMaterialTechniqueConfiguration;return t}p._inheritsLoose(c,d);var u=c.prototype;u.getTechniqueConfig=function(t,h){this.techniqueConfig.output=t;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;
this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.transparencyPassType=h?h.transparencyPassType:3;this.techniqueConfig.enableOffset=h?h.camera.relativeElevation<q.OITPolygonOffsetLimit:!0;this.techniqueConfig.multipassTerrainEnabled=h?h.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=h?h.cullAboveGround:!1;return this.techniqueConfig};
u.getPassParameters=function(){return this.params};u.intersect=function(t,h,m,n,z,k,v){f.intersectTriangleGeometry(t,h,n,z,k,void 0,v)};u.getGLMaterial=function(t){return 0===t.output||7===t.output||4===t.output||1===t.output&&this.params.writeLinearDepth?new l(t):void 0};u.createBufferWriter=function(){return new y.DefaultBufferWriter(y.PositionColorLayout)};return c}(r.Material),l=function(d){function c(t){t=d.call(this,t)||this;t.updateParameters();return t}p._inheritsLoose(c,d);var u=c.prototype;
u.updateParameters=function(t){this._technique=this._techniqueRep.releaseAndAcquire(w.ColorMaterialTechnique,this._material.getTechniqueConfig(this._output,t),this._technique)};u.beginSlot=function(t){return 23===t?!0:4===this._output?3===t:t===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)};u._updateOccludeeState=function(t){t.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:t.hasOccludees})};u.ensureParameters=
function(t){0!==this._output&&7!==this._output||this._updateOccludeeState(t);this.updateParameters(t)};u.bind=function(t){this._technique.bindPass(this._material.getPassParameters(),t)};u.getPipelineState=function(t,h){return this._technique.getPipelineState(h)};return c}(b);const g={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...r.materialParametersDefaults};a.ColorMaterial=e;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){l=function(z){function k(){return z.apply(this,arguments)||this}b._inheritsLoose(k,z);var v=k.prototype;v.initializeProgram=function(x){var C=k.shader.get();const A=this.configuration;C=C.build({output:A.output,OITEnabled:0===A.transparencyPassType,attributeColor:A.vertexColors,slicePlaneEnabled:A.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:A.multipassTerrainEnabled,cullAboveGround:A.cullAboveGround});
return new u.Program(x.rctx,C,d.Default3D)};v.bindPass=function(x,C){w.bindProjectionMatrix(this.program,C.camera.projectionMatrix);this.program.setUniform4fv("eColor",x.color);4===this.configuration.output&&y.bindOutputHighlight(this.program,C);(1===this.configuration.output||C.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",C.camera.nearFar);C.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",C.inverseViewport),f.bindMultipassTerrainTexture(this.program,
C))};v.bindDraw=function(x){w.bindView(this.program,x);this.program.rebindTextures();q.bindSliceUniformsWithOrigin(this.program,this.configuration,x)};v.setPipelineState=function(x,C){const A=this.configuration,B=3===x,D=2===x;return m.makePipelineState({blending:0!==A.output&&7!==A.output||!A.transparent?null:B?c.blendingDefault:c.OITBlending(x),culling:m.cullingParams(A.cullFace),depthTest:{func:c.OITDepthTest(x)},depthWrite:B||D?A.writeDepth&&m.defaultDepthWriteParams:null,colorWrite:m.defaultColorWriteParams,
stencilWrite:A.sceneHasOcludees?t.stencilWriteMaskOn:null,stencilTest:A.sceneHasOcludees?C?t.stencilToolMaskBaseParams:t.stencilBaseAllZerosParams:null,polygonOffset:B||D?A.polygonOffset&&n:c.getOITPolygonOffset(A.enableOffset)})};v.initializePipeline=function(){this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,!1)};v.getPipelineState=function(x){return x?this._occludeePipelineState:this.pipeline};
return k}(l.ShaderTechnique);l.shader=new e.ReloadableShaderModule(h.ColorMaterialShader,()=>new Promise(function(z,k){a(["./ColorMaterial.glsl"],z,k)}));const n={factor:1,units:1};e=function(z){function k(){var v=z.apply(this,arguments)||this;v.output=0;v.cullFace=0;v.slicePlaneEnabled=!1;v.vertexColors=!1;v.transparent=!1;v.polygonOffset=!1;v.enableOffset=!0;v.writeDepth=!0;v.sceneHasOcludees=!1;v.transparencyPassType=3;v.multipassTerrainEnabled=!1;v.cullAboveGround=!1;return v}b._inheritsLoose(k,
z);return k}(g.ShaderTechniqueConfiguration);r.__decorate([g.parameter({count:8})],e.prototype,"output",void 0);r.__decorate([g.parameter({count:3})],e.prototype,"cullFace",void 0);r.__decorate([g.parameter()],e.prototype,"slicePlaneEnabled",void 0);r.__decorate([g.parameter()],e.prototype,"vertexColors",void 0);r.__decorate([g.parameter()],e.prototype,"transparent",void 0);r.__decorate([g.parameter()],e.prototype,"polygonOffset",void 0);r.__decorate([g.parameter()],e.prototype,"enableOffset",void 0);
r.__decorate([g.parameter()],e.prototype,"writeDepth",void 0);r.__decorate([g.parameter()],e.prototype,"sceneHasOcludees",void 0);r.__decorate([g.parameter({count:4})],e.prototype,"transparencyPassType",void 0);r.__decorate([g.parameter()],e.prototype,"multipassTerrainEnabled",void 0);r.__decorate([g.parameter()],e.prototype,"cullAboveGround",void 0);p.ColorMaterialTechnique=l;p.ColorMaterialTechniqueConfiguration=e;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){function c(t){const h=new d.ShaderBuilder,m=1===t.output;h.include(b.Transform,{linearDepth:m});h.include(r.VertexColor,t);h.vertex.uniforms.add("proj","mat4").add("view","mat4");h.attributes.add("position","vec3");h.varyings.add("vpos","vec3");t.multipassTerrainEnabled&&h.varyings.add("depth","float");m&&(h.include(q.OutputDepth,t),h.vertex.uniforms.add("cameraNearFar","vec2"),h.varyings.add("linearDepth","float"));h.vertex.code.add(g.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${t.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${m?g.glsl`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:g.glsl`transformPosition(proj, view, vpos);`}
    }
  `);h.include(p.Slice,t);h.fragment.include(l.ColorConversion);t.multipassTerrainEnabled&&(h.fragment.include(f.ReadLinearDepth),h.include(w.multipassTerrainTest,t));h.fragment.uniforms.add("eColor","vec4");4===t.output&&h.include(y.OutputHighlight);h.fragment.code.add(g.glsl`
  void main() {
    discardBySlice(vpos);
    ${t.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${t.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${g.glsl.float(e.symbolAlphaCutoff)}) {
      discard;
    }

    ${7===t.output?g.glsl`gl_FragColor = vec4(color.a);`:""}

    ${0===t.output?g.glsl`gl_FragColor = highlightSlice(color, vpos); ${t.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===t.output?g.glsl`outputHighlight();`:""};
    ${1===t.output?g.glsl`outputDepth(linearDepth);`:""};
  }
  `);return h}var u=Object.freeze({__proto__:null,build:c});a.ColorMaterialShader=u;a.build=c})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/Util ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/PatternTechnique".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){let c=function(m){function n(k){k=m.call(this,k,h)||this;k.supportsEdges=!0;k._vertexAttributeLocations=d.patternVertexAttributeLocations;k.techniqueConfig=new d.PatternTechniqueConfiguration;return k}p._inheritsLoose(n,m);var z=n.prototype;z.getTechniqueConfig=function(k,v){this.techniqueConfig.output=k;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;
this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.style=this.params.style;this.techniqueConfig.patternSpacing=this.params.patternSpacing;this.techniqueConfig.lineWidth=this.params.lineWidth;this.techniqueConfig.draped=this.params.draped;this.techniqueConfig.transparencyPassType=v?v.transparencyPassType:3;this.techniqueConfig.enableOffset=v?v.camera.relativeElevation<f.OITPolygonOffsetLimit:!0;this.techniqueConfig.multipassTerrainEnabled=
v?v.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=v?v.cullAboveGround:!1;return this.techniqueConfig};z.getPassParameters=function(){return this.params};z.intersect=function(k,v,x,C,A,B,D){g.intersectTriangleGeometry(k,v,C,A,B,void 0,D)};z.getGLMaterial=function(k){return 0===k.output||7===k.output||4===k.output||1===k.output&&this.params.writeLinearDepth?new u(k):void 0};z.createBufferWriter=function(){const k=r.newLayout().vec3f("position").vec4u8("color").vec4f("uvMapSpace");
this.params.draped||k.mat3f("boundingRect");return new t(k)};return n}(y.Material),u=function(m){function n(k){k=m.call(this,k)||this;k.updateParameters();return k}p._inheritsLoose(n,m);var z=n.prototype;z.updateParameters=function(k){this._technique=this._techniqueRep.releaseAndAcquire(d.PatternTechnique,this._material.getTechniqueConfig(this._output,k),this._technique)};z.beginSlot=function(k){return 23===k?!0:4===this._output?3===k:k===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?
5:8:3)};z._updateOccludeeState=function(k){k.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:k.hasOccludees})};z.ensureParameters=function(k){0!==this._output&&7!==this._output||this._updateOccludeeState(k);this.updateParameters(k)};z.bind=function(k){this._technique.bindPass(this._material.getPassParameters(),k)};z.getPipelineState=function(k,v){return this._technique.getPipelineState(v)};return n}(q),t=function(m){function n(){return m.apply(this,
arguments)||this}p._inheritsLoose(n,m);var z=n.prototype;z.write=function(k,v,x,C){for(const B of this.vertexBufferLayout.fieldNames){const D=v.vertexAttributes.get(B),E=v.indices.get(B);if(D&&E)switch(B){case "position":w.assert(3===D.size);var A=x.getField(B,b.BufferViewVec3f);A&&e.writePosition(E,D.data,k.transformation,A,C);break;case "color":w.assert(3===D.size||4===D.size);(A=x.getField(B,b.BufferViewVec4u8))&&e.writeColor(E,D.data,D.size,A,C);break;case "uvMapSpace":w.assert(4===D.size);(A=
x.getField(B,b.BufferViewVec4f))&&e.writeBufferVec4(E,D.data,A,C);break;case "boundingRect":w.assert(9===D.size),(A=x.getField(B,b.BufferViewMat3f))&&this.writeBoundingRect(E,D.data,k.transformation,A,C)}}};z.writeBoundingRect=function(k,v,x,C,A){const B=C.typedBuffer;C=C.typedBufferStride;const D=k.length;A*=C;for(let G=0;G<D;++G){const K=9*k[G];var E=v[K];const M=v[K+1],H=v[K+2];B[A]=x[0]*E+x[4]*M+x[8]*H+x[12];B[A+1]=x[1]*E+x[5]*M+x[9]*H+x[13];B[A+2]=x[2]*E+x[6]*M+x[10]*H+x[14];for(E=3;9>E;++E)B[A+
E]=v[K+E];A+=C}};return n}(l.DefaultBufferWriter);const h={color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,style:2,patternSpacing:10,lineWidth:1,draped:!0,...y.materialParametersDefaults};a.PatternMaterial=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){l=function(z){function k(){return z.apply(this,arguments)||this}b._inheritsLoose(k,z);var v=k.prototype;v.initializeProgram=function(x){var C=k.shader.get();const A=this.configuration;C=C.build({output:A.output,attributeColor:A.vertexColors,slicePlaneEnabled:A.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:A.style,patternSpacing:A.patternSpacing,lineWidth:A.lineWidth,draped:A.draped,OITEnabled:0===A.transparencyPassType,
multipassTerrainEnabled:A.multipassTerrainEnabled,cullAboveGround:A.cullAboveGround});return new c.Program(x.rctx,C,n)};v.bindPass=function(x,C){w.bindProjectionMatrix(this.program,C.camera.projectionMatrix);this.program.setUniform4fv("matColor",x.color);this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/C.screenToPCSRatio),this.program.setUniform1f("texelSize",1/C.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/C.camera.perScreenPixelRatio);
4===this.configuration.output&&y.bindOutputHighlight(this.program,C);(1===this.configuration.output||C.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",C.camera.nearFar);C.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",C.inverseViewport),f.bindMultipassTerrainTexture(this.program,C))};v.bindDraw=function(x){w.bindView(this.program,x);w.bindCameraPosition(this.program,x.origin,x.camera.viewInverseTransposeMatrix);q.bindSliceUniformsWithOrigin(this.program,
this.configuration,x);this.program.rebindTextures()};v.setPipelineState=function(x,C){const A=this.configuration,B=3===x,D=2===x;return h.makePipelineState({blending:0===A.output||7===A.output?A.transparent&&B?d.blendingDefault:d.OITBlending(x):null,culling:h.cullingParams(A.cullFace),depthTest:{func:d.OITDepthTest(x)},depthWrite:B?A.writeDepth&&h.defaultDepthWriteParams:d.OITDepthWrite(x),colorWrite:h.defaultColorWriteParams,stencilWrite:A.sceneHasOcludees?u.stencilWriteMaskOn:null,stencilTest:A.sceneHasOcludees?
C?u.stencilToolMaskBaseParams:u.stencilBaseAllZerosParams:null,polygonOffset:B||D?A.polygonOffset&&m:d.getOITPolygonOffset(A.enableOffset)})};v.initializePipeline=function(){this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,!1)};v.getPipelineState=function(x){return x?this._occludeePipelineState:this.pipeline};return k}(l.ShaderTechnique);l.shader=new e.ReloadableShaderModule(t.PatternShader,
()=>new Promise(function(z,k){a(["./Pattern.glsl"],z,k)}));const m={factor:1,units:1};e=function(z){function k(){var v=z.apply(this,arguments)||this;v.output=0;v.cullFace=0;v.slicePlaneEnabled=!1;v.vertexColors=!1;v.transparent=!0;v.polygonOffset=!1;v.writeDepth=!0;v.sceneHasOcludees=!1;v.enableOffset=!0;v.transparencyPassType=3;v.multipassTerrainEnabled=!1;v.cullAboveGround=!1;return v}b._inheritsLoose(k,z);return k}(g.ShaderTechniqueConfiguration);r.__decorate([g.parameter({count:8})],e.prototype,
"output",void 0);r.__decorate([g.parameter({count:3})],e.prototype,"cullFace",void 0);r.__decorate([g.parameter()],e.prototype,"slicePlaneEnabled",void 0);r.__decorate([g.parameter()],e.prototype,"vertexColors",void 0);r.__decorate([g.parameter()],e.prototype,"transparent",void 0);r.__decorate([g.parameter()],e.prototype,"polygonOffset",void 0);r.__decorate([g.parameter()],e.prototype,"writeDepth",void 0);r.__decorate([g.parameter()],e.prototype,"sceneHasOcludees",void 0);r.__decorate([g.parameter({count:6})],
e.prototype,"style",void 0);r.__decorate([g.parameter()],e.prototype,"patternSpacing",void 0);r.__decorate([g.parameter()],e.prototype,"lineWidth",void 0);r.__decorate([g.parameter()],e.prototype,"enableOffset",void 0);r.__decorate([g.parameter()],e.prototype,"draped",void 0);r.__decorate([g.parameter({count:4})],e.prototype,"transparencyPassType",void 0);r.__decorate([g.parameter()],e.prototype,"multipassTerrainEnabled",void 0);r.__decorate([g.parameter()],e.prototype,"cullAboveGround",void 0);const n=
new Map([["position",0],["color",3],["uvMapSpace",4],["boundingRect",5]]);p.PatternTechnique=l;p.PatternTechniqueConfiguration=e;p.patternVertexAttributeLocations=n;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){function c(h){const m=new d.ShaderBuilder;h.draped||m.extensions.add("GL_OES_standard_derivatives");const n=1===h.output;m.include(b.Transform,{linearDepth:n});m.include(r.VertexColor,h);m.vertex.uniforms.add("proj","mat4");m.vertex.uniforms.add("view","mat4");n&&(m.include(q.OutputDepth,h),m.vertex.uniforms.add("cameraNearFar","vec2"),m.varyings.add("linearDepth","float"));h.draped?m.vertex.uniforms.add("worldToScreenRatio","float"):(m.vertex.uniforms.add("worldToScreenPerDistanceRatio",
"float"),m.vertex.uniforms.add("camPos","vec3"),m.attributes.add("boundingRect","mat3"));m.attributes.add("position","vec3");m.attributes.add("uvMapSpace","vec4");m.varyings.add("vpos","vec3");m.varyings.add("vuv","vec2");h.multipassTerrainEnabled&&m.varyings.add("depth","float");const z=3===h.style||4===h.style||5===h.style;z&&m.vertex.code.add(g.glsl`
      const mat2 rotate45 = mat2(${g.glsl.float(.70710678118)}, ${g.glsl.float(-.70710678118)},
                                 ${g.glsl.float(.70710678118)}, ${g.glsl.float(.70710678118)});
    `);h.draped||(m.vertex.code.add(g.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),m.vertex.code.add(g.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),m.vertex.code.add(g.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${g.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, camPos, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - camPos);
      }
    `));m.vertex.code.add(g.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${z?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${z?" * rotate45":""};

      ${h.draped?g.glsl`
            float ratio = worldToScreenRatio;
          `:g.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float ratio = worldToScreenPerDistanceRatio / distanceToCamera;

            // Logarithmically discretize ratio to avoid jittering
            float step = 0.1;
            ratio = log(ratio);
            ratio = ceil(ratio / step) * step;
            ratio = exp(ratio);
          `}

      vec2 uvOffset = mod(uvCellOrigin * ratio, ${g.glsl.float(h.patternSpacing)});
      return uvOffset + (uv * ratio);
    }
  `);m.vertex.code.add(g.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${h.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${n?g.glsl`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:g.glsl`transformPosition(proj, view, vpos);`}
    }
  `);m.include(p.Slice,h);m.fragment.include(l.ColorConversion);m.fragment.uniforms.add("matColor","vec4");h.draped&&m.fragment.uniforms.add("texelSize","float");4===h.output&&m.include(y.OutputHighlight);h.multipassTerrainEnabled&&(m.fragment.include(f.ReadLinearDepth),m.include(w.multipassTerrainTest,h));4!==h.output&&(m.fragment.code.add(g.glsl`
      const float lineWidth = ${g.glsl.float(h.lineWidth)};
      const float spacing = ${g.glsl.float(h.patternSpacing)};
      const float spacingINV = ${g.glsl.float(1/h.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),h.draped||m.fragment.code.add(g.glsl`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));m.fragment.code.add(g.glsl`
    void main() {
      discardBySlice(vpos);
      ${h.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${h.attributeColor?"vColor * matColor;":"matColor;"}
      color = highlightSlice(color, vpos);

      ${4!==h.output?g.glsl`color.a *= ${u(h)};`:""}

      if (color.a < ${g.glsl.float(e.symbolAlphaCutoff)}) {
        discard;
      }

      ${7===h.output?g.glsl`gl_FragColor = vec4(color.a);`:""}

      ${0===h.output?g.glsl`gl_FragColor = color; ${h.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
      ${4===h.output?g.glsl`outputHighlight();`:""}
      ${1===h.output?g.glsl`outputDepth(linearDepth);`:""};
    }
  `);return m}function u(h){function m(n){return h.draped?g.glsl`coverage(vuv.${n}, texelSize)`:g.glsl`sample(vuv.${n})`}switch(h.style){case 3:case 0:return m("y");case 4:case 1:return m("x");case 5:case 2:return g.glsl`
        1.0 - (1.0 - ${m("x")}) * (1.0 - ${m("y")})
      `;default:return"0.0"}}var t=Object.freeze({__proto__:null,build:c});a.PatternShader=t;a.build=c})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n){function z(C,A,B){C&&C.forEach(D=>{const E=A(D);r.isSome(E)&&B(E,D.graphic)})}const k=[0,0,1];d=function(C){function A(D,E,G,K){D=C.call(this,D,E,G,K)||this;D._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};D.ensureDrapedStatus(!1);return D}p._inheritsLoose(A,C);var B=A.prototype;B.doLoad=function(){var D=p._asyncToGenerator(function*(){if(!this._drivenProperties.size){const E=c.validateSymbolLayerSize(this.symbolLayer.size);if(E)throw new b("graphics3dtextsymbollayer:invalid-size",
E);}this._createTextRenderParameters()});return function(){return D.apply(this,arguments)}}();B._createTextRenderParameters=function(){this._textRenderParameters=h.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};B.destroy=function(){C.prototype.destroy.call(this)};B.createGraphics3DGraphic=function(D){D=D.graphic;const E=u.placePointOnGeometry(D.geometry);if(r.isNone(E))return this.logger.warn(`unsupported geometry type for text symbol: ${D.geometry.type}`),
null;const G=this.symbolLayer.text;if(!G)return null;const K=f.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(D,E,G,K)};B.createLabel=function(D,E,G,K){D=D.graphic;const M=u.placePointOnGeometry(D.geometry);if(r.isNone(M))return this.logger.warn(`unsupported geometry type for label: ${D.geometry.type}`),null;const H=E.text;return!H||/^\s+$/.test(H)?null:this._createAs3DShape(D,M,H,E,E,G,K)};B.setGraphicElevationContext=function(D,
E,G=0){D=C.prototype.setGraphicElevationContext.call(this,D,E);D.addOffsetRenderUnits(G);return D};B.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};B.layerElevationInfoChanged=function(D,E){z(D,E,(G,K)=>{this.updateGraphicElevationContext(K,G)});return e.SymbolUpdateType.UPDATE};B.slicePlaneEnabledChanged=function(D,E){z(D,E,G=>{for(const K of G.stageObject.geometryRecords)K.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});
return!0};B.physicalBasedRenderingChanged=function(){return!0};B.pixelRatioChanged=function(){return!1};B.updateGraphicElevationContext=function(D,E){this.setGraphicElevationContext(D,E.elevationContext,E.metadata.elevationOffset);E.needsElevationUpdates=e.needsElevationUpdates2D(E.elevationContext.mode)||"absolute-height"===E.elevationContext.mode};B._defaultElevationInfoNoZ=function(){return v};B._createAs3DShape=function(D,E,G,K,M=x,H,J){const O=this.setGraphicElevationContext(D,new l.ElevationContext,
M.elevationOffset);var I="polyline"===r.get(D.geometry,"type"),F=D.uid;D=this._context.stage.renderView.renderingContext;var L=c.namedAnchorToHUDMaterialAnchorPos[M.anchor in c.namedAnchorToHUDMaterialAnchorPos?M.anchor:"center"];D=r.isNone(J)?new m(D,G,this._textRenderParameters):null;L={occlusionTest:!0,screenOffset:M.screenOffset,anchorPos:L,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:M.centerOffsetUnits,debugDrawBorder:M.debugDrawBorder,drawInSecondSlot:!0};r.isSome(D)&&(L.textureId=D.id,
L.texCoordScale=D.texcoordScale);r.isSome(J)&&(L.textureId=J.id);if(r.isSome(K)&&r.isSome(K.verticalOffset)){const {screenLength:S,minWorldLength:P,maxWorldLength:Q}=K.verticalOffset;L.verticalOffset={screenLength:q.pt2px(S),minWorldLength:P||0,maxWorldLength:null!=Q?Q:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:S,screenSizePerspectiveSettingsLabels:P}=this._context.sharedResources;L.screenSizePerspective=P.overridePadding(this._textRenderParameters.haloSize);
L.screenSizePerspectiveAlignment=S}I&&(L.shaderPolygonOffset=1E-4);L.slicePlaneEnabled=this._context.slicePlaneEnabled;r.isSome(H)?(J=JSON.stringify(L),K=H.get(J),r.isNone(K)&&(K=new n.HUDMaterial(L),H.add(J,K))):K=new n.HUDMaterial(L);K=[K];J=M.translation;I=r.isSome(D)?[D.displayWidth,D.displayHeight]:[0,0];J=[t.createPointGeometry(k,J,null,I,M.centerOffset,[0,0],null)];F=u.createStageObjectForHUD(this._context,E,J,K,null,null,O,this._context.layer.uid,F);if(null===F)return null;I=w.perObjectElevationAligner;
H=new g.Graphics3DObject3DGraphicLayer(this,F.object,J,r.isNone(H)?K:null,r.isSome(D)?[D]:null,I,O);H.alignedSampledElevation=F.sampledElevation;H.needsElevationUpdates=e.needsElevationUpdates2D(O.mode)||"absolute-height"===O.mode;const {displayWidth:N,displayHeight:R}=r.isSome(D)?D:M;H.getScreenSize=(S=y.create())=>{S[0]=N;S[1]=R;return S};H.metadata={labelText:G,elevationOffset:M.elevationOffset};u.extendPointGraphicElevationContext(H,E,this._context.elevationProvider);return H};return A}(d.Graphics3DSymbolLayer);
const v={mode:"relative-to-ground",offset:0},x={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};a.Graphics3DTextSymbolLayer=d;a["default"]=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define(["exports","../../../../Color","../../../../core/maybe","../../../../core/screenUtils",
"../../../../chunks/vec4f64"],function(a,p,b,r,q){let y=function(){function f(e){this.definition=e;this.key=JSON.stringify(e);this.haloSize=Math.round(e.halo.size);this.fillStyle=this.colorToRGBA(e.color);this.haloStyle=this.colorToRGB(e.halo.color)}var w=f.prototype;w.colorToRGB=function(e){return`rgb(${e.slice(0,3).map(l=>Math.floor(255*l)).toString()})`};w.colorToRGBA=function(e){return`rgba(${e.slice(0,3).map(l=>Math.floor(255*l)).toString()},${e[3]})`};f.fromSymbol=function(e,l=1){var g=b.get(e,
"material","color");g=b.isSome(g)?p.toUnitRGBA(g):q.ZEROS;var d=e.halo;const c=null!=e.size?r.pt2px(e.size):12;e={family:e.font&&e.font.family?e.font.family:"sans-serif",weight:e.font&&e.font.weight?e.font.weight:"normal",style:e.font&&e.font.style?e.font.style:"normal"};d=b.isSome(d)&&b.isSome(d.color)&&0<d.size?{size:r.pt2px(d.size),color:p.toUnitRGBA(d.color)}:{size:0,color:q.ZEROS};return new f({size:c,color:g,font:e,halo:d,pixelRatio:l})};return f}();a.TextRenderParameters=y;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ./ContentObject ./TextRenderer ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context".split(" "),function(a,p,b,r,q,y,f,w){const e={canvas:null};return function(l){function g(c,u,t){var h=l.call(this)||this;h.type=4;h._glTexture=null;h.events=new p;h._requiresPowerOfTwo=!w(c.gl);
h._renderer=new y.TextRenderer(u,t);return h}a._inheritsLoose(g,l);var d=g.prototype;d.createDescriptor=function(c){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:c.parameters.maxMaxAnisotropy}};d.load=function(c){if(r.isSome(this._glTexture))return this._glTexture;const u=y.getTextHelperCanvas(e,this.textureWidth,this.textureHeight),t=u.getContext("2d");t.save();this._renderer.render(t,0,this.textureHeight-
this._renderer.renderedHeight);this._glTexture=new f(c,this.createDescriptor(c),u);t.restore();return this._glTexture};d.unload=function(){r.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);this.events.emit("unloaded")};a._createClass(g,[{key:"width",get:function(){return this._renderer.renderedWidth}},{key:"height",get:function(){return this._renderer.renderedHeight}},{key:"textureWidth",get:function(){const c=this.width;return this._requiresPowerOfTwo?b.nextHighestPowerOfTwo(c):
c}},{key:"textureHeight",get:function(){const c=this.height;return this._requiresPowerOfTwo?b.nextHighestPowerOfTwo(c):c}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}},{key:"texcoordScale",get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]}},{key:"requiresFrameUpdates",get:function(){return!1}}]);return g}(q.ContentObject)})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe"],function(a,p,b){function r(w,e,l){w.canvas||(w.canvas=document.createElement("canvas"));w.canvas.width=e;w.canvas.height=l;return w.canvas}let q=function(){function w(l,g,d=2048){this.text=l;this._parameters=g;this.maxSize=d;this._lineWidths=[];this._displayWidth=this._renderPixelRatio=null;this.key=`${this._parameters.key}--${l}`;this._lines=l.split(/\r?\n/);this._lineHeight=this.computeLineHeight()}var e=w.prototype;e.getLineXOffset=
function(l){return Math.round((this.renderedWidth-this._lineWidths[l]*this.renderPixelRatio)/2)};e.render=function(l,g=0,d=0){const c=this.renderedLineHeight;var u=this.renderedHaloSize,t=l.textAlign,h=this.renderedWidth;t=("center"===t?.5*h:"right"===t?h:0)+u;h=u+1;l.save();0<u&&this.renderHalo(l,t,h,g,d);this.setFontProperties(l,this.renderedFontSize);d+=h;g+=t;for(u=0;u<this._lines.length;++u)l.globalCompositeOperation="destination-out",l.fillStyle="rgb(0, 0, 0)",t=this._lines[u],h=this.getLineXOffset(u),
l.fillText(t,g+h,d),l.globalCompositeOperation="source-over",l.fillStyle=this._parameters.fillStyle,l.fillText(t,g+this.getLineXOffset(u),d),d+=c;l.restore()};e.renderHalo=function(l,g,d,c,u){const t=this.renderedWidth,h=this.renderedHeight,m=r(f,Math.max(t,512),Math.max(h,512)),n=m.getContext("2d");n.clearRect(0,0,t,h);this.setFontProperties(n,this.renderedFontSize);n.fillStyle=this._parameters.haloStyle;n.strokeStyle=this._parameters.haloStyle;const z=3>this.renderedHaloSize;n.lineJoin=z?"miter":
"round";z?this.renderHaloEmulated(n,g,d):this.renderHaloNative(n,g,d);l.globalAlpha=this._parameters.definition.halo.color[3];l.drawImage(m,0,0,t,h,c,u,t,h);l.globalAlpha=1};e.renderHaloEmulated=function(l,g,d){const c=this.renderedLineHeight,u=this.renderedHaloSize;for(let t=0;t<this._lines.length;++t){const h=this._lines[t],m=this.getLineXOffset(t);for(const [n,z]of y)l.fillText(h,g+m+u*n,d+u*z);d+=c}};e.renderHaloNative=function(l,g,d){const c=this.renderedLineHeight,u=this.renderedHaloSize;for(let t=
0;t<this._lines.length;++t){const h=2*u,m=this._lines[t],n=this.getLineXOffset(t);for(let z=0;5>z;z++)l.lineWidth=(.6+.1*z)*h,l.strokeText(m,g+n,d);d+=c}};e.setFontProperties=function(l,g){const d=this._parameters.definition.font;l.font=`${d.style} ${d.weight} ${g}px ${d.family}, sans-serif`;l.textAlign="left";l.textBaseline="top"};e._ensureTextWidth=function(){if(b.isSome(this._displayWidth))return this._displayWidth;const l=r(f,512,512).getContext("2d");this.setFontProperties(l,this._parameters.definition.size);
let g=0,d=2*this._parameters.haloSize;this._lineWidths.length=0;var c=this._parameters.definition.font;if("italic"===c.style||"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&600<c.weight)d+=.3*l.measureText("A").width;for(const u of this._lines)c=Math.round(l.measureText(u).width+d),this._lineWidths.push(c),g=Math.max(g,c);return this._displayWidth=g};e.computeLineHeight=function(){return Math.ceil(1.275*this._parameters.definition.size+
2*this._parameters.haloSize)+1};p._createClass(w,[{key:"displayWidth",get:function(){return this._ensureTextWidth()}},{key:"displayHeight",get:function(){return this._lineHeight*this._lines.length}},{key:"renderedWidth",get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)}},{key:"renderedHeight",get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)}},{key:"renderedLineHeight",get:function(){return Math.round(this._lineHeight*this.renderPixelRatio)}},{key:"renderedFontSize",
get:function(){return this._parameters.definition.size*this.renderPixelRatio}},{key:"renderedHaloSize",get:function(){return this._parameters.haloSize*this.renderPixelRatio}},{key:"renderPixelRatio",get:function(){if(b.isNone(this._renderPixelRatio)){const l=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(l,Math.min(this.maxSize/(this.displayWidth*l),this.maxSize/(this.displayHeight*l))):l}return this._renderPixelRatio}}]);return w}();const y=[];for(let w=0;360>
w;w+=22.5)y.push([Math.cos(Math.PI*w/180),Math.sin(Math.PI*w/180)]);const f={canvas:null};a.TextRenderer=q;a["default"]=q;a.getTextHelperCanvas=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A){const B=["polyline","polygon","extent"];z=function(J){function O(F,L,N,R){return J.call(this,F,L,N,R)||this}p._inheritsLoose(O,J);var I=O.prototype;I.doLoad=function(){var F=p._asyncToGenerator(function*(){});return function(){return F.apply(this,arguments)}}();I.destroy=function(){J.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};I.createGraphics3DGraphic=function(F){F=F.graphic;if(!this._validateGeometry(F.geometry,
B,this.symbolLayer.type))return null;const L=this.setGraphicElevationContext(F,new h.ElevationContext);this.ensureDrapedStatus("on-the-ground"===L.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(F):this._createAs3DShape(F,L,F.uid)};I.ensureMaterial=function(){if(!r.isSome(this._material)){var F={...A.defaultWaterMaterialParameters},L=this.symbolLayer.color;r.isSome(L)&&(F.color=b.toUnitRGBA(L));L=this._getCombinedOpacity(L,{hasIntrinsicColor:!0});F.color=[F.color[0],F.color[1],
F.color[2],L];F.transparent=1>L||this.needsDrivenTransparentPass;F.waveDirection=r.isSome(this.symbolLayer.waveDirection)?O.headingVectorFromAngle(this.symbolLayer.waveDirection):e.fromValues(0,0);L=A.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];F.waveStrength=L.waveStrength;F.waveTextureRepeat=L.textureRepeat;F.waveVelocity=L.waveVelocity;F.flowStrength=L.perturbationStrength;F.slicePlaneEnabled=this._context.slicePlaneEnabled;F.isDraped=this.draped;this._material=
new C.WaterMaterial(F);this._context.stage.add(this._material)}};I.layerOpacityChanged=function(){if(r.isNone(this._material))return!0;const F=this._material.params.color,L=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameterValues({color:[F[0],F[1],F[2],L],transparent:1>L||this.needsDrivenTransparentPass});return!0};I.layerElevationInfoChanged=function(F,L,N){const R=this._elevationContext.mode;N=t.elevationModeChangeUpdateType(O.elevationModeChangeTypes,
N,R);if(N!==t.SymbolUpdateType.UPDATE)return N;const S=t.needsElevationUpdates2D(R);return this.updateGraphics3DGraphicElevationInfo(F,L,()=>S)};I.slicePlaneEnabledChanged=function(){r.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};I.physicalBasedRenderingChanged=function(){return!0};I.pixelRatioChanged=function(){return!0};I._createAs3DShape=function(F,L,N){F=k.geometryAsPolygon(F.geometry);if(r.isNone(F))return null;M.renderData=
k.geometryToRenderInfo(F,this._context.elevationProvider,this._context.renderCoordsHelper,L);const R=M.renderData.position.length/3;M.uvCoords=new Float64Array(2*R);M.outNum=0;M.outGeometries=[];M.outTransforms=[];M.outMaterials=[];this._create3DShapeGeometries(M);this._logGeometryCreationWarnings(M.renderData,F.rings,"rings","WaterSymbol3DLayer");if(0===M.outNum)return null;this._createUVCoordsFromVertices(M.uvCoords,M.renderData.mapPosition,R,this._context.elevationProvider.spatialReference);N=
new v.Object3D({geometries:M.outGeometries,materials:M.outMaterials,transformations:M.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:N}});N=new n.Graphics3DObject3DGraphicLayer(this,N,M.outGeometries,null,null,u.perVertexElevationAligner,L);N.alignedSampledElevation=M.renderData.sampledElevation;N.needsElevationUpdates=t.needsElevationUpdates2D(L.mode);return N};I._createUVCoordsFromVertices=function(F,L,N,R){R=q.getMetersPerUnitForSR(R);c.empty(E);for(var S=0;S<
N;S++)w.set(G,L[3*S],L[3*S+1]),c.expandPointInPlace(E,G);l.scale(E,E,R);S=E[1]%O.unitSizeOfTexture;D[0]=E[0]-E[0]%O.unitSizeOfTexture;D[1]=E[1]-S;for(S=0;S<N;S++)F[2*S]=(L[3*S]*R-D[0])/O.unitSizeOfTexture,F[2*S+1]=(L[3*S+1]*R-D[1])/O.unitSizeOfTexture};I._create3DShapeGeometries=function(F){var L=F.renderData.polygons;const N=F.uvCoords;for(const {count:R,index:S,position:P,mapPosition:Q,holeIndices:V}of L){if(r.isSome(this._context.clippingExtent)&&(d.empty(K),d.expandWithBuffer(K,Q),!d.intersectsClippingArea(K,
this._context.clippingExtent)))continue;L=y.earcut(Q,V,3);if(0===L.length)continue;L=new Uint32Array(L);const ca=new Float64Array(N.buffer,2*S*N.BYTES_PER_ELEMENT,2*R);L=k.createWaterGeometry({indices:L,attributeData:{position:P,uv0:ca,mapPosition:Q}});F.outGeometries.push(L);F.outMaterials.push(r.unwrap(this._material));F.outTransforms.push(f.IDENTITY);F.outNum++}};I._createAsOverlay=function(F){const L=k.geometryAsPolygon(F.geometry);if(r.isNone(L))return null;r.unwrap(this._material).renderPriority=
this._renderPriority;H.renderData=k.geometryToRenderInfoDraped(L,this._context.overlaySR);const N=H.renderData.position.length/3;H.uvCoords=new Float64Array(2*N);H.outNum=0;H.outGeometries=[];H.outBoundingBox=d.empty();H.layerUid=this._context.layer.uid;H.graphicsUid=F.uid;this._createAsOverlayWater(H);this._logGeometryCreationWarnings(H.renderData,L.rings,"rings","WaterSymbol3DLayer");if(0===H.outNum)return null;this._createUVCoordsFromVertices(H.uvCoords,H.renderData.position,N,this._context.overlaySR);
return 0<H.outNum?new m(this,H.outGeometries,H.outBoundingBox):null};I._createAsOverlayWater=function(F){const L=F.uvCoords;var N=F.renderData.polygons;for(const {position:S,holeIndices:P,index:Q,count:V}of N)if(d.empty(K),d.expandWithBuffer(K,S),d.intersectsClippingArea(K,this._context.clippingExtent)&&(d.expandWithAABB(F.outBoundingBox,K),N=y.earcut(S,P,3),0!==N.length)){N=new Uint32Array(N);var R=new Float64Array(L.buffer,2*Q*L.BYTES_PER_ELEMENT,2*V);N=k.createWaterGeometry({indices:N,attributeData:{position:S,
uv0:R}});N=new x.RenderGeometry(N,r.unwrap(this._material),F.layerUid,F.graphicsUid);R=K;l.set(N.boundingSphere,.5*(R[0]+R[3]),.5*(R[1]+R[4]),0,.5*Math.sqrt((R[3]-R[0])*(R[3]-R[0])+(R[4]-R[1])*(R[4]-R[1])));F.outGeometries.push(N);F.outNum++}};O.headingVectorFromAngle=function(F){const L=e.create();F=g.toRadian(F);L[0]=Math.sin(F);L[1]=Math.cos(F);return L};p._createClass(O,[{key:"test",get:function(){return{create3DShape:F=>this._createAs3DShape(F.graphic,F.elevationContext,F.graphicUid),ensureMaterial:()=>
this.ensureMaterial()}}}]);return O}(z.Graphics3DSymbolLayer);z.unitSizeOfTexture=100;z.elevationModeChangeTypes={definedChanged:t.SymbolUpdateType.RECREATE,staysOnTheGround:t.SymbolUpdateType.NONE,onTheGroundChanged:t.SymbolUpdateType.RECREATE};const D=e.create(),E=c.create(),G=e.create(),K=d.create(),M={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},H={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,
outMaterials:null,outTransforms:null};a.Graphics3DWaterSymbolLayer=z;a["default"]=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../lib/AnimationTimer ../lib/Material ../lib/OrderIndependentTransparency ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/waterMaterialUtils".split(" "),function(a,p,b,r,q,y,f,w,e,l){r=function(g){function d(u){u=
g.call(this,u,l.defaultWaterMaterialParameters)||this;u.animation=new b.AnimationTimer;u.techniqueConfig=new f.WaterTechniqueConfiguration;return u}p._inheritsLoose(d,g);var c=d.prototype;c.getTechniqueConfig=function(u,t){this.techniqueConfig.output=u;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.receiveShadows=this.params.receiveShadows;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.useSSR=
this.params.ssrEnabled;this.techniqueConfig.isDraped=this.params.isDraped;this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3;this.techniqueConfig.enableOffset=t?t.camera.relativeElevation<q.OITPolygonOffsetLimit:!0;this.techniqueConfig.multipassTerrainEnabled=t?t.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=t?t.cullAboveGround:!1;return this.techniqueConfig};c.update=function(u){this.animation.enabled=35E3>Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*
Math.min(u.camera.relativeElevation,u.camera.distance);u=this.animation.advance(u);return this.animation.enabled&&u};c.intersect=function(u,t,h,m,n,z,k){e.intersectTriangleGeometry(u,t,m,n,z,void 0,k)};c.getGLMaterial=function(u){if(0===u.output&&this.params.isDraped)return u.output=5,new y.WaterGLMaterial(u);switch(u.output){case 0:case 2:case 4:case 7:return new y.WaterGLMaterial(u)}};c.createBufferWriter=function(){return new w.DefaultBufferWriter(w.PositionUVLayout)};return d}(r.Material);a.WaterMaterial=
r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/time"],function(a,p,b,r){let q=function(){function y(){this.enabled=!0;this._time=0}y.prototype.advance=function(f){if(b.isSome(f.forcedTime)){if(this._time===f.forcedTime)return!1;this._time=f.forcedTime;return!0}return this.enabled?(this._time+=f.dt,0!==f.dt):!1};p._createClass(y,
[{key:"time",get:function(){return r.Milliseconds(this._time)}}]);return y}();a.AnimationTimer=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports","../../../../../chunks/vec2f64","../../lib/Material"],function(a,p,b){p={waveStrength:.06,waveTextureRepeat:32,waveDirection:p.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,
slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...b.materialParametersDefaults};a.defaultWaterMaterialParameters=p;a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,
waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,
perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./Loadable","./symbolComplexity"],function(a,p,b,r){return function(q){function y(w,
e,l){e=q.call(this,e)||this;e.symbol=w;e.convert=l;e.graphics3DSymbol=null;e.referenced=0;return e}a._inheritsLoose(y,q);var f=y.prototype;f.getSymbolLayerSize=function(w){return p.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(w):null};f.doLoad=function(){var w=a._asyncToGenerator(function*(e){e=yield this.symbol.fetchSymbol({signal:e});e.id=this.symbol.id;this.graphics3DSymbol=this.convert(e);yield this.graphics3DSymbol.load()});return function(e){return w.apply(this,arguments)}}();
f.createGraphics3DGraphic=function(w){return p.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(w,this):null};f.globalPropertyChanged=function(w,e){return p.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(w,e):!1};f.applyRendererDiff=function(w,e){return p.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(w,e):!1};f.prepareSymbolPatch=function(w){p.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(w)};f.updateGeometry=
function(w,e){return p.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(w,e):!1};f.onRemoveGraphic=function(){};f.getFastUpdateStatus=function(){return p.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};f.destroy=function(){p.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;this.abortLoad()};a._createClass(y,[{key:"extentPadding",get:function(){return p.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:
0}},{key:"complexity",get:function(){return p.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:r.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]);return y}(b.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){function d(B){B=l.getGraphics3DSymbol(B.graphics3DGraphic.graphics3DSymbol);return r.isSome(B)?B.symbol.symbolLayers.getItemAt(0):null}function c(B,D){var E=D.graphics3DGraphic.graphic.geometry;if(r.isNone(E))return null;if(r.isSome(D.disablePlacement))return D.labelClass.labelPlacement?(k.warnOncePerTick(u(B.placement,D.disablePlacement.logEntityDescription)),t(D)):B;E=E.type;switch(E){case "polyline":case "polygon":case "extent":case "multipoint":if(D.labelClass.labelPlacement)return k.warnOncePerTick(u(B.placement,
`'${E}' geometries`)),t(D)}return B}function u(B,D){return`the requested label placement '${B}' is currently unsupported for ${D} in SceneView`}function t(B){const D=B.graphics3DGraphic.graphic.geometry;if(r.isNone(D))return null;switch(D.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return B=d(B),r.isSome(B)&&"extrude"===B.type?v["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};
case "point":return v["above-center"];case "mesh":return v["above-center"]}}function h(B,D=C){({graphics3DGraphic:B}=B);B=B.graphics[0];(B=r.isSome(B)?B.stageObject.geometryRecords[0].material:null)&&B instanceof g.HUDMaterial?(B=B.params.anchorPos,D[0]=2*(B[0]-.5),D[1]=2*(B[1]-.5)):(D[0]=0,D[1]=0);return D}function m(B,D,E){E=r.isSome(E)?E.getBoundingBoxObjectSpace(A):A;E=f.fromValues(E[3]-E[0],E[4]-E[1],E[5]-E[2]);B.centerOffset[0]=Math.sqrt(E[0]*E[0]+E[1]*E[1])/2*D.normalizedOffset[0];const G=
B.translation[2],K=E[2]/2*D.normalizedOffset[1];B.translation[2]=0;B.elevationOffset=G+K;E=y.length(E);B.centerOffset[2]=E/2*D.normalizedOffset[2]}function n(B){const D=B.labelClass.labelPlacement,{labelSymbol:E,graphics3DGraphic:G}=B;var K=l.getGraphics3DSymbol(G.graphics3DSymbol);K=r.isSome(K)?K.symbol:null;B=v[D]||t(B);if("point-3d"===K.type&&K.supportsCallout()&&K.hasVisibleVerticalOffset()&&!G.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:z(K.verticalOffset),anchor:null,
normalizedOffset:null};if(E&&E.hasVisibleVerticalOffset()&&("point-3d"!==K.type||!K.supportsCallout()||!K.verticalOffset||G.isDraped)){a:switch(B.placement){case "above-center":K=!0;break a;default:K=!1}return K?{placement:"above-center",verticalOffset:z(E.verticalOffset),anchor:"bottom",normalizedOffset:[0,B.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(k.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+D+" placement)"),
null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function z(B){const {screenLength:D,minWorldLength:E,maxWorldLength:G}=B;return{screenLength:D,minWorldLength:E,maxWorldLength:G}}const k=b.getLogger("esri.views.3d.layers.graphics.labelPlacement"),v={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",
normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",
normalizedOffset:[1,0,0],anchor:"left"}};p={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const B in p){const D=v[B];p[B].forEach(E=>{v[E]=D})}Object.freeze&&(Object.freeze(v),Object.keys(v).forEach(function(B){Object.freeze(v[B]);Object.freeze(v[B].normalizedOffset)}));const x=[0,0],C=[0,0],A=e.create();a.get=function(B){var D=n(B);if(r.isNone(D))return null;if(D.anchor)var E=D;else{E=B.labelClass.labelPlacement;var G=v[E],K=G||t(B);E&&!G&&k.warnOncePerTick(`the requested label placement '${E}' is not currently supported in SceneView`);
E=c(K,B)}if(r.isNone(E))return null;G=!!D.hasLabelVerticalOffset;D={anchor:E.anchor,verticalOffset:D.verticalOffset,screenOffset:q.create(),centerOffset:w.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:f.create(),elevationOffset:0,hasLabelVerticalOffset:G};G=B.graphics3DGraphic.graphic.geometry;if(r.isNone(G))B=null;else{switch(G.type){case "point":K=d(B);if(!r.isNone(K))switch(G=B.graphics3DGraphic.graphics[0],r.isSome(G)?G.getCenterObjectSpace(D.translation):y.set(D.translation,0,0,
0),K.type){case "icon":case "text":({graphics3DGraphic:K}=B);G=r.isSome(G)?G.getScreenSize():null;!K.isDraped&&r.isSome(G)?(B=h(B),x[0]=G[0]/2*(E.normalizedOffset[0]-B[0]),x[1]=G[1]/2*(E.normalizedOffset[1]-B[1]),D.screenOffset[0]=x[0],D.hasLabelVerticalOffset?(D.centerOffset[1]=x[1],D.centerOffsetUnits="screen"):D.screenOffset[1]=x[1]):D.hasLabelVerticalOffset||"center"===D.anchor||(v[B.labelClass.labelPlacement]&&k.warnOncePerTick(`the requested placement '${E.placement}' is currently unsupported for draped graphics`),
D.anchor="center");break;case "object":m(D,E,G)}break;case "polygon":G=d(B);if(!r.isNone(G))switch(G.type){case "extrude":B=B.graphics3DGraphic.graphics[0],r.isSome(B)?(B.getBoundingBoxObjectSpace(A),e.center(A,D.translation),D.translation[2]=e.height(A)/2):y.set(D.translation,0,0,0),m(D,E,B)}break;case "mesh":m(D,E,B.graphics3DGraphic.graphics[0])}B=D}return B};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(a){let p=
function(){function b(q){this._stage=q;this._materials=new Map}var r=b.prototype;r.get=function(q){return this._materials.get(q)};r.add=function(q,y){this._materials.set(q,y);this._stage.add(y)};r.dispose=function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return b}();a.MaterialCollection=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../support/Scheduler ../../../webgl/Texture".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){var m;a.TextTextureAtlas=m=function(n){function z(v){v=n.call(this,v)||this;v.type=4;v.id=e.generateUID();v.events=new q;v.glTexture=null;v.needsClear=!1;v.elementsToAddOrUpdate=new Map;v.elementsToRemove=new Map;v.elementsToRender=new Map;v.elements=new Map;v.stageObjects=new Map;v.updating=!1;return v}p._inheritsLoose(z,n);var k=z.prototype;k.initialize=function(){this.stage=this.view._stage;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");
this.stage.add(this);const v=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(v);this.update2DCanvasSize();this.resetAtlasCursor()};k.unload=function(){w.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);this.events.emit("unloaded")};k.createDescriptor=function(v){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:v.parameters.maxMaxAnisotropy}};k.load=
function(v){if(w.isSome(this.glTexture))return this.glTexture;this.glTexture=new h(v,this.createDescriptor(v),this.canvas);this.frameWorker=this.view.resourceController.scheduler.registerTask(t.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this.glTexture};k.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAddOrUpdate=this.elements=null;this.frameWorker=w.removeMaybe(this.frameWorker);this.glTexture&&(this.stage.remove(this),this.glTexture=null);this.canvas.width=
0;this.canvas.height=0;this.ctx=this.canvas=null};k.create2DCanvas=function(){const v=document.createElement("canvas");v.setAttribute("id","canvas2d");v.setAttribute("style","display:none");v.setAttribute("width",(512).toString());v.setAttribute("height",(512).toString());return v};k.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};k.createAtlasRegion=function(v=512){this.atlas={size:{width:v,
height:v},cursor:{x:0,y:0},lineHeight:0}};k.computeAtlasResolution=function(v,x){v=Math.max(v,x);v=f.nextHighestPowerOfTwo(v+256);return v=Math.min(v,4096)};k.resizeAtlas=function(v,x){x=x||v;const C=this.atlas;C.size.width=v;C.size.height=x;w.isSome(this.glTexture)&&this.glTexture.resize(v,x);this.update2DCanvasSize()};k.resetAtlasCursor=function(){const v=this.atlas;v.cursor.x=2;v.cursor.y=4;v.lineHeight=0;this.needsClear=!0};k.getAtlasUsage=function(){const v=this.atlas;return(v.cursor.x+v.cursor.y*
v.size.width)/(v.size.width*v.size.height)};k.getExpectedAtlasUsage=function(){const v=this.elementsToRemove.size,x=this.elementsToAddOrUpdate.size,C=this.elements.size;return this.getAtlasUsage()/C*(C+x-v)};k.addAtlasElement=function(v,x,C,A){const B=this.atlas,{renderedWidth:D,renderedHeight:E,displayWidth:G,displayHeight:K}=v.textRenderer;v.placement.offset.x=B.cursor.x;v.placement.offset.y=B.cursor.y;v.placement.size.width=D;v.placement.size.height=E;v.placement.size.displayWidth=G;v.placement.size.displayHeight=
K;v.placement.uvMinMax=[v.placement.offset.x/B.size.width,1-(v.placement.offset.y+E)/B.size.height,(v.placement.offset.x+D)/B.size.width,1-v.placement.offset.y/B.size.height];B.cursor.x+=C;B.lineHeight=Math.max(B.lineHeight,A);this.elements.set(x,v)};k.removeAtlasElement=function(v){if(v&&this.elements.has(v.textId)){const x=v.placement.offset,C=v.placement.size;this.ctx.clearRect(x.x,x.y,C.width,C.height);this.elements.delete(v.textId)}};k.ensureStageObjects=function(v){var x=this.stageObjects.get(v);
if(x)return x;x=new Set;this.stageObjects.set(v,x);return x};k.addStageObject=function(v,x){this.ensureStageObjects(v).add(x)};k.removeStageObject=function(v,x){(v=this.stageObjects.get(v))&&v.delete(x)&&(x.geometries[0].vertexAttributes.get("size").data=[0,0],x.geometryVertexAttrsUpdated(0))};k._processAddition=function(v,x){const C=this.atlas;var A=v.textId;const B=v.textRenderer.renderedWidth+2,D=v.textRenderer.renderedHeight+2+2;if(C.cursor.x+B<C.size.width&&C.cursor.y+D<C.size.height)this.addAtlasElement(v,
A,B,D),this.elementsToRender.set(A,v),this.elementsToAddOrUpdate.delete(A);else if(C.cursor.y+D+C.lineHeight<C.size.height)C.cursor.x=2,C.cursor.y+=C.lineHeight,C.lineHeight=0,this.addAtlasElement(v,A,B,D),this.elementsToRender.set(A,v),this.elementsToAddOrUpdate.delete(A);else{v=this.getExpectedAtlasUsage();(A=.85<v&&4096>C.size.width)&&this.resizeAtlas(2*C.size.width,2*C.size.height);if(!x||!A&&.95<v&&4096===C.size.width)return this.processRemovals(),0;this.repack();return 1}return 0};k.processRemovals=
function(){this.elementsToRemove.forEach((v,x)=>{const C=this.stageObjects.get(x);C&&0!==C.size||this.removeAtlasElement(v);C&&0===C.size&&this.stageObjects.delete(x)});this.elementsToRemove.clear()};k.repack=function(){this.processRemovals();this.elements.forEach((v,x)=>{v.rendered=!1;this.elementsToAddOrUpdate.set(x,v)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};k.processRenderingRequest=function(v){this.ctx.clearRect(v.placement.offset.x,v.placement.offset.y,
v.placement.size.width,v.placement.size.height);v.textRenderer.render(this.ctx,v.placement.offset.x,v.placement.offset.y);const x=this.stageObjects.get(v.textId);x&&x.forEach(C=>{C.geometries[0].vertexAttributes.get("uv0").data=new Float32Array(v.placement.uvMinMax);C.geometries[0].vertexAttributes.get("size").data=[v.placement.size.displayWidth,v.placement.size.displayHeight];C.geometryVertexAttrsUpdated(0)});v.rendered=!0};k.runTask=function(v,x=!0){if(this.glTexture){var C=!1;y.someMap(this.elementsToAddOrUpdate,
(B,D)=>(B=this.elements.get(D))&&B.rendered?((B=this.stageObjects.get(D))&&B.forEach(E=>{const G=E.geometries[0].vertexAttributes,K=this.elements.get(D);G.get("uv0").data=new Float32Array(K.placement.uvMinMax);G.get("size").data=new Float32Array([K.placement.size.displayWidth,K.placement.size.displayHeight]);E.geometryVertexAttrsUpdated(0)}),this.elementsToAddOrUpdate.delete(D),!1):1===this._processAddition(this.elementsToAddOrUpdate.get(D),x)?C=!0:!1);if(C)this.runTask(t.noBudget,!1);else{var A=
!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);y.someMap(this.elementsToRender,(B,D)=>{this.processRenderingRequest(B);this.elementsToRender.delete(D);A=!0;v.madeProgress();return v.done});A&&w.isSome(this.glTexture)&&this.glTexture.setData(this.canvas);this.updating=0<this.elementsToRender.size;!this.updating&&m.test.orderedRepackingEnabled&&this.repackOrdered()}}};k.addTextTexture=function(v,x){const C=v.key;this.elementsToAddOrUpdate.has(C)||
this.elementsToAddOrUpdate.set(C,{textId:C,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:v,rendered:!1});this.addStageObject(C,x);this.elementsToRemove.delete(C);this.setDirty()};k.removeTextTexture=function(v,x){v=v.key;this.elementsToRemove.set(v,this.elements.get(v));this.removeStageObject(v,x)};k.setDirty=function(){this.updating=!0};k.repackOrdered=function(){if(0!==this.elements.size){var v=[];this.elements.forEach((C,A)=>v.push({element:C,
key:A}));var x=!0;for(let C=0;C<v.length-1;C++)if(0<v[C].key.localeCompare(v[C+1].key)){x=!1;break}if(!x||this.elementsToRemove.size){v.sort((C,A)=>C.key.localeCompare(A.key));this.elements.clear();for(const {element:C,key:A}of v)this.elements.set(A,C);this.repack();this.setDirty()}}};p._createClass(z,[{key:"width",get:function(){return this.atlas.size.width}},{key:"height",get:function(){return this.atlas.size.height}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"running",get:function(){return this.updating}},
{key:"test",get:function(){const {elements:v,stageObjects:x,elementsToRemove:C,atlas:A}=this,B=this;return{elements:v,stageObjects:x,elementsToRemove:C,atlas:A,resizeAtlas:(D,E)=>B.resizeAtlas(D,E),run:(D,E)=>B.runTask(D,E)}}}]);return z}(r);a.TextTextureAtlas.test={orderedRepackingEnabled:!1};b.__decorate([l.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);b.__decorate([l.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=m=b.__decorate([u.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
a.TextTextureAtlas);a["default"]=a.TextTextureAtlas;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(a,p,b,r,q,y,f,w,e){let l=function(){function d(){this.gltfCache=new Map;this.wosrCache=
new Map;this.evictHandles=new b}var c=d.prototype;c.loadGLTF=function(u,t,h){return this.fromCache(this.gltfCache,h?`gltfPBR:${u}`:`gltf:${u}`,m=>w.load(new f.DefaultLoadingContext(m.streamDataRequester),u,m,h),t)};c.loadWOSR=function(u,t){return this.fromCache(this.wosrCache,`wosr:${u}:${t.disableTextures}`,h=>e.load(u,h),t)};c.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};c.fromCache=function(u,t,h,m){return new Promise((n,z)=>{if(y.isAborted(m))z(y.createAbortError());
else{var k=y.onAbort(m,()=>{this.remove(u,t);z(y.createAbortError())}),v=u.get(t);if(v)this.evictHandles.remove(t),v.refCount++,v.item.then(n,z);else{v=y.createAbortController();var x={refCount:1,abortController:v,item:h({...m,signal:v.signal}).then(C=>{x.abortController=null;C.remove=()=>this.remove(u,t);return C})};u.set(t,x);x.item.then(C=>{q.isSome(k)&&k.remove();n(C)},C=>{q.isSome(k)&&k.remove();z(C)})}}})};c.remove=function(u,t){const h=u.get(t);h&&(h.refCount--,0===h.refCount&&this.evictHandles.add(r.timeoutHandle(()=>
{u.delete(t);q.isSome(h.abortController)&&h.abortController.abort()},g),t))};p._createClass(d,[{key:"size",get:function(){return this.wosrCache.size+this.gltfCache.size}}]);return d}(),g=1E4;a.ObjectResourceCache=l;a.test={overrideEvictDelay(d){g=d;return{remove(){g=1E4}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z){const k=f.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");a.FeatureTileTree3D=function(C){function A(D){D=C.call(this,D)||this;D.tiles=new q;D.tileSize=512;D._idToTile=new Map;D._handles=new y;D._clients=new Set;D._dirty=!1;D._newTiles=new e;return D}p._inheritsLoose(A,C);var B=A.prototype;B.initialize=function(){this._handles.add(this.watch(["tilingScheme","tileSize"],()=>this._reset(),!0));this._handles.add(l.init(this,["tileSize","cameraOnSurface.location",
"tilingScheme","viewState.contentCamera","focus.location"],()=>this._setDirty(),!0));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(z.TaskPriority.FEATURE_TILE_TREE,this))};B.destroy=function(){this._frameWorker=w.removeMaybe(this._frameWorker);this._handles=w.destroyMaybe(this._handles)};B.addClient=function(){const D=v++;this._clients.add(D);1===this._clients.size&&this._setDirty();return{remove:()=>this._removeClient(D)}};B._removeClient=function(D){this._clients.delete(D);this._hasClients||
this._clear()};B._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(z.noBudget))};B._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};B.runTask=function(D){this._dirty=!1;this._pendingTiles||(this._startUpdate(),w.isSome(this._frameWorker)&&(this._frameWorker.priority=z.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(D);
!this._pendingTiles&&w.isSome(this._frameWorker)&&(this._frameWorker.priority=z.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")};B._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new m.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=
this._getRootTiles()):this._clear())};B._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};B._getRootTiles=function(){return this.rootTileIds.map(D=>new h.FeatureTileDescriptor3D(D[0],D[1],D[2],this.tilingScheme))};B._purgeHorizonTiles=function(D){D.sort((E,G)=>{E=E.measures.screenRect;G=G.measures.screenRect;return E[1]+E[3]-(G[1]+G[3])});t.empty(x);for(let E=0;E<D.length;E++)if(t.expand(x,D.data[E].measures.screenRect,x),10<t.height(x))return D.data.slice(E,
D.length);return[]};B._subdivideTilesForView=function(D){if(this._pendingTiles){for(;0<this._pendingTiles.length&&!D.done;){const E=this._pendingTiles.pop();D.madeProgress();if(!this.filterExtentRect||t.intersects(this.filterExtentRect,E.extent))this._tileMeasurements.updateTile(E),0!==E.measures.visibility&&(E.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(E.lij[0]+1),this._pendingTiles.push(...E.getChildren())):this._newTiles.push(E))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),
this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};B._updateTiles=function(D){for(var E of this.tiles.items)E.used=!1;D=D.filter(G=>{const K=this._idToTile.get(G.id);K?(K.copyMeasurementsFrom(G),K.used=!0):this._idToTile.set(G.id,G);return!K});E=this.tiles.items.filter(G=>G.used?!1:(this._idToTile.delete(G.id),!0));this.tiles.removeMany(E);this.tiles.addMany(D);this.sortTiles()};B.sortTiles=function(){this.viewState.fixedContentCamera||this.tiles.sort((D,E)=>D.measures.visibility!==
E.measures.visibility?2===D.measures.visibility?-1:1:D.measures.distance-E.measures.distance);this.tiles.forEach((D,E)=>D.loadPriority=E)};p._createClass(A,[{key:"tilingScheme",get:function(){const D=this.tilingSchemeOwner.tilingScheme;return D?D.clone():null}},{key:"filterExtent",set:function(D){if(w.isSome(D)&&!D.spatialReference.equals(this.viewState.spatialReference))k.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var E=this._get("filterExtent");
E===D||w.isSome(E)&&D&&E.equals(D)||(D=w.isSome(D)?D.clone():null,this._set("filterExtent",D),this._setDirty())}}},{key:"filterExtentRect",get:function(){if(w.isNone(this.filterExtent)||!this.tilingScheme)return null;const D=t.create();n.toBoundingRect(this.filterExtent,D,this.tilingScheme.spatialReference);return D}},{key:"rootTileIds",get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}},{key:"suspended",set:function(D){D!==this._get("suspended")&&
(this._set("suspended",D),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}},{key:"running",get:function(){return this.updating}}]);return A}(r);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,
"tilingSchemeOwner",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",void 0);b.__decorate([g.property()],a.FeatureTileTree3D.prototype,"tiles",void 0);b.__decorate([g.property()],
a.FeatureTileTree3D.prototype,"tileSize",void 0);b.__decorate([g.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);b.__decorate([g.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);b.__decorate([g.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"filterExtentRect",null);b.__decorate([g.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"rootTileIds",null);b.__decorate([g.property({value:!1})],a.FeatureTileTree3D.prototype,"suspended",null);b.__decorate([g.property({readOnly:!0})],
a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=b.__decorate([u.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let v=0;const x=t.create();a["default"]=a.FeatureTileTree3D;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],function(a,p){let b=function(){function r(y,f,w,e=null){this.lij=[0,0,0];this.extent=p.create();
this.loadPriority=this.resolution=0;this.measures={visibility:2,screenRect:p.create(),distance:0,shouldSplit:!1};this.used=!1;e&&this.acquire(y,f,w,e)}var q=r.prototype;q.acquire=function(y,f,w,e){this.tilingScheme=e;this.id=r.id(y,f,w);this.lij[0]=y;this.lij[1]=f;this.lij[2]=w;e.getExtent(y,f,w,this.extent);this.resolution=e.resolutionAtLevel(y)};q.release=function(){this.tilingScheme=null};q.getChildren=function(y){const f=this.lij[0]+1,w=2*this.lij[1],e=2*this.lij[2];if(!y)return[new r(f,w,e,this.tilingScheme),
new r(f,w+1,e,this.tilingScheme),new r(f,w,e+1,this.tilingScheme),new r(f,w+1,e+1,this.tilingScheme)];y[0].acquire(f,w,e,this.tilingScheme);y[1].acquire(f,w+1,e,this.tilingScheme);y[2].acquire(f,w,e+1,this.tilingScheme);y[3].acquire(f,w+1,e+1,this.tilingScheme);return y};q.copyMeasurementsFrom=function(y){this.measures.visibility=y.measures.visibility;this.measures.shouldSplit=y.measures.shouldSplit;this.measures.distance=y.measures.distance;p.copy(y.measures.screenRect,this.measures.screenRect)};
r.id=function(y,f,w){return`${y}/${f}/${w}`};return r}();a.FeatureTileDescriptor3D=b;a["default"]=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(a,p,b,r,q,y,f,w,e){let l=function(){function n(k){this.camera=new e;this.focusOnMap=[0,0];this.screenRect=q.create();this.tileSize=k.tileSize;this.renderCoordsHelper=k.renderCoordsHelper;this.tilingScheme=k.tilingScheme;this.visibility=new w.FeatureTileVisibility3D(k.renderCoordsHelper)}var z=n.prototype;z.begin=function(k,v,x){this.camera.copyFrom(k);this.surfaceElevation=x;this.focusOnMap[0]=v.x;this.focusOnMap[1]=v.y;q.fromValues(0,0,k.fullWidth,k.fullHeight,this.screenRect);this.visibility.begin(this.camera,
x)};z.end=function(){this.visibility.end()};z.updateTile=function(k){k.measures.visibility=this.visibility.calculate(k);k.measures.distance=q.distance(k.extent,this.focusOnMap);0!==k.measures.visibility&&this.updateScreenMeasure(k)};z.updateScreenMeasure=function(k){const v=k.measures.screenRect;q.empty(v);let x=0;const C=k.lij[0]+2,A=k.lij[1]<<2,B=k.lij[2]<<2;var D=this.tileSizeWithBias(k);D*=D;for(let E=0;4>E;E++)for(let G=0;4>G;G++)if(x+=this.computeScreenArea(k,C,A+E,B+G,v),x>D){k.measures.shouldSplit=
!0;return}k.measures.shouldSplit=!1};z.tileSizeWithBias=function(k){return 1===k.measures.visibility?5*this.tileSize:this.tileSize};z.computeScreenArea=function(k,v,x,C,A){this.projectToScreen(v,x,C,1===k.measures.visibility,d);q.empty(g);for(k=0;4>k;k++)q.expandPointInPlace(g,d[k]);q.expand(A,g,A);return f.areaPoints2d(d[0],d[1],d[2])+f.areaPoints2d(d[0],d[2],d[3])};z.projectToScreen=function(k,v,x,C,A){this.tilingScheme.ensureMaxLod(k);this.tilingScheme.getExtent(k,v,x,c);this.toRenderCoords(c,
0,3,t[0]);this.toRenderCoords(c,2,3,t[1]);this.toRenderCoords(c,2,1,t[2]);this.toRenderCoords(c,0,1,t[3]);C&&(this.projectToPlane(t,this.camera.frustum[4]),this.projectToPlane(t,this.camera.frustum[3]),this.projectToPlane(t,this.camera.frustum[2]));for(k=0;4>k;k++)this.camera.projectToRenderScreen(t[k],m),this.camera.renderToScreen(m,A[k])};z.projectToPlane=function(k,v){for(var x=0;4>x;x++)h[x]=y.signedDistance(v,k[x]);x=Math.max(h[0],h[1],h[2],h[3]);if(0<x)for(v=b.scale(u,y.normal(v),-x),x=0;4>
x;x++)b.add(k[x],k[x],v)};z.toRenderCoords=function(k,v,x,C){u[0]=k[v];u[1]=k[x];u[2]=this.surfaceElevation;this.renderCoordsHelper.toRenderCoords(u,this.tilingScheme.spatialReference,C);return C};return n}();const g=q.create(),d=[p.createScreenPointArray(),p.createScreenPointArray(),p.createScreenPointArray(),p.createScreenPointArray()],c=q.create(),u=r.create(),t=[r.create(),r.create(),r.create(),r.create()],h=[0,0,0,0],m=p.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=l;a["default"]=
l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/plane ../../../../geometry/support/ray ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),function(a,p,b,r,q,y,f,w,e,l,g){let d=function(){function m(z){this.renderCoordsHelper=
z;this.surfaceElevation=0;this.cache=new Map;this.frustum=new l.Frustum(z);this.extendedFrustum=new l.Frustum(z);this.intersector=new g.FrustumExtentIntersection({renderCoordsHelper:z});this.renderCoordsHelper=z}var n=m.prototype;n.begin=function(z,k){this.surfaceElevation=k;this.aboveGround=this.renderCoordsHelper.getAltitude(z.eye)>k;this.frustum.update(z);this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(z)};n.end=function(){this.cache.clear()};n.calculate=function(z){if(this.allTilesInvisible)return 0;
const k=1===this.renderCoordsHelper.viewingMode&&2<=z.lij[0]&&6>z.lij[0],v=this.getOrCalculateSingleTileVisibility(z,!k);return 0!==v&&k?this.calculateAggregatedChildrenVisibility(z):v};n.shortenFrustumFarPlane=function(z){var k=l.Frustum.nearFarLineIndices;const v=z.mutablePoints;for(const x of k){const [C,A]=x;k=v[C];r.subtract(c,v[A],k);r.scale(c,c,.95);r.add(v[A],k,c)}z.updatePoints(v)};n.calculateAggregatedChildrenVisibility=function(z){let k=0;var v=this.cache.get(z.id);if(null!=v)return v;
v=h.acquire();z.getChildren(v);for(const x of v){const C=this.calculate(x);if(0!==C&&(k=C,2===C))break}h.release(v);this.cache.set(z.id,k);return k};n.getOrCalculateSingleTileVisibility=function(z,k){var v=this.cache.get(z.id);if(null!=v)return v;v=this.calculateSingleTileVisibility(z);k&&this.cache.set(z.id,v);return v};n.calculateSingleTileVisibility=function(z){if(!this.aboveGround&&1===this.renderCoordsHelper.viewingMode&&12>z.lij[0]){if(0===this.calculateSingleTileVisibilitySided(z,!1))return this.calculateSingleTileVisibilitySided(z,
!0)}else return this.calculateSingleTileVisibilitySided(z,this.aboveGround)};n.calculateSingleTileVisibilitySided=function(z,k){this.intersector.update(z.extent,z.tilingScheme.spatialReference,this.surfaceElevation,k);z=y.getReferenceEllipsoid(z.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,z)?this.intersector.isVisibleInFrustum(this.frustum,z,!0)?2:1:0};n.updateExtendedFrustum=function(z){this.extendedFrustum.update(z);this.shortenFrustumFarPlane(this.extendedFrustum);
var k=this.renderCoordsHelper.worldUpAtPosition(z.eye,c);this.aboveGround||r.negate(k,k);k=p.acosClamped(-r.dot(k,z.viewForward));this.allTilesInvisible=k>(Math.PI+z.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=k>z.fovY/2)){z=this.extendedFrustumParameters();k=this.extendedFrustum.mutablePoints;for(let v=0;4>v;v++){const x=z.pointIndices[v],C=k[x],A=this.renderCoordsHelper.getAltitude(C);if(z.needsAltitudeAdjustment(A)){this.renderCoordsHelper.worldUpAtPosition(C,c);switch(x){case 4:case 7:case 0:case 3:f.projectVector(this.extendedFrustum.planes[0],
c,c);break;case 5:case 6:case 1:case 2:f.projectVector(this.extendedFrustum.planes[1],c,c)}r.scale(c,c,z.direction);this.renderCoordsHelper.intersectInfiniteManifold(w.wrap(C,c),z.zWithMargin,C)}}this.extendedFrustum.updatePoints(k);f.fromPoints(k[0],k[1],k[2],u);f.fromPoints(k[1],k[2],k[3],t);0>r.dot(f.normal(u),f.normal(t))&&(z=this.extendedFrustum.mutablePoints,this.aboveGround?[z[0],z[1]]=[z[1],z[0]]:[z[3],z[2]]=[z[2],z[3]],this.extendedFrustum.updatePoints(z))}};n.extendedFrustumParameters=function(){return this.aboveGround?
this.extendedFrustumParametersAboveSurface():this.extendedFrustumParametersBelowSurface()};n.extendedFrustumParametersAboveSurface=function(){const z=this.surfaceElevation-1;return{zWithMargin:z,pointIndices:l.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(k){return k>z}}};n.extendedFrustumParametersBelowSurface=function(){const z=this.surfaceElevation+1;return{zWithMargin:z,pointIndices:l.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(k){return k<z}}};return m}();
const c=q.create(),u=f.create(),t=f.create(),h=new b(Array,m=>{4!==m.length&&(m[0]=new e.FeatureTileDescriptor3D,m[1]=new e.FeatureTileDescriptor3D,m[2]=new e.FeatureTileDescriptor3D,m[3]=new e.FeatureTileDescriptor3D)},m=>{m[0].release();m[1].release();m[2].release();m[3].release()});a.FeatureTileVisibility3D=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3","../../../chunks/vec3f64",
"../../../geometry/support/frustum"],function(a,p,b,r,q){function y(w,e,l){w.origin=e;w.endpoint=l;b.direction(w.direction,e,l)}let f=function(){function w(l){this.renderCoordsHelper=l;this.frustum=q.create();this._points=q.createPoints();this.lines=Array(12);this._origin=r.create();this._direction=r.create();this._altitude=null;for(l=0;12>l;l++)this.lines[l]={origin:null,direction:r.create(),endpoint:null}}var e=w.prototype;e.update=function(l){q.fromMatrix(l.viewMatrix,l.projectionMatrix,this.frustum,
this._points);b.copy(this._origin,l.eye);b.copy(this._direction,l.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this.updateLines()};e.updatePoints=function(l){for(let g=0;g<this._points.length;g++)b.copy(this._points[g],l[g]);q.computePlanes(this.frustum,this._points);this.updateLines()};e.intersectsSphere=function(l){return q.intersectsSphere(this.frustum,l)};e.intersectsRay=function(l){return q.intersectsRay(this.frustum,l)};e.intersectsLineSegment=function(l,g){return q.intersectsLineSegment(this.frustum,
l,g)};e.intersectsPoint=function(l){return q.intersectsPoint(this.frustum,l)};e.updateLines=function(){const l=this._points;for(let g=0;4>g;g++){const d=g+4;y(this.lines[g],l[g],l[d]);y(this.lines[g+4],l[g],3===g?l[0]:l[g+1]);y(this.lines[g+8],l[d],3===g?l[4]:l[d+1])}};p._createClass(w,[{key:"planes",get:function(){return this.frustum}},{key:"points",get:function(){return this._points}},{key:"mutablePoints",get:function(){return this._points}},{key:"direction",get:function(){return this._direction}},
{key:"altitude",get:function(){return this._altitude}}]);return w}();f.planePointIndices=q.planePointIndices;f.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];a.Frustum=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ./intersectionUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){const h=.5*Math.PI,m=h/Math.PI*180;let n=function(){function D(G){this.renderCoordsHelper=G.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:f.create(),direction:f.create()};for(G=0;4>G;G++)this.extent[G]={origin:f.create(),direction:f.create(),cap:{next:null,direction:f.create()}},this.planes[G]=c.create();this.planes[4]=c.create();this.planes[5]=c.create();this.planesWithoutFar=this.planes.slice(0,5)}var E=D.prototype;
E.update=function(G,K,M,H=!0){const J=this.extent;this.toRenderBoundingExtent(G,K,M);y.add(this.center.origin,J[0].origin,J[2].origin);y.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);H||y.scale(this.center.direction,this.center.direction,-1);for(M=0;4>M;M++){const O=J[M];this.renderCoordsHelper.worldUpAtPosition(O.origin,O.direction);const I=J[3===M?0:M+1];O.cap.next=I.origin;y.direction(O.cap.direction,O.origin,
I.origin);c.fromVectorsAndPoint(O.direction,O.cap.direction,O.origin,this.planes[M]);H||y.scale(O.direction,O.direction,-1)}c.fromVectorsAndPoint(J[0].cap.direction,J[1].cap.direction,J[0].origin,this.planes[4]);H?c.negate(this.planes[4],this.planes[5]):(c.copy(this.planes[4],this.planes[5]),c.negate(this.planes[4],this.planes[4]));this.maxSpan=Math.max(Math.abs(G[0]-G[2]),Math.abs(G[1]-G[3]));this.maxSpanSpatialReference=K;this.minGlobalAltitude=.9*e.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};
E.isVisibleInFrustum=function(G,K,M=!1){if(null==G)return!1;if(1===this.renderCoordsHelper.viewingMode){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?m:h*K))return!0;if(G.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(G)}if(0===this.maxSpan)return K=this.extent[0],!M&&G.intersectsRay(u.wrap(K.origin,K.direction))?!0:!1;for(K=0;K<this.extent.length;K++){var H=this.extent[K];if(!M&&G.intersectsRay(u.wrap(H.origin,H.direction))||G.intersectsLineSegment(d.fromPoints(H.origin,
H.cap.next,B),H.cap.direction))return!0}M=M?this.planes:this.planesWithoutFar;for(K=0;K<G.lines.length;K++)if(H=G.lines[K],t.frustumLineSegment(M,H.origin,H.endpoint,H.direction))return!0;return!1};E.toRenderBoundingExtentGlobal=function(G,K,M){g.center(G,k);k[2]=M;w.computeTranslationToOriginAndRotation(K,k,v,this.renderCoordsHelper.spatialReference);r.invert(x,v);l.empty(C);for(const {x0:H,x1:J,y0:O,y1:I}of z)for(let F=0;5>F;F++){const L=F/4;k[0]=b.lerp(G[H],G[J],L);k[1]=b.lerp(G[O],G[I],L);k[2]=
M;w.projectVectorToVector(k,K,k,this.renderCoordsHelper.spatialReference);y.transformMat4(k,k,x);l.expandWithVec3(C,k)}y.set(this.extent[0].origin,C[0],C[1],C[2]);y.set(this.extent[1].origin,C[3],C[1],C[2]);y.set(this.extent[2].origin,C[3],C[4],C[2]);y.set(this.extent[3].origin,C[0],C[4],C[2]);for(G=0;4>G;++G)y.transformMat4(this.extent[G].origin,this.extent[G].origin,v)};E.toRenderBoundingExtentLocal=function(G,K,M){w.projectBoundingRect(G,K,A,this.renderCoordsHelper.spatialReference);y.set(this.extent[0].origin,
A[0],A[1],M);y.set(this.extent[1].origin,A[2],A[1],M);y.set(this.extent[2].origin,A[2],A[3],M);y.set(this.extent[3].origin,A[0],A[3],M)};E.toRenderBoundingExtent=function(G,K,M){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(G,K,M);break;case 2:this.toRenderBoundingExtentLocal(G,K,M);break;default:p.neverReached(this.renderCoordsHelper.viewingMode)}};E.isVisibleInFrustumGlobal=function(G){if(0>y.dot(this.center.direction,G.direction))return!0;for(let K=0;4>K;K++)if(0>
y.dot(this.extent[K].direction,G.direction))return!0;return!1};return D}();const z=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],k=f.create(),v=q.create(),x=q.create(),C=l.create(),A=g.create(),B=d.create();a.FrustumExtentIntersection=n;a["default"]=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(a,
p,b,r){const q=b.create();a.projectToBoundingBox=function(y,f,w){if(p.isNone(y)||p.isNone(w))return!1;let e;q[0]=null!=y.xmin?y.xmin:0;q[1]=null!=y.ymin?y.ymin:0;q[2]=null!=y.zmin?y.zmin:0;e=r.projectBuffer(q,y.spatialReference,0,f,w,0,1);q[0]=null!=y.xmax?y.xmax:0;q[1]=null!=y.ymax?y.ymax:0;q[2]=null!=y.zmax?y.zmax:0;e=e&&r.projectBuffer(q,y.spatialReference,0,f,w,3,1);null==y.xmin&&(f[0]=-Infinity);null==y.ymin&&(f[1]=-Infinity);null==y.zmin&&(f[2]=-Infinity);null==y.xmax&&(f[3]=Infinity);null==
y.ymax&&(f[4]=Infinity);null==y.zmax&&(f[5]=Infinity);return e};a.toBoundingRect=function(y,f,w){if(p.isNone(y))return!1;let e;q[0]=null!=y.xmin?y.xmin:0;q[1]=null!=y.ymin?y.ymin:0;q[2]=null!=y.zmin?y.zmin:0;e=r.projectBuffer(q,y.spatialReference,0,q,w,0,1);f[0]=q[0];f[1]=q[1];q[0]=null!=y.xmax?y.xmax:0;q[1]=null!=y.ymax?y.ymax:0;q[2]=null!=y.zmax?y.zmax:0;e=e&&r.projectBuffer(q,y.spatialReference,0,q,w,0,1);f[2]=q[0];f[3]=q[1];null==y.xmin&&(f[0]=-Infinity);null==y.ymin&&(f[1]=-Infinity);null==y.xmax&&
(f[2]=Infinity);null==y.ymax&&(f[3]=Infinity);return e};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z){b=function(C){function A(){var D=C.apply(this,arguments)||this;D._propertiesPool=new n.PropertiesPool({camera:z},a._assertThisInitialized(D));D._lastSeenCameraProjectionValues=new z;D.events=new r;D.viewingMode=1;D._cameraChanged=!1;D.updateQueue=[];D.processingUpdates=!1;return D}a._inheritsLoose(A,C);var B=A.prototype;B.init=function(D,E){this._set("viewingMode",D);this._set("spatialReference",E);this._set("constraints",new t["default"]({mode:this.viewingMode}))};
B.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new n.PropertiesPool({camera:z},this)};B.createInitialCamera=function(){if(1===this.viewingMode){const D=c.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new z(d.fromValues(4*D,0,0),d.fromValues(D,0,0),d.fromValues(0,0,1))}else this.camera=new z(d.fromValues(0,0,100),d.fromValues(0,0,0),d.fromValues(0,1,0))};B.switchCameraController=function(D){this.cameraController=D;return D.state!==
m.State.Rejected};B.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};B.updateCamera=function(D){this.updateQueue.push(D);this.processUpdateQueue()};B.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var D=this.updateQueue.shift();k.copyFrom(this._get("camera"));D(k);this.camera=k;this.processingUpdates=!1;this.processUpdateQueue()}};B.cameraProjectionChanged=function(D,
E){return D.fov!==E.fov||D.fullViewport[0]!==E.fullViewport[0]||D.fullViewport[1]!==E.fullViewport[1]||D.fullViewport[2]!==E.fullViewport[2]||D.fullViewport[3]!==E.fullViewport[3]||D.padding[0]!==E.padding[0]||D.padding[1]!==E.padding[1]||D.padding[2]!==E.padding[2]||D.padding[3]!==E.padding[3]?!0:!1};a._createClass(A,[{key:"animation",get:function(){return this.cameraController instanceof h.AnimationController&&q.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},
{key:"camera",get:function(){return this._get("camera")},set:function(D){D!==k&&k.copyFrom(D);k.computeUp(this.viewingMode);v.camera=k;this.events.emit("before-camera-change",v);D=this._get("camera");this.cameraProjectionChanged(this._lastSeenCameraProjectionValues,k)&&(this._lastSeenCameraProjectionValues.copyFrom(k),x.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",x));if(!D||!D.equals(k))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(k)),
this._cameraChanged=!D||!D.almostEquals(k)){const E=g.afterDispatch(()=>{this._cameraChanged=!1;E.remove()})}}},{key:"contentCamera",get:function(){return q.isSome(this._contentCamera)?this._contentCamera:this.camera},set:function(D){this._contentCamera=q.isSome(D)?D.clone():null}},{key:"fixedContentCamera",get:function(){return!!q.isSome(this._contentCamera)}},{key:"isGlobal",get:function(){return 1===this.viewingMode}},{key:"isLocal",get:function(){return 2===this.viewingMode}},{key:"navigating",
get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(D){this.stopActiveCameraController()?(D&&(D.watch("state",E=>{if(E===m.State.Finished||E===m.State.Stopped)this._set("cameraController",null),this.updateCamera(G=>D.onControllerEnd(G))},!0),D.onControllerStart(this.camera)),this._set("cameraController",
D)):D&&(D.state=m.State.Rejected)}}]);return A}(b);p.__decorate([y.property({readOnly:!0,type:u})],b.prototype,"animation",null);p.__decorate([y.property({type:z})],b.prototype,"camera",null);p.__decorate([y.property({})],b.prototype,"_contentCamera",void 0);p.__decorate([y.property({type:z})],b.prototype,"contentCamera",null);p.__decorate([y.property({readOnly:!0})],b.prototype,"fixedContentCamera",null);p.__decorate([y.property({readOnly:!0})],b.prototype,"constraints",void 0);p.__decorate([y.property({readOnly:!0})],
b.prototype,"events",void 0);p.__decorate([y.property({readOnly:!0})],b.prototype,"isGlobal",null);p.__decorate([y.property({readOnly:!0})],b.prototype,"isLocal",null);p.__decorate([y.property({readOnly:!0})],b.prototype,"viewingMode",void 0);p.__decorate([y.property({readOnly:!0})],b.prototype,"spatialReference",void 0);p.__decorate([y.property({readOnly:!0})],b.prototype,"navigating",null);p.__decorate([y.property({readOnly:!0})],b.prototype,"stationary",null);p.__decorate([y.property()],b.prototype,
"_cameraChanged",void 0);p.__decorate([y.property()],b.prototype,"cameraController",null);p=b=p.__decorate([l.subclass("esri.views.3d.state.ViewState")],b);const k=new z,v={camera:null},x={camera:null};return p})},"esri/views/3d/support/PropertiesPool":function(){define(["exports","../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(a,p,b){let r=function(){function q(f,w){this.owner=w;this.properties={};this.afterDispatchHandle=null;for(const e in f)w=new p.ReentrantObjectPool(f[e],
null,null,2,2),this.properties[e]={pool:w,acquired:[]};this.afterDispatchHandle=b.afterDispatch(()=>this.release())}var y=q.prototype;y.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const f in this.properties){const w=this.properties[f];for(const e of w.acquired)b.isValueInUse(e)||w.pool.release(e);w.pool.destroy();w.pool=null;w.acquired=null}this.owner=this.properties=null};y.get=function(f){const w=this.owner._get(f);f=this.properties[f];
let e=f.pool.acquire();for(f.acquired.push(e);e===w;)f.acquired.push(e),e=f.pool.acquire();return e};y.release=function(){for(const f in this.properties){const w=this.properties[f];let e=0;for(const l of w.acquired)b.isValueInUse(l)?w.acquired[e++]=l:w.pool.release(l);w.acquired.length=e}};return q}();a.PropertiesPool=r;a["default"]=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/ViewStateManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J){const O=f.getLogger("esri.views.3d.state.ViewStateManager");q=function(P){function Q(ca){ca=P.call(this,ca)||this;ca.propertiesPool=new M.PropertiesPool({frustum:D.Frustum},a._assertThisInitialized(ca));ca.handles=new y;ca.cameraSetByUser=!1;ca.gotoOperation=null;ca.ready=!1;ca.updateDevicePixelRatio=null;ca.test={contentCameraResetState:new Map};return ca}a._inheritsLoose(Q,P);var V=Q.prototype;V.installContentCameraReset=
function(ca){this.handles.remove("contentCameraReset");this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const ba=this.zoom,Z=this.view.state.camera.distance**2,ha=m.fromArray(this.view.state.camera.center),fa=ca.sticky?this.contentCamera.clone():null;this.handles.add([this.watch("contentCamera",()=>{ca.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),this.watch("zoom",aa=>{this.test.contentCameraResetState.set("view.zoom",
Math.abs(aa-ba)/2);2<Math.abs(aa-ba)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=fa)}),this.view.state.watch("camera",aa=>{aa=h.squaredDistance(ha,aa.center);this.test.contentCameraResetState.set("camera.center",aa/Z);aa>Z?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=fa)})],"contentCameraReset");return!0};V.paddingToArray=function(ca,ba,Z){ca?n.set(Z,ca.top||0,ca.right||0,ca.bottom||0,ca.left||0):n.set(Z,0,0,0,0);for(ca=0;4>ca;ca++)Z[ca]=
Math.round(Z[ca]*ba)};V.initialize=function(){this.handles.add([g.on(this.view,"state.events","before-camera-change",ca=>this.updateElevation(ca.camera))]);g.once(this.view.state,"camera",ca=>this.updateElevation(ca),!0);this.handles.add(e.addFrameTask({prepare:()=>this.prepareFrame()}));this.handles.add(this.view.state.watch("cameraController",()=>{this.cameraSetByUser=!0;this.handles.remove("pending-initial-view")}));this.handles.add(g.on(this.view,"state.events","camera-projection-changed",()=>
this.notifyChange("scale")))};V.destroy=function(){this.deinit();this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};V.init=function(){this.constraintsManager=new B["default"]({view:this.view});this.prepareFrame();var ca=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(const ba of ca)this.set(ba.name,ba.value);this.cameraSetByUser||((ca=this.view.get("map.initialViewProperties.viewpoint")||
this.view.initialExtent)&&this.isCompatible(ca)?this.setInitialView(ca):2===this.view.state.viewingMode&&this.handles.add(g.whenOnce(this.view.basemapTerrain,"ready",()=>{this.handles.remove("pending-initial-view");this.setInitialView(this.view.dataExtent)}),"pending-initial-view"))};V.deinit=function(){this.cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove("pending-initial-view"),
this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};V.goTo=function(){var ca=a._asyncToGenerator(function*(ba,Z){Z={animate:!0,...Z};w.isSome(this.gotoOperation)&&this.gotoOperation.abort(Z.animate);this.gotoOperation=new E.GoToOperation(ba,Z,this.view);this.view.resourceController.scheduler.stopFrame();return this.gotoOperation});return function(ba,Z){return ca.apply(this,arguments)}}();V.debugSetCameraOnContent=function(){this.setStateCamera(A.cameraOnContentAlongViewDirection(this.view),
{applyConstraints:!1})};V.step=function(ca){const ba=this.view.state,Z=ba&&this.view.state.cameraController;Z&&(ba.updateCamera(ha=>{Z.stepController(ca,ha)}),Z.steppingFinished&&Z.finishController())};V.cancelGoToOperation=function(){w.isSome(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)};V.getInitialProperties=function(){const ca=new Set,ba=[];for(const {propertyName:Z,overrides:ha}of F){const fa=ca.has(Z),aa=this._isOverridden(Z);!fa&&aa&&ba.push({name:Z,value:this._get(Z)});
this._clearOverride(Z);(fa||aa)&&ha.forEach(W=>ca.add(W))}return ba};V.setInitialView=function(ca){if(!w.isNone(ca)&&!this.cameraSetByUser)if(ca instanceof b)this.setStateCamera(K.externalToInternal(this.view,ca),{applyConstraints:!1});else if(ca instanceof r)if(ca.targetGeometry instanceof k){var ba=K.fromExtent(this.view,ca.targetGeometry,0,.5,0);w.isSome(ba)&&this.setStateCamera(K.externalToInternal(this.view,ba),{applyConstraints:!0})}else ba={applyConstraints:!ca.camera},ca=this.viewpointToCamera(ca),
this.setStateCamera(ca,ba);else ba=K.fromExtent(this.view,ca,0,.5,0),w.isSome(ba)&&this.setStateCamera(K.externalToInternal(this.view,ba),{applyConstraints:!0})};V.updatePropertyBeforeReady=function(ca,ba){if(this.ready)return!1;this._override(ca,ba);ba&&-1!==I.indexOf(ca)&&this._override("hasInitialView",!0);return!0};V.isCompatible=function(ca){return w.isNone(ca)?!1:ca instanceof r?ca.camera?this.isCompatible(ca.camera):this.isCompatible(ca.targetGeometry):ca instanceof b?this.isCompatible(ca.position):
ca.spatialReference&&x.canProject(ca.spatialReference,this.view.spatialReference)};V.getPreservingHeadingTilt=function(ca=L){this.cameraSetByUser?(ca.heading=this.camera.heading,ca.tilt=this.camera.tilt):(ca.heading=0,ca.tilt=.5);return ca};V.centerPointAtDistanceToCamera=function(ca,ba,Z=R){const {heading:ha,tilt:fa}=this.getPreservingHeadingTilt();ca=K.getObserverForPointAtDistance(this.view,ha,fa,ca,ba,1);if(w.isNone(ca))return null;Z.copyFrom(this.view.state.camera);Z.eye=ca.eye;Z.center=ca.center;
Z.up=ca.up;return Z};V.centerToCamera=function(ca){const ba=this.view.pointsOfInterest.centerOnContent;ba.runTask();return this.centerPointAtDistanceToCamera(ca,ba.distance)};V.extentToCamera=function(ca){const {heading:ba,tilt:Z}=this.getPreservingHeadingTilt();ca=K.fromExtent(this.view,ca,ba,Z,1,N);return w.isSome(ca)?K.externalToInternal(this.view,ca):null};V.scaleToCamera=function(ca){if(null==ca)return null;const ba=this.view.pointsOfInterest.centerOnContent;ba.runTask();const Z=ba.renderLocation;
ca=K.scaleToDistance(this.view,ca,ba.location.latitude);return this.centerPointAtDistanceToCamera(Z,ca)};V.zoomToCamera=function(ca){return this.scaleToCamera(K.zoomToScale(this.view,ca))};V.viewpointToCamera=function(ca){return K.externalToInternal(this.view,H.toCamera(this.view,ca))};V.setStateCamera=function(ca,ba){if(w.isNone(ca)||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;ba.doNotCancelGoToOperation||this.cancelGoToOperation();this.view.state.updateCamera(Z=>
{ba.positionAndOrientationOnly?(Z.eye=ca.eye,Z.center=ca.center,Z.up=ca.up):Z.copyFrom(ca);ba.applyConstraints&&C.applyAll(this.view,Z)});ba.applyConstraints||(this.view.state.cameraController=new G.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:ca}));return!0};V.prepareFrame=function(){const {container:ca,canvas:ba}=this.view;if(ca&&ba){w.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var Z=this.view.pixelRatio,ha=Math.round(ca.clientWidth*Z),fa=Math.round(ca.clientHeight*
Z);if(0!==ha&&0!==fa){if(ba.width!==ha||ba.height!==fa)ba.width=ha,ba.height=fa;if(this.view.state){const aa=this.view.state.camera;if(aa.fullWidth!==ha||aa.fullHeight!==fa||aa.pixelRatio!==Z)R.copyFrom(aa),R.pixelRatio!==Z&&(this.paddingToArray(this.padding,Z,S),R.padding=S),R.fullWidth=ha,R.fullHeight=fa,R.pixelRatio=Z,this.view.state.camera=R}}}};V.updateElevation=function(ca){var ba=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;const Z=this.view.renderCoordsHelper.getAltitude(ca.eye);
ba=ba?A.surfaceElevationBelowRenderLocation(this.view,ca.eye):0;ca.relativeElevation=Z-ba};a._createClass(Q,[{key:"camera",get:function(){const ca=this._get("camera");if(!this.ready)return ca;const ba=K.internalToExternal(this.view,this.view.state.camera);return ba&&ca&&ba.equals(ca)?ca:ba},set:function(ca){this.updatePropertyBeforeReady("camera",ca)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(K.externalToInternal(this.view,ca),{applyConstraints:!1})||O.error("#camera\x3d",
"Invalid camera",ca),this.view.elevationProvider.enableElevationCache(!1))}},{key:"contentCamera",get:function(){const ca=this._get("contentCamera");if(!this.ready)return ca;const ba=K.internalToExternal(this.view,this.view.state.contentCamera);return ba&&ca&&ba.equals(ca)?ca:ba},set:function(ca){this.updatePropertyBeforeReady("contentCamera",ca)||(ca=K.externalToInternal(this.view,ca),w.isNone(ca)?this.view.state.contentCamera=null:(this.updateElevation(ca),this.view.state.contentCamera=ca))}},{key:"center",
get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(ca){this.updatePropertyBeforeReady("center",ca)||(ca?this.isCompatible(ca)?this.setStateCamera(this.centerToCamera(ca),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():O.error("#center\x3d","Invalid center",ca):O.error("#center\x3d","Center has an incompatible spatial reference (center: "+(ca.spatialReference?ca.spatialReference.wkid:"none")+", view: "+
this.view.spatialReference.wkid+")",ca):O.error("#center\x3d","Center may not be null or undefined"))}},{key:"extent",get:function(){if(!this.ready)return this._get("extent");var ca=this.view;ca=K.toExtent(ca,ca.state.camera,ca.pointsOfInterest.centerOnContent.renderLocation);return w.isSome(ca)?ca:this._get("extent")},set:function(ca){this.updatePropertyBeforeReady("extent",ca)||(ca?this.isCompatible(ca)?this.setStateCamera(this.extentToCamera(ca),{applyConstraints:!0})||O.error("#extent\x3d","Invalid extent",
ca):O.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(ca.spatialReference?ca.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",ca):O.error("#extent\x3d","Extent may not be null or undefined"))}},{key:"frustum",get:function(){const ca=this.propertiesPool.get("frustum");ca.renderCoordsHelper=this.view.renderCoordsHelper;ca.update(this.view.state.camera);return ca}},{key:"hasInitialView",get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},
{key:"scale",get:function(){if(this.ready){const ca=this.view.pointsOfInterest.centerOnContent;return K.distanceToScale(this.view,ca.distance,ca.location.latitude)}return this._get("scale")},set:function(ca){this.updatePropertyBeforeReady("scale",ca)||this.setStateCamera(this.scaleToCamera(ca),{applyConstraints:!0})||O.error("#scale\x3d","Invalid scale",ca)}},{key:"padding",get:function(){if(!this.ready)return this._get("padding");var ca=this.view.state.camera,ba=ca.padding;const Z=ca.pixelRatio;
ca=this._get("padding");const ha=Math.round(ba[0]/Z),fa=Math.round(ba[1]/Z),aa=Math.round(ba[2]/Z);ba=Math.round(ba[3]/Z);return null!=ca&&ca.top===ha&&ca.right===fa&&ca.bottom===aa&&ca.left===ba?ca:{top:ha,right:fa,bottom:aa,left:ba}},set:function(ca){this.updatePropertyBeforeReady("padding",ca)||(this.paddingToArray(ca,this.view.state.camera.pixelRatio,S),this.view.state.updateCamera(ba=>ba.padding=S))}},{key:"screenCenter",get:function(){const ca=this.padding;return l.createScreenPoint((this.view.width-
(ca.left+ca.right))/2+ca.left,(this.view.height-(ca.top+ca.bottom))/2+ca.top)}},{key:"viewpoint",get:function(){return this.ready?H.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(ca){if(!this.updatePropertyBeforeReady("viewpoint",ca))if(ca)if(this.isCompatible(ca))this.setStateCamera(this.viewpointToCamera(ca),{applyConstraints:!ca.camera})||O.error("#viewpoint\x3d","Invalid viewpoint",ca);else{var ba=w.isSome(ca.camera)?ca.camera.position:ca.targetGeometry;ba=w.isSome(ba)&&
ba.spatialReference;O.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(ba?ba.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",ca)}else O.error("#viewpoint\x3d","Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?K.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(ca){this.updatePropertyBeforeReady("zoom",ca)||this.setStateCamera(this.zoomToCamera(ca),{applyConstraints:!0})||O.error("#zoom\x3d","Invalid zoom",
ca)}}]);return Q}(q);p.__decorate([d.property({type:b,dependsOn:["view.state.camera","ready"]})],q.prototype,"camera",null);p.__decorate([d.property({type:b,dependsOn:["view.state.contentCamera","ready"]})],q.prototype,"contentCamera",null);p.__decorate([d.property({type:v})],q.prototype,"center",null);p.__decorate([d.property({type:k})],q.prototype,"extent",null);p.__decorate([d.property({readOnly:!0})],q.prototype,"frustum",null);p.__decorate([d.property({readOnly:!0})],q.prototype,"hasInitialView",
null);p.__decorate([d.property({readOnly:!0,type:Boolean})],q.prototype,"ready",void 0);p.__decorate([d.property({type:Number})],q.prototype,"scale",null);p.__decorate([d.property()],q.prototype,"padding",null);p.__decorate([d.property({readOnly:!0})],q.prototype,"screenCenter",null);p.__decorate([d.property({constructOnly:!0})],q.prototype,"view",void 0);p.__decorate([d.property({type:r})],q.prototype,"viewpoint",null);p.__decorate([d.property({type:Number})],q.prototype,"zoom",null);p.__decorate([d.property({constructOnly:!0})],
q.prototype,"updateDevicePixelRatio",void 0);p=q=p.__decorate([t.subclass("esri.views.3d.state.ViewStateManager")],q);const I="camera viewpoint extent scale center zoom".split(" "),F=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],L={heading:0,tilt:0},
N=new b,R=new J,S=z.create();return p})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){a.ConstraintsManager=function(n){function z(v){var x=n.call(this,v)||this;x._handles=new q;x.nearFarHeuristic=h.createNearFarHeuristic(v.view.state.viewingMode,v.view.basemapTerrain,v.view.renderCoordsHelper.spatialReference);return x}p._inheritsLoose(z,n);var k=z.prototype;k.initialize=function(){this._handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],()=>this._clipDistanceNearFarChanged()),this.view.watch("constraints.clipDistance.mode",
()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",v=>this._updateCameraNearFar(v.camera)),this.view.watch("renderDataExtent",()=>this._updateNearFar(),!0),this.view.watch(["constraints.altitude.min","constraints.altitude.max"],()=>this._updateAltitude(),!0),this.view.watch("constraints.tilt.max",()=>this._updateTiltMax(),!0),this.view.watch("constraints.tilt.mode",()=>this._updateTilt(),!0),this.view.watch("state.camera",()=>this._updateTiltAutoMax(),!0),this.view.watch(["map.ground.navigationConstraint.type",
"constraints.collision.enabled"],()=>this._updateCollision(),!0)]);this.view.state.isLocal&&this._handles.add(w.init(this.view,"renderDataExtent",v=>this._updateLocalSurfaceDistance(v)));this._updateNearFar();2!==this.view.state.viewingMode&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new m["default"]({view:this.view}))};k.destroy=function(){this._handles=f.destroyMaybe(this._handles);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))};k._clipDistanceNearFarChanged=function(){var v;const x=null==(v=this.view.constraints)?void 0:v.clipDistance;x&&"auto"!==x.mode&&this.view.state.updateCamera(C=>{this._updateCameraNearFarManual(C,x);return!0})};k._updateNearFar=function(){this.view.state.updateCamera(v=>{this._updateCameraNearFar(v);return!0})};k._updateCameraNearFar=function(v){const x=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(x?x.mode:"auto")?this._updateCameraNearFarManual(v,
x):this._updateCameraNearFarAuto(v,x)};k._updateCameraNearFarAuto=function(v,x){this.nearFarHeuristic.compute(v.eye,v.center,this.view.renderDataExtent,t.surfaceElevationBelowRenderLocation(this.view,v.eye),v);x&&x.autoUpdate(v.near,v.far)};k._updateCameraNearFarManual=function(v,x){x&&(v.near=x.near,v.far=x.far)};k._updateCollision=function(){var v,x,C;const A=null==(v=this.view.map)?void 0:null==(x=v.ground)?void 0:null==(C=x.navigationConstraint)?void 0:C.type;v=A?"stay-above"===A:!0;x=this.view.state.constraints.collision;
v!==x.enabled&&((x.enabled=v)&&this._reapplyConstraints(8),(v=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==v.mode||this._updateTiltAuto())};k._updateAltitude=function(){const v=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=v&&2!==this.view.state.viewingMode?{min:v.min,max:v.max}:null;this._reapplyConstraints()};k._updateTiltMax=function(){const v=this.view.constraints&&this.view.constraints.tilt;v&&"auto"!==v.mode&&(this._updateTiltManual(v),
this._reapplyConstraints())};k._updateTilt=function(){const v=this.view.constraints&&this.view.constraints.tilt;"manual"===(v?v.mode:"auto")?this._updateTiltManual(v):this._updateTiltAuto();this._reapplyConstraints()};k._updateTiltManual=function(v){const x=this.view.state.constraints;x.tilt=x.createConstantMaxTilt(y.deg2rad(v.max))};k._updateTiltAuto=function(){const v=this.view.state.constraints;v.tilt=v.createDefaultTilt();this._updateTiltAutoMax()};k._updateTiltAutoMax=function(){const v=this.view.constraints&&
this.view.constraints.tilt;if(v&&"auto"===v.mode){var x=this.view.state.constraints;x.tilt&&(x=x.tilt(this.view.state.camera.distance).max,v.autoUpdate(y.rad2deg(x)))}};k._updateLocalSurfaceDistance=function(v){if(!f.isNone(v)){var x=Math.max(v.width,v.height);0>=x||(v.hasZ&&(x=Math.max(x,v.zmax-v.zmin)),v=this.view.state,x=3*x/Math.atan(v.camera.fov/2),x!==v.constraints.distance&&(v.constraints.distance=x))}};k._reapplyConstraints=function(v=15){this.view.state.updateCamera(x=>u.applyAll(this.view,
x,{selection:v,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0}))};return z}(r);b.__decorate([e.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",void 0);b.__decorate([e.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=b.__decorate([c.subclass("esri.views.3d.state.ConstraintsManager")],a.ConstraintsManager);a["default"]=a.ConstraintsManager;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Extent ../../../geometry/projectionEllipsoid".split(" "),function(a,p,b,r,q,y,f,w){function e(u,t,h,m){h=2/h;u/t>h?(m.far=u,m.near=m.far/t):(m.near=h,m.far=m.near*t);return m}let l=function(){function u(t,h){this.elevationProvider=t;this._referenceEllipsoid=w.getReferenceEllipsoid(h);
this.unitInMeters=r.getMetersPerUnitForSR(h,this._referenceEllipsoid.metersPerDegree)}u.prototype.compute=function(t,h,m,n,z){z||(z={near:0,far:0});var k=t[2]*this.unitInMeters,v=k;n=k-n;var x=this.elevationProvider?this.elevationProvider.elevationBounds:null;x&&(k=0<=n?v-this.unitInMeters*x.min:this.unitInMeters*x.max-v);m=b.isSome(m)?m:new f({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});v=Math.max(m.xmax-m.xmin,m.ymax-m.ymin,4*Math.max(m.xmax-m.xmin,m.ymax-m.ymin));q.subtract(c,h,t);d[0]=0<c[0]?
m.xmax:m.xmin;d[1]=0<c[1]?m.ymax:m.ymin;d[2]=0<c[2]?v/2:-v/2;q.subtract(d,d,t);q.normalize(c,c);t=1.1*q.dot(d,c)*this.unitInMeters;h=Math.sqrt(k*(k+2*this._referenceEllipsoid.radius));m=Math.max(m.xmax-m.xmin,m.ymax-m.ymin);x=1E-4*m*this.unitInMeters;k=p.clamp((k-x)/(.001*m*this.unitInMeters-x),0,1);k=p.lerp(h,t,k*k*k);k*=Math.max(Math.log(Math.abs(n)),1);k=Math.min(k,Math.max(34064E4,v));k/=this.unitInMeters;return e(k,2E4,this.unitInMeters,z)};return u}(),g=function(){function u(t){this._referenceEllipsoid=
w.getReferenceEllipsoid(t)}u.prototype.compute=function(t,h,m,n,z){z||(z={near:0,far:0});t=q.length(t)-this._referenceEllipsoid.radius;t=Math.max(Math.abs(t-n),Math.abs(t));n=Math.sqrt(t*(t+2*(this._referenceEllipsoid.radius+Math.min(0,n))));t=p.clamp(2E4-(Math.log(t)-7.983)/9.011*19E3,1E3,2E4);return e(1.2*n,t,1,z)};return u}();const d=y.create(),c=y.create();a.createNearFarHeuristic=function(u,t,h){return 1===u?new g(h):new l(t,h)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/mathUtils ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vectorStacks ../camera/constraintUtils/surfaceCollision ../../../geometry/projectionEllipsoid ../camera/intersectionUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){a.SurfaceCollisionConstraint=function(n){function z(v){v=n.call(this,v)||this;v.handles=new q;return v}p._inheritsLoose(z,n);var k=z.prototype;k.initialize=function(){this.handles.add(this.view.basemapTerrain.on("elevation-change",v=>this.handleElevationChangeEvent(v)))};k.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};k.handleElevationChangeEvent=function(v){this.view.state.cameraController||m.eyeWithinExtent(this.view,this.view.state.camera,
v.extent,v.spatialReference)&&this.applyToCurrentCamera()};k.applyToCurrentCamera=function(){this.view.state.updateCamera(v=>{t.applySurfaceCollisionConstraint(this.view,v,1)})};return z}(r);b.__decorate([y.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=b.__decorate([l.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);a["default"]=a.SurfaceCollisionConstraint;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../camera/constraintUtils ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils ../camera/constraintUtils/surfaceCollision".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){let t=
function(){function h(n,z,k){this.target=n;this.options=z;this.view=k;this.state="pending";this.animationController=this.abortController=null;this.promise=new Promise((v,x)=>{this.resolveCallback=v;this.rejectCallback=x;v=y.createAbortController();if(q.isSome(this.options.signal))y.onAbort(this.options.signal,()=>{this.abort()});this.abortController=v;this.waitForReady()})}var m=h.prototype;m.then=function(n,z){return this.promise.then(n,z)};m.catch=function(n){return this.promise.catch(n)};m.resolve=
function(n){this.state="finished";return this.resolveCallback(n)};m.reject=function(n){this.state="finished";return this.rejectCallback(n)};m.abort=function(n=!1){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":this.reject(y.createAbortError());break;case "wait-for-animation-finish":!n&&q.isSome(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(y.createAbortError())}};
m.waitForReady=function(){this.state="wait-for-ready";this.view.ready?this.createViewPoint():f.whenOnce(this.view,"ready",this.abortController.signal).then(()=>{this.createViewPoint()},n=>{this.reject(n)})};m.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this.getAnimationController():null,c.create(this.view,this.target,this.abortController.signal).then(n=>{"finished"!==this.state&&(n=this.getCameraFromViewpoint(n),
q.isNone(n)||(this.options.animate?q.isNone(this.animationController)||this.startAnimation(n,this.animationController):(this.view.stateManager.setStateCamera(n.camera,{applyConstraints:!n.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},n=>{this.reject(n)}))};m.getCameraFromViewpoint=function(n){const z=!!(this.target instanceof b&&this.target.camera||this.target instanceof p);var k=n.camera;if(q.isNone(k))return null;if(!this.view.stateManager.isCompatible(k))return n=
(n=k.position)&&n.spatialReference,this.reject(new r("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${n?n.wkid:"none"}, view: ${this.view.spatialReference.wkid})`,{camera:k})),null;k=d.externalToInternal(this.view,k);return q.isNone(k)?(this.reject(new r("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:n,camera:k,isFullySpecified:z}};m.startAnimation=function(n,z){this.state="wait-for-animation-finish";
const k=z.viewAnimation;if(q.isNone(k))this.reject(new r("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{k.update(n.viewpoint,"running");if(!z.active||q.isNone(z.viewAnimation)||z.viewAnimation.target!==n.viewpoint||this.view.state.cameraController!==z)return this.abort();if(n.isFullySpecified){var v=new g.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:n.camera});u.applySurfaceCollisionConstraint(this.view,n.camera,1)}else w.applyAll(this.view,
n.camera);z.begin(n.camera,this.options);var x=C=>{if(!q.isNone(this.view.state))switch(z.state){case e.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case e.State.Ready:case e.State.Rejected:case e.State.Running:case e.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(C)}}};k.when(()=>{const C=this.view.state.cameraController;
v&&(C&&C.active?C instanceof l.PointToPointAnimationController&&q.isSome(C.viewAnimation)&&C.viewAnimation.target===n.viewpoint&&(this.view.state.cameraController=v):q.isSome(z.viewAnimation)&&z.viewAnimation.target===n.viewpoint&&"finished"===z.state&&(this.view.state.cameraController=v))},C=>x(C));z.asyncResult={resolve:()=>x(),reject:C=>x(C)}}};m.getAnimationController=function(){let n;var z=null;z=this.view.state.cameraController;z instanceof l.PointToPointAnimationController&&(z.updateStateFromViewAnimation(),
z.active&&(n=z,z=n.viewAnimation));return null!=n||(n=new l.PointToPointAnimationController({view:this.view,mode:"animation"}),z=n.viewAnimation,this.view.state.switchCameraController(n))?n:(q.isSome(z)&&z.stop(),this.reject(new r("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};return h}();a.GoToOperation=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../core/mathUtils ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../camera/constraintUtils/surfaceCollision ../../../../geometry/projectionEllipsoid ../../camera/intersectionUtils ./CameraController".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){a.SurfaceCollisionCorrectionController=function(n){function z(v){v=n.call(this,v)||this;v.handles=new r;return v}p._inheritsLoose(z,n);var k=z.prototype;k.onControllerStart=function(){this.state=m.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",v=>this.handleElevationChangeEvent(v)));this.applyCorrection()};k.onControllerEnd=function(){this.handles.removeAll()};k.stepController=function(){};k.handleElevationChangeEvent=function(v){h.eyeWithinExtent(this.view,
this.desiredCamera,v.extent,v.spatialReference)&&this.applyCorrection()};k.applyCorrection=function(){this.view.state.updateCamera(v=>{v.copyViewFrom(this.desiredCamera);u.applySurfaceCollisionConstraint(this.view,v,1)||this.constraintEnabled||(this.state=m.State.Stopped)})};p._createClass(z,[{key:"desiredCamera",set:function(v){this._set("desiredCamera",v.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return z}(m.CameraController);b.__decorate([q.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"view",void 0);b.__decorate([q.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=b.__decorate([e.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a.SurfaceCollisionCorrectionController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ./mathUtils ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Geometry".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K){function M(ma){return 360-B.cyclicalDeg.normalize(ma)}function H(ma){return B.cyclicalDeg.normalize(360-ma)}function J(ma){l.isSome(ma)&&ma.resolver&&ma.resolver.reject();return null}function O(ma,ta,Ea,Ca=null){if(!ta)return J(Ca);var ka=ma.spatialReference||E.WGS84;if(l.isSome(ta.camera)){ma=v.project(ta.camera.position,ka);if(l.isNone(ma))return J(Ca);ta=ta.camera.clone();ta.position=ma;ma=ta;l.isSome(Ca)&&Ca.resolver&&Ca.resolver.resolve(ma);
return ma}if(l.isNone(ta.targetGeometry))return J(Ca);var sa=ta.get("targetGeometry.spatialReference");if(sa&&!v.canProject(sa,ka))return J(Ca);ka=C.internalToExternal(ma,ma.state.camera);sa=1;null!=ta.rotation&&(ka.heading=M(ta.rotation),sa=0);null!=Ea&&(ka.tilt=Ea);if("point"===ta.targetGeometry.type){const Ja=ta.targetGeometry;Ea=ta.targetGeometry.clone();ta=null!=ta.scale?C.scaleToDistance(ma,ta.scale,Ja.latitude):ma.state.camera.distance;return C.fromCenterDistance(ma,Ea,ta,ka,sa,Ca)}return C.fromExtent(ma,
ta.targetGeometry.extent,ka.heading,ka.tilt,sa,Ca)}function I(){I=p._asyncToGenerator(function*(ma,ta,Ea){if(ta&&ma.spatialReference){var Ca={target:null};if("declaredClass"in ta||Array.isArray(ta))Ca.target=ta;else{for(var ka in ta)Ca[ka]=ta[ka];ta.center&&!Ca.target&&(Ca.target=ta.center)}ta=Ca}else ta=null;if(!ta)throw new e("viewpointutils-create:no-target","Missing target for creating viewpoint");Ca=new b({fov:ma.camera.fov});ka=new y({camera:Ca});if(ta.target instanceof y)return ma=yield ca(ma,
ta.target,ta,Ea,ka),ea(ma);if(ta.target instanceof b)return ea(Z(ma,ta.target,ka));var sa=null!=ta.scale||null!=ta.zoom;if(ta.target instanceof G){var Ja=ta.target.xmin===ta.target.xmax||ta.target.ymin===ta.target.ymax;return sa||Ja?ea(yield ha(ma,ta,ta.target.center,Ca,Ea,ka)):ea(yield U(ma,ta,ta.target,Ca,Ea,ka))}Ja={boundingBox:n.empty(),hasZ:!1,screenSpaceObjects:[]};var Ta=sa?C.scaleToResolution(ma,F(ma,ta)):void 0;yield Q(ma,ta.target,Ta,Ja);if(isFinite(Ja.boundingBox[0])){n.center(Ja.boundingBox,
ia);Ia.x=ia[0];Ia.y=ia[1];Ia.z=ia[2];Ia.spatialReference=ma.spatialReference;isFinite(Ia.z)&&Ja.hasZ?Ta=n.isPoint(Ja.boundingBox):(Ia.z=void 0,Ta=z.isPoint(n.toRect(Ja.boundingBox,wa)));if(sa||Ta)return ea(yield ha(ma,ta,Ia,Ca,Ea,ka));sa=Ja.screenSpaceObjects;if(sa.length){Ta=Number.NEGATIVE_INFINITY;for(let da=0;da<sa.length;da++){const qa=sa[da].screenSpaceBoundingRect;Ta=Math.max(Ta,Math.abs(qa[0]),Math.abs(qa[1]),Math.abs(qa[2]),Math.abs(qa[3]))}sa=.66-Ta/Math.min(ma.width,ma.height)*2}else sa=
.66;return ea(yield T(ma,ta,Ia,Ja.boundingBox,sa,Ca,Ea,ka))}return ta.position?(Ea=x.cameraOnContentAlongViewDirection(ma),t.copy(Fa,Ea.viewForward),C.directionToHeadingTilt(ma,Ea.eye,Fa,Ea.up,Sa),Ca.position=new D(ta.position),Ca.heading=null!=ta.heading?ta.heading:Sa.heading,Ca.tilt=null!=ta.tilt?ta.tilt:Sa.tilt,ma=N(ma,null,Ca,ka),ea(ma)):ea(yield aa(ma,ta,Ca,Ea,ka))});return I.apply(this,arguments)}function F(ma,ta){return null==ta.scale&&null!=ta.zoom?C.zoomToScale(ma,ta.zoom):ta.scale}function L(ma,
ta){let Ea=!1;null!=ta.heading?(ma.heading=ta.heading,Ea=!0):null!=ta.rotation&&(ma.heading=M(ta.rotation),Ea=!0);null!=ta.tilt&&(ma.tilt=ta.tilt,Ea=!0);null!=ta.fov&&(ma.fov=ta.fov);return Ea}function N(ma,ta,Ea,Ca){const ka=ma.spatialReference||E.WGS84;ta=l.isSome(ta)?ta:C.externalToInternal(ma,Ea);if(l.isNone(ta))return Ca;Ca.targetGeometry=m.projectVectorToPoint(ta.center,ma.renderSpatialReference,ka);Ca.scale=C.computeScale(ma,ta);Ca.rotation=H(Ea.heading);Ca.camera=Ea;return Ca}function R(ma,
ta,Ea){if(ta){if(!v.canProject(ta.spatialReference,ma.spatialReference))throw new e("viewpointutils:incompatible-spatialreference",`Spatial reference (${ta.spatialReference?ta.spatialReference.wkid:"unknown"}) is incompatible with the view (${ma.spatialReference.wkid})`,{geometry:ta});var Ca=[];if(!ta.hasZ&&ma.basemapTerrain){switch(ta.type){case "point":var ka=ta;break;case "multipoint":case "polyline":ka=ta.extent.center;break;case "mesh":ka=ta.origin;break;case "extent":ka=ta.center;break;case "polygon":ka=
ta.centroid}ka&&v.canProject(ka,ma.basemapTerrain.spatialReference)?ia[2]=l.unwrapOr(A.getElevationAtPoint(ma.elevationProvider,ka),0):ia[2]=0}(0,va[ta.type])(ta,Ja=>{Ca.push(Ja[0],Ja[1],Ja[2])},ia);var sa=Ca.length/3;if(0!==sa&&(ka=Array(Ca.length),m.projectBuffer(Ca,ta.spatialReference,0,ka,ma.spatialReference,0,sa)))for(ta.hasZ&&(Ea.hasZ=!0),ma=0;ma<ka.length;ma+=3)ta.hasZ?(ia[0]=ka[ma+0],ia[1]=ka[ma+1],ia[2]=ka[ma+2]):(ia[0]=ka[ma+0],ia[1]=ka[ma+1]),n.expandWithVec3(Ea.boundingBox,ia)}}function S(ma,
ta,Ea,Ca){return P.apply(this,arguments)}function P(){P=p._asyncToGenerator(function*(ma,ta,Ea,Ca){const ka=yield f.result(ma.whenViewForGraphic(ta));if(!1!==ka.ok&&!l.isNone(ka.value)&&"whenGraphicBounds"in ka.value)if(Ea=yield f.result(ka.value.whenGraphicBounds(ta,{minDemResolution:Ea})),!1===Ea.ok)R(ma,ta.geometry,Ca);else{var {screenSpaceObjects:sa,boundingBox:Ja}=Ea.value;n.expandWithAABB(Ca.boundingBox,Ja);sa&&sa.forEach(Ta=>{Ca.screenSpaceObjects.push(Ta)});isFinite(Ja[2])&&(Ca.hasZ=!0)}else R(ma,
ta.geometry,Ca)});return P.apply(this,arguments)}function Q(ma,ta,Ea,Ca){return V.apply(this,arguments)}function V(){V=p._asyncToGenerator(function*(ma,ta,Ea,Ca){if(Array.isArray(ta)&&2===ta.length){const ka=ta[0],sa=ta[1];if("number"===typeof ka&&"number"===typeof sa){Ia.x=ka;Ia.y=sa;Ia.z=void 0;Ia.spatialReference=ma.spatialReference.isGeographic?ma.spatialReference:E.WGS84;R(ma,Ia,Ca);return}}ta&&"function"===typeof ta.map?yield g.eachAlways(ta.map(ka=>Q(ma,ka,Ea,Ca))):ta instanceof K?R(ma,ta,
Ca):ta instanceof q&&(yield S(ma,ta,Ea,Ca))});return V.apply(this,arguments)}function ca(ma,ta,Ea,Ca,ka){return ba.apply(this,arguments)}function ba(){ba=p._asyncToGenerator(function*(ma,ta,Ea,Ca,ka){if(l.isSome(ta.camera))return Z(ma,ta.camera,ka);ka.scale=ta.scale;ka.rotation=ta.rotation;ka.targetGeometry=l.isSome(ta.targetGeometry)?ta.targetGeometry.clone():null;ka.camera=null;null!=Ea.heading?ka.rotation=H(Ea.heading):null!=Ea.rotation&&(ka.rotation=Ea.rotation);ta=F(ma,Ea);null!=ta&&(ka.scale=
ta);Ca=new C.AsyncContext(Ca);O(ma,ka,Ea.tilt,Ca);ka.camera=yield Ca.resolver.promise;return ka});return ba.apply(this,arguments)}function Z(ma,ta,Ea){const Ca=v.project(ta.position,ma.spatialReference);if(l.isNone(Ca))return null;ta=ta.clone();ta.fov=ma.camera.fov;ta.position=Ca;return N(ma,null,ta,Ea)}function ha(ma,ta,Ea,Ca,ka,sa){return fa.apply(this,arguments)}function fa(){fa=p._asyncToGenerator(function*(ma,ta,Ea,Ca,ka,sa){if(l.isNone(Ea))throw new e("createfromcenter","invalid point");sa.targetGeometry=
Ea.clone();const Ja=x.cameraOnContentAlongViewDirection(ma);if(ta.position)return Ea=sa.targetGeometry,ka=ma.renderSpatialReference,m.projectPointToVector(ta.position,La,ka),m.projectPointToVector(Ea,Ma,ka),sa.targetGeometry=new D(Ea),Ca.position=new D(ta.position),t.subtract(Fa,Ma,La),C.directionToHeadingTilt(ma,La,Fa,Ja.up,Ca),sa.scale=C.distanceToScale(ma,t.distance(La,Ma),sa.targetGeometry.latitude),sa.rotation=H(Ca.heading),sa.camera=Ca,sa;if(ta.zoomFactor){var Ta=Ja.distance/ta.zoomFactor;const da=
t.scale(ia,Ja.viewForward,-Ta);Ja.eye=t.add(ia,Ja.center,da);sa.scale=C.distanceToScale(ma,Ta,Ea.latitude)}C.internalToExternal(ma,Ja,Ca);Ta=L(Ca,ta)?0:1;ta.zoomFactor||(sa.scale=F(ma,ta),null==sa.scale&&(m.projectPointToVector(Ea,ia,ma.renderSpatialReference),k.intersectsPoint(Ja.frustum,ia)?sa.scale=C.distanceToScale(ma,t.distance(Ja.eye,ia),Ea.latitude):sa.scale=C.computeScale(ma,Ja)),ta=new C.AsyncContext(ka),C.fromCenterScale(ma,sa.targetGeometry,sa.scale,Ca,Ta,ta),sa.camera=yield ta.resolver.promise);
return sa});return fa.apply(this,arguments)}function aa(ma,ta,Ea,Ca,ka){return W.apply(this,arguments)}function W(){W=p._asyncToGenerator(function*(ma,ta,Ea,Ca,ka){var sa=x.cameraOnContentAlongViewDirection(ma);sa=m.projectVectorToPoint(sa.center,ma.renderSpatialReference,ma.spatialReference);return ha(ma,ta,sa,Ea,Ca,ka)});return W.apply(this,arguments)}function U(ma,ta,Ea,Ca,ka,sa){return X.apply(this,arguments)}function X(){X=p._asyncToGenerator(function*(ma,ta,Ea,Ca,ka,sa){sa.targetGeometry=Ea.clone();
const Ja=x.cameraOnContentAlongViewDirection(ma);C.internalToExternal(ma,Ja,Ca);ta=L(Ca,ta)?0:1;ka=new C.AsyncContext(ka);C.fromExtent(ma,Ea,Ca.heading,Ca.tilt,ta,ka);sa.camera=yield ka.resolver.promise;return sa});return X.apply(this,arguments)}function T(ma,ta,Ea,Ca,ka,sa,Ja,Ta){return Y.apply(this,arguments)}function Y(){Y=p._asyncToGenerator(function*(ma,ta,Ea,Ca,ka,sa,Ja,Ta){Ta.targetGeometry=Ea.clone();const da=x.cameraOnContentAlongViewDirection(ma);var qa=0;Ea.hasZ?qa=Ea.z:ma.basemapTerrain&&
(qa=l.unwrap(A.getElevationAtPoint(ma.elevationProvider,Ea)));t.set(ia,Ea.x,Ea.y,qa);m.computeTranslationToOriginAndRotation(ma.spatialReference,ia,la,ma.renderSpatialReference);d.fromMat4(pa,la);d.transpose(pa,pa);n.empty(ua);Ea=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var ra=0;ra<Ea.length;ra++){const Da=Ea[ra];let Pa=Ca[Da[2]];isFinite(Pa)||(Pa=qa);t.set(ia,Ca[Da[0]],Ca[Da[1]],Pa);m.projectVectorToVector(ia,ma.spatialReference,ia,ma.renderSpatialReference);n.expandWithVec3(ua,
t.transformMat3(ia,ia,pa))}Ca=n.width(ua);qa=n.height(ua);Ea=n.depth(ua);ra=1/Math.tan(da.fovY/2);ka=Math.max(.5*Math.sqrt(Ca*Ca+Ea*Ea)*Math.max(ra,1/Math.tan(da.fovX/2))+.5*qa,.5*qa*ra+.5*Math.max(Ca,Ea))/ka;C.internalToExternal(ma,da,sa);ta=L(sa,ta)?0:1;Ta.scale=C.distanceToScale(ma,ka,Ta.targetGeometry.latitude);Ja=new C.AsyncContext(Ja);C.fromCenterScale(ma,Ta.targetGeometry,Ta.scale,sa,ta,Ja);Ta.camera=yield Ja.resolver.promise;return Ta});return Y.apply(this,arguments)}function ea(ma){ma&&l.isSome(ma.camera)&&
(ma.rotation=H(ma.camera.heading));return ma}const ia=h.create(),la=u.create(),pa=c.create(),ua=n.create(),wa=z.create(),Fa=h.create(),La=h.create(),Ma=h.create(),Sa={heading:0,tilt:0},Ia=new D,va={point(ma,ta,Ea){Ea[0]=ma.x;Ea[1]=ma.y;ma.hasZ&&(Ea[2]=ma.z);ta(Ea)},polygon(ma,ta,Ea){const Ca=ma.hasZ;for(let ka=0;ka<ma.rings.length;ka++){const sa=ma.rings[ka];for(let Ja=0;Ja<sa.length;Ja++)Ea[0]=sa[Ja][0],Ea[1]=sa[Ja][1],Ca&&(Ea[2]=sa[Ja][2]),ta(Ea)}},polyline(ma,ta,Ea){const Ca=ma.hasZ;for(let ka=
0;ka<ma.paths.length;ka++){const sa=ma.paths[ka];for(let Ja=0;Ja<sa.length;Ja++)Ea[0]=sa[Ja][0],Ea[1]=sa[Ja][1],Ca&&(Ea[2]=sa[Ja][2]),ta(Ea)}},multipoint(ma,ta,Ea){const Ca=ma.points;ma=ma.hasZ;for(let ka=0;ka<Ca.length;ka++)Ea[0]=Ca[ka][0],Ea[1]=Ca[ka][1],ma&&(Ea[2]=Ca[ka][2]),ta(Ea)},extent(ma,ta,Ea){ma.hasZ?(ta(t.set(Ea,ma.xmin,ma.ymin,ma.zmin)),ta(t.set(Ea,ma.xmax,ma.ymin,ma.zmin)),ta(t.set(Ea,ma.xmin,ma.ymax,ma.zmin)),ta(t.set(Ea,ma.xmax,ma.ymax,ma.zmin)),ta(t.set(Ea,ma.xmin,ma.ymin,ma.zmax)),
ta(t.set(Ea,ma.xmax,ma.ymin,ma.zmax)),ta(t.set(Ea,ma.xmin,ma.ymax,ma.zmax)),ta(t.set(Ea,ma.xmax,ma.ymax,ma.zmax))):(ta(t.set(Ea,ma.xmin,ma.ymin,Ea[2])),ta(t.set(Ea,ma.xmax,ma.ymin,Ea[2])),ta(t.set(Ea,ma.xmin,ma.ymax,Ea[2])),ta(t.set(Ea,ma.xmax,ma.ymax,Ea[2])))},mesh(ma,ta,Ea){if(ma=ma.vertexAttributes&&ma.vertexAttributes.position)for(let Ca=0;Ca<ma.length;Ca+=3)ta(t.set(Ea,ma[Ca+0],ma[Ca+1],ma[Ca+2]))}};a.create=function(ma,ta,Ea){return I.apply(this,arguments)};a.fromCamera=function(ma,ta,Ea=null){l.isNone(Ea)&&
(Ea=new y);return N(ma,null,ta.clone(),Ea)};a.headingToRotation=H;a.rotationToHeading=M;a.toCamera=O;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){function d(z,k,v){for(const x of z)k&&!k(x)||v.push(x);return v}function c(z){t||(t=new l.Intersector(z));t.viewingMode=z;return t}let u=function(){function z(v,x,C){this.viewingMode=v;this.layerProvider=x;this.view=C;this.externalIntersectionHandlers=new b;this.tolerance=l.Intersector.DEFAULT_TOLERANCE;this.tmpRay=f.create();this.validateHUDIntersector=new l.Intersector(this.viewingMode);this.validateHUDIntersector.options.hud=!1}var k=z.prototype;k.intersectScreen=
function(v,x){return this.intersectRay(this.getPickRay(v,this.tmpRay),c(this.viewingMode),x)};k.intersectScreenFreePointFallback=function(v,x){return this.intersectRayFreePointFallback(this.getPickRay(v,this.tmpRay),x)};k.intersectRayFreePointFallback=function(v,x){return this.intersectRay(v,c(this.viewingMode),x)||this.intersectRayFreePointLocal(v,x)};k.intersectRay=function(v,x,C,A){x.options.selectionMode=!1;x.options.store=0;this.computeIntersection(v,x,A);return x.results.min?x.results.min.getIntersectionPoint(C):
!1};k.getCenterRayWithSubpixelOffset=function(v,x,C=.5,A=.5){v.getRenderCenter(n,C,A);n[0]+=.0466;n[1]-=.0123;return e.fromRenderAtEye(v,n,x)};k.intersectIntersectorScreen=function(v,x,C){this.computeIntersection(this.getPickRay(v,this.tmpRay),x,C)};k.intersectToolIntersectorScreen=function(v,x,C){v=this.getPickRay(v,this.tmpRay);this.intersectToolIntersectorRay(v,x,C)};k.intersectToolIntersectorRay=function(v,x,C){x.options.selectionMode=!0;this.computeIntersection(v,x,C);const A=x.results.min;this.view.basemapTerrain&&
this.view.basemapTerrain.opaque||A.hasIntersectionPoint&&"TerrainRenderer"!==A.intersector||(x.options.selectionMode=!1,this.computeIntersection(v,x,C))};k.setTolerance=function(v=l.Intersector.DEFAULT_TOLERANCE){this.tolerance=v};k.addIntersectionHandler=function(v){this.externalIntersectionHandlers.push(v);this.externalIntersectionHandlers.sort((x,C)=>"Terrain"===x.type?1:"Terrain"===C.type?-1:0)};k.removeIntersectionHandler=function(v){this.externalIntersectionHandlers.removeUnordered(v);this.externalIntersectionHandlers.sort((x,
C)=>"Terrain"===x.type?1:"Terrain"===C.type?-1:0)};k.getPickRay=function(v,x=f.create()){return e.fromScreen(this.view.state.camera,v,x)};k.intersectRayFreePointLocal=function(v,x){if(2!==this.viewingMode||p.isNone(v))return!1;var C=this.view.renderDataExtent;if(p.isNone(C))return q.add(x,v.origin,q.normalize(w.sv3d.get(),v.direction)),!0;var A=Math.max(C.xmax-C.xmin,C.ymax-C.ymin,8*Math.max(C.xmax-C.xmin,C.ymax-C.ymin));if(0===A)return q.add(x,v.origin,q.normalize(w.sv3d.get(),v.direction)),!0;var B=
this.view.state.camera;const D=Math.max(0,C.xmin-B.eye[0],B.eye[0]-C.xmax);C=Math.max(0,C.ymin-B.eye[1],B.eye[1]-C.ymax);B=A/Math.max(1,Math.max(0,Math.log(A/(Math.abs(B.relativeElevation)+Number.MIN_VALUE)))**2);B=Math.max(B,Math.min(Math.sqrt(D*D+C*C),A));A=q.scale(w.sv3d.get(),v.direction,B/q.length(v.direction));q.add(x,v.origin,A);return!0};k.intersectElevationFromScreen=function(v,x,C=0,A=null){return this.intersectElevation(this.getPickRay(v,this.tmpRay),x,C,A)};k.intersectElevation=function(v,
x,C=0,A=null){if(p.isNone(v))return null;var B=p.isSome(x)?x.mode:"absolute-height",D=p.isSome(x)?p.unwrapOr(x.offset,0):0,E="on-the-ground"!==B?D+C:0;x=E/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===B)return this.view.renderCoordsHelper.intersectInfiniteManifold(v,E,m)?(C=this.view.computeMapPointFromVec3d(m),C.z-=D,C):null;D=this.view.state.camera;const G=r.castRenderScreenPointArray3(w.sv3d.get());D.projectToRenderScreen(v.origin,G);E=this.prepareFilters(null,h);const K=this.view.slicePlane,
M=p.isSome(K)?g.sliceFilterPredicate(K):null,H=new l.Intersector(this.viewingMode);H.options.store=0;H.options.verticalOffset=x;x=v.origin;v=q.add(w.sv3d.get(),x,v.direction);H.reset(x,v);H.point=G;H.camera=D;H.filterPredicate=null;const J=p.isSome(A)?"type"in A&&"graphics"===A.type?O=>O.metadata.layerUid!==A.uid:O=>O.metadata.graphicUid!==A.uid:null;switch(B){case "relative-to-scene":H.intersect(E.layers,G,D,this.tolerance,null,O=>(p.isNone(J)||J(O))&&O.metadata&&O.metadata.isElevationSource);this.externalIntersectionHandlers.forAll(O=>
{"I3S"!==O.type&&"Terrain"!==O.type||O.intersect(H,O.slicePlane?M:null,H.rayBeginPoint,H.rayEndPoint,G)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forAll(O=>{O.isGround&&O.intersect(H,O.slicePlane?M:null,H.rayBeginPoint,H.rayEndPoint,G)})}return H.results.min.getIntersectionPoint(m)?(B=this.view.computeMapPointFromVec3d(m),B.z=C,B):null};k.computeIntersection=function(v,x,C){if(!p.isNone(v)){var A=this.view.state.camera,B=r.castRenderScreenPointArray3(w.sv3d.get());
A.projectToRenderScreen(v.origin,B);var D=this.prepareFilters(C,h);x.options.selectOpaqueTerrainOnly=!C||!("include"in C||"exclude"in C);var E=v.origin,G=q.add(w.sv3d.get(),v.origin,v.direction);x.reset(E,G);x.intersect(D.layers,B,A,this.tolerance);v=this.view.slicePlane;var K=p.isSome(v)?g.sliceFilterPredicate(v):null;x.intersect(D.sliceableLayers,B,A,this.tolerance,K);var M=C&&(C.requiresGroundFeedback||C.enableDraped);this.externalIntersectionHandlers.forAll(H=>{x.options.isFiltered=!D.filterLayerUid(H.intersectionHandlerId);
(H.isGround&&M||!x.options.isFiltered)&&H.intersect(x,H.slicePlane?K:null,E,G,B)});v=w.sv3d.get();if(C&&C.enableDraped&&x.results.ground.getIntersectionPoint(v)){C=this.view.basemapTerrain.overlayManager.renderer;const H=this.view.renderCoordsHelper.spatialReference,J=w.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(v,J,this.view.spatialReference);J[2]=p.unwrapOr(this.view.elevationProvider.getElevation(v[0],v[1],v[2],H,"ground"),0);C.intersect(x,J,D.filterRenderGeometry)}x.sortResults();
v=x.results.hud;if(v.hasIntersectionPoint){const H=r.castRenderScreenPointArray3(w.sv3d.get()),J=w.sv3d.get(),O=w.sv3d.get();this.unprojectHUDResultRay(v.center,H,J,O);C=q.distance(v.center,J)/q.distance(J,O)*.99;this.validateHUDIntersector.reset(J,O);this.validateHUDIntersector.intersect(D.layers,H,A,this.tolerance);this.validateHUDIntersector.intersect(D.sliceableLayers,H,A,this.tolerance,K);this.externalIntersectionHandlers.forAll(I=>{D.filterLayerUid(I.intersectionHandlerId)&&I.intersect(this.validateHUDIntersector,
I.slicePlane?K:null,J,O,H)});A=this.validateHUDIntersector.results.min;if(null==A.dist||C<=A.dist)x.results.min.copyFrom(v),x.results.all.splice(0,0,v)}}};k.prepareFilters=function(v,x){const C=[],A=[];this.layerProvider.forEachLayer(B=>{B.isPickable&&(B.isSliceable?A:C).push(B)});x.include=v&&v.include;x.exclude=v&&v.exclude;x.layers.length=0;x.sliceableLayers.length=0;d(C,x.filterLayer,x.layers);d(A,x.filterLayer,x.sliceableLayers);return x};k.unprojectHUDResultRay=function(v,x,C,A){const B=this.view.state.camera;
B.projectToRenderScreen(v,x);v=r.castRenderScreenPointArray3(w.sv3d.get());v[0]=x[0];v[1]=x[1];v[2]=0;B.unprojectFromRenderScreen(v,C);v[2]=1;B.unprojectFromRenderScreen(v,A)};return z}(),t;const h={include:null,exclude:null,layers:[],sliceableLayers:[],filterLayer(z){return h.filterLayerUid(z.apiLayerUid)},filterLayerUid(z){const {include:k,exclude:v}=h;return p.isNone(z)?null==k&&null==v:(null==k||k.has(z))&&(null==v||!v.has(z))},filterRenderGeometry(z){return h.filterLayerUid(z.layerUid)}},m=y.create(),
n=r.createRenderScreenPointArray3();a.SceneIntersectionHelper=u;a.isIntersectionHandler=function(z){return"object"===typeof z&&"intersect"in z};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../layers/graphics/ElevationQuery".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){function u(t,h,m,n,z,k,v){for(const x of h)h=x.getElevation(m,n,z,k,v),y.isSome(h)&&(t=y.isSome(t)?Math.max(h,t):h);return t}a.CombinedElevationProvider=function(t){function h(n){n=t.call(this,n)||this;n.im=[];n.ground=[];n.scene=[];n.handles=new Map;n.lastElevationQuery=null;n.elevationCacheEnabled=!1;return n}p._inheritsLoose(h,t);var m=h.prototype;m.destroy=function(){this._elevationQuery=y.destroyMaybe(this._elevationQuery)};m.enableElevationCache=function(n){n||
(this.lastElevationQuery=null);this.elevationCacheEnabled=n};m.getElevation=function(n,z,k,v,x){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var C=this.lastElevationQuery;if(n===C.x&&z===C.y&&k===C.z&&v.equals(C.spatialReference)&&x===C.queryContext)return C.result}C=u(null,this.im,n,z,k,v,x);y.isNone(C)&&(C=u(C,this.ground,n,z,k,v,x));"scene"===x&&(C=u(C,this.scene,n,z,k,v,x));this.elevationCacheEnabled&&(this.lastElevationQuery={x:n,y:z,z:k,spatialReference:v,queryContext:x,result:C});
return C};m.queryElevation=function(n,z,k,v,x,C=null,A=0){const B=f.createResolver();this.elevationQuery.queryElevation(n,z,C,A).then(D=>{"scene"===x&&(D=u(D,this.scene,n,z,k,v,x));B.resolve(D)}).catch(D=>{f.isAbortError(D)?B.reject(D):B.resolve(this.getElevation(n,z,k,v,x))});return B.promise};m.register=function(n,z){this.handles.set(z,z.on("elevation-change",k=>this.emit("elevation-change",k)));this[n].push(z)};m.unregister=function(n){this.handles.has(n)&&(this.handles.get(n).remove(),this.handles.delete(n));
for(const z of[this.im,this.ground,this.scene]){const k=z.indexOf(n);-1<k&&z.splice(k,1)}};p._createClass(h,[{key:"elevationQuery",get:function(){y.isNone(this._elevationQuery)&&(this._elevationQuery=new c.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQuery}}]);return h}(q.EventedMixin(r));b.__decorate([w.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,
"view",void 0);b.__decorate([w.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],a.CombinedElevationProvider.prototype,"spatialReference",void 0);a.CombinedElevationProvider=b.__decorate([d.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,p,b,r,q,y,f,w){b=function(){function l(d,c){this.spatialReference=d;this.view=c}var g=l.prototype;g.getElevation=function(d,c,u){return this.view.elevationProvider.getElevation(d,c,0,this.spatialReference,u)};g.queryElevation=function(){var d=p._asyncToGenerator(function*(c,u,t,h,m){return this.view.elevationProvider.queryElevation(c,u,0,this.spatialReference,m,t,h)});return function(c,u,t,h,m){return d.apply(this,arguments)}}();return l}();let e=function(){function l(d,c,u,t){this.spatialReference=
c;this._getElevationQueryProvider=u;this._queries=[];this._queryOptions={...t,ignoreInvisibleLayers:!0};this._frameTask=d.registerTask(f.TaskPriority.ELEVATION_QUERY,this)}var g=l.prototype;g.destroy=function(){this._frameTask.remove()};g.queryElevation=function(d,c,u,t=0){return new Promise((h,m)=>{const n={x:d,y:c,minDemResolution:t,result:{resolve:h,reject:m},signal:u};this._queries.push(n);y.onAbort(u,()=>{r.remove(this._queries,n);m(y.createAbortError())})})};g.runTask=function(){const d=this._queries;
this._queries=[];const c=this._getElevationQueryProvider();if(c){var u=d.map(n=>[n.x,n.y]),t=d.reduce((n,z)=>Math.min(n,z.minDemResolution),Infinity);u=new w({points:u,spatialReference:this.spatialReference});var h=1<d.length&&d.some(n=>!!n.signal)?y.createAbortController():null,m=q.isSome(h)?h.signal:d[0].signal;if(q.isSome(h)){let n=0;d.forEach(z=>y.onAbort(z.signal,()=>{n++;z.result.reject(y.createAbortError());n===d.length&&h.abort()}))}c.queryElevation(u,{...this._queryOptions,minDemResolution:t,
signal:m}).then(n=>{d.forEach((z,k)=>{q.isSome(z.signal)&&z.signal.aborted?z.result.reject(y.createAbortError()):z.result.resolve(n.geometry.points[k][2])})}).catch(n=>{d.forEach(z=>z.result.reject(n))})}else d.forEach(n=>n.result.reject())};p._createClass(l,[{key:"running",get:function(){return 0<this._queries.length}},{key:"test",get:function(){const d=this;return{update:()=>0<d._queries.length&&d.runTask()}}}]);return l}();a.ElevationQuery=e;a.ViewElevationProvider=b;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has"],function(a){function p(){const r=!!a("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},
tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:r?.8:1,polylineLodFactor:r?1.2:1.5},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,
lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:r},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:r?600:750,additionalCacheMemory:r?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,
maxTotalNumberOfPrimitives:17E5,polygonLodFactor:r?1.2:2,polylineLodFactor:r?1.2:2},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,
highQualityTransparency:!0,memoryLimit:r?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:r?null:4096,maximumPixelRatio:r?1:null}}}let b=function(){function r(){}r.isValidProfile=function(q){return q in r.profiles};r.getDefaultProfile=function(){return a("trident")||a("esri-iPhone")?"low":"medium"};r.apply=function(q,y){q=r.profiles[q];y.graphics3D.maxTotalNumberOfFeatures=q.graphics3D.maxTotalNumberOfFeatures;y.graphics3D.maxTotalNumberOfPrimitives=q.graphics3D.maxTotalNumberOfPrimitives;
y.graphics3D.polygonLodFactor=q.graphics3D.polygonLodFactor;y.graphics3D.polylineLodFactor=q.graphics3D.polylineLodFactor;{const f=y.sceneService["3dObject"],w=q.sceneService["3dObject"];f.lodFactor=w.lodFactor;f.lodCrossfadeinDuration=w.lodCrossfadeinDuration;f.lodCrossfadeoutDuration=w.lodCrossfadeoutDuration;f.lodCrossfadeUncoveredDuration=w.lodCrossfadeUncoveredDuration}y.sceneService.point.lodFactor=q.sceneService.point.lodFactor;y.sceneService.integratedMesh.lodFactor=q.sceneService.integratedMesh.lodFactor;
y.sceneService.pointCloud.lodFactor=q.sceneService.pointCloud.lodFactor;y.sceneService.uncompressedTextureDownsamplingEnabled=q.sceneService.uncompressedTextureDownsamplingEnabled;y.tiledSurface.lodBias=q.tiledSurface.lodBias;y.tiledSurface.angledSplitBias=q.tiledSurface.angledSplitBias;y.tiledSurface.reduceTileLevelDifferences=q.tiledSurface.reduceTileLevelDifferences;y.tiledSurface.textureFadeDuration=q.tiledSurface.textureFadeDuration;y.antialiasingEnabled=q.antialiasingEnabled;y.physicallyBasedRenderingEnabled=
q.physicalBasedRenderingEnabled;y.highQualityTransparency=q.highQualityTransparency;y.memoryLimit=q.memoryLimit;y.additionalCacheMemory=q.additionalCacheMemory;y.frameRate=q.frameRate;y.maximumRenderResolution=q.maximumRenderResolution;y.maximumPixelRatio=q.maximumPixelRatio};return r}();b.debug={reset(){const r=p();for(const q in r)b.profiles[q]=r[q]}};(b||(b={})).profiles=p();return b})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f32".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){r=function(d){function c(){var u=d.apply(this,arguments)||this;u.color=new b([0,255,255]);u.haloColor=null;u.haloOpacity=1;u.fillOpacity=.25;u.shadowOpacity=.4;u.shadowColor=new b([0,0,0]);u.shadowDifference=.2;return u}a._inheritsLoose(c,d);c.toEngineOptions=function(u){const t=b.toUnitRGBA(u.color),h=q.isSome(u.haloColor)?b.toUnitRGBA(u.haloColor):t,m=b.toUnitRGBA(u.shadowColor);return{color:g.fromValues(t[0],t[1],t[2],t[3]),haloColor:g.fromValues(h[0],h[1],h[2],
h[3]),haloOpacity:u.haloOpacity,haloOpacityOccluded:.25*u.haloOpacity,fillOpacity:u.fillOpacity,fillOpacityOccluded:.25*u.fillOpacity,shadowOpacity:u.shadowOpacity,shadowColor:g.fromValues(m[0],m[1],m[2],m[3]),occludedShadowOpacity:u.shadowOpacity*(1-u.shadowDifference)}};return c}(r);p.__decorate([y.property({type:b})],r.prototype,"color",void 0);p.__decorate([y.property({type:b})],r.prototype,"haloColor",void 0);p.__decorate([y.property()],r.prototype,"haloOpacity",void 0);p.__decorate([y.property()],
r.prototype,"fillOpacity",void 0);p.__decorate([y.property()],r.prototype,"shadowOpacity",void 0);p.__decorate([y.property({type:b})],r.prototype,"shadowColor",void 0);p.__decorate([y.property()],r.prototype,"shadowDifference",void 0);return r=p.__decorate([l.subclass("esri.views.3d.support.HighlightOptions")],r)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function p(){return new Float32Array(4)}function b(z){const k=new Float32Array(4);k[0]=z[0];k[1]=z[1];k[2]=z[2];k[3]=z[3];
return k}function r(z,k,v,x){const C=new Float32Array(4);C[0]=z;C[1]=k;C[2]=v;C[3]=x;return C}function q(z,k){return new Float32Array(z,k,4)}function y(){return p()}function f(){return r(1,1,1,1)}function w(){return r(1,0,0,0)}function e(){return r(0,1,0,0)}function l(){return r(0,0,1,0)}function g(){return r(0,0,0,1)}const d=p(),c=f(),u=w(),t=e(),h=l(),m=g();var n=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,createView:q,zeros:y,ones:f,unitX:w,unitY:e,unitZ:l,unitW:g,ZEROS:d,ONES:c,
UNIT_X:u,UNIT_Y:t,UNIT_Z:h,UNIT_W:m});a.ONES=c;a.UNIT_W=m;a.UNIT_X=u;a.UNIT_Y=t;a.UNIT_Z=h;a.ZEROS=d;a.clone=b;a.create=p;a.createView=q;a.fromValues=r;a.ones=f;a.unitW=g;a.unitX=w;a.unitY=e;a.unitZ=l;a.vec4f32=n;a.zeros=y})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/asyncUtils ../../../core/Error ../../../core/unitUtils ../../../geometry/projectionEllipsoid ../../../portal/support/geometryServiceUtils ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){b=function(){function d(u,t,h=null){this.spatialReference=t;this.unitInMeters=y.getMetersPerUnitForSR(this.spatialReference,f.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServicePromise=r.result(this.loadGeometryService(u,h))}var c=d.prototype;c.loadGeometryService=function(){var u=p._asyncToGenerator(function*(t,h){if(h)return h;try{return yield w.create(t&&t.get("portalItem"))}catch{throw new q("mapcoordshelper:missing-geometry-service",
"Must specify geometryService in esri/config");}});return function(t,h){return u.apply(this,arguments)}}();c.awaitGeometryService=function(){var u=p._asyncToGenerator(function*(){const t=yield this._geometryServicePromise;if(!0===t.ok)return t.value;throw t.error;});return function(){return u.apply(this,arguments)}}();c.toGeographic=function(){var u=p._asyncToGenerator(function*(t){var h=yield this.awaitGeometryService();let m=!0;Array.isArray(t[0])&&"number"!==typeof t[0]||(t=[t],m=!1);t=t.map(n=>
n instanceof l?n:new l(n,this.spatialReference));t=new e({geometries:t,outSpatialReference:g.WGS84});h=(yield h.project(t)).map(n=>"point"===n.type?[n.x,n.y]:void 0);return m?h:h[0]});return function(t){return u.apply(this,arguments)}}();return d}();a.MapCoordsHelper=b;a["default"]=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/portal/support/geometryServiceUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../core/Error ../Portal ../../rest/support/ProjectParameters".split(" "),
function(a,p,b,r,q,y,f){function w(){return e.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(g=null,d){if(r.geometryServiceUrl)return new (yield new Promise(function(c,u){a(["../../tasks/GeometryService"],function(t){c(Object.freeze({__proto__:null,default:t}))},u)})).default({url:r.geometryServiceUrl});if(!g)throw new q("internal:geometry-service-url-not-configured");g="portal"in g?g.portal||y.getDefault():g;yield g.load({signal:d});if(g.helperServices&&g.helperServices.geometry&&
g.helperServices.geometry.url)return new (yield new Promise(function(c,u){a(["../../tasks/GeometryService"],function(t){c(Object.freeze({__proto__:null,default:t}))},u)})).default({url:g.helperServices.geometry.url});throw new q("internal:geometry-service-url-not-configured");});return e.apply(this,arguments)}function l(){l=b._asyncToGenerator(function*(g,d,c=null,u){c=yield w(c,u);const t=new f;t.geometries=[g];t.outSpatialReference=d;if((g=yield c.project(t,{signal:u}))&&Array.isArray(g)&&1===g.length)return g[0];
throw new q("internal:geometry-service-projection-failed");});return l.apply(this,arguments)}p.create=w;p.projectGeometry=function(g,d){return l.apply(this,arguments)};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,p,b,r,q,y,f,w,e){b=function(l){function g(d){d=l.call(this,d)||this;d.geometries=null;d.outSpatialReference=null;d.transformation=null;d.transformForward=null;return d}a._inheritsLoose(g,l);g.prototype.toJSON=function(){const d=this.geometries.map(function(t){return t.toJSON()}),c=this.geometries[0],u={};u.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());u.inSR=c.spatialReference.wkid||JSON.stringify(c.spatialReference.toJSON());u.geometries=JSON.stringify({geometryType:e.getJsonType(c),
geometries:d});this.transformation&&(u.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(u.transformForward=this.transformForward);return u};return g}(b.JSONSupport);p.__decorate([r.property()],b.prototype,"geometries",void 0);p.__decorate([r.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);p.__decorate([r.property()],b.prototype,"transformation",void 0);p.__decorate([r.property()],b.prototype,"transformForward",
void 0);return b=p.__decorate([w.subclass("esri.rest.support.ProjectParameters")],b)})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,p,b,r,q,y,f,w){let e=function(u){function t(){var h=u.apply(this,
arguments)||this;h.minTotalNumberOfFeatures=2E3;h.maxTotalNumberOfFeatures=5E4;h.maxTotalNumberOfPrimitives=17E5;h.polygonLodFactor=1;h.polylineLodFactor=1;return h}a._inheritsLoose(t,u);return t}(b);p.__decorate([r.property()],e.prototype,"minTotalNumberOfFeatures",void 0);p.__decorate([r.property()],e.prototype,"maxTotalNumberOfFeatures",void 0);p.__decorate([r.property()],e.prototype,"maxTotalNumberOfPrimitives",void 0);p.__decorate([r.property()],e.prototype,"polygonLodFactor",void 0);p.__decorate([r.property()],
e.prototype,"polylineLodFactor",void 0);e=p.__decorate([w.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],e);let l=function(u){function t(){var h=u.apply(this,arguments)||this;h.lodFactor=1;return h}a._inheritsLoose(t,u);return t}(b);p.__decorate([r.property()],l.prototype,"lodFactor",void 0);l=p.__decorate([w.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],l);let g=function(u){function t(){var h=u.apply(this,arguments)||this;h.lodCrossfadeinDuration=0;h.lodCrossfadeoutDuration=
0;h.lodCrossfadeUncoveredDuration=0;return h}a._inheritsLoose(t,u);return t}(l);g=p.__decorate([w.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],g);let d=function(u){function t(){var h=u.apply(this,arguments)||this;h["3dObject"]=new g;h.point=new l;h.integratedMesh=new l;h.pointCloud=new l;h.uncompressedTextureDownsamplingEnabled=!1;return h}a._inheritsLoose(t,u);return t}(b);p.__decorate([r.property({type:g})],d.prototype,"3dObject",void 0);p.__decorate([r.property({type:l})],
d.prototype,"point",void 0);p.__decorate([r.property({type:l})],d.prototype,"integratedMesh",void 0);p.__decorate([r.property({type:l})],d.prototype,"pointCloud",void 0);p.__decorate([r.property()],d.prototype,"uncompressedTextureDownsamplingEnabled",void 0);d=p.__decorate([w.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],d);let c=function(u){function t(){var h=u.apply(this,arguments)||this;h.lodBias=0;h.angledSplitBias=1;h.reduceTileLevelDifferences=!0;h.textureFadeDuration=
500;return h}a._inheritsLoose(t,u);return t}(b);p.__decorate([r.property()],c.prototype,"lodBias",void 0);p.__decorate([r.property()],c.prototype,"angledSplitBias",void 0);p.__decorate([r.property()],c.prototype,"reduceTileLevelDifferences",void 0);p.__decorate([r.property()],c.prototype,"textureFadeDuration",void 0);c=p.__decorate([w.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],c);b=function(u){function t(){var h=u.apply(this,arguments)||this;h.graphics3D=new e;h.sceneService=
new d;h.tiledSurface=new c;h.antialiasingEnabled=!0;h.physicallyBasedRenderingEnabled=!1;h.highQualityTransparency=!0;return h}a._inheritsLoose(t,u);return t}(b);p.__decorate([r.property({type:e})],b.prototype,"graphics3D",void 0);p.__decorate([r.property({type:d})],b.prototype,"sceneService",void 0);p.__decorate([r.property({type:c})],b.prototype,"tiledSurface",void 0);p.__decorate([r.property()],b.prototype,"antialiasingEnabled",void 0);p.__decorate([r.property()],b.prototype,"physicallyBasedRenderingEnabled",
void 0);p.__decorate([r.property()],b.prototype,"highQualityTransparency",void 0);p.__decorate([r.property()],b.prototype,"memoryLimit",void 0);p.__decorate([r.property()],b.prototype,"additionalCacheMemory",void 0);p.__decorate([r.property()],b.prototype,"frameRate",void 0);p.__decorate([r.property()],b.prototype,"maximumRenderResolution",void 0);p.__decorate([r.property()],b.prototype,"maximumPixelRatio",void 0);return b=p.__decorate([w.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],
b)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d){let c=function(){function u(h,
m,n,z){this.viewingMode=h;this.spatialReference=m;this.unitInMeters=n;this.coordinateSystem=z;this._coordinateSystem=e.create(z)}var t=u.prototype;t.getAltitude=function(h){return e.altitudeAt(this.coordinateSystem,h)};t.setAltitude=function(h,m,n=h){return e.setAltitudeAt(this.coordinateSystem,n,m,h)};t.setAltitudeOfTransformation=function(h,m){e.setAltitudeOfTransformation(this.coordinateSystem,m,h,m)};t.worldUpAtPosition=function(h,m){return e.normalAt(this.coordinateSystem,h,m)};t.worldBasisAtPosition=
function(h,m,n){return e.axisAt(this.coordinateSystem,h,m,n)};t.basisMatrixAtPosition=function(h,m){const n=this.worldBasisAtPosition(h,0,g.sv3d.get()),z=this.worldBasisAtPosition(h,1,g.sv3d.get());h=this.worldBasisAtPosition(h,2,g.sv3d.get());q.set(m,n[0],n[1],n[2],0,z[0],z[1],z[2],0,h[0],h[1],h[2],0,0,0,0,1);return m};t.intersectManifoldClosestSilhouette=function(h,m,n){e.elevate(this.coordinateSystem,m,this._coordinateSystem);e.intersectRayClosestSilhouette(this._coordinateSystem,h,n);return n};
t.intersectManifold=function(h,m,n){e.elevate(this.coordinateSystem,m,this._coordinateSystem);m=g.sv3d.get();return e.intersectRay(this._coordinateSystem,h,m)?y.copy(n,m):null};t.intersectInfiniteManifold=function(h,m,n){if(1===this.viewingMode)return this.intersectManifold(h,m,n);e.elevate(this.coordinateSystem,m,this._coordinateSystem);m=this._coordinateSystem.value;const z=g.sv3d.get();return l.intersectRay(m.plane,h,z)?y.copy(n,z):null};t.toRenderCoords=function(h,m,n){return d.isDehydratedPoint(h)?
f.projectPointToVector(h,m,this.spatialReference):f.projectVectorToVector(h,m,n,this.spatialReference)};t.fromRenderCoords=function(h,m,n=null){return d.isDehydratedPoint(m)?(b.isSome(n)&&(m.spatialReference=n),f.projectVectorToDehydratedPoint(h,this.spatialReference,m)):m instanceof w?f.projectVectorToPoint(h,this.spatialReference,m):f.projectVectorToVector(h,this.spatialReference,m,n)?m:null};u.create=function(h,m){switch(h){case 2:return new u(2,m,r.getMetersPerUnitForSR(m),e.createLocal());case 1:return new u(1,
m,1,e.createGlobal(m))}};p._createClass(u,[{key:"extent",set:function(h){h&&e.setExtent(this.coordinateSystem,h,this.coordinateSystem)}}]);return u}();a.RenderCoordsHelper=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){a.ResourceControllerMain=function(z){function k(){var v=z.apply(this,arguments)||this;v.updating=!1;return v}p._inheritsLoose(k,z);return k}(r);b.__decorate([e.property({readOnly:!0})],a.ResourceControllerMain.prototype,"updating",void 0);a.ResourceControllerMain=b.__decorate([c.subclass("esri.views.3d.support.ResourceController")],a.ResourceControllerMain);var n;(function(z){let k=function(v){function x(){var A=v.apply(this,arguments)||this;A._scheduler=
null;A._memoryController=null;A._streamDataLoader=null;A._cameraChangeTime=0;A._handles=new q;A._frameTask=null;A._scheduleTask=m.ImmediateTask;A._state=2;return A}p._inheritsLoose(x,v);var C=x.prototype;C.initialize=function(){this._cameraChangeTime=this.now();this._scheduler=m.newScheduler(this.now);this._memoryController=t.newMemoryController(this.view);this._streamDataLoader=new h["default"];this._streamDataLoader.setup(u.maxDownloadSlots,u.downloadSlotsPerClient,this._scheduler);this._handles.add([this.view.watch("state.camera",
(A,B)=>this._cameraChangedHandler(A,B),!0),this.view.watch("stationary",()=>this._stationaryChangedHandler()),this._memoryController.events.on("updating-changed",()=>this.notifyChange("updating"))]);this._frameTask=f.addFrameTask({update:A=>this.frame(A)});this._scheduleTask=this._scheduler.registerTask(m.TaskPriority.RESOURCE_CONTROLLER)};C.destroy=function(){this._handles=y.destroyMaybe(this._handles);this._scheduleTask.remove();this._frameTask=y.removeMaybe(this._frameTask);this._streamDataLoader=
y.destroyMaybe(this._streamDataLoader);this._memoryController=y.destroyMaybe(this._memoryController);this._scheduler=y.destroyMaybe(this._scheduler)};C.schedule=function(A,B,D){return this._scheduleTask.schedule(A,B,D)};C.createStreamDataRequester=function(A){const B=this._streamDataLoader;return{request(D,E,G){return B.request(D,E,A,G)},get busy(){return!B.hasDownloadSlots(A)}}};C.frame=function(A){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(w.SecondsFromMilliseconds(A.deltaTime)),
!this._scheduler))return;this._scheduler.state=this.state;this._scheduler.updateBudget(A)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};C._cameraChangedHandler=function(A,B){A&&B&&A.almostEquals(B)||(this._cameraChangeTime=this._scheduler.now,this._scheduler.state=this.state)};C._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};p._createClass(x,[{key:"updating",get:function(){var A,B;return!!(null!=
(A=this._memoryController)&&A.updating||null!=(B=this._streamDataLoader)&&B.updating)}},{key:"scheduler",get:function(){return this._scheduler}},{key:"memoryController",get:function(){return this._memoryController}},{key:"state",get:function(){const A=this.view;A.animation?this._state=0:A.interacting?this._state=1:(0===this._state&&(this._cameraChangeTime=0),this._state=300>=this._scheduler.now-this._cameraChangeTime?1:2);return this._state}},{key:"test",get:function(){return{getQueueStats:A=>this._streamDataLoader.test.loadQueue.getStatsForType(A),
state:this.state}}}]);return x}(a.ResourceControllerMain);b.__decorate([e.property({constructOnly:!0})],k.prototype,"view",void 0);b.__decorate([e.property({constructOnly:!0})],k.prototype,"now",void 0);b.__decorate([e.property()],k.prototype,"_scheduler",void 0);b.__decorate([e.property()],k.prototype,"_memoryController",void 0);b.__decorate([e.property()],k.prototype,"_streamDataLoader",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"updating",null);k=b.__decorate([c.subclass("esri.views.3d.support.ResourceController")],
k);z.ResourceController=k})(n||(n={}));a.newResourceController=function(z,k=()=>performance.now()){return new n.ResourceController({view:z,now:k})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/index":function(){define(["exports"],function(a){a.downloadSlotsPerClient=[10,10,10,10,5];a.maxDownloadSlots=30;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),
function(a,p,b,r,q,y,f){const w=r.getLogger("esri.views.3d.support.MemoryController");let e=function(){function l(d){this._view=d;this.events=new b;this.minQuality=.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new y.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}var g=l.prototype;g.destroy=function(){this.events=null;this._cacheStorage.destroy()};
g.getMemCache=function(d,c){return new y.MemCache(d,this._cacheStorage,c)};g.disableMemCache=function(){this._additionalCacheMemory=-4096};g.resetStableQuality=function(){this._stableQuality=0};g.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var d=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(d){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<
this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,d=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>
this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,d=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this.updating!==d&&(this._updating=d,this.events.emit("updating-changed",this.updating))}};g._updateQuality=function(d){d=Math.min(Math.max(d,this.minQuality),1);if(d===this._quality)return!1;this._quality=d;this.events.emit("quality-changed",this._quality);++this._numQualityChanges;return!0};g._layersUpdating=function(){return this._view.allLayerViews.some(d=>
!!d.updating)};g._updateMemory=function(){let d=0,c=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(d+=this._view.basemapTerrain.getUsedMemory());var u=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;q.isSome(u)&&(d+=u.usedMemory);this._view.allLayerViews&&this._view.allLayerViews.forEach(h=>{if(f.isMemoryManagedLayerView(h)){const m=h.ignoresMemoryFactor()?this._quality:1;d+=h.getUsedMemory()*m;c+=h.getUnloadedMemory()*m}});var t=null==
this._warnMemoryUsage||Math.round(10*d)!==Math.round(10*this._warnMemoryUsage);u=1048576*this._maxMemory;if(d>u&&t){this._warnMemoryUsage=d;t=m=>(m/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const h=Math.round(100*this._quality);w.warn(`Memory Limit exceeded! Limit: ${t(u)} Current: ${t(d)} Projected: ${t(d+c)} Quality: ${h}%`)}this._memoryUsed=d/u;this._memoryPredicted=(d+c)/u;this._cacheStorage.maxSize=Math.max(0,u-d+1048576*this._additionalCacheMemory);this.events.emit("memory-used",
this._memoryUsed)};p._createClass(l,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(d){null!=d&&0<d&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<d&&this._updateQuality(1),this._maxMemory=d)}},{key:"additionalCacheMemory",set:function(d){null!=d&&0<=d&&(this._additionalCacheMemory=d)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._memoryUsed}},{key:"test",
get:function(){const d=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const c=d._numQualityChanges;d._numQualityChanges=0;return c}}}}]);return l}();a.newMemoryController=function(l){return new e(l)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports"],function(a){a.isMemoryManagedLayerView=function(p){return"function"===typeof p.getUsedMemory};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ./StreamDataLoaderTask ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z){function k(x){if(2>x.byteLength)return"unknown";x=new Uint8Array(x,0,x.byteLength);return 137===x[0]&&80===x[1]?"image/png":71===x[0]&&73===x[1]?"image/gif":66===x[0]&&77===x[1]?"image/bmp":255===x[0]&&216===x[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(x){function C(){var B=x.apply(this,arguments)||this;B.tasks=new Map;B.onLoadQueue=[];B.doneQueue=[];B.updating=!1;return B}p._inheritsLoose(C,x);var A=C.prototype;A.setup=function(B,D,E){this.loadQueue=
new h.AsyncWorkerQueue((G,K)=>this.startLoading(G,K),(G,K)=>this.doneLoadingCallback(G,K),B,D);E&&(this.taskHandle=E.registerTask(z.TaskPriority.STREAM_DATA_LOADER,this))};A.destroy=function(){this.taskHandle=e.removeMaybe(this.taskHandle);this.tasks.forEach(B=>{B.abortController&&B.abortController.abort()});this.loadQueue.destroy();this.tasks=this.doneQueue=this.onLoadQueue=this.loadQueue=null};A.hasDownloadSlots=function(B){return this.loadQueue.hasQuota(B)};A.request=function(B,D,E,G={}){const K=
l.createResolver();K.__signal=e.isSome(G)?G.signal:null;const M=this.createOrUpdateTask(B,D,E,G,K);l.onAbort(G,()=>this.cancelRequest(M,K));return K.promise};A.createTask=function(B,D,E,G,K,M){B=new m(B,D,E,G,K);this.updateTask(B,M);this.tasks.set(K,B);1===this.tasks.size&&this._set("updating",!0);this.loadQueue.push(B);return B};A.cancelRequest=function(B,D){y.removeUnordered(B.resolvers,D);D.reject(l.createAbortError());0===B.resolvers.length&&(2===B.status&&(B.status=4,this.loadQueue.cancel(B),
B.abortController.abort(),B.request=null,B.abortController=null),B.status=4,this.tasks.delete(B.key),0===this.tasks.size&&this._set("updating",!1))};A.taskKey=function(B,D,E){return`${B}:${D}:${E}`};A.updateTask=function(B,D){B.resolvers.push(D)};A.createOrUpdateTask=function(B,D,E,G,K){var M=e.isSome(G)&&G.uid||B;M=this.taskKey(M,D,E);const H=this.tasks.get(M);return H?(this.updateTask(H,K),H):this.createTask(B,G,D,E,M,K)};A.doneLoadingCallback=function(B,D){this.loadQueue&&(n.assert(2===B.status),
B.status=3,this.taskHandle?this.doneQueue.push({task:B,err:D}):this.doneLoading(B,D))};A.runTask=function(B){for(;!B.done&&0<this.onLoadQueue.length;){var D=this.onLoadQueue.shift();l.throwIfAborted(D.task.abortController);D.task.abortController=null;D.callback(D.task);B.madeProgress()}for(;!B.done&&0<this.doneQueue.length;)D=this.doneQueue.shift(),3!==D.task.status&&(D.err=D.err||l.createAbortError()),this.doneLoading(D.task,D.err),B.madeProgress()};A.doneLoading=function(B,D){let E=B.result instanceof
HTMLImageElement?0:B.resolvers.length;for(const G of B.resolvers)if(D)l.isAbortError(D)?G.reject(D):G.reject(new f("stream-data-loader:request-error",`Failed to request resource at '${B.url}'. ${D}`,{url:B.url,error:D}));else{--E;const K=0>=E?B.result:w.clone(B.result);G.resolve(K)}this.tasks.delete(B.key);0===this.tasks.size&&this._set("updating",!1)};A.startLoading=function(B,D){if(4===B.status)return!1;B.startTime=performance.now();B.status=2;let E,G;switch(B.docType){case "binary":G="array-buffer";
E=0;break;case "image":G="image";break;case "image+type":G="array-buffer";break;default:G="json"}B.abortController=l.createAbortController();const K=B.abortController.signal;B.request=r(B.url,{...B.options,responseType:G,timeout:E,signal:K});let M=()=>{};const H=O=>{B.duration=performance.now()-B.startTime;B.size=O instanceof ArrayBuffer?O.byteLength:B.size||0;B.result=O;this.taskHandle?this.onLoadQueue.push({callback:D,task:B}):(B.abortController=null,D(B))},J=O=>{2===B.status&&D(B,O);M()};if("image+type"!==
B.docType)return B.request.then(O=>H(O.data),J),!0;B.request.then(O=>{O=O.data;const I=k(O);G="image";B.size=O.byteLength;if("unknown"===I)B.request=r(B.url,{responseType:G,timeout:E,signal:K}),B.request.then(L=>H(L.data),J);else{O=new Blob([O],{type:I});var F=window.URL.createObjectURL(O);M=()=>window.URL.revokeObjectURL(F);B.request=r(F,{responseType:G,timeout:E,signal:K});B.request.then(L=>H(new v(L.data,I,M)),J)}},J);return!0};p._createClass(C,[{key:"running",get:function(){return 0<this.doneQueue.length||
0<this.onLoadQueue.length}},{key:"test",get:function(){return{loadQueue:this.loadQueue}}}]);return C}(q);b.__decorate([g.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=b.__decorate([t.subclass("esri.views.3d.support.StreamDataLoader")],a.StreamDataLoader);let v=function(){function x(C,A,B){this.image=C;this.type=A;this.release=B}p._createClass(x,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return x}();b=a.StreamDataLoader;a.ImageWithType=
v;a["default"]=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,p,b){let r=function(f){this.typeWorkerQuota=f;this.tasks=[];this.numWorkers=0;this.statistics=new q},q=function(){this.speed=this.duration=this.size=this.requests=0},y=function(){function f(e,l,g,d){this._workerFunc=e;this._callbackFunc=l;this._maxTotalNumWorkers=g;this._totalNumWorkers=
0;this._clients=d.map(c=>new r(c))}var w=f.prototype;w.hasQuota=function(e){return(e=this._clients[e])?this._totalNumWorkers<this._maxTotalNumWorkers||e.numWorkers+e.tasks.length<e.typeWorkerQuota:!1};w.push=function(e){const l=this._clients[e.client];l&&(this._totalNumWorkers<this._maxTotalNumWorkers?(l.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(g,d)=>this._taskCallback(g,d))):l.tasks.push(e))};w.cancel=function(e){this._taskFinished(e);e._cancelled=!0};w.destroy=function(){this._clients.length=
0};w._taskFinished=function(e){const l=this._clients[e.client];this._totalNumWorkers--;l.numWorkers--;l.statistics.requests++;l.statistics.size+=e.size||0;l.statistics.duration+=e.duration||0;l.statistics.speed=0<l.statistics.duration?l.statistics.size/l.statistics.duration:0;b.assert(0<=l.numWorkers);this._next()};w._next=function(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))break};w._processQueue=
function(e){for(;0<e.tasks.length;)if(this._workerFunc(e.tasks.shift(),(l,g)=>this._taskCallback(l,g)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1};w._taskCallback=function(e,l){e._cancelled||(this._callbackFunc(e,l),this._taskFinished(e))};w.getStatsForType=function(e){return(e=this._clients[e])?{quota:e.typeWorkerQuota,workers:e.numWorkers,queueSize:e.tasks.length,requestStats:e.statistics}:null};p._createClass(f,[{key:"test",get:function(){const e=this;return{set workerFunc(l){e._workerFunc=
l}}}}]);return f}();a.AsyncWorkerQueue=y;a.BaseTask=function(f){this.client=f;this._cancelled=!1;this.duration=this.size=0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/StreamDataLoaderTask":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./AsyncWorkerQueue"],function(a,p){return function(b){function r(q,y,f,w,e){w=b.call(this,w)||this;w.url=q;w.options=y;w.docType=f;w.key=e;w.result=null;w.status=1;w.request=null;w.abortController=null;w.resolvers=[];
w.startTime=0;return w}a._inheritsLoose(r,b);return r}(p.BaseTask)})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/maybe","../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(a,p,b,r){return function(q){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var y=q.resourceController.memoryController;this.totalMemory=1048576*y.maxMemory;
this.usedMemory=Math.round(y.usedMemory*this.totalMemory);this.quality=y.memoryFactor;this.load=q.resourceController.scheduler.load;this.terrainMemory=q.basemapTerrain?q.basemapTerrain.getUsedMemory():0;y=q._stage&&q._stage.renderView&&q._stage.renderView.edgeView;this.edgesMemory=a.isSome(y)?y.usedMemory:0;q.allLayerViews.items.forEach(f=>{(p.isMemoryManagedLayerView(f)||r.isSurfaceLayerView(f))&&this.layerPerformanceInfos.push(new b(f,q))});this.layerPerformanceInfos.sort((f,w)=>w.memory-f.memory)}})},
"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(a,p){return function(b,r){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=b.layer;this.memory=p.isSurfaceLayerView(b)?r.basemapTerrain.getUsedMemoryForLayerView(b):b.getUsedMemory();a.isPerformanceInfoLayerView(b)&&(b=b.performanceInfo,this.displayedNumberOfFeatures=b.displayedNumberOfFeatures,
this.maximumNumberOfFeatures=b.maximumNumberOfFeatures,this.totalNumberOfFeatures=b.totalNumberOfFeatures)}})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],function(a){a.isPerformanceInfoLayerView=function(p){return"performanceInfo"in p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/terrainUtils":function(){define(["exports","../../../core/maybe","../support/StreamDataLoader","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical"],
function(a,p,b,r,q){function y(n){return"vector-tile"===(null==n?void 0:n.type)}function f(n){return"imagery-tile"===(null==n?void 0:n.type)||"wcs"===(null==n?void 0:n.type)}function w(n){return"imagery-tile-3d"===(null==n?void 0:n.type)}function e(n){return"tile-3d"===(null==n?void 0:n.type)}function l(n){return"vector-tile-3d"===(null==n?void 0:n.type)}function g(n){return"wmts-3d"===(null==n?void 0:n.type)}function d(n){return"elevation-3d"===(null==n?void 0:n.type)}function c(n,z,k,v){return u[v].checkIfTileInfoSupportedForViewSR(n,
k,z)}const u={[1]:q.terrainUtilsSpherical,[2]:r.terrainUtilsPlanar},t=80/180*Math.PI,h=110/180*Math.PI,m={force512VTL:!1};a.checkIfTileInfoSupportedForView=c;a.computeSkirtScale=function(n,z,k){const v=u[n.viewingMode];if(v.isInsideExtent(n,z))var x=p.unwrapOr(n.getElevation(z[0],z[1],z[1],n.spatialReference),0);else{if(!v.isInsideExtent(n,z,1.2))return 0;var C=n.getTileWithElevation(z[0],z[1],z[1],n.spatialReference);x=p.isSome(C)?C.elevationBounds[0]:n.elevationBounds.min;C=p.isSome(C)?C.elevationBounds[1]:
n.elevationBounds.max;x=.5*(x+C);n=v.tiltToExtentEdge(n,z,x);if(n>t&&n<h)return 0}z=z[2]-x;return Math.abs(z)<k?0:0>z?-1:1};a.getLayerWithExtentRange=function(n){return w(n)?{fullExtent:n.fullExtent,minScale:n.layer.minScale,maxScale:n.layer.maxScale,tilemapCache:null}:n.layer};a.getTiledLayerInfo=function(n,z,k){let v,x;if("wmts"===n.type){if(n=n.activeLayer){const C=n.tileMatrixSet;if(C)v=C.tileInfo,x=C.fullExtent;else if(n=n.tileMatrixSets)if(n=n.find(A=>null==c(A.tileInfo,A.fullExtent,z,k)))return{tileInfo:n.tileInfo,
fullExtent:n.fullExtent}}}else x=f(n)?n.getCompatibleFullExtent(z):n.fullExtent,v=y(n)&&!m.force512VTL?n.compatibleTileInfo256:f(n)?n.getCompatibleTileInfo(z,x,2===k):n.tileInfo;return v&&x&&null==c(v,x,z,k)?{tileInfo:v,fullExtent:x}:{tileInfo:null,fullExtent:null}};a.isElevationLayerView=d;a.isImageryTileLayerView=w;a.isImageryTileRenderInfo=function(n){var z;n=null==n?void 0:null==(z=n.sourceLayerInfo)?void 0:z.data;return p.isSome(n)&&"type"in n&&"raster-tile"===n.type};a.isProjectableRasterLayer=
f;a.isRasterTileRenderInfo=function(n){var z;n=null==n?void 0:null==(z=n.sourceLayerInfo)?void 0:z.data;return n instanceof HTMLImageElement||n instanceof b.ImageWithType||n instanceof HTMLCanvasElement||n instanceof ImageData};a.isSurfaceLayerView=function(n){return n&&(e(n)||w(n)||d(n)||l(n)||g(n))};a.isTextureTileRenderInfo=function(n){var z;n=null==n?void 0:null==(z=n.sourceLayerInfo)?void 0:z.data;return p.isSome(n)&&"type"in n&&"tile-texture"===n.type};a.isTileLayerView=e;a.isVectorTileLayer=
y;a.isVectorTileLayerView=l;a.isVectorTileRenderInfo=function(n){var z;n=null==n?void 0:null==(z=n.sourceLayerInfo)?void 0:z.data;return p.isSome(n)&&"type"in n&&"vector-tile"===n.type};a.isWMTSLayerView=g;a.releaseTileData=function(n){p.isSome(n)&&"release"in n&&n.release();return null};a.test=m;a.useFetchTileForLayer=function(n){return n.fetchTile&&!1!==n.hasOverriddenFetchTile};a.weakAssert=function(n,z){n||console.warn("Terrain: "+z)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ../core/maybe ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,p,b,r,q,y,f,w,e){function l(n,z,k=0){n=n.extent;return b.isNone(n)?!1:0===k?f.containsPoint(n,z):f.containsPointWithMargin(n,z,k*Math.min(n[2]-n[0],n[3]-n[1]))}function g(n,z,k,v){r.copy(u,k);u[v]=z[v];v=r.subtract(u,u,z);var x=r.subtract(t,n,z);x=r.dot(x,v);const C=r.dot(v,v);z=0>=x?z:C<=x?k:r.add(u,z,r.scale(v,v,x/C));n=r.subtract(u,n,z);return Math.PI/2-Math.atan(n[2]/Math.sqrt(n[0]*n[0]+n[1]*n[1]))}function d(n,z,k){n=n.extent;if(b.isNone(n))return 0;h[0]=n[0];h[1]=n[1];h[2]=k;m[0]=
n[2];m[1]=n[3];m[2]=k;n=k=Infinity;z[0]<h[0]?k=g(z,h,m,0):z[0]>m[0]&&(k=g(z,m,h,0));z[1]<h[1]?n=g(z,h,m,1):z[1]>m[1]&&(n=g(z,m,h,1));return Math.min(k,n)}function c(n,z,k){if(n.spatialReference.isGeographic&&!y.canProjectToWGS84ComparableLonLat(n.spatialReference))return new p("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var v=e.checkUnsupported(n);if(v)return v;{var x=n.lods;v=x[0].resolution*2**x[0].level;var C=[v*n.size[0],
v*n.size[1]];const A=[n.origin.x,n.origin.y];k=f.fromExtent(k);const B=f.create();e.computeRowColExtent(k,C,A,B);C=(B[2]-B[0])*(B[3]-B[1]);C>w.MAX_ROOT_TILES?(x=x[0].scale*2**x[0].level,v=Math.max((k[3]-k[1])/n.size[1],(k[2]-k[0])/n.size[0])*x/v,k=Math.floor(Math.log(v)/Math.log(10)),v=Math.ceil(v/10**k)*10**k,v=new p("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(x).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+v.toLocaleString()+
".",{level0Scale:x,suggestedLevel0Scale:v,requiredNumRootTiles:C,allowedNumRootTiles:w.MAX_ROOT_TILES})):v=null}return v?v:z&&!n.spatialReference.equals(z)?new p("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}const u=q.create(),t=q.create(),h=q.create(),m=q.create();q=Object.freeze({__proto__:null,isInsideExtent:l,tiltToExtentEdge:d,checkIfTileInfoSupportedForViewSR:c});a.checkIfTileInfoSupportedForViewSR=c;a.isInsideExtent=
l;a.terrainUtilsPlanar=q;a.tiltToExtentEdge=d})},"esri/chunks/terrainUtilsSpherical":function(){define(["exports","../core/Error","../geometry/projection","../geometry/support/spatialReferenceUtils","../views/3d/terrain/TilingScheme"],function(a,p,b,r,q){function y(){return!0}function f(){return 0}function w(l,g){const d=l.lods.length-1,c=l.spatialReference,u=b.canProjectToWGS84ComparableLonLat(c)||r.isMars(c)||r.isMoon(c);if(c.isWebMercator){if(!q.makeWebMercatorAuxiliarySphere(d).compatibleWith(l))return new p("tilingscheme:incompatible-global-web-mercator",
"The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(u){if(!q.makeGCSWithTileSize(l.spatialReference,l.size[0],d).compatibleWith(l))return l.spatialReference.isWGS84?new p("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new p("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new p("tilingscheme:global-unsupported-spatial-reference",
"The tiling scheme spatial reference is not supported in global scenes");if(g&&!l.spatialReference.equals(g))return new p("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}var e=Object.freeze({__proto__:null,isInsideExtent:y,tiltToExtentEdge:f,checkIfTileInfoSupportedForViewSR:w});a.checkIfTileInfoSupportedForViewSR=w;a.isInsideExtent=y;a.terrainUtilsSpherical=e;a.tiltToExtentEdge=f})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../geometry/projectionEllipsoid ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),
function(a,p,b,r,q,y){let f=function(){function e(g){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=g.viewState;this.view=g.view;this.pointsOfInterest=g.pointsOfInterest;this.objectResourceCache=g.objectResourceCache;this.streamDataRequester=g.resourceController.createStreamDataRequester(4);this.textures=new q.TextureCollection(this.streamDataRequester,g.view._stage,{preMultiplyAlpha:!0,wrap:{s:33071,
t:33071}},g.resourceController.scheduler);const d=r.getReferenceEllipsoid(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=y.getSettings(g.viewingMode,d);this.screenSizePerspectiveSettingsLabels=y.getLabelSettings(g.viewingMode,d)}var l=e.prototype;l.destroy=function(){this.textures.destroy();this.streamDataRequester=this.textures=null};l.addGraphicsOwner=function(g){if(!g)return{remove(){}};this.graphicsOwners.push(g);const d="layer"in g?g.watch("layer.screenSizePerspectiveEnabled",
()=>this.updateScreenSizePerspectiveEnabled()):null;this.updateScreenSizePerspectiveEnabled();return{remove:()=>{d&&(d.remove(),p.removeUnordered(this.graphicsOwners,g),this.updateScreenSizePerspectiveEnabled())}}};l.updateScreenSizePerspectiveEnabled=function(){var g=this.graphicsOwners.some(d=>!0===d.get("layer.screenSizePerspectiveEnabled"));g&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new b,g=()=>this.updateScreenSizePerspectiveSettings(),this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",
g,!0),this.viewState.events.on("camera-projection-changed",g)]),this.updateScreenSizePerspectiveSettings()):!g&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};l.updateScreenSizePerspectiveSettings=function(){w.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;w.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(w);this.screenSizePerspectiveSettingsLabels.update(w);this.view._stage.renderView.setNeedsRender()};
return e}();const w={distance:0,fovY:0};a.SharedSymbolResources=f;a["default"]=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/TextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../webgl-engine/lib/Texture ../webgl-engine/lib/WebGLDriverTest ../../support/Scheduler".split(" "),function(a,p,b,r,q,y,f,w){let e=function(){function l(d,c,u,t){this._streamDataRequester=
d;this._stage=c;this._textureOptions=u;this._textureRequests=new Map;this._frameTask=b.isSome(t)?t.registerTask(w.TaskPriority.TEXTURE_UNLOAD):w.ImmediateTask}var g=l.prototype;g.destroy=function(){this._frameTask.remove();this._textureRequests.forEach(d=>this.releaseTextureRequest(d));this._textureRequests.clear()};g.fromUrl=function(){var d=p._asyncToGenerator(function*(c,u,t){r.throwIfAborted(t);const h=b.isSome(t)&&t.signal,m=this.makeUid(c,u);let n=this._textureRequests.get(m);if(!n){t=r.createAbortController();
const z=this._streamDataRequester.request(c,"image",{uid:m,signal:t.signal});n={referenceCount:0,texture:null,textureAsync:null,abortController:t};this._textureRequests.set(m,n);n.textureAsync=z.then(k=>{k=this.createTexture(c,k,u);n.texture=k;n.abortController=null;this.addToStage(k);return{uid:m,texture:k}},k=>{n.abortController=null;throw k;})}n.referenceCount++;return(new Promise((z,k)=>{r.onAbort(h,()=>{k(r.createAbortError())});n.textureAsync.then(z,k)})).catch(z=>{this.release(m);throw z;})});
return function(c,u,t){return d.apply(this,arguments)}}();g.fromData=function(d,c){d=this.makeUid(d);let u=this._textureRequests.get(d);u||(u={referenceCount:0,texture:c(),textureAsync:null,abortController:null},this.addToStage(u.texture),this._textureRequests.set(d,u));u.referenceCount++;return{uid:d,texture:u.texture}};g.release=function(d){if(this._textureRequests){var c=this._textureRequests.get(d);c?(1>c.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+d),c.referenceCount--,
1>c.referenceCount&&this._frameTask.schedule(()=>this.releaseNow(d))):console.warn(`TextureCollection: texture doesn't exist: '${d}'`)}};g.releaseNow=function(d){if(this._textureRequests){var c=this._textureRequests.get(d);!c||0<c.referenceCount||(this.releaseTextureRequest(c),this._textureRequests.delete(d))}};g.releaseTextureRequest=function(d){d.texture?this.removeFromStage(d.texture):d.abortController&&(d.abortController.abort(),d.abortController=null)};g.createTexture=function(d,c,u){const t=
{...this._textureOptions,powerOfTwoResizeMode:2};if(q.isSVG(d)){if(u||0===c.width&&0===c.height)d=c.width?c.height/c.width:1,u=u||64,1<d?(c.width=Math.round(u/d),c.height=u):(c.width=u,c.height=Math.round(u*d));this._stage.renderView&&f.testWebGLDriver(this._stage.renderView.renderingContext).svgAlwaysPremultipliesAlpha&&(t.preMultiplyAlpha=!1)}t.width=c.width;t.height=c.height;return new y.Texture(c,t)};g.addToStage=function(d){this._stage.add(d)};g.removeFromStage=function(d){this._stage.remove(d)};
g.makeUid=function(d,c){return null!=c?`${d}.${c}px`:d};p._createClass(l,[{key:"test",get:function(){return{textureRequests:this._textureRequests}}}]);return l}();a.TextureCollection=e;a["default"]=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G){a.PointsOfInterest=function(O){function I(L){L=O.call(this,L)||this;L._handles=new q;L._tmpRay=t.create();L._centerRayDirty=!0;L._surfaceAltitudeAtCenter=0;L._surfaceAltitudeAtCenterDirty=!0;L._contentAltitudeAtCenter=0;L._contentAltitudeAtCenterDirty=!0;L._propertiesPool=new n.PropertiesPool({renderPointOfView:K},p._assertThisInitialized(L));L.renderPointOfView=u.create();L._pois=[];L._debugCenters=new Map;return L}p._inheritsLoose(I,
O);var F=I.prototype;F.initialize=function(){var L;const {state:N,basemapTerrain:R,renderCoordsHelper:S,map:P}=this.view;this._surfaceIntersector=new D.Intersector(N.viewingMode);this._surfaceIntersector.options.backfacesTerrain=N.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=0;this._contentIntersector=new D.Intersector(N.viewingMode);var Q=()=>this._estimateSurfaceAltitudeAtCenter();const V=this.view.resourceController.scheduler,ca=y.unwrap(null==
(L=this.view.basemapTerrain)?void 0:L.elevationQueryCache);L={state:N,scheduler:V,surface:R,renderCoordsHelper:S};this._set("centerOnSurfaceInfrequent",new v["default"]({...L,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:Q}));this._set("centerOnSurfaceFrequent",new v["default"]({...L,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:Q}));this._set("contentCenterOnSurface",new v["default"]({...L,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,
estimateSurfaceAltitudeAtCenter:Q,cameraName:"contentCamera"}));this._set("centerOnContent",new v["default"]({...L,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new k["default"]({...L,cache:ca,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:P}));this._set("contentCameraOnSurface",new k["default"]({...L,cache:ca,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:P,cameraName:"contentCamera"}));
this._set("surfaceGeometryUpdates",new B.SurfaceGeometryUpdates({...L,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new x.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:S}));this._set("surfaceOrigin",new A.StableSurfaceCenter({cache:ca,view:this.view}));this._set("focus",new C["default"]({state:N,scheduler:V,surface:R,renderCoordsHelper:S,centerOnSurface:this.contentCenterOnSurface,
estimateSurfaceIntersectionAtRenderPoint:(ba,Z)=>this._estimateSurfaceIntersectionAtRenderPoint(ba,this.view.state.contentCamera,Z)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);Q=this.view.graphics;this._debugCenters.set(this.centerOnContent,new m.PointGraphics(Q,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new m.PointGraphics(Q,
"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new m.PointGraphics(Q,"red","CenterOnSurface"));this._debugCenters.set(this.contentCenterOnSurface,new m.PointGraphics(Q,"red","ContentCenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new m.PointGraphics(Q,"blue","CameraOnSurface"));this._debugCenters.set(this.contentCameraOnSurface,new m.PointGraphics(Q,"blue","ContentCameraOnSurface"));this._debugCenters.set(this.focus,new m.PointGraphics(Q,"green","Focus"));
this._handles.add([N.watch("camera",ba=>this._cameraChanged(ba),!0),R.watch("extent",()=>this._updateCenterPointsOfInterest()),f.whenFalse(R,"updating",()=>this._updateCenterPointsOfInterest(),!0),this.surfaceGeometryUpdates.events.on("request-update",()=>this._updateCenterPointsOfInterest()),this.contentGeometryUpdates.events.on("request-update",()=>this._updateCenterOnContent()),f.init(h,"SHOW_POI",ba=>this._setDebug(ba))]);this._cameraChanged(this.view.state.camera);for(const ba of this._pois)ba.runTask()};
F.destroy=function(){this._setDebug(!1);this._handles.destroy();this._propertiesPool.destroy();for(const L of this._pois)L.destroy();this.surfaceOrigin.destroy()};F._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const L=this.centerRay;if(y.isNone(L))return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(L,this._contentIntersector,M,J)?this._contentAltitudeAtCenter=
this.view.renderCoordsHelper.getAltitude(M):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter};F._estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const L=this.centerRay;if(y.isNone(L))return this._surfaceAltitudeAtCenter;const N=L.origin,R=c.add(M,L.origin,L.direction);this._surfaceIntersector.resetWithRay(L);
this._surfaceIntersector.camera=this.view.state.camera;this.view.basemapTerrain.intersect(this._surfaceIntersector,null,N,R);this._surfaceIntersector.results.min.getIntersectionPoint(M)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(M));return this._surfaceAltitudeAtCenter};F._estimateSurfaceIntersectionAtRenderPoint=function(L,N,R){L=z.fromRenderAtEye(N,L,H);if(y.isNone(L))return null;const S=L.origin,P=c.add(M,L.origin,L.direction);this._surfaceIntersector.resetWithRay(L);
this._surfaceIntersector.camera=N;this.view.basemapTerrain.intersect(this._surfaceIntersector,null,S,P);return this._surfaceIntersector.results.min.getIntersectionPoint(R)?R:null};F._cameraChanged=function(L){this._updateCenterPointsOfInterest();L=L.eye;c.exactEquals(this.renderPointOfView,L)||this._set("renderPointOfView",c.copy(this._propertiesPool.get("renderPointOfView"),L))};F._updateCenterPointsOfInterest=function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=
!0;for(const L of this._pois)L.updateRenderLocation()};F._updateCenterOnContent=function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};F._setDebug=function(L){if(L)for(const N of this._pois)this._handles.add(f.init(N,"renderLocation",R=>this._debugCenters.get(N).show(R,N.renderCoordsHelper.spatialReference)),"debug");else this._debugCenters.forEach(N=>N.hide()),this._handles.remove("debug")};p._createClass(I,[{key:"updating",get:function(){var L;return!!(null!=
(L=this.surfaceGeometryUpdates)&&L.updating||this._pois.some(N=>N.updating))}},{key:"centerRay",get:function(){this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1);return this._centerRay}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const L of this._pois)L.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return I}(r);b.__decorate([w.property({readOnly:!0})],
a.PointsOfInterest.prototype,"centerOnContent",void 0);b.__decorate([w.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);b.__decorate([w.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);b.__decorate([w.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentCenterOnSurface",void 0);b.__decorate([w.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);b.__decorate([w.property({readOnly:!0})],
a.PointsOfInterest.prototype,"contentCameraOnSurface",void 0);b.__decorate([w.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);b.__decorate([w.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);b.__decorate([w.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceOrigin",void 0);b.__decorate([w.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);b.__decorate([w.property({readOnly:!0})],a.PointsOfInterest.prototype,
"surfaceGeometryUpdates",void 0);b.__decorate([w.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);b.__decorate([w.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=b.__decorate([d.subclass("esri.views.3d.support.PointsOfInterest")],a.PointsOfInterest);const K=Array,M=u.create(),H=t.create(),J={exclude:new Set([E.TERRAIN_ID])};a["default"]=a.PointsOfInterest;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/maybe ../../../geometry/Polygon ../../../symbols/FillSymbol3DLayer ../../../symbols/PolygonSymbol3D ../../../geometry/Point ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){p=function(){function c(t,h,m=""){this.graphics=t;this._symbol=new l({symbolLayers:[new g({material:{color:h},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new d({text:m,halo:{color:"white",size:1/.75},material:{color:h},size:12})]})}var u=c.prototype;u.show=function(t,h){q.isNone(h)||(this.hide(),t=new e({x:t[0],y:t[1],z:t[2],spatialReference:h}),this._graphic=new b({geometry:t,symbol:this._symbol}),this.graphics.add(this._graphic))};u.hide=
function(){q.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)};return c}();r=function(){function c(t,h,m=""){this.graphics=t;this._graphics=[];this._outline=new w({symbolLayers:[new f({material:{color:[0,0,0,0]},outline:{color:h,size:2}})]});this._text=new l({symbolLayers:[new d({text:m,halo:{color:"white",size:1/.75},material:{color:h},size:12})]})}var u=c.prototype;u.show=function(t){this.hide();const h=new e({x:t.xmin,y:t.ymin,z:t.zmax,spatialReference:t.spatialReference});
this._graphics.push(new b({geometry:y.fromExtent(t),symbol:this._outline}));this._graphics.push(new b({geometry:h,symbol:this._text}));this.graphics.addMany(this._graphics)};u.hide=function(){this.graphics.removeMany(this._graphics);this._graphics.length=0};return c}();a.ExtentGraphics=r;a.PointGraphics=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../cameraUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){const m=Array;a.CameraOnSurface=function(z){function k(x){x=z.call(this,x)||this;x._dirty=!1;x._propertiesPool=new t.PropertiesPool({location:c,renderLocation:m},p._assertThisInitialized(x));x._estimatedSurfaceAltitude=0;x._pendingElevationQueryController=null;x.cameraName="camera";x.renderLocation=d.create();x.tmpPoint=new c;return x}p._inheritsLoose(k,z);var v=k.prototype;v.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,
this));this.runTask();if(this.map){const x=()=>this._setDirty();this.handles.add(q.on(this.map,"ground.layers","change",x,x,x))}this._updateRenderLocation()};v.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};v.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};v._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};v._cancelPendingRequest=function(){const x=this._pendingElevationQueryController;
x&&(this._pendingElevationQueryController=null,x.abort(),this.notifyChange("updating"))};v.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);var x=r.createAbortController();this.map.ground.queryElevation(this.tmpPoint,{signal:x.signal,cache:this.cache}).then(C=>this._updateSurfaceAltitude(C.geometry.z)).catch(C=>{r.isAbortError(C)||
this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===x&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));x=null});this._pendingElevationQueryController=x}else this._updateSurfaceAltitude(0)};v._updateSurfaceAltitude=function(x){this._estimatedSurfaceAltitude!==x&&(this._estimatedSurfaceAltitude=x,this._updateRenderLocation())};v._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(n,this._estimatedSurfaceAltitude,
this._camera.eye);g.exactEquals(this._get("renderLocation"),n)||this._set("renderLocation",g.copy(this._propertiesPool.get("renderLocation"),n))};p._createClass(k,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const x=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,x,this.state.spatialReference);return x}},{key:"scale",get:function(){const x=this._camera,C=g.distance(x.eye,this.renderLocation);return u.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,
state:{camera:x}},C,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);return k}(h.PointOfInterest);b.__decorate([y.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);b.__decorate([y.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);b.__decorate([y.property({constructOnly:!0})],a.CameraOnSurface.prototype,
"task",void 0);b.__decorate([y.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cameraName",void 0);b.__decorate([y.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);b.__decorate([y.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);b.__decorate([y.property({readOnly:!0})],a.CameraOnSurface.prototype,"renderLocation",void 0);b.__decorate([y.property({readOnly:!0})],a.CameraOnSurface.prototype,"scale",null);b.__decorate([y.property({readOnly:!0})],
a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=b.__decorate([l.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const n=d.create();a["default"]=a.CameraOnSurface;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e,l){a.PointOfInterest=function(g){function d(c){c=g.call(this,c)||this;c.handles=new q;return c}p._inheritsLoose(d,g);d.prototype.destroy=function(){this.handles.destroy()};return d}(r);b.__decorate([y.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);b.__decorate([y.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);b.__decorate([y.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=
b.__decorate([l.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z){const k=Array;a.CenterOnSurface=function(A){function B(E){E=A.call(this,E)||this;E._propertiesPool=new n.PropertiesPool({location:c,renderLocation:k},p._assertThisInitialized(E));E._currentSurfaceAltitude=0;E._latestSurfaceAltitude=0;E.cameraName="camera";E.distance=0;E.renderLocation=d.create();E.updating=!1;return E}p._inheritsLoose(B,A);var D=B.prototype;D.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()};
D.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this._propertiesPool.destroy();this._propertiesPool=null};D.updateRenderLocation=function(){this.updating=!0;this._updateRenderLocation()};D.runTask=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this.updating=!1};D._updateRenderLocation=function(){const E=v;let G=this.calculateSurfaceIntersection(this._currentSurfaceAltitude,E);var K=this._currentSurfaceAltitude!==
this._latestSurfaceAltitude;!G&&K&&(G=this.calculateSurfaceIntersection(this._latestSurfaceAltitude,E))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);K=x;G&&this.latestSurfaceAltitudeChangesDistanceSignificantly(E,K)&&(g.copy(E,K),this._currentSurfaceAltitude=this._latestSurfaceAltitude);G?this.distance=g.distance(this._camera.eye,E):(g.scale(E,this._camera.viewForward,this._get("distance")),g.add(E,E,this._camera.eye));g.exactEquals(this._get("renderLocation"),E)||this._set("renderLocation",
g.copy(this._propertiesPool.get("renderLocation"),E))};D.calculateSurfaceIntersection=function(E,G){var K=this._camera;if(!this.renderCoordsHelper.intersectManifold(K.ray,E,G))return!1;if(this.state.isGlobal){const M=t.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;E=M+E;const H=g.squaredLength(K.eye),J=H<E*E,O=g.distance(K.eye,G);J&&O>M/4&&(g.scale(G,K.viewForward,E-Math.sqrt(H)),g.add(G,G,K.eye))}else K=this.surface.ready?this.surface.extent:null,q.isSome(K)&&u.projectBoundingRect(K,
this.surface.spatialReference,C,this.renderCoordsHelper.spatialReference)&&(G[0]=r.clamp(G[0],C[0],C[2]),G[1]=r.clamp(G[1],C[1],C[3]));return!0};D.latestSurfaceAltitudeChangesDistanceSignificantly=function(E,G){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==E)return!1;if(this.calculateSurfaceIntersection(this._latestSurfaceAltitude,G)){if(m.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;const K=this._camera.eye;E=g.distance(K,E);G=g.distance(K,G);if(.05<Math.abs(G-E)/E)return!0}return!1};
p._createClass(B,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const E=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,E,this.state.spatialReference);return E}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}},{key:"running",get:function(){return this.updating}}]);return B}(z.PointOfInterest);b.__decorate([y.property({constructOnly:!0})],a.CenterOnSurface.prototype,
"scheduler",void 0);b.__decorate([y.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);b.__decorate([y.property({constructOnly:!0})],a.CenterOnSurface.prototype,"cameraName",void 0);b.__decorate([y.property()],a.CenterOnSurface.prototype,"distance",void 0);b.__decorate([y.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);b.__decorate([y.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);b.__decorate([y.property({readOnly:!0})],
a.CenterOnSurface.prototype,"renderLocation",void 0);b.__decorate([y.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=b.__decorate([l.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const v=d.create(),x=d.create(),C=h.create();a["default"]=a.CenterOnSurface;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../core/Evented","../../../../core/Handles"],
function(a,p,b){let r=function(){function y(w){this.handles=new b;this.events=new p;this.contentLayerViews=w.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",e=>this.layerViewsChanged(e)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}var f=y.prototype;f.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};f.layerViewsChanged=function(w){w.added.forEach(e=>{"esri.views.3d.layers.SceneLayerView3D"===
e.declaredClass&&this.handles.add(e.on("visible-geometry-changed",()=>this.contentChanged()),e.uid)});w.removed.forEach(e=>this.handles.remove(e.uid))};f.contentChanged=function(){this.events.emit("request-update",q)};return y}();const q={};a.ContentGeometryUpdates=r;a["default"]=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){const n=Array;a.Focus=function(x){function C(B){B=x.call(this,B)||this;B._propertiesPool=new t.PropertiesPool({location:c,renderLocation:n},p._assertThisInitialized(B));B._dirty=!0;B.renderLocation=B._propertiesPool.get("renderLocation");return B}p._inheritsLoose(C,x);var A=C.prototype;A.initialize=function(){this.handles.add([this.centerOnSurface.watch("renderLocation",()=>this.updateRenderLocation()),this.state.watch("contentCamera",()=>this.updateRenderLocation())]);
this.scheduler&&this.handles.add(this.scheduler.registerTask(m.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};A.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null};A.runTask=function(){var B=this._get("renderLocation");const D=this.centerOnSurface.renderLocation;var E=this.renderCoordsHelper,G=this.state.contentCamera;this._dirty=!1;E.worldUpAtPosition(D,z);E=Math.max(0,(Math.acos(g.dot(z,G.viewForward))-.5*Math.PI)*(G.aboveGround?1:-1));Number.isNaN(E)?B&&g.equals(B,D)||
(B=this._propertiesPool.get("renderLocation"),g.copy(B,D),this._set("renderLocation",B)):(E=1-r.clamp(E/(.5*Math.PI),0,1),E*=E*E,this._calculateScreenHorizontalEdgeOnSurface(v),G=this._propertiesPool.get("renderLocation"),g.lerp(G,D,v,E),B&&g.equals(B,G)||this._set("renderLocation",G))};A._calculateScreenHorizontalEdgeOnSurface=function(B){const D=this.state.contentCamera;var E=D.getRenderCenter(q.createRenderScreenPointArray3());E[1]=D.aboveGround?D.padding[2]:D.fullHeight-D.padding[0];if(this.estimateSurfaceIntersectionAtRenderPoint(E,
B))return B;const G=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return D.unprojectFromRenderScreen(E,k)&&(g.subtract(k,k,D.eye),E=g.normalize(k,k),this.renderCoordsHelper.intersectManifold(u.wrap(D.eye,E),G,B))?B:this.renderCoordsHelper.setAltitude(B,G,D.eye)};A.updateRenderLocation=function(){this._dirty=!0};p._createClass(C,[{key:"updating",get:function(){return this._dirty||this.centerOnSurface.updating}},{key:"location",get:function(){const B=this._propertiesPool.get("location");
this.renderCoordsHelper.fromRenderCoords(this.renderLocation,B,this.state.spatialReference);return B}},{key:"running",get:function(){return this._dirty}}]);return C}(h.PointOfInterest);b.__decorate([y.property()],a.Focus.prototype,"_dirty",void 0);b.__decorate([y.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);b.__decorate([y.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);b.__decorate([y.property({constructOnly:!0})],a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",
void 0);b.__decorate([y.property({readOnly:!0})],a.Focus.prototype,"updating",null);b.__decorate([y.property({readOnly:!0})],a.Focus.prototype,"location",null);b.__decorate([y.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=b.__decorate([l.subclass("esri.views.3d.support.CenterOnSurface")],a.Focus);const z=d.create(),k=d.create(),v=d.create();a["default"]=a.Focus;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){a.StableSurfaceCenter=function(m){function n(k){k=m.call(this,k)||this;k.location=null;k._updateController=null;k._handles=new q;return k}p._inheritsLoose(n,m);var z=n.prototype;z.initialize=function(){this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],()=>this._update()),w.on(this,"surface.layers","change",()=>this._update())]),this._update())};z.destroy=function(){this._handles.destroy()};z._update=
function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&!y.isNone(this.surfaceView.extent)&&this.surfaceView.spatialReference){var k=h.center(this.surfaceView.extent);k=new t({x:k[0],y:k[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=f.createAbortController(),this.surface.queryElevation(k,{noDataValue:0,signal:this._updateController.signal,
cache:this.cache}).then(v=>{this._updateController=null;this._set("location",v.geometry)}).catch(v=>{f.isAbortError(v)||v&&"elevation-query:invalid-layer"===v.name||console.error("StableSurfaceCenter failed to update: ",v)})):this._set("location",k)}else this._set("location",null)};p._createClass(n,[{key:"renderLocation",get:function(){if(!this.location)return null;const k=u.create();this.view.renderCoordsHelper.toRenderCoords(this.location,k);return k}}]);return n}(r);b.__decorate([e.property({constructOnly:!0})],
a.StableSurfaceCenter.prototype,"view",void 0);b.__decorate([e.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);b.__decorate([e.property({readOnly:!0,aliasOf:"view.map.ground"})],a.StableSurfaceCenter.prototype,"surface",void 0);b.__decorate([e.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],a.StableSurfaceCenter.prototype,"surfaceView",void 0);b.__decorate([e.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"location",void 0);b.__decorate([e.property({readOnly:!0})],
a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=b.__decorate([c.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){a.SurfaceGeometryUpdates=function(z){function k(){var x=z.apply(this,arguments)||this;x.handles=new y;x._tileGeometryUpdateExtent=c.empty();x._tileGeometryUpdateSpatialReference=null;x.events=new q;x.updating=!1;return x}p._inheritsLoose(k,z);var v=k.prototype;v.initialize=function(){this.handles.add([this.surface.on("elevation-change",x=>this._tileGeometryChanged(x)),this.scheduler.registerTask(u.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};v.destroy=function(){this.handles&&
(this.handles.destroy(),this.handles=null)};v.runTask=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",t),c.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};v._tileGeometryChanged=function(x){this._tileGeometryUpdateSpatialReference=x.spatialReference;c.expand(this._tileGeometryUpdateExtent,x.tile.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)};v._furthestCenterOnSurface=
function(){let x=this.centerOnSurfaces[0];for(let C=1;C<this.centerOnSurfaces.length;C++){const A=this.centerOnSurfaces[C];A.distance>x.distance&&(x=A)}return x};v._centerIntersectsExtent=function(x,C){const A=this.state.camera.eye,B=n,D=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(A,h,C);this.renderCoordsHelper.fromRenderCoords(D.renderLocation,m,C);h[0]<m[0]?(B[0]=h[0],B[2]=m[0]):(B[0]=m[0],B[2]=h[0]);h[1]<m[1]?(B[1]=h[1],B[3]=m[1]):(B[1]=m[1],B[3]=h[1]);return c.intersects(B,
x)};p._createClass(k,[{key:"running",get:function(){return this.updating}}]);return k}(r);b.__decorate([f.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);b.__decorate([f.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);b.__decorate([f.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);b.__decorate([f.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);
b.__decorate([f.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);b.__decorate([f.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=b.__decorate([g.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const t={},h=d.create(),m=d.create(),n=c.empty();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/aliasOf ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../layers/ElevationLayerView3D ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./OverlayManager ./PlanarPatch ./SphericalPatch ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../../support/Scheduler ../../support/WatchUpdatingTracking".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N,R,S,P,Q,V,ca,ba,Z,ha,fa,aa,W,U,X,T,Y,ea,ia,la,pa){function ua(ta,Ea){return ta[0]===Ea[0]&&ta[1]===Ea[1]&&ta[2]===Ea[2]}function wa(ta){return ta.isLeaf?!1:ta.children[0].shouldLoad||ta.children[1].shouldLoad||ta.children[2].shouldLoad||ta.children[3].shouldLoad||wa(ta.children[0])||wa(ta.children[1])||wa(ta.children[2])||wa(ta.children[3])}const Fa=l.getLogger("esri.views.3d.terrain.TerrainSurface");q=function(ta){function Ea(ka){var sa=
ta.call(this,ka)||this;sa._elevationBounds=new Q.ElevationBounds;sa._iteratorPool=new c(Y.IteratorPreorder,Ja=>Ja.remove=()=>sa._iteratorPool.release(Ja));sa._postorderIterator=new Y.IteratorPostorder;sa._hasPendingUpdates=!1;sa._pendingUpdates=0;sa._asyncWorkItems=0;sa._allTilesDirty=!0;sa._allTilesSorted=!0;sa._visible=!1;sa._usedMemory=-1;sa._performanceInfo=new W;sa._viewChanged=!1;sa._inFrameTask=!1;sa._viewChangeUpdateDirty=!1;sa._eyePosRenderSR=B.create();sa._eyePosSurfaceSR=B.create();sa._splitLimits=
new X.SplitLimits;sa._snapLevel=Infinity;sa._frustum=M.create();sa._viewProjectionMatrix=C.create();sa._layerViews=[[],[]];sa._layerIndexByUid=[new Map,new Map];sa._basemapLayerViewHandles=new Map;sa._handles=new e;sa._watchUpdatingTracking=new pa.WatchUpdatingTracking;sa._allTiles=new u;sa._upsampleInfoPool=new c(ia.UpsampleInfo);sa._rootTilesExtent=K.create();sa._maxNumUpdating=1;sa.maxTextureScale=1.2;sa.backgroundImage=fa.DEFAULT_TILE_BACKGROUND;sa.backgroundColor=null;sa._layerViewsDirty=!1;
return sa}p._inheritsLoose(Ea,ta);var Ca=Ea.prototype;Ca.initialize=function(){this._lercDecoder=I.acquireDecoder(this.view.resourceController);this._tilePool=this.view.state.isLocal?new c(Z.PlanarPatch):new c(ha.SphericalPatch);var ka=this.view.resourceController.memoryController;this._upsampleMapCache=ka.getMemCache("esri.views.3d.terrain.upsample",sa=>sa.unloadMapData());this._elevationQueryCache=new J.ElevationQueryTileCache(ka.getMemCache("elevation-query"));this._set("overlayManager",new ba.OverlayManager({surface:this}));
this._handles.add([this.watch("overlayManager.hasHighlights",sa=>this._renderer.setNeedsHighlight(sa)),this.watch("overlayManager.rendersOccluded",sa=>this._renderer.setRenderOccludedOverlay(sa))],"overlayManager");this._renderer=new aa({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:G.getReferenceEllipsoid(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles});this._handles.add([h.init(this,"baseOpacity",sa=>{this._handleLayerViewChanges();this._updateBaseOpacity(sa)},
!0),h.init(this,"_background",()=>{this._handleLayerViewChanges();this._renderer.setTileBackground(this._background)},!0),this.view.watch("pointsOfInterest",sa=>{this._renderer.pointsOfInterest=sa;this._watchUpdatingTracking.removeAll();sa&&this._watchUpdatingTracking.add(sa.focus,"renderLocation",()=>()=>this._allTilesSorted=!1)}),h.init(R,"TERRAIN_TILE_TREE_SHOW_TILES",sa=>{sa&&!this._treeDebugger?(new Promise(function(Ja,Ta){a(["../layers/support/TerrainTileTree3DDebugger"],Ja,Ta)})).then(({TerrainTileTree3DDebugger:Ja})=>
{!this._treeDebugger&&R.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Ja({view:this.view}))}):sa||(this._treeDebugger=d.destroyMaybe(this._treeDebugger))})]);this._extentHelper=ca.create(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});ka=this.view.defaultsFromMap?new f({getCollections:()=>{var sa,Ja,Ta;return null==(sa=this.view)?void 0:null==(Ja=sa.defaultsFromMap)?void 0:null==(Ta=Ja.mapCollectionPaths)?
void 0:Ta.map(da=>this.view.map.get(da))},getChildrenFunction:sa=>sa&&"layers"in sa?sa.layers:null}):this.view.map.allLayers;ka=new ea.TilingSchemeLogic({layers:ka,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",ka);this._updateTilingScheme();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0);this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);
this._frameTask=this.view.resourceController.scheduler.registerTask(la.TaskPriority.TERRAIN_SURFACE,this);this.view.resourceController.memoryController.events.on("quality-changed",()=>this._viewChangeUpdate());this._handles.add([h.init(this._extentHelper,"stencilEnabledExtents",sa=>this._renderer.setStencilEnabledLayerExtents(sa)),this.tilingSchemeLogic.watch("tilingScheme",()=>this._updateTilingScheme(),!0),this.tilingSchemeLogic.watch("extent",()=>this._updateClippingExtent(),!0),h.init(this,"extent",
()=>this._updateRootTiles()),this.view.on("resize",()=>this._viewChangeUpdate()),this.view.watch("state.camera",()=>this._viewChangeUpdate(),!0),this.view.watch("state.contentCamera",()=>this.view.state.fixedContentCamera&&this._viewChangeUpdate(),!0),this.view.watch("qualitySettings.tiledSurface.lodBias",()=>this._viewChangeUpdate()),h.init(this.view,"qualitySettings.tiledSurface.textureFadeDuration",sa=>this._renderer.textureFadingEnabled=0<sa),this.view.watch("lodSnapping",()=>this._viewChangeUpdate()),
this.view.watch("clippingArea",()=>this._updateClippingExtent())]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges()};Ca.destroy=function(){this._frameTask.remove();this._handles.destroy();this._watchUpdatingTracking.destroy();this._lercDecoder=d.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._upsampleMapCache=d.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=d.destroyMaybe(this._elevationQueryCache);
this._set("tilingSchemeLogic",d.destroyMaybe(this.tilingSchemeLogic));this._extentHelper=d.destroyMaybe(this._extentHelper);this._basemapLayerViewHandles.forEach((ka,sa)=>this._unregisterTiledLayerView(sa));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",d.destroyMaybe(this.overlayManager));this._tilePool=d.destroyMaybe(this._tilePool);X["default"].prune();this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this._renderer=d.destroyMaybe(this._renderer);
this._iteratorPool=d.destroyMaybe(this._iteratorPool);this._set("view",null);this._upsampleInfoPool=d.destroyMaybe(this._upsampleInfoPool);F.printAllocations();T.printAllocations()};Ca.intersect=function(ka,sa,Ja,Ta){this._renderer.intersect(ka,sa,Ja,Ta)};Ca.getElevation=function(ka,sa,Ja,Ta){const da=La;ka=this.getTileWithElevation(ka,sa,Ja,Ta,da);return d.isNone(ka)?null:V.ElevationData.sample(da[0],da[1],ka.renderData.geometryState.samplerData)};Ca.getTileWithElevation=function(ka,sa,Ja,Ta,da=
La){var qa;const ra=this.rootTiles;if(d.isNone(ra)||!ra.length||0===ra[0].layerInfo[0].length)return null;da[0]=ka;da[1]=sa;da[2]=Ja;if(!E.projectVectorToVector(da,Ta,da,null==(qa=this.tilingScheme)?void 0:qa.spatialReference))return Fa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let Da of ra)if(Da.containsPoint(da)){for(;Da&&!Da.rendered&&!Da.isLeaf;)ka=0,da[0]>.5*(Da.extent[0]+Da.extent[2])&&(ka+=1),da[1]<.5*(Da.extent[1]+Da.extent[3])&&
(ka+=2),Da=Da.children[ka];if((da=Da.renderData)&&da.geometryState&&da.geometryState.samplerData)return Da;break}return null};Ca.getScale=function(ka){if(this.tilingScheme){if(!E.projectPointToVector(ka,La,this.spatialReference))return Fa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;ka=this.rootTiles;if(d.isSome(ka))for(let sa of ka)if(sa.containsPoint(La)){for(;null!=sa.children[0];)ka=0,La[0]>sa.children[0].extent[2]&&(ka+=1),La[1]<
sa.children[0].extent[1]&&(ka+=2),sa=sa.children[ka];return this._getLodBiasCorrectedScale(sa.level)}}return 1E100};Ca.queryVisibleScaleRange=function(ka,sa,Ja,Ta){sa=sa?this.tilingScheme.levelAtScale(sa):0;Ja=Ja?this.tilingScheme.levelAtScale(Ja):Infinity;const da=this.lodBias;this._renderer.queryVisibleLevelRange(ka,sa+da,Ja+da,Ta)};Ca._updateBaseOpacity=function(ka){const sa=this._renderer.opaque;this._renderer.opaque=1<=ka;this._renderer.isTransparent=this._allTransparentSurfaceLayers();ka=sa===
this._renderer.opaque?2:1;if(1===ka){var Ja,Ta;null==(Ja=this.view)?void 0:null==(Ta=Ja._stage)?void 0:Ta.renderView.setRenderParameters({opaqueTerrain:this.opaque})}this._updateTileTextures(ka)};Ca._updateTilingScheme=function(){const ka=this.tilingSchemeLogic.tilingScheme;ka!==this.tilingScheme&&(U.weakAssert(!!ka,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",ka),this._updateClippingExtent(),ka&&(this._updateTiledLayers(),this._renderer.setTileSize(ka.pixelSize),
this.overlayManager.setSpatialReference(ka.spatialReference),this._updateRootTiles()))};Ca._acquireTile=function(ka,sa,Ja,Ta){const da=this._tilePool.acquire();Sa[0]=ka;Sa[1]=sa;Sa[2]=Ja;da.init(Sa,Ta,this);return da};Ca._updateRootTiles=function(){const {extent:ka,tilingScheme:sa}=this;if(sa){var Ja=Ma,Ta=sa.rootTilesInExtent(ka,Ja,5*fa.MAX_ROOT_TILES);if(d.isSome(this.rootTiles)){if(Ta.length>fa.MAX_ROOT_TILES){Fa.warn(fa.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}const da=this.rootTiles.map(ra=>
ra.lij),qa=y.difference(da,Ta,ua);if(0<qa.removed.length||0<qa.added.length){const ra=this.rootTiles.filter(Da=>-1<qa.removed.findIndex(Pa=>ua(Pa,Da.lij))?(this._purgeTile(Da),!1):!0);qa.added.forEach(Da=>ra.push(this._newRootTile(Da)));this._setRootTiles(ra)}}else Ta.length>fa.MAX_ROOT_TILES&&(Fa.warn(fa.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),Ta=sa.rootTilesInExtent(ka,Ja,fa.MAX_ROOT_TILES)),this._setRootTiles(Ta.map(da=>this._newRootTile(da)));K.equals(Ja,this._rootTilesExtent)||(this._rootTilesExtent=
K.create(Ja));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready")}};Ca._newRootTile=function(ka){ka=this._acquireTile(0,ka[1],ka[2],null);2===ka.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&ka.setPendingUpdate(2);this._loadTile(ka);return ka};Ca._setRootTiles=function(ka){this._set("rootTiles",ka);this._allTiles.clear();if(d.isSome(ka)){const sa=this._iteratorPool.acquire();for(sa.reset(ka);!sa.done;)this._allTiles.push(sa.next());
sa.remove()}this._renderer.setRootTiles(this.rootTiles);this._updateTileVisibility(ka)};Ca._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};Ca._viewChangeUpdate=function(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this._updateTileVisibility(this.rootTiles)))};Ca._updateClippingStatus=
function(ka){ka.updateClippingStatus(this.extent)&&ka.resetPendingUpdate(32)&&this._updateTileGeometry(ka)};Ca._updateTileVisibility=function(ka){if(!d.isNone(ka)){var sa=this._iteratorPool.acquire();sa.reset(ka);var Ja=Y.hasLoadableSiblings(ka);ka=Ja?this._elevationBounds.min:Infinity;for(Ja=Ja?this._elevationBounds.max:-Infinity;!sa.done;){const Ta=sa.next();this._updateClippingStatus(Ta);Ta.updateVisibility();Ta.setPendingUpdate(16);Ta.loadable?(Ta.updateScreenDepth(this._viewProjectionMatrix),
Ta.renderData&&(ka=Math.min(Ta.elevationBounds[0],ka),Ja=Math.max(Ta.elevationBounds[1],Ja))):sa.skipSubtree()}sa.remove();this._allTilesDirty=this._viewChanged=!0;isFinite(ka)&&isFinite(Ja)&&(this._elevationBounds.min!==ka||this._elevationBounds.max!==Ja)&&(this._elevationBounds.min=ka,this._elevationBounds.max=Ja,this.emit("elevation-bounds-change",null))}};Ca._updateViewDependentParameters=function(){const ka=this.view.state.camera,sa=this.view.state.contentCamera,Ja=Math.tan(.5*sa.fovX),Ta=Math.tan(.5*
sa.fovY),da=this.tilingScheme.pixelSize,qa=2**-this.lodBias*ka.pixelRatio;this._splitLimits.aboveGround=ka.aboveGround;this._splitLimits.fovX=Ja;this._splitLimits.fovY=Ta;this._splitLimits.relativeWidthLimit=da/ka.width*this.maxTextureScale*qa;this._splitLimits.relativeHeightLimit=da/ka.height*this.maxTextureScale*qa;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this.view.state.fixedContentCamera?(d.isNone(this._splitLimits.frustum)&&
(this._splitLimits.frustum=M.create()),M.copy(sa.frustum,this._splitLimits.frustum)):this._splitLimits.frustum=null;M.copy(ka.frustum,this._frustum);x.multiply(this._viewProjectionMatrix,sa.projectionMatrix,sa.viewMatrix);A.copy(this._eyePosRenderSR,sa.eye);E.projectVectorToVector(ka.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};Ca._updateSkirts=function(){const ka=this.view.state.camera;this.skirtScale=U.computeSkirtScale(this,this._eyePosSurfaceSR,this.view.state.constraints.collision.enabled?
0:1.11*ka.near)};Ca._updateRenderData=function(ka){ka.rendered&&!ka.shouldLoad&&(wa(ka)?this._loadChildren(ka):ka.isLeaf&&ka.parent&&ka.parent.shouldLoad&&this._loadParent(ka))};Ca._updateTileGeometry=function(ka){ka.updateVisibility();this._renderer.updateTileGeometry(ka);this._elevationUpdate(ka);this._usedMemory=-1};Ca._updateTileTexture=function(ka,sa){const Ja=ka.resetPendingUpdate(128)?128:ka.resetPendingUpdate(64)?64:!1;Ja&&(this._renderer.updateTileTexture(ka,Ja),this._usedMemory=-1,sa.madeProgress())};
Ca._elevationUpdate=function(ka){va.spatialReference=this.spatialReference;va.tile=ka;va.extent=ka.extent;this.emit("elevation-change",va);K.containsPoint(ka.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};Ca.runTask=function(ka){this._handleLayerViewChanges(ka);this._frameTask.processQueue(ka);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateTileStatus(ka);this._sortTiles(ka);const sa=!this.view.state.fixedContentCamera;this._mergeAndSplit(ka,sa);ka.run(()=>
this._updateElevation(ka));ka.run(()=>this._updateTextures(ka));sa||this._mergeAndSplit(ka,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();ka.done&&this.requestUpdate();this.notifyChange("updatingProgressValue")};Ca._updateTileStatus=function(ka){if(this._viewChanged&&this.rootTiles&&!ka.done){this._viewChanged=!1;var sa=this._iteratorPool.acquire();for(sa.reset(this.rootTiles);!sa.done;){var Ja=sa.next();if(Ja.loadable){var Ta=Ja.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);
if(2===Ta){Ja.resetPendingUpdate(8);Ja.isLeaf&&(Ja.setPendingUpdate(2),sa.skipSubtree());continue}Ja.resetPendingUpdate(2)&&Ja.updateAgentSuspension();4===Ta&&Ja.updateAgents(0)}sa.skipSubtree();if(!Ja.isLeaf){Ja.setPendingUpdate(8);Ja.resetPendingUpdate(2);Ta=this._iteratorPool.acquire();Ta.resetOne(Ja);for(Ja=Ta.next();!Ta.done;Ja=Ta.next())this._updateClippingStatus(Ja),Ja.updateVisibility(),Ja.loadable&&Ja.updateScreenDepth(this._viewProjectionMatrix);Ta.remove()}}sa.remove();this.requestUpdate();
ka.madeProgress()}};Ca._sortTiles=function(ka){ka.done||this._allTilesSorted||(Y.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),ka.madeProgress())};Ca._mergeAndSplit=function(ka,sa){if(!this.suspended&&this._allTilesDirty&&!ka.done){this._allTilesDirty=!1;this.requestUpdate();for(var Ja=0;!ka.done;){let Ta=!1;Ja=0;const da=!this._allTiles.some(qa=>{Ja+=qa.usedMemory;if(qa.resetPendingUpdate(8)){if(!sa)return qa.setPendingUpdate(8),
ka.done;this._mergeTile(qa);Ta=!0;ka.madeProgress()}else qa.resetPendingUpdate(2)&&(this._splitTile(qa),Ta=!0,ka.madeProgress());qa.resetPendingUpdate(16)&&(this._updateRenderData(qa),ka.madeProgress());return ka.done});Ta&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(da){if(this._usedMemory=Ja,!Ta)break}else this._allTilesDirty=!0}0===Ja&&(this._allTilesDirty=!0);this._sortTiles(ka)}};Ca._updateElevation=function(ka){this._allTiles.some(sa=>{sa.resetPendingUpdate(32)&&(this._updateTileGeometry(sa),
this._updateTileTexture(sa,ka),ka.madeProgress());return ka.done});return ka.hasProgressed};Ca._updateTextures=function(ka){this._allTiles.some(sa=>{this._updateTileTexture(sa,ka);return ka.done});return ka.hasProgressed};Ca._updateClippingExtent=function(){if(this.spatialReference){if(d.isSome(this.view.clippingArea)){var ka=K.create();S.toBoundingRect(this.view.clippingArea,ka,this.spatialReference)||(ka=null)}K.equals(ka,this._userClippingExtent)||(this._userClippingExtent=ka,this.updateTileOverlayParams(),
this.overlayManager.setPlacementDirty(),this._updateRootTiles())}};Ca._getLodBiasCorrectedScale=function(ka){const sa=this.tilingScheme.levels;ka=g.clamp(ka-this.lodBias,0,sa.length-1);const Ja=ka-Math.floor(ka);return sa[Math.floor(ka)].scale*(1-Ja)+sa[Math.ceil(ka)].scale*Ja};Ca._removeAllTiles=function(){d.isSome(this.rootTiles)&&(this.rootTiles.forEach(ka=>this._purgeTile(ka)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.visible=!1};Ca._purgeChildTiles=function(ka){if(ka.isLeaf)return!1;
let sa=this._purgeTile(ka.children[0]);sa=this._purgeTile(ka.children[1])||sa;sa=this._purgeTile(ka.children[2])||sa;sa=this._purgeTile(ka.children[3])||sa;ka.unsetChildren();return sa};Ca._purgeTile=function(ka){const sa=this._purgeChildTiles(ka)||ka.rendered;this._allTiles.removeUnordered(ka);ka.unload(this._renderer);this._tilePool.release(ka);return sa};Ca._splitTile=function(ka){U.weakAssert(ka.isLeaf,"tile that is already split should not be split again!");const sa=ka.level+1,Ja=2*ka.lij[1],
Ta=2*ka.lij[2];ka.setChildren(this._createTile(sa,Ja,Ta,ka),this._createTile(sa,Ja,Ta+1,ka),this._createTile(sa,Ja+1,Ta,ka),this._createTile(sa,Ja+1,Ta+1,ka));ka.setPendingUpdate(16);ka.updateAgentSuspension();this._allTiles.pushArray(ka.children);this._allTilesDirty=!0;this._emitTileScaleChange(ka,sa);++this._performanceInfo.numSplit};Ca._emitTileScaleChange=function(ka,sa=ka.level){ma.spatialReference=this.spatialReference;ma.extent=ka.extent;ma.scale=this._getLodBiasCorrectedScale(sa);this.emit("scale-change",
ma)};Ca._createTile=function(ka,sa,Ja,Ta){U.weakAssert(!!Ta,"_createTile sanity check");ka=this._acquireTile(ka,sa,Ja,Ta);ka.updateClippingStatus(this.extent);ka.loadable&&(ka.updateScreenDepth(this._viewProjectionMatrix),2===ka.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&ka.setPendingUpdate(2));return ka};Ca._mergeTile=function(ka){U.weakAssert(!ka.hasPendingUpdate(2),"_mergeTile sanity check");this._purgeChildTiles(ka)&&(U.weakAssert(!ka.renderData,"_mergeTile sanity check"),
this._loadTile(ka));this._allTilesDirty=!0;++this._performanceInfo.numMerged;this._emitTileScaleChange(ka)};Ca._loadChildren=function(ka){U.weakAssert(ka.rendered,"parent should be rendered");ka.unload(this._renderer);this._loadTile(ka.children[0]);this._loadTile(ka.children[1]);this._loadTile(ka.children[2]);this._loadTile(ka.children[3])};Ca._loadParent=function(ka){ka=ka.parent;this._unloadChildren(ka);this._loadTile(ka)};Ca._unloadChildren=function(ka){ka.isLeaf||(this._unloadChildren(ka.children[0]),
ka.children[0].unload(this._renderer),this._unloadChildren(ka.children[1]),ka.children[1].unload(this._renderer),this._unloadChildren(ka.children[2]),ka.children[2].unload(this._renderer),this._unloadChildren(ka.children[3]),ka.children[3].unload(this._renderer))};Ca._loadTile=function(ka){ka.load(this._renderer);ka.setPendingUpdate(16);this.requestUpdate();this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(ka);this._elevationUpdate(ka)};Ca._elevationDataArrived=
function(ka,sa,Ja){Ja=new V.ElevationData(ka.lij,ka.extent,Ja);ka.dataArrived(sa,0,Ja);Ja=[ka];ka=ka.level;const Ta=this._iteratorPool.acquire();for(Ta.reset(Ja);!Ta.done;){const da=Ta.next();da.findElevationBoundsForLayer(sa,ka);da.computeElevationBounds()}Ta.remove();this._updateTileVisibility(Ja)};Ca._handleLayerViewChanges=function(ka=la.noBudget){if(this._layerViewsDirty){var sa=this._layerViewsDirty=!1,Ja=new Set,Ta=-1;for(const qa of this.view.allLayerViews.items)if(Ja.add(qa.uid),U.isSurfaceLayerView(qa))if(this._basemapLayerViewHandles.has(qa.uid)){var da=
this.layerClassFromLayerView(qa);da=this._layerIndexByUid[da].get(qa.uid);da<Ta&&(sa=!0);Ta=da}else this._registerTiledLayerView(qa),qa.layer.loaded&&(sa=!0);this._basemapLayerViewHandles.forEach((qa,ra)=>{Ja.has(ra)||(this._unregisterTiledLayerView(ra),sa=!0)});sa&&this._updateTiledLayers();this._renderer.isTransparent=this._allTransparentSurfaceLayers();ka.madeProgress()}};Ca._allTransparentSurfaceLayers=function(){let ka=0===this.view.map.ground.opacity;for(const sa of this.view.allLayerViews.items)if(U.isSurfaceLayerView(sa)&&
!U.isElevationLayerView(sa)&&!O.isBaseLayer(sa.layer)&&0!==sa.fullOpacity){ka=!1;break}return ka};Ca.layerClassFromLayerView=function(ka){return U.isElevationLayerView(ka)?0:1};Ca._registerTiledLayerView=function(ka){const sa=[],Ja=this.layerClassFromLayerView(ka);sa.push(ka.watch("suspended",()=>this._updateTiledLayers()));sa.push(ka.watch("fullOpacity",()=>this._updateTileTextures(2)));sa.push(ka.layer.watch("scaleRangeId",()=>this._restartAllAgents(Ja)));ka.on("data-changed",()=>{const Ta=this._layerIndexByUid[Ja].get(ka.uid);
null!=Ta&&this._invalidateLayerData(Ta,Ja)});this._basemapLayerViewHandles.set(ka.uid,sa)};Ca._unregisterTiledLayerView=function(ka){const sa=this._basemapLayerViewHandles.get(ka);if(sa){for(let Ja=0;Ja<sa.length;Ja++)sa[Ja].remove();this._basemapLayerViewHandles.delete(ka)}};Ca._updateTiledLayers=function(){if(this.tilingScheme&&!this.view.suspended){var ka=this.view.allLayerViews,sa=[[],[]],Ja=null,Ta=K.empty();ka.forEach(qa=>{var ra=qa.layer;if(ra&&!qa.suspended&&U.isSurfaceLayerView(qa)){var Da=
qa.fullExtent;Da?this.tilingScheme.compatibleWith(qa.tileInfo)?(K.expand(Ta,Da,Ta),ra=this.layerClassFromLayerView(qa),1===ra&&(Da=qa.displayLevelRange,Infinity!==Da.maxLevel&&(null===Ja||Da.maxLevel>Ja)&&(Ja=Da.maxLevel)),sa[ra].push(qa)):Fa.warn("Terrain: tiling scheme of layer "+ra.id+" is incompatible with other tiled layers, will not be drawn"):Fa.warn("Terrain: Map or elevation layer does not have fullExtent: "+ra.id)}});for(const qa of fa.LayerClasses){var da=this._layerViews[qa];ka=sa[qa];
ka.reverse();const ra=ka.length;let Da=da.length!==ra;const Pa=Array(ra),Qa=Array(da.length);this._layerIndexByUid[qa].clear();for(let na=0;na<ra;na++){this._layerIndexByUid[qa].set(ka[na].uid,na);const Aa=da.indexOf(ka[na]);Pa[na]=Aa;na!==Aa&&(Da=!0);-1<Aa&&(Qa[Aa]=na)}if(Da){da=this._postorderIterator;for(da.reset(this.rootTiles);!da.done;)da.next().modifyLayers(Qa,Pa,qa);this._layerViews[qa]=ka;this._restartAllAgents(qa);this._updateTileVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(Ja)&&
this._viewChangeUpdate()}};Ca._restartAllAgents=function(ka){const sa=this._postorderIterator;for(sa.reset(this.rootTiles);!sa.done;){const Ja=sa.next();Ja.restartAgents(ka);0===ka&&Ja.computeElevationBounds()}};Ca.layerViewByIndex=function(ka,sa){return this._layerViews[sa][ka]};Ca.numLayers=function(ka){return this._layerViews[ka].length};Ca._updateTileTextures=function(ka){this._allTiles.forAll(sa=>{sa.updateAgents(1);1===ka?this.renderer.updateTileTexture(sa,64):sa.updateRenderData(1,ka)});this._renderer.isTransparent=
this._allTransparentSurfaceLayers()};Ca._invalidateLayerData=function(ka,sa){this._allTiles.forAll(Ja=>Ja.removeLayerAgent(ka,sa));this._allTiles.forAll(Ja=>Ja.invalidateLayerData(ka,sa))};Ca.setTileTreeDirty=function(){this._allTilesDirty=!0};Ca.requestRender=function(ka=1){this.renderer.setNeedsRender(ka)};Ca.requestUpdate=function(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)};Ca.requestTileData=function(ka,sa,Ja,Ta){const da=this.layerViewByIndex(sa,Ja);sa=da.layer;if(!sa.tilemapCache||
U.isVectorTileLayerView(da))return this._requestTileData(ka,Ja,da,Ta);++this._asyncWorkItems;return sa.tilemapCache.fetchAvailability(ka.lij[0],ka.lij[1],ka.lij[2],{...Ta,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(qa=>{--this._asyncWorkItems;t.isAbortError(qa)||this._dataMissing(ka,Ja,da,{notInTilemap:!0});throw qa;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(ka,Ja,da,Ta),Ta.signal))};Ca._requestTileData=function(ka,sa,Ja,Ta){return 0===sa?this._requestElevationTileData(ka,
Ja,Ta):this._requestMapTileData(ka,Ja,Ta)};Ca._requestElevationTileData=function(ka,sa,Ja){if(U.isElevationLayerView(sa)){var Ta=ra=>{--this._asyncWorkItems;if(!t.isAborted(Ja)){var Da=this._layerIndexByUid[0].get(sa.uid);null==Da?Fa.warn("TerrainSurface: received data from unknown layer %d %s",0,ka.lij.toString()):(this._usedMemory=-1,this.requestUpdate(),this._elevationDataArrived(ka,Da,ra))}},da=ra=>{--this._asyncWorkItems;t.isAbortError(ra)||(this._dataMissing(ka,0,sa,ra),this.requestUpdate())};
++this._asyncWorkItems;if(U.useFetchTileForLayer(sa.layer))return sa.layer.fetchTile(ka.lij[0],ka.lij[1],ka.lij[2],{noDataValue:fa.ELEVATION_NODATA_VALUE,signal:Ja.signal}).then(ra=>{t.isAborted(Ja)?(Fa.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),da(t.createAbortError())):this._frameTask.schedule(()=>Ta(ra),Ja.signal,da)},da);var qa=sa.getTileUrl(ka.lij[0],ka.lij[1],ka.lij[2]);return this._elevationDataRequester.request(qa,
"binary",Ja).then(ra=>this._lercDecoder.decode(ra,{noDataValue:fa.ELEVATION_NODATA_VALUE},Ja.signal)).then(ra=>{Ta({values:ra.pixelData,width:ra.width,height:ra.height,noDataValue:ra.noDataValue,minValue:ra.minValue,maxValue:ra.maxValue})},da)}U.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};Ca._requestMapTileData=function(ka,sa,Ja){if(sa instanceof L)return Promise.reject();++this._asyncWorkItems;const Ta=(Pa,Qa)=>{--this._asyncWorkItems;U.releaseTileData(Qa);
t.isAborted(Ja)||(this._dataMissing(ka,1,sa,Pa),this.requestUpdate())},da=Pa=>Qa=>Ta(Qa,Pa),qa=Pa=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();t.isAborted(Ja)?U.releaseTileData(Pa):this._mapTileDataArrived(ka,sa,Pa)},Ja.signal,da(Pa)).catch(da(Pa)),ra=(Pa,Qa=null)=>this._frameTask.schedule(()=>Ta(Pa,Qa));if(U.isVectorTileLayerView(sa)){var Da=sa.schemaHelper.getLevelRowColumn(ka.lij);return sa.fetchTile(Da[0],Da[1],Da[2],Ja).then(qa,ra)}if(U.isImageryTileLayerView(sa))return sa.fetchTile(ka.lij[0],
ka.lij[1],ka.lij[2],Ja).then(qa,ra);if(U.isTileLayerView(sa)&&U.useFetchTileForLayer(sa.layer))return sa.layer.fetchTile(ka.lij[0],ka.lij[1],ka.lij[2],Ja).then(Pa=>{t.isAborted(Ja)?(Fa.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),ra(t.createAbortError())):qa(Pa)},ra);Da=sa.getTileUrl(ka.lij[0],ka.lij[1],ka.lij[2]);H.isRefreshableLayer(sa.layer)&&sa.layer.refreshTimestamp&&(Da+=`${Da.includes("?")?"\x26":
"?"}_ts=${sa.layer.refreshTimestamp}`);return this._mapDataRequester.request(Da,sa.hasMixedImageFormats?"image+type":"image",Ja).then(qa,ra)};Ca._mapTileDataArrived=function(ka,sa,Ja){sa=this._layerIndexByUid[1].get(sa.uid);null!=sa?ka.dataArrived(sa,1,Ja):(U.releaseTileData(Ja),Fa.warn("TerrainSurface: received data from unknown layer"))};Ca._dataMissing=function(ka,sa,Ja,Ta){Ja=this._layerIndexByUid[sa].get(Ja.uid);null!=Ja?ka.dataMissing(Ja,sa,Ta):Fa.warn("TerrainSurface: received data from unknown layer")};
Ca.updateTileOverlayParams=function(){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(ka=>{ka.renderData&&this.overlayManager.setTileParameters(ka)}),this._renderer.setNeedsRender())};Ca.getUsedMemory=function(){if(!this.tilingScheme)return 0;-1===this._usedMemory&&(this._usedMemory=0,this._allTiles.forAll(ka=>this._usedMemory+=ka.usedMemory));return this._usedMemory};Ca.getUsedMemoryForLayerView=function(ka){let sa=0;const Ja=this.layerClassFromLayerView(ka),Ta=this._layerIndexByUid[Ja].get(ka.uid);
this._allTiles.forAll(da=>sa+=da.getUsedMemoryForLayer(Ja,Ta));return sa};Ca.getTile=function(ka){if(d.isNone(ka)||d.isNone(this.rootTiles))return null;const sa=ka.split("/").map(qa=>+qa);if(0===sa[0])return this.rootTiles.find(qa=>qa.lij[1]===sa[1]&&qa.lij[2]===sa[2]);ka=2**sa[0];const Ja=Math.floor(sa[1]/ka),Ta=Math.floor(sa[2]/ka);let da;this.rootTiles.some(qa=>qa.lij[1]===Ja&&qa.lij[2]===Ta?(da=qa,!0):!1);if(da){for(ka=1<<sa[0]-1;da.lij[0]<sa[0];){let qa=sa[1]&ka?2:0;0<(sa[2]&ka)&&qa++;if(!da.children[qa])return null;
da=da.children[qa];ka>>=1}U.weakAssert(da.lij[0]===sa[0]&&da.lij[1]===sa[1]&&da.lij[2]===sa[2],"not the right tile?");return da}return null};p._createClass(Ea,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",get:function(){var ka,sa,Ja=null==(ka=this.view.pointsOfInterest)?void 0:null==(sa=ka.contentCameraOnSurface)?void 0:sa.scale;Ja&&(ka=this.view.state.contentCamera,ka=N.directionToHeadingTilt(this.view,ka.eye,ka.viewForward,
ka.up).tilt,90<ka&&(ka=180-ka),ka=2*(ka/90)**2,Ja=N.scaleToZoom(this.view,Ja)-ka,.25<Math.abs(this._snapLevel-Ja)&&(Math.round(Ja)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=Ja));return Math.round(this._snapLevel)}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?1:0}},{key:"upsampleInfoPool",get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",
get:function(){return this._elevationQueryCache}},{key:"mapTileRequester",get:function(){return this._mapDataRequester}},{key:"extent",get:function(){const ka=K.intersection(this.groundExtent,this._userClippingExtent,K.create()),sa=this._get("extent");return K.equals(ka,sa)?sa:ka}},{key:"groundExtent",get:function(){return d.unwrapOr(this._tilingSchemeExtent,this._rootTilesExtent)}},{key:"_tilingSchemeExtent",get:function(){var ka;return null==(ka=this.tilingSchemeLogic)?void 0:ka.extent}},{key:"updating",
get:function(){this._hasPendingUpdates||(this._maxNumUpdating=1);return!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||0<this._asyncWorkItems||!this._allTilesSorted||this._renderer.updating||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}},{key:"updatingProgressValue",get:function(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-this._pendingUpdates/
this._maxNumUpdating}},{key:"viewingMode",get:function(){return this.view.state.viewingMode}},{key:"ready",get:function(){return d.isSome(this.rootTiles)}},{key:"renderOrder",set:function(ka){this._renderer.renderOrder=ka;this._set("renderOrder",ka)}},{key:"skirtScale",get:function(){return this._renderer.skirtScale},set:function(ka){this._renderer.skirtScale=ka}},{key:"spatialReference",get:function(){var ka,sa;return null!=(ka=null==(sa=this.tilingScheme)?void 0:sa.spatialReference)?ka:null}},{key:"_background",
get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage}},{key:"slicePlaneEnabled",set:function(ka){var sa,Ja;this._renderer.slicePlane=ka;this._set("slicePlaneEnabled",ka);null==(sa=this.view)?void 0:null==(Ja=sa._stage)?void 0:Ja.renderView.setRenderParameters({opaqueTerrain:this.opaque})}},{key:"velvetOverground",set:function(ka){ka!==this.velvetOverground&&(this._renderer.velvetOverground=ka);this._set("velvetOverground",ka)}},{key:"visible",set:function(ka){ka!==
this._visible&&(this._visible=ka,this._renderer.setVisibility(ka),this.suspended=!ka)}},{key:"opaque",get:function(){return this._renderer.opaque}},{key:"suspended",set:function(ka){this._set("suspended",ka);this._viewChangeUpdate()}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"running",get:function(){return this.updating&&this.ready&&!this.suspended}},{key:"lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*
fa.MAX_MEMORY_LOD_BIAS}},{key:"performanceInfo",get:function(){const ka=this._performanceInfo;ka.numNodes=this._allTiles.length;ka.numLeaves=ka.numVisible=ka.numRendered=ka.numLoadedPerLevel.length=ka.numRenderedPerLevel.length=0;this._allTiles.forAll(sa=>{sa.isLeaf&&ka.numLeaves++;const Ja=sa.level;sa.renderData&&(ka.numLoadedPerLevel[Ja]=(ka.numLoadedPerLevel[Ja]||0)+1);sa.visible&&(ka.numVisible++,sa.rendered&&(ka.numRenderedPerLevel[Ja]=(ka.numRenderedPerLevel[Ja]||0)+1,ka.numRendered++))});return ka}},
{key:"test",get:function(){const ka=this;return{renderer:ka._renderer,lercDecoder:ka._lercDecoder,forceReload:()=>{d.isSome(ka.rootTiles)&&(ka._mergeTile(ka.rootTiles[0]),ka._viewChangeUpdate())},getTiles:()=>ka._allTiles.toArray(),getRenderedTiles(){Ia.clear();ka._allTiles.forAll(sa=>{sa.visible&&sa.rendered&&Ia.push(sa)});Y.sortTiles(ka.renderOrder,Ia);return Ia.toArray()},lockTilingScheme(sa,Ja){ka._extentHelper.defaultTiledLayersExtent=Ja;ka.tilingSchemeLogic.test.lockTilingScheme(sa)}}}}]);return Ea}(w.EventedMixin(q));
b.__decorate([k.property()],q.prototype,"_renderer",void 0);b.__decorate([k.property()],q.prototype,"_hasPendingUpdates",void 0);b.__decorate([k.property()],q.prototype,"_asyncWorkItems",void 0);b.__decorate([k.property()],q.prototype,"_allTilesDirty",void 0);b.__decorate([k.property()],q.prototype,"_allTilesSorted",void 0);b.__decorate([k.property()],q.prototype,"_viewChanged",void 0);b.__decorate([k.property({readOnly:!0})],q.prototype,"_watchUpdatingTracking",void 0);b.__decorate([k.property()],
q.prototype,"_frameTask",void 0);b.__decorate([k.property({readOnly:!0})],q.prototype,"snapLevel",null);b.__decorate([k.property({readOnly:!0})],q.prototype,"lodSnapping",null);b.__decorate([k.property({constructOnly:!0})],q.prototype,"view",void 0);b.__decorate([k.property()],q.prototype,"_userClippingExtent",void 0);b.__decorate([k.property()],q.prototype,"_rootTilesExtent",void 0);b.__decorate([k.property({readOnly:!0})],q.prototype,"extent",null);b.__decorate([k.property({readOnly:!0})],q.prototype,
"groundExtent",null);b.__decorate([k.property({readOnly:!0})],q.prototype,"_tilingSchemeExtent",null);b.__decorate([k.property({readOnly:!0})],q.prototype,"updating",null);b.__decorate([k.property(P.updatingProgress)],q.prototype,"updatingProgress",void 0);b.__decorate([k.property({readOnly:!0})],q.prototype,"updatingProgressValue",null);b.__decorate([k.property()],q.prototype,"_maxNumUpdating",void 0);b.__decorate([k.property({aliasOf:"view.map.ground.opacity"})],q.prototype,"baseOpacity",void 0);
b.__decorate([k.property({readOnly:!0})],q.prototype,"overlayManager",void 0);b.__decorate([k.property({readOnly:!0})],q.prototype,"viewingMode",null);b.__decorate([k.property()],q.prototype,"maxTextureScale",void 0);b.__decorate([k.property({readOnly:!0})],q.prototype,"ready",null);b.__decorate([k.property({value:1})],q.prototype,"renderOrder",null);b.__decorate([k.property({readOnly:!0})],q.prototype,"rootTiles",void 0);b.__decorate([k.property({readOnly:!0})],q.prototype,"spatialReference",null);
b.__decorate([k.property()],q.prototype,"backgroundImage",void 0);b.__decorate([k.property({type:r,aliasOf:"view.map.ground.surfaceColor"})],q.prototype,"backgroundColor",void 0);b.__decorate([k.property()],q.prototype,"_background",null);b.__decorate([k.property({value:!1})],q.prototype,"slicePlaneEnabled",null);b.__decorate([k.property({readOnly:!0})],q.prototype,"tilingScheme",void 0);b.__decorate([k.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],q.prototype,"tilingSchemeLocked",
void 0);b.__decorate([k.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],q.prototype,"tilingSchemeDone",void 0);b.__decorate([k.property({readOnly:!0})],q.prototype,"tilingSchemeLogic",void 0);b.__decorate([k.property({value:!0})],q.prototype,"velvetOverground",null);b.__decorate([m.aliasOf("_renderer.wireframe")],q.prototype,"wireframe",void 0);b.__decorate([k.property({value:!1})],q.prototype,"suspended",null);b.__decorate([k.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],
q.prototype,"textureFadeDuration",void 0);b.__decorate([k.property()],q.prototype,"_layerViewsDirty",void 0);b.__decorate([m.aliasOf("_renderer.renderPatchBorders")],q.prototype,"renderPatchBorders",void 0);b.__decorate([m.aliasOf("_renderer.renderingDisabled")],q.prototype,"renderingDisabled",void 0);b=q=b.__decorate([v.subclass("esri.views.3d.terrain.TerrainSurface")],q);const La=D.create(),Ma=K.create(),Sa=[0,0,0],Ia=new u,va={spatialReference:null,tile:null,extent:null,context:"ground"},ma={spatialReference:null,
extent:null,scale:0};return b})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],function(a){let p=function(){function b(q){this.store=q}var r=b.prototype;r.destroy=function(){this.store.destroy()};r.get=function(q){return this.store.get(q)};r.put=function(q,y){this.store.put(q,y,y.values.byteLength+256)};return b}();a.ElevationQueryTileCache=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../core/maybe","../../core/workers/WorkerHandle"],function(a,p,b,r){let q=function(f){function w(l=null){var g=f.call(this,"LercWorker","_decode",l,{strategy:"dedicated"})||this;g.schedule=l;g.ref=0;return g}p._inheritsLoose(w,f);var e=w.prototype;e.decode=function(l,g,d){return l&&0!==l.byteLength?this.invoke({buffer:l,options:g},d):Promise.resolve(null)};e.getTransferList=function(l){return[l.buffer]};e.release=function(){0>=--this.ref&&(y.forEach((l,g)=>{l===this&&y.delete(g)}),this.destroy())};
return w}(r.WorkerHandle);const y=new Map;a.acquireDecoder=function(f=null){let w=y.get(b.unwrap(f));w||(b.isSome(f)?(w=new q(e=>f.schedule(e)),y.set(f,w)):(w=new q,y.set(null,w)));++w.ref;return w};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../arrayUtils ../handleUtils ../Logger ../maybe ../promiseUtils ./workers".split(" "),function(a,p,b,r,q,y,f,w){const e=q.getLogger("esri.core.workers.WorkerHandle");
q=function(){function l(d,c,u,t={}){this._mainMethod=c;this._listeners=[];this._promise=w.open(d,{...t,schedule:u}).then(h=>{if(void 0===this._thread){this._thread=h;this._promise=null;t.hasInitialize&&this.broadcast({},"initialize");for(const m of this._listeners)this._connectListener(m)}else h.close()});this._promise.catch(h=>e.error(`Failed to initialize ${d} worker: ${h}`))}var g=l.prototype;g.on=function(d,c){const u={removed:!1,eventName:d,callback:c,threadHandle:null};this._listeners.push(u);
this._connectListener(u);return r.makeHandle(()=>{u.removed=!0;b.remove(this._listeners,u);this._thread&&y.isSome(u.threadHandle)&&u.threadHandle.remove()})};g.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null};g.invoke=function(d,c){return this.invokeMethod(this._mainMethod,d,c)};g.invokeMethod=function(d,c,u){if(this._thread){const t=this.getTransferList(c,d);return this._thread.invoke(d,c,{transferList:t,signal:u})}return this._promise?this._promise.then(()=>
{f.throwIfAborted(u);return this.invokeMethod(d,c,u)}):Promise.reject(null)};g.broadcast=function(d,c){return this._thread?Promise.all(this._thread.broadcast(c,d)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(d,c)):Promise.reject()};g._connectListener=function(d){this._thread&&this._thread.on(d.eventName,d.callback).then(c=>{d.removed||(d.threadHandle=c)})};p._createClass(l,[{key:"promise",get:function(){return this._promise}}]);return l}();a.WorkerHandle=q;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(a,p,b,r,q,y,f,w){w=function(l){function g(c,u,t,h,m,n,z=null){u=l.call(this,c,u,t,h,m,4096,4096)||this;u._memCache=z;u.type="vector-tile";u._referenced=0;u._hasSymbolBuckets=!1;u._memoryUsedByLayerData=
0;u.layerData=new Map;u.layerCount=0;u.status="loading";u.allSymbolsFadingOut=!1;u.lastOpacityUpdate=0;u.symbols=new Map;u.isCoverage=!1;u.neededForCoverage=!1;u.decluttered=!1;u.invalidating=!1;u.parentTile=null;u.childrenTiles=new Set;u._processed=!1;u._referenced=1;u.styleRepository=n;u.id=c.id;return u}p._inheritsLoose(g,l);var d=g.prototype;d.setData=function(c){this.changeDataImpl(c);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};d.deleteLayerData=function(c){let u=
!1;for(const t of c)this.layerData.has(t)&&(c=this.layerData.get(t),this._memoryUsedByLayerData-=c.memoryUsed,3===c.type&&this.symbols.has(t)&&(this.symbols.delete(t),u=!0),c.destroy(),this.layerData.delete(t),this.layerCount--);b.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData);u&&this.emit("symbols-changed");this.requestRender()};d.processed=function(){return this._processed};d.hasData=function(){return 0<this.layerCount};d.dispose=function(){"unloaded"!==
this.status&&(e.delete(this),g._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};d.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};d.retain=function(){++this._referenced};d.changeDataImpl=function(c){let u=!1;if(c){c=this._createRenderBuckets(c);for(const [t,h]of c)this.layerData.has(t)&&(c=this.layerData.get(t),this._memoryUsedByLayerData-=h.memoryUsed,c.destroy(),
this.layerData.delete(t),this.layerCount--),3===h.type&&(this.symbols.set(t,h.symbols),u=!0),this._memoryUsedByLayerData+=h.memoryUsed,this.layerData.set(t,h),this.layerCount++;b.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const [,t]of this.layerData)3===t.type&&(this._hasSymbolBuckets=!0);u&&this.emit("symbols-changed")};d.attachWithContext=function(c){this.stage={context:c,trashDisplayObject(u){u.processDetach()},
untrashDisplayObject(){return!1}}};d.setTransform=function(c,u){l.prototype.setTransform.call(this,c,u);var t=u/(c.resolution*c.pixelRatio);u=this.width/this.rangeX*t;t*=this.height/this.rangeY;const h=[0,0];c.toScreen(h,[this.x,this.y]);const m=this.transforms.tileUnitsToPixels;r.identity(m);r.translate(m,m,h);r.rotate(m,m,Math.PI*c.rotation/180);r.scale(m,m,[u,t,1])};d._createTransforms=function(){return{dvs:q.create(),tileMat3:q.create(),tileUnitsToPixels:q.create()}};g._destroyRenderBuckets=function(c){if(c){var u=
new Set;c.forEach(t=>{u.has(t)||(t.destroy(),u.add(t))});c.clear()}};d._createRenderBuckets=function(c){const u=new Map,t=new Map;for(const h of c){c=this._deserializeBucket(h,t);for(const m of c.layerUIDs)u.set(m,c)}return u};d._deserializeBucket=function(c,u){let t=u.get(c);if(t)return t;switch((new Uint32Array(c))[0]){case 1:t=new y.FillRenderBucket(c,this.styleRepository);break;case 2:t=new y.LineRenderBucket(c,this.styleRepository);break;case 3:t=new y.SymbolRenderBucket(c,this.styleRepository,
this);break;case 4:t=new y.CircleRenderBucket(c,this.styleRepository)}u.set(c,t);return t};p._createClass(g,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<f.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<f.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===
this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return g}(w.TiledDisplayObject);const e=new Map;a.VectorTile=w;a.printAllocations=function(){e.forEach((l,g)=>{console.log(`\n${g.key}:`);l[0].forEach(d=>console.log(d));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");l[1].forEach(d=>console.log(d))})};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function p(){const f=new Float32Array(9);f[0]=1;f[4]=1;f[8]=1;return f}function b(f){const w=new Float32Array(9);w[0]=f[0];w[1]=f[1];w[2]=f[2];w[3]=f[3];w[4]=f[4];w[5]=f[5];w[6]=f[6];w[7]=f[7];w[8]=f[8];return w}function r(f,w,e,l,g,d,c,u,t){const h=new Float32Array(9);h[0]=f;h[1]=w;h[2]=e;h[3]=l;h[4]=g;h[5]=d;h[6]=c;h[7]=u;h[8]=t;return h}function q(f,w){return new Float32Array(f,w,9)}var y=Object.freeze({__proto__:null,
create:p,clone:b,fromValues:r,createView:q});a.clone=b;a.create=p;a.createView=q;a.fromValues=r;a.mat3f32=y})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../../chunks/builtins ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject ./decluttering/util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){q=function(){function u(h,m){this.layerUIDs=[];this.isDestroyed=!1;this.data=h;this.memoryUsed=h.byteLength;let n=1;h=new Uint32Array(h);this.layerUIDs=[];const z=h[n++];for(let k=0;k<z;k++)this.layerUIDs[k]=h[n++];this.bufferDataOffset=n;m&&(this.layer=m.getStyleLayerByUID(this.layerUIDs[0]))}var t=u.prototype;t.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};t.prepareForRendering=function(h){b.isNone(this.data)||(this.doPrepareForRendering(h,
this.data,this.bufferDataOffset),this.data=null)};p._createClass(u,[{key:"isPreparedForRendering",get:function(){return b.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return u}();y=function(u){function t(m,n){n=u.call(this,m,n)||this;n.type=2;n.lineIndexStart=0;n.lineIndexCount=0;m=new Uint32Array(m);let z=n.bufferDataOffset;n.lineIndexStart=m[z++];n.lineIndexCount=m[z++];const k=m[z++];if(0<k){const v=new Map;for(let x=0;x<k;x++){const C=m[z++],A=m[z++],B=m[z++];
v.set(C,[A,B])}n.patternMap=v}n.bufferDataOffset=z;return n}p._inheritsLoose(t,u);var h=t.prototype;h.hasData=function(){return 0<this.lineIndexCount};h.triangleCount=function(){return this.lineIndexCount/3};h.doDestroy=function(){b.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();b.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();b.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=
null;this.memoryUsed=0};h.doPrepareForRendering=function(m,n,z){n=new Uint32Array(n);var k=new Int32Array(n.buffer);const v=n[z++];this.lineVertexBuffer=r.createVertex(m,35044,new Int32Array(k.buffer,4*z,v));z+=v;k=n[z++];this.lineIndexBuffer=r.createIndex(m,35044,new Uint32Array(n.buffer,4*z,k));z+=k;z=this.layer.lineMaterial;this.lineVertexArrayObject=new d(m,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return t}(q);f=function(u){function t(m,
n){n=u.call(this,m,n)||this;n.type=1;n.fillIndexStart=0;n.fillIndexCount=0;n.outlineIndexStart=0;n.outlineIndexCount=0;m=new Uint32Array(m);let z=n.bufferDataOffset;n.fillIndexStart=m[z++];n.fillIndexCount=m[z++];n.outlineIndexStart=m[z++];n.outlineIndexCount=m[z++];const k=m[z++];if(0<k){const v=new Map;for(let x=0;x<k;x++){const C=m[z++],A=m[z++],B=m[z++];v.set(C,[A,B])}n.patternMap=v}n.bufferDataOffset=z;return n}p._inheritsLoose(t,u);var h=t.prototype;h.hasData=function(){return 0<this.fillIndexCount||
0<this.outlineIndexCount};h.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};h.doDestroy=function(){b.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();b.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();b.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;b.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();b.isSome(this.outlineVertexBuffer)&&
this.outlineVertexBuffer.dispose();b.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};h.doPrepareForRendering=function(m,n,z){n=new Uint32Array(n);var k=new Int32Array(n.buffer),v=n[z++];this.fillVertexBuffer=r.createVertex(m,35044,new Int32Array(k.buffer,4*z,v));z+=v;v=n[z++];this.fillIndexBuffer=r.createIndex(m,35044,new Uint32Array(n.buffer,4*z,v));z+=v;v=n[z++];this.outlineVertexBuffer=
r.createVertex(m,35044,new Int32Array(k.buffer,4*z,v));z+=v;k=n[z++];this.outlineIndexBuffer=r.createIndex(m,35044,new Uint32Array(n.buffer,4*z,k));z+=k;n=this.layer;z=n.fillMaterial;n=n.outlineMaterial;this.fillVertexArrayObject=new d(m,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new d(m,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return t}(q);w=function(u){function t(m,
n,z){n=u.call(this,m,n)||this;n.type=3;n.iconPerPageElementsMap=new Map;n.glyphPerPageElementsMap=new Map;n.symbolInstances=[];n.isIconSDF=!1;n.opacityChanged=!1;n.lastOpacityUpdate=0;n.symbols=[];const k=new Uint32Array(m),v=new Int32Array(m);m=new Float32Array(m);let x=n.bufferDataOffset;n.isIconSDF=!!k[x++];var C=k[x++];for(var A=0;A<C;A++){var B=k[x++],D=k[x++],E=k[x++];n.iconPerPageElementsMap.set(B,[D,E])}C=k[x++];for(A=0;A<C;A++)B=k[x++],D=k[x++],E=k[x++],n.glyphPerPageElementsMap.set(B,[D,
E]);C=k[x++];A=k[x++];n.iconOpacity=new Int32Array(C);n.textOpacity=new Int32Array(A);x=c.deserializeSymbols(k,v,m,x,n.symbols,z);n.bufferDataOffset=x;return n}p._inheritsLoose(t,u);var h=t.prototype;h.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};h.triangleCount=function(){let m=0;for(const [,n]of this.iconPerPageElementsMap)m+=n[1];for(const [,n]of this.glyphPerPageElementsMap)m+=n[1];return m/3};h.doDestroy=function(){b.isSome(this.iconVertexArrayObject)&&
this.iconVertexArrayObject.dispose();b.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();b.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();b.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;b.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();b.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();b.isSome(this.textOpacityBuffer)&&
this.textOpacityBuffer.dispose();b.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};h.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var m=b.unwrap(this.iconOpacity),n=b.unwrap(this.iconOpacityBuffer);0<m.length&&m.byteLength===n.size&&n.setSubData(m);m=b.unwrap(this.textOpacity);n=b.unwrap(this.textOpacityBuffer);0<m.length&&m.byteLength===
n.size&&n.setSubData(m)}};h.doPrepareForRendering=function(m,n,z){n=new Uint32Array(n);var k=new Int32Array(n.buffer),v=n[z++];this.iconVertexBuffer=r.createVertex(m,35044,new Int32Array(k.buffer,4*z,v));z+=v;v=n[z++];this.iconIndexBuffer=r.createIndex(m,35044,new Uint32Array(n.buffer,4*z,v));z+=v;v=n[z++];this.textVertexBuffer=r.createVertex(m,35044,new Int32Array(k.buffer,4*z,v));z+=v;k=n[z++];this.textIndexBuffer=r.createIndex(m,35044,new Uint32Array(n.buffer,4*z,k));z+=k;this.iconOpacityBuffer=
r.createVertex(m,35044,b.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=r.createVertex(m,35044,b.unwrap(this.textOpacity).buffer);n=this.layer;z=n.iconMaterial;n=n.textMaterial;this.iconVertexArrayObject=new d(m,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new d(m,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};
return t}(q);e=function(u){function t(m,n){n=u.call(this,m,n)||this;n.type=4;n.circleIndexStart=0;n.circleIndexCount=0;m=new Uint32Array(m);let z=n.bufferDataOffset;n.circleIndexStart=m[z++];n.circleIndexCount=m[z++];n.bufferDataOffset=z;return n}p._inheritsLoose(t,u);var h=t.prototype;h.hasData=function(){return 0<this.circleIndexCount};h.triangleCount=function(){return this.circleIndexCount/3};h.doDestroy=function(){b.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();
b.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();b.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};h.doPrepareForRendering=function(m,n,z){n=new Uint32Array(n);var k=new Int32Array(n.buffer);const v=n[z++];this.circleVertexBuffer=r.createVertex(m,35044,new Int32Array(k.buffer,4*z,v));z+=v;k=n[z++];this.circleIndexBuffer=r.createIndex(m,35044,new Uint32Array(n.buffer,
4*z,k));z+=k;z=this.layer.circleMaterial;this.circleVertexArrayObject=new d(m,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return t}(q);a.CircleRenderBucket=e;a.FillRenderBucket=f;a.LineRenderBucket=y;a.RenderBucketBase=q;a.SymbolRenderBucket=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"./core"],function(a,p,b,r){let q=function(e){this.tile=e;this.parent=null;this.children=new Set},y=function(){function e(){this.nodes=new Map;this.roots=new Set}var l=e.prototype;l.create=function(g){const d=new q(g);let c;const u=[];this.nodes.forEach(t=>{this._canConnectDirectly(d,t)&&u.push(t);!c&&this._canConnectDirectly(t,d)&&(c=t)});if(c){for(const t of u)c.children.delete(t),d.children.add(t),t.parent=d;c.children.add(d);d.parent=c}else{this.roots.add(d);for(const t of u)d.children.add(t),
t.parent=d,this.roots.delete(t)}this.nodes.set(g.key.id,d);return d};l.destroy=function(g){b.isSome(g.parent)?(g.parent.children.delete(g),g.children.forEach(d=>{b.isSome(g.parent)&&g.parent.children.add(d)})):this.roots.delete(g);g.children.forEach(d=>{(d.parent=g.parent)||this.roots.add(d)});this.nodes.delete(g.tile.key.id)};l.clear=function(){this.roots.clear();this.nodes.clear()};l._canConnectDirectly=function(g,d){let {level:c,row:u,col:t}=d.tile.key;for({world:d}=d.tile.key;0<c;){c--;u>>=1;
t>>=1;if(g.tile.key.level===c&&g.tile.key.row===u&&g.tile.key.col===t&&g.tile.key.world===d)return!0;if(this.nodes.has(`${c}/${u}/${t}/${d}`))break}return!1};return e}(),f=function(){function e(){this._tileGraph=new y;this._tileArray=null}var l=e.prototype;l.has=function(g){return"string"===typeof g?this._tileGraph.nodes.has(g):this._tileGraph.nodes.has(g.key.id)};l.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(g=>{this._tileArray.push(g.tile)}));return this._tileArray};
l.getRoots=function(){const g=[];this._tileGraph.roots.forEach(d=>{g.push(d.tile)});return g};l.getParent=function(g){g=this._tileGraph.nodes.get("string"===typeof g?g:g.key.id);return b.isSome(g.parent)&&g.parent.tile};l.getChildren=function(g){const d=[];this._tileGraph.nodes.get("string"===typeof g?g:g.key.id).children.forEach(c=>{d.push(c.tile)});return d};l.get=function(g){return this._tileGraph.nodes.get(g).tile};l.removeKey=function(g){g=this._tileGraph.nodes.get(g);this._tileGraph.destroy(g);
this._tileArray=null};l.forEach=function(g){this._tileGraph.nodes.forEach((d,c)=>g(d.tile,c))};l.add=function(g){this._tileGraph.create(g);this._tileArray=null};l.remove=function(g){g=this._tileGraph.nodes.get(g.key.id);this._tileGraph.destroy(g);this._tileArray=null};l.clear=function(){this._tileGraph.clear();this._tileArray=[]};return e}(),w=function(){function e(g,d,c){this._rows=Math.ceil(d/c);this._columns=Math.ceil(g/c);this._cellSize=c;this.cells=Array(this._rows);for(g=0;g<this._rows;g++)for(this.cells[g]=
Array(this._columns),d=0;d<this._columns;d++)this.cells[g][d]=[]}var l=e.prototype;l.getCell=function(g,d){d=Math.min(Math.max(Math.floor(d/this._cellSize),0),this._rows-1);g=Math.min(Math.max(Math.floor(g/this._cellSize),0),this._columns-1);return this.cells[d]&&this.cells[d][g]||null};l.getCellSpan=function(g,d,c,u){return[Math.min(Math.max(Math.floor(g/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(c/this._cellSize),
0),this.columns-1),Math.min(Math.max(Math.floor(u/this._cellSize),0),this.rows-1)]};p._createClass(e,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return e}();a.GridIndex=w;a.TileForest=f;a.TileGraph=y;a.TileNode=q;a.deserializeSymbols=function(e,l,g,d,c,u){const t=l[d++];for(let n=0;n<t;n++){const z=new r.VTLSymbol(u);z.xTile=l[d++];z.yTile=l[d++];z.hash=l[d++];z.priority=l[d++];var h=
l[d++];for(var m=0;m<h;m++){const k=l[d++],v=l[d++],x=l[d++],C=l[d++],A=!!l[d++],B=l[d++],D=g[d++],E=g[d++],G=l[d++],K=l[d++];z.colliders.push({xTile:k,yTile:v,dxPixels:x,dyPixels:C,hard:A,partIndex:B,width:G,height:K,minLod:D,maxLod:E})}h=e[d++];for(m=0;m<h;m++)z.textVertexRanges.push([e[d++],e[d++]]);h=e[d++];for(m=0;m<h;m++)z.iconVertexRanges.push([e[d++],e[d++]]);c.push(z)}return d};a.tileCoordChange=function(e,l,g,d,c,u){g-=c;if(0<=g)return(l>>g)+(d-(u<<g))*(e>>g);g=-g;return l-(u-(d<<g))*(e>>
g)<<g};a.writeOpacityToBuffers=function(e,l,g){for(const [n,z]of e.symbols){{var d=e,c=l,u=g,t=z;const k=d.layerData.get(n);if(3===k.type){for(const v of t){t=v.unique;var h=void 0;if(v.selectedForRendering){var m=t.parts[0];h=m.startOpacity;m=m.targetOpacity;d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===m;h=u?Math.floor(127*h)|m<<7:m?255:0;h|=h<<24|h<<16|h<<8}else h=0;for(const [x,C]of v.iconVertexRanges)for(m=x;m<x+C;m+=4)k.iconOpacity[m/4]=h;v.selectedForRendering?(h=t.parts[1],t=h.startOpacity,
h=h.targetOpacity,d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===h,t=u?Math.floor(127*t)|h<<7:h?255:0,h=t<<24|t<<16|t<<8|t):h=0;for(const [x,C]of v.textVertexRanges)for(t=x;t<x+C;t+=4)k.textOpacity[t/4]=h}k.lastOpacityUpdate=c;k.opacityChanged=!0}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){a.VTLSymbol=function(p){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=
[];this.iconVertexRanges=[];this.tile=p};a.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(a,p,b,r,q){r=function(y){function f(e,l,g,d,c,u=d,t=c){var h=y.call(this)||this;h.triangleCountReportedInDebug=0;h.triangleCount=0;h.texture=null;h.key=new q(e);h.x=l;h.y=g;h.width=d;h.height=c;h.rangeX=u;h.rangeY=t;return h}p._inheritsLoose(f,y);var w=f.prototype;w.destroy=function(){this.texture&&
(this.texture.dispose(),this.texture=null)};w.setTransform=function(e,l){l/=e.resolution*e.pixelRatio;const g=this.transforms.tileMat3,[d,c]=e.toScreenNoRotation([0,0],[this.x,this.y]);b.set(g,this.width/this.rangeX*l,0,0,0,this.height/this.rangeY*l,0,d,c,1);b.multiply(this.transforms.dvs,e.displayViewMat3,g)};return f}(r.DisplayObject);a.TiledDisplayObject=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/DisplayObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/has ../../../core/maybe ../../../core/promiseUtils".split(" "),
function(a,p,b,r,q,y){const f=1/r("mapview-transitions-duration");b=function(w){function e(){var g=w.apply(this,arguments)||this;g._fadeOutResolver=null;g._fadeInResolver=null;g._clips=null;g.computedVisible=!0;g.computedOpacity=1;g.fadeTransitionEnabled=!1;g.inFadeTransition=!1;g._isReady=!1;g._opacity=1;g._stage=null;g._visible=!0;return g}p._inheritsLoose(e,w);var l=e.prototype;l._getTransforms=function(){q.isNone(this._transforms)&&(this._transforms=this._createTransforms());return this._transforms};
l.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=y.createResolver();this.requestRender();return this._fadeInResolver.promise};l.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=
y.createResolver();this.requestRender();return this._fadeOutResolver.promise};l.beforeRender=function(g){this.updateTransitionProperties(g.deltaTime,g.state.scale)};l.afterRender=function(g){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};l.remove=function(){var g;null==(g=this.parent)?void 0:g.removeChild(this)};l.setTransform=function(g){};
l.processRender=function(g){this.stage&&this.computedVisible&&this.doRender(g)};l.requestRender=function(){this.stage&&this.stage.requestRender()};l.processDetach=function(){this.onDetach();this.emit("detach")};l.updateTransitionProperties=function(g,d){if(this.fadeTransitionEnabled){d=this._fadeOutResolver||!this.visible?0:this.opacity;const c=this.computedOpacity;c===d?this.computedVisible=this.visible:(g*=f,this.computedOpacity=c>d?Math.max(d,c-g):Math.min(d,c+g),this.computedVisible=0<this.computedOpacity,
g=d===this.computedOpacity,this.inFadeTransition=!g,g||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible};l.onAttach=function(){};l.onDetach=function(){};l.doRender=function(g){};l.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};p._createClass(e,[{key:"clips",get:function(){return this._clips},set:function(g){this._clips=g;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",
get:function(){return this._opacity},set:function(g){this._opacity!==g&&(this._opacity=Math.min(1,Math.max(g,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(g){if(this._stage!==g){var d=this._stage;(this._stage=g)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):d.trashDisplayObject(this)}}},{key:"transforms",get:function(){return this._getTransforms()}},{key:"visible",get:function(){return this._visible},set:function(g){this._visible!==
g&&(this._visible=g,this.requestRender())}}]);return e}(b);a.DisplayObject=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(a,p){let b=function(){function r(y,f,w,e){this.set(y,f,w,e)}r.getId=function(y,f,w,e){return"object"===typeof y?`${y.level}/${y.row}/${y.col}/${y.world}`:`${y}/${f}/${w}/${e}`};var q=r.prototype;q.acquire=function(y,f,w,e){this.set(y,f,w,e)};
q.contains=function(y){const f=y.level-this.level;return this.row===y.row>>f&&this.col===y.col>>f&&this.world===y.world};q.equals=function(y){return this.level===y.level&&this.row===y.row&&this.col===y.col&&this.world===y.world};q.clone=function(){return new r(this)};q.release=function(){this.world=this.col=this.row=this.level=0};q.set=function(y,f,w,e){if(null==y)this.world=this.col=this.row=this.level=0;else if("object"===typeof y)this.level=y.level||0,this.row=y.row||0,this.col=y.col||0,this.world=
y.world||0;else if("string"===typeof y){const [l,g,d,c]=y.split("/");this.level=parseFloat(l);this.row=parseFloat(g);this.col=parseFloat(d);this.world=parseFloat(c)}else this.level=+y,this.row=+f,this.col=+w,this.world=+e||0;return this};q.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};q.getParentKey=function(){return 0>=this.level?null:new r(this.level-1,this.row>>1,this.col>>1,this.world)};q.getChildKeys=function(){const y=this.level+1,f=this.row<<1,w=this.col<<
1,e=this.world;return[new r(y,f,w,e),new r(y,f,w+1,e),new r(y,f+1,w,e),new r(y,f+1,w+1,e)]};q.compareRowMajor=function(y){return this.row<y.row?-1:this.row>y.row?1:this.col<y.col?-1:this.col>y.col?1:0};a._createClass(r,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(y){this.set(y)}},{key:"hash",get:function(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}}]);return r}();b.pool=new p(b,null,null,25,50);return b})},
"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),function(a,p,b,r,q,y,f,w,e,l,g){q=function(d){function c(){var u=d.apply(this,arguments)||this;u.type=
"elevation-3d";return u}a._inheritsLoose(c,d);c.prototype.initialize=function(){var u=this.get("view.map.allLayers");u=u&&u.includes(this.layer);var t=this.get("view.map.ground.layers");t=t&&t.includes(this.layer);u&&!t&&(u=new b("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(Promise.reject(u)));this._addTilingSchemeMatchPromise()};return c}(l.TiledLayerView3D(e.LayerView3D(g)));p.__decorate([r.property({readOnly:!0,
aliasOf:"layer.fullExtent"})],q.prototype,"fullExtent",void 0);p.__decorate([r.property()],q.prototype,"layer",void 0);p.__decorate([r.property({readOnly:!0,aliasOf:"layer.tileInfo"})],q.prototype,"tileInfo",void 0);return q=p.__decorate([w.subclass("esri.views.3d.layers.ElevationLayerView3D")],q)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l){a.LayerView3D=g=>{g=function(d){function c(){var t=d.apply(this,arguments)||this;t.slicePlaneEnabled=!1;t.supportsHeightUnitConversion=!1;return t}p._inheritsLoose(c,d);var u=c.prototype;u.postscript=function(t){d.prototype.postscript.call(this,t);l.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};u._validateHeightModelInfo=function(){var t=p._asyncToGenerator(function*(){var h=r.whenFalseOnce(this.view.defaultsFromMap,"isHeightModelInfoSearching");
this.handles.add(h);yield h;if(h=l.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw h;});return function(){return t.apply(this,arguments)}}();return c}(g);b.__decorate([q.property()],g.prototype,"view",void 0);b.__decorate([q.property()],g.prototype,"slicePlaneEnabled",void 0);return g=b.__decorate([e.subclass("esri.views.3d.layers.LayerView3D")],g)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){a.TiledLayerView3D=c=>{c=function(u){function t(){return u.apply(this,arguments)||this}p._inheritsLoose(t,u);var h=t.prototype;h.getTileUrl=function(m,n,z){return this.layer.getTileUrl(m,n,z)};h._addTilingSchemeMatchPromise=function(){var m=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);m?this.addResolvingPromise(Promise.reject(m)):(m=q.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(()=>{const n=this._getTileInfoCompatibilityError(this.tileInfo,
this.view.basemapTerrain.tilingScheme);if(n)throw n;}),this.addResolvingPromise(m))};h._getTileInfoSupportError=function(m,n){if(m=d.checkIfTileInfoSupportedForView(m,n,this.view.spatialReference,this.view.state.viewingMode)){n={layer:this.layer,error:m};switch(m.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":m=new r("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",
n);break;default:m=new r("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",n)}return m}return null};h._getTileInfoCompatibilityError=function(m,n){return n.compatibleWith(m)?null:new r("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};h.levelRangeFromScaleRange=function(m,n){const z={minLevel:0,maxLevel:Infinity};var k=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;
if(!k)return z;const v=k.levels[0];k=x=>{x=Math.log(v.scale/x)/Math.LN2;return 1E-9>.5-Math.abs(.5-x%1)?Math.round(x):Math.ceil(x)};null!=m&&0<m&&(z.minLevel=Math.max(0,k(m)));null!=n&&0<n&&(z.maxLevel=Math.max(0,k(n)));return z};h.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};p._createClass(t,[{key:"imageFormatIsOpaque",get:function(){return!1}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",
get:function(){const m=this.tileInfo.lods;return this.levelRangeFromScaleRange(m[0].scale,m[m.length-1].scale)}},{key:"displayLevelRange",get:function(){var m=this.tileInfo.lods;m=this.levelRangeFromScaleRange(this.layer.minScale||m[0].scale,this.layer.maxScale||m[m.length-1].scale);this.layer.maxScale&&m.maxLevel++;return m}}]);return t}(c);b.__decorate([y.property({readOnly:!0})],c.prototype,"imageFormatIsOpaque",null);b.__decorate([y.property({readOnly:!0})],c.prototype,"updating",void 0);b.__decorate([y.property(g.updatingProgress)],
c.prototype,"updatingProgress",void 0);b.__decorate([y.property(g.updatingProgressValue)],c.prototype,"updatingProgressValue",void 0);b.__decorate([y.property({readOnly:!0})],c.prototype,"fullExtent",void 0);b.__decorate([y.property({readOnly:!0})],c.prototype,"isOpaque",null);b.__decorate([y.property({readOnly:!0})],c.prototype,"dataLevelRange",null);b.__decorate([y.property({readOnly:!0})],c.prototype,"displayLevelRange",null);b.__decorate([y.property()],c.prototype,"layer",void 0);b.__decorate([y.property({readOnly:!0})],
c.prototype,"tileInfo",void 0);return c=b.__decorate([l.subclass("esri.views.3d.layers.TiledLayerView3D")],c)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],
function(a){let p=function(){function b(r=0,q=0){this.min=r;this.max=q;this.level=0;this.hasNoDataValues=!1}b.prototype.copyFrom=function(r){this.min=r.min;this.max=r.max;this.level=r.level;this.hasNoDataValues=r.hasNoDataValues};return b}();a.ElevationBounds=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../support/mathUtils","./TerrainConst"],function(a,p,b,r){let q=function(){function y(w,e,l){this.type=
"elevation";this.samplerData=null;this.level=w[0];this.i=w[1];this.j=w[2];this.extent=e;w=l.noDataValue;const g=l.values;let d=Infinity,c=-Infinity,u=!0,t=!1;for(let h=0;h<g.length;h++){const m=g[h];m!==w?(d=m<d?m:d,c=m>c?m:c,u=!1):t=!0}u&&(c=d=0);this.samplerData={pixelData:l.values,width:l.width,height:l.height,noDataValue:w,safeWidth:.99999999*(l.width-1),dx:(l.width-1)/(e[2]-e[0]),dy:(l.width-1)/(e[3]-e[1]),x0:e[0],y1:e[3]};this.bounds=[d,-3E38<c?c:0];this.hasNoDataValues=t}var f=y.prototype;
f.release=function(){this.bounds=this.samplerData=null};f.computeMinMaxValue=function(w,e,l,g){g.min=Infinity;g.max=-Infinity;g.hasNoDataValues=!1;w-=this.level;if(0>=w)return g;var d=2**w;if(Math.floor(e/d)!==this.i||Math.floor(l/d)!==this.j)return g;var c=Infinity,u=-Infinity,t=this.samplerData.width,h=this.samplerData.pixelData,m=.5*r.ELEVATION_NODATA_VALUE;w=(t-1)/d;l=(l-this.j*d)*w;let n=(e-this.i*d)*w;if(1>w){const v=Math.floor(l),x=Math.floor(n);var z=v+x*t;e=h[z];d=h[z+1];var k=h[z+t];z=h[z+
t+1];if(e+d+k+z<m)return c=l-v,m=n-x,u=b.bilerp(e,d,k,z,c,m),t=b.bilerp(e,d,k,z,c+w,m),h=b.bilerp(e,d,k,z,c,m+w),w=b.bilerp(e,d,k,z,c+w,m+w),g.min=Math.min(u,t,h,w),g.max=Math.max(u,t,h,w),g;l=v;n=x;w=1}else l=Math.floor(l),n=Math.floor(n),w=Math.ceil(w);for(e=l;e<=l+w;e++)for(d=n;d<=n+w;d++)k=h[e+d*t],k<m?(c=Math.min(c,k),u=Math.max(u,k)):g.hasNoDataValues=!0;g.min=c;g.max=u;return g};y.sample=function(w,e,l){for(const t of l){if(!t)continue;var g=t.safeWidth,d=t.width,c=t.pixelData;l=p.clamp(t.dy*
(t.y1-e),0,g);g=p.clamp(t.dx*(w-t.x0),0,g);const h=Math.floor(l),m=Math.floor(g);var u=h*d+m;const n=u+d,z=c[u];d=c[n];u=c[u+1];c=c[n+1];if(z+d+u+c<.5*r.ELEVATION_NODATA_VALUE)return l-=h,g-=m,w=z+(u-z)*g,w+(d+(c-d)*g-w)*l}return null};return y}();a.ElevationData=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){function m(k,v){return k&&!k.spatialReference.equals(v)?d.projectWithoutEngine(k,k.spatialReference,v):k}a.ExtentHelper=function(k){function v(C){C=k.call(this,C)||this;C._handles=new q;return C}p._inheritsLoose(v,k);var x=v.prototype;x.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};x.destroy=function(){this._handles.destroy();this._handles=null};x._computeStencilEnabledExtents=function(){const C=
[];this.layerViews.forEach(A=>{A=A.layer;"IntegratedMeshLayer"===A.operationalLayerType&&null!=this.viewSpatialReference&&(A=m(A.fullExtent,this.viewSpatialReference),y.isSome(A)&&C.push(c.fromExtent(A)))});return C};p._createClass(v,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}}]);return v}(r);
b.__decorate([f.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);b.__decorate([f.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);b.__decorate([f.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);b.__decorate([f.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);b.__decorate([f.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);b.__decorate([f.property()],a.ExtentHelper.prototype,"defaultTiledLayersExtent",
void 0);b.__decorate([f.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);b.__decorate([f.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=b.__decorate([g.subclass("esri.views.3d.terrain.ExtentHelper")],a.ExtentHelper);let n=function(k){function v(){return k.apply(this,arguments)||this}p._inheritsLoose(v,k);var x=v.prototype;x._computeLayerViewsExtent=function(){return this._globalExtent};x._computeTiledLayersExtent=function(){return this._globalExtent};
p._createClass(v,[{key:"_globalExtent",get:function(){return this.viewSpatialReference.isWebMercator?t.WEBMERCATOR_WORLD_EXTENT:t.GEOGRAPHIC_WORLD_EXTENT}}]);return v}(a.ExtentHelper);n=b.__decorate([g.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],n);let z=function(k){function v(){return k.apply(this,arguments)||this}p._inheritsLoose(v,k);var x=v.prototype;x._computeLayerViewsExtent=function(){const C=c.empty(),A=this.viewSpatialReference;this.layerViews.forEach(E=>{const G=E.layer;!E.isResolved()||
"graphics"===G.type&&G.internal||(E=m("fullExtentInLocalViewSpatialReference"in E&&E.fullExtentInLocalViewSpatialReference||E.layer.fullExtent,A),c.expand(C,E,C))});const B=c.allFinite(C)?C:null,D=this._get("layerViewsExtent");return c.equals(B,D)?D:B};x._computeTiledLayersExtent=function(){const C=this.tilingScheme;if(!C)return null;const A=this.viewSpatialReference,B=c.empty();this.layers.forEach(G=>{if(G.loaded&&u.isTiledLayer(G)){const {tileInfo:K,fullExtent:M}=h.getTiledLayerInfo(G,A,2);(K&&
h.isProjectableRasterLayer(G)&&M||K&&C.compatibleWith(K)&&M&&M.spatialReference.equals(C.spatialReference))&&c.expand(B,M,B)}});c.expand(B,this.defaultTiledLayersExtent,B);const D=c.allFinite(B)?B:null,E=this._get("tiledLayersExtent");return c.equals(D,E)?E:D};return v}(a.ExtentHelper);z=b.__decorate([g.subclass("esri.views.3d.terrain.ExtentHelperLocal")],z);a.create=function(k,v){return 1===k?new n(v):new z(v)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/animationUtils ../support/debugFlags ../support/debugUtils ../support/mathUtils ./Overlay ./OverlayRenderer ../webgl-engine/lib/Intersector ../webgl-engine/lib/localOrigin ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N){const R=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let S;a.OverlayManager=function(ha){function fa(W){W=ha.call(this,W)||this;W._handles=new q;W._spatialReference=null;W._renderSR=null;W._overlaySREqualsRenderSR=!0;W._drapeSources=new Map;W._drapeTargets=new Set;W._placementDirty=!1;W._drawTexturesDirty=!1;W._drawTexturesAnimateDirty=
!1;W._layerViewsDirty=!0;W._hasUnusedRenderTargets=!1;W._longitudeCyclical=null;W._latestOriginId=0;W._maxResolution=y("esri-mobile")?2048:4096;W._animationTimeLast=0;return W}p._inheritsLoose(fa,ha);var aa=fa.prototype;aa.initialize=function(){const W=this.view;this.renderer=new O.OverlayRenderer({view:W,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});this._groundIntersector=new I.Intersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=
!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this._handles.add([this.renderer.events.on("has-highlights",()=>{this._setDrawTexturesDirty();this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",U=>{var X;return null==(X=W._stage)?void 0:X.renderView.setRenderParameters({hasOverlayWater:U})}),this.renderer.events.on("renders-occluded",()=>{this._setDrawTexturesDirty();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",
()=>this._setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateDrapeTargets()),W.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],()=>this.setPlacementDirty()),this.surface.on("elevation-change",()=>this.setPlacementDirty()),W.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0),W.on("resize",()=>this.setPlacementDirty()),e.addFrameTask({preRender:U=>{this.renderer.processSyncLayers();this._updateLayerViews();
this.renderer.hasOverlays&&(this._dispatchRendererUpdate(U),this._drawOverlayTextures(this.renderer.overlays));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),W.resourceController.scheduler.registerTask(N.TaskPriority.OVERLAY,this),W._stage.renderView.events.on("force-camera-for-screenshot",U=>{this._updateOverlays(U);this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays)})]);this._updateLayerViews()};aa.destroy=function(){this._drapeSources.forEach((W,
U)=>this.unregisterDrapeSource(U));this._drapeTargets.forEach(W=>this._unregisterDrapeTarget(W));this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null);w.isSome(S)&&(S.hide(),S=null)};aa.setSpatialReference=function(W){this._spatialReference=W;this.renderer.spatialReference=W;this._longitudeCyclical=null;const U=this.view.renderSpatialReference;w.isSome(W)&&w.isSome(U)?(this._renderSR=U,this._overlaySREqualsRenderSR=W.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=
W.isWebMercator?new H.Cyclical(-2.0037508342787E7,2.0037508342787E7):new H.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()};aa.getGpuMemoryUsage=function(){return this.renderer.gpuMemoryUsage};aa._updateLayerViews=function(){if(this._layerViewsDirty){var W=new Set;for(const U of this.view.allLayerViews.items)W.add(U.uid),"drapeSourceType"in U&&!this._drapeSources.has(U)&&
this._registerDrapeSource(U,0),"drapeTargetType"in U&&!this._drapeTargets.has(U)&&this._registerDrapeTarget(U);this._drapeSources.forEach((U,X)=>{0!==U||W.has(X.uid)||this.unregisterDrapeSource(X)});this._drapeTargets.forEach(U=>{W.has(U.uid)||this._unregisterDrapeTarget(U)});this.renderer.updateLayerOrder();this._setDrawTexturesDirty();this._layerViewsDirty=!1}};aa.registerDrapeSource=function(W){this._registerDrapeSource(W,1)};aa._registerDrapeSource=function(W,U){this._drapeSources.set(W,U);this.renderer.ensureOverlays(this._drapeTargets,
this._drapeSources);this._updateDrapeSource(W);this._setContentDirty();this.notifyChange("running")};aa._updateDrapeSource=function(W){2===this.renderer.overlays.length&&w.isSome(W.setDrapingExtent)&&w.isSome(this._spatialReference)&&W.setDrapingExtent(this.renderer.overlays,this._spatialReference)};aa.unregisterDrapeSource=function(W){this._drapeSources.has(W)&&(this._drapeSources.delete(W),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))};
aa._registerDrapeTarget=function(W){this._drapeTargets.add(W);this._updateDrapeTarget(W);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)};aa.updateDrapeTargets=function(){this._drapeTargets.forEach(W=>this._updateDrapeTarget(W))};aa._updateDrapeTarget=function(W){W.setDrapingTextures(this.renderer.overlays)};aa._unregisterDrapeTarget=function(W){this._drapeTargets.delete(W);this.renderer.ensureDrapeTargets(this._drapeTargets)};aa._setContentDirty=function(){this.setPlacementDirty();
this._setDrawTexturesDirty()};aa.setPlacementDirty=function(){this._placementDirty=!0};aa.runTask=function(){this._updateOverlays(this.view.state.camera)};aa._updateOverlays=function(W){if(this._spatialReference){this._updateLayerViews();var U=J.computeOverlayResolution(W.fullWidth,W.fullHeight,this._maxResolution);this._computeOverlayExtents(W,U,V);var X=x.width(V.inner)/x.width(V.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);W=this._updateOverlay(0,V.inner,U,1);U=this._updateOverlay(1,
V.outer,U,X);if(W||U)this._drapeSources.forEach((T,Y)=>this._updateDrapeSource(Y)),this.surface.updateTileOverlayParams(),this._setDrawTexturesDirty();this._placementDirty=!1}};aa._updateOverlay=function(W,U,X,T){if(0===this.renderer.overlays.length)return!1;W=this.renderer.overlays[W];a:{var Y=W.extent;const ea=K.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1E-5*Math.max(U[2]-U[0],U[3]-U[1],Y[2]-Y[0],Y[3]-Y[1]);for(let ia=0;4>ia;ia++)if(Math.abs(Y[ia]-U[ia])>ea){Y=!0;break a}Y=!1}if(!Y&&X===W.resolution&&W.pixelRatio===
T)return!1;x.copy(W.extent,U);W.resolution=X;W.pixelRatio=T;U=x.center(W.extent);W.renderLocalOrigin=F.fromValues(U[0],U[1],0,`OV_${this._latestOriginId++}`);return!0};aa.setTileParameters=function(W){const U=W.renderData.overlay;if(0<this.renderer.overlays.length){const X=this.renderer.overlays[0],T=this.renderer.overlays[1];W=x.intersection(W.extent,this.surface.extent,ca);this._rectInsideRect(X.extent,W)||this._rectanglesOverlap(W,X.extent)||this._rectanglesOverlap(W,T.extent)?(this._setTileOverlayData(W,
0,U),this._setTileOverlayData(W,1,U)):(this._clearTileOverlayData(0,U),this._clearTileOverlayData(1,U))}else this._clearTileOverlayData(0,U),this._clearTileOverlayData(1,U)};aa.overlayPixelSizeInMapUnits=function(W){if(0===this.renderer.overlays.length)return 0;const U=this.renderer.overlays[0],X=this.renderer.overlays[1];W=this._pointIsInExtent(W,U.extent)?U:X;return(W.extent[2]-W.extent[0])/W.resolution};aa._setTileOverlayData=function(W,U,X){if(0!==this.renderer.overlays.length){var T=this.renderer.overlays[U].extent,
Y=x.width(T),ea=x.height(T),ia=W[0];if(this._longitudeCyclical){ia=this._longitudeCyclical.minimalMonotonic(T[0],ia);const la=this._longitudeCyclical.minimalMonotonic(T[0],W[2]);ia>la&&(ia=la-(W[2]-W[0]))}X.setScale(U,x.width(W)/Y,x.height(W)/ea);X.setOffset(U,(ia-T[0])/Y,(W[1]-T[1])/ea)}};aa._clearTileOverlayData=function(W,U){U.setScale(W,-1,-1);U.setOffset(W,-1,-1)};aa.reloadShaders=function(){var W=p._asyncToGenerator(function*(){L.removeLoadedShaderModules();yield this.renderer.reloadShaders();
this.runTask()});return function(){return W.apply(this,arguments)}}();aa._dispatchRendererUpdate=function(W){const U=l.Milliseconds(W.time-this._animationTimeLast);U<G.DESIRED_DRAPED_ANIMATION_MS&&w.isNone(this.forcedAnimationTime)||(this._animationTimeLast=W.time,this.renderer.updateLogic({dt:U,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0))};aa._setDrawTexturesDirty=function(){this.renderer.hasOverlays?this._drawTexturesDirty=!0:this.setPlacementDirty()};
aa._intersectGroundFromView=function(W,U,X,T){X=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(W,Z,U,X);if(w.isNone(X))return!1;U=X.origin;X=h.add(Q,X.origin,X.direction);this._groundIntersector.reset(U,X);this._groundIntersector.intersect([],null,W);this.view.basemapTerrain.intersect(this._groundIntersector,null,U,X);return this._groundIntersector.results.min.getIntersectionPoint(T)};aa._findHorizonBasedPointOfInterest=function(W,U){var X=.5;X=this.view.renderCoordsHelper.getAltitude(W.eye);
const T=this.view.pointsOfInterest.centerOnSurfaceFrequent;var Y=f.clamp(T.estimatedSurfaceAltitude,W.aboveGround?-Infinity:X+1E-5,W.aboveGround?X-1E-5:Infinity);X=W.aboveGround;if("global"===this.view.viewingMode){var ea=Q;A.closestPointOnSilhouette(A.fromRadius(v.getReferenceEllipsoid(this.view.spatialReference).radius+Y),C.wrap(W.eye,W.viewForward),ea);h.subtract(ea,ea,W.eye);Y=H.cyclicalPI.normalize(B.angleAroundAxis(W.viewForward,ea,W.viewRight))/W.fovY+.5;ea=0>=Y||1<=Y?.5:.55;X=X?ea*Y:Y+ea*
(1-Y)}else Y=z.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-W.viewForward[2])),1,0),Y=n.transformMat4(Y,Y,W.projectionMatrix)[1],Y=f.clamp(.5+.5*Y,0,1),X=1===Y||0===Y?.5:X?.55*Y:1-.55*(1-Y);return this._intersectGroundFromView(W,.5,X,U)?h.sqrDist(U,W.eye)<T.distance*T.distance:!1};aa._computeOverlayExtents=function(W,U,X){var T=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,Y=m.create();this._findHorizonBasedPointOfInterest(W,Y)||h.copy(Y,T);var ea=h.distance(W.eye,Y);T=E.viewAngle(this.view.renderCoordsHelper,
T,W.eye);const ia=Math.PI/2-Math.abs(T-Math.PI/2);K.OVERLAY_SHOW_CENTER?(w.isNone(S)&&(S=new M.PointGraphics(this.view.graphics,"red")),S.show(Y,this._renderSR)):w.isSome(S)&&S.hide();this._overlaySREqualsRenderSR||k.projectVectorToVector(Y,this._renderSR,Y,this._spatialReference);T=this.surface.extent;ea=U*W.perRenderPixelRatio*ea/2;var la=!1;let pa=Infinity;this._isSpherical&&w.isSome(T)&&w.isSome(this._spatialReference)&&(this._spatialReference.isWebMercator?(ea/=Math.cos(D.y2lat(Y[1])),pa=T[3]):
(la=!0,ea/=v.getReferenceEllipsoid(this._spatialReference).metersPerDegree,pa=90),ea>=pa&&(ea=pa,Y[1]=0,this._spatialReference.isWebMercator&&(Y[0]=0)));!this._isSpherical&&w.isSome(this._spatialReference)&&this._spatialReference.isGeographic&&(ea/=v.getReferenceEllipsoid(this._spatialReference).metersPerDegree,pa=90);let ua=1;la&&(ua=1/Math.max(.2,Math.cos(Math.abs(f.deg2rad(Y[1])))),180<ea*ua&&(ua=180/ea));la=Math.log(2)/12;ea=Math.exp(Math.round(Math.log(ea)/la)*la);la=ea*ua;const wa=.5*U/(32*
la);U=.5*U/(32*ea);Y[0]=Math.round(Y[0]*wa)/wa;Y[1]=Math.round(Y[1]*U)/U;U=X.inner;U[0]=Y[0]-la;U[1]=Y[1]-ea;U[2]=Y[0]+la;U[3]=Y[1]+ea;this._isSpherical&&this._shiftExtentToFitBounds(U,Infinity,pa);X=X.outer;6*la>x.width(T)?x.copy(X,w.unwrap(T)):ia<=.25*Math.PI?(X[0]=U[0]-la,X[1]=U[1]-ea,X[2]=U[2]+la,X[3]=U[3]+ea):(k.projectVectorToVector(W.eye,this._renderSR,Q,this._spatialReference),t.subtract(P,Y,Q),W=-Math.atan2(P[1],P[0])+.125*Math.PI,0>W&&(W+=2*Math.PI),n.scale(P,R[Math.floor(W/(.25*Math.PI))],
2*ea),P[0]*=ua,P[2]*=ua,n.add(X,U,P));this._isSpherical?(X[0]=this._longitudeCyclical.clamp(X[0]),X[2]=this._longitudeCyclical.clamp(X[2]),X[1]=Math.max(X[1],-pa),X[3]=Math.min(X[3],pa)):(W=x.intersection(U,T,ca),Y=x.intersection(X,T,ba),x.contains(W,Y)&&(X[2]=X[0],X[3]=X[1]))};aa._drawOverlayTextures=function(W){if(0!==W.length&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var U=this._drawOverlay(W[0]);W=this._drawOverlay(W[1]);0!==U&&0!==W||this.surface.updateTileOverlayParams();this._collectUnusedRenderTargetMemory();
this.updateDrapeTargets();this._drawTexturesAnimateDirty=!1;this._drawTexturesDirty?(this._drawTexturesDirty=!1,this.surface.requestRender(),this.surface.requestUpdate()):this.surface.requestRender(0)}};aa._drawOverlay=function(W){this._longitudeCyclical?W.setupGeometryViewsCyclical(this._longitudeCyclical):W.setupGeometryViewsDirect();return W.draw(this.renderer,this.view.state.camera.pixelRatio)};aa._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const W=
performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(W)}};aa._rectanglesOverlap=function(W,U){return w.isNone(W)?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(U[0],U[2],W[0])||this._longitudeCyclical.contains(U[0],U[2],W[2])||this._longitudeCyclical.contains(W[0],W[2],U[0]))&&!(W[1]>U[3]||W[3]<U[1]):x.intersects(W,U)};aa._rectInsideRect=function(W,U){return w.isNone(U)?!1:this._longitudeCyclical?this._longitudeCyclical.contains(W[0],W[2],U[0])&&
this._longitudeCyclical.contains(W[0],W[2],U[2])&&U[1]>W[1]&&U[3]<W[3]:x.contains(W,U)};aa._pointIsInExtent=function(W,U){if(this._longitudeCyclical)return this._longitudeCyclical.contains(U[0],U[2],W.x)&&W.y>=U[1]&&W.y<=U[3];const X=W.x;W=W.y;return X>U[0]&&X<U[2]&&W>U[1]&&W<U[3]};aa._shiftExtentToFitBounds=function(W,U,X){let T=0,Y=0;W[0]<-U?T=W[0]+U:W[2]>U&&(T=U-W[2]);W[1]<-X?Y=W[1]+X:W[3]>X&&(Y=X-W[3]);x.offset(W,T,Y)};p._createClass(fa,[{key:"running",get:function(){return(this._placementDirty||
this._layerViewsDirty)&&(0<this._drapeSources.size||0<this.view.graphics.length||K.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}},{key:"_isSpherical",get:function(){return this.view.state.isGlobal}},{key:"_worldToPCSRatio",get:function(){return w.isSome(this._spatialReference)&&this._spatialReference.isGeographic?v.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}},{key:"view",get:function(){return this.surface.view}},{key:"updating",get:function(){return this.running||
this.renderer.updating}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"test",get:function(){return{renderer:this.renderer,update:()=>this.runTask()}}}]);return fa}(r);b.__decorate([g.property()],a.OverlayManager.prototype,"_spatialReference",void 0);b.__decorate([g.property({readOnly:!0})],a.OverlayManager.prototype,"running",
null);b.__decorate([g.property()],a.OverlayManager.prototype,"_placementDirty",void 0);b.__decorate([g.property()],a.OverlayManager.prototype,"_layerViewsDirty",void 0);b.__decorate([g.property()],a.OverlayManager.prototype,"_isSpherical",null);b.__decorate([g.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);b.__decorate([g.property()],a.OverlayManager.prototype,"renderer",void 0);b.__decorate([g.property({constructOnly:!0})],a.OverlayManager.prototype,"surface",void 0);b.__decorate([g.property({readOnly:!0,
aliasOf:"surface.suspended"})],a.OverlayManager.prototype,"suspended",void 0);b.__decorate([g.property({readOnly:!0})],a.OverlayManager.prototype,"updating",null);b.__decorate([g.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);b.__decorate([g.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=b.__decorate([u.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);const P=z.create(),Q=m.create(),V={inner:x.create(),outer:x.create()},
ca=x.create(),ba=x.create(),Z=C.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/animationUtils":function(){define(["exports","../../../core/time"],function(a,p){const b=p.Milliseconds(40);p=p.Milliseconds(50);a.DESIRED_ANIMATION_FPS=25;a.DESIRED_ANIMATION_MS=b;a.DESIRED_DRAPED_ANIMATION_FPS=20;a.DESIRED_DRAPED_ANIMATION_MS=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports","../../../../core/global"],
function(a,p){a.removeLoadedShaderModules=function(){var b;const r=null==(b=p.require)?void 0:b.modules;if(r){b=Object.keys(r);for(const q of b)-1!==q.search(".glsl")&&delete r[q]}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){l=function(c){function u(h,m,n){var z=c.call(this,u.NumSubdivisionsAtLevel)||this;z.horizontalScaleFactor=1;void 0!==h&&z.init(h,m,n);return z}p._inheritsLoose(u,c);var t=u.prototype;t.init=function(h,m,n){c.prototype.init.call(this,h,m,n);h=n.view.renderSpatialReference;this.horizontalScaleFactor=r.isSome(h)&&w.isPlateCarree(h)&&n.spatialReference.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._edgeLen=(this.extent[2]-this.extent[0])*this.horizontalScaleFactor;
this._edgeLen2=this._edgeLen*this._edgeLen;this.centerAtSeaLevel[0]=b.lerp(this.extent[0],this.extent[2],.5)*this.horizontalScaleFactor;this.centerAtSeaLevel[1]=b.lerp(this.extent[1],this.extent[3],.5)*this.horizontalScaleFactor;this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};t.updateRadiusAndCenter=function(){this._updateCenter();const h=(this.extent[2]-this.extent[0])*Math.SQRT1_2,m=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._center[1][3]=Math.sqrt(h*h+m*m)};t._isVisible=
function(h){return this.intersectsClippingArea&&f.intersectsAABB(h,this._aabb())};t._aabb=function(){return y.wrap(this.extent[0]*this.horizontalScaleFactor,this.extent[1]*this.horizontalScaleFactor,this.elevationBounds[0],this.extent[2]*this.horizontalScaleFactor,this.extent[3]*this.horizontalScaleFactor,this.elevationBounds[1])};t.intersectsRay=function(h,m,n,z,k){d[0]=1/m[0];d[1]=1/m[1];d[2]=1/m[2];m=k*(this.extent[2]-this.extent[0])*.1;return g.intersectAabbInvDirBefore(this._aabb(),h,d,n+m,z)};
t.createGeometry=function(h,m){e.createPlanarGlobePatch(h,this.extent,m,this.horizontalScaleFactor,this.renderData);this.setMemoryDirty()};return u}(l["default"]);l.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];const d=q.create();a.PlanarPatch=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferPool ../support/buffer/InterleavedLayout ./ElevationData ./TerrainConst ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){function c(D,E,G,K){const M=0<(G&2),H=E+(K?1024:0)+(M?2048:0);var J=k.get(H);if(!J){{J=E-1;const L=E-1,N=E*E;var O=2*J+2*L;let R=J*L*6,S=6*O,P=6*(2*J+L-1);K&&(R*=2,S*=2,P*=2);O=65536<N+O?new Uint32Array(R+S):new Uint16Array(R+S);let Q=0,V=0,ca=R,ba,Z;let ha=0;for(let fa=0;fa<=L;fa++){M&&(ha=0===fa?P:fa===L?-P:0);ca+=ha;for(let aa=0;aa<=J;aa++){var I=h(aa,fa,J,L);if(-1<I){var F=0===fa&&aa!==J?1:aa===J&&fa!==L?J+1:fa===L&&0!==aa?-1:0===aa&&0!==fa?-(J+1):0;0!==F&&(ba=
Q,Z=N+I,I=N+(0===aa&&1===fa?0:I+1),F=Q+F,K?(O[ca+0]=ba,O[ca+1]=Z,O[ca+2]=Z,O[ca+3]=I,O[ca+4]=I,O[ca+5]=ba,O[ca+6]=I,O[ca+7]=F,O[ca+8]=F,O[ca+9]=ba,O[ca+10]=ba,O[ca+11]=I,ca+=12):(O[ca+0]=ba,O[ca+1]=Z,O[ca+2]=I,O[ca+3]=I,O[ca+4]=F,O[ca+5]=ba,ca+=6))}++Q;aa<J&&fa<L&&(ba=fa*(J+1)+aa,Z=ba+1,I=Z+(J+1),F=I-1,K?(O[V+0]=ba,O[V+1]=Z,O[V+2]=Z,O[V+3]=I,O[V+4]=I,O[V+5]=ba,O[V+6]=I,O[V+7]=F,O[V+8]=F,O[V+9]=ba,O[V+10]=ba,O[V+11]=I,V+=12):(O[V+0]=ba,O[V+1]=Z,O[V+2]=I,O[V+3]=I,O[V+4]=F,O[V+5]=ba,V+=6))}ca-=ha}J=
new z(O,R,S)}k.set(H,J)}D.indices=J.values;D.numSurfaceIndices=J.numSurfaceIndices;D.numSkirtIndices=J.numSkirtIndices;D.numWithoutSkirtIndices=D.numSurfaceIndices+(G?6*(E-1)*(K?2:1):0)}function u(D,E,G,K){D<K[0]&&(K[0]=D);D>K[3]&&(K[3]=D);E<K[1]&&(K[1]=E);E>K[4]&&(K[4]=E);G<K[2]&&(K[2]=G);G>K[5]&&(K[5]=G)}function t(D,E){const G=E>D?1:0;return 2+4*G+(1-2*G)*(D+E)}function h(D,E,G,K){return 0===E?D:D===G?G+E:E===K?G+K+(G-D):0===D&&0<E?2*G+K+(K-E):-1}const m=e.newLayout().vec3f("position").vec2f("uv0"),
n=new w.BufferPool(D=>m.createBuffer(D),D=>D.count);let z=function(D,E,G){this.values=D;this.numSurfaceIndices=E;this.numSkirtIndices=G};const k=new Map,v=Array(g.MAX_PATCH_TESSELATION+1),x=Array(g.MAX_PATCH_TESSELATION+1),C=Array(g.MAX_PATCH_TESSELATION+1),A=Array(g.MAX_PATCH_TESSELATION+1),B=r.create();a.PatchGeometry=function(){this.vertexAttributes=this.indices=null;this.boundingBox=f.empty();this.skirtLength=this.numVertsPerRow=this.numWithoutSkirtIndices=this.numSkirtIndices=this.numSurfaceIndices=
0;this.uvOffsetAndScale=y.create()};a.clearCaches=function(){n.clear();k.clear()};a.createPlanarGlobePatch=function(D,E,G,K,M){const H=E[0],J=E[1],O=E[2]-H,I=E[3]-J,F=D.clippingArea,L=b.isSome(F)?Math.max(0,(F[0]-E[0])/O):0,N=b.isSome(F)?Math.max(0,(F[1]-E[1])/I):0,R=b.isSome(F)?Math.min(1,(F[2]-E[0])/O):1;E=b.isSome(F)?Math.min(1,(F[3]-E[1])/I):1;const S=R>L?1/(R-L):1,P=E>N?1/(E-N):1,Q=-L*S,V=-N*P,ca=.1*O,ba=D.numVertsPerRow-1,Z=D.numVertsPerRow-1,ha=D.numVertsPerRow*D.numVertsPerRow,fa=n.acquire(ha+
(2*ba+2*Z)),aa=fa.position.typedBuffer,W=fa.uv0.typedBuffer,U=M.geometryInfo.boundingBox;f.empty(U);let X=0;for(let la=0;la<=Z;la++){var T=la/Z;let pa=V+T*P;T=J+T*I;b.isSome(F)&&(T<F[1]?(T=F[1],pa=0):T>F[3]&&(T=F[3],pa=1));for(let ua=0;ua<=ba;ua++){var Y=ua/ba;let wa=Q+Y*S;Y=H+Y*O;b.isSome(F)&&(Y<F[0]?(Y=F[0],wa=0):Y>F[2]&&(Y=F[2],wa=1));var ea=D.samplerData?l.ElevationData.sample(Y,T,D.samplerData)||0:0;Y=Y*K-G[0];const Fa=T*K-G[1];ea-=G[2];u(Y,Fa,ea,U);var ia=g.GEOMETRY_VERTEX_STRIDE*X;aa[ia+0]=
Y;aa[ia+1]=Fa;aa[ia+2]=ea;W[ia+0]=wa;W[ia+1]=pa;ia=h(ua,la,ba,ba);-1<ia&&(ia=g.GEOMETRY_VERTEX_STRIDE*(ha+ia),aa[ia+0]=Y,aa[ia+1]=Fa,aa[ia+2]=ea,W[ia+0]=t(wa,pa),W[ia+1]=ca);++X}}M.geometryInfo.numVertsPerRow=D.numVertsPerRow;M.geometryInfo.vertexAttributes=fa;M.geometryInfo.skirtLength=ca;q.set(M.geometryInfo.uvOffsetAndScale,L,N,R-L,E-N);c(M.geometryInfo,D.numVertsPerRow,0,D.wireframe)};a.createSphericalGlobePatch=function(D,E,G,K,M,H,J,O){var I=M[0];const F=M[1];var L=M[2];M=M[3];const N=.1*J.radius*
(M-F),R=D.numVertsPerRow-1,S=D.numVertsPerRow-1,P=D.numVertsPerRow*D.numVertsPerRow,Q=n.acquire(P+(2*R+2*S)),V=Q.position.typedBuffer,ca=Q.uv0.typedBuffer,ba=K.geometryInfo.boundingBox;f.empty(ba);var Z=E[2]-E[0];const ha=E[3]-E[1];var fa=L-I;L=G[0];const aa=G[1];G=G[2];for(var W=0;W<=R;W++){var U=W/R,X=I+U*fa;v[W]=Math.sin(X);x[W]=Math.cos(X);C[W]=U;A[W]=E[0]+U*Z}I=H&&!!(O&1);Z=H&&!!(O&2);fa=0;for(W=0;W<=S;W++){U=W/S;var T=p.lerp(F,M,U);X=Math.cos(T);const pa=Math.sin(T);H?(T=J.halfSemiMajorAxis*
Math.log((1+pa)/(1-pa)),U=(T-E[1])/ha):T=180*T/Math.PI;for(let ua=0;ua<=R;ua++){const wa=C[ua];var Y=v[ua],ea=x[ua],ia=J.radius;D.samplerData&&(ia+=l.ElevationData.sample(A[ua],T,D.samplerData)||0);ea=ea*X*ia-L;Y=Y*X*ia-aa;ia=pa*ia-G;u(ea,Y,ia,ba);var la=g.GEOMETRY_VERTEX_STRIDE*fa;V[la+0]=ea;V[la+1]=Y;V[la+2]=ia;ca[la+0]=wa;ca[la+1]=U;la=h(ua,W,R,S);if(-1<la){la=g.GEOMETRY_VERTEX_STRIDE*(P+la);const Fa=I&&0===W?-1:Z&&W===S?1:0;ea=0===Fa?ea:-L;Y=0===Fa?Y:-aa;ia=0===Fa?ia:J.radius*Fa-G;V[la+0]=ea;
V[la+1]=Y;V[la+2]=ia;ca[la+0]=0===Fa?t(wa,U):wa;ca[la+1]=0===Fa?N:U;0!==Fa&&u(ea,Y,ia,ba)}++fa}}K.geometryInfo.numVertsPerRow=D.numVertsPerRow;K.geometryInfo.vertexAttributes=Q;K.geometryInfo.skirtLength=N;q.set(K.geometryInfo.uvOffsetAndScale,0,0,1,1);c(K.geometryInfo,D.numVertsPerRow,H?O:0,D.wireframe);K.intersectionData=null};a.intersectSkirtsGlobal=function(D,E,G,K,M,H,J,O,I,F){const L=H.position;H=H.uv0;const N=D[0],R=D[1];D=D[2];const S=E[0]-N,P=E[1]-R;E=E[2]-D;G*=3;for(K*=3;G<K;G+=3){var Q=
M[G],V=M[G+1],ca=M[G+2],ba=L.get(Q,0),Z=L.get(Q,1),ha=L.get(Q,2),fa=L.get(V,0),aa=L.get(V,1),W=L.get(V,2),U=L.get(ca,0),X=L.get(ca,1),T=L.get(ca,2);if(2<=H.get(Q,0)){Q=ba+O[0];var Y=Z+O[1],ea=ha+O[2];const ia=J/Math.sqrt(Q*Q+Y*Y+ea*ea);ba+=Q*ia;Z+=Y*ia;ha+=ea*ia}2<=H.get(V,0)&&(V=fa+O[0],Q=aa+O[1],Y=W+O[2],ea=J/Math.sqrt(V*V+Q*Q+Y*Y),fa+=V*ea,aa+=Q*ea,W+=Y*ea);2<=H.get(ca,0)&&(ca=U+O[0],V=X+O[1],Q=T+O[2],Y=J/Math.sqrt(ca*ca+V*V+Q*Q),U+=ca*Y,X+=V*Y,T+=Q*Y);b.isSome(I)&&([ba,Z,ha]=I.applyToVertex(ba,
Z,ha),[fa,aa,W]=I.applyToVertex(fa,aa,W),[U,X,T]=I.applyToVertex(U,X,T));fa-=ba;aa-=Z;W-=ha;U-=ba;X-=Z;T-=ha;V=P*T-X*E;Q=E*U-T*S;Y=S*X-U*P;ca=fa*V+aa*Q+W*Y;if(!(Math.abs(ca)<=Number.EPSILON)){ba=N-ba;Z=R-Z;ha=D-ha;V=ba*V+Z*Q+ha*Y;if(0<ca){if(0>V||V>ca)continue}else if(0<V||V<ca)continue;Q=Z*W-aa*ha;ha=ha*fa-W*ba;Z=ba*aa-fa*Z;ba=S*Q+P*ha+E*Z;if(0<ca){if(0>ba||V+ba>ca)continue}else if(0<ba||V+ba<ca)continue;ha=(U*Q+X*ha+T*Z)/ca;0<=ha&&(Z=d.computeNormal(fa,aa,W,U,X,T,B),F(ha,Z))}}};a.intersectSkirtsLocal=
function(D,E,G,K,M,H,J,O,I){const F=H.position;H=H.uv0;const L=D[0],N=D[1];D=D[2];const R=E[0]-L,S=E[1]-N;E=E[2]-D;G*=3;for(K*=3;G<K;G+=3){var P=M[G],Q=M[G+1],V=M[G+2],ca=F.get(P,0),ba=F.get(P,1),Z=F.get(P,2),ha=F.get(Q,0),fa=F.get(Q,1),aa=F.get(Q,2),W=F.get(V,0),U=F.get(V,1),X=F.get(V,2);2<=H.get(P,0)&&(Z+=J);2<=H.get(Q,0)&&(aa+=J);2<=H.get(V,0)&&(X+=J);b.isSome(O)&&([ca,ba,Z]=O.applyToVertex(ca,ba,Z),[ha,fa,aa]=O.applyToVertex(ha,fa,aa),[W,U,X]=O.applyToVertex(W,U,X));P=ha-ca;fa-=ba;aa-=Z;W-=ca;
U-=ba;X-=Z;V=S*X-U*E;ha=E*W-X*R;const T=R*U-W*S;Q=P*V+fa*ha+aa*T;if(!(Math.abs(Q)<=Number.EPSILON)){ca=L-ca;ba=N-ba;Z=D-Z;V=ca*V+ba*ha+Z*T;if(0<Q){if(0>V||V>Q)continue}else if(0<V||V<Q)continue;ha=ba*aa-fa*Z;Z=Z*P-aa*ca;ba=ca*fa-P*ba;ca=R*ha+S*Z+E*ba;if(0<Q){if(0>ca||V+ca>Q)continue}else if(0<ca||V+ca<Q)continue;Z=(W*ha+U*Z+X*ba)/Q;0<=Z&&(P=d.computeNormal(P,fa,aa,W,U,X,B),I(Z,P))}}};a.releaseGeometry=function(D){n.release(D.vertexAttributes);D.vertexAttributes=null;D.indices=null};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/geometry/support/buffer/BufferPool":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,p,b){let r=function(){function q(f,w){this._factoryCallback=f;this._lengthCallback=w;this._pool=new Map}var y=q.prototype;y.acquire=function(f){if(!q.test.disabled){var w=this._pool.get(f);if(w&&0!==w.length)return w.pop()}try{return this._factoryCallback(f)}catch(e){w=window.performance&&window.performance.memory;let l=
"";w&&(l=`\n  totalJSHeapSize: ${w.totalJSHeapSize}, usedJSHeapSize: ${w.usedJSHeapSize}, jsHeapSizeLimit: ${w.jsHeapSizeLimit}`);console.log("Array allocation of size "+f+" failed: "+e+l);throw e;}};y.release=function(f){if(!q.test.disabled){var w=this._lengthCallback(f),e=this._pool.get(w);e||(e=new b({shrink:!0}),this._pool.set(w,e));e.push(f)}};y.clear=function(){this._pool.clear()};p._createClass(q,[{key:"test",get:function(){return{size:this._pool.size}}}]);return q}();r.test={disabled:!1};
a.BufferPool=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/promiseUtils ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./tileUtils ../../webgl/Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G){function K(N){N.dispose();N instanceof z?F.release(N):N instanceof k&&I.release(N)}const M=l.create(),H=l.create(),J=l.create(),O=d.create();d=function(){function N(S){this._numSubdivisionAtLevel=S;this.lij=[0,0,0];this._children=[null,null,null,null];this._dirty=!0;this._previouslyRendered=!1;this.extent=u.create();this._elevationBounds=w.create();this.layerInfo=[[],[]];this.extentInRadians=u.create();this.centerAtSeaLevel=l.create();
this._center=[l.create(),t.create(),l.create()];this.up=l.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=-1;this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemory=0}N.prune=function(){I.prune(0);F.prune(0);B.TilePerLayerInfo.prune()};var R=N.prototype;R.init=function(S,P,Q){this.lij[0]=S[0];this.lij[1]=S[1];this.lij[2]=S[2];this.ellipsoid=c.getReferenceEllipsoid(Q.tilingScheme.spatialReference);
Q.tilingScheme.getExtent(S[0],S[1],S[2],this.extent);Q.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;Q.upsampleMapCache.pop(E.tile2str(this));this._edgeLen2=this._edgeLen=0;this._center[1][3]=0;this.vlevel=S?S[0]:0;P&&P.elevationBounds?f.copy(this._elevationBounds,P.elevationBounds):f.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=
0;this._previouslyRendered=this._visible=!1;this._parent=P;this.unsetChildren();this._surface=Q;this.updateVisibility();for(const V of x.LayerClasses){S=Q.numLayers(V);P=this.layerInfo[V];for(const ca of P)ca.release();P.length=S;for(let ca=0;ca<S;ca++)P[ca]=B.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),0===V&&this.findElevationBoundsForLayer(ca,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(Q.tilingScheme.pixelSize,x.MAX_PATCH_TESSELATION)};R.release=function(){C.weakAssert(!this.renderData,
"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(E.tile2str(this));for(const S of x.LayerClasses){for(const P of this.layerInfo[S])P.release();this.layerInfo[S].length=0}this._surface=this._parent=null;this._usedMemory=-1};R.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(E.tile2str(this))};R.unrefMapData=function(){--this._mapDataRefCount;if(this.isCached){const S=this.cachedMemory;0<S&&(this._surface.upsampleMapCache.put(E.tile2str(this),
this,S),this.setMemoryDirty())}};R.setMemoryDirty=function(){this._usedMemory=-1};R._updateMemoryUsed=function(){this._mapTileMemory=this._usedMemory=0;const S=this.cpuImageMemorySize;for(const {data:P}of this.layerInfo[1])P instanceof D?this._mapTileMemory+=G.getGpuMemoryUsage(P.texture):P instanceof HTMLImageElement||P instanceof m.ImageWithType?this._mapTileMemory+=S:P instanceof v&&(this._mapTileMemory+=P.memoryUsage);for(const P of this.layerInfo[0])this._usedMemory+=P.data?S:0;this.renderData&&
(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=G.getGpuMemoryUsage(this.renderData.textureDescriptor));this.isCached&&this._surface.upsampleMapCache.updateSize(E.tile2str(this),this,this.cachedMemory)};R.getUsedMemoryForLayer=function(S,P){P=this.layerInfo[S][P];if(!P||!P.data)return 0;if(1===S&&!this.isCached){S=P.data;if(S instanceof D)return G.getGpuMemoryUsage(S.texture);if(S instanceof HTMLImageElement||S instanceof m.ImageWithType)return this.cpuImageMemorySize;
if(S instanceof h.VectorTile||S instanceof v)return S.memoryUsage}else if(0===S)return this.cpuImageMemorySize;return 0};R.updateScreenDepth=function(S){e.copy(O,this._center[1]);O[3]=1;g.transformMat4(O,O,S);this._screenDepth=0>O[2]?0:O[2]/O[3]};R.shouldSplit=function(S,P,Q){if(r.isSome(S.frustum)&&!this._isVisible(S.frustum))return 0;const V=this.level;e.subtract(M,this._center[1],P);var ca=e.squaredLength(M);let ba=1;e.subtract(H,this._center[0],P);var Z=e.squaredLength(H);Z<ca&&(ca=Z,ba=0);e.subtract(H,
this._center[2],P);Z=e.squaredLength(H);Z<ca&&(ca=Z,ba=2);if(this._edgeLen2>ca&&V<S.maxLod)return 2;ca=Math.sqrt(ca);const ha=this._edgeLen/(S.fovX*ca*2);Z=()=>{const W=V+Math.ceil(-b.log2(S.relativeWidthLimit/ha));return W!==this.vlevel?(this.vlevel=W,4):1};if(1===Q&&1===this._surface.snapLevel-V)return V>=S.maxLod?Z():2;const fa=e.dot(this.up,M);Q=this._elevationBounds[1]-this._elevationBounds[0];const aa=Q/this.edgeLen;return S.aboveGround&&0<fa&&.001>aa&&0<fa/ca-Math.sin(this._curvatureHeight/
(this.edgeLen*Math.SQRT1_2)*Math.PI)-aa?0:ha<S.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,4):0:V>=S.maxLod?Z():6<V&&(e.subtract(H,this._center[ba],P),e.scale(J,this.up,fa),e.subtract(J,J,H),Z=e.squaredLength(J),Z>this.radius*this.radius&&(e.scale(J,J,this.radius/Math.sqrt(Z)),e.add(J,J,this._center[ba]),e.subtract(J,P,J),Math.min(1,(Math.abs(e.dot(J,this.up))+.5*Q+this._curvatureHeight)/e.length(J))*(this._edgeLen/(S.fovY*ca*2))<.1/S.angledSplitBias*S.relativeHeightLimit))?
0:2};R.setChildren=function(S,P,Q,V){C.weakAssert(!!(S&&P&&Q&&V),"Null child passed");this._children[0]=S;this._children[1]=P;this._children[2]=Q;this._children[3]=V};R.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};R.load=function(S){this.refMapData();for(const P of x.LayerClasses)this._createOrUpdateAgents(0,P);S.loadTile(this)};R.unload=function(S){S.unloadTile(this);for(const P of x.LayerClasses){S=this.layerInfo[P];for(const Q of S)Q.loadingAgent&&
Q.loadingAgent!==A.TILE_AGENT_DONE&&(K(Q.loadingAgent),Q.loadingAgent=null),Q.pendingUpdates=0}this.resetPendingUpdate(32);this.resetPendingUpdate(64);this.resetPendingUpdate(128);this.unrefMapData()};R.unloadMapData=function(){const S=this.layerInfo[1];for(const P of S)P.loadingAgent&&P.loadingAgent!==A.TILE_AGENT_DONE&&(K(P.loadingAgent),P.loadingAgent=null),P.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};R.updateClippingStatus=function(S){if(u.equals(S,
this._clippingArea))return!1;var P=this._intersectsClippingArea;const Q=this._isWithinClippingArea;r.isSome(S)?(this._intersectsClippingArea=this.intersectsExtent(S),this._isWithinClippingArea=this._isWithinExtent(S)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=S;this.updateVisibility();S=Q&&this._isWithinClippingArea;P=!Q&&!P&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||S||P||this.setPendingUpdate(32);return!0};R.updateVisibility=
function(){this._dirty=!0;this._surface.setTileTreeDirty()};R.getLayerInfo=function(S,P){return this.layerInfo[P][S]};R.hasLayerData=function(S,P){S=this.layerInfo[P][S];return!(!S||!S.data||S.dataInvalidated)};R.isSuspended=function(S){return this.hasPendingUpdate(2)?!0:0===S?!1:!this.loadable};R.hasPendingUpdate=function(S){return(this._pendingUpdates&S)===S};R.setPendingUpdate=function(S){this._pendingUpdates|=S;2===S||8===S?this._surface.setTileTreeDirty():this._surface.requestUpdate()};R.resetPendingUpdate=
function(S){return this.hasPendingUpdate(S)?(this._pendingUpdates&=~S,!0):!1};R.requestLayerData=function(S,P,Q){const V=this.layerInfo[P][S];if(V.waitingAgents.has(Q))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),Q.tile.lij.toString(),P,S),!0;V.waitingAgents.push(Q);if(V.data&&!V.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),Q.tile.lij.toString(),
P,S),Q.dataArrived(this),!0;if(V.requestPromise)return!0;r.abortMaybe(V.requestAbort);V.requestAbort=y.createAbortController();const ca=this._surface.requestTileData(this,S,P,V.requestAbort);if(!ca)return V.requestAbort=null,!1;S=()=>{V.requestPromise===ca&&(V.requestPromise=null,V.requestAbort=null)};V.requestPromise=ca;ca.then(S,S);return!0};R.hasLij=function(S){return this.lij[0]===S[0]&&this.lij[1]===S[1]&&this.lij[2]===S[2]};R.findByLij=function(S){return this.hasLij(S)?this:this.isLeaf?null:
(S=this._children[0].findByLij(S)||this._children[1].findByLij(S)||this._children[2].findByLij(S)||this._children[3].findByLij(S))?S:null};R.distanceToSquared=function(S){return e.squaredLength(e.subtract(J,this._center[1],S))};R.containsPoint=function(S){const P=this.extent;return S[0]>=P[0]&&S[1]>=P[1]&&S[0]<=P[2]&&S[1]<=P[3]};R.unrequestLayerData=function(S,P,Q){S=this.layerInfo[P][S];P=S.waitingAgents;Q=null!=P.removeUnordered(Q);C.weakAssert(Q,"agent has not requested this piece of map data");
1>P.length&&(S.abortRequest(),this._updateMemoryUsed())};R.dataArrived=function(S,P,Q){S=this.layerInfo[P][S];S.data=Q;S.dataInvalidated=!1;S.waitingAgents.forAll(V=>V.dataArrived(this));S.waitingAgents.clear();this._updateMemoryUsed()};R.dataMissing=function(S,P,Q){Q.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${P}/${S} error ${Q}`);S=this.layerInfo[P][S];S.dataMissing=!0;S.waitingAgents.forAll(V=>V.dataMissing());S.waitingAgents.clear();this._updateMemoryUsed()};R.updateRenderData=
function(S,P){switch(S){case 1:return this.updateTexture(P);case 0:return this.updateGeometry()}};R.updateTexture=function(S){this.renderData&&(this.resetPendingUpdate(0===S?64:128),this.setPendingUpdate(0===S?128:64))};R.updateGeometry=function(){this.setPendingUpdate(32);for(const S of this.layerInfo[0])S.pendingUpdates|=32};R.invalidateLayerData=function(S,P){this.layerInfo[P][S].invalidateSourceData();this.restartAgents(P)};R.computeElevationBounds=function(){f.set(this._elevationBounds,Number.MAX_VALUE,
-Number.MAX_VALUE);const S=this.layerInfo[0];let P=!0;for(const Q of S)r.isSome(Q.elevationBounds)&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],Q.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],Q.elevationBounds.max),Q.elevationBounds.hasNoDataValues||(P=!1));P&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter();this._surface.setTileTreeDirty()};R._updateCenter=
function(){e.scale(J,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));e.add(this._center[1],this.centerAtSeaLevel,J);e.scale(J,this.up,this._elevationBounds[0]);e.add(this._center[0],this.centerAtSeaLevel,J);e.scale(J,this.up,this._elevationBounds[1]);e.add(this._center[2],this.centerAtSeaLevel,J)};R.findElevationBoundsForLayer=function(S,P){const Q=this.layerInfo[0][S];if(!(r.isSome(Q.elevationBounds)&&Q.elevationBounds.level>=P)&&(P=this._surface.layerViewByIndex(S,0),P=C.getLayerWithExtentRange(P),
E.fallsWithinLayer(this,P,!1))){P=L;var V=!1;if(Q.data)S=Q.data,P.min=S.bounds[0],P.max=S.bounds[1],P.hasNoDataValues=S.hasNoDataValues,P.level=this.lij[0],V=!0;else{let ca=0,ba,Z;for(let ha=this._parent;ha&&(!Z||ca<x.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(ca=this.vlevel-ha.level,ba=Z||ba,Z=ha.layerInfo[0][S].data,!Z&&ba&&ca>=x.ELEVATION_DESIRED_RESOLUTION_LEVEL);ha=ha.parent);if(Z=Z||ba)Z.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],P),Infinity!==P.min&&(P.level=Z.level,V=!0)}V&&(r.isNone(Q.elevationBounds)&&
(Q.elevationBounds=new n.ElevationBounds),Q.elevationBounds.copyFrom(P))}};R.modifyLayers=function(S,P,Q){Q=this.layerInfo[Q];for(var V of Q)V.loadingAgent&&V.loadingAgent!==A.TILE_AGENT_DONE&&(K(V.loadingAgent),V.loadingAgent=null),V.waitingAgents.clear();for(V=0;V<Q.length;++V)void 0===S[V]&&Q[V].release();S=Array(...Q);V=P.length;Q.length=V;for(let ca=0;ca<V;ca++){const ba=P[ca];Q[ca]=-1<ba?S[ba]:B.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this._updateMemoryUsed()};R.restartAgents=
function(S){this.renderData&&(this._createOrUpdateAgents(0,S),this.updateRenderData(S,0))};R.updateAgents=function(S){if(this.renderData){const P=this.layerInfo[S];for(const Q of P)Q.loadingAgent===A.TILE_AGENT_DONE&&(Q.loadingAgent=null);this._createOrUpdateAgents(0,S)}};R.updateAgentSuspension=function(){for(const S of x.LayerClasses){const P=this.isSuspended(S);for(const Q of this.layerInfo[S])Q.loadingAgent&&Q.loadingAgent!==A.TILE_AGENT_DONE&&(Q.loadingAgent.setSuspension(P),Q.loadingAgent===
A.TILE_AGENT_DONE&&this.updateRenderData(S,0))}};R.removeLayerAgent=function(S,P){S=this.layerInfo[P][S];S.loadingAgent&&S.loadingAgent!==A.TILE_AGENT_DONE&&S.loadingAgent.dispose();S.loadingAgent=null};R.agentDone=function(S,P){const Q=this.layerInfo[P][S];Q.loadingAgent=A.TILE_AGENT_DONE;Q.data||Q.upsampleInfo||this._createOrUpdateAgents(S+1,P)};R._createOrUpdateAgents=function(S,P){const Q=this.isSuspended(P),V=this.layerInfo[P];for(;S<V.length;++S){const ha=V[S];var ca=!1;const fa=this._surface.layerViewByIndex(S,
P);var ba=C.getLayerWithExtentRange(fa);if(ha.loadingAgent)E.fallsWithinLayer(this,ba,!1)?(ha.loadingAgent!==A.TILE_AGENT_DONE&&ha.loadingAgent.setSuspension(Q),ha.loadingAgent!==A.TILE_AGENT_DONE&&(ca=ha.loadingAgent.update())):ha.dispose();else if(E.fallsWithinLayer(this,ba,!1)){{ca=S;ba=P;var Z=Q;const aa=0===ba?F.acquire():I.acquire();aa.init(this,ca,ba,Z);ca=aa}ha.loadingAgent=ca;(ca=ha.loadingAgent.startLoading())?ha.loadingAgent===A.TILE_AGENT_DONE&&this.setPendingUpdate(32):(K(ha.loadingAgent),
ha.loadingAgent=A.TILE_AGENT_DONE)}ha.loadingAgent===A.TILE_AGENT_DONE&&this.updateRenderData(P,0);if(ca&&fa.isOpaque)break}};R._isWithinExtent=function(S){const P=this.extent;return P[0]>=S[0]&&S[2]>=P[2]&&P[1]>=S[1]&&S[3]>=P[3]};R.intersectsExtent=function(S){const P=this.extent;return P[2]>=S[0]&&S[2]>=P[0]&&P[3]>=S[1]&&S[3]>=P[1]};p._createClass(N,[{key:"usedMemory",get:function(){-1===this._usedMemory&&this._updateMemoryUsed();return this._usedMemory+(this.isCached?0:this.mapTileMemory)}},{key:"cachedMemory",
get:function(){return this.isCached?this.mapTileMemory:0}},{key:"mapTileMemory",get:function(){-1===this._usedMemory&&this._updateMemoryUsed();let S=this._mapTileMemory;for(const {data:P}of this.layerInfo[1])P instanceof h.VectorTile&&(S+=P.memoryUsage);return S}},{key:"isCached",get:function(){return!this.shouldLoad&&0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},{key:"numSubdivisionsAtLevel",get:function(){return this._numSubdivisionAtLevel}},{key:"isWithinClippingArea",
get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},{key:"edgeLen",get:function(){return this._edgeLen}},
{key:"radius",get:function(){return this._center[1][3]}},{key:"screenDepth",get:function(){return this._screenDepth}},{key:"visible",get:function(){if(this._dirty){this._dirty=!1;const S=this._isVisible(this.surface.frustum);S!==this._visible&&(this._visible=S,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension())}return this._visible}},{key:"loadable",get:function(){return this.visible||this._surface.view.state.fixedContentCamera}},{key:"rendered",
get:function(){const S=!!this.renderData;S!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=S,this._surface.renderer.setNeedsRender());return S}},{key:"shouldLoad",get:function(){if(!this.loadable)return!1;if(1===this._surface.lodSnapping){const S=this.level-this._surface.snapLevel;if(0===S)return!0;if(1===S)return!1}return this.isLeaf}},{key:"cpuImageMemorySize",get:function(){const S=this._surface.tilingScheme.pixelSize;return S*S*4}},{key:"updating",
get:function(){if(this.hasPendingUpdates)return!0;for(const S of x.LayerClasses){const P=this.layerInfo[S];for(const Q of P)if(Q.loadingAgent&&Q.loadingAgent!==A.TILE_AGENT_DONE&&Q.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this.cachedMemory}}}]);return N}();const I=new q(k),F=new q(z),L=new n.ElevationBounds;a.SplitLimits=
function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0};a["default"]=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,p,b){return function(r){function q(){var y=r.apply(this,arguments)||this;y._scaleRangeEnabled=!1;return y}a._inheritsLoose(q,r);a._createClass(q,[{key:"_desiredMinLevelDelta",
get:function(){return p.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.level)}},{key:"_progressiveLevelModulo",get:function(){return 0}}]);return q}(b.TileAgent)})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./TerrainConst ./terrainUtils ./tileUtils".split(" "),function(a,p,b,r,q,y){let f=function(){function l(){}var g=l.prototype;g.init=function(d,c,u,t){this.tile=d;this._layerIdx=c;this._layerClass=u;
this._suspended=t;this._tileLayerInfo=d.getLayerInfo(c,u);this._tileRequested=null;d=this._findAncestorWithData();this._setUpsampleTile(d)};g.startLoading=function(){return this._requestNext()};g.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null};g.setSuspension=function(d){d!==this._suspended&&((this._suspended=d)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,
this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};g.update=function(){const d=this._findAncestorWithData();this._setUpsampleTile(d);return this._requestNext()};g.dataArrived=function(d){this._setUpsampleTile(d);this._tileRequested=null;d===this.tile?this.tile.updateRenderData(this._layerClass,0):this._requestNext()};g.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};g._agentDone=function(){this.tile.agentDone(this._layerIdx,
this._layerClass);this.dispose()};g._requestNext=function(){if(this._suspended)return!0;const d=this._findNextDownload();if(this._tileRequested){if(d===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}b.isSome(d)?d.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=d):this._agentDone();return!!this._tileRequested};g._findNextDownload=function(){const d=this._layerIdx,c=this._layerClass;var u=
this.tile.surface.layerViewByIndex(d,c);const t=q.getLayerWithExtentRange(u),{minLevel:h,maxLevel:m}=u.dataLevelRange;u=this._desiredMinLevelDelta;const n=this._progressiveLevelModulo+u,z=this._scaleRangeEnabled?y.fallsWithinLayer:()=>!0;let k=this.tile;const v=k.level;let x;var C=this._tileLayerInfo.upsampleInfo;C=C?C.tile.level:-1;const A=b.get(t,"tilemapCache");for(;k&&z(k,t,!1)&&k.level>=h;){const B=k.level,D=v-B,E=k.layerInfo[c][d];if(E.data&&D>=u){B>C&&this._setUpsampleTile(k);E.dataInvalidated&&
(x=k);break}if((b.isNone(A)||"unavailable"!==A.getAvailability(k.lij[0],k.lij[1],k.lij[2]))&&B<=m&&!E.data&&!E.dataMissing){if(b.isNone(x)||k.level===h||0===B%r.PROGRESSIVE_LOADING_MODULO||v-x.level<u)x=k;if(D>=n)break}k=k.parent}b.isSome(x)&&v-x.level<u&&this._tileLayerInfo.upsampleInfo&&(x=null);return x};g._findAncestorWithData=function(){const d=this.tile.vlevel,c=this._desiredMinLevelDelta;let u;for(let t=this.tile;t;t=t.parent)if(t.hasLayerData(this._layerIdx,this._layerClass)){if(d-t.level>=
c)return t;u=t}return u};g._setUpsampleTile=function(d){this._tileLayerInfo.setUpsampleInfo(this.tile,d);this.tile.updateRenderData(this._layerClass,0)};p._createClass(l,[{key:"updating",get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}]);return l}();var w=function(l){function g(){return l.apply(this,arguments)||this}p._inheritsLoose(g,l);g.prototype.dispose=function(){};p._createClass(g,
[{key:"_desiredMinLevelDelta",get:function(){throw e;}},{key:"_progressiveLevelModulo",get:function(){throw e;}}]);return g}(f);const e=Error("Abstract method called on TileAgent");w=new w;a.TILE_AGENT_DONE=w;a.TileAgent=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray"],function(a,p,b,r){function q(e,l){l(e);if(!e.isLeaf)for(const g of e.children)q(g,
l)}function y(e,l,g){e=e.screenDepth;l=l.screenDepth;return e<l?-g:e>l?g:0}let f=function(){function e(){this._queue=new r;this._last=null;this.remove=()=>{}}var l=e.prototype;l.resetOne=function(g){this._queue.clear();this._queue.push(g);this._last=null};l.reset=function(g=null){this._queue.clear();b.isSome(g)&&this._queue.pushArray(g);this._last=null};l.skipSubtree=function(){this._last=null};l.next=function(){this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children);return this._last=
this._queue.pop()};p._createClass(e,[{key:"done",get:function(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}}]);return e}(),w=function(){function e(){this.q=new r}var l=e.prototype;l.reset=function(g){this.q.clear();if(!b.isNone(g))for(this.q.pushArray(g),g=0;g<this.q.length;++g){const d=this.q.data[g];d.isLeaf||this.q.pushArray(d.children)}};l.next=function(){return this.q.pop()};p._createClass(e,[{key:"done",get:function(){return 0===this.q.length}}]);return e}();a.IteratorPostorder=
w;a.IteratorPreorder=f;a.compareTiles=y;a.computeUpsampleInfo=function(e,l,g){let d=1,c=0,u=0;for(;e!==l;)if(d*=.5,c*=.5,u*=.5,e.lij[2]&1&&(c+=.5),0===(e.lij[1]&1)&&(u+=.5),e=e.parent,null==e)throw Error("tile was not a descendant of upsampleTile");g.init(l,c,u,d)};a.fallsWithinLayer=function(e,l,g){if(b.isNone(l))return!1;const d=l.fullExtent,c=e.extent;if(g){if(c[0]<d.xmin||c[1]<d.ymin||c[2]>d.xmax||c[3]>d.ymax)return!1}else if(d.xmin>c[2]||d.ymin>c[3]||d.xmax<c[0]||d.ymax<c[1])return!1;e=e.surface.tilingScheme.levels[e.lij[0]].scale;
return 0<l.minScale&&e>1.00000001*l.minScale||0<l.maxScale&&e<.99999999*l.maxScale?!1:!0};a.hasLoadableSiblings=function(e){for(let l=0;l<e.length;l++){const g=e[l],d=g.parent;if(d)for(let c=0;4>c;c++){const u=d.children[c];if(u&&u!==g&&u.loadable)return!0}}return!1};a.sortTiles=function(e,l){l.sort((g,d)=>y(g,d,e))};a.sortTilesByPOI=function(e,l){const g=new Map;e.forAll(d=>g.set(d,d.distanceToSquared(l)));e.sort((d,c)=>g.get(d)-g.get(c))};a.tile2str=function(e){return b.isSome(e)?e.lij.toString():
"null"};a.tilesAreRelated=function(e,l){if(!e||!l||e[0]===l[0])return!1;const g=e[0]<l[0],d=g?e:l;e=g?l:e;l=1<<e[0]-d[0];return Math.floor(e[1]/l)===d[1]&&Math.floor(e[2]/l)===d[2]};a.traverseTilesPreorder=function(e,l){if(Array.isArray(e))for(let g=0;g<e.length;g++)q(e[g],l);else q(e,l)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,p,b){return function(r){function q(){var y=
r.call(this)||this;y._scaleRangeEnabled=!0;return y}a._inheritsLoose(q,r);a._createClass(q,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_progressiveLevelModulo",get:function(){return p.PROGRESSIVE_LOADING_MODULO}}]);return q}(b.TileAgent)})},"esri/views/3d/terrain/RasterTile":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../webgl/rasterUtils"],function(a,p,b){const r={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],
factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};return function(){function q(f,w,e=null,l=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.scale=1;this.offset=[0,0];this.opacity=1;this.lij=f;this.source=
w;this.width=e||w.width;this.height=l||w.height}var y=q.prototype;y.bind=function(f){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;this._rasterTexture&&!this._dirty||this._updateRasterTexture(f,this.bandIds);this._rasterTexture&&(this._updateColormapTexture(f),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=b.createTransformTexture(f,this.transformGrid)));return!0};y.getUniforms=function(){const f=b.getBasicGridUniforms(this.scale,this.offset),
{symbolizerParameters:w,transformGrid:e,width:l,height:g,opacity:d}=this,c=b.getCommonUniforms(e,[l,g],[this.source.width,this.source.height],d),u=w.colormap?b.getColormapUniforms(w.colormap,w.colormapOffset):null,t="stretch"===this.symbolizerParameters.type?b.getStretchUniforms(this.symbolizerParameters):null,h="hillshade"===this.symbolizerParameters.type?b.getShadedReliefUniforms(this.symbolizerParameters):null;return{basic:f,common:c,colormap:u,stretch:t,hillshade:h}};y.getTextures=function(){const f=
[],w=[];this._rasterTexture&&(w.push(this._rasterTexture),f.push("u_image"),this._transformGridTexture&&(w.push(this._transformGridTexture),f.push("u_transformGrid")),this._colormapTexture&&(w.push(this._colormapTexture),f.push("u_colormap")));return{names:f,textures:w}};y.release=function(){this._rasterTexture=p.disposeMaybe(this._rasterTexture);this._transformGridTexture=p.disposeMaybe(this._transformGridTexture);this._colormapTexture=p.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=
this.source=null;return!0};y._updateRasterTexture=function(f,w){const e=this.source?this.source.extractBands(w):null;if(e&&e.pixels&&0<e.pixels.length){w=p.isNone(w)&&p.isNone(this.bandIds)||p.isSome(w)&&p.isSome(this.bandIds)&&w.join("")===this.bandIds.join("");if(this._rasterTexture){if(w)return;this._rasterTexture.dispose();this._rasterTexture=null}w=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=b.createRasterTexture(f,e,w,this.isRendereredSource||this.hasStretchTypeNone())}else this._rasterTexture&&
(this._rasterTexture.dispose(),this._rasterTexture=null)};y.hasStretchTypeNone=function(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType};y._getRasterTextureInterpolation=function(f){return"lut"===this.symbolizerParameters.type||"nearest"===f||"majority"===f?"nearest":"bilinear"};y._updateColormapTexture=function(f){const w=this._colormap,e=this.symbolizerParameters.colormap;if(!e)this._colormapTexture&&
(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!w)this._colormapTexture=b.createColormapTexture(f,e),this._colormap=e;else if(e.length!==w.length||e.some((l,g)=>l!==w[g]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=b.createColormapTexture(f,e),this._colormap=e};a._createClass(q,[{key:"source",get:function(){return this._source},set:function(f){this._source=f;this._rasterTexture&&(this._rasterTexture.dispose(),
this._memoryUsed=this._rasterTexture=null)}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?{...r,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||r},set:function(f){this._symbolizerParameters=f}},{key:"bandIds",get:function(){return this._bandIds},set:function(f){p.isSome(f)&&0<f.length?this._bandIds&&f.every((w,e)=>this._bandIds[e]?w===this._bandIds[e]:!1)||(this._bandIds=f,this._dirty=!0):this._bandIds=null}},{key:"interpolation",get:function(){return this._interpolation||
"nearest"},set:function(f){this._interpolation=f;this._rasterTexture&&(f=this._getRasterTextureInterpolation(f),this._rasterTexture.setSamplingMode("bilinear"===f?9729:9728))}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(f){this._transformGrid=f;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)}},{key:"memoryUsage",get:function(){if(p.isNone(this._memoryUsed)){const f=this.getTextures();if(null==f)return 0;
this._memoryUsed=f.textures.map(w=>w.descriptor.width*w.descriptor.height*4).reduce((w,e)=>w+e,0)}return this._memoryUsed}}]);return q}()})},"esri/views/webgl/rasterUtils":function(){define(["exports","./FramebufferObject","./Texture"],function(a,p,b){a.createColormapTexture=function(r,q){return new b(r,{width:q.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1},q)};a.createFrameBuffer=function(r,q,y,f){f=new b(r,{width:q,
height:y,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:9728,dataType:f?5121:5126,wrapMode:33071,flipped:!1});return new p(r,{colorTarget:0,depthStencilTarget:3,width:q,height:y},f)};a.createRasterTexture=function(r,q,y="nearest",f=!1){var w;const e=(f=!(f&&"u8"===q.pixelType))?5126:5121,l=null==q.pixels||0===q.pixels.length?null:f?q.getAsRGBAFloat():q.getAsRGBA(),g=null==(w=r.capabilities.textureFloat)?void 0:w.textureFloatLinear;return new b(r,{width:q.width,height:q.height,target:3553,
pixelFormat:6408,internalFormat:"webgl2"===r.webglVersion&&f?34836:6408,samplingMode:!g||"bilinear"!==y&&"cubic"!==y?9728:9729,dataType:e,wrapMode:33071,flipped:!1},l)};a.createTransformTexture=function(r,q){var y=4*q.size[0],f=q.size[1];const w={width:y,height:f,target:3553,pixelFormat:6408,internalFormat:"webgl2"===r.webglVersion?34836:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1};y=new Float32Array(y*f*4);f=0;for(let e=0;e<q.coefficients.length;e++)y[f++]=q.coefficients[e],2===
e%3&&(y[f++]=1);return new b(r,w,y)};a.getBasicGridUniforms=function(r,q){return{u_scale:r,u_offset:q}};a.getColormapUniforms=function(r,q){return{u_colormapOffset:q||0,u_colormapMaxIndex:r?r.length/4-1:null}};a.getCommonUniforms=function(r,q,y,f=1,w=!0,e=!1){return{u_flipY:w,u_isFloatTexture:e,u_applyTransform:r?!0:!1,u_opacity:f,u_transformSpacing:r?r.spacing:null,u_transformGridSize:r?r.size:null,u_targetImageSize:q,u_srcImageSize:y}};a.getShadedReliefUniforms=function(r){return{u_hillshadeType:r.hillshadeType,
u_sinZcosAs:r.sinZcosAs,u_sinZsinAs:r.sinZsinAs,u_cosZs:r.cosZs,u_weights:r.weights,u_factor:r.factor,u_minValue:r.minValue,u_maxValue:r.maxValue}};a.getStretchUniforms=function(r){return{u_bandCount:r.bandCount,u_minOutput:r.outMin,u_maxOutput:r.outMax,u_minCutOff:r.minCutOff,u_maxCutOff:r.maxCutOff,u_factor:r.factor,u_useGamma:r.useGamma,u_gamma:r.gamma,u_gammaCorrection:r.gammaCorrection}};a.getUniformLocationInfos=function(r,q){r=r.gl;q=q.glName;const y=r.getProgramParameter(q,r.ACTIVE_UNIFORMS),
f=new Map;let w;for(let e=0;e<y;e++)(w=r.getActiveUniform(q,e))&&f.set(w.name,{location:r.getUniformLocation(q,w.name),info:w});return f};a.setTextures=function(r,q,y,f){y.length===f.length&&(f.some(w=>null==w)||y.some(w=>null==w)||y.forEach((w,e)=>{q.setUniform1i(w,e);r.bindTexture(f[e],e)}))};a.setUniforms=function(r,q,y){Object.keys(y).forEach(f=>{var w=q.get(f)||q.get(f+"[0]");if(w){var e=y[f];if(null!==w&&null!=e)switch({info:w}=w,w.type){case 5126:1<w.size?r.setUniform1fv(f,e):r.setUniform1f(f,
e);break;case 35664:r.setUniform2fv(f,e);break;case 35665:r.setUniform3fv(f,e);break;case 35666:r.setUniform4fv(f,e);break;case 35675:r.setUniformMatrix3fv(f,e);break;case 35676:r.setUniformMatrix4fv(f,e);break;case 5124:1<w.size?r.setUniform1iv(f,e):r.setUniform1i(f,e);break;case 35670:r.setUniform1i(f,e?1:0);break;case 35667:case 35671:r.setUniform2iv(f,e);break;case 35668:case 35672:r.setUniform3iv(f,e);break;case 35669:case 35673:r.setUniform4iv(f,e)}}})};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),function(a,p,b,r,q,y,f){let w=function(){function g(){this.waitingAgents=new q;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}g.acquire=function(c){const u=e.acquire();u._init(c);return u};var d=g.prototype;d.release=
function(){this.dispose();l.delete(this);e.release(this)};d.dispose=function(){this.loadingAgent=b.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=y.releaseTileData(this._data)};g.prune=function(){e.prune(0)};d._init=function(c){this.waitingAgents.clear();this._data=y.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=
c;this.elevationBounds=null};d.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};d.abortRequest=function(){this.requestAbort=b.abortMaybe(this.requestAbort);this.requestPromise=null};d._unsetUpsampleInfo=function(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};d.setUpsampleInfo=function(c,u){if(c===u||b.isNone(u))this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=
this._pool.acquire();else{if(this._upsampleInfo.tile===u)return;this._upsampleInfo.tile.unrefMapData()}u.refMapData();f.computeUpsampleInfo(c,u,this._upsampleInfo)}};p._createClass(g,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},{key:"data",get:function(){return this._data},set:function(c){y.releaseTileData(this._data);this._data=c}}]);return g}();const e=new r(w,null,()=>{}),l=new Map;a.TilePerLayerInfo=w;a.printAllocations=function(){0<l.size&&(console.log(`${l.size} live TilePerLayerInfo allocations:`),
l.forEach(g=>console.log(g,"\n")))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function p(r){this._texture=r;this.type="tile-texture";this._refCount=1}var b=p.prototype;b.retain=function(){++this._refCount};b.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};b.generateMipmap=function(){this._texture.generateMipmap()};a._createClass(p,
[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return p}()})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/frustum ../../../geometry/support/plane ./PatchGeometryFactory ./Tile".split(" "),function(a,
p,b,r,q,y,f,w,e,l,g){g=function(u){function t(m,n,z){var k=u.call(this,d)||this;k.obb=Array(8);k.isWebMercator=!1;for(let v=0;8>v;v++)k.obb[v]=q.create();void 0!==m&&k.init(m,n,z);return k}p._inheritsLoose(t,u);var h=t.prototype;h.init=function(m,n,z){u.prototype.init.call(this,m,n,z);this.isWebMercator=z.tilingScheme.spatialReference.isWebMercator;n=this.ellipsoid.radius;z=this.extentInRadians[0];const k=this.extentInRadians[1],v=this.extentInRadians[2],x=this.extentInRadians[3];m=m[0];const C=b.lerp(k,
x,.5),A=b.lerp(z,v,.5);this._edgeLen=(v-z)*Math.cos(0===m?0:Math.min(Math.abs(k),Math.abs(x)))*n;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=n-Math.sqrt(n*n-this._edgeLen2/4);y.lonLatToSphericalPCPF(this.centerAtSeaLevel,A,C,this.ellipsoid.radius,0);n=q.fromArray(this.centerAtSeaLevel);r.normalize(n,n);this.up=n;this._updateOBB();this.updateRadiusAndCenter()};h.updateRadiusAndCenter=function(){if(0===this.lij[0])r.set(this._center[1],0,0,0),r.set(this._center[0],0,0,0),r.set(this._center[2],
0,0,0),this.ellipsoid||(this.ellipsoid=f.getReferenceEllipsoid(this.surface.spatialReference)),this._center[1][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const m=Math.max(r.squaredDistance(this._center[1],this.obb[0]),r.squaredDistance(this._center[1],this.obb[1]));this._center[1][3]=Math.sqrt(m)}};h._isVisible=function(m){if(!this.intersectsClippingArea||!w.intersectsSphere(m,this._center[1]))return!1;if(10>this.lij[0])return!0;const n=this.obb;for(let v=0;6>v;v++){var z=
4===v,k=m[v];z&&(c[0]=k[0],c[1]=k[1],c[2]=k[2],c[3]=k[3]-this.surface.view.state.camera.near);z=z?c:k;for(k=0;8>k;k++){const x=n[k];if(0>z[0]*x[0]+z[1]*x[1]+z[2]*x[2]+z[3])break}if(8===k)return!1}return!0};h.computeElevationBounds=function(){u.prototype.computeElevationBounds.call(this);this._updateOBB()};h.createGeometry=function(m,n){const z=this._isPole(this.lij[1],this.lij[0]);l.createSphericalGlobePatch(m,this.extent,n,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,z);
this.setMemoryDirty()};h._updateOBB=function(){var m=this.extentInRadians;const n=this.obb;for(let z=0;2>z;z++){const k=this.elevationBounds[z];let v=4*z;y.lonLatToSphericalPCPF(n[v++],m[0],m[1],this.ellipsoid.radius,k);y.lonLatToSphericalPCPF(n[v++],m[0],m[3],this.ellipsoid.radius,k);y.lonLatToSphericalPCPF(n[v++],m[2],m[3],this.ellipsoid.radius,k);y.lonLatToSphericalPCPF(n[v++],m[2],m[1],this.ellipsoid.radius,k)}this.isWebMercator&&(m=this._isPole(this.lij[1],this.lij[0]),2===m?(r.set(n[1],0,0,
this.ellipsoid.radius),r.set(n[2],0,0,this.ellipsoid.radius),r.set(n[5],0,0,this.ellipsoid.radius),r.set(n[6],0,0,this.ellipsoid.radius)):1===m&&(r.set(n[0],0,0,-this.ellipsoid.radius),r.set(n[3],0,0,-this.ellipsoid.radius),r.set(n[4],0,0,-this.ellipsoid.radius),r.set(n[7],0,0,-this.ellipsoid.radius)))};h._isPole=function(m,n){let z=0;m===(1<<n)-1&&(z+=1);0===m&&(z+=2);return z};h.intersectsRay=function(m,n,z,k,v){k=this._center[1];z=k[3]+z+.2*this.ellipsoid.radius*Math.abs(v*(this.extentInRadians[3]-
this.extentInRadians[1]));var x=k[0]-m[0];v=k[1]-m[1];m=k[2]-m[2];k=(x*n[0]+v*n[1]+m*n[2])/(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);x=n[0]*k-x;v=n[1]*k-v;n=n[2]*k-m;return x*x+v*v+n*n<z*z};return t}(g["default"]);const d=[128,64,32,16,16,8,8,4],c=e.create();a.SphericalPatch=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../../support/requestImageUtils ./OverlayRenderer ./PatchGeometryFactory ./PatchRenderData ./ScaleRangeQueries ./TerrainConst ./TileRenderer ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/Slice.glsl ../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N,R){function S(aa,W,U){m.set(U,aa[0]*W[2]+W[0],aa[1]*W[3]+W[1],aa[2]*W[2],aa[3]*W[3])}const P=z.create(),Q=n.create();r=function(aa){function W(X){X=aa.call(this,X)||this;X.type="Terrain";X.isGround=!0;X.tileSize=256;X.rctx=null;X._isTransparent=!1;X._scaleRangeQueries=new B.ScaleRangeQueries;X.renderDataPool=new y(A.PatchRenderData);X._patchGroups=new f({allocator:T=>T||{root:null,origin:null,patches:new f},deallocator:T=>
{T.root=null;T.origin=null;T.patches.clear();return T}});X.patchGroupsDirty=!0;X.patchGroupsMap=new Map;X.tileIterator=new G.IteratorPreorder;X.highestVisibleLODTile=null;X.visible=!0;X._opaque=!0;X._skirtScale=1;X._velvetOverground=!0;X.castShadows=!0;X._ssrEnabled=!1;X.emptyTex=null;X.tileRenderer=null;X.tileBackgroundInitialized=!1;X.tileBackgroundUpdating=!1;X.stencilEnabledLayerExtents=[];X.numTrianglesRendered=0;X.numTilesRendered=0;X.numTilesCulled=0;X.numOriginsRendered=0;X.overlayOpacity=
1;X.needsHighlight=!1;X.renderOccludedFlags=1;return X}a._inheritsLoose(W,aa);var U=W.prototype;U.initialize=function(){this.stage.addRenderPlugin([2,7,9],this)};U.destroy=function(){this.stage.removeRenderPlugin(this);C.clearCaches()};U.setDebugScreenSizePerspective=function(X){this.shaderTechniqueConfig.screenSizePerspective!==X&&(this.shaderTechniqueConfig.screenSizePerspective=X,this.setNeedsRender())};U.setRootTiles=function(X){this._rootTiles=X;this.setNeedsRender()};U.setNeedsHighlight=function(X){this.needsHighlight=
X;this.setNeedsRender()};U.setRenderOccludedOverlay=function(X){this.renderOccludedFlags=X?x.overlayRenderOccludedFlag:1;this.setNeedsRender()};U.setStencilEnabledLayerExtents=function(X){this.stencilEnabledLayerExtents=X;this.setNeedsRender()};U.setTileSize=function(X){this.tileSize=X;this.tileRenderer&&(this.tileRenderer.tileSize=X);this.setNeedsRender()};U.loadTile=function(X){X.renderData||(X.renderData=this.renderDataPool.acquire(),X.renderData.init(X),X.renderData.localOrigin=this._getLocalOriginOfTile(X));
this.updateTileGeometry(X);this.updateTileTexture(X,128)};U.queryVisibleLevelRange=function(X,T,Y,ea){this._scaleRangeQueries.queryVisibleLevelRange(X,T,Y,ea);this.setNeedsRender()};U.updateTileTexture=function(X,T){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(X,128===T?0:2),this.setNeedsRender(),X.resetPendingUpdate(T))};U.updateTileGeometry=function(X){for(const T of X.layerInfo[0])T.pendingUpdates&=-33;X.resetPendingUpdate(32);X.renderData.updateGeometry(this.rctx,
this.wireframe)&&this.setNeedsRender()};U.unloadTile=function(X){X.renderData&&(X.renderData.releaseGeometry()&&this.setNeedsRender(),this.renderDataPool.release(X.renderData),X.renderData.clear(),X.renderData=null,X.setMemoryDirty(),this.setNeedsRender())};U._getLocalOriginOfTile=function(X){const T=Math.max(0,7*Math.floor((X.lij[0]-3)/7));if(this.isGlobal&&0===T)return h.ZEROS;for(;X.parent&&X.lij[0]>T;)X=X.parent;return X.centerAtSeaLevel};U.setVisibility=function(X){this.visible=X;this.setNeedsRender()};
U.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};U.setNeedsRender=function(X=1){this.patchGroupsDirty=!0;this.context.requestRender(X)};U.setTileBackground=function(X){this.tileBackground=X;this._updateTileBackground()};U.initializeRenderContext=function(X){this.context=X;this.rctx=X.renderContext.rctx;this.shaderTechniques=X.shaderTechniqueRep;this.shaderTechniqueConfig=
new R.TerrainTechniqueConfiguration;this.tileRenderer=new E.TileRenderer(this.rctx,this.tileSize,this.shaderTechniques);this.tileBackground&&this._updateTileBackground();this.emptyTex=O.createEmptyTexture(this.rctx)};U.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};U.intersect=function(X,T,Y,ea){if(this._rootTiles&&(!X.options.selectOpaqueTerrainOnly||!X.options.selectionMode||
this._opaque)){var ia=ba,la=Z;t.subtract(ia,ea,Y);t.set(la,1/ia[0],1/ia[1],1/ia[2]);var pa=X.results.min,ua=X.results.max,wa=X.results.ground,Fa=0===X.options.store,La=!!X.results.ground.target,Ma,Sa=L.getVerticalOffsetTerrain(X.verticalOffset),Ia=this._skirtScale,va=X.tolerance,ma=Ea=>{var Ca=Ea.renderData.geometryInfo;z.set(P,Ca.boundingBox);const ka=Ea.renderData.localOrigin;q.isSome(Sa)&&(Sa.localOrigin=ka,Sa.applyToAabb(P));const sa=-Ia*Ca.skirtLength;if(0!==sa){var Ja=Ea.up;z.expandWithOffset(P,
sa*Ja[0],sa*Ja[1],sa*Ja[2])}t.subtract(ha,Y,ka);if(N.intersectAabbInvDirBefore(P,ha,la,va,Fa&&null!=pa.dist?pa.dist:Infinity)){var Ta=(Pa,Qa,na,Aa)=>{Pa.set(void 0,G.tile2str(Qa),na,Aa,u.IDENTITY,void 0);Pa.intersector="TerrainRenderer";Pa.target={type:"external",metadata:{tile:Qa}}};Ja=(Pa,Qa)=>{0<=Pa&&(X.options.backfacesTerrain||0>t.dot(Qa,ia))&&(X.options.invisibleTerrain||!X.options.selectionMode||null==T||T(Y,ea,Pa))&&((null==wa.dist||Pa<wa.dist)&&Ta(wa,Ea,Pa,Qa),X.options.isFiltered||(2===
X.options.store&&(q.isNone(Ma)?(Ma=new I.IntersectorResult(X.ray),Ta(Ma,Ea,Pa,Qa),X.results.all.push(Ma)):Pa<Ma.dist&&Ta(Ma,Ea,Pa,Qa)),(null==pa.dist||Pa<pa.dist)&&Ta(pa,Ea,Pa,Qa),0!==X.options.store&&(null==ua.dist||Pa>ua.dist)&&Ta(ua,Ea,Pa,Qa)))};var da=fa;t.subtract(da,ea,ka);var qa=Ca.indices,ra=Ca.vertexAttributes,Da={data:ra.getField("position",k.BufferViewVec3f).typedBuffer,size:3,stride:ra.stride/4};Ca=Ca.numWithoutSkirtIndices/3;if(!q.isSome(Sa)&&Ca>K.componentMinimalSizeForIntersectionData){const Pa=
Ea.renderData;q.isSome(Pa.intersectionData)||(Pa.intersectionData=new K.ComponentIntersectionData(qa,0,Ca,Da));Pa.intersectionData.intersectRay({r0:ha,r1:da},Ja)}else N.intersectTriangles(ha,da,0,Ca,qa,Da,null,Sa,Ja);0!==sa&&(Da=qa.length/3,this.isGlobal?C.intersectSkirtsGlobal(ha,da,Ca,Da,qa,ra,sa,ka,Sa,Ja):C.intersectSkirtsLocal(ha,da,Ca,Da,qa,ra,sa,Sa,Ja))}},ta=this._rootTiles;q.isSome(ta)&&(()=>{const Ea=this.tileIterator;for(const ka of ta)for(Ea.resetOne(ka);!Ea.done;){const sa=Ea.next();var Ca;
if(Ca=sa.visible||X.options.invisibleTerrain&&sa.intersectsClippingArea){{Ca=sa;const Ja=Fa&&null!=pa.dist?pa.dist:Infinity;Ca=q.isSome(Sa)||Ca.intersectsRay(Y,ia,va,Ja,Ia)}}Ca?null==sa.renderData||La&&this._useStencilForTile(sa)||ma(sa):Ea.skipSubtree()}})()}};U.render=function(X){if(9===X.slot){if(0===(X.renderOccludedMask&x.overlayRenderOccludedFlag))return!1}else if(X.slot!==(this.opaque?2:7))return!1;var T=X.pass;const Y=1===X.scenelightingData.globalFactor,ea=this._updatePatchGroups();switch(T){case 0:T=
X.shadowMap&&X.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==T&&(this.shaderTechniqueConfig.receiveShadows=T);T=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==T&&(this.shaderTechniqueConfig.overlayMode=T);this._renderMaterialPass(X,0,ea,9===X.slot?3:1);break;case 4:case 6:this.castShadows&&Y&&this._renderAuxiliaryPass(X,3,ea,0);break;case 2:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(X,1,
ea,0);break;case 3:this._renderAuxiliaryPass(X,2,ea,0);break;case 5:this.needsHighlight&&(this._renderAuxiliaryPass(X,4,ea,2),X.rctx.clearSafe(256))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender();return!0};U._renderMaterialPass=function(X,T,Y,ea){const {rctx:ia,camera:la}=X;this._ssrEnabled=X.ssrParams.ssrEnabled;this._setTerrainTechnique(T,3===ea);const pa=this.shaderTechnique.program;ia.useProgram(pa);0!==this.shaderTechniqueConfig.overlayMode&&1===ea&&X.ssrParams&&H.bindSSRUniforms(pa,
X.ssrParams);X.shadowMap.bind(pa);X.ssaoHelper.bind(pa,X.camera);this._bindOverlayData(pa,ea);pa.setUniformMatrix4fv("viewNormal",la.viewInverseTransposeMatrix);J.bindProjectionMatrix(pa,la.projectionMatrix);X.scenelightingData.setUniforms(pa,!0);T=la.viewMatrix;t.set(ca,T[12],T[13],T[14]);t.normalize(ca,ca);pa.setUniform3fv("viewDirection",ca);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._scaleRangeQueries.prepareQueries();this.opaque?this._renderPatchGroups(X,
pa,Y,ea):X.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(X,pa,Y,ea),X.offscreenRenderingHelper.tmpColor,X.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._scaleRangeQueries.processQueries()};U._renderAuxiliaryPass=function(X,T,Y,ea){this._setTerrainTechnique(T,3===ea);T=this.shaderTechnique.program;X.rctx.useProgram(T);if(5===X.pass){const ia=X.offscreenRenderingHelper;T.bindTexture(ia.depthTexture,"depthTex");T.setUniform4f("highlightViewportPixelSz",0,0,1/ia.width,1/ia.height)}else T.setUniformMatrix4fv("viewNormal",
X.camera.viewInverseTransposeMatrix),2!==X.pass&&4!==X.pass&&6!==X.pass||T.setUniform2fv("nearFar",X.camera.nearFar);this._renderPatchGroupsAuxiliary(X,T,Y,ea)};U._updateTileBackground=function(){if(this.tileRenderer){this.tileBackgroundUpdating=!0;var X=()=>{this.tileBackgroundInitialized=!0;this.tileBackgroundUpdating=!1;this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid;this.shaderTechniqueConfig.hasBackgroundColor=!this.tileRenderer.backgroundIsGrid&&!!q.isSome(this.tileRenderer.backgroundColor);
this.allTiles.forAll(T=>this.tileRenderer.updateTileTexture(T,0));this.setNeedsRender()};if("string"===typeof this.tileBackground){const T=this.tileBackground;v.requestImage(T).then(Y=>{T===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(Y,this.tileBackground===D.DEFAULT_TILE_BACKGROUND),X())})}else{const T=this.tileBackground?b.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(T,!1);X()}}};U._updatePatchGroups=function(){const X=this._patchGroups;
if(!this.patchGroupsDirty)return X;this.highestVisibleLODTile=null;this._renderCollectOrigins(X);if(0!==this.renderOrder){for(let T=0;T<X.length;T++)G.sortTiles(this.renderOrder,X.data[T].patches);X.sort((T,Y)=>{var ea=this.renderOrder;T=0===T.patches.length?-ea:0===Y.patches.length?ea:G.compareTiles(T.patches.data[0],Y.patches.data[0],ea);return T})}this.patchGroupsDirty=!1;return X};U._renderCollectOrigins=function(X){var T=this._rootTiles;if(!q.isNone(T)){var Y=this.isGlobal;X.clear();for(const ea of T)T=
X.pushNew(),T.root=ea,T.origin=Y?h.ZEROS:ea.centerAtSeaLevel,T.patches.clear(),this._renderCollectOriginsForRoot(X,T);X.filterInPlace(ea=>0<ea.patches.length)}};U._renderCollectOriginsForRoot=function(X,T){const Y=this.tileIterator;Y.resetOne(T.root);const ea=this.patchGroupsMap;ea.clear();for(ea.set(T.origin,T);!Y.done;){T=Y.next();var ia=T.renderData;if(ia&&!T.visible)this.numTilesCulled++,Y.skipSubtree();else{if(0===T.lij[0]%7){const la=X.pushNew();la.root=T;la.origin=T.centerAtSeaLevel;ea.set(T.centerAtSeaLevel,
la);la.patches.clear()}if(!T.rendered)this.numTilesCulled++;else if(ia){(ia=ea.get(ia.localOrigin))&&ia.patches.push(T);if(!this.highestVisibleLODTile||T.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=T;Y.skipSubtree()}}}};U._useStencilForTile=function(X){for(const T of this.stencilEnabledLayerExtents)if(X.intersectsExtent(T))return!0;return!1};U._renderPatchGroupsAuxiliary=function(X,T,Y,ea){this.shaderTechnique.bindPipelineState(X.rctx);const ia=0<this.stencilEnabledLayerExtents.length;
T.setUniformMatrix4fv("proj",X.camera.projectionMatrix);T.setUniform1f("skirtScale",this._skirtScale);0!==ea&&this._bindOverlayData(T,ea);for(let la=0;la<Y.length;la++){const pa=Y.data[la];this._bindPatchGroupData(T,pa,X.camera.eye,X.camera.viewMatrix);for(let ua=0;ua<pa.patches.length;ua++)this._renderPatch(X.rctx,T,pa.patches.data[ua],4,ia,ea)}X.rctx.bindVAO(null)};U._renderPatchGroups=function(X,T,Y,ea){const ia=X.rctx,la=X.camera,pa=la.viewMatrix;this.shaderTechnique.bindPipelineState(ia);if(this.shaderTechniqueConfig.screenSizePerspective&&
this.pointsOfInterest){var ua=F.getSettings(this.stage.viewingMode,this.ellipsoidRadius);ua.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:la.fovY});N.bindScreenSizePerspective(ua,T,"screenSizePerspective")}ua=0<this.stencilEnabledLayerExtents.length;const wa=3===ea;wa&&(T.bindTexture(this.emptyTex,"tex"),T.setUniform1f("blend",1),T.setUniform4fv("texOffsetAndScale",n.ZEROS));var Fa=q.isSome(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:h.ZEROS;
this.shaderTechniqueConfig.hasBackgroundColor&&T.setUniform3fv("backgroundColor",Fa);T.setUniform1f("skirtScale",wa?0:this._skirtScale);Fa=this.wireframe?1:4;this.shaderTechniqueConfig.textureFadingEnabled&&T.bindTexture(this.emptyTex,"texNext");for(let Sa=0;Sa<Y.length;Sa++){var La=Y.data[Sa];const Ia=La.patches;this._bindPatchGroupData(T,La,la.eye,pa);M.bindSliceUniforms(T,this.shaderTechnique.configuration,X.sliceHelper&&X.sliceHelper.plane,La.origin);X.shadowMap&&X.shadowMap.bindView(T,La.origin);
this.numOriginsRendered++;for(La=0;La<Ia.length;La++){const va=Ia.data[La];var Ma=va.renderData.textureReference;if(!q.isNone(Ma)){if(!wa){this._scaleRangeQueries.scaleQueriesForTile(va);S(va.renderData.geometryInfo.uvOffsetAndScale,Ma.offsetAndScale,Q);T.setUniform4fv("texOffsetAndScale",Q);T.bindTexture(Ma.texture.texture,"tex");const ma=va.renderData.textureFadeFactor,ta=1>ma?va.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&q.isSome(ta)&&1>ma?(S(va.renderData.geometryInfo.uvOffsetAndScale,
ta.offsetAndScale,Q),T.setUniform1f("fadeFactor",ma),T.setUniform4fv("nextTexOffsetAndScale",Q),T.setUniform3fv("nextTexOpacities",ta.opacities),T.bindTexture(ta.texture.texture,"texNext")):T.setUniform1f("fadeFactor",1);va.renderData.textureIsFading&&this.setNeedsRender();T.setUniform3fv("textureOpacities",Ma.opacities)}Ma=this._renderPatch(ia,T,va,Fa,ua,ea);va.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=Ma/3}}}ia.bindVAO(null)};U._renderPatch=function(X,
T,Y,ea,ia,la){if(q.isNone(Y.renderData.vao.indexBuffer))return 0;0!==la&&this._bindOverlayPatchData(T,Y.renderData.overlay);ia&&(this._useStencilForTile(Y)?this.stencilShaderTechnique.bindPipelineState(X):this.shaderTechnique.bindPipelineState(X));ia=0===this._skirtScale?Y.renderData.geometryInfo.numWithoutSkirtIndices:Y.renderData.vao.indexBuffer.size;X.bindVAO(Y.renderData.vao);T.assertCompatibleVertexAttributeLocations(Y.renderData.vao);X.drawElements(ea,ia,Y.renderData.vao.indexBuffer.indexType,
0);return ia};U._bindPatchGroupData=function(X,T,Y,ea){X.setUniform3fv("origin",T.origin);c.translate(V,ea,T.origin);X.setUniformMatrix4fv("view",V);X.setUniform3f("camPos",Y[0]-T.origin[0],Y[1]-T.origin[1],Y[2]-T.origin[2])};U._bindOverlayData=function(X,T){if(0!==this.shaderTechniqueConfig.overlayMode){X.setUniform1f("overlayOpacity",this.overlayOpacity);var Y=this.overlayRenderer.overlays;if(0<Y.length){Y=Y[0];const ea=Y.getColorTexture(T);X.bindTexture(q.isSome(ea)?ea:this.emptyTex,"ovColorTex");
2===this.shaderTechniqueConfig.overlayMode&&(T=Y.getNormalTexture(T),X.bindTexture(q.isSome(T)?T:this.emptyTex,"ovWaterTex"))}}};U._bindOverlayPatchData=function(X,T){X.setUniform4fv("overlayTexOffset",T.offsets);X.setUniform4fv("overlayTexScale",T.scales)};U._setTerrainTechnique=function(X,T){this.shaderTechniqueConfig.output=X;0===X&&(this.shaderTechniqueConfig.atmosphere=this.isGlobal&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled);this.shaderTechniqueConfig.renderOccluded=
T;this.shaderTechniqueConfig.stencilEnabled=!1;this.shaderTechnique=this.shaderTechniques.releaseAndAcquire(R.TerrainTechnique,this.shaderTechniqueConfig,this.shaderTechnique);this.shaderTechniqueConfig.stencilEnabled=!0;this.stencilShaderTechnique=this.shaderTechniques.releaseAndAcquire(R.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)};a._createClass(W,[{key:"isGlobal",get:function(){return 1===this.stage.viewingMode}},{key:"updating",get:function(){return!this.tileBackgroundInitialized||
this.tileBackgroundUpdating}},{key:"canRender",get:function(){return this.visible&&!!this._rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(X){this._set("renderingDisabled",!!X);this.setNeedsRender()}},{key:"opaque",get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},set:function(X){this._opaque!==X&&(this._opaque=X,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this.overlayRenderer.hasWater}},
{key:"isTransparent",get:function(){return this._isTransparent},set:function(X){this._isTransparent!==X&&(this._isTransparent=X,this.setNeedsRender())}},{key:"skirtScale",get:function(){return this._skirtScale},set:function(X){X!==this._skirtScale&&(this._skirtScale=X,this.setNeedsRender())}},{key:"renderPatchBorders",get:function(){return!!this.shaderTechniqueConfig.tileBorders},set:function(X){this.shaderTechniqueConfig.tileBorders!==X&&(this.shaderTechniqueConfig.tileBorders=X,this.setNeedsRender(),
this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(X){this.shaderTechniqueConfig.backfaceCullingEnabled!==X&&(this.shaderTechniqueConfig.backfaceCullingEnabled=X,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(X){this._set("renderOrder",X);this.setNeedsRender()}},{key:"velvetOverground",set:function(X){this._velvetOverground!==X&&(this._velvetOverground=X,
this.setNeedsRender())}},{key:"intersectionHandlerId",get:function(){return L.TERRAIN_ID}},{key:"slicePlane",get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(X){this.shaderTechniqueConfig.slicePlaneEnabled!==X&&(this.shaderTechniqueConfig.slicePlaneEnabled=X,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(X){this.shaderTechniqueConfig.textureFadingEnabled!==X&&(this.shaderTechniqueConfig.textureFadingEnabled=X,this.setNeedsRender())}},{key:"wireframe",
set:function(X){this._get("wireframe")!==X&&(this._set("wireframe",X),this.allTiles.forAll(T=>{var Y;return null==(Y=T.renderData)?void 0:Y.updateGeometry(this.rctx,X)}),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]);return W}(r);p.__decorate([w.property()],r.prototype,"tileBackgroundInitialized",void 0);p.__decorate([w.property()],r.prototype,"tileBackgroundUpdating",void 0);p.__decorate([w.property({constructOnly:!0})],r.prototype,"overlayRenderer",
void 0);p.__decorate([w.property({constructOnly:!0})],r.prototype,"stage",void 0);p.__decorate([w.property({readOnly:!0})],r.prototype,"isGlobal",null);p.__decorate([w.property({constructOnly:!0})],r.prototype,"allTiles",void 0);p.__decorate([w.property({constructOnly:!0})],r.prototype,"ellipsoidRadius",void 0);p.__decorate([w.property({readOnly:!0})],r.prototype,"updating",null);p.__decorate([w.property({value:!1})],r.prototype,"renderingDisabled",null);p.__decorate([w.property()],r.prototype,"renderPatchBorders",
null);p.__decorate([w.property()],r.prototype,"cullBackFaces",null);p.__decorate([w.property({value:1})],r.prototype,"renderOrder",null);p.__decorate([w.property()],r.prototype,"wireframe",null);p=r=p.__decorate([d.subclass("esri.views.3d.terrain.TerrainRenderer")],r);const V=u.create(),ca=h.create(),ba=h.create(),Z=h.create(),ha=h.create(),fa=h.create();return p})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./PatchGeometryFactory ./TerrainConst ./TextureFader ./TileOverlayData ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){let h=function(){function m(){this.geometryInfo=new w.PatchGeometry;this.intersectionData=null;this._textureRef=new l(()=>this.tile.surface.textureFadeDuration);this.overlay=new g}var n=m.prototype;n.init=function(z){this.tile=z;this.clear();z=this.geometryInfo;z.indices=null;z.vertexAttributes=null;y.empty(z.boundingBox);z.numSurfaceIndices=0;z.numSkirtIndices=0;z.numWithoutSkirtIndices=0;z.numVertsPerRow=0;this.intersectionData=null;this.geometryState={numVertsPerRow:0,
samplerData:null,clippingArea:null,wireframe:!1};this.localOrigin=null;this.overlay.clear()};n.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear()};n.updateGeometry=function(z,k){if(!this._updateGeometryState(k))return!1;this._releaseGeometry();this._createGeometry(z);return!0};n.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0):!1};n.ensureTexture=function(z,k){q.isSome(this._texture)&&
this._texture.descriptor.width!==z&&this.releaseTexture();q.isNone(this._texture)&&(this._texture=k(),this.tile.setMemoryDirty());return this._texture};n.releaseTexture=function(){q.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};n._updateGeometryState=function(z){const k=this._getElevationInfo();var v=this.tile.level,x=8>v?this.tile.numSubdivisionsAtLevel[v]+1:2;k.samplerData&&(x=this.tile.maxTesselation,x=r.clamp((x>>Math.max(v-k.maxTileLevel,e.ELEVATION_DESIRED_RESOLUTION_LEVEL-
(this.tile.vlevel-v)))+1,2,x+1));v=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)v=null;const C=this.geometryState;let A=!1;C.numVertsPerRow!==x&&(C.numVertsPerRow=x,A=!0);k.changed&&(C.samplerData=k.samplerData,A=!0);b.equals(C.clippingArea,v)||(C.clippingArea=v,A=!0);C.wireframe!==z&&(C.wireframe=z,A=!0);return A};n._createGeometry=function(z){this.tile.createGeometry(this.geometryState,this.localOrigin);const k=this.geometryInfo.vertexAttributes,v=
this.geometryInfo.indices,x=z.gl;this._vao=new t(z,c.Default3D,{geometry:f.glLayout(k.layout)},{geometry:u.createVertex(z,x.STATIC_DRAW,k.buffer)},u.createIndex(z,x.STATIC_DRAW,v))};n._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;w.releaseGeometry(this.geometryInfo);return!0};n.setTextureReference=function(z,k=0){z!==this._texture&&this.releaseTexture();this._textureRef.push(z,k)};n._getElevationInfo=function(){const z=this.geometryState.samplerData,k=this.tile.layerInfo[0],
v=k.length;let x=Array(v),C=0;var A=0;let B=!1;for(let G=0;G<v;G++){var D=k[G];if(D.upsampleInfo){D=D.upsampleInfo.tile;var E=D.layerInfo[0][G].data;E=E&&E.samplerData;z&&z[C]===E||(B=!0);x[C++]=E;A=Math.max(A,D.lij[0])}else D.data&&(E=this.tile.surface.layerViewByIndex(G,0),d.fallsWithinLayer(this.tile,E.layer,!1)&&(A=D.data,z&&z[C]===A.samplerData||(B=!0),x[C++]=A.samplerData,A=this.tile.lij[0]))}z&&z.length!==C&&(B=!0);0<C?x.length=C:x=null;return{changed:B,samplerData:x,maxTileLevel:A}};p._createClass(m,
[{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength}},{key:"textureDescriptor",
get:function(){return q.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return m}();a.PatchRenderData=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TextureFader":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe"],function(a,p){return function(){function b(q){this._getFadeDuration=q;this._delayedTime=this._fadeStart=0}var r=b.prototype;r.clear=function(){this._current=
p.destroyMaybe(this._current);this._next=p.destroyMaybe(this._next);this._waiting=p.destroyMaybe(this._waiting);this._delayed=p.destroyMaybe(this._delayed)};r.push=function(q,y=0){this._delayed=p.destroyMaybe(this._delayed);this._push(q,y)};r._push=function(q,y){this._isFadingEnabled||this.clear();if(p.isNone(this._current))this._current=q;else{var f=performance.now();0!==y?(this._delayed=q,this._delayedTime=f+y):p.isNone(this._next)?(this._next=q,this._fadeStart=this._alignFadeStart(f)):p.isNone(q)||
(p.destroyMaybe(this._waiting),this._waiting=q)}};r._alignFadeStart=function(q){const y=this._getFadeDuration();return q+y-q%y};a._createClass(b,[{key:"current",get:function(){if(p.isNone(this._current))return null;if(!this._isFadingEnabled){var q=this._delayed||this._waiting||this._next||this._current;q!==this._current&&(this._current=null,this.clear(),this._current=q)}q=0;p.isSome(this._delayed)&&(q=performance.now(),q>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null));if(p.isSome(this._next)){q=
q||performance.now();var y=this._fadeDuration;const f=p.isSome(this._current)&&this._next.texture===this._current.texture,w=0!==this._next.type;y=q-this._fadeStart>=y;if(f||w||y)p.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(q)}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(p.isNone(this._next))return 1;const q=Math.max(0,performance.now()-this._fadeStart),
y=this._fadeDuration;return q>y?0:1-q/y}},{key:"isFading",get:function(){return p.isSome(this._next)||p.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return p.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFadingEnabled",get:function(){return 0<this._getFadeDuration()}}]);return b}()})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function p(){this._scales=[-1,
-1,-1,-1];this._offsets=[-1,-1,-1,-1]}var b=p.prototype;b.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1};b.setScale=function(r,q,y){this._scales[2*r]=q;this._scales[2*r+1]=y};b.setOffset=function(r,q,y){this._offsets[2*r]=q;this._offsets[2*r+1]=y};a._createClass(p,[{key:"scales",get:function(){return this._scales}},{key:"offsets",get:function(){return this._offsets}}]);return p}()})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define(["exports",
"../../../core/ObjectPool","../../../core/PooledArray","../../../chunks/vec4","../../../chunks/vec4f64"],function(a,p,b,r,q){let y=function(){this.extent=q.create();this.maxLevel=this.minLevel=0;this.callback=null},f=function(){function w(){this._queries=new b({initialSize:10});this._queriesInvPtr=0;this._queryQueue=new b({initialSize:30});this._queryPool=new p(y)}var e=w.prototype;e.queryVisibleLevelRange=function(l,g,d,c){const u=this._queryPool.acquire();r.copy(u.extent,l);u.minLevel=g?g:-Number.MAX_VALUE;
u.maxLevel=null!=d?d:Number.MAX_VALUE;u.callback=c;this._queryQueue.push(u)};e.hasPendingQueries=function(){return 0!==this._queryQueue.length};e.prepareQueries=function(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const l=this._queryQueue.pop();this._queries.push(l)}this._queriesInvPtr=this._queries.length};e.processQueries=function(){for(let l=0;l<this._queries.length;l++){const g=this._queries.data[l];this._queryPool.release(g);g.callback(l>=this._queriesInvPtr);
g.callback=null}this._queries.clear()};e.scaleQueriesForTile=function(l){const g=l.lij[0];let d=0;for(;d<this._queriesInvPtr;){const c=this._queries.data[d],u=c.extent;g>=c.minLevel&&g<=c.maxLevel&&u[0]<=l.extent[2]&&u[2]>=l.extent[0]&&u[1]<=l.extent[3]&&u[3]>=l.extent[1]?(this._queries.swapElements(d,this._queriesInvPtr-1),this._queriesInvPtr--):d++}};return w}();a.ScaleRangeQueries=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../layers/support/layerUtils ../../webgl/BufferObject ../../webgl/FramebufferObject ../../../core/has ../../webgl/checkWebGLError ../../webgl/enums ../../../chunks/builtins ../../webgl/renderState ../../webgl/Texture ../../webgl/VertexArrayObject ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ../support/StreamDataLoader ./BlendLayersTechnique ./RasterColorizerTechnique ./terrainUtils ./TextureReference ./TileTexture ./support/FBOPool ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K){function M(I,F,L){L.layerIndex=F;const N=I.layerInfo[1][F];return N.data?(q.set(L.offset,0,0),L.tile=I,L.scale=1,L.sourceLod=I.lij,L.sourceLayerInfo=N,L):(I=N.upsampleInfo)?(F=I.tile.layerInfo[1][F],L.tile=I.tile,q.copy(L.offset,I.offset),L.scale=I.scale,L.sourceLod=I.tile.lij,L.sourceLayerInfo=F,L):null}l=function(){function I(L,N,R){this._rctx=L;this.tileSize=N;this._backgroundIsGrid=!1;this._blackTex=this._backgroundColor=this._backgroundTexture=
null;this._vectorTileHelper=new z.VectorTileRendererHelper3D;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._vaoQuad=G.createQuadVAO(this._rctx,E.Pos2Tex);L=new v.BlendLayersTechniqueConfiguration;L.mode=2;this._blendLayersTechnique=R.acquire(v.BlendLayersTechnique,L);L.mode=1;this._applyOpacityTechnique=R.acquire(v.BlendLayersTechnique,L);this._techniqueRep=R;this._blackTex=new B(G.createColorTexture(this._rctx,[0,0,0,1]));this._fboPool=new D.FBOPool(this._rctx)}var F=I.prototype;
F.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null);this._vaoQuad=r.disposeMaybe(this._vaoQuad);this._backgroundTexture=r.releaseMaybe(this._backgroundTexture);this._blackTex=r.releaseMaybe(this._blackTex);this._blendLayersTechnique=r.disposeMaybe(this._blendLayersTechnique);this._applyOpacityTechnique=r.disposeMaybe(this._applyOpacityTechnique);this._vectorTileHelper=r.disposeMaybe(this._vectorTileHelper)};F.updateTileTexture=function(L,N){var R=L.layerInfo[1];for(var S of R)S.pendingUpdates&=
-1;if(L.renderData){for(var P=L.surface,Q=P.baseOpacity,V=S=0,ca=this.tileSize,ba=!1,Z=P.view.pixelRatio,ha=R.length,fa=0;fa<R.length&&!ba;fa++){const aa=P.layerViewByIndex(fa,1),W=aa.fullOpacity;H[fa]=W;e.isBaseLayer(aa.layer)&&ha>=R.length&&(ha=fa);if(0===W)continue;++V;const U=M(L,fa,J);U&&(C.isVectorTileLayerView(aa)?ca=Math.max(ca,this.tileSize*Z):1===Q&&1===W&&(aa.isOpaque||this._dataToTexture(U)&&U.sourceLayerInfo.data.descriptor.isOpaque)&&(ba=!0),++S)}this._cleanupFBOPool(Z,R.length);Q=ca;
ca=b.nextHighestPowerOfTwo(Q);R=ca*ca;P=Q*Q;R===P?ca=Q:(Q=ca/2,ca=R-P<P-Q*Q?ca:Q);R=ca/this.tileSize;--fa;0===S?this._useBackgroundTexture(L,V):1===S&&(ba||this._backgroundIsGrid||r.isSome(this._backgroundColor))&&this._useLayerTexture(L,fa,ha,H[fa])||this._composeMapLayers(L,N,fa,ha,ba,H,ca,R)}};F._useBackgroundTexture=function(L,N){let R=0;if(L.surface.view.layerViewManager.updating||0<N)R=5E3;this._backgroundTexture&&r.isNone(L.renderData.textureReference)&&(R=0);L.renderData.setTextureReference(r.isSome(this._backgroundTexture)?
new A.TextureReference(this._backgroundTexture,0,O,L.surface.baseOpacity,1,1,!1):null,R)};F._useLayerTexture=function(L,N,R,S){var P=N<R;R=P?1:L.surface.baseOpacity;P=P?L.surface.baseOpacity:1;N=M(L,N,J);return this._dataToTexture(N)?(L.renderData.setTextureReference(new A.TextureReference(N.sourceLayerInfo.data,0,N,R,S,P,!0)),!0):!1};F._composeMapLayers=function(L,N,R,S,P,Q,V,ca){const ba=this._rctx,Z=this._fboPool.acquire(V);ba.bindFramebuffer(Z);ba.setViewport(0,0,V,V);ba.setClearColor(0,0,0,0);
ba.setClearDepth(1);ba.clearSafe(16640);let ha=!1;!P&&r.isSome(this._backgroundTexture)&&this._drawRasterData(this._blendLayersTechnique,this._backgroundTexture.texture,1,y.ZEROS);P=L.surface.baseOpacity;let fa=!1,aa=9987;for(;0<=R;R--){const W=M(L,R,J);W&&(R<S&&1>P&&!fa&&(this._drawRasterData(this._applyOpacityTechnique,this._blackTex.texture,1,y.ZEROS,P),fa=!0),0!==Q[R]&&(C.isVectorTileRenderInfo(W)?ha=this._drawVectorData(this._blendLayersTechnique,W,ca,Q[R],V,Z,ha):C.isImageryTileRenderInfo(W)?
(this._drawImageryTileData(W,Q[R]),this.hasNearestInterpolation(W)&&(aa=9728)):this._dataToTexture(W)&&this._drawRasterData(this._blendLayersTechnique,W.sourceLayerInfo.data.texture,W.scale,W.offset,Q[R])))}S=L.renderData.ensureTexture(V,()=>this._buildTexture(V,aa));Q=ba.bindTexture(S.texture,m.TEXTURE_UNIT_FOR_UPDATES);ca=S.descriptor;ba.gl.copyTexImage2D(ba.gl.TEXTURE_2D,0,ca.pixelFormat,0,0,ca.width,ca.height,0);S.generateMipmap();ba.bindTexture(Q,m.TEXTURE_UNIT_FOR_UPDATES);ba.bindFramebuffer(null);
this._fboPool.release(Z);L.renderData.setTextureReference(new A.TextureReference(S,N,O,fa?1:P,1,1,!1))};F._drawQuad=function(L){this._rctx.bindVAO(this._vaoQuad);L.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(5,0,K.vertexCount(this._vaoQuad,"geometry"))};F._drawRasterData=function(L,N,R,S,P=1){if(!r.isNone(N)){var Q=this._rctx,V=L.program;Q.setPipelineState(L.pipeline);Q.useProgram(V);V.bindTexture(N,"tex");V.setUniform1f("scale",R);V.setUniform2f("offset",S[0],S[1]);
V.setUniform1f("opacity",P);this._drawQuad(V)}};F.hasNearestInterpolation=function(L){L=L.sourceLayerInfo.data;return L.source?"nearest"===L.interpolation:!1};F._drawImageryTileData=function(L,N=1){const R=L.sourceLayerInfo.data;if(R.source){L.tile.surface.layerViewByIndex(L.layerIndex,1).ensureSymbolizerParameters(R);var S=this._getRasterColorizerTechnique(R),P=this._rctx,Q=S.program;P.setPipelineState(S.pipeline);P.useProgram(Q);if(R.bind(P)){R.opacity=N;R.scale=L.scale;R.offset=L.offset;var {names:V,
textures:ca}=R.getTextures();V.forEach((ba,Z)=>Q.bindTexture(ca[Z],ba));S.bindPass(R.getUniforms());this._drawQuad(Q);P.bindVAO()}}};F._getRasterColorizerTechnique=function(L){const N=L.symbolizerParameters,R=["stretch","lut","hillshade"].indexOf(N.type);this._rasterColorizerConfig||(this._rasterColorizerConfig=new x.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.colorizerType=
R;this._rasterColorizerConfig.applyColormap=!!N.colormap;this._rasterColorizerConfig.stretchType=L.hasStretchTypeNone()?0:1;return this._rasterColorizerTechnique=this._techniqueRep.releaseAndAcquire(x.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)};F._drawVectorData=function(L,N,R,S,P,Q,V){const ca=this._rctx,ba=N.sourceLayerInfo.data,Z=N.tile.surface.layerViewByIndex(N.layerIndex,1);let ha;ca.setPipelineState(L.pipeline);1>S?(ha=this._fboPool.acquire(P),ca.bindFramebuffer(ha),
ca.setClearColor(1,1,1,0),ca.clearSafe(16640)):V&&ca.clearSafe(256);this._vectorTileHelper.render(ca,N.sourceLod,ba,Z.painter,Z.layer.styleRepository,Z.schemaHelper,Math.round(1/N.scale),N.offset,this.tileSize,R);return r.isSome(ha)?(ca.bindFramebuffer(Q),this._drawRasterData(L,ha.colorTexture,1,[0,0],S),this._fboPool.release(ha),V):!0};F._dataToTexture=function(L){C.isRasterTileRenderInfo(L)&&this._rasterDataToTexture(L);return C.isTextureTileRenderInfo(L)};F._rasterDataToTexture=function(L){const N=
L.sourceLayerInfo;N.data=this._buildTexture(N.data);L.tile.setMemoryDirty()};F.setBackground=function(L,N){r.releaseMaybe(this._backgroundTexture);this._backgroundIsGrid=N;L instanceof HTMLImageElement?(this._backgroundTexture=this._buildTexture(L),this._backgroundColor=null):(this._backgroundTexture=new B(G.createColorTexture(this._rctx,w.fromValues(L[0]||0,L[1]||0,L[2]||0,1))),this._backgroundColor=f.fromValues(L[0]||0,L[1]||0,L[2]||0))};F._buildTexture=function(L,N=9987){if(r.isNone(L))return null;
const R={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:N,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0};N=this._rctx;let S;if("number"===typeof L)R.width=R.height=L,S=new B(new m(N,R));else if(L instanceof k.ImageWithType)R.isOpaque=L.isOpaque,S=new B(new m(N,R,L.image)),L.release();else try{S=new B(new m(N,R,L))}catch(P){S=new B(G.createEmptyTexture(N)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}L=N.bindTexture(S.texture,
m.TEXTURE_UNIT_FOR_UPDATES);S.generateMipmap();N.bindTexture(L,m.TEXTURE_UNIT_FOR_UPDATES);return S};F._cleanupFBOPool=function(L,N){if(L!==this._lastPixelRatio||N!==this._lastNumLayers)this._fboPool.clear(),this._lastPixelRatio=L,this._lastNumLayers=N};p._createClass(I,[{key:"backgroundIsGrid",get:function(){return this._backgroundIsGrid}},{key:"backgroundColor",get:function(){return this._backgroundColor}},{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);return I}();
const H=[],J={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},O={offset:[0,0],scale:1};a.TileRenderer=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define("exports ../../../../geometry ../../../../Viewpoint ../../ViewState ../TransformState ../../../../geometry/Point".split(" "),function(a,p,b,r,q,y){p=function(){function f(){this._renderParams={context:null,drawPhase:1,state:q.createTransformState(new r({viewpoint:new b({targetGeometry:new y(0,
0),scale:1,rotation:0}),size:[256,256]})),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,driverTestResult:null,profiler:null,renderingOptions:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}var w=f.prototype;w.dispose=function(){this._renderParams=null};w.render=function(e,l,g,
d,c,u,t,h,m,n){const z=u.adjustLevel(l[0]),k=this._renderParams;k.context=e;k.painter=d;k.glyphMosaic=d.glyphMosaic;k.spriteMosaic=d.spriteMosaic;k.pixelRatio=n;k.displayLevel=z;k.requiredLevel=z;n=u.getScale(l[0]);const [v,x]=u.getShift(l,t*n);l=.125*t*n/m;u=g.transforms.dvs;u[0]=l;u[4]=-l;u[6]=-1-v-h[0]*t*2;u[7]=1+x+(1-h[1])*t*2-2;k.state.size[0]=m;k.state.size[1]=m;g.stage||g.attachWithContext(e);g.triangleCount=0;d.drawTile(k,g,c)};return f}();a.VectorTileRendererHelper3D=p;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C){var A;const B=[0,0];b=A=function(D){function E(K){K=D.call(this,K)||this;K._viewpoint2D={center:z.create(),rotation:0,scale:0,spatialReference:null};K.center=[0,0];K.extent=new x;K.id=0;K.inverseTransform=u.create();K.resolution=0;K.rotation=0;K.scale=0;K.transform=u.create();K.transformNoRotation=u.create();K.displayMat3=h.create();K.displayViewMat3=h.create();K.viewMat3=h.create();K.viewMat2d=c.create();K.worldScreenWidth=0;K.size=[0,0];return K}
a._inheritsLoose(E,D);var G=E.prototype;G.copy=function(K){const M=this.size,H=this.viewpoint;H&&M?(this.viewpoint=v.copy(H,K.viewpoint),this._set("size",m.copy(M,K.size))):(this.viewpoint=K.viewpoint.clone(),this._set("size",[K.size[0],K.size[1]]));this._set("pixelRatio",K.pixelRatio);return this};G.clone=function(){return new A({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};G.toMap=function(K,M,H){if(k.isVec2(M))return m.transformMat2d(K,M,this.inverseTransform);
B[0]=M;B[1]=H;return m.transformMat2d(K,B,this.inverseTransform)};G.toScreen=function(K,M,H){if(k.isVec2(M))return m.transformMat2d(K,M,this.transform);B[0]=M;B[1]=H;return m.transformMat2d(K,B,this.transform)};G.toScreenNoRotation=function(K,M,H){if(k.isVec2(M))return m.transformMat2d(K,M,this.transformNoRotation);B[0]=M;B[1]=H;return m.transformMat2d(K,B,this.transformNoRotation)};G.getScreenTransform=function(K,M){const {center:H}=this._viewpoint2D,J=this._get("pixelRatio")||1,O=this._get("size");
v.getMatrix(K,H,O,M,0,J);return K};G._update=function(){const {center:K,spatialReference:M,scale:H,rotation:J}=this._viewpoint2D,O=this._get("pixelRatio")||1,I=this._get("size"),F=new r({targetGeometry:new C(K[0],K[1],M),scale:H,rotation:J});this._set("viewpoint",F);if(I&&M&&H){this.resolution=v.getResolution(F);this.rotation=J;this.scale=H;this.spatialReference=M;m.copy(this.center,K);t.set(this.displayMat3,0!==I[0]?2/I[0]:0,0,0,0,0!==I[1]?-2/I[1]:0,0,-1,1,1);var L=t.identity(this.viewMat3),N=n.fromValues(I[0]/
2,I[1]/2),R=n.fromValues(-I[0]/2,-I[1]/2),S=g.toRadian(J);t.translate(L,L,N);t.rotate(L,L,S);t.translate(L,L,R);t.multiply(this.displayViewMat3,this.displayMat3,L);L=d.identity(this.viewMat2d);d.translate(L,L,N);d.rotate(L,L,S);d.translate(L,L,R);v.getExtent(this.extent,F,I);v.getTransform(this.transform,F,I,O);d.invert(this.inverseTransform,this.transform);v.getTransformNoRotation(this.transformNoRotation,F,I,O);this.worldScreenWidth=v.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};a._createClass(E,[{key:"pixelRatio",set:function(K){this._set("pixelRatio",K);this._update()}},{key:"size",set:function(K){this._set("size",K);this._update()}},{key:"viewpoint",set:function(K){if(K){const M=this._viewpoint2D,H=K.targetGeometry;M.center[0]=H.x;M.center[1]=H.y;M.rotation=K.rotation;M.scale=K.scale;M.spatialReference=H.spatialReference}this._update()}}]);return E}(q.JSONSupport);p.__decorate([y.property({readOnly:!0})],b.prototype,"id",void 0);p.__decorate([y.property({value:1,
json:{write:!0}})],b.prototype,"pixelRatio",null);p.__decorate([y.property({json:{write:!0}})],b.prototype,"size",null);p.__decorate([y.property({type:r,json:{write:!0}})],b.prototype,"viewpoint",null);return b=A=p.__decorate([l.subclass("esri.views.2d.ViewState")],b)})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(a,p){function b(A,B){A[0]=B[0];A[1]=B[1];A[2]=B[2];A[3]=B[3];A[4]=B[4];A[5]=B[5];return A}function r(A){A[0]=1;A[1]=0;A[2]=0;A[3]=1;A[4]=0;A[5]=0;return A}function q(A,
B,D,E,G,K,M){A[0]=B;A[1]=D;A[2]=E;A[3]=G;A[4]=K;A[5]=M;return A}function y(A,B){const D=B[0],E=B[1],G=B[2],K=B[3],M=B[4];B=B[5];let H=D*K-E*G;if(!H)return null;H=1/H;A[0]=K*H;A[1]=-E*H;A[2]=-G*H;A[3]=D*H;A[4]=(G*B-K*M)*H;A[5]=(E*M-D*B)*H;return A}function f(A){return A[0]*A[3]-A[1]*A[2]}function w(A,B,D){const E=B[0],G=B[1],K=B[2],M=B[3],H=B[4];B=B[5];const J=D[0],O=D[1],I=D[2],F=D[3],L=D[4];D=D[5];A[0]=E*J+K*O;A[1]=G*J+M*O;A[2]=E*I+K*F;A[3]=G*I+M*F;A[4]=E*L+K*D+H;A[5]=G*L+M*D+B;return A}function e(A,
B,D){const E=B[0],G=B[1],K=B[2],M=B[3],H=B[4];B=B[5];const J=Math.sin(D);D=Math.cos(D);A[0]=E*D+K*J;A[1]=G*D+M*J;A[2]=E*-J+K*D;A[3]=G*-J+M*D;A[4]=H;A[5]=B;return A}function l(A,B,D){const E=B[1],G=B[2],K=B[3],M=B[4],H=B[5],J=D[0];D=D[1];A[0]=B[0]*J;A[1]=E*J;A[2]=G*D;A[3]=K*D;A[4]=M;A[5]=H;return A}function g(A,B,D){const E=B[0],G=B[1],K=B[2],M=B[3],H=B[4];B=B[5];const J=D[0];D=D[1];A[0]=E;A[1]=G;A[2]=K;A[3]=M;A[4]=E*J+K*D+H;A[5]=G*J+M*D+B;return A}function d(A,B){const D=Math.sin(B);B=Math.cos(B);
A[0]=B;A[1]=D;A[2]=-D;A[3]=B;A[4]=0;A[5]=0;return A}function c(A,B){A[0]=B[0];A[1]=0;A[2]=0;A[3]=B[1];A[4]=0;A[5]=0;return A}function u(A,B){A[0]=1;A[1]=0;A[2]=0;A[3]=1;A[4]=B[0];A[5]=B[1];return A}function t(A){return"mat2d("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+", "+A[4]+", "+A[5]+")"}function h(A){return Math.sqrt(A[0]**2+A[1]**2+A[2]**2+A[3]**2+A[4]**2+A[5]**2+1)}function m(A,B,D){A[0]=B[0]+D[0];A[1]=B[1]+D[1];A[2]=B[2]+D[2];A[3]=B[3]+D[3];A[4]=B[4]+D[4];A[5]=B[5]+D[5];return A}function n(A,B,D){A[0]=
B[0]-D[0];A[1]=B[1]-D[1];A[2]=B[2]-D[2];A[3]=B[3]-D[3];A[4]=B[4]-D[4];A[5]=B[5]-D[5];return A}function z(A,B,D){A[0]=B[0]*D;A[1]=B[1]*D;A[2]=B[2]*D;A[3]=B[3]*D;A[4]=B[4]*D;A[5]=B[5]*D;return A}function k(A,B,D,E){A[0]=B[0]+D[0]*E;A[1]=B[1]+D[1]*E;A[2]=B[2]+D[2]*E;A[3]=B[3]+D[3]*E;A[4]=B[4]+D[4]*E;A[5]=B[5]+D[5]*E;return A}function v(A,B){return A[0]===B[0]&&A[1]===B[1]&&A[2]===B[2]&&A[3]===B[3]&&A[4]===B[4]&&A[5]===B[5]}function x(A,B){const D=A[0],E=A[1],G=A[2],K=A[3],M=A[4];A=A[5];const H=B[0],
J=B[1],O=B[2],I=B[3],F=B[4];B=B[5];return Math.abs(D-H)<=p.EPSILON*Math.max(1,Math.abs(D),Math.abs(H))&&Math.abs(E-J)<=p.EPSILON*Math.max(1,Math.abs(E),Math.abs(J))&&Math.abs(G-O)<=p.EPSILON*Math.max(1,Math.abs(G),Math.abs(O))&&Math.abs(K-I)<=p.EPSILON*Math.max(1,Math.abs(K),Math.abs(I))&&Math.abs(M-F)<=p.EPSILON*Math.max(1,Math.abs(M),Math.abs(F))&&Math.abs(A-B)<=p.EPSILON*Math.max(1,Math.abs(A),Math.abs(B))}var C=Object.freeze({__proto__:null,copy:b,identity:r,set:q,invert:y,determinant:f,multiply:w,
rotate:e,scale:l,translate:g,fromRotation:d,fromScaling:c,fromTranslation:u,str:t,frob:h,add:m,subtract:n,multiplyScalar:z,multiplyScalarAndAdd:k,exactEquals:v,equals:x,mul:w,sub:n});a.add=m;a.copy=b;a.determinant=f;a.equals=x;a.exactEquals=v;a.frob=h;a.fromRotation=d;a.fromScaling=c;a.fromTranslation=u;a.identity=r;a.invert=y;a.mat2d=C;a.mul=w;a.multiply=w;a.multiplyScalar=z;a.multiplyScalarAndAdd=k;a.rotate=e;a.scale=l;a.set=q;a.str=t;a.sub=n;a.subtract=n;a.translate=g})},"esri/chunks/mat2df32":function(){define(["exports"],
function(a){function p(){const e=new Float32Array(6);e[0]=1;e[3]=1;return e}function b(e){const l=new Float32Array(6);l[0]=e[0];l[1]=e[1];l[2]=e[2];l[3]=e[3];l[4]=e[4];l[5]=e[5];return l}function r(e,l,g,d,c,u){const t=new Float32Array(6);t[0]=e;t[1]=l;t[2]=g;t[3]=d;t[4]=c;t[5]=u;return t}function q(e,l){return new Float32Array(e,l,6)}function y(e,l,g,d){const c=l[d];l=l[d+1];e[d]=g[0]*c+g[2]*l+g[4];e[d+1]=g[1]*c+g[3]*l+g[5]}function f(e,l,g,d=0,c=0,u=2){for(c=c||l.length/u;d<c;d++)y(e,l,g,d*u)}var w=
Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,createView:q,transform:y,transformMany:f});a.clone=b;a.create=p;a.createView=q;a.fromValues=r;a.mat2df32=w;a.transform=y;a.transformMany=f})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function p(){return[1,0,0,1,0,0]}function b(f){return[f[0],f[1],f[2],f[3],f[4],f[5]]}function r(f,w,e,l,g,d){return[f,w,e,l,g,d]}function q(f,w){return new Float64Array(f,w,6)}var y=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,
createView:q});a.clone=b;a.create=p;a.createView=q;a.fromValues=r;a.mat2df64=y})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function p(r){return r instanceof Float32Array&&2<=r.length}function b(r){return Array.isArray(r)&&2<=r.length}a.isVec2=function(r){return p(r)||b(r)};a.isVec2f32=p;a.isVec2f64=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/Ellipsoid ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n){function z(T,Y,ea,ia){return ia&&ea&&!ia.equals(ea)&&n.canProject(ia,ea)&&ia.isWebMercator?(ia.isWebMercator?(ea=Y[1],89.99999<ea?ea=89.99999:-89.99999>ea&&(ea=-89.99999),ea=Math.sin(f.toRadian(ea)),T=l.set(T,f.toRadian(Y[0])*h.earth.radius,.5*h.earth.radius*Math.log((1+ea)/(1-ea)))):(ea=f.toDegree(Y[0]/h.earth.radius),T=l.set(T,ea-360*Math.floor((ea+180)/360),f.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-Y[1]/h.earth.radius))))),T):l.copy(T,Y)}function k(T){return T.wkid?
T:T.spatialReference||t.WGS84}function v(T,Y){return Y.type?l.set(T,Y.x,Y.y):l.copy(T,Y)}function x(T,Y){return Math.max(T.width/Y[0],T.height/Y[1])*J(T.spatialReference)}function C(T,Y,ea,ia){return A.apply(this,arguments)}function A(){A=p._asyncToGenerator(function*(T,Y,ea,ia){if(!T||Array.isArray(T)&&!T.length)return null;r.isCollection(T)&&(T=T.toArray());if(Array.isArray(T)&&T.length&&"object"===typeof T[0]){var la=T.every(Ma=>"attributes"in Ma);var pa=T.some(Ma=>!Ma.geometry),ua=T;if(la&&pa&&
Y&&Y.allLayerViews){la=new Map;for(var wa of T)T=wa.layer,pa=la.get(T)||[],ua=wa.attributes[T.objectIdField],null!=ua&&pa.push(ua),la.set(T,pa);const Ma=[];la.forEach((Sa,Ia)=>{const va=Y.allLayerViews.find(ma=>ma.layer.id===Ia.id);if("queryFeatures"in va){const ma=Ia.createQuery();ma.objectIds=Sa;ma.returnGeometry=!0;Ma.push(va.queryFeatures(ma))}});wa=yield Promise.all(Ma);T=[];for(var Fa of wa)if(Fa&&Fa.features&&Fa.features.length)for(var La of Fa.features)q.isSome(La.geometry)&&T.push(La.geometry);
ua=T}for(const Ma of ua)ia=yield C(Ma,Y,ea,ia);return ia}if(Array.isArray(T)&&2===T.length&&"number"===typeof T[0]&&"number"===typeof T[1])la=new u(T);else if(T instanceof c)la=T;else if("geometry"in T)if(T.geometry)la=T.geometry;else if(T.layer){const Ma=T.layer;Fa=Y.allLayerViews.find(Sa=>Sa.layer.id===Ma.id);"queryFeatures"in Fa&&(La=Ma.createQuery(),La.objectIds=[T.attributes[Ma.objectIdField]],La.returnGeometry=!0,Fa=yield Fa.queryFeatures(La),la=q.get(Fa,"features",0,"geometry"))}if(q.isNone(la))return null;
Fa="point"===la.type?new d({xmin:la.x,ymin:la.y,xmax:la.x,ymax:la.y,spatialReference:la.spatialReference}):la.extent;if(!Fa)return null;ea=n.project(Fa,ea);return q.isNone(ea)?null:ia=ia?ia.union(ea):ea});return A.apply(this,arguments)}function B(T){if(T&&(!Array.isArray(T)||"number"!==typeof T[0])&&("object"===typeof T||Array.isArray(T)&&"object"===typeof T[0])){if("layer"in T&&T.layer&&T.layer.minScale&&T.layer.maxScale){var Y=T.layer;return{min:Y.minScale,max:Y.maxScale}}if(Array.isArray(T)&&T.length&&
T.every(ea=>"layer"in ea)){let ea=Y=0;for(const ia of T)(T=ia.layer)&&T.minScale&&T.maxScale&&(Y=T.minScale<Y?T.minScale:Y,ea=T.maxScale>ea?T.maxScale:ea);return Y&&ea?{min:Y,max:ea}:null}}}function D(T,Y){return E.apply(this,arguments)}function E(){E=p._asyncToGenerator(function*(T,Y){if(!T||!Y)return new b({targetGeometry:new u,scale:0,rotation:0});var ea=Y.spatialReference;const {constraints:ia,padding:la,viewpoint:pa,size:ua}=Y,wa=[la?ua[0]-la.left-la.right:ua[0],la?ua[1]-la.top-la.bottom:ua[1]];
let Fa=null;T instanceof b?Fa=T:T.viewpoint?Fa=T.viewpoint:T.target&&"esri.Viewpoint"===T.target.declaredClass&&(Fa=T.target);let La=null;if(Fa&&Fa.targetGeometry)La=Fa.targetGeometry;else if(T instanceof d)La=T;else if(T||T&&("center"in T||"extent"in T||"target"in T))La=(yield C(T.center,Y,ea))||(yield C(T.extent,Y,ea))||(yield C(T.target,Y,ea))||(yield C(T,Y,ea));!La&&pa&&pa.targetGeometry?La=pa.targetGeometry:!La&&Y.extent&&(La=Y.extent);var Ma=k(La);ea||(ea=k(Y.spatialReference||Y.extent||La));
if(!n.canProject(La,ea)&&Ma&&!Ma.equals(ea))return null;var Sa=v(g.create(),La.center?La.center:La);Ma=new u(z(Sa,Sa,Ma,ea),ea);Sa=null;Fa&&q.isSome(Fa.targetGeometry)&&"point"===Fa.targetGeometry.type?Sa=Fa.scale:T.hasOwnProperty("scale")&&T.scale?Sa=T.scale:T.hasOwnProperty("zoom")&&-1!==T.zoom&&ia&&ia.effectiveLODs?Sa=ia.zoomToScale(T.zoom):Array.isArray(La)||"point"===La.type||"extent"===La.type&&0===La.width&&0===La.height?(ea=n.project(Y.extent,ea),Sa=q.isSome(ea)?x(ea,wa):Y.extent?x(Y.extent,
wa):pa.scale):Sa=n.canProject(La.extent,ea)?x(n.project(La.extent,ea),wa):x(La.extent,wa);if(Y=B(T))Y.min&&Y.min>Sa?Sa=Y.min:Y.max&&Y.max<Sa&&(Sa=Y.max);Y=0;Fa?Y=Fa.rotation:T.hasOwnProperty("rotation")?Y=T.rotation:pa&&(Y=pa.rotation);T=new b({targetGeometry:Ma,scale:Sa,rotation:Y});ia&&(T=ia.fit(T),ia.constrainByGeometry(T),ia.rotationEnabled||(T.rotation=Y));return T});return E.apply(this,arguments)}function G(T,Y){const ea=T.targetGeometry,ia=Y.targetGeometry;ea.x=ia.x;ea.y=ia.y;ea.spatialReference=
ia.spatialReference;T.scale=Y.scale;T.rotation=Y.rotation;return T}function K(T,Y,ea){return ea?l.set(T,.5*(Y[0]-ea.right+ea.left),.5*(Y[1]-ea.bottom+ea.top)):l.scale(T,Y,.5)}function M(T,Y,ea,ia){S(T,Y,ea,ia);return w.invert(T,T)}function H(T){var Y=T.scale;T=T.targetGeometry;T=q.isSome(T)&&m.isValid(T.spatialReference)?1/(39.37*y.getMetersPerUnitForSR(T.spatialReference)*96):1;return Y*T}function J(T){return m.isValid(T)?39.37*y.getMetersPerUnitForSR(T)*96:1}function O(T){return T.isWrappable?(T=
m.getInfo(T),T.valid[1]-T.valid[0]):0}const I=180/Math.PI,F=function(){const T=g.create();return function(Y,ea,ia){const la=ea.targetGeometry;v(T,la);ea=.5*H(ea);Y.xmin=T[0]-ea*ia[0];Y.ymin=T[1]-ea*ia[1];Y.xmax=T[0]+ea*ia[0];Y.ymax=T[1]+ea*ia[1];Y.spatialReference=la.spatialReference;return Y}}(),L=function(){const T=g.create();return function(Y,ea,ia){return l.sub(Y,l.scale(Y,ea,.5),K(T,ea,ia))}}(),N=function(){const T=e.create(),Y=g.create();return function(ea,ia,la,pa){const ua=H(ia);ia=f.toRadian(ia.rotation)||
0;l.set(Y,ua,ua);w.fromScaling(T,Y);w.rotate(T,T,ia);w.translate(T,T,L(Y,la,pa));w.translate(T,T,[0,pa.top-pa.bottom]);return l.set(ea,T[4],T[5])}}(),R=function(){const T=g.create(),Y=g.create(),ea=g.create();return function(ia,la,pa,ua,wa,Fa){l.negate(T,la);l.scale(Y,pa,.5*Fa);l.set(ea,1/ua*Fa,-1/ua*Fa);w.identity(ia);w.translate(ia,ia,Y);wa&&w.rotate(ia,ia,wa);w.scale(ia,ia,ea);w.translate(ia,ia,T);return ia}}(),S=function(){const T=g.create();return function(Y,ea,ia,la){const pa=H(ea),ua=f.toRadian(ea.rotation)||
0;v(T,ea.targetGeometry);return R(Y,T,ia,pa,ua,la)}}(),P=function(){const T=g.create();return function(Y,ea,ia,la){const pa=H(ea);v(T,ea.targetGeometry);return R(Y,T,ia,pa,0,la)}}(),Q=function(){const T=g.create(),Y=g.create(),ea=[0,0,0];return function(ia,la,pa){l.subtract(T,ia,la);l.normalize(T,T);l.subtract(Y,ia,pa);l.normalize(Y,Y);l.cross(ea,T,Y);ia=Math.acos(l.dot(T,Y)/(l.length(T)*l.length(Y)))*I;0>ea[2]&&(ia=-ia);isNaN(ia)&&(ia=0);return ia}}(),V=function(){const T=g.create();return function(Y,
ea,ia,la){const pa=Y.targetGeometry;G(Y,ea);N(T,ea,ia,la);pa.x+=T[0];pa.y+=T[1];return Y}}(),ca=function(){const T=g.create();return function(Y,ea,ia,la){const pa=Y.targetGeometry;G(Y,ea);N(T,ea,ia,la);pa.x-=T[0];pa.y-=T[1];return Y}}(),ba=function(){const T=g.create();return function(Y,ea,ia){G(Y,ea);ea=Y.targetGeometry;const la=k(ia),pa=k(ea);v(T,ia);z(T,T,la,pa);ea.x=T[0];ea.y=T[1];return Y}}(),Z=function(){const T=g.create();return function(Y,ea,ia,la,pa){pa||(pa="center");l.sub(T,ia,la);l.scale(T,
T,.5);ia=T[0];la=T[1];switch(pa){case "center":l.set(T,0,0);break;case "left":l.set(T,-ia,0);break;case "top":l.set(T,0,la);break;case "right":l.set(T,ia,0);break;case "bottom":l.set(T,0,-la);break;case "top-left":l.set(T,-ia,la);break;case "bottom-left":l.set(T,-ia,-la);break;case "top-right":l.set(T,ia,la);break;case "bottom-right":l.set(T,ia,-la)}X(Y,ea,T);return Y}}(),ha=function(){const T=g.create();return function(Y,ea,ia,la,pa){G(Y,ea);isNaN(ia)||0===ia||(W(T,la,ea,pa),Y.scale=ea.scale*ia,
U(T,T,Y,pa),X(Y,Y,l.set(T,T[0]-la[0],la[1]-T[1])));return Y}}(),fa=function(){const T=g.create();return function(Y,ea,ia,la,pa,ua){G(Y,ea);isNaN(ia)||0===ia||(W(T,pa,ea,ua),Y.scale=ea.scale*ia,Y.rotation+=la,U(T,T,Y,ua),X(Y,Y,l.set(T,T[0]-pa[0],pa[1]-T[1])));return Y}}(),aa=function(){const T=g.create(),Y=g.create();return function(ea,ia,la,pa,ua,wa,Fa){L(Y,wa,Fa);l.add(T,ua,Y);return pa?fa(ea,ia,la,pa,T,wa):ha(ea,ia,la,T,wa)}}(),W=function(){const T=e.create();return function(Y,ea,ia,la){return l.transformMat2d(Y,
ea,M(T,ia,la,1))}}(),U=function(){const T=e.create();return function(Y,ea,ia,la){return l.transformMat2d(Y,ea,S(T,ia,la,1))}}(),X=function(){const T=g.create(),Y=e.create();return function(ea,ia,la){G(ea,ia);const pa=H(ia),ua=ea.targetGeometry;w.fromRotation(Y,f.toRadian(ia.rotation)||0);w.scale(Y,Y,g.fromValues(pa,pa));l.transformMat2d(T,la,Y);ua.x+=T[0];ua.y+=T[1];return ea}}();a.addPadding=V;a.angleBetween=Q;a.centerAt=ba;a.copy=G;a.create=D;a.createAsync=function(T,Y){return D(T,Y)};a.extentToScale=
x;a.getAnchor=K;a.getExtent=F;a.getMatrix=R;a.getOuterSize=function(T,Y,ea){var ia=f.toRadian(Y.rotation)||0;Y=Math.abs(Math.cos(ia));ia=Math.abs(Math.sin(ia));return l.set(T,Math.round(ea[1]*ia+ea[0]*Y),Math.round(ea[1]*Y+ea[0]*ia))};a.getPaddingMapTranslation=N;a.getPaddingScreenTranslation=L;a.getResolution=H;a.getResolutionToScaleFactor=J;a.getTransform=S;a.getTransformNoRotation=P;a.getWorldScreenWidth=function(T,Y){return Math.round(O(T)/Y)};a.getWorldWidth=O;a.padAndScaleAndRotateBy=aa;a.pixelSize=
function(T){return H(T)};a.removePadding=ca;a.resize=Z;a.rotateBy=function(T,Y,ea){G(T,Y);T.rotation+=ea;return T};a.rotateTo=function(T,Y,ea){G(T,Y);T.rotation=ea;return T};a.scaleAndRotateBy=fa;a.scaleBy=ha;a.scaleTo=function(T,Y,ea){G(T,Y);T.scale=ea;return T};a.setExtent=function(T,Y,ea,ia,la){ba(T,Y,ea.center);T.scale=x(ea,ia);la&&la.constraints&&la.constraints.constrain(T);return T};a.toMap=W;a.toScreen=U;a.translateBy=X;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/TransformState":function(){define(["exports",
"../../../chunks/vec2","../../../chunks/vec2f64","../viewpointUtils"],function(a,p,b,r){a.createTransformState=function(q){if(!q)return null;const y=q.inverseTransform,f=q.transform,w=q.transformNoRotation,e=q.pixelRatio,l=[q.size[0],q.size[1]],g=q.viewpoint.targetGeometry,d=b.fromValues(g.x,g.y);return{version:q.id,displayMat3:q.displayMat3.slice(),displayViewMat3:q.displayViewMat3.slice(),viewMat2d:q.viewMat2d.slice(),extent:q.extent.toJSON(),resolution:q.resolution,rotation:q.rotation,size:l,scale:q.scale,
center:[g.x,g.y],spatialReference:q.spatialReference,pixelRatio:e,viewpoint:q.viewpoint,worldScreenWidth:q.worldScreenWidth,toMap(c,u){return p.transformMat2d(c,u,y)},toScreen(c,u){return p.transformMat2d(c,u,f)},toScreenNoRotation(c,u){return p.transformMat2d(c,u,w)},getScreenTransform:(c,u)=>{r.getMatrix(c,d,l,u,0,e);return c}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){f=function(d){function c(){return d.apply(this,arguments)||this}b._inheritsLoose(c,d);var u=c.prototype;u.initializeProgram=function(t){const h=c.shader.get().build();return new l.Program(t.rctx,h,e.Default3D)};u.initializePipeline=function(){const t=2===this.configuration.mode?g.simpleBlendingParams(1,771):1===this.configuration.mode?g.simpleBlendingParams(0,770):null;return g.makePipelineState({blending:t,colorWrite:g.defaultColorWriteParams})};return c}(f.ShaderTechnique);
f.shader=new y.ReloadableShaderModule(q.BlendLayersShader,()=>new Promise(function(d,c){a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],d,c)}));q=function(d){function c(){var u=d.apply(this,arguments)||this;u.mode=0;return u}b._inheritsLoose(c,d);return c}(w.ShaderTechniqueConfiguration);r.__decorate([w.parameter({count:3})],q.prototype,"mode",void 0);p.BlendLayersTechnique=f;p.BlendLayersTechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/BlendLayers.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,p,b){function r(){const y=new b.ShaderBuilder;y.attributes.add("position","vec2");y.attributes.add("uv0","vec2");y.vertex.uniforms.add("scale","float");y.vertex.uniforms.add("offset","vec2");y.varyings.add("uv","vec2");y.vertex.code.add(p.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
}`);y.fragment.uniforms.add("tex","sampler2D");y.fragment.uniforms.add("opacity","float");y.fragment.code.add(p.glsl`void main() {
vec4 color = texture2D(tex, uv);
gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;
}`);return y}var q=Object.freeze({__proto__:null,build:r});a.BlendLayersShader=q;a.build=r})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/maybe ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/rasterUtils ../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){w=function(u){function t(){return u.apply(this,arguments)||this}b._inheritsLoose(t,u);var h=t.prototype;h.initializeProgram=function(m){var n=t.shader.get();const z=this.configuration;n=n.build({output:z.colorizerType,applyColormap:z.applyColormap,stretchType:z.stretchType});this._context=m.rctx;return new g.Program(m.rctx,n,l.Default3D)};h.initializePipeline=function(){const m=2===this.configuration.mode?c.simpleBlendingParams(1,771):1===this.configuration.mode?
c.simpleBlendingParams(0,770):null;return c.makePipelineState({blending:m,colorWrite:c.defaultColorWriteParams})};h.bindPass=function(m){d.setUniforms(this.program,this.uniformLocationInfos,m.basic);d.setUniforms(this.program,this.uniformLocationInfos,m.common);q.isSome(m.colormap)&&d.setUniforms(this.program,this.uniformLocationInfos,m.colormap);0===this.configuration.colorizerType&&q.isSome(m.stretch)?d.setUniforms(this.program,this.uniformLocationInfos,m.stretch):2===this.configuration.colorizerType&&
q.isSome(m.hillshade)&&d.setUniforms(this.program,this.uniformLocationInfos,m.hillshade)};b._createClass(t,[{key:"uniformLocationInfos",get:function(){this._uniformLocationInfos||(this._uniformLocationInfos=d.getUniformLocationInfos(this._context,this.program));return this._uniformLocationInfos}}]);return t}(w.ShaderTechnique);w.shader=new f.ReloadableShaderModule(y.RasterColorizerShader,()=>new Promise(function(u,t){a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],u,t)}));y=function(u){function t(){var h=
u.apply(this,arguments)||this;h.mode=2;h.colorizerType=0;h.stretchType=0;h.applyColormap=!0;return h}b._inheritsLoose(t,u);return t}(e.ShaderTechniqueConfiguration);r.__decorate([e.parameter({count:3})],y.prototype,"mode",void 0);r.__decorate([e.parameter({count:3})],y.prototype,"colorizerType",void 0);r.__decorate([e.parameter({count:2})],y.prototype,"stretchType",void 0);r.__decorate([e.parameter()],y.prototype,"applyColormap",void 0);p.RasterColorizerTechnique=w;p.RasterColorizerTechniqueConfiguration=
y;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f){function w(l){const g=new f.ShaderBuilder;g.include(p.BasicGrid);g.include(r.Common);g.include(b.Colormap);if(0===l.output){{g.fragment.uniforms.add("u_bandCount","int");g.fragment.uniforms.add("u_minCutOff","float",3);g.fragment.uniforms.add("u_maxCutOff","float",3);g.fragment.uniforms.add("u_factor","float",3);g.fragment.uniforms.add("u_minOutput","float");g.fragment.uniforms.add("u_maxOutput","float");g.fragment.uniforms.add("u_useGamma","bool");g.fragment.uniforms.add("u_gamma",
"float",3);g.fragment.uniforms.add("u_gammaCorrection","float",3);g.fragment.code.add(y.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const d=l.applyColormap?y.glsl`gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);`:y.glsl`gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;`;g.fragment.code.add(y.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${0===l.stretchType?y.glsl`
        gl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;`:y.glsl`
        if (currentPixel.a == 0.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${d}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;
        }`}
      }`)}}else 1===l.output?g.fragment.code.add(y.glsl`void main() {
vec2 pixelLocation = getPixelLocation(v_texcoord);
if (isOutside(pixelLocation)) {
gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = colormap(currentPixel, true);
}`):2===l.output&&(g.fragment.uniforms.add("u_hillshadeType","int"),g.fragment.uniforms.add("u_sinZcosAs","float",6),g.fragment.uniforms.add("u_sinZsinAs","float",6),g.fragment.uniforms.add("u_cosZs","float",6),g.fragment.uniforms.add("u_weights","float",6),g.fragment.uniforms.add("u_factor","vec2"),g.fragment.uniforms.add("u_applyColormap","bool"),g.fragment.uniforms.add("u_minValue","float"),g.fragment.uniforms.add("u_maxValue","float"),g.fragment.uniforms.add("u_srcImageSize","vec2"),g.fragment.include(q.ColorConversion),
g.fragment.code.add(y.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 rgb = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(rgb.xyz);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),g.fragment.code.add(y.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`),l=l.applyColormap?y.glsl`gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);`:y.glsl`hillshade *= alpha;
gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);`,g.fragment.code.add(y.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(v_texcoord);
      if (isOutside(pixelLocation)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${l}
    }
  `));return g}var e=Object.freeze({__proto__:null,build:w});a.RasterColorizerShader=e;a.build=w})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.BasicGrid=function(b){b.attributes.add("position","vec2");b.attributes.add("uv0","vec2");b.vertex.uniforms.add("u_scale","float");b.vertex.uniforms.add("u_offset","vec2");b.varyings.add("v_texcoord","vec2");b.vertex.code.add(p.glsl`void main(void) {
v_texcoord = uv0 * u_scale + u_offset;
gl_Position = vec4(position, 0.0, 1.0);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.Colormap=function(b){b.fragment.uniforms.add("u_colormap","sampler2D");b.fragment.uniforms.add("u_colormapOffset","float");b.fragment.uniforms.add("u_colormapMaxIndex","float");b.fragment.code.add(p.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
vec4 color = texture2D(u_colormap, clrPosition);
result = vec4(color.rgb, 1.0) * color.a * u_opacity;
}
return result;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define(["exports","./Projection.glsl","../../shaderModules/interfaces"],function(a,p,b){a.Common=function(r){r.include(p.Projection);r.fragment.uniforms.add("u_image","sampler2D");r.fragment.uniforms.add("u_isFloatTexture","bool");r.fragment.uniforms.add("u_flipY","bool");r.fragment.uniforms.add("u_applyTransform","bool");r.fragment.uniforms.add("u_opacity","float");
r.fragment.code.add(b.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.Projection=function(b){b.fragment.uniforms.add("u_transformGrid","sampler2D");b.fragment.uniforms.add("u_transformSpacing","vec2");b.fragment.uniforms.add("u_transformGridSize","vec2");b.fragment.uniforms.add("u_targetImageSize","vec2");b.fragment.code.add(p.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec4f64"],function(a,p,b){let r=function(){function q(y,f,w,e,l,g,d){this.texture=y;this.type=f;y.retain();this.offsetAndScale=b.fromValues(w.offset[0],w.offset[1],w.scale,w.scale);this.opacities=p.fromValues(e,d?g:0,l)}q.prototype.destroy=function(){this.texture.release()};return q}();a.TextureReference=r;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/terrain/support/FBOPool":function(){define(["exports","../../../../core/ObjectPool","../../../webgl/FramebufferObject"],function(a,p,b){let r=function(){function q(f){this._rctx=f;this._pools=new Map}var y=q.prototype;y.acquire=function(f){return this.getPool(f).acquire()};y.release=function(f){this.getPool(f.width).release(f)};y.clear=function(){this._pools.forEach(f=>f.destroy());this._pools.clear()};y.getPool=function(f){var w=this._pools.get(f);w||(w=
b.bind(b,this._rctx,{colorTarget:0,depthStencilTarget:1,width:f,height:f}),w=new p(w),this._pools.set(f,w));return w};return q}();a.FBOPool=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define(["exports","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../../../../../geometry/support/aaBoundingBox","../../materials/internal/MaterialUtil"],function(a,p,b,r,q){function y(m,n,z){let k=0,v=Infinity;
for(let C=0;3>C;++C){var x=m[C];if(n[C]<x){if(1E-6>=z[C])return!1;k=Math.max(k,(x-n[C])/z[C])}else-1E-6>=z[C]&&(v=Math.min(v,(x-n[C])/z[C]));if(k>v)return!1;x=m[C+3];if(n[C]>x){if(-1E-6<=z[C])return!1;k=Math.max(k,(x-n[C])/z[C])}else 1E-6<=z[C]&&(v=Math.min(v,(x-n[C])/z[C]));if(k>v)return!1}return!0}function f(m,n,z,k,v,x){let C=k;for(;z<C;){var A=m[z];n[6*A+v+3]<=x?++z:(--C,m[z]=m[C],m[C]=A)}A=z;for(C=k;A<C;)k=m[C-1],n[6*k+v]>=x?--C:(m[C-1]=m[A],m[A]=k,++A);return{next:z,mid:A}}function w(m,n,z,
k){if(k<=z)return r.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var v=6*m[z];for(var x=0;3>x;++x)t[x]=n[v+0+x],h[x]=n[v+3+x];for(z+=1;z<k;++z)for(v=6*m[z],x=0;3>x;++x)t[x]=Math.min(t[x],n[v+0+x]),h[x]=Math.max(h[x],n[v+3+x]);return r.fromValues(t[0],t[1],t[2],h[0],h[1],h[2])}function e(m){var n=m[3]-m[0];const z=m[4]-m[1],k=m[5]-m[2];n=n>z?n>k?0:z>k?1:2:z>k?1:k>n?2:0;return{axis:n,midValue:(m[n]+m[n+3])/2}}function l(m,n,z,k,v){z-=n;const x=new Float32Array(6*z);for(let A=0;A<z;++A){var C=3*(A+n);const B=
m[C+0]*v,D=m[C+1]*v;C=m[C+2]*v;for(let E=0;3>E;++E){const G=k[B+E],K=k[D+E],M=k[C+E];x[6*A+E]=Math.min(G,K,M);x[6*A+3+E]=Math.max(G,K,M)}}return x}function g(m,n,z,k){const v=k-z;var x=0;for(var C=z;C<k;++C)for(var A=0;3>A;++A)x=Math.max(n[3*C+A],x);k=65535>=x?new Uint16Array(3*v):new Uint32Array(3*v);for(x=0;x<v;++x)for(C=3*(m[x]+z),A=0;3>A;++A)k[3*x+A]=n[C+A];return k}let d=function(m,n,z,k,v){this.aabb=m;this.axis=n;this.d=z;this.midStartIndex=k;this.rightStartIndex=v},c=function(){function m(z,
k,v,x){this.globalTriangleVertexIndices=z;this.firstTriangleIndex=k;this.positionAttribute=x;this.bspNodeTree=[];this.vertexPositionBuffer=x.data;this.vertexPositionStride=x.stride;const C=v-k,A=65535>=C?new Uint16Array(C):new Uint32Array(C);this.indices=A;for(let B=0;B<C;++B)A[B]=B;{const B=l(z,k,v,x.data,x.stride),D=(E,G,K)=>{var M=w(A,B,E,G);const H=G-E;if(20>=H)return E=new d(M,void 0,0,E,G),this.bspNodeTree.push(E),E;const {axis:J,midValue:O}=e(M),I=f(A,B,E,G,J,O),F=(L,N)=>{if(!(15<K)){var R=
N-L;if(!(20>R||R>=.8*H))return D(L,N,K+1)}};M=new d(M,J,O,I.next,I.mid);this.bspNodeTree.push(M);M.leftNode=F(E,I.next);M.rightNode=F(I.mid,G);return M};D(0,C,0);this.triangleVertexIndices=g(A,z,k,v)}}var n=m.prototype;n.intersectRayTriangleRange=function(z,k){{if(z>=k)return;const I=this.triangleVertexIndices,F=this.positionAttribute.data,L=this.positionAttribute.stride;var v=this.rayOrigin;const N=v[0],R=v[1];v=v[2];var x=this.rayDirection;const S=x[0],P=x[1];x=x[2];for(let Q=z,V=3*z;Q<k;++Q){var C=
I[V]*L,A=F[C],B=F[C+1],D=F[C+2],E=I[V+1]*L;C=F[E];var G=F[E+1];E=F[E+2];var K=I[V+2]*L,M=F[K],H=F[K+1];K=F[K+2];V+=3;C-=A;G-=B;E-=D;M-=A;H-=B;K-=D;var J=P*K-H*x,O=x*M-K*S;const ca=S*H-M*P,ba=C*J+G*O+E*ca;if(!(Math.abs(ba)<=Number.EPSILON)){A=N-A;B=R-B;D=v-D;J=A*J+B*O+D*ca;if(0<ba){if(0>J||J>ba)continue}else if(0<J||J<ba)continue;O=B*E-G*D;D=D*C-E*A;B=A*G-C*B;A=S*O+P*D+x*B;if(0<ba){if(0>A||J+A>ba)continue}else if(0<A||J+A<ba)continue;B=(M*O+H*D+K*B)/ba;0<=B&&(D=this.indices[Q]+this.firstTriangleIndex,
C=q.computeNormal(C,G,E,M,H,K,u),this.callback(B,C,D))}}}m.numFacesTested+=k-z};n.intersectRay=function(z,k){m.numFacesTested=0;var v=b.fromValues(z.r0[0],z.r0[1],z.r0[2]);{z=b.fromValues(z.r1[0],z.r1[1],z.r1[2]);const x=b.create();p.sub(x,z,v);z=x}1E-6>p.squaredLength(z)||(this.rayOrigin=v,this.rayDirection=z,v=this.triangleVertexIndices.length/3,this.callback=k,this.intersectRayBSP(this.bspNodeTree[0],0,v))};n.intersectRayBSP=function(z,k,v){const x=this.rayOrigin,C=this.rayDirection;if(y(z.aabb,
x,C)){var A=z.axis,B=z.d;if(x[A]<B||0>C[A]){const D=z.midStartIndex;if(k<D){const E=z.leftNode;void 0!==E?this.intersectRayBSP(E,k,D):this.intersectRayTriangleRange(k,D)}}this.intersectRayTriangleRange(z.midStartIndex,z.rightStartIndex);if(x[A]>B||0<C[A])k=z.rightStartIndex,k<v&&(z=z.rightNode,void 0!==z?this.intersectRayBSP(z,k,v):this.intersectRayTriangleRange(k,v))}};return m}();c.numFacesTested=0;const u=b.create(),t=b.fromValues(Infinity,Infinity,Infinity),h=b.fromValues(-Infinity,-Infinity,
-Infinity);a.ComponentIntersectionData=c;a.componentMinimalSizeForIntersectionData=40;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){f=function(c){function u(){return c.apply(this,arguments)||this}b._inheritsLoose(u,c);var t=u.prototype;t.initializeProgram=function(h){var m=u.shader.get();const n=this.configuration;m=m.build({overlayMode:n.overlayMode,output:n.output,viewingMode:h.viewingMode,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:n.textureFadingEnabled&&!n.renderOccluded,hasBackgroundColor:n.hasBackgroundColor,useGrid:n.useGrid,
receiveShadows:n.receiveShadows&&!n.renderOccluded,receiveAmbientOcclusion:!1,atmosphere:n.atmosphere,tileBorders:n.tileBorders,screenSizePerspective:n.screenSizePerspective,pbrMode:0,ssrEnabled:n.ssrEnabled,highStepCount:!1});return new l.Program(h.rctx,m,e.Default3D)};t.initializePipeline=function(){const h=this.configuration,m=h.backfaceCullingEnabled&&!h.renderOccluded;return d.makePipelineState({blending:h.renderOccluded?d.simpleBlendingParams(1,771):null,culling:m&&d.backFaceCullingParams,depthTest:!h.renderOccluded&&
{func:513},depthWrite:!h.renderOccluded&&d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams,stencilTest:h.stencilEnabled?g.renderWhenBitIsNotSet(1):null})};return u}(f.ShaderTechnique);f.shader=new y.ReloadableShaderModule(q.TerrainShader,()=>new Promise(function(c,u){a(["../core/shaderLibrary/terrain/Terrain.glsl"],c,u)}));q=function(c){function u(){var t=c.apply(this,arguments)||this;t.output=0;t.overlayMode=0;t.atmosphere=!1;t.receiveShadows=!1;t.slicePlaneEnabled=!1;t.backfaceCullingEnabled=
!1;t.stencilEnabled=!1;t.textureFadingEnabled=!1;t.hasBackgroundColor=!1;t.useGrid=!1;t.renderOccluded=!1;t.ssrEnabled=!1;t.tileBorders=!1;t.screenSizePerspective=!1;return t}b._inheritsLoose(u,c);return u}(w.ShaderTechniqueConfiguration);r.__decorate([w.parameter({count:8})],q.prototype,"output",void 0);r.__decorate([w.parameter({count:3})],q.prototype,"overlayMode",void 0);r.__decorate([w.parameter()],q.prototype,"atmosphere",void 0);r.__decorate([w.parameter()],q.prototype,"receiveShadows",void 0);
r.__decorate([w.parameter()],q.prototype,"slicePlaneEnabled",void 0);r.__decorate([w.parameter()],q.prototype,"backfaceCullingEnabled",void 0);r.__decorate([w.parameter()],q.prototype,"stencilEnabled",void 0);r.__decorate([w.parameter()],q.prototype,"textureFadingEnabled",void 0);r.__decorate([w.parameter()],q.prototype,"hasBackgroundColor",void 0);r.__decorate([w.parameter()],q.prototype,"useGrid",void 0);r.__decorate([w.parameter()],q.prototype,"renderOccluded",void 0);r.__decorate([w.parameter()],
q.prototype,"ssrEnabled",void 0);r.__decorate([w.parameter()],q.prototype,"tileBorders",void 0);r.__decorate([w.parameter()],q.prototype,"screenSizePerspective",void 0);p.TerrainTechnique=f;p.TerrainTechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/Terrain.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){function t(m){const n=new u.ShaderBuilder;n.include(d.HeaderComment,{name:"Terrain Shader",output:m.output});n.include(l.Skirts);n.attributes.add("position","vec3");n.attributes.add("uv0","vec2");n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float");if(0===m.output){n.include(b.Transform,{linearDepth:!1});n.include(w.NormalUtils,m);n.include(g.TerrainTexture,m);const z=0!==m.overlayMode,k=2===m.overlayMode;z&&n.include(e.Overlay,
{pbrMode:3,useCustomDTRExponentForWater:!1,ssrEnabled:m.ssrEnabled,highStepCount:m.highStepCount});k&&n.include(r.VertexTangent,m);n.varyings.add("vnormal","vec3");n.varyings.add("vpos","vec3");n.vertex.uniforms.add("viewNormal","mat4");m.receiveShadows&&n.varyings.add("linearDepth","float");m.tileBorders&&n.varyings.add("vuv","vec2");m.atmosphere&&(n.vertex.uniforms.add("lightingMainDirection","vec3"),n.varyings.add("wnormal","vec3"),n.varyings.add("wlight","vec3"));m.screenSizePerspective&&(n.vertex.uniforms.add("screenSizePerspective",
"vec4"),n.varyings.add("screenSizeDistanceToCamera","float"),n.varyings.add("screenSizeCosAngle","float"));n.vertex.code.add(c.glsl`
      void main(void) {
        vpos = position;
        vnormal = getLocalUp(vpos, origin);

        vec2 uv = uv0;
        vpos = applySkirts(uv, vpos, vnormal, skirtScale);
        ${m.atmosphere?c.glsl`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${m.tileBorders?c.glsl`vuv = uv;`:""}
        ${m.screenSizePerspective?c.glsl`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${m.receiveShadows?c.glsl`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${z?c.glsl`setOverlayVTC(uv);`:""}
        ${k?c.glsl`forwardVertexTangent(vnormal);`:c.glsl``}
      }
    `);n.extensions.add("GL_OES_standard_derivatives");n.extensions.add("GL_EXT_shader_texture_lod");n.include(p.Slice,m);n.include(f.EvaluateSceneLighting,m);n.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4");m.screenSizePerspective&&n.fragment.uniforms.add("screenSizePerspective","vec4");k&&(n.fragment.uniforms.add("ovWaterTex","sampler2D"),n.fragment.uniforms.add("view","mat4"));n.fragment.code.add(c.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);n.fragment.code.add(c.glsl`
      void main() {
        ${m.receiveShadows?c.glsl`float shadow = readShadowMap(vpos, linearDepth);`:c.glsl`float shadow = 0.0;`}
        float vndl = dot(normalize(vnormal), lightingMainDirection);

        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        vec4 tileColor = getTileColor();
        ${z?c.glsl`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${m.atmosphere?c.glsl`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(max(0.0, dot(wlight, wnormal)) + clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${m.atmosphere?c.glsl`atm + tileColor.rgb;`:c.glsl`tileColor.rgb;`}
        vec3 normal = normalize(vnormal);

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${k?c.glsl`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${m.screenSizePerspective?c.glsl`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${m.tileBorders?c.glsl`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}if(1===m.output||3===m.output)n.include(b.Transform,{linearDepth:!0}),n.include(q.OutputDepth,{output:m.output}),n.include(w.NormalUtils,m),n.varyings.add("linearDepth","float"),n.vertex.uniforms.add("nearFar","vec2"),n.vertex.code.add(c.glsl`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);
}`),n.fragment.code.add(c.glsl`void main() {
outputDepth(linearDepth);
}`);2===m.output&&(n.include(b.Transform,{linearDepth:!1}),n.include(w.NormalUtils,m),n.varyings.add("vnormal","vec3"),n.varyings.add("vpos","vec3"),n.vertex.uniforms.add("viewNormal","mat4"),n.vertex.code.add(c.glsl`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vpos = applySkirts(uv, position, normal, skirtScale);
gl_Position = transformPosition(proj, view, vpos);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`),n.fragment.code.add(c.glsl`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`));4===m.output&&(n.include(b.Transform,{linearDepth:!1}),n.include(w.NormalUtils,m),n.include(e.Overlay,{pbrMode:0}),n.vertex.code.add(c.glsl`void main() {
vec3 vnormal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);
setOverlayVTC(uv);
gl_Position = transformPosition(proj, view, vpos);
}`),n.include(y.OutputHighlight),n.fragment.code.add(c.glsl`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`));return n}var h=Object.freeze({__proto__:null,build:t});a.TerrainShader=h;a.build=t})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.VertexTangent=function(b,r){b.varyings.add("tbnTangent","vec3");b.varyings.add("tbnBiTangent","vec3");1===r.viewingMode?b.vertex.code.add(p.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):b.vertex.code.add(p.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);b.fragment.code.add(p.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define(["exports","../shading/EvaluateMainLighting.glsl","../shading/Water.glsl","../../shaderModules/interfaces"],function(a,p,b,r){a.Overlay=function(q,y){q.extensions.add("GL_OES_standard_derivatives");3!==y.pbrMode&&4!==y.pbrMode||q.include(b.Water,y);q.vertex.uniforms.add("overlayTexOffset","vec4");q.vertex.uniforms.add("overlayTexScale","vec4");q.varyings.add("vtcOverlay",
"vec4");q.vertex.code.add(r.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);q.fragment.uniforms.add("ovColorTex","sampler2D");q.fragment.uniforms.add("overlayOpacity","float");q.fragment.code.add(r.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);q.fragment.code.add(r.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);if(3===y.pbrMode||4===y.pbrMode)q.include(p.EvaluateMainLighting),q.fragment.code.add(r.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);
return vec4(final, colorInput.w);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.Skirts=function(b){b.vertex.code.add(p.glsl`vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {
float skirtLength = 0.0;
if (uv.x >= 2.0) {
skirtLength = uv.y * skirtScale;
vec2 x = vec2(uv.x) - vec2(3.5, 4.5);
uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));
}
return vpos - vnormal * skirtLength;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.TerrainTexture=function(b,r){b.varyings.add("vtc","vec2");b.vertex.uniforms.add("texOffsetAndScale","vec4");b.fragment.uniforms.add("tex","sampler2D");b.fragment.uniforms.add("textureOpacities","vec3");r.textureFadingEnabled&&(b.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),b.varyings.add("nvtc",
"vec2"),b.fragment.uniforms.add("texNext","sampler2D"),b.fragment.uniforms.add("nextTexOpacities","vec3"),b.fragment.uniforms.add("fadeFactor","float"));b.vertex.code.add(p.glsl`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${r.textureFadingEnabled?p.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:p.glsl``}
  }`);r.useGrid?(b.fragment.code.add(p.glsl`float lineFactorAtPosition(float value) {
float pos = value * 129.0;
if(pos < 0.5 || pos > 128.5) {
return 1.0;
}
pos = pos + 0.5;
float modulo = mod(pos, 16.0);
return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
}
float lineFactorAtUV(vec2 uv) {
return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
}
float lineFactor(vec2 uv) {
vec2 offset = fwidth(uv) * 0.25;
return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
}
vec4 gridColor(vec2 uv) {
float line = lineFactor(uv) * 0.1 + 0.9;
float backgroundOpacity = textureOpacities.y;
return vec4(1.0, 0.972, 0.918, 1.0) * line * backgroundOpacity;
}`),b.fragment.code.add(p.glsl`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
vec4 grid = gridColor(uv);
float alpha = opacities.z * color.a;
return mix(grid, color, alpha) * opacities.x;
}`)):r.hasBackgroundColor?(b.fragment.uniforms.add("backgroundColor","vec3"),b.fragment.code.add(p.glsl`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
float alpha = opacities.z * color.a;
float backgroundOpacity = opacities.y;
return mix(vec4(backgroundColor, 1.0) * backgroundOpacity, color, alpha) * opacities.x;
}`)):b.fragment.code.add(p.glsl`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
return color;
}`);r.textureFadingEnabled?b.fragment.code.add(p.glsl`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):b.fragment.code.add(p.glsl`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){return function(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ./terrainUtils ./TilingScheme".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){a.TilingSchemeLogic=function(n){function z(v){v=n.call(this,v)||this;v._handles=new q;return v}p._inheritsLoose(z,n);var k=z.prototype;k.initialize=function(){this._handles.add(this.layers.on("change",()=>this._update()));this._handles.add(this.extentHelper.watch("layerViewsExtent",()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};k.destroy=function(){this._handles=y.destroyMaybe(this._handles);this._waitTask=
null};k._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var v;this.layers.some(C=>!t.isTiledLayer(C)||C.isRejected()?!1:!C.isFulfilled()||h.getTiledLayerInfo(C,this.viewSpatialReference,this.viewingMode).tileInfo?(v=C,!h.isVectorTileLayer(C)&&!h.isProjectableRasterLayer(C)):!1);if(v)if(v.isResolved()){var {tileInfo:x}=h.getTiledLayerInfo(v,this.viewSpatialReference,this.viewingMode);x=new m(x);this._set("tilingSchemeDone",!0);this._lockTilingScheme(x)}else this._updateWhen(v);
else this._set("tilingSchemeDone",!0)}};k._updateWhen=function(v){const x=v.when().catch(()=>{}).then(()=>{x!==this._waitTask||this.destroyed||this._update()});this._waitTask=x};k._lockTilingScheme=function(v){if(1===this.viewingMode){const x=v.levels.length-1;v.spatialReference.isWebMercator?v=m.makeWebMercatorAuxiliarySphere(x):d.canProjectToWGS84ComparableLonLat(v.spatialReference)&&(v=m.makeGCSWithTileSize(v.spatialReference,v.pixelSize,x))}this.tilingSchemeLocked=!0;this.tilingScheme=v;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._handles.removeAll();this._handles.add(this.extentHelper.watch("tiledLayersExtent",()=>this._updateTiledLayerExtent()))};k._updateTiledLayerExtent=function(){this._set("extent",this.extentHelper.tiledLayersExtent)};k._setAdHocTilingScheme=function(){if(1===this.viewingMode){var v=this.extentHelper.viewSpatialReference;const x=d.canProjectToWGS84ComparableLonLat(v)||u.isMars(v)||u.isMoon(v);v.isWebMercator?this.tilingScheme=m.WebMercatorAuxiliarySphere:
x&&(this.tilingScheme=m.makeGCSWithTileSize(v,256));this._set("extent",this.extentHelper.layerViewsExtent)}else v=this.extentHelper.layerViewsExtent,y.isSome(v)&&!c.equals(v,this.extent)&&(this.tilingScheme=m.fromExtent(v,this.extentHelper.viewSpatialReference),this._set("extent",v))};p._createClass(z,[{key:"test",get:function(){return{lockTilingScheme:v=>this._lockTilingScheme(v),done:!this._waitTask}}}]);return z}(r);b.__decorate([f.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);
b.__decorate([f.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);b.__decorate([f.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);b.__decorate([f.property({readOnly:!0,value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeDone",void 0);b.__decorate([f.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewSpatialReference",void 0);b.__decorate([f.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);b.__decorate([f.property({constructOnly:!0})],
a.TilingSchemeLogic.prototype,"extentHelper",void 0);b.__decorate([f.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=b.__decorate([g.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/vec2f64"],function(a,p){let b=function(){function r(){this.offset=p.create();this.scale=0;this.tile=null}
var q=r.prototype;q.init=function(y,f,w,e){this.tile=y;this.offset[0]=f;this.offset[1]=w;this.scale=e};q.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return r}();a.UpsampleInfo=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/AutoDisposable ./lib/ChangeSet ./lib/GeometryRecord ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v){var x;a.Stage=x=function(C){function A(D){D=C.call(this,D)||this;D._handles=new q;D._model=new z.Model;D._layers=new f;D._changeSet=new h.ChangeSet;D._layerSyncSet=new Set;return D}p._inheritsLoose(A,C);var B=A.prototype;B.initialize=function(){this._set("renderView",new k.RenderView(this));this._frameTask=this.resourceController.scheduler.registerTask(v.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};B.destroy=function(){m.GeometryRecord.pool.prune(0);
this._handles.destroy();this.dispose()};B.add=function(D){this._model.add(D);n.isWebGLLayer(D)&&(D.attachStage(this),this._addLayer(D));this.renderView.setNeedsRender()};B.remove=function(D){y.isNone(D)||(this.renderView.setNeedsRender(),this._model.remove(D),n.isWebGLLayer(D)&&(this._removeLayer(D),D.detachStage()))};B.addMany=function(D){y.isSome(D)&&(this._model.addMany(D),this.renderView.setNeedsRender())};B.removeMany=function(D){y.isSome(D)&&(this._model.removeMany(D),this.renderView.setNeedsRender())};
B.forEachOfType=function(D,E){this._model.forEachOfType(D,E)};B.handleEvent=function(D,E){this.destroyed||(this._model.dirtySet[D](E),this.renderView.setNeedsRender())};B.runTask=function(D){this._frameTask.processQueue(D);D.done||this._commit()};B._commit=function(){const D=this._model.dirtySet;x.DebugSettings.logDirtySet&&console.log("Dirty set: "+D.formatDebugInfo());D.commit(this._changeSet);x.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(E=>E.id)),console.log("RGs remove: "+
this._changeSet.removes.map(E=>E.id)));this._layerSyncSet.clear();this.renderView.modify(this._changeSet);this.renderView.setNeedsRender()};B.schedule=function(D,E){return this._frameTask.schedule(D,E)};B.syncLayer=function(D){this._layerSyncSet.add(D);this.renderView.setNeedsRender()};B.processSyncLayers=function(){const D=this._model.dirtySet;this._layers.forAll(E=>{if(this._layerSyncSet.has(E.id)||1===E.updatePolicy)D.commitLayer(E.id,this._changeSet),this._layerSyncSet.delete(E.id)});for(const E of this._layerSyncSet)D.commitLayer(E,
this._changeSet);this._layerSyncSet.clear();this.renderView.modify(this._changeSet)};B.getObject=function(D){return this._model.getObject(D)};B._addLayer=function(D){this._layers.some(E=>E===D)||this._layers.push(D)};B._removeLayer=function(D){this._commit();null!=this._layers.removeUnordered(D)&&(this._model.dirtySet.getResidentRenderGeometries(D.id,this._changeSet.removes),this.renderView.modify(this._changeSet))};B.addRenderPlugin=function(D,E,G){D=this.renderView.renderPlugins.add(D,E,G);G=()=>
{u.isIntersectionHandler(E)&&this.sceneIntersectionHelper.addIntersectionHandler(E)};if(w.isPromise(D))return D.then(G);G()};B.removeRenderPlugin=function(D){u.isIntersectionHandler(D)&&this.sceneIntersectionHelper.removeIntersectionHandler(D);this.renderView.renderPlugins.remove(D)};p._createClass(A,[{key:"viewingMode",get:function(){return this.state.viewingMode}},{key:"updating",get:function(){return this._model.dirtySet.dirty||this.renderView.updating}},{key:"running",get:function(){return this._model.dirtySet.dirty}},
{key:"layers",get:function(){return this._layers}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const D=this;return{getCount(E){return D._model.test.content.filter(G=>G.type===E).length},model:D._model}}}]);return A}(t.AutoDisposableMixin(r));a.Stage.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"resourceController",void 0);
b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"state",void 0);b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"sceneIntersectionHelper",void 0);b.__decorate([e.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"renderSR",void 0);
b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"_handles",void 0);b.__decorate([e.property({readOnly:!0})],a.Stage.prototype,"updating",null);b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);b.__decorate([t.autoDispose(),e.property()],a.Stage.prototype,"renderView",void 0);a.Stage=x=b.__decorate([c.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../lib/localOrigin ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){const t=c.assert,h=c.logWithBase;a.Model=function(m){function n(){var k=m.call(this)||this;k.dirtySet=new g({model:p._assertThisInitialized(k)});k._id2origin=new Map;k._content=new Map;return k}p._inheritsLoose(n,m);var z=n.prototype;z.getObject=function(k){return this._content.get(k)};z.add=function(k){const v=k.id;t(!this._content.has(v),"Model/Stage already contains object to be added");this._content.set(v,k);u.isWebGLLayer(k)&&this.dirtySet.layerAdded(k)};
z.remove=function(k){t(this._content.has(k.id),"Model/Stage doesn't contain object to be removed");this._content.delete(k.id);k.unload();u.isWebGLLayer(k)&&this.dirtySet.layerRemoved(k)};z.addMany=function(k){for(const v of k)t(!this._content.has(v.id),"Model/Stage already contains object to be added"),this._content.set(v.id,v)};z.removeMany=function(k){for(const v of k)t(this._content.has(v.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(v.id),v.unload()};z.forEachOfType=
function(k,v){this._content.forEach(x=>{x.type===k&&v(x)})};z._getOrigin=function(k){var v=0,x=10*k[3]/1E4;1<x&&(v=Math.ceil(h(x,2)));x=1E4*2**v;const C=Math.round(k[0]/x),A=Math.round(k[1]/x);k=Math.round(k[2]/x);v=v+"_"+C+"_"+A+"_"+k;let B=this._id2origin.get(v);null==B&&(B=l.fromValues(C*x,A*x,k*x,v),this._id2origin.set(v,B));return B};z.getRenderGeometry=function(k,v){const {geometry:x,material:C,id:A,shaderTransformation:B,origin:D,instanceParameters:E}=v,G=new d.RenderGeometry(x,C,null,null,
A,x.boundingInfo,B,k.castShadow);G.updateTransformation(K=>k.getCombinedStaticTransformation(v,K));G.origin=D||this._getOrigin(G.boundingSphere);G.instanceParameters=E;return G};z.updateRenderGeometryTransformation=function(k,v,x){x.updateTransformation(A=>k.getCombinedStaticTransformation(v,A));const C=this._getOrigin(x.boundingSphere);return x.origin!==C};z.getStats=function(){const k={},v=Array.from(this._content.values());for(let x=0;5>x;++x)k[x]=v.filter(C=>C.type===x).length;return{contentTypes:k,
dirtySet:this.dirtySet.formatDebugInfo()}};p._createClass(n,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);return n}(r);b.__decorate([q.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=b.__decorate([e.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ./GeometryRecord ./Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){b=function(u){function t(m){m=u.call(this,m)||this;m._residentGeomRecords=new Map;m._dirtyGeomRecords=new Map;m.dirty=!1;return m}a._inheritsLoose(t,u);var h=t.prototype;h.commit=function(m){this.dirty=!1;this._dirtyGeomRecords.forEach((n,z)=>this.commitLayer(z,m))};h.commitLayer=function(m,n){const z=this._dirtyGeomRecords.get(m);z&&(z.forEach((k,v)=>{const x=this._ensureGeomRecord(m,v);k.forEach((C,A)=>{var B=C[0],D=C[1],E=C[2];C=!1;if(D&2){var G=x.get(A);if(G){G=
G[1];if(E&4){const K=this.model.getObject(v);this.model.updateRenderGeometryTransformation(K,B,G)&&(C=!0)}C||n.updates.push({renderGeometry:G,updateType:E})}else c.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(D&4||C)(E=x.get(A))?(n.removes.push(E[1]),x.delete(A),E[0].disposed&&d.GeometryRecord.pool.release(E[0])):4===D&&c.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");if(D&1||C)D=this.model.getObject(v),D=this.model.getRenderGeometry(D,
B),B=[B,D],n.adds.push(D),x.set(A,B)});0===x.size&&this._residentGeomRecords.get(m).delete(v)}),0===this._residentGeomRecords.get(m).size&&this._residentGeomRecords.delete(m),this._dirtyGeomRecords.delete(m))};h.getResidentRenderGeometries=function(m,n){(m=this._residentGeomRecords.get(m))&&m.forEach(z=>z.forEach(k=>n.push(k[1])))};h._objectStateChanged=function(m,n){for(const z of n.geometryRecords)this._updateOrCreateDirtyRecord(n,z,null,2,0,0,2,5,m)};h.visibilityChanged=function(m){this._objectStateChanged(1,
m)};h.highlightChanged=function(m){this._objectStateChanged(8,m)};h.occlusionChanged=function(m){this._objectStateChanged(16,m)};h.vertexAttrsUpdated=function(m){this._updateOrCreateDirtyRecord(m.object,m.record,null,2,0,0,2,5,2)};h.layerAdded=function(m){m.objects.forAll(n=>this._layerObjectAdded(m,n))};h.layerRemoved=function(m){m.objects.forAll(n=>this._layerObjectRemoved(m,n))};h.layerObjectAdded=function(m){this._layerObjectAdded(m.layer,m.object)};h._layerObjectAdded=function(m,n){m=m.id;const z=
n.geometryRecords;for(let k=0;k<z.length;k++)this._objectGeometryAdded(n,z[k],m)};h.layerObjectRemoved=function(m){this._layerObjectRemoved(m.layer,m.object)};h.layerObjectsAdded=function(m){for(const n of m.objects)this._layerObjectAdded(m.layer,n)};h.layerObjectsRemoved=function(m){for(const n of m.objects)this._layerObjectRemoved(m.layer,n)};h._layerObjectRemoved=function(m,n){m=m.id;const z=n.geometryRecords;for(let k=0;k<z.length;k++)this._objectGeometryRemoved(n,z[k],m)};h.shaderTransformationChanged=
function(m){(m=this._residentGeomRecords.get(m.id))&&m.forEach((n,z)=>{(z=this.model.getObject(z))&&z.hasVolativeTransformation()&&n.forEach(k=>{k[1].shaderTransformationChanged()})})};h.objectTransformation=function(m){const n=this._getParentLayerId(m);this._ensureGeomRecord(n,m.id).forEach(z=>{this._updateOrCreateDirtyRecord(m,z[0],n,2,0,0,2,5,4)})};h.objectGeometryAdded=function(m){this._objectGeometryAdded(m.object,m.record)};h._objectGeometryAdded=function(m,n,z=null){this._updateOrCreateDirtyRecord(m,
n,z,1,4,0,0,0)};h.objectGeometryRemoved=function(m){this._objectGeometryRemoved(m.object,m.record)};h._objectGeometryRemoved=function(m,n,z=null){this._updateOrCreateDirtyRecord(m,n,z,4,1,2,0,0)};h._updateOrCreateDirtyRecord=function(m,n,z,k,v,x,C,A,B){z=q.unwrapOr(z,this._getParentLayerId(m));const D=n.id;m=this._ensureDirtyRecord(z,m.id);(z=m.get(D))?(n=z[1],n&v?(m.delete(D),z[0].disposed&&d.GeometryRecord.pool.release(z[0])):n&x?(z[1]=k,z[2]=B):n&C?z[2]|=B:n&A||c.assert(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")):
m.set(D,[n,k,B]);this.dirty=this._hasDirtyGeometryRecords};h._ensureGeomRecord=function(m,n){let z=this._residentGeomRecords.get(m);z||(z=new Map,this._residentGeomRecords.set(m,z));m=z.get(n);m||(m=new Map,z.set(n,m));return m};h._ensureDirtyRecord=function(m,n){let z=this._dirtyGeomRecords.get(m);z||(z=new Map,this._dirtyGeomRecords.set(m,z));m=z.get(n);m||(m=new Map,z.set(n,m));return m};h._getParentLayerId=function(m){return q.isSome(m.parentLayer)?m.parentLayer.id:y.NullUID};h.formatDebugInfo=
function(){const m=["ADD","UPD",void 0,"REM"];let n="";this._dirtyGeomRecords.forEach((z,k)=>{z.forEach((v,x)=>{0<n.length&&(n+="\n");n+=k+"."+x;const C=[];v.forEach(A=>{const B=A[1];C[B]||(C[B]=[]);C[B].push(A[0].geometry.id)});for(v=0;v<C.length;v++)if(C[v])for(n+=" "+m[v-1]+": ",x=0;x<C[v].length;x++)n+=C[v][x]+", "})});return n};a._createClass(t,[{key:"_hasDirtyGeometryRecords",get:function(){return r.someMap(this._dirtyGeomRecords,m=>r.someMap(m,n=>n&&0<n.size))}},{key:"test",get:function(){const m=
this;return{get residentLayerCount(){return m._residentGeomRecords.size},get residentObjectCount(){return Array.from(m._residentGeomRecords.values()).reduce((n,z)=>n+z.size,0)}}}}]);return t}(b);p.__decorate([f.property({constructOnly:!0})],b.prototype,"model",void 0);p.__decorate([f.property()],b.prototype,"dirty",void 0);return b=p.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],b)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/scheduling ../../../../core/time ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../support/animationUtils ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRep ../lib/MagnifierHelper ../lib/Renderer ../lib/TextureRepository ../lib/WebGLDriverTest ../materials/StippleTextureRepository ../materials/internal/WaterTextureRepository ./requireUtils ./ScreenshotManager ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H){const J=f.getLogger("esri.views.3d.webgl-engine.parts.View");a.RenderView=function(O){function I(L){var N=O.call(this,{})||this;N.events=new q;N.waterTextureRepository=new E.WaterTextureRepository;N._magnifierHelper=new x.MagnifierHelper;N._componentObjectCollection=null;N._needsUpdate=!0;N._needsRender=!0;N._idleSuspend=!0;N._needsWaterReflectionUpdate=!1;N._logicUpdateLast=0;N._container=L.container;N._initializeContext(L.options);
g.init(N.waterTextureRepository,"loadingState",()=>N.setNeedsRender());N._magnifierHelper.events.on("request-render",()=>N.setNeedsRender());N._stippleTextureRepository=new D.StippleTextureRepository(N._rctx);N._shaderTechniqueRepository=new m.ShaderTechniqueRepository({rctx:N._rctx,viewingMode:L.viewingMode,stippleTextureRepository:N._stippleTextureRepository,waterTextureRepository:N.waterTextureRepository});N._textureRepository=new A.TextureRepository(L,N._shaderTechniqueRepository,N._rctx);N._textureRepository.events.on("changed",
R=>N.setNeedsRender(R));N._materialRepository=new v(N._textureRepository,N._shaderTechniqueRepository,()=>N.setNeedsRender());N._compositingHelper=new z(N._rctx,N._shaderTechniqueRepository);N._renderer=new C(N._materialRepository,N._textureRepository,N._shaderTechniqueRepository,N._rctx,N._compositingHelper,N._magnifierHelper,(R=1)=>N.setNeedsRender(R),(R,S)=>L.schedule(R,S),L);N._screenshotManager=new K.ScreenshotManager(N._rctx,(R,S,P)=>N._renderer.render(R,S,S,P),()=>N.setNeedsRender(),L.options.screenshot.renderOverlay,
R=>N.events.emit("force-camera-for-screenshot",R));N._registerFrameTask(L);return N}p._inheritsLoose(I,O);var F=I.prototype;F.normalizeCtorArgs=function(){return{}};F.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._shaderTechniqueRepository.dispose();this._shaderTechniqueRepository=null;B.clearTestWebGLDriver(this._rctx);O.prototype.dispose.call(this);this._rctx=this._tmpDepthBuffer=
null};F.setNeedsRender=function(L=1){1===L?this._needsUpdate||(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0};F.evaluateUpdating=function(){return this.needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating};F.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};F.updateLightSources=function(L,N,R){this._renderer.updateLightSources(L,N,R);
this.setNeedsRender()};F.setRenderParameters=function(L){void 0!==L.idleSuspend&&this._idleSuspend!==!!L.idleSuspend&&(this._idleSuspend=!!L.idleSuspend,this.setNeedsRender());this._renderer.setRenderParameters(L)};F.modify=function(L){this._renderer.modify(L);L.clear()};F.takeScreenshot=function(L){return this._screenshotManager.takeScreenshot(L)};F.readAccumulatedShadow=function(L){return this._renderer.readAccumulatedShadow(L[0],L[1])};F.getMinimalDepthForArea=function(L,N,R,S,P=S){L=R.constrainWindowSize(L,
N,S*R.pixelRatio,P*R.pixelRatio);N=this._ensureDepthBuffer(L);this._renderer.readDepthPixels(R,L[0],L[1],L[2],L[3],N);S=Number.MAX_VALUE;for(P=0;P<L[2]*L[3];P++){const Q=k.textureToDepth(4*P,N,R.nearFar);S>Q&&Q!==R.nearFar[0]&&Q!==R.nearFar[1]&&(S=Q)}return S===Number.MAX_VALUE?void 0:S};F._ensureDepthBuffer=function(L){L=4*L[2]*L[3];if(w.isNone(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<L)this._tmpDepthBuffer=new Uint8Array(L);return this._tmpDepthBuffer};F.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};
F.hotReloadShaders=function(){var L=p._asyncToGenerator(function*(){G.removeLoadedShaderModules();yield this._shaderTechniqueRepository.hotReload();this.setNeedsRender()});return function(){return L.apply(this,arguments)}}();F._registerFrameTask=function(L){const N=L.state,R={viewCamera:N.camera,frameHasDecorations:!1};let S=!1;this._frameTask=e.addFrameTask({preRender:P=>{S=this.evaluateUpdating();L.processSyncLayers();var Q=l.Milliseconds(P.time-this._logicUpdateLast);if(Q>t.DESIRED_ANIMATION_MS||
w.isSome(this.forcedAnimationTime))Q={camera:N.camera,dt:Q,forcedTime:this.forcedAnimationTime},this._logicUpdateLast=P.time,this._renderer.updateLogic(Q)&&this.setNeedsRender(0)},render:()=>{if((this.needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<N.camera.fullWidth&&0<N.camera.fullHeight){const P=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=
!1;this._renderer.render(null,N.camera,N.contentCamera,!1);P&&this._renderer.hasWaterReflection&&(this.setNeedsRender(0),this._needsWaterReflectionUpdate=!0)}},postRender:()=>{S===this.updating&&S===this.evaluateUpdating()||this.notifyChange("updating")},update:()=>{R.viewCamera=N.camera;R.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled;this._textureRepository.update();this._screenshotManager.update(R)}})};F._initializeContext=function(L){this._canvas=L.canvas;this._canvas||
(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const N={alpha:L.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==L.stencil?!0:L.stencil,powerPreference:"high-performance"};let R;const S=y("esri-force-webgl");S?R=M.createContextOrErrorHTML(this._canvas,S,N):(R=M.createContext(this._canvas,2,N),w.isNone(R)&&(R=M.createContextOrErrorHTML(this._canvas,1,N)));w.isNone(R)?J.error("A WebGL context with the requested version ("+
S?S:"automatic) could not be created."):(this._rctx=new H(R,{disabledExtensions:L.deactivatedWebGLExtensions||{},debugWebGLExtensions:L.debugWebGLExtensions||{},maxAnisotropy:8}),B.testWebGLDriver(this._rctx),this._loadShaderOnlyExtensions(),!L.alpha&&this._rctx.contextAttributes.alpha&&J.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=y("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))};
F._loadShaderOnlyExtensions=function(){this._rctx.capabilities.enable("standardDerivatives");this._rctx.capabilities.enable("shaderTextureLOD");this._rctx.capabilities.enable("textureFloat")};p._createClass(I,[{key:"performanceInfo",get:function(){const L=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==L.getUsedTextureMemory?L.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==L.getUsedRenderbufferMemory?L.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==
L.getUsedVBOMemory?L.getUsedVBOMemory():void 0}}},{key:"needsUpdate",get:function(){return this._needsUpdate}},{key:"updating",get:function(){return this.evaluateUpdating()}},{key:"edgeView",get:function(){return this._renderer.edgeView}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},{key:"magnifier",set:function(L){this._magnifierHelper.magnifier=L}},{key:"renderingContext",get:function(){return this._rctx}},
{key:"capabilities",get:function(){return this._rctx.capabilities}},{key:"canvas",get:function(){return this._canvas}},{key:"hasShadowsEnabled",get:function(){return this._renderer.hasShadowsEnabled}},{key:"renderPlugins",get:function(){return this._renderer.renderPlugins}},{key:"test",get:function(){return{renderer:this._renderer}}},{key:"componentObjectCollection",get:function(){w.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new h.ComponentObjectCollection(this._renderer.renderPassManager));
return this._componentObjectCollection},set:function(L){this._componentObjectCollection=L}}]);return I}(n.AutoDisposableMixin(r));b.__decorate([d.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",null);b.__decorate([n.autoDispose()],a.RenderView.prototype,"_rctx",void 0);b.__decorate([n.autoDispose()],a.RenderView.prototype,"_container",void 0);b.__decorate([n.autoDispose()],a.RenderView.prototype,"_canvas",void 0);b.__decorate([n.autoDispose()],a.RenderView.prototype,"_stippleTextureRepository",
void 0);b.__decorate([n.autoDispose(),d.property()],a.RenderView.prototype,"waterTextureRepository",void 0);b.__decorate([n.autoDispose(),d.property()],a.RenderView.prototype,"_magnifierHelper",void 0);b.__decorate([n.autoDispose(),d.property()],a.RenderView.prototype,"_textureRepository",void 0);b.__decorate([n.autoDispose()],a.RenderView.prototype,"_compositingHelper",void 0);b.__decorate([n.autoDispose()],a.RenderView.prototype,"_renderer",void 0);b.__decorate([n.autoDispose()],a.RenderView.prototype,
"_screenshotManager",void 0);b.__decorate([n.autoDispose()],a.RenderView.prototype,"componentObjectCollection",null);b.__decorate([n.autoDispose()],a.RenderView.prototype,"_componentObjectCollection",void 0);a.RenderView=b.__decorate([u.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4 ../../../../../chunks/vec4f32 ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./interface ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./Material/ComponentMaterial ./Material/ComponentTechnique ../../core/util/TwoVectorPosition ../../lib/ComponentUtils ../../lib/Util ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H){const J=b.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");b=function(){function N(S){this._renderManager=S;this._objects=[new q,new q];this._renderSubmit=new x.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=new K.BufferManager(S.rctx)}var R=N.prototype;R.dispose=function(){G.assert(0===this._objects[0].length&&0===this._objects[1].length,
"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy()};R.createObject=function(S){const P=new m.ComponentObject;P.toMapSpace=S.toMapSpace.slice();P.transform=S.transform;P.obb=c.clone(S.obb);P.components=new h(this._componentBufferManager,S.geometry.componentOffsets);P.renderable=this._createRenderable(S,P.components);P.intersectionGeometry=new z(S.geometry.positionData,P.components);this._objects[P.visible].push(P);return P};R.destroyObject=function(S){this._objects[S.visible].removeUnordered(S);
S.dispose();this._notifyDirty()};R.setObjectVisibility=function(S,P){P!==S.visible&&(this._objects[S.visible].removeUnordered(S),this._objects[P].push(S),S.visible=P,this._notifyDirty())};R.preSubmit=function(S){const P=S.camera.eye;this.visibleObjects.forAll(Q=>{const V=w.squaredDistance(P,Q.obb.center);Q.renderable.meta.cameraDepthSquared=V})};R.getMaterial=function(S){return S.renderable.material};R.updateMaterial=function(S,P){S=S.renderable.material;P(S);S.dirty&&this._notifyDirty()};R.setAllComponentVisibilities=
function(S,P){S.components.visibility.reset(P);S.components.visibilityDirty();this._notifyDirty()};R.forEachVisibleComponent=function(S,P){return S.components.visibility.forEachComponent(P)};R.getComponentCount=function(S){const P=S.components.visibility.componentCount();return{visible:P,invisible:S.components.count-P}};R.setComponentData=function(S,P){const Q=S.renderable.material;if(n.isVaryingComponentParameters(P)){S=S.components;var V=S.materialDataBuffer;const ca=S.materialDataIndices,ba={castShadows:!0,
pickable:!0,externalColor:g.create(),externalColorMixMode:1};V=V.textureBuffer;const Z=new Uint8Array(4),ha=new Uint32Array(Z.buffer);let fa=0,aa=0,W=0,U=!1,X=0;for(let T=0;T<S.count;T++)P(T,ba),fa+=+(1>ba.externalColor[3]),aa+=+(3===ba.externalColorMixMode&&1===ba.externalColor[3]),W+=+ba.castShadows,d.encodeSymbolColor(ba.externalColor,ba.externalColorMixMode,Z),Z[2]=Z[2]&254|+ba.castShadows,V.setData(ca[T],0,Z[0],Z[1],Z[2],Z[3]),U=U||0<T&&X!==ha[0],X=ha[0],ba.pickable!==E.getVisibility(S.pickability,
T)&&(S.pickability=E.updateVisibilityWithCount(S.pickability,S.count,T,ba.pickable));U?(Q.componentParameters=new A.ComponentParametersVarying,Q.componentParameters.castShadows=W===S.count?0:0===W?2:1,Q.componentParameters.transparent=fa===S.count?0:0===fa?2:1,Q.componentParameters.opaqueOverride=aa===S.count?0:0===aa?2:1,Q.componentParameters.texture=V,V.updateTexture()):(Q.componentParameters=new A.ComponentParametersUniform,Q.componentParameters.castShadows=ba.castShadows?0:2,Q.componentParameters.externalColor=
ba.externalColor,Q.componentParameters.externalColorMixMode=ba.externalColorMixMode)}else Q.componentParameters=new A.ComponentParametersUniform,Q.componentParameters.castShadows=P.castShadows?0:2,Q.componentParameters.externalColor=P.externalColor,Q.componentParameters.externalColorMixMode=P.externalColorMixMode;this._notifyDirty()};R.getComponentAabb=function(S,P,Q){return S.intersectionGeometry.getComponentAabb(P,Q)};R.getComponentObb=function(S){return S.obb};R.getObjectTransform=function(S){return S.transform};
R.getComponentPositions=function(S,P,Q){return S.intersectionGeometry.getComponentPositions(P,Q)};R.intersect=function(S,P,Q,V,ca,ba){r.isSome(ca)&&(ca.localOrigin=S.transform.position);const Z=y.invert(I,S.transform.rotationScale);w.sub(F,P,S.transform.position);w.sub(L,Q,S.transform.position);w.transformMat3(F,F,Z);w.transformMat3(L,L,Z);P=y.transpose(I,Z);return S.intersectionGeometry.intersect(F,L,V,P,ca,ba)};R.addEdges=function(S,P,Q,V){const {indices:ca,positions:ba}=S.intersectionGeometry,
Z=S.components.offsets;return P.addComponentObject(S,S.transform,{center:S.obb.center,radius:c.radius(S.obb)},ba,ca,Z,Q,V)};R.addComponentHighlight=function(S,P){S=S.components;r.isNone(S.highlightCounts)&&(S.highlightCounts=new Uint32Array(S.count+1));0===S.highlightCounts[P]++&&(S.highlightsDirty(),this._notifyDirty());S.highlightCounts[S.count]++};R.removeComponentHighlight=function(S,P){S=S.components;if(r.isNone(S.highlightCounts))J.warn("Removing non-existing highlight.");else{var Q=S.highlightCounts[P],
V=S.highlightCounts[S.count];0===Q?J.warn("Removing non-existing highlight."):1<Q?(S.highlightCounts[P]=Q-1,S.highlightCounts[S.count]=V-1):(S.highlightCounts[P]=0,S.highlightsDirty(),this._notifyDirty(),1===V?S.highlightCounts=null:S.highlightCounts[S.count]=V-1)}};R.clearHighlights=function(S){S=S.components;r.isSome(S.highlightCounts)&&(S.highlightCounts=null,S.highlightsDirty(),this._notifyDirty())};R.getObjectGPUMemoryUsage=function(S){return S.renderable.meta.gpuMemoryEstimate};R._createRenderable=
function(S,P){const Q=this._renderManager.rctx;var V=S.geometry,ca=V.vertices.layoutParameters,ba=M.createVertex(Q,35044,V.vertices.data);const Z=r.applySome(V.indices,U=>M.createIndex(Q,35044,U));var ha=u.glLayout(C.createVertexBufferLayout(ca)),fa=new Uint16Array(V.vertices.count);for(var aa=0;aa<P.count;aa++){var W=P.offsets[aa];const U=P.offsets[aa+1],X=P.materialDataIndices[aa];if(r.isSome(V.indices))for(;W<U;W++)fa[V.indices[W]]=X;else for(;W<U;W++)fa[W]=X}V=M.createVertex(Q,35044,fa.buffer);
fa=new D.TwoVectorPosition(S.transform.position);aa=f.clone(S.transform.rotationScale);y.invert(aa,aa);y.transpose(aa,aa);P=new B.ComponentDrawParameters;w.copy(P.worldFromModel_TL,fa.low);w.copy(P.worldFromModel_TH,fa.high);y.copy(P.worldFromModel_RS,S.transform.rotationScale);y.copy(P.transformNormal_GlobalFromModel,aa);l.copy(P.toMapSpace,S.toMapSpace);S=new A.ComponentMaterial;ha=new H(Q,S.attributeLocations,{data:ha,componentIndices:O},{data:ba,componentIndices:V},r.unwrap(Z));ca=new v.RenderGeometry(ha,
4,ca,r.isSome(Z));ba={cameraDepthSquared:.5,gpuMemoryEstimate:ba.byteSize+V.byteSize+(r.isSome(Z)?Z.byteSize:0)};return new k.Renderable(S,P,ca,ba)};R._notifyDirty=function(){this._renderManager.notifyDirty()};p._createClass(N,[{key:"visibleObjects",get:function(){return this._objects[1]}}]);return N}();const O=u.glLayout(t.newLayout().u16("componentIndex")),I=f.create(),F=e.create(),L=e.create();a.ComponentObjectCollection=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf32 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ./dito".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){function t(B=[0,0,0],D=[-1,-1,-1],E=[0,0,0,1]){return{center:e.clone(B),halfSize:w.clone(D),quaternion:q.clone(E)}}function h(B,D){const E=c.signedDistance(D,B.center);B=m(B,c.normal(D));return E>B?1:E<-B?-1:0}function m(B,D){r.conjugate(n,B.quaternion);f.transformQuat(z,D,n);B=B.halfSize;return Math.abs(z[0]*B[0])+Math.abs(z[1]*B[1])+Math.abs(z[2]*B[2])}const n=y.create(),z=e.create(),k=e.create(),v=g.create(),x=b.create(),C=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,
1.2],A=(()=>{const B=new Int8Array(162);let D=0;const E=G=>{for(let K=0;K<G.length;K++)B[D+K]=G[K];D+=6};E([6,2,3,1,5,4]);E([0,2,3,1,5,4]);E([0,2,3,7,5,4]);E([0,1,3,2,6,4]);E([0,1,3,2,0,0]);E([0,1,5,7,3,2]);E([0,1,3,7,6,4]);E([0,1,3,7,6,2]);E([0,1,5,7,6,2]);E([0,1,5,4,6,2]);E([0,1,5,4,0,0]);E([0,1,3,7,5,4]);E([0,2,6,4,0,0]);E([0,0,0,0,0,0]);E([1,3,7,5,0,0]);E([2,3,7,6,4,0]);E([2,3,7,6,0,0]);E([2,3,1,5,7,6]);E([0,1,5,7,6,2]);E([0,1,5,7,6,4]);E([0,1,3,7,6,4]);E([4,5,7,6,2,0]);E([4,5,7,6,0,0]);E([4,
5,1,3,7,6]);E([0,2,3,7,5,4]);E([6,2,3,7,5,4]);E([6,2,3,1,5,4]);return B})();a.ObbArray=function(B){this.buffer=new ArrayBuffer(56*B);this.obbs=Array(B);for(let D=0;D<B;D++)this.obbs[D]={center:e.createView(this.buffer,56*D),halfSize:w.createView(this.buffer,56*D+24),quaternion:q.createView(this.buffer,56*D+36)}};a.clone=function(B){return t(B.center,B.halfSize,B.quaternion)};a.compute=function(B,D){D=D||t();u.computeOBB(B,D);return D};a.corners=function(B,D){for(let E=0;8>E;++E){const G=D[E];G[0]=
E&1?-B.halfSize[0]:B.halfSize[0];G[1]=E&2?-B.halfSize[1]:B.halfSize[1];G[2]=E&4?-B.halfSize[2]:B.halfSize[2];f.transformQuat(G,G,B.quaternion);f.add(G,G,B.center)}};a.create=t;a.intersectLine=function(B,D,E,G=0){r.conjugate(n,B.quaternion);f.subtract(z,D,B.center);D=f.transformQuat(z,z,n);E=f.transformQuat(k,E,n);let K=-Infinity,M=Infinity;for(let H=0;3>H;H++)if(1E-6<Math.abs(E[H])){const J=(G+B.halfSize[H]-D[H])/E[H],O=(-G-B.halfSize[H]-D[H])/E[H];K=Math.max(K,Math.min(J,O));M=Math.min(M,Math.max(J,
O))}else if(D[H]>B.halfSize[H]+G||D[H]<-B.halfSize[H]-G)return!1;return K<=M};a.intersectPlane=h;a.isVisible=function(B,D){return 0>=h(B,D[0])&&0>=h(B,D[1])&&0>=h(B,D[2])&&0>=h(B,D[3])&&0>=h(B,D[4])&&0>=h(B,D[5])};a.maximumDistancePlane=function(B,D){const E=c.signedDistance(D,B.center);B=m(B,c.normal(D));return E+B};a.minimumDistancePlane=function(B,D){const E=c.signedDistance(D,B.center);B=m(B,c.normal(D));return E-B};a.projectedArea=function(B,D,E,G,K){r.conjugate(n,B.quaternion);f.sub(z,D,B.center);
f.transformQuat(z,z,n);var M=z[0]<-B.halfSize[0]?-1:z[0]>B.halfSize[0]?1:0,H=z[1]<-B.halfSize[1]?-1:z[1]>B.halfSize[1]?1:0,J=z[2]<-B.halfSize[2]?-1:z[2]>B.halfSize[2]?1:0;D=Math.abs(M)+Math.abs(H)+Math.abs(J);if(0===D)return Infinity;D=1===D?4:6;M=6*(M+3*H+9*J+13);p.fromQuat(x,B.quaternion);p.scale(x,x,B.halfSize);for(H=0;H<D;H++)J=A[M+H],f.set(z,((J&1)<<1)-1,(J&2)-1,((J&4)>>1)-1),f.transformMat3(z,z,x),f.add(v,B.center,z),v[3]=1,l.transformMat4(v,v,E),J=1/Math.max(1E-6,v[3]),C[2*H]=v[0]*J,C[2*H+
1]=v[1]*J;B=2*D-2;E=C[0]*(C[3]-C[B+1])+C[B]*(C[1]-C[B-1]);for(D=2;D<B;D+=2)E+=C[D]*(C[D+3]-C[D-1]);return Math.abs(E)*G*K*.125};a.projectedRadius=m;a.radius=function(B){return f.len(B.halfSize)};a.set=function(B,D){f.copy(D.center,B.center);f.copy(D.halfSize,B.halfSize);r.copy(D.quaternion,B.quaternion)};a.toAaBoundingBox=function(B,D){D||(D=d.create());var E=p.fromQuat(x,B.quaternion);const G=B.halfSize[0]*Math.abs(E[0])+B.halfSize[1]*Math.abs(E[3])+B.halfSize[2]*Math.abs(E[6]),K=B.halfSize[0]*Math.abs(E[1])+
B.halfSize[1]*Math.abs(E[4])+B.halfSize[2]*Math.abs(E[7]);E=B.halfSize[0]*Math.abs(E[2])+B.halfSize[1]*Math.abs(E[5])+B.halfSize[2]*Math.abs(E[8]);D[0]=B.center[0]-G;D[1]=B.center[1]-K;D[2]=B.center[2]-E;D[3]=B.center[0]+G;D[4]=B.center[1]+K;D[5]=B.center[2]+E;return D};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function p(){const f=new Float32Array(4);f[3]=1;return f}function b(f){const w=new Float32Array(4);w[0]=f[0];w[1]=
f[1];w[2]=f[2];w[3]=f[3];return w}function r(f,w,e,l){const g=new Float32Array(4);g[0]=f;g[1]=w;g[2]=e;g[3]=l;return g}function q(f,w){return new Float32Array(f,w,4)}var y=Object.freeze({__proto__:null,create:p,clone:b,fromValues:r,createView:q});a.clone=b;a.create=p;a.createView=q;a.fromValues=r;a.quatf32=y})},"esri/views/3d/support/dito":function(){define(["exports"],function(a){function p(Z,ha,fa,aa,W,U){if(!(1E-6>ha[0]*ha[0]+ha[1]*ha[1]+ha[2]*ha[2]))for(d(E,fa,ha),d(G,aa,ha),d(K,W,ha),b(Z,ha,
D),H[1]=D[0],M[1]=D[1],J[1]=M[1]-H[1],fa=[fa,aa,W],aa=[E,G,K],W=0;3>W;++W){b(Z,fa[W],D);H[0]=D[0];M[0]=D[1];b(Z,aa[W],D);H[2]=D[0];M[2]=D[1];J[0]=M[0]-H[0];J[2]=M[2]-H[2];const X=f(J);X<U.quality&&(g(U.b0,fa[W]),g(U.b1,ha),g(U.b2,aa[W]),U.quality=X)}}function b(Z,ha,fa){const {data:aa,size:W}=Z;fa[0]=Number.POSITIVE_INFINITY;fa[1]=Number.NEGATIVE_INFINITY;for(Z=0;Z<aa.length;Z+=W){const U=aa[Z]*ha[0]+aa[Z+1]*ha[1]+aa[Z+2]*ha[2];fa[0]=Math.min(fa[0],U);fa[1]=Math.max(fa[1],U)}}function r(Z,ha,fa){g(fa.center,
Z);l(fa.halfSize,ha,.5);fa.quaternion[0]=0;fa.quaternion[1]=0;fa.quaternion[2]=0;fa.quaternion[3]=1}function q(Z,ha,fa,aa,W,U){b(Z,ha,D);W[0]=D[0];U[0]=D[1];b(Z,fa,D);W[1]=D[0];U[1]=D[1];b(Z,aa,D);W[2]=D[0];U[2]=D[1]}function y(Z,ha,fa,aa,W,U,X){Q[0]=Z[0];Q[1]=Z[1];Q[2]=Z[2];Q[3]=ha[0];Q[4]=ha[1];Q[5]=ha[2];Q[6]=fa[0];Q[7]=fa[1];Q[8]=fa[2];var T=X.quaternion,Y=Q,ea=Y[0]+Y[4]+Y[8];if(0<ea)ea=Math.sqrt(ea+1),T[3]=.5*ea,ea=.5/ea,T[0]=(Y[5]-Y[7])*ea,T[1]=(Y[6]-Y[2])*ea,T[2]=(Y[1]-Y[3])*ea;else{ea=0;Y[4]>
Y[0]&&(ea=1);Y[8]>Y[3*ea+ea]&&(ea=2);const ia=(ea+1)%3,la=(ea+2)%3;let pa=Math.sqrt(Y[3*ea+ea]-Y[3*ia+ia]-Y[3*la+la]+1);T[ea]=.5*pa;pa=.5/pa;T[3]=(Y[3*ia+la]-Y[3*la+ia])*pa;T[ia]=(Y[3*ia+ea]+Y[3*ea+ia])*pa;T[la]=(Y[3*la+ea]+Y[3*ea+la])*pa}w(V,aa,W);l(V,V,.5);l(X.center,Z,V[0]);l(P,ha,V[1]);w(X.center,X.center,P);l(P,fa,V[2]);w(X.center,X.center,P);l(X.halfSize,U,.5)}function f(Z){return Z[0]*Z[1]+Z[0]*Z[2]+Z[1]*Z[2]}function w(Z,ha,fa){Z[0]=ha[0]+fa[0];Z[1]=ha[1]+fa[1];Z[2]=ha[2]+fa[2]}function e(Z,
ha,fa){Z[0]=ha[0]-fa[0];Z[1]=ha[1]-fa[1];Z[2]=ha[2]-fa[2]}function l(Z,ha,fa){Z[0]=ha[0]*fa;Z[1]=ha[1]*fa;Z[2]=ha[2]*fa}function g(Z,ha,fa=0){Z[0]=ha[fa+0];Z[1]=ha[fa+1];Z[2]=ha[fa+2]}function d(Z,ha,fa){const aa=ha[0],W=ha[1];ha=ha[2];const U=fa[0],X=fa[1];fa=fa[2];Z[0]=W*fa-ha*X;Z[1]=ha*U-aa*fa;Z[2]=aa*X-W*U}function c(Z,ha){var fa=ha[0]*ha[0]+ha[1]*ha[1]+ha[2]*ha[2];0<fa&&(fa=1/Math.sqrt(fa),Z[0]=ha[0]*fa,Z[1]=ha[1]*fa,Z[2]=ha[2]*fa)}function u(Z,ha){const fa=ha[0]-Z[0],aa=ha[1]-Z[1];Z=ha[2]-Z[2];
return fa*fa+aa*aa+Z*Z}const t=[0,0,0],h=[0,0,0],m=[0,0,0],n=[0,0,0],z=[0,0,0],k=[0,0,0],v=[0,0,0],x=[0,0,0],C=[0,0,0],A=[0,0,0],B=[0,0,0],D=[0,0],E=[0,0,0],G=[0,0,0],K=[0,0,0],M=[0,0,0],H=[0,0,0],J=[0,0,0],O=[0,0,0],I=[0,0,0],F=[0,0,0],L=[0,0,0],N=[0,0,0],R=[0,0,0],S=[0,0,0],P=[0,0,0],Q=[1,0,0,0,1,0,0,0,1],V=[0,0,0];let ca=function(Z){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var ha=0;this.minProj=new Float64Array(this.buffer,ha,7);ha+=56;this.maxProj=new Float64Array(this.buffer,
ha,7);ha+=56;for(var fa=0;7>fa;++fa)this.minVert[fa]=new Float64Array(this.buffer,ha,3),ha+=24;for(fa=0;7>fa;++fa)this.maxVert[fa]=new Float64Array(this.buffer,ha,3),ha+=24;for(ha=0;7>ha;++ha)this.minProj[ha]=Number.POSITIVE_INFINITY,this.maxProj[ha]=Number.NEGATIVE_INFINITY;ha=Array(7);fa=Array(7);const {data:aa,size:W}=Z;for(Z=0;Z<aa.length;Z+=W){var U=aa[Z];U<this.minProj[0]&&(this.minProj[0]=U,ha[0]=Z);U>this.maxProj[0]&&(this.maxProj[0]=U,fa[0]=Z);U=aa[Z+1];U<this.minProj[1]&&(this.minProj[1]=
U,ha[1]=Z);U>this.maxProj[1]&&(this.maxProj[1]=U,fa[1]=Z);U=aa[Z+2];U<this.minProj[2]&&(this.minProj[2]=U,ha[2]=Z);U>this.maxProj[2]&&(this.maxProj[2]=U,fa[2]=Z);U=aa[Z]+aa[Z+1]+aa[Z+2];U<this.minProj[3]&&(this.minProj[3]=U,ha[3]=Z);U>this.maxProj[3]&&(this.maxProj[3]=U,fa[3]=Z);U=aa[Z]+aa[Z+1]-aa[Z+2];U<this.minProj[4]&&(this.minProj[4]=U,ha[4]=Z);U>this.maxProj[4]&&(this.maxProj[4]=U,fa[4]=Z);U=aa[Z]-aa[Z+1]+aa[Z+2];U<this.minProj[5]&&(this.minProj[5]=U,ha[5]=Z);U>this.maxProj[5]&&(this.maxProj[5]=
U,fa[5]=Z);U=aa[Z]-aa[Z+1]-aa[Z+2];U<this.minProj[6]&&(this.minProj[6]=U,ha[6]=Z);U>this.maxProj[6]&&(this.maxProj[6]=U,fa[6]=Z)}for(Z=0;7>Z;++Z)U=ha[Z],g(this.minVert[Z],aa,U),U=fa[Z],g(this.maxVert[Z],aa,U)},ba=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};a.computeOBB=function(Z,ha){const {data:fa,size:aa}=Z;var W=fa.length/aa;if(!(0>=W)){var U=new ca(Z);w(t,U.minProj,U.maxProj);l(t,t,.5);e(h,U.maxProj,U.minProj);var X=f(h),T=new ba;T.quality=X;14>W&&(Z={data:new Float64Array(U.buffer,
112,42),size:3});var Y=[0,0,0],ea=[0,0,0],ia=[0,0,0];W=[0,0,0];var la=[0,0,0],pa=[0,0,0],ua=[0,0,0];var wa=Z;var Fa=u(U.maxVert[0],U.minVert[0]),La=0;for(var Ma=1;7>Ma;++Ma){const Sa=u(U.maxVert[Ma],U.minVert[Ma]);Sa>Fa&&(Fa=Sa,La=Ma)}g(Y,U.minVert[La]);g(ea,U.maxVert[La]);if(1E-6>u(Y,ea))wa=1;else{e(W,Y,ea);c(W,W);{const {data:Sa,size:Ia}=wa;U=Number.NEGATIVE_INFINITY;Fa=0;for(La=0;La<Sa.length;La+=Ia)B[0]=Sa[La]-Y[0],B[1]=Sa[La+1]-Y[1],B[2]=Sa[La+2]-Y[2],Ma=W[0]*B[0]+W[1]*B[1]+W[2]*B[2],Ma=B[0]*
B[0]+B[1]*B[1]+B[2]*B[2]-Ma*Ma/(W[0]*W[0]+W[1]*W[1]+W[2]*W[2]),Ma>U&&(U=Ma,Fa=La);g(ia,Sa,Fa)}1E-6>U?wa=2:(e(la,ea,ia),c(la,la),e(pa,ia,Y),c(pa,pa),d(ua,la,W),c(ua,ua),p(wa,ua,W,la,pa,T),wa=0)}switch(wa){case 1:r(t,h,ha);return;case 2:X=Z;g(I,W);Math.abs(W[0])>Math.abs(W[1])&&Math.abs(W[0])>Math.abs(W[2])?I[0]=0:Math.abs(W[1])>Math.abs(W[2])?I[1]=0:I[2]=0;1E-6>I[0]*I[0]+I[1]*I[1]+I[2]*I[2]&&(I[0]=I[1]=I[2]=1);d(F,W,I);c(F,F);d(L,W,F);c(L,L);q(X,W,F,L,N,R);e(S,R,N);y(W,F,L,N,R,S,ha);return}wa=Z;{U=
D;const {data:Sa,size:Ia}=wa;g(n,Sa);g(m,n);U[0]=O[0]*ua[0]+O[1]*ua[1]+O[2]*ua[2];U[1]=U[0];for(Fa=Ia;Fa<Sa.length;Fa+=Ia)La=Sa[Fa]*ua[0]+Sa[Fa+1]*ua[1]+Sa[Fa+2]*ua[2],La<U[0]&&(U[0]=La,g(n,Sa,Fa)),La>U[1]&&(U[1]=La,g(m,Sa,Fa))}ua=Y[0]*ua[0]+Y[1]*ua[1]+Y[2]*ua[2];D[1]-1E-6<=ua&&(m[0]=void 0);D[0]+1E-6>=ua&&(n[0]=void 0);void 0!==m[0]&&(e(z,m,Y),c(z,z),e(k,m,ea),c(k,k),e(v,m,ia),c(v,v),d(x,k,W),c(x,x),d(C,v,la),c(C,C),d(A,z,pa),c(A,A),p(wa,x,W,k,z,T),p(wa,C,la,v,k,T),p(wa,A,pa,z,v,T));void 0!==n[0]&&
(e(z,n,Y),c(z,z),e(k,n,ea),c(k,k),e(v,n,ia),c(v,v),d(x,k,W),c(x,x),d(C,v,la),c(C,C),d(A,z,pa),c(A,A),p(wa,x,W,k,z,T),p(wa,C,la,v,k,T),p(wa,A,pa,z,v,T));q(Z,T.b0,T.b1,T.b2,N,R);Z=[0,0,0];e(Z,R,N);T.quality=f(Z);T.quality<X?y(T.b0,T.b1,T.b2,N,R,Z,ha):r(t,h,ha)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/typedArrayUtil",
"./IndexRange/ComponentRangeRunLengthEncoded","../../lib/AutoDisposable"],function(a,p,b,r,q){function y(f,w,e){const l=[],g=[];let d=e.length,c=e.length;w.forEachComponent(u=>{0<f[u]?(d!==u-1&&(l.length&&l.push(e[d+1]-l[l.length-1]),l.push(e[u])),d=u):(c!==u-1&&(g.length&&g.push(e[c+1]-g[g.length-1]),g.push(e[u])),c=u);return!0});l.length&&l.push(e[d+1]-l[l.length-1]);g.length&&g.push(e[c+1]-g[g.length-1]);return{highlightRanges:l,defaultRanges:g}}return function(f){function w(l,g){var d=f.call(this)||
this;d.pickability=null;d.highlightCounts=null;d.cachedGeometryRanges=null;d.cachedHighlightRanges=null;d.cachedDefaultRanges=null;d.offsets=b.slice(g);g=d.count;d.visibility=new r.ComponentRangeRunLengthEncoded(g);d.materialDataBuffer=l.getBuffer(g);d.materialDataIndices=new Uint16Array(g);for(l=0;l<g;l++)d.materialDataIndices[l]=d.materialDataBuffer.acquireIndex();return d}a._inheritsLoose(w,f);var e=w.prototype;e.dispose=function(){f.prototype.dispose.call(this);for(let l=0;l<this.count;l++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[l])};
e.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=null};e.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};e.updateCachedHighlightRanges=function(){if((p.isNone(this.cachedHighlightRanges)||p.isNone(this.cachedDefaultRanges))&&p.isSome(this.highlightCounts)){const {highlightRanges:l,defaultRanges:g}=y(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=l;this.cachedDefaultRanges=g}};a._createClass(w,[{key:"count",
get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){p.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(p.isNone(this.highlightCounts))return null;this.updateCachedHighlightRanges();return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",get:function(){if(p.isNone(this.highlightCounts))return this.geometryRanges;this.updateCachedHighlightRanges();
return this.cachedDefaultRanges}}]);return w}(q.AutoDisposable)})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){let p=function(){function b(q){this._totalCount=q;this._indexRanges=[0,q]}var r=b.prototype;r.componentCount=function(){const q=this._indexRanges;let y=0;for(let f=0;f<q.length;f+=2)y+=q[f+1];return y};r.reset=function(q){if("all"===q||q.length===this._totalCount)this._indexRanges=[0,this._totalCount];
else{{const w=[];if(0!==q.length){var y=q[0],f=1;for(let e=1;e<q.length;e++){const l=q[e];y+f===l?f+=1:(w.push(y),w.push(f),y=l,f=1)}w.push(y);w.push(f)}q=w}this._indexRanges=q}};r.forEachComponent=function(q){const y=this._indexRanges;for(let w=0;w<y.length;w+=2){var f=y[w];const e=f+y[w+1];for(;f<e;f++)if(!q(f))return!1}return!0};r.forEachComponentRange=function(q){const y=this._indexRanges;for(let f=0;f<y.length;f+=2){const w=y[f];if(!q(w,w+y[f+1]))return!1}return!0};r.computeOffsetRanges=function(q){const y=
Array(this._indexRanges.length),f=this._indexRanges;for(let e=0;e<f.length;e+=2){var w=f[e];const l=q[w];w=q[w+f[e+1]];y[e]=l;y[e+1]=w-l}return y};return b}();a.ComponentRangeRunLengthEncoded=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,p,b,r){let q=function(y){function f(){var w=
y.apply(this,arguments)||this;w.visible=0;return w}p._inheritsLoose(f,y);return f}(r.AutoDisposable);b.__decorate([r.autoDispose()],q.prototype,"renderable",void 0);b.__decorate([r.autoDispose()],q.prototype,"components",void 0);a.ComponentObject=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/interface":function(){define(["exports"],function(a){a.isVaryingComponentParameters=function(p){return"function"===typeof p};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/buffer/BufferView ./ComponentIntersectionData ../../lib/ComponentUtils ../../lib/geometryDataUtils ../../materials/internal/MaterialUtil".split(" "),function(a,p,b,r,q,y,f,w,e,l){let g=function(){function u(h,
m){this._indices=p.isSome(h.indices)?h.indices:e.generateDefaultIndexArray(h.positions.length/3);this._positions=new y.BufferViewVec3f(h.positions);this._components=m;this._componentIntersectionData=Array(m.count)}var t=u.prototype;t.getComponentAabb=function(h,m){if(p.isSome(this._perComponentAabbs)){for(let n=0;6>n;n++)m[n]=this._perComponentAabbs[6*h+n];return m}this._computePerComponentAabbs();return this.getComponentAabb(h,m)};t.getComponentPositions=function(h,m){m.indices=this._indices;m.data=
this._positions.typedBuffer;m.stride=this._positions.typedBufferStride;m.startIndex=this._components.offsets[h];m.endIndex=this._components.offsets[h+1]};t.intersect=function(h,m,n,z,k,v){const x={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},C=this._indices,A=this._components.offsets,B=l.computeInvDir(h,m,d);this._components.visibility.forEachComponent(D=>{if(!w.getVisibility(this._components.pickability,D))return!0;var E=this.getComponentAabb(D,c);p.isSome(k)&&
k.applyToAabb(E);if(!l.intersectAabbInvDir(E,h,B,n))return!0;E=A[D]/3;const G=A[D+1]/3,K=(H,J,O)=>{v(D,H,b.transformMat3(J,J,z),O)},M=G-E;p.isNone(k)&&M>f.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[D]&&(this._componentIntersectionData[D]=new f.ComponentIntersectionData(this._indices,E,G,x)),this._componentIntersectionData[D].intersectRay({r0:h,r1:m},K)):l.intersectTriangles(h,m,E,G,C,x,void 0,k,K);return!0})};t._computePerComponentAabbs=function(){const h=this._components.count;
this._perComponentAabbs=new Float32Array(6*h);for(let m=0;m<h;m++)this._computeAABB(m)};t._computeAABB=function(h){const m=this._indices,n=this._positions;var z=this._components.offsets,k=z[h];const v=z[h+1],x=[0,0,0];z=[Infinity,Infinity,Infinity];const C=[-Infinity,-Infinity,-Infinity];for(;k<v;k++)n.getVec(m[k],x),b.min(z,z,x),b.max(C,C,x);h*=6;this._perComponentAabbs[h++]=z[0];this._perComponentAabbs[h++]=z[1];this._perComponentAabbs[h++]=z[2];this._perComponentAabbs[h++]=C[0];this._perComponentAabbs[h++]=
C[1];this._perComponentAabbs[h]=C[2]};a._createClass(u,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return u}();const d=r.create(),c=q.create();return g})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],function(a){function p(b=!0){return{isVisibleBit:!b,data:new Uint32Array(0)}}a.defaultVisibilities=p;a.getVisibility=function(b,r){if(null==b)return!0;const {isVisibleBit:q,data:y}=b,f=8*y.BYTES_PER_ELEMENT;
return r<y.length*f?(b=r/f|0,r=0!==(y[b]&1<<r-b*f)===q):!b.isVisibleBit};a.updateVisibilityWithCount=function(b,r,q,y){if(q>=r)return b;null==b&&(b=p());let f=b.data;const w=8*f.BYTES_PER_ELEMENT,e=q/w|0,l=q-w*e,g=f;y=y===b.isVisibleBit;q<g.length*w||!y||(q=Math.max(e+1,Math.ceil(1.5*g.length)),q=Math.min(q,((r-1)/w|0)+1),f=new Uint32Array(q),f.set(g));e<f.length&&(f[e]=f[e]&~(1<<l)|(y?1:0)<<l);b.data=f;return b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],
function(a){let p=function(){function b(r,q,y,f){this.material=r;this.drawParameters=q;this.geometry=y;this.meta=f}b.prototype.dispose=function(){this.material.dispose();this.geometry.dispose()};return b}();a.Renderable=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,p,b,r){let q=
function(y){function f(w,e,l,g){var d=y.call(this)||this;d.primitiveType=e;d.parameters=l;d.indexed=g;d.vao=w;return d}p._inheritsLoose(f,y);return f}(r.AutoDisposable);b.__decorate([r.autoDispose()],q.prototype,"vao",void 0);a.RenderGeometry=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,p){let b=function(){function r(y){this._objects=y}var q=r.prototype;q.submit=function(y,
f){this._objects.preSubmit(f);this._objects.visibleObjects.forAll(w=>w.renderable.material.submit(y,w))};q.queryShadowCasterDepthRange=function(y){return this._objects.visibleObjects.length?p.computeDepthRange(y,this._objects.visibleObjects):null};return r}();a.RenderSubmitSystem=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){function d(K,M,H){return f.set(K,M.data[H+0],M.data[H+1],M.data[H+2])}function c(K,M){K.push(M[0]);K.push(M[1]);K.push(M[2])}function u(K,M,H,J){q.conjugate(C,K.quaternion);f.sub(A,M,K.center);f.transformQuat(A,A,C);const O=8*((A[0]<-K.halfSize[0]?-1:A[0]>K.halfSize[0]?1:0)+3*(A[1]<-K.halfSize[1]?-1:A[1]>K.halfSize[1]?1:0)+9*(A[2]<-K.halfSize[2]?-1:A[2]>K.halfSize[2]?1:0)+13);M=v[O];if(0===M)return M;b.fromQuat(x,K.quaternion);b.scale(x,x,K.halfSize);const I=(F,L)=>
{L=v[O+L+1];f.set(F,((L&1)<<1)-1,(L&2)-1,((L&4)>>1)-1);f.transformMat3(F,F,x);return f.add(F,K.center,F)};H.length=0;c(H,I(B,0));c(H,I(D,1));c(H,I(A,2));c(H,I(E,3));J(H);if(1===M)return M;H.length=0;c(H,B);c(H,E);c(H,I(A,4));c(H,I(G,5));J(H);if(2===M)return M;H.length=0;c(H,B);c(H,G);c(H,I(A,6));c(H,D);J(H);return M}const t=new p({allocator:K=>K||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:K=>{K.object=null;return K}}),h=g.empty(),m=w.create(),n=w.create(),z=new p({deallocator:null}),
k=new p({deallocator:null}),v=(()=>{const K=new Int8Array(216);let M=0;const H=J=>{for(let O=0;O<J.length;O++)K[M+O]=J[O];M+=8};H([3,0,6,2,3,1,5,4]);H([2,0,2,3,1,5,4,0]);H([3,1,0,2,3,7,5,4]);H([2,0,1,3,2,6,4,0]);H([1,0,1,3,2,0,0,0]);H([2,1,5,7,3,2,0,0]);H([3,2,0,1,3,7,6,4]);H([2,2,0,1,3,7,6,0]);H([3,3,0,1,5,7,6,2]);H([2,0,1,5,4,6,2,0]);H([1,0,1,5,4,0,0,0]);H([2,1,3,7,5,4,0,0]);H([1,0,2,6,4,0,0,0]);H([0,0,0,0,0,0,0,0]);H([1,1,3,7,5,0,0,0]);H([2,2,3,7,6,4,0,0]);H([1,2,3,7,6,0,0,0]);H([2,3,1,5,7,6,2,
0]);H([3,4,0,1,5,7,6,2]);H([2,5,7,6,4,0,1,0]);H([3,5,0,1,3,7,6,4]);H([2,4,5,7,6,2,0,0]);H([1,4,5,7,6,0,0,0]);H([2,5,1,3,7,6,4,0]);H([3,6,0,2,3,7,5,4]);H([2,6,2,3,7,5,4,0]);H([3,7,6,2,3,1,5,4]);return K})(),x=r.create(),C=y.create(),A=w.create(),B=w.create(),D=w.create(),E=w.create(),G=w.create();a.computeDepthRange=function(K,M){const H=g.empty(),{eye:J,frustum:O,viewForward:I}=K;M.forAll(F=>{var L=F.obb;const N=f.dot(f.sub(A,L.center,J),I),R=l.projectedRadius(L,I);if(!g.within(H,N-R)||!g.within(H,
N+R)){a:{var S=0;for(let P=0;4>P;P++){const Q=l.intersectPlane(L,O[P]);if(0<Q){L=-1;break a}0===Q&&(S|=1<<P)}L=S}-1!==L&&(0===L?(h.far=N+R,h.near=N-R,g.union(H,h)):(S=t.pushNew(),S.near=N-R,S.far=N+R,S.mask=L,S.object=F))}});for(K=0;K<t.length;K++){const F=t.data[K];g.within(H,F.near)&&g.within(H,F.far)||(h.far=F.far,h.near=Infinity,0===u(F.object.obb,J,z,L=>{var N=k;for(var R=0;4>R&&0<L.length;R++)if(0!==(F.mask&1<<R)){{var S=O[R],P=L,Q=N;Q.length=0;const V=P.length-3;d(m,P,V);const ca=e.signedDistance(S,
m);0>=ca&&(Q.push(m[0]),Q.push(m[1]),Q.push(m[2]));let ba=0,Z=ca;for(ba;ba<V;ba+=3){d(n,P,ba);const ha=e.signedDistance(S,n);0>Z*ha&&(f.lerp(m,n,m,ha/(ha-Z)),c(Q,m));0>=ha&&c(Q,n);Z=ha;f.copy(m,n)}0>Z*ca&&(d(n,P,V),f.lerp(m,n,m,ca/(ca-Z)),c(Q,m))}S=L;L=N;N=S}for(N=0;N<L.length;N+=3)f.set(m,L.data[N+0],L.data[N+1],L.data[N+2]),R=f.dot(f.sub(m,m,J),I),h.near=Math.min(h.near,R)})&&(h.near=0),g.union(H,h))}t.length=0;return H};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],
function(a){function p(r,q){return{near:r,far:q}}function b(r,q,y){r.near=q;r.far=y;return r}a.ZERO={near:0,far:0};a.create=p;a.empty=function(r){return r?b(r,Infinity,-Infinity):p(Infinity,-Infinity)};a.set=b;a.union=function(r,q,y=r){y.near=Math.min(r.near,q.near);y.far=Math.max(r.far,q.far);return y};a.within=function(r,q){return r.near<=q&&q<=r.far};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports",
"../../../support/buffer/InterleavedLayout"],function(a,p){a.createVertexBufferLayout=function(b){const r=p.newLayout().vec3f("position");b.normals&&r.vec2i16("normalCompressed",{glNormalized:!0});1===b.textureCoordinates?r.vec2f("uv0"):2===b.textureCoordinates&&(r.vec2f("uv0"),r.vec4u16("uvRegion",{glNormalized:!0}));b.colors&&r.vec4u8("color",{glNormalized:!0});return r.alignTo(4)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../../../chunks/vec4f64 ./ComponentTechnique ../../../../../../chunks/ComponentShader.glsl ../../../core/material/MaterialBase ../../../core/shaderLibrary/util/AlphaDiscard.glsl".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){function u(n){switch(n){case 0:return 0;case 1:return 7;case 2:return 1;case 3:return 2}}let t=function(n){function z(){var v=n.apply(this,arguments)||this;v.baseColor=w.fromValues(1,1,1,1);v.usePBR=!1;v.hasParametersFromSource=!1;v.mrrFactors=y.fromValues(1,1,.5);v.emissiveFactor=y.fromValues(0,0,0);v.baseColorTexture=null;v.metallicRoughnessTexture=null;v.emissionTexture=null;v.occlusionTexture=null;v.normalTexture=null;v.overlayTexOffset=e.fromValues(-1,-1,-1,
-1);v.overlayTexScale=e.fromValues(0,0,0,0);v.overlayColor=null;v.overlayHighlight=null;v.overlayNormal=null;v.objectOpacity=1;v.commonMaterialParameters=new h;v.componentParameters=new m;v.alphaCutoff=c.defaultMaskAlphaCutoff;v.alphaDiscardMode=1;v.isIntegratedMesh=!1;v.polygonOffsetEnabled=!1;v.ellipsoidMode=1;v.sceneHasOcludees=!1;v._techniqueConfig=new l.ComponentTechniqueConfiguration;return v}p._inheritsLoose(z,n);var k=z.prototype;k.dispose=function(){this._technique=r.releaseMaybe(this._technique);
this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};k.getTechnique=function(v,x,C){const A=this._techniqueConfig;A.hasVertexColors=C.colors;A.hasNormals=C.normals;A.vertexTextureCoordinates=C.textureCoordinates;A.usePBR=this.usePBR;A.hasMetalnessAndRoughnessTexture=r.isSome(this.metallicRoughnessTexture);A.hasEmissionTexture=r.isSome(this.emissionTexture);A.hasOcclusionTexture=r.isSome(this.occlusionTexture);A.hasNormalTexture=r.isSome(this.normalTexture);
A.transparencyPassType=0===x.identifier&&null!=x.transparencyPassType?x.transparencyPassType:3;A.multipassTerrainEnabled=0===x.identifier&&null!=x.multipassTerrainParams?x.multipassTerrainParams.multipassTerrainEnabled:!1;A.cullAboveGround=0===x.identifier&&null!=x.multipassTerrainParams?x.multipassTerrainParams.cullAboveGround:!1;A.ellipsoidMode=this.ellipsoidMode;this.dirty&&(A.componentData=this.componentParameters.type,A.cullFace=this.commonMaterialParameters.cullFace,A.doubleSidedMode=this.commonMaterialParameters.doubleSided?
1:0,A.baseColorTexture=r.isSome(this.baseColorTexture),A.isSchematic=this.hasParametersFromSource&&!r.isSome(this.baseColorTexture),C=this._computeWhichMaterialPass(),A.blendingEnabled=1===C||2===C,A.alphaDiscardMode=this.alphaDiscardMode,A.integratedMeshMode=this.isIntegratedMesh?this.overlayColor?this.overlayNormal?3:2:1:0,A.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());A.slicePlaneEnabled=x.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;1===x.identifier?(A.output=
3,A.vertexDiscardMode=0):2===x.identifier?(A.output=4,A.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?A.vertexDiscardMode=x.transparent?2:1:A.vertexDiscardMode=0,A.output=u(x.subPass),1===x.subPass&&(A.sceneHasOcludees=x.sceneHasOcludees),0===x.subPass?(A.receiveAmbientOcclusion=x.ambientOcclusionEnabled,A.sceneHasOcludees=x.sceneHasOcludees,A.receiveShadows=x.shadowsEnabled,A.ssrEnabled=x.ssrParams.ssrEnabled):(A.receiveAmbientOcclusion=!1,A.receiveShadows=!1));return this._technique=
v.releaseAndAcquire(l.ComponentTechnique,A,this._technique)};k.submit=function(v,x){if(0!==this.objectOpacity){var C=x.renderable.geometry,A=x.components,B=x.renderable.drawParameters;x=x.renderable.meta.cameraDepthSquared;var D=A.geometryRanges,E=A.highlightRanges;A=A.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case 0:v.materialOpaque.submitDraw(this,C,D,B,x);break;case 1:v.materialTransparent.submitDraw(this,C,D,B,x);break;case 2:v.materialOpaque.submitDraw(this,C,D,B,x);v.materialTransparent.submitDraw(this,
C,D,B,x);break;case 3:v.materialIntegratedMesh.submitDraw(this,C,D,B,x),this.overlayHighlight&&v.highlightIntegratedMesh.submitDraw(this,C,D,B,x)}var G=2!==this.componentParameters.castShadows;G&&v.shadowMap.submitDraw(this,C,D,B,x);r.isSome(E)&&(v.highlight.submitDraw(this,C,E,B,x),G&&v.highlightShadowMap.submitDraw(this,C,E,B,x));G&&r.isSome(A)&&v.defaultShadowMap.submitDraw(this,C,A,B,x)}};k._computeWhichMaterialPass=function(){return this.isIntegratedMesh?3:1>this.objectOpacity?1:0===this.componentParameters.opaqueOverride?
0:1>this.baseColor[3]||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2};p._createClass(z,[{key:"attributeLocations",get:function(){return g.attributeLocations}}]);return z}(d.MaterialBase);b.__decorate([d.parameter({vectorOps:f.vec4})],t.prototype,"baseColor",void 0);b.__decorate([d.parameter()],t.prototype,"usePBR",void 0);b.__decorate([d.parameter()],t.prototype,"hasParametersFromSource",void 0);b.__decorate([d.parameter({vectorOps:q.vec3})],
t.prototype,"mrrFactors",void 0);b.__decorate([d.parameter({vectorOps:q.vec3})],t.prototype,"emissiveFactor",void 0);b.__decorate([d.parameter({dispose:!0})],t.prototype,"baseColorTexture",void 0);b.__decorate([d.parameter({dispose:!0})],t.prototype,"metallicRoughnessTexture",void 0);b.__decorate([d.parameter({dispose:!0})],t.prototype,"emissionTexture",void 0);b.__decorate([d.parameter({dispose:!0})],t.prototype,"occlusionTexture",void 0);b.__decorate([d.parameter({dispose:!0})],t.prototype,"normalTexture",
void 0);b.__decorate([d.parameter({vectorOps:{equals:f.exactEquals,copy:f.copy}})],t.prototype,"overlayTexOffset",void 0);b.__decorate([d.parameter({vectorOps:{equals:f.exactEquals,copy:f.copy}})],t.prototype,"overlayTexScale",void 0);b.__decorate([d.parameter()],t.prototype,"overlayColor",void 0);b.__decorate([d.parameter()],t.prototype,"overlayHighlight",void 0);b.__decorate([d.parameter()],t.prototype,"overlayNormal",void 0);b.__decorate([d.parameter()],t.prototype,"objectOpacity",void 0);b.__decorate([d.parameterBlock()],
t.prototype,"commonMaterialParameters",void 0);b.__decorate([d.parameterBlock()],t.prototype,"componentParameters",void 0);b.__decorate([d.parameter()],t.prototype,"alphaCutoff",void 0);b.__decorate([d.parameter()],t.prototype,"alphaDiscardMode",void 0);b.__decorate([d.parameter()],t.prototype,"isIntegratedMesh",void 0);b.__decorate([d.parameter()],t.prototype,"polygonOffsetEnabled",void 0);b.__decorate([d.parameter()],t.prototype,"ellipsoidMode",void 0);b.__decorate([d.parameter()],t.prototype,"sceneHasOcludees",
void 0);let h=function(n){function z(){var k=n.apply(this,arguments)||this;k.doubleSided=!1;k.cullFace=2;k.slicePlaneEnabled=!0;return k}p._inheritsLoose(z,n);return z}(d.MaterialParameterBlock);b.__decorate([d.parameter()],h.prototype,"doubleSided",void 0);b.__decorate([d.parameter()],h.prototype,"cullFace",void 0);b.__decorate([d.parameter()],h.prototype,"slicePlaneEnabled",void 0);let m=function(n){function z(){var k=n.apply(this,arguments)||this;k.externalColor=w.fromValues(1,1,1,1);k.externalColorMixMode=
1;k.castShadows=0;return k}p._inheritsLoose(z,n);p._createClass(z,[{key:"transparent",get:function(){return 1>this.externalColor[3]?0:2}},{key:"opaqueOverride",get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2}},{key:"visible",get:function(){return 0<this.externalColor[3]?0:2}},{key:"type",get:function(){return 0}}]);return z}(d.MaterialParameterBlock);b.__decorate([d.parameter({vectorOps:f.vec4})],m.prototype,"externalColor",void 0);b.__decorate([d.parameter()],m.prototype,
"externalColorMixMode",void 0);b.__decorate([d.parameter()],m.prototype,"castShadows",void 0);q=function(n){function z(){var k=n.apply(this,arguments)||this;k.texture=null;k.transparent=2;k.opaqueOverride=2;k.castShadows=2;return k}p._inheritsLoose(z,n);p._createClass(z,[{key:"type",get:function(){return 1}}]);return z}(d.MaterialParameterBlock);b.__decorate([d.parameter()],q.prototype,"texture",void 0);b.__decorate([d.parameter()],q.prototype,"transparent",void 0);b.__decorate([d.parameter()],q.prototype,
"opaqueOverride",void 0);b.__decorate([d.parameter()],q.prototype,"castShadows",void 0);a.CommonMaterialParameters=h;a.ComponentMaterial=t;a.ComponentParametersUniform=m;a.ComponentParametersVarying=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v){h=function(x){function C(){return x.apply(this,arguments)||this}b._inheritsLoose(C,x);var A=C.prototype;A.bindPass=function(B){const D=this.program;l.VertexPosition.bindViewProjTransform(D,B.viewTransform);e.bindSliceUniforms(this.program,this.configuration,B.slicePlane);0===B.identifier&&(void 0!==B.ssrParams&&c.bindSSRUniforms(this.program,B.ssrParams),D.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",B.transformNormal_ViewFromGlobal),2===
B.subPass&&D.setUniform2fv("cameraNearFar",B.cameraNearFar),0===B.subPass&&B.lighting.setUniforms(this.program,B.integratedMesh));1===B.identifier&&this.program.setUniform2fv("cameraNearFar",B.cameraNearFar)};A.bindMaterial=function(B,D){const E=this.program;E.setUniform4fv("uBaseColor",B.baseColor);E.setUniform1f("uObjectOpacity",B.objectOpacity);E.setUniform1f("textureAlphaCutoff",B.alphaCutoff);1===B.componentParameters.type?B.componentParameters.texture.bind(E,"uComponentColorTex","uComponentColorTexInvDim"):
(E.setUniform4fv("uExternalColor",B.componentParameters.externalColor),E.setUniform1i("uExternalColorMixMode",B.componentParameters.externalColorMixMode));q.isSome(B.baseColorTexture)&&B.baseColorTexture.bind(E,"uBaseColorTexture","uBaseColorTextureSize");if(0===this.configuration.output||7===this.configuration.output)d.bindPBRUniforms(this.program,B,this.configuration.isSchematic),q.isSome(B.metallicRoughnessTexture)&&B.metallicRoughnessTexture.bind(E,"texMetallicRoughness","texMetallicRoughnessSize"),
q.isSome(B.emissionTexture)&&B.emissionTexture.bind(E,"texEmission","texEmissionSize"),q.isSome(B.occlusionTexture)&&B.occlusionTexture.bind(E,"texOcclusion","texOcclusionSize"),q.isSome(B.normalTexture)&&B.normalTexture.bind(E,"normalTexture","normalTextureSize");B.isIntegratedMesh&&(0===D.identifier&&0===D.subPass?(E.bindTexture(B.overlayColor,"ovColorTex"),E.bindTexture(B.overlayNormal,"ovNormalTex")):2===D.identifier&&E.bindTexture(B.overlayHighlight,"ovColorTex"),E.setUniform1f("overlayOpacity",
1));2===D.identifier&&g.bindOutputHighlight(this.program,D);0===D.identifier&&0===D.subPass&&(D.ambientOcclusionEnabled&&D.bindAmbientOcclusion(E),D.shadowsEnabled&&D.bindShadowMap(E));0!==D.identifier||0!==D.subPass&&1!==D.subPass||!D.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv("cameraNearFar",D.cameraNearFar),E.setUniform2fv("inverseViewport",D.inverseViewport),D.multipassTerrainParams.terrainLinearDepthTexture&&E.bindTexture(D.multipassTerrainParams.terrainLinearDepthTexture,
"terrainDepthTexture"))};A.bindDraw=function(B,D){l.VertexPosition.bindModelTransform(this.program,B);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",B.transformNormal_GlobalFromModel);this.program.rebindTextures();if(D.isIntegratedMesh){const E=D.overlayTexScale;D=D.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[B.toMapSpace[0]*E[0]+D[0],B.toMapSpace[1]*E[1]+D[1],B.toMapSpace[0]*E[2]+D[2],B.toMapSpace[1]*E[3]+D[3]]);this.program.setUniform4fv("overlayTexScale",
[B.toMapSpace[2]*E[0],B.toMapSpace[3]*E[1],B.toMapSpace[2]*E[2],B.toMapSpace[3]*E[3]])}};A.initializeProgram=function(B){const D=C.shader.get();var E=this.configuration;E=D.build({multipassTerrainEnabled:E.multipassTerrainEnabled,cullAboveGround:E.cullAboveGround,OITEnabled:0===E.transparencyPassType,output:E.output,normalType:0===E.integratedMeshMode?E.hasNormals?1:3:2,attributeColor:E.hasVertexColors,attributeTextureCoordinates:E.vertexTextureCoordinates,componentData:E.componentData,alphaDiscardMode:E.alphaDiscardMode,
baseColorTexture:E.baseColorTexture,doubleSidedMode:E.doubleSidedMode,receiveAmbientOcclusion:E.receiveAmbientOcclusion,receiveShadows:E.receiveShadows,slicePlaneEnabled:E.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:B.viewingMode,vertexDiscardMode:E.vertexDiscardMode,pbrMode:3===E.integratedMeshMode?4:E.usePBR?E.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:E.hasMetalnessAndRoughnessTexture,hasEmissionTexture:E.hasEmissionTexture,hasOcclusionTexture:E.hasOcclusionTexture,
hasNormalTexture:E.hasNormalTexture,vertexTangents:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:u.doublePrecisionRequiresObfuscation(B.rctx),overlayEnabled:2===E.integratedMeshMode||3===E.integratedMeshMode,ssrEnabled:E.ssrEnabled,highStepCount:!1,ellipsoidMode:E.ellipsoidMode});return new z.Program(B.rctx,E,D.attributeLocations)};A.setPipelineState=function(B){const D=this.configuration,E=0!==D.integratedMeshMode,G=3===B,K=2===B;return v.makePipelineState({blending:0!==D.output&&
7!==D.output||!D.blendingEnabled?null:G?n.blendingDefault:n.OITBlending(B),culling:v.cullingParams(D.cullFace),depthTest:{func:n.OITDepthTest(B)},depthWrite:G||K?v.defaultDepthWriteParams:null,colorWrite:v.defaultColorWriteParams,stencilWrite:E||D.sceneHasOcludees?k.stencilWriteMaskOn:null,stencilTest:E?k.replaceBitWhenDepthTestPasses(1):D.sceneHasOcludees?k.stencilBaseAllZerosParams:null,polygonOffset:G||K?D.polygonOffsetEnabled?{factor:2,units:2}:null:n.OITPolygonOffset})};A.initializePipeline=
function(){return this.setPipelineState(this.configuration.transparencyPassType)};return C}(h.ShaderTechnique);h.shader=new t.ReloadableShaderModule(w.ComponentShader,()=>new Promise(function(x,C){a(["./shader/ComponentShader.glsl"],x,C)}));w=function(x){function C(){var A=x.apply(this,arguments)||this;A.transformNormal_GlobalFromModel=y.create();A.toMapSpace=f.create();return A}b._inheritsLoose(C,x);return C}(l.VertexPosition.ModelTransform);t=function(x){function C(){var A=x.apply(this,arguments)||
this;A.output=0;A.hasVertexColors=!1;A.hasNormals=!1;A.vertexTextureCoordinates=0;A.componentData=0;A.slicePlaneEnabled=!1;A.cullFace=2;A.baseColorTexture=!1;A.receiveAmbientOcclusion=!0;A.receiveShadows=!0;A.vertexDiscardMode=0;A.doubleSidedMode=2;A.blendingEnabled=!0;A.alphaDiscardMode=1;A.integratedMeshMode=0;A.ssrEnabled=!1;A.polygonOffsetEnabled=!1;A.usePBR=!1;A.isSchematic=!1;A.hasMetalnessAndRoughnessTexture=!1;A.hasEmissionTexture=!1;A.hasOcclusionTexture=!1;A.hasNormalTexture=!1;A.sceneHasOcludees=
!1;A.transparencyPassType=3;A.ellipsoidMode=1;A.multipassTerrainEnabled=!1;A.cullAboveGround=!1;return A}b._inheritsLoose(C,x);return C}(m.ShaderTechniqueConfiguration);r.__decorate([m.parameter({count:8})],t.prototype,"output",void 0);r.__decorate([m.parameter()],t.prototype,"hasVertexColors",void 0);r.__decorate([m.parameter()],t.prototype,"hasNormals",void 0);r.__decorate([m.parameter({count:3})],t.prototype,"vertexTextureCoordinates",void 0);r.__decorate([m.parameter({count:2})],t.prototype,"componentData",
void 0);r.__decorate([m.parameter()],t.prototype,"slicePlaneEnabled",void 0);r.__decorate([m.parameter({count:3})],t.prototype,"cullFace",void 0);r.__decorate([m.parameter()],t.prototype,"baseColorTexture",void 0);r.__decorate([m.parameter()],t.prototype,"receiveAmbientOcclusion",void 0);r.__decorate([m.parameter()],t.prototype,"receiveShadows",void 0);r.__decorate([m.parameter({count:3})],t.prototype,"vertexDiscardMode",void 0);r.__decorate([m.parameter({count:3})],t.prototype,"doubleSidedMode",
void 0);r.__decorate([m.parameter()],t.prototype,"blendingEnabled",void 0);r.__decorate([m.parameter({count:4})],t.prototype,"alphaDiscardMode",void 0);r.__decorate([m.parameter({count:4})],t.prototype,"integratedMeshMode",void 0);r.__decorate([m.parameter()],t.prototype,"ssrEnabled",void 0);r.__decorate([m.parameter()],t.prototype,"polygonOffsetEnabled",void 0);r.__decorate([m.parameter()],t.prototype,"usePBR",void 0);r.__decorate([m.parameter()],t.prototype,"isSchematic",void 0);r.__decorate([m.parameter()],
t.prototype,"hasMetalnessAndRoughnessTexture",void 0);r.__decorate([m.parameter()],t.prototype,"hasEmissionTexture",void 0);r.__decorate([m.parameter()],t.prototype,"hasOcclusionTexture",void 0);r.__decorate([m.parameter()],t.prototype,"hasNormalTexture",void 0);r.__decorate([m.parameter()],t.prototype,"sceneHasOcludees",void 0);r.__decorate([m.parameter({count:4})],t.prototype,"transparencyPassType",void 0);r.__decorate([m.parameter({count:4})],t.prototype,"ellipsoidMode",void 0);r.__decorate([m.parameter()],
t.prototype,"multipassTerrainEnabled",void 0);r.__decorate([m.parameter()],t.prototype,"cullAboveGround",void 0);p.ComponentDrawParameters=w;p.ComponentTechnique=h;p.ComponentTechniqueConfiguration=t;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B){function D(K){const M=new B.ShaderBuilder;M.include(l.VertexPosition,K);M.include(e.VertexNormal,K);M.include(w.VertexColor,K);M.include(f.TextureCoordinateAttribute,K);M.include(q.ForwardLinearDepth,K);M.include(b.ComponentData,K);M.include(C.DiscardOrAdjustAlpha,K);M.include(y.Slice,K);M.include(k.ReadBaseColorTexture,K);M.include(r.VertexDiscardByOpacity,K);M.fragment.uniforms.add("view","mat4");if(1===K.pbrMode||2===K.pbrMode)M.include(z.PhysicallyBasedRenderingParameters,
K),K.hasNormalTexture&&M.include(t.ComputeNormalTexture,K);3===K.output&&1===K.componentData?M.vertex.code.add(A.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):M.vertex.code.add(A.glsl`#define discardShadows(castShadows) {}`);const H=K.overlayEnabled&&0===K.output&&4===K.pbrMode;K.overlayEnabled&&(M.include(x.Overlay,K),1===K.viewingMode?M.vertex.code.add(A.glsl`
      const float invEllipsoidRadius = ${A.glsl.float(1/(1===K.ellipsoidMode?p.earth.radius:2===K.ellipsoidMode?p.mars.radius:p.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):M.vertex.code.add(A.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));H&&(M.varyings.add("tbnTangent","vec3"),M.varyings.add("tbnBiTangent","vec3"),M.varyings.add("groundNormal","vec3"),M.varyings.add("positionView","vec3"));M.vertex.code.add(A.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${A.glsl.float(C.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
      forwardPosition();
      forwardNormal();
      ${H?A.glsl`
        positionView = position_view();
        ${1===K.viewingMode?A.glsl`
        groundNormal = normalize(positionWorld());
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:A.glsl`
        groundNormal = vec3(0.0, 0.0, 1.0);
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`}
        `:""}

      ${K.overlayEnabled?A.glsl`setOverlayVTC(projectOverlay(position));`:""}
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth(); // depends on forwardPosition()
    }
  `);7===K.output&&(M.fragment.include(c.ReadLinearDepth),K.multipassTerrainEnabled&&M.include(n.multipassTerrainTest,K),M.include(u.ComputeMaterialColor,K),M.fragment.code.add(A.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${K.multipassTerrainEnabled?A.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${K.overlayEnabled?A.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `));0===K.output&&(M.fragment.include(c.ReadLinearDepth),K.multipassTerrainEnabled&&M.include(n.multipassTerrainTest,K),M.include(u.ComputeMaterialColor,K),M.include(h.ComputeShadingNormal,K),M.include(m.EvaluateSceneLighting,K),H&&M.fragment.uniforms.add("ovNormalTex","sampler2D"),K.receiveShadows?(M.include(v.ReadShadowMap,K),M.fragment.code.add(A.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):M.fragment.code.add(A.glsl`float evaluateShadow() { return 0.0; }`),M.fragment.code.add(A.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${K.multipassTerrainEnabled?A.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${K.overlayEnabled?A.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}
    `),1===K.pbrMode||2===K.pbrMode?(M.fragment.code.add(A.glsl`
        ${1===K.pbrMode?A.glsl`
        applyPBRFactors();
        if (int(externalColorMixMode) == 3) {
          mrr = vec3(0.0, 0.6, 0.2);
        }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),K.hasNormalTexture?M.fragment.code.add(A.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):M.fragment.code.add(A.glsl`vec3 shadingNormal = normalVertex;`),M.fragment.code.add(A.glsl`${1===K.viewingMode?A.glsl`vec3 normalGround = normalize(positionWorld());`:A.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),M.fragment.code.add(A.glsl`vec3 viewDir = normalize(vPositionWorldCameraRelative);
float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());
vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);`)):(K.receiveShadows?M.fragment.code.add(A.glsl`float shadow = evaluateShadow();`):1===K.viewingMode?M.fragment.code.add(A.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`):M.fragment.code.add(A.glsl`float shadow = 0.0;`),M.fragment.code.add(A.glsl`
      float ambientOcclusion = evaluateAmbientOcclusion();
      // At global scale we create some additional ambient light based on the main light to simulate global illumination
      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());
      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${H?A.glsl`
          vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
          float waterNormalLength = length(overlayWaterMask);
          if (waterNormalLength > 0.95) {
            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);
            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);
            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
            // un-gamma the ground color to mix in linear space
            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
          }`:""}
      `)),M.fragment.code.add(A.glsl`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${K.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(1===K.output||3===K.output)M.include(g.OutputDepth,K),M.fragment.code.add(A.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);2===K.output&&(M.include(h.ComputeShadingNormal,K),M.fragment.code.add(A.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${2===K.normalType?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));4===K.output&&(M.include(d.OutputHighlight),M.fragment.code.add(A.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${K.overlayEnabled?A.glsl`
        vec4 overlayColor = getCombinedOverlayColor();

        if (overlayColor.a == 0.0) {
          gl_FragColor = vec4(0.0);
          return;
        }`:""}

        outputHighlight();
      }
    `));return M}const E=new Map([["position",0],["normal",1],["normalCompressed",1],["color",2],["uv0",3],["uvRegion",4],["componentIndex",5]]);var G=Object.freeze({__proto__:null,attributeLocations:E,build:D});a.ComponentShader=G;a.attributeLocations=E;a.build=D})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["exports","./DecodeSymbolColor.glsl","../../../../core/shaderModules/interfaces"],function(a,p,b){a.ComponentData=function(r,q){1===
q.componentData&&(r.vertex.uniforms.add("uComponentColorTex","sampler2D"),r.vertex.uniforms.add("uComponentColorTexInvDim","vec2"),r.attributes.add("componentIndex","float"),r.varyings.add("vExternalColorMixMode","mediump float"),r.varyings.add("vExternalColor","vec4"),r.include(p.DecodeSymbolColor),r.vertex.code.add(b.glsl`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y
);
return texture2D(uComponentColorTex, indexCoord);
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),r.fragment.code.add(b.glsl`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`));0===q.componentData&&(r.vertex.uniforms.add("uExternalColor","vec4"),r.fragment.uniforms.add("uExternalColorMixMode","int"),r.varyings.add("vExternalColor","vec4"),r.vertex.code.add(b.glsl`vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = uExternalColor;
castShadows = true;
return uExternalColor;
}`),r.fragment.code.add(b.glsl`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = uExternalColorMixMode;
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,p){a.VertexDiscardByOpacity=function(b,r){b=b.vertex;b.code.add(p.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(r.vertexDiscardMode){case 0:b.code.add(p.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);break;case 2:b.code.add(p.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);
break;case 1:b.code.add(p.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define(["exports","../attributes/VertexColor.glsl","../util/MixExternalColor.glsl","../../shaderModules/interfaces"],function(a,p,b,r){a.ComputeMaterialColor=function(q,y){q.include(p.VertexColor,
y);q.fragment.include(b.MixExternalColor);q=q.fragment;q.uniforms.add("uBaseColor","vec4");q.uniforms.add("uObjectOpacity","float");y.attributeColor?q.code.add(r.glsl`vec3 _baseColor() {
return uBaseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return uBaseColor.a * vColor.a;
}`):q.code.add(r.glsl`vec3 _baseColor() {
return uBaseColor.rgb;
}
float _baseOpacity() {
return uBaseColor.a;
}`);q.code.add(r.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = uObjectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define(["exports","../attributes/VertexNormal.glsl","../attributes/VertexPosition.glsl","../../shaderModules/interfaces"],function(a,p,b,r){a.ComputeShadingNormal=function(q,y){const f=q.fragment;0===y.doubleSidedMode?f.code.add(r.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`):1===y.doubleSidedMode?(q.include(b.VertexPosition,y),f.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),f.code.add(r.glsl`vec3 _adjustDoublesided(vec3 normal) {
vec3 viewDir = vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;
return dot(normal, viewDir) > 0.0 ? -normal : normal;
}`)):2===y.doubleSidedMode&&f.code.add(r.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);0===y.normalType||1===y.normalType?(q.include(p.VertexNormal,y),f.code.add(r.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`)):3===y.normalType?(q.extensions.add("GL_OES_standard_derivatives"),q.include(b.VertexPosition,y),f.code.add(r.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`)):2===y.normalType&&(1===y.viewingMode?(q.include(b.VertexPosition,y),f.code.add(r.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):2===y.viewingMode&&f.code.add(r.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),q.extensions.add("GL_OES_standard_derivatives"),f.code.add(r.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define(["exports","../attributes/VertexTextureCoordinates.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,p,b,r){a.ReadBaseColorTexture=function(q,y){const f=q.fragment;y.baseColorTexture?(q.include(p.VertexTextureCoordinates,y),f.uniforms.add("uBaseColorTexture","sampler2D"),f.uniforms.add("uBaseColorTextureSize",
"vec2"),2===y.attributeTextureCoordinates?(q.include(b.TextureAtlasLookup),f.code.add(r.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(
uBaseColorTexture,
uBaseColorTextureSize,
vuv0,
vuvRegion
);
}`)):f.code.add(r.glsl`vec4 readBaseColorTexture() {
return texture2D(uBaseColorTexture, vuv0);
}`)):f.code.add(r.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,p){let b=function(){function q(){this._dirty=!0}var y=q.prototype;y._setDirty=function(){this._dirty=!0};y._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const f of this._parameterBlocks)this[f]._setClean()};
y._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const f of this._parameterBlocks)if(this[f].dirty)return!0;return!1};p._createClass(q,[{key:"dirty",get:function(){return this._dirty||this._checkParameterBlocksDirty()}}]);return q}(),r=function(){function q(){this._dirty=!0}var y=q.prototype;y._setDirty=function(){this._dirty=!0};y._setClean=function(){this._dirty=!1};p._createClass(q,[{key:"dirty",get:function(){return this._dirty}}]);return q}();a.MaterialBase=
b;a.MaterialParameterBlock=r;a.parameter=function(q={}){return(y,f)=>{var w;const e=null!=(w=y._parameterCount)?w:0;y._parameterCount=e+1;if(q.vectorOps){const l=q.vectorOps;Object.defineProperty(y,f,{get(){return this[e]},set(g){const d=this[e];if(null==d)this[e]=g;else{if(l.equals(d,g))return;l.copy(d,g)}this._setDirty()}})}else Object.defineProperty(y,f,{get(){return this[e]},set(l){this[e]!==l&&(q.dispose&&this[e]&&this[e].dispose(),this[e]=l,this._setDirty())}})}};a.parameterBlock=function(){return(q,
y)=>{var f;const w=null!=(f=q._parameterCount)?f:0;q._parameterCount=w+1;q._parameterBlocks=q._parameterBlocks||[];q._parameterBlocks.push(w);Object.defineProperty(q,y,{get(){return this[w]},set(e){this[w]!==e&&(this[w]=e,this._setDirty())}})}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],
function(a,p,b,r,q){let y=function(){function w(l){this._low=r.create();this._high=r.create();l&&this.set(l)}var e=w.prototype;e.set=function(l){const g=this._low,d=this._high;b.copy(g,l);b.sub(d,l,g)};e.setElements=function(l,g,d){b.set(f,l,g,d);this.set(f)};e.get=function(l){return b.add(l,this._low,this._high)};e.getLowScaled=function(l){return b.scale(l,this._low,1)};p._createClass(w,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return w}();const f=
q.create();a.TwoVectorPosition=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],function(a,p){let b=function(){function r(y,f=1){this.rctx=y;this.fieldCount=f;this.buffers=[]}var q=r.prototype;q.garbageCollect=function(){this.buffers=this.buffers.filter(y=>0===y.activeCount?(y.dispose(),!1):!0)};q.destroy=function(){this.buffers.forEach(y=>y.dispose());this.buffers=
[]};q.getBuffer=function(y){for(const f of this.buffers)if(f.availableCount>=y)return f;if(y>p.MAX_INDEX_COUNT)return null;y=new p.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(y);return y};q.updateTextures=function(){for(const y of this.buffers)y.textureBuffer.updateTexture()};return r}();a.BufferManager=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./SimpleIndexManager","./TextureBackedBuffer"],function(a,p,b,r){let q=function(){function y(w,e=1){this.textureBuffer=new r.TextureBackedBuffer(w,e);this.indexManager=new b.SimpleIndexManager(65536)}var f=y.prototype;f.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};f.acquireIndex=function(){const w=this.indexManager.acquire();this.textureBuffer.resizeToFit(w);return w};f.releaseIndex=function(w){this.indexManager.release(w)};p._createClass(y,[{key:"availableCount",get:function(){return this.indexManager.availableCount}},
{key:"activeCount",get:function(){return this.indexManager.activeCount}}]);return y}();a.MAX_INDEX_COUNT=65536;a.ManagedTextureBackedBuffer=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,p){let b=function(){function r(y){this.maxCount=y;this._nextIndex=0;this.recycledIndices=[]}var q=r.prototype;q.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();
if(this.availableCount)return this._nextIndex++};q.release=function(y){this.recycledIndices.push(y)};p._createClass(r,[{key:"activeCount",get:function(){return this._nextIndex-this.recycledIndices.length}},{key:"availableCount",get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex}}]);return r}();a.SimpleIndexManager=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports",
"../../../../../geometry/support/buffer/BufferView","../../../../webgl/Texture"],function(a,p,b){let r=function(){function q(f,w=1){this.rctx=f;this.fieldCount=w;this.textureWidth=4096;this.dirty=!0;this.texture=new b(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new p.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var y=q.prototype;y.dispose=function(){this.texture.dispose();this.data=this.texture=
void 0};y.setData=function(f,w,e,l,g,d){f=f*this.fieldCount+w;this.dirty=!0;this.data.set(f,0,e);this.data.set(f,1,l);this.data.set(f,2,g);this.data.set(f,3,d)};y.setDataElement=function(f,w,e,l){f=f*this.fieldCount+w;this.dirty=!0;this.data.set(f,e,l)};y.resizeToFit=function(f){f*=this.fieldCount;f>=this.data.count&&(f=new p.BufferViewVec4u8(new ArrayBuffer(Math.ceil((f+1)/this.textureWidth)*this.textureWidth*4)),f.typedBuffer.set(this.data.typedBuffer),this.data=f)};y.updateTexture=function(){if(this.dirty){var f=
this.texture.descriptor.width;this.data.count>f*this.texture.descriptor.height&&this.texture.resize(f,this.data.count/f);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};y.bind=function(f,w,e){f.bindTexture(this.texture,w);f.setUniform2f(e,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return q}();a.TextureBackedBuffer=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define(["../../../../core/maybe",
"./glUtil3D","../shaders/CompositingTechnique","../../../webgl/Util"],function(a,p,b,r){let q=function(){function f(e,l){this._rctx=e;this._techniqueRepository=l}var w=f.prototype;w.dispose=function(){this._vao=a.disposeMaybe(this._vao)};w.compositeTransparent=function(e,l,g,d=1){const c=this._rctx;y.alphaMode=1;y.function=2;y.hasOpacityFactor=1!==d;d=this._techniqueRepository.acquire(b.CompositingTechnique,y);c.useProgram(d.program);d.bindPipelineState(c);d.program.bindTexture(e,"colorTexture");
d.program.bindTexture(l,"alphaTexture");d.program.bindTexture(g,"frontFaceTexture");e=this.ensureVAO();c.bindVAO(e);c.drawArrays(5,0,r.vertexCount(e,"geometry"));d.release()};w.compositeSpecial=function(e,l){this.composite(e,0,1,l)};w.composite=function(e,l=0,g=1,d=0,c=0){const u=this._rctx;y.alphaMode=l;y.function=d;y.hasOpacityFactor=1!==g;l=this._techniqueRepository.acquire(b.CompositingTechnique,y);u.useProgram(l.program);l.bindPipelineState(u);l.program.bindTexture(e,"tex");y.hasOpacityFactor&&
l.program.setUniform1f("opacity",g);3===d&&l.program.setUniform1i("overlayIdx",c);e=this.ensureVAO();u.bindVAO(e);u.drawArrays(5,0,r.vertexCount(e,"geometry"));l.release()};w.ensureVAO=function(){a.isNone(this._vao)&&(this._vao=p.createQuadVAO(this._rctx));return this._vao};return f}();const y=new b.CompositingTechniqueConfiguration;return q})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){y=function(d){function c(){return d.apply(this,arguments)||this}b._inheritsLoose(c,d);var u=c.prototype;u.initializeProgram=function(t){const h=c.shader.get().build(this.configuration);return new e.Program(t.rctx,h,w.Default3D)};u.initializePipeline=function(){if(1===this.configuration.function)return g.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case 0:return g.makePipelineState({colorWrite:g.defaultColorWriteParams});
case 1:return g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),colorWrite:g.defaultColorWriteParams});default:return g.makePipelineState({blending:g.simpleBlendingParams(1,771),colorWrite:g.defaultColorWriteParams})}};return c}(y.ShaderTechnique);y.shader=new q.ReloadableShaderModule(l.CompositingShader,()=>new Promise(function(d,c){a(["./Compositing.glsl"],d,c)}));q=function(d){function c(){var u=d.apply(this,arguments)||this;u.function=0;u.alphaMode=0;u.hasOpacityFactor=!1;
return u}b._inheritsLoose(c,d);return c}(f.ShaderTechniqueConfiguration);r.__decorate([f.parameter({count:4})],q.prototype,"function",void 0);r.__decorate([f.parameter({count:3})],q.prototype,"alphaMode",void 0);r.__decorate([f.parameter()],q.prototype,"hasOpacityFactor",void 0);p.CompositingTechnique=y;p.CompositingTechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/Compositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,p,b,r){function q(f){const w=new r.ShaderBuilder;w.include(p.ScreenSpacePass);w.fragment.uniforms.add("tex","sampler2D");0===f.function&&(f.hasOpacityFactor?(w.fragment.uniforms.add("opacity","float"),w.fragment.code.add(b.glsl`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):w.fragment.code.add(b.glsl`void main() {
gl_FragColor = texture2D(tex, uv);
}`));3===f.function&&(w.fragment.uniforms.add("overlayIdx","int"),f.hasOpacityFactor&&w.fragment.uniforms.add("opacity","float"),w.fragment.code.add(b.glsl`
      void main() {
        vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5+ 0.5, uv.y);
        gl_FragColor = texture2D(tex, overlayUV) ${f.hasOpacityFactor?"* opacity":""};
      }`));1===f.function&&w.fragment.code.add(b.glsl`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);2===f.function&&(w.fragment.uniforms.add("colorTexture","sampler2D"),w.fragment.uniforms.add("alphaTexture","sampler2D"),w.fragment.uniforms.add("frontFaceTexture","sampler2D"),w.fragment.code.add(b.glsl`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`));return w}var y=Object.freeze({__proto__:null,build:q});a.CompositingShader=y;a.build=q})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){function t(H,J){if(J.isVisible){var O=c.empty(),I=J.getSpatialQueryAccelerator();b.isSome(I)?h(O,H,I):m(O,H,J.objects);return O}}function h(H,J,O){var I=J.eye;const F=J.viewForward,L=J.frustum,N=S=>S.isVisible;var R=O.objectCount;500>R?(c.set(E,J.near,Math.min(H.near,J.far)),O.forEachInDepthRange(I,F,1,E,(S,P)=>{n(H,J,S);E.far=H.near;P.setRange(E)},L,N),c.set(E,Math.max(H.far,J.near),J.far),O.forEachInDepthRange(I,F,-1,E,(S,P)=>{n(H,J,S);E.near=H.far;P.setRange(E)},
L,N)):(R=Math.max(Math.min(R,500),Math.ceil(.1*R)),I=O.findClosest(F,1,L,N,R),O=O.findClosest(F,-1,L,N,R),I&&O&&(k(H,J,I.boundingVolumeWorldSpace.bounds),k(H,J,O.boundingVolumeWorldSpace.bounds)))}function m(H,J,O){G.clear();O.forAll(I=>{I.isVisible&&0!==I.getNumGeometryRecords()&&G.add(I)});G.empty||(G.sort(J),c.set(E,J.near,Math.min(H.near,J.far)),G.forEachInDepthRange(E,1,(I,F)=>{F<H.near&&n(H,J,I)}),c.set(E,Math.max(H.far,J.near),J.far),G.forEachInDepthRange(E,-1,(I,F,L)=>{H.far=Math.max(H.far,
L)}))}function n(H,J,O){if(O.isVisible&&l.intersectsSphere(J.frustum,O.boundingVolumeWorldSpace.bounds)){var I=O.transformation,F=D;O.geometryRecords.forEach(L=>{q.multiply(F,I,L.getShaderTransformation());const N=d.maxScale(F);z(H,J,L.geometry.boundingInfo,F,N)})}}function z(H,J,O,I,F){if(!b.isNone(O)){var L=J.eye,N=J.viewForward;f.transformMat4(B,O.center,I);L=N[0]*(B[0]-L[0])+N[1]*(B[1]-L[1])+N[2]*(B[2]-L[2]);B[3]=O.radius*F;if(!(L-B[3]>H.near&&L+B[3]<H.far)&&l.intersectsSphere(J.frustum,B))if(100<
O.radius&&O.getChildren())for(O=O.getChildren(),L=0;8>L;++L)O[L]&&z(H,J,O[L],I,F);else M.unionDepthRangeWithAABB(H,J.viewProjectionMatrix,I,O.bbMin,O.bbMax)}}function k(H,J,O){var I=J.eye;J=J.viewForward;I=(O[0]-I[0])*J[0]+(O[1]-I[1])*J[1]+(O[2]-I[2])*J[2];H.near=Math.min(H.near,I-O[3]);H.far=Math.max(H.far,I+O[3])}let v=function(){function H(){this._items=new r({allocator:O=>O||{obj:null,distance:0,near:0,far:0},deallocator:O=>{O.obj=null;O.distance=0;O.near=0;O.far=0;return O}})}var J=H.prototype;
J.clear=function(){this._items.clear()};J.add=function(O){this._items.pushNew().obj=O};J.sort=function(O){const I=O.eye,F=O.viewForward;this._items.forAll(L=>{const N=L.obj.boundingVolumeWorldSpace.bounds,R=(N[0]-I[0])*F[0]+(N[1]-I[1])*F[1]+(N[2]-I[2])*F[2];L.distance=R;L.near=R-N[3];L.far=R+N[3]});this._items.sort((L,N)=>L.distance-N.distance)};J.forEachInDepthRange=function(O,I,F){if(1===I)for(I=0;I<this._items.length;++I){var L=this._items.data[I];L.far<O.near||L.near>O.far||F(L.obj,L.near,L.far)}else for(I=
this._items.length-1;0<=I;--I)L=this._items.data[I],L.far<O.near||L.near>O.far||F(L.obj,L.near,L.far)};p._createClass(H,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return H}(),x=function(){function H(){this.view=y.create();this.viewProj=y.create();this.frustum=l.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}var J=H.prototype;
J.compute=function(O,I){this.reset();q.copy(this.view,O.viewMatrix);q.multiply(this.viewProj,O.projectionMatrix,this.view);l.copy(O.frustum,this.frustum);O=this.view;const F=O[2],L=O[6],N=O[10],R=O[14];O=this.range;let S=0;I.forEach(V=>{if(V.instanceParameters.visible&&V.castShadow){if(V.hasShaderTransformation){V.computeBoundingSphere(V.getShaderTransformation(),B,1);var ca=B}else ca=V.boundingSphere;var ba=F*ca[0]+L*ca[1]+N*ca[2]+R,Z=ba-ca[3];ca=ba+ca[3];this.geometries[S]=V;this.near[S]=-ca;this.far[S]=
-Z;++S}});if(0===this.geometries.length)return O;for(I=0;I<this.geometries.length;++I)this.near[I]>O.far&&(O.far=this.near[I]),2<this.near[I]&&this.far[I]<O.near&&(O.near=this.far[I]);I=this.looseRange;I.near=Math.max(.5*O.near,2);I.far=2*O.far;var P=0;let Q=0;for(let V=0;V<this.geometries.length;++V)this.near[V]<O.near&&(this.near[V]>=I.near?O.near=this.near[V]:this.nearCandidates[P++]=V),this.far[V]>O.far&&(this.far[V]<=I.far?O.far=this.far[V]:this.farCandidates[Q++]=V);if(0===this.nearCandidates.length&&
0===this.farCandidates.length)return O;this.nearCandidates.sort((V,ca)=>this.near[V]<this.near[ca]?-1:this.near[V]>this.near[ca]?1:0);this.farCandidates.sort((V,ca)=>this.far[V]<this.far[ca]?1:this.far[V]>this.far[ca]?-1:0);for(I=0;I<this.nearCandidates.length;++I)P=this.nearCandidates[I],this.near[P]<O.near&&(P=this.geometries[P],this.includeNearBoundingInfoRec(P.boundingInfo,P.getShaderTransformation()));for(I=0;I<this.farCandidates.length;++I)P=this.farCandidates[I],this.far[P]>O.far&&(P=this.geometries[P],
this.includeFarBoundingInfoRec(P.boundingInfo,P.getShaderTransformation()));return O};J.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};J.includeNearBoundingInfoRec=function(O,I){if(!b.isNone(O)){var F=O.getCenter();f.transformMat4(B,F,I);F=d.maxScale(I);var L=B[0],N=B[1],R=B[2];F*=O.getBSRadius();var S=this.frustum;if(!(S[0][0]*L+S[0][1]*N+S[0][2]*
R+S[0][3]>F||S[1][0]*L+S[1][1]*N+S[1][2]*R+S[1][3]>F||S[2][0]*L+S[2][1]*N+S[2][2]*R+S[2][3]>F||S[3][0]*L+S[3][1]*N+S[3][2]*R+S[3][3]>F||(L=this.view[2]*L+this.view[6]*N+this.view[10]*R+this.view[14],N=L+F,2>-(L-F)||-N>=this.range.near)))if(-N>this.looseRange.near)this.range.near=-N;else{if(100<F&&(F=O.getChildren(),void 0!==F)){for(O=0;8>O;++O)void 0!==F[O]&&this.includeNearBoundingInfoRec(F[O],I);return}M.unionDepthRangeWithAABB(this.range,this.viewProj,I,O.getBBMin(),O.getBBMax())}}};J.includeFarBoundingInfoRec=
function(O,I){if(!b.isNone(O)){var F=O.getBSRadius(),L=O.getCenter();f.transformMat4(B,L,I);var N=d.maxScale(I);L=B[0];var R=B[1],S=B[2];F*=N;N=this.frustum;if(!(N[0][0]*L+N[0][1]*R+N[0][2]*S+N[0][3]>F||N[1][0]*L+N[1][1]*R+N[1][2]*S+N[1][3]>F||N[2][0]*L+N[2][1]*R+N[2][2]*S+N[2][3]>F||N[3][0]*L+N[3][1]*R+N[3][2]*S+N[3][3]>F||(L=this.view[2]*L+this.view[6]*R+this.view[10]*S+this.view[14]-F,-L<=this.range.far)))if(-L<this.looseRange.far)this.range.far=-L;else{if(100<F&&(F=O.getChildren(),void 0!==F)){for(O=
0;8>O;++O)void 0!==F[O]&&this.includeFarBoundingInfoRec(F[O],I);return}M.unionDepthRangeWithAABB(this.range,this.viewProj,I,O.getBBMin(),O.getBBMax())}}};return H}(),C=function(){function H(){this.modelViewProj=y.create();this.clipPosition=[e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create()]}var J=H.prototype;J.unionDepthRangeWithAABB=function(O,I,F,L,N){var R=this.modelViewProj;q.multiply(R,I,F);I=!1;for(F=0;8>F;++F){const S=this.clipPosition[F],P=0===F||3===
F||4===F||7===F?L[0]:N[0],Q=0===F||1===F||4===F||5===F?L[1]:N[1],V=4>F?L[2]:N[2];S[0]=R[0]*P+R[4]*Q+R[8]*V+R[12];S[1]=R[1]*P+R[5]*Q+R[9]*V+R[13];S[2]=R[2]*P+R[6]*Q+R[10]*V+R[14];S[3]=R[3]*P+R[7]*Q+R[11]*V+R[15]}for(L=0;12>L;++L){N=this.clipTriangle(this.clipPosition[A[L][0]],this.clipPosition[A[L][1]],this.clipPosition[A[L][2]]);R=!0;for(F=0;F<N.length;++F)if(2<=N[F][3]){R=!1;break}if(!R)for(I=!0,R=0;R<N.length;++R)F=N[R][3],F<O.near&&(O.near=F),F>O.far&&(O.far=F)}return I};J.inside=function(O,I){if(0===
I)return O[0]>=-O[3];if(1===I)return O[1]>=-O[3];if(2===I)return O[0]<=O[3];if(3===I)return O[1]<=O[3];u.assert(!1)};J.intersect=function(O,I,F){let L=0;0===F?L=(-O[3]-O[0])/(I[0]-O[0]+I[3]-O[3]):1===F?L=(-O[3]-O[1])/(I[1]-O[1]+I[3]-O[3]):2===F?L=(O[3]-O[0])/(I[0]-O[0]-I[3]+O[3]):3===F&&(L=(O[3]-O[1])/(I[1]-O[1]-I[3]+O[3]));return w.lerp(e.create(),O,I,L)};J.clipTriangle=function(O,I,F){O=[O,I,F];for(I=0;4>I;++I){F=O;O=[];for(let L=0;L<F.length;++L){const N=F[L],R=F[(L+1)%F.length];this.inside(R,
I)?(this.inside(N,I)||O.push(this.intersect(N,R,I)),O.push(R)):this.inside(N,I)&&O.push(this.intersect(N,R,I))}}return O};return H}();const A=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],B=g.create(),D=y.create(),E=c.empty(),G=new v,K=new x,M=new C;a.DepthRangeFromRenderGeometries=x;a.depthRangeFromLayer=t;a.depthRangeFromScene=function(H,J,O){if(1E4>J.size)return K.compute(H,J);const I=c.empty();O.forAll(F=>{F.isVisible&&c.union(I,t(H,F))});return I};
a.textureToDepth=function(H,J,O){return u.unpackFloatRGBA(J,H)*(O[1]-O[0])+O[0]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/checkWebGLError ../../../webgl/enums ../../../../chunks/builtins ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./WebGLDriverTest ../shaders/Magnifier.glsl ../../../magnifier/resources".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H){a.MagnifierHelper=function(J){function O(){var F=J.apply(this,arguments)||this;F._handles=new y;F._magnifier=null;F._imageSources=null;F._imageLoadTask=null;F._resources=null;F.events=new q;F.attributeLocations=new Map([["position",0]]);F.tmpScreenPoint=l.createScreenPointArray();F.tmpRenderPoint=l.createRenderScreenPointArray();return F}p._inheritsLoose(O,J);var I=O.prototype;I.dispose=function(){this._magnifier=null;this._handles.destroy();
w.isSome(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this.disposeResources()};I.render=function(F,L){const N=this._validMagnifier;if(!w.isNone(N)){var R=L.camera.pixelRatio,S=Math.ceil(R*N.size);this.updateResources(F,S);if(!w.isNone(this._resources)){var P=this._resources.program;F.useProgram(P);var Q=this._resources.textures,V=Math.ceil(1/this.factor*S);Q.input.resize(V,V);var ca=L.camera.fullWidth,ba=L.camera.fullHeight;l.screenPointObjectToArray(N.position,
this.tmpScreenPoint);L=L.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint);var Z=.5*V,ha=.5*V;L[0]=f.clamp(L[0],Z,ca-Z-1);L[1]=f.clamp(L[1],ha,ba-ha-1);Z=Math.floor(L[0]-Z);ha=Math.floor(L[1]-ha);P.bindTexture(Q.input,"textureInput");F.gl.copyTexImage2D(Q.input.descriptor.target,0,Q.input.descriptor.pixelFormat,Z,ha,V,V,0);V=-1+(L[0]+N.offset.x*R)/ca*2;R=-1+(L[1]-N.offset.y*R)/ba*2;ca=S/ca*2;S=S/ba*2;F.bindVAO(this._resources.vao);P.bindTexture(Q.overlay,"textureOverlay");P.bindTexture(Q.mask,
"textureMask");P.setUniform4f("drawPosition",V,R,ca,S);P.setUniform1i("maskEnabled",N.maskEnabled?1:0);P.setUniform1i("overlayEnabled",N.overlayEnabled?1:0);F.setPipelineState(this._resources.pipelineState);F.drawArrays(5,0,4)}}};I.updateResourceLoading=function(){var F=this;const L=this._validMagnifier;if(!w.isNone(L)){var N=L.maskUrl,R=L.overlayUrl;!w.isSome(this._imageLoadTask)||this._imageLoadTask.maskUrl===N&&this._imageLoadTask.overlayUrl===R||(this._imageLoadTask.task.abort(),this._imageSources=
this._imageLoadTask=null);w.isSome(this._imageSources)||w.isSome(this._imageLoadTask)||(this._imageLoadTask={maskUrl:N,overlayUrl:R,task:e.createTask(function(){var S=p._asyncToGenerator(function*(P){const Q=w.isNone(N)||w.isNone(R)?H.loadMagnifierResources(P):null,V=w.isSome(N)?m.requestImage(N,{signal:P}):Q.then(ca=>ca.mask);P=w.isSome(R)?m.requestImage(R,{signal:P}):Q.then(ca=>ca.overlay);F._imageSources={mask:yield V,overlay:yield P};F.disposeResources();F.events.emit("request-render")});return function(P){return S.apply(this,
arguments)}}())},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}};I.updateResources=function(F,L){this.enabled?w.isSome(this._resources)?this._resources.textures.size!==L&&(F=this.createTextureResources(F,L),w.isNone(F)?this.disposeResources():(this.disposeTextureResources(this._resources.textures),this._resources.textures=F)):(L=this.createTextureResources(F,L),w.isNone(L)||(this._resources={textures:L,program:this.createProgram(F),vao:E.createQuadVAO(F,
D.Pos2,this.attributeLocations,0,1),pipelineState:C.makePipelineState({blending:C.simpleBlendingParams(1,771),depthTest:null,depthWrite:null,colorWrite:C.defaultColorWriteParams})})):this.disposeResources()};I.disposeResources=function(){w.isNone(this._resources)||(this.disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};I.disposeTextureResources=function(F){F.mask.dispose();F.overlay.dispose();F.input.dispose()};
I.createTextureResources=function(F,L){if(w.isNone(this._imageSources))return null;this._imageSources.overlay.width=L;this._imageSources.overlay.height=L;this._imageSources.mask.width=L;this._imageSources.mask.height=L;const N=new A(F,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0,preMultiplyAlpha:g.isSVG(this._imageSources.overlay.src)&&K.testWebGLDriver(F).svgAlwaysPremultipliesAlpha?!1:!0},this._imageSources.overlay),R=new A(F,{target:3553,
pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},this._imageSources.mask);return{input:new A(F,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1}),mask:R,overlay:N,size:L}};I.createProgram=function(F){const L=M.build();return new G.Program(F,L,this.attributeLocations)};p._createClass(O,[{key:"updating",get:function(){return w.isNone(this._imageSources)&&w.isSome(this._imageLoadTask)&&!this._imageLoadTask.task.finished}},
{key:"magnifier",get:function(){return this._magnifier},set:function(F){F!==this._magnifier&&(this._handles.removeAll(),this._magnifier=F,F=()=>{this.updateResourceLoading();this.events.emit("request-render")},w.isSome(this._magnifier)&&this._handles.add(this._magnifier.watch("version",F)),F())}},{key:"enabled",get:function(){return w.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return w.isSome(this._magnifier)&&this._magnifier.visible&&w.isSome(this._magnifier.position)&&
0<this._magnifier.size?this._magnifier:null}},{key:"factor",get:function(){return w.isSome(this._magnifier)?this._magnifier.factor||1:1}}]);return O}(r);b.__decorate([d.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);b.__decorate([d.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);b.__decorate([d.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=b.__decorate([h.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define(["exports","../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder"],function(a,p,b){a.build=function(){const r=new b.ShaderBuilder;r.attributes.add("position","vec2");r.vertex.uniforms.add("proj","mat4");r.vertex.uniforms.add("drawPosition","vec4");r.varyings.add("vUV","vec2");r.vertex.code.add(p.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);r.fragment.uniforms.add("textureInput","sampler2D");r.fragment.uniforms.add("textureMask","sampler2D");r.fragment.uniforms.add("textureOverlay","sampler2D");r.fragment.uniforms.add("maskEnabled","bool");r.fragment.uniforms.add("overlayEnabled","bool");r.fragment.code.add(p.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return r};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils","../../support/requestImageUtils"],function(a,p,b,r,q){function y(){y=b._asyncToGenerator(function*(f){var w=new Promise(function(l,g){a(["./mask-svg"],function(d){l(Object.freeze({__proto__:null,default:d}))},g)}),e=new Promise(function(l,g){a(["./overlay-svg"],function(d){l(Object.freeze({__proto__:null,
default:d}))},g)});w=q.requestImage((yield w).default,{signal:f});e=q.requestImage((yield e).default,{signal:f});e={mask:yield w,overlay:yield e};r.throwIfAborted(f);return e});return y.apply(this,arguments)}p.loadMagnifierResources=function(f){return y.apply(this,arguments)};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/TimeProfiler ../../../../core/watchUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../support/featureFlags ../../support/debugFlags ../core/renderPasses/RenderPassManager ./BoundingInfo ./depthRange ./depthRangeUtils ./glUtil3D ./HighlightHelper ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderPluginManager ./ShadowAccumulator ./ShadowHighlightHelper ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./WebGLDriverTest ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/renderers/MergedRenderer ../statistics/RendererPerformanceInfo ../../../webgl/Measurement".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I){let F=function(){function ca(Z,ha,fa,aa,W,U,X,T,Y){this._materialRep=Z;this._shaderTechniqueRepository=fa;this._rctx=aa;this._compositingHelper=W;this._magnifierHelper=U;this.requestRender=X;this._stage=Y;this._materialRenderers=new Map;this._hasOverlayWater=this._hasWater=this._hasOccludees=this._hasHighlights=!1;this._content=new Map;this._isRendering=!1;this._fallbackDepthStencilTexture=null;this.performanceInfo=new O.RendererPerformanceInfo;
this._antialiasing=1;this._oitEnabled=!1;this._opaqueTerrain=this._multipassTerrain=!0;this._lighting=new H.SceneLighting;this._enableNewAtmosphere=!1;this._handles=new p;this.renderHiddenTransparentEdges=()=>{};this._smaaPass=new E.SmaaRenderPass(this._rctx,fa);this._oitEnabled=this._hasOITSupport;this._enableNewAtmosphere=l.enableNewAtmosphere();this.requestRender();this._offscreenRendering=new z.OffscreenRendering(this._rctx,this._compositingHelper);this._sliceHelper=new D;this._shadowMap=new B(this._rctx,
Y.viewingMode,2);this._ssaoHelper=new G.SSAOHelper(fa,this._rctx,()=>this.requestRender());this._highlightHelper=new m(fa,this._rctx);this._shadowHighlightHelper=new A.ShadowHighlightHelper(this._rctx,Y.viewingMode);this._shadowAccumulator=new C.ShadowAccumulator(this._rctx,fa,Y,(ea,ia)=>{this.renderPassManager.shadowCastingEnabled=!0;this._renderPlugins.prepareRender(ea,ia);this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled},(ea,ia,la,pa)=>{ea.start(la,ia,pa);this.renderShadowCascades(4,
ea);la.setGLViewport(this._rctx);this.ensureCameraBindParameters(la)},()=>this.requestRender());this._bindParameters={slot:null,camera:null,inverseViewport:e.create(),shadowMap:this._shadowMap,shadowMappingEnabled:this._shadowMap.enabled,ssaoHelper:this._ssaoHelper,ssaoEnabled:this._ssaoHelper.enabled,origin:null,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:this._sliceHelper.plane,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,
multipassTerrainEnabled:!1,multipassGeometryEnabled:!1,cullAboveGround:!1,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,highlightColorTexture:null};this._renderContext=new k.RenderContext(this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper);this._renderContext.multipassTerrainParams={camera:null,multipassTerrainEnabled:!1,cullAboveGround:!1,terrainLinearDepthTexture:null};this._renderContext.multipassGeometryParams=
{multipassGeometryEnabled:!1,geometryLinearDepthTexture:null};this._renderContext.ssrParams={camera:null,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1};this._renderPlugins=new x.RenderPluginManager({renderContext:this._renderContext,shaderTechniqueRep:fa,textureRep:ha,materialRep:this._materialRep,requestRender:this.requestRender,schedule:T});this.renderPassManager=new d.RenderPassManager(this._rctx,this._shaderTechniqueRepository);this._renderPlugins.add(this.renderPassManager.slots(),
this.renderPassManager);this._handles.add([y.init(g,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",ea=>{this.renderHiddenTransparentEdges=ea?()=>this.renderEdges(1):()=>{};this.requestRender()}),y.init(this._stage,"camera",()=>this.requestRender(),!0)])}var ba=ca.prototype;ba.dispose=function(){this._handles.destroy();this._smaaPass.disable();this._materialRenderers.forEach(Z=>Z.dispose());this._materialRenderers.clear();this._edgeView=r.destroyMaybe(this._edgeView);this._offscreenRendering.dispose();this._fallbackDepthStencilTexture=
r.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap.enabled=!1;this._shadowMap.dispose();this._ssaoHelper.enabled=!1;this._ssaoHelper.dispose();this._highlightHelper.dispose();this._shadowHighlightHelper.dispose();this._shadowAccumulator.dispose();c.BoundingInfo.prune();this._content.clear()};ba.ensureEdgeView=function(){r.isNone(this._edgeView)&&(this._edgeView=new M.EdgeView({rctx:this._rctx,renderSR:this._stage.renderSR,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>
this.requestRender(),schedule:Z=>this._stage.resourceController.schedule(Z)}),this._handles.add(this._edgeView.watch("updating",()=>this.requestRender(),!0)),this.requestRender());return this._edgeView};ba.setRenderParameters=function(Z){const {renderPassManager:ha,_shadowMap:fa,_ssaoHelper:aa}=this;void 0!==Z.screenSpaceReflectionsEnabled&&ha.screenSpaceReflectionsEnabled!==Z.screenSpaceReflectionsEnabled&&(ha.screenSpaceReflectionsEnabled=Z.screenSpaceReflectionsEnabled,this.requestRender());void 0===
Z.shadowMap||fa.enabled===Z.shadowMap&&ha.shadowCastingEnabled===Z.shadowMap||(fa.enabled=Z.shadowMap,ha.shadowCastingEnabled=Z.shadowMap,this.requestRender());void 0!==Z.shadowMapMaxCascades&&fa.maxCascades!==Z.shadowMapMaxCascades&&(fa.maxCascades=Z.shadowMapMaxCascades,this.requestRender());void 0!==Z.ssao&&aa.enabled!==Z.ssao&&(aa.enabled=Z.ssao,this.requestRender());Z.background&&this._offscreenRendering.background!==Z.background&&(this._offscreenRendering.background=Z.background,this.requestRender());
const W=Z.antialiasingEnabled?1:0;void 0!==Z.antialiasingEnabled&&this._antialiasing!==W&&(this._antialiasing=W,this.requestRender());void 0!==Z.highQualityTransparency&&this._multipassTerrain!==Z.highQualityTransparency&&(this._oitEnabled=(this._multipassTerrain=Z.highQualityTransparency)&&this._hasOITSupport,this.requestRender());void 0!==Z.defaultHighlightOptions&&(this._highlightHelper.setDefaultOptions(Z.defaultHighlightOptions),this._shadowHighlightHelper.setDefaultOptions(Z.defaultHighlightOptions),
this.requestRender());void 0!==Z.slicePlane&&this._sliceHelper.plane!==Z.slicePlane&&(this._sliceHelper.plane=r.unwrap(Z.slicePlane),this.requestRender());void 0!==Z.waterReflectionEnabled&&this._waterReflectionEnabled!==Z.waterReflectionEnabled&&(this._waterReflectionEnabled=Z.waterReflectionEnabled,this.requestRender());void 0!==Z.opaqueTerrain&&this._opaqueTerrain!==Z.opaqueTerrain&&(this._opaqueTerrain=Z.opaqueTerrain,this.requestRender());void 0!==Z.hasOverlayWater&&this._hasOverlayWater!==Z.hasOverlayWater&&
(this._hasOverlayWater=Z.hasOverlayWater,this.requestRender());void 0!==Z.shadowCastOptions&&this._shadowAccumulator.setOptions(Z.shadowCastOptions)};ba.modify=function(Z){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:ha,removes:fa,updates:aa}=Z;if(0!==ha.length||0!==fa.length||0!==aa.length){fa.forAll(({id:U})=>this._content.delete(U));ha.forAll(U=>this._content.set(U.id,U));var W=!1;v.splitRenderGeometryChangeSetByMaterial(Z).forEach((U,X)=>{let T=this._materialRenderers.get(X);
if(!T)if(0<U.adds.length)T=new J(this._rctx,this._materialRep,X),this._materialRenderers.set(X,T);else return;T.modify(U);T.isEmpty&&(W=!0)});W&&this._materialRenderers.forEach((U,X)=>{U.isEmpty&&(this._materialRenderers.delete(X),U.dispose())});this._hasHighlights=b.someMap(this._materialRenderers,U=>U.hasHighlights);this._hasOccludees=b.someMap(this._materialRenderers,U=>U.hasOccludees);this._hasWater=b.someMap(this._materialRenderers,U=>U.hasWater);this.requestRender()}};ba.updateLogic=function(Z){let ha=
!1;this._materialRenderers.forEach(fa=>ha=fa.updateLogic(Z)||ha);return ha};ba.updateLightSources=function(Z,ha,fa){this._lighting.groundLightingFactor=ha;this._lighting.globalFactor=fa;this._lighting.set(Z)};ba.render=function(Z,ha,fa,aa){this._isRendering=!0;this.performanceInfo.prerender(this._rctx);this._bindParameters.lighting=this._lighting;this._renderContext.hasOccludees=this._hasOccludees;this._renderContext.transparencyPassType=3;this._bindParameters.transparencyPassType=3;var W=this._offscreenRendering;
W.needLastFrameColorTexture=this.hasWaterReflection;W.advanceCurrentRenderTarget();const U=this._sliceHelper.plane;aa&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(Z);ha.setGLViewport(this._rctx);this.needsShadowCast&&(this.renderPassManager.shadowCastingEnabled=!0);this._renderPlugins.prepareRender(ha,fa);this.performanceInfo.advance(0);var X=this.computeDepthRange(ha);this.renderShadowMap(Z,ha,this._lighting.lightingMainDirection,X);this.performanceInfo.advance(1);W.initializeFrame(ha);
this.ensureBindParameters(ha);this.renderLinearDepth();this.performanceInfo.advance(2);this.accumulateShadows(X,ha,fa);this.renderNormal();this.performanceInfo.advance(3);this.ensureBindParametersSSR();this._ssaoHelper.computeSSAO(ha,W.linearDepthTexture,W.normalTexture);this.performanceInfo.advance(4);this.performanceInfo.stats.reset();this._renderContext.pass=0;this.renderSlot(14);W.bindFramebuffer();this.renderSlot(0);this.renderOpaqueGeometry();this.performanceInfo.advance(5);ha=this._multipassTerrain&&
!this._opaqueTerrain;this.renderTerrainLinearDepth(ha);this.setMultipassFlags(ha);this.setTerrainCulling(ha);this.renderEdges(2);this.performanceInfo.advance(6);this.renderHiddenTransparentEdges();this._oitEnabled?this.renderOrderIndependentTransparency(()=>this.renderTransparentGeometry(),!1):this.renderTransparentGeometry();this.performanceInfo.advance(7);this.renderGeometryLinearDepth(ha);X=fa=!1;fa=this.renderHUDVisibility();ha||this.renderInternalSlot(21);this.performanceInfo.advance(9);this.renderEdges(1,
ha);this.performanceInfo.advance(8);(X=this.renderTransparentTerrain())&&fa&&(ha?this.renderLineCallouts(0):W.compositeTransparentTerrainOntoHUDVisibility(),this.renderHUD(0,W.framebuffer),this.performanceInfo.advance(16));this.performanceInfo.advance(10);this.setTerrainCulling(!1);X&&(W.compositeTransparentTerrainOntoMain(),ha&&(this.renderEdges(2),this.performanceInfo.advance(6),this._oitEnabled?this.renderOrderIndependentTransparency(()=>this.renderTransparentGeometry(),!1):this.renderTransparentGeometry(),
this.performanceInfo.advance(7),this.renderEdges(1),this.performanceInfo.advance(8)));ha&&this.renderLineCallouts(1);this.setMultipassFlags(!1);this._shadowAccumulator.render();W.renderToTargets(()=>{this.renderInternalSlot(8);this.renderSlot(16);this.renderSlot(17)},W.currentColorTarget,W.mainDepth);this.performanceInfo.advance(11);this._renderPlugins.needsLaserlineWithContrastControl&&W.renderTmpAndCompositeToMain(()=>{this.renderSlot(18)},2);this.performanceInfo.advance(12);this.renderOccluded();
this.performanceInfo.advance(13);W=(aa=!aa&&this._magnifierHelper.enabled)&&r.isNone(Z)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):Z;this._rctx.bindFramebuffer(W);this.renderAntiAliasing(this._antialiasing,this._offscreenRendering.colorTexture)||this._compositingHelper.composite(this._offscreenRendering.colorTexture,0);this.performanceInfo.advance(14);this.renderHUD(1,W);this.performanceInfo.advance(17);this.renderHighlights(W,this._bindParameters);
this.performanceInfo.advance(15);aa&&this._magnifierHelper.render(this._rctx,this._bindParameters);W!==Z&&(this._rctx.bindFramebuffer(Z),this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,0));this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera);this._sliceHelper.plane=U;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.postrender()};ba.readDepthPixels=function(Z,ha,fa,aa,W,U){const X=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,
this._offscreenRendering.tmpDepth);this._needsLinearDepth||(this.ensureBindParameters(Z),this._renderContext.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(17664),this.renderGeometryAndTransparentTerrainPass(2));X.readPixels(ha,fa,aa,W,6408,5121,U)};ba.readAccumulatedShadow=function(Z,ha){return this._shadowAccumulator.readAccumulatedShadow(Z,ha)};ba.setMultipassFlags=function(Z){this._renderContext.multipassTerrainParams.multipassTerrainEnabled=this._bindParameters.multipassTerrainEnabled=
Z;this._renderContext.multipassGeometryParams.multipassGeometryEnabled=this._bindParameters.multipassGeometryEnabled=Z};ba.setTerrainCulling=function(Z){this._renderContext.multipassTerrainParams.cullAboveGround=this._bindParameters.cullAboveGround=Z};ba.renderSlot=function(Z){this._renderContext.slot=Z;return this._renderPlugins.render()};ba.renderEdges=function(Z,ha=!1){const fa=this._edgeView;r.isSome(fa)&&fa.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>fa.render(this._bindParameters,
Z),1,ha)};ba.renderShadowMap=function(Z,ha,fa,aa){const W=this._shadowMap;if(W.enabled){g.ENABLE_PROFILE_DEPTH_RANGE&&q.begin("depthRange");g.ENABLE_PROFILE_DEPTH_RANGE&&q.end("depthRange");W.start(ha,fa,aa);if(this.needsShadowHighlight){const U=this._shadowHighlightHelper;this.renderShadowCascades(7,this._shadowMap,X=>W.takeCascadeSnapshotTo(X,U.highlightShadowMapSlot));W.clear();this.renderShadowCascades(6,this._shadowMap,X=>{W.takeCascadeSnapshotTo(X,U.defaultSnapshotSlot);this.renderGeometryAndTransparentTerrainPass(7)})}else this.renderShadowCascades(4);
W.finish(Z);ha.setGLViewport(this._rctx)}};ba.renderShadowCascades=function(Z,ha=this._shadowMap,fa=aa=>{}){for(const aa of ha.getCascades())aa.camera.setGLViewport(this._rctx),this.ensureCameraBindParameters(aa.camera),this.renderGeometryAndTransparentTerrainPass(Z),fa(aa)};ba.renderLinearDepth=function(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this.renderGeometryAndTransparentTerrainPass(2),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,
0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth);this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture};ba.renderTerrainLinearDepth=function(Z){Z?(Z=this._renderContext.pass,this._renderContext.pass=2,this._offscreenRendering.renderToTargets(()=>this.renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),
this._renderContext.pass=Z):this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._renderContext.multipassTerrainParams.terrainLinearDepthTexture=this._bindParameters.terrainLinearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture};ba.renderGeometryLinearDepth=function(Z){Z?(Z=this._renderContext.pass,this._offscreenRendering.renderToTargets(()=>this.renderGeometryPass(2),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,
[1,1,1,1],!0,!0),this._renderContext.pass=Z):this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._renderContext.multipassGeometryParams.geometryLinearDepthTexture=this._bindParameters.geometryLinearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture};ba.renderNormal=function(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this.renderGeometryAndTransparentTerrainPass(3)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,
[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};ba.computeDepthRange=function(Z){if(!this.needsDepthRange)return u.ZERO;const ha=t.depthRangeFromScene(Z,this._content,this._stage.layers);u.union(ha,this.renderPlugins.queryDepthRange(Z));ha.near=Math.max(Z.near,ha.near);ha.far=Math.min(Z.far,ha.far);return ha};ba.renderGeometryAndTransparentTerrainPass=function(Z){this._renderContext.pass=Z;this.renderGeometryPass(Z);this.renderTransparentTerrain()};ba.renderGeometryPass=
function(Z){this._renderContext.pass=Z;this.renderOpaqueGeometry();this.renderTransparentGeometry()};ba.renderOpaqueGeometry=function(){this.renderSlot(1);this.renderSlot(2);this.renderInternalSlot(3);this.renderSlot(4);this.renderSlot(15)};ba.renderTransparentGeometry=function(){this.renderInternalSlot(5);this.renderSlot(6)};ba.renderTransparentTerrain=function(){return this.renderSlot(7)};ba.renderHUDVisibility=function(){let Z=!1;this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>
{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper?this._renderContext.offscreenRenderingHelper.hudVisibilityTexture:null;Z=this.renderInternalSlot(12)},this._multipassTerrain&&!this._opaqueTerrain);return Z};ba.renderLineCallouts=function(Z){this._bindParameters.renderTransparentlyOccludedHUD=Z;0===Z?this._offscreenRendering.renderToTargets(()=>this.renderInternalSlot(21),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,
!0):this.renderInternalSlot(21)};ba.renderHUD=function(Z,ha){this._oitEnabled?(this.renderOrderIndependentTransparency(()=>this.renderHUDElements(Z),!0),this._rctx.bindFramebuffer(ha),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,2)):0===Z?this._offscreenRendering.renderToTargets(()=>this.renderHUDElements(0),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderHUDElements(Z)};ba.renderHUDElements=function(Z){this._bindParameters.renderTransparentlyOccludedHUD=
Z;this.renderInternalSlot(22);this.renderInternalSlot(19);this.renderInternalSlot(20)};ba.renderHighlights=function(Z,ha){if(this.needsHighlight){var fa=this._highlightHelper,aa=fa.profilingCallback&&I.startMeasurement(this._renderContext.rctx);this._renderContext.highlightDepthTexture=ha.highlightDepthTexture;var W=this._offscreenRendering.renderToTargets(()=>{this.renderGeometryAndTransparentTerrainPass(5);this._rctx.clearSafe(256);this.renderHUDElements(2)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,
[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=W.colorTexture;this.needsShadowHighlight&&this._shadowHighlightHelper.render(ha,Z);fa.render(this._renderContext.camera,W,Z);r.isSome(aa)&&fa.profilingCallback&&aa.stop(U=>{fa.profilingCallback&&fa.profilingCallback(U)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};ba.accumulateShadows=function(Z,ha,fa){this.needsShadowCast&&(this._shadowAccumulator.setAccumulationDependencies(this._offscreenRendering.linearDepthTexture,
Z,ha,fa),this._shadowAccumulator.accumulateFixedSamples(),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled)};ba.renderOrderIndependentTransparency=function(Z,ha){const fa=W=>{this._renderContext.transparencyPassType=W;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._offscreenRendering.renderOITPass(()=>Z(),W,ha)},aa=this._renderContext.pass;this._renderContext.pass=1;fa(1);this._renderContext.pass=0;fa(0);fa(2);this._offscreenRendering.compositeTransparentOntoOpaque(ha);
this._renderContext.transparencyPassType=3;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._renderContext.pass=aa};ba.renderOccluded=function(){let Z=0;this._materialRenderers.forEach((U,X)=>{X&&X.isVisible()&&8===X.renderOccluded&&(Z|=X.renderOccluded,N.push(X))});const ha=this._offscreenRendering,fa=(U,X,T,Y,ea)=>{0!==(Z&X)&&(ha.renderToTargets(T,ha.tmpColor,ha.mainDepth,[0,0,0,0],Y,ea),ha.compositeOccludedOntoMain(U))};0!==N.length&&(this.renderInternalSlot(10,
N),fa(.5,8,()=>this.renderInternalSlot(11,N),!1,!1),N.length=0);this._materialRenderers.forEach((U,X)=>{X&&X.isVisible()&&(4===X.renderOccluded||2===X.renderOccluded||16===X.renderOccluded)&&(Z|=X.renderOccluded,L.push(X))});const aa=this._renderPlugins.renderOccludedFlags;if(Z|=aa){var W=U=>{this._renderContext.renderOccludedMask=U;1<aa&&this.renderSlot(9);this.renderInternalSlot(3,L);this.renderInternalSlot(5,L);this.renderInternalSlot(8,L);this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=
0;fa(.5,4,()=>W(4),!0,2);fa(.5,2,()=>W(2),!0,2);fa(1,16,()=>W(16),!0,2);L.length=0}};ba.renderAntiAliasing=function(Z,ha){if(1===Z){if(this._smaaPass.loadResources(()=>this.requestRender()),this._smaaPass.enable())return this._smaaPass.render({colorTexture:ha}),!0}else this._smaaPass.disable();return!1};ba.ensureCameraBindParameters=function(Z){this._renderContext.camera=Z;this._bindParameters.camera=this._renderContext.camera;this._bindParameters.inverseViewport[0]=1/this._renderContext.camera.fullViewport[2];
this._bindParameters.inverseViewport[1]=1/this._renderContext.camera.fullViewport[3]};ba.ensureBindParameters=function(Z){var ha;this.ensureCameraBindParameters(Z);Z=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=this._renderContext.shadowMap;this._bindParameters.shadowMappingEnabled=this._renderContext.shadowMap.enabled;this._bindParameters.ssaoHelper=this._renderContext.ssaoHelper;this._bindParameters.ssaoEnabled=this._renderContext.ssaoHelper.enabled;this._bindParameters.slicePlane=
this._renderContext.sliceHelper.plane;this._bindParameters.hasOccludees=this._renderContext.hasOccludees;this._renderContext.multipassTerrainParams.camera=this._renderContext.camera;this._bindParameters.hudVisibilityTexture=Z.hudVisibilityTexture;this._bindParameters.highlightDepthTexture=null!=(ha=Z.depthTexture)?ha:this.getFallbackDepthTexture()};ba.ensureBindParametersSSR=function(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._renderContext.camera)?this._renderContext.ssrParams.reprojectionMat=
this._bindParameters.reprojectionMat=V:(f.translate(R,this._renderContext.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),f.translate(P,this._renderContext.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),f.invert(P,P),f.invert(S,this._renderContext.camera.projectionMatrix),f.multiply(Q,P,S),f.multiply(Q,R,Q),f.multiply(Q,this._renderContext.lastFrameCamera.projectionMatrix,Q),this._renderContext.ssrParams.reprojectionMat=
this._bindParameters.reprojectionMat=Q),this._renderContext.ssrParams.camera=this._renderContext.camera,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null;this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=this.hasWaterReflection};ba.renderInternalSlot=function(Z,ha){const fa=0===this._renderContext.pass?
this.performanceInfo.stats:null;let aa=!1;this._bindParameters.slot=Z;r.isSome(ha)?ha.forEach(W=>{n.materialPredicate(W,this._renderContext)&&(W=this._materialRenderers.get(W),r.isSome(W)&&(aa=W.render(Z,this._renderContext.pass,this._bindParameters)||aa))}):this._materialRenderers.forEach((W,U)=>{n.materialPredicate(U,this._renderContext)&&(aa=W.render(Z,this._renderContext.pass,this._bindParameters,fa)||aa)});return aa};ba.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=
h.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};ba.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:(this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0)+(this._shadowHighlightHelper?this._shadowHighlightHelper.getGpuMemoryUsage():0),shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.gpuMemoryUsage:0}};a._createClass(ca,[{key:"hasWater",
get:function(){return this._hasWater||this._hasOverlayWater}},{key:"hasWaterReflection",get:function(){return this.hasWater&&this._waterReflectionEnabled}},{key:"updating",get:function(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources||r.isSome(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return null===this._bindParameters.reprojectionMat||
f.equals(this._bindParameters.reprojectionMat,V)}},{key:"hasShadowsEnabled",get:function(){var Z;return!(null==(Z=this._shadowMap)||!Z.enabled)}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"_hasOITSupport",get:function(){return K.testWebGLDriver(this._rctx).floatBufferBlendWorking}},{key:"_needsLinearDepth",get:function(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&
this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast||this._enableNewAtmosphere}},{key:"needsNormal",get:function(){return this._ssaoHelper.enabled}},{key:"needsDepthRange",get:function(){return this._shadowMap.enabled||this.needsShadowCast}},{key:"needsHighlight",get:function(){return this._hasHighlights||this._renderPlugins.needsHighlight}},{key:"needsShadowHighlight",get:function(){return this._shadowMap.enabled&&this._shadowHighlightHelper.isVisible&&this.needsHighlight}},
{key:"needsShadowCast",get:function(){return this._shadowAccumulator.isAccumulating}},{key:"test",get:function(){const Z=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,lighting:this._lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,enableNewAtmosphere:ha=>{this._enableNewAtmosphere=ha},getFramebufferTexture:ha=>{var fa;switch(ha){case 0:return Z._offscreenRendering.colorTexture;
case 1:return Z._offscreenRendering.linearDepthTexture;case 2:return Z._offscreenRendering.normalTexture;case 3:return null==(fa=Z._shadowMap)?void 0:fa.test.depthTexture;case 4:return Z._offscreenRendering.hudVisibilityTexture;case 5:return Z._offscreenRendering.highlightTexture}}}}}]);return ca}();const L=[],N=[],R=w.create(),S=w.create(),P=w.create(),Q=w.create(),V=w.create();return F})},"esri/core/TimeProfiler":function(){define(["../chunks/_rollupPluginBabelHelpers"],function(a){let p=function(){function b(q,
y=.9){this._alpha=.9;this._max=this._min=this._smooth=this._sum=this._count=this._startTime=0;this._name=q;this._alpha=y;this.reset()}var r=b.prototype;r.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};r.begin=function(){this._startTime=performance.now()};r.end=function(){const q=performance.now()-this._startTime;this._count+=1;this._sum+=q;this._smooth=this._alpha*q+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,q);this._max=Math.max(this._max,q)};
r.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};a._createClass(b,[{key:"name",get:function(){return this._name}},{key:"count",get:function(){return this._count}},{key:"average",get:function(){return 0<this._count?this._sum/this._count:0}},{key:"smooth",get:function(){return this._smooth}},{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}}]);return b}();(function(b){function r(w){w in
y||(y[w]=new b(w));return y[w]}function q(w){console.log(r(w).toJSON())}const y={},f={};b.get=r;b.begin=function(w){r(w).begin()};b.end=function(w,e=!0){r(w).end();const l=performance.now();!e||w in f&&!(l>=f[w]+1E3)||(q(w),f[w]=l)};b.log=q;b.logAll=function(){for(const w in y)q(w)}})(p||(p={}));return p})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4 ../../../../../chunks/boundedPlane ./AllRenderPasses ./RenderPass ../util/TwoVectorPosition ../../lib/depthRange".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){let h=function(){function k(x,C){this.rctx=x;this.shaderTechniqueRepository=C;this.canRender=!0;this._materialPassParams=new d.MaterialPassesParameters;this._shadowPassParams=new d.ShadowMapPassParameters;this._highlightPassParams=new d.HighlightPassParameters;this._systems=new Set;this._passes={materialOpaque:new c.RenderPass(x,this.shaderTechniqueRepository),materialTransparent:new c.RenderPass(x,this.shaderTechniqueRepository,1),materialIntegratedMesh:new c.RenderPass(x,
this.shaderTechniqueRepository),shadowMap:new c.RenderPass(x,this.shaderTechniqueRepository),highlight:new c.RenderPass(x,this.shaderTechniqueRepository),highlightIntegratedMesh:new c.RenderPass(x,this.shaderTechniqueRepository),highlightShadowMap:new c.RenderPass(x,this.shaderTechniqueRepository),defaultShadowMap:new c.RenderPass(x,this.shaderTechniqueRepository)}}var v=k.prototype;v.register=function(x){this._systems.add(x)};v.prepareRender=function(x){if(0!==this._systems.size){for(const C of Object.values(this._passes))C.prepareSubmit();
this._systems.forEach(C=>C.submit(this._passes,{camera:x}));for(const C of Object.values(this._passes))C.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}};v.render=function(x){if(0===this._systems.size)return!1;this._configure(x);switch(x.slot){case 4:switch(x.pass){case 0:return this._materialPassParams.subPass=0,this._configureMaterialColorPass(x),this._passes.materialOpaque.dispatch(this._materialPassParams);case 2:return this._materialPassParams.subPass=2,this._passes.materialOpaque.dispatch(this._materialPassParams);
case 3:return this._materialPassParams.subPass=3,this._passes.materialOpaque.dispatch(this._materialPassParams);case 5:return this._passes.highlight.dispatch(this._highlightPassParams);case 4:return this._passes.shadowMap.dispatch(this._shadowPassParams);case 7:return this._passes.highlightShadowMap.dispatch(this._shadowPassParams);case 6:return this._passes.defaultShadowMap.dispatch(this._shadowPassParams)}break;case 6:switch(x.pass){case 0:return this._materialPassParams.subPass=0,this._configureMaterialColorPass(x),
this._passes.materialTransparent.dispatch(this._materialPassParams);case 1:return this._materialPassParams.subPass=1,this._configureMaterialColorPass(x),this._passes.materialTransparent.dispatch(this._materialPassParams);case 2:return this._materialPassParams.subPass=2,this._passes.materialTransparent.dispatch(this._materialPassParams);case 3:return this._materialPassParams.subPass=3,this._passes.materialTransparent.dispatch(this._materialPassParams)}break;case 1:switch(x.pass){case 0:return this._materialPassParams.subPass=
0,this._configureMaterialColorPass(x),this._materialPassParams.ssrParams=x.ssrParams,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case 2:return this._materialPassParams.subPass=2,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case 3:return this._materialPassParams.subPass=3,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case 5:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}}return!1};v.notifyDirty=
function(){this._context.requestRender()};v.slots=function(){return[4,6,1]};v.initializeRenderContext=function(x){this._context=x};v.uninitializeRenderContext=function(){};v.queryDepthRange=function(x){const C={near:Infinity,far:-Infinity};this._systems.forEach(A=>{A=A.queryShadowCasterDepthRange(x);b.isSome(A)&&t.union(C,A,C)});return C};v._configureMaterialColorPass=function(x){this._materialPassParams.bindShadowMap=C=>{x.shadowMap.bind(C);const A=this._materialPassParams.viewTransform;w.add(m,
A.worldFromView_TL,A.worldFromView_TH);x.shadowMap.bindView(C,m)};this._materialPassParams.bindAmbientOcclusion=C=>x.ssaoHelper.bind(C,x.camera);this._materialPassParams.ambientOcclusionEnabled=!!x.ssaoHelper&&x.ssaoHelper.ready;this._materialPassParams.sceneHasOcludees=x.hasOccludees};v._configure=function(x){this._updateParameters(x,4===x.pass||7===x.pass||6===x.pass?this._shadowPassParams:5===x.pass?this._highlightPassParams:this._materialPassParams)};v._updateParameters=function(x,C){const A=
x.camera,B=A.viewInverseTransposeMatrix;w.set(m,B[3],B[7],B[11]);z.set(m);w.copy(C.viewTransform.worldFromView_TH,z.high);w.copy(C.viewTransform.worldFromView_TL,z.low);r.fromMat4(C.viewTransform.viewFromCameraRelative_RS,A.viewMatrix);y.copy(C.viewTransform.projFromView,A.projectionMatrix);0===C.identifier?(this._materialPassParams.transparent=6===x.slot,this._materialPassParams.integratedMesh=1===x.slot,this._materialPassParams.lighting=x.scenelightingData,r.transpose(n,C.viewTransform.viewFromCameraRelative_RS),
r.invert(C.transformNormal_ViewFromGlobal,n),f.set(C.cameraNearFar,A.near,A.far)):1===C.identifier?f.set(C.cameraNearFar,A.near,A.far):2===C.identifier&&(C.highlightDepthTexture=x.highlightDepthTexture,l.copy(C.viewport,A.fullViewport));if(0===C.identifier||2===C.identifier)C.inverseViewport[0]=1/A.fullViewport[2],C.inverseViewport[1]=1/A.fullViewport[3];g.copyWithoutVerify(x.sliceHelper.plane,C.slicePlane);w.subtract(C.slicePlane.origin,C.slicePlane.origin,m);C.slicePlaneEnabled=x.sliceHelper.isEnabled;
this._materialPassParams.transparencyPassType=x.transparencyPassType;this._materialPassParams.multipassTerrainParams=x.multipassTerrainParams};p._createClass(k,[{key:"shadowCastingEnabled",get:function(){return this._materialPassParams.shadowsEnabled},set:function(x){this._materialPassParams.shadowsEnabled=x}},{key:"screenSpaceReflectionsEnabled",get:function(){return b.isSome(this._materialPassParams.ssrParams.ssrEnabled)},set:function(x){this._materialPassParams.ssrParams.ssrEnabled=!!x}},{key:"needsHighlight",
get:function(){return 0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count}}]);return k}();const m=e.create(),n=q.create(),z=new u.TwoVectorPosition;a.RenderPassManager=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define("exports ../../../../../chunks/mat3f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec4f64 ../../../../../chunks/boundedPlane ../shaderLibrary/attributes/VertexPosition.glsl".split(" "),
function(a,p,b,r,q,y){a.HighlightPassParameters=function(){this.identifier=2;this.viewTransform=new y.VertexPosition.ViewProjectionTransform;this.slicePlane=q.create();this.inverseViewport=b.create();this.viewport=r.create()};a.MaterialPassesParameters=function(){this.identifier=0;this.integratedMesh=this.transparent=!1;this.viewTransform=new y.VertexPosition.ViewProjectionTransform;this.transformNormal_ViewFromGlobal=p.create();this.cameraNearFar=b.create();this.inverseViewport=b.create();this.slicePlane=
q.create();this.shadowsEnabled=this.ambientOcclusionEnabled=this.slicePlaneEnabled=!0;this.sceneHasOcludees=!1;this.transparencyPassType=3};a.ShadowMapPassParameters=function(){this.identifier=1;this.viewTransform=new y.VertexPosition.ViewProjectionTransform;this.cameraNearFar=b.create();this.slicePlane=q.create()};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/maybe","../../../../../core/PooledArray"],function(a,p,b,r){let q=function(){function f(e,l,g=0){this._rctx=e;this._techniqueRepository=l;this._sorting=g;this._draws=new r({initialSize:32,allocator:d=>d||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}var w=f.prototype;w.submitDraw=function(e,l,g,d,c){const u=this._draws.pushNew();
u.geometry=l;u.geometryRanges=g;u.material=e;u.bindDrawParams=d;u.depthSquaredHint=c;u.indexType=l.indexed?b.unwrap(l.vao.indexBuffer).indexType:0};w.dispatch=function(e){const l=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();let g=null;const d=this._draws.length;for(let t=0;t<d;t++){var c=this._draws.data[t];const h=c.geometry;var u=c.material.getTechnique(this._techniqueRepository,e,h.parameters);if(u!==g||3!==u.configuration.transparencyPassType)l.useProgram(u.program),
l.setPipelineState(u.pipeline),g=u;this._passBoundTechniques.has(u)||(u.bindPass(e),this._passBoundTechniques.add(u));l.bindVAO(h.vao);this._previouslyBoundMaterials.get(u)!==c.material&&(u.bindMaterial(c.material,e),this._previouslyBoundMaterials.set(u,c.material));this._previouslyBoundDraw.get(u)!==c.bindDrawParams&&(u.bindDraw(c.bindDrawParams,c.material,e),this._previouslyBoundDraw.set(u,c.bindDrawParams));u=c.geometryRanges;const m=u.length;if(0!==c.indexType){const n=y.get(c.indexType);for(let z=
0;z<m;z+=2)l.drawElements(h.primitiveType,u[z+1],c.indexType,u[z]*n)}else for(c=0;c<m;c+=2)l.drawArrays(h.primitiveType,u[c],u[c+1])}return 0<d};w.prepareSubmit=function(){this._draws.clear()};w.finishSubmit=function(){const e=0===this._sorting?1:-1;this._draws.sort((l,g)=>{const d=e*(l.depthSquaredHint-g.depthSquaredHint);return 0!==d?d:l.geometry.vao.size-g.geometry.vao.size})};p._createClass(f,[{key:"count",get:function(){return this._draws.length}}]);return f}();const y=new Map;y.set(5121,1);
y.set(5123,2);y.set(5125,4);a.RenderPass=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec4 ../../../../chunks/vec4f32 ../../../../chunks/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ../shaders/HighlightTechnique ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){return function(){function t(m,n){this._techniqueRep=m;this._rctx=n;this.viewportToRestore=q.create();this.defaultOptions={color:r.fromValues(1,0,1,1),haloColor:r.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05,shadowColor:r.fromValues(1,0,1,1),shadowOpacity:.15,occludedShadowOpacity:.075};this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,
viewportHeight:0}}var h=t.prototype;h.assertResources=function(){if(!this.quadVAO){this.quadVAO=e.createQuadVAO(this._rctx);var m={colorTarget:0,depthStencilTarget:0,width:0,height:0},n={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new d(this._rctx,m,n);this.blur1Fbo=new d(this._rctx,m,n);m=new l.HighlightCompositionTechniqueConfiguration;m.highlightStage=0;m.gridOptimization=!1;this.blurTechnique=this._techniqueRep.acquire(l.HighlightCompositionTechnique,
m);m.highlightStage=0;m.gridOptimization=!0;this.blurGridTechnique=this._techniqueRep.acquire(l.HighlightCompositionTechnique,m);m.highlightStage=1;m.gridOptimization=!1;this.applyTechnique=this._techniqueRep.acquire(l.HighlightCompositionTechnique,m);m.highlightStage=1;m.gridOptimization=!0;this.applyGridTechnique=this._techniqueRep.acquire(l.HighlightCompositionTechnique,m);m.highlightStage=2;m.gridOptimization=!1;this.downsampleTechnique=this._techniqueRep.acquire(l.HighlightCompositionTechnique,
m)}};h.dispose=function(){if(this._grid.coverageMipmap)for(let m=1;m<this._grid.coverageMipmap.length;m++)this._grid.coverageMipmap[m].dispose();this._grid.vao&&this._grid.vao.dispose(!0);this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null);this.blur0Fbo=p.disposeMaybe(this.blur0Fbo);this.blur1Fbo=p.disposeMaybe(this.blur1Fbo)};h.setDefaultOptions=function(m){this.defaultOptions=m};h.render=function(m,n,z){var k=m.pixelRatio;const v=y.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED,x=this._rctx;this.assertResources();
b.copy(this.viewportToRestore,m.fullViewport);var C=Math.ceil(m.fullWidth/k);k=Math.ceil(m.fullHeight/k);this.blur0Fbo.resize(C,k);this.blur1Fbo.resize(C,k);x.bindVAO(this.quadVAO);m=null;const A=v?this.blurGridTechnique:this.blurTechnique;A.bindPipelineState(x);x.useProgram(A.program);v?(this._gridUpdateResources(n,32),this._gridComputeMipmap(),m=this._grid.vao,A.program.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex")):m=this.quadVAO;x.bindVAO(m);x.bindFramebuffer(this.blur0Fbo);
x.setViewport(0,0,C,k);x.setClearColor(0,0,0,0);x.clear(16384);A.program.bindTexture(n.colorTexture,"tex");A.program.setUniform2f("blurSize",1/C,0);x.drawArrays(A.primitiveType,0,c.vertexCount(m,"geometry"));x.bindFramebuffer(this.blur1Fbo);x.clear(16384);A.program.bindTexture(this.blur0Fbo.colorTexture,"tex");A.program.setUniform2f("blurSize",0,1/k);x.drawArrays(A.primitiveType,0,c.vertexCount(m,"geometry"));C=v?this.applyGridTechnique:this.applyTechnique;x.bindFramebuffer(z);C.bindPipelineState(x);
x.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);x.useProgram(C.program);C.program.bindTexture(this.blur1Fbo.colorTexture,"tex");C.program.bindTexture(n.colorTexture,"origin");v&&C.program.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex");C.bindApplyPass(this.defaultOptions);x.drawArrays(C.primitiveType,0,c.vertexCount(m,"geometry"));x.bindVAO(null)};h._gridUpdateResources=function(m,n){const z=
this._rctx,k=this._grid;var v=!1;null===k.coverageMipmap&&(k.coverageMipmap=[m],v=!0);if(k.viewportWidth!==m.width||k.viewportHeight!==m.height)v=!0,k.viewportWidth=m.width,k.viewportHeight=m.height;k.coverageMipmap[0]=m;k.cellPixelSize!==n&&(k.cellPixelSize=n,v=!0);if(v){for(n=1;n<k.coverageMipmap.length;n++)k.coverageMipmap[n].dispose();k.mipmapLevels=Math.ceil(Math.log(k.cellPixelSize)*Math.LOG2E);k.coverageMipmap.length=k.mipmapLevels+1;for(n=0;n<k.mipmapLevels;n++)v=k.coverageMipmap[n],k.coverageMipmap[n+
1]=new d(z,{colorTarget:0,depthStencilTarget:0,width:Math.ceil(v.width/2),height:Math.ceil(v.height/2)},{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(v.width/2),height:Math.ceil(v.height/2)})}v=Math.ceil(m.height/k.cellPixelSize);var x=Math.ceil(m.width/k.cellPixelSize);if(!k.vao||k.verticalCellCount!==v||k.horizontalCellCount!==x){k.verticalCellCount=v;k.horizontalCellCount=x;m=v+1;n=x+1;v=1/v;x=1/x;const C=new Float32Array(24*m*n);let A=0;for(let B=
0;B<m;B++)for(let D=0;D<n;D++)C[A+0]=(D-.5)*x*2-1,C[A+1]=(B-.5)*v*2-1,C[A+2]=D*x,C[A+3]=B*v,C[A+4]=(D+.5)*x*2-1,C[A+5]=(B-.5)*v*2-1,C[A+6]=D*x,C[A+7]=B*v,C[A+8]=(D-.5)*x*2-1,C[A+9]=(B+.5)*v*2-1,C[A+10]=D*x,C[A+11]=B*v,C[A+12]=(D-.5)*x*2-1,C[A+13]=(B+.5)*v*2-1,C[A+14]=D*x,C[A+15]=B*v,C[A+16]=(D+.5)*x*2-1,C[A+17]=(B-.5)*v*2-1,C[A+18]=D*x,C[A+19]=B*v,C[A+20]=(D+.5)*x*2-1,C[A+21]=(B+.5)*v*2-1,C[A+22]=D*x,C[A+23]=B*v,A+=24;k.vao&&k.vao.dispose(!0);k.vao=new u(z,f.Default3D,{geometry:w.Pos2Tex},{geometry:g.createVertex(z,
35044,C)})}};h._gridComputeMipmap=function(){const m=this._rctx,n=this._grid,z=this.downsampleTechnique.program;this.downsampleTechnique.bindPipelineState(m);m.bindVAO(this.quadVAO);m.useProgram(z);for(let k=0;k<n.mipmapLevels;k++){m.bindFramebuffer(n.coverageMipmap[k+1]);z.bindTexture(n.coverageMipmap[k].colorTexture,"tex");const v=n.coverageMipmap[k+1].width,x=n.coverageMipmap[k+1].height;z.setUniform2f("invFramebufferDim",1/v,1/x);m.setViewport(0,0,v,x);m.drawArrays(5,0,c.vertexCount(this.quadVAO,
"geometry"))}};h.getGpuMemoryUsage=function(){let m=(p.isSome(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(p.isSome(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const n of this._grid.coverageMipmap)m+=n.gpuMemoryUsage;return m};a._createClass(t,[{key:"profilingCallback",get:function(){return y.HIGHLIGHTS_PROFILE_TO_CONSOLE?m=>console.log(m):null}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}]);return t}()})},
"esri/views/3d/webgl-engine/shaders/HighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightComposition.glsl ../../../webgl/renderState".split(" "),function(a,p,b,r,q,y,f,w,e,l,g){y=function(d){function c(){return d.apply(this,
arguments)||this}b._inheritsLoose(c,d);var u=c.prototype;u.initializeProgram=function(t){const h=c.shader.get().build(this.configuration);return new e.Program(t.rctx,h,w.Default3D)};u.bindApplyPass=function(t){this.program.setUniform4fv("color",t.color);this.program.setUniform4fv("haloColor",t.haloColor);this.program.setUniform1f("outlineSize",8.6);this.program.setUniform1f("blurSize",.4);this.program.setUniform4f("opacities",t.haloOpacity,t.haloOpacityOccluded,t.fillOpacity,t.fillOpacityOccluded)};
u.initializePipeline=function(){return 1===this.configuration.highlightStage?g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),colorWrite:g.defaultColorWriteParams}):g.makePipelineState({colorWrite:g.defaultColorWriteParams})};b._createClass(c,[{key:"primitiveType",get:function(){return this.configuration.gridOptimization?4:5}}]);return c}(y.ShaderTechnique);y.shader=new q.ReloadableShaderModule(l.HighlightCompositionShader,()=>new Promise(function(d,c){a(["./HighlightComposition.glsl"],
d,c)}));q=function(d){function c(){var u=d.apply(this,arguments)||this;u.highlightStage=0;u.gridOptimization=!1;return u}b._inheritsLoose(c,d);return c}(f.ShaderTechniqueConfiguration);r.__decorate([f.parameter({count:3})],q.prototype,"highlightStage",void 0);r.__decorate([f.parameter()],q.prototype,"gridOptimization",void 0);p.HighlightCompositionTechnique=y;p.HighlightCompositionTechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/HighlightComposition.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,p,b){function r(y){const f=new b.ShaderBuilder,w=f.vertex.code,e=f.fragment.code;f.attributes.add("position","vec2");2===y.highlightStage&&(w.add(p.glsl`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),f.fragment.uniforms.add("tex","sampler2D"),f.fragment.uniforms.add("invFramebufferDim","vec2"),e.add(p.glsl`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`));0===y.highlightStage&&(f.attributes.add("uv0","vec2"),y.gridOptimization?(f.vertex.uniforms.add("coverageTex","sampler2D"),f.fragment.uniforms.add("blurSize","vec2"),f.varyings.add("blurCoordinate","vec3")):(f.vertex.uniforms.add("blurSize","vec2"),f.varyings.add("blurCoordinates[5]","vec2")),w.add(p.glsl`
    void main() {
      gl_Position = vec4(position, 0.0, 1.0);
      ${y.gridOptimization?p.glsl`
      vec4 cov = texture2D(coverageTex, uv0);
      if (cov.r == 0.0) {
        gl_Position = vec4(0.0);
      }
      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
      `:p.glsl`
      vec2 uv = position.xy * 0.5 + vec2(0.5);
      blurCoordinates[0] = uv;
      blurCoordinates[1] = uv + blurSize * 1.407333;
      blurCoordinates[2] = uv - blurSize * 1.407333;
      blurCoordinates[3] = uv + blurSize * 3.294215;
      blurCoordinates[4] = uv - blurSize * 3.294215;
          `}
    }`),f.fragment.uniforms.add("tex","sampler2D"),e.add(p.glsl`
    void main() {
      ${y.gridOptimization?p.glsl`
          vec2 uv = blurCoordinate.xy;
          vec4 center = texture2D(tex, uv);

          // do not blur if no pixel or all pixels in neighborhood are set
          if (blurCoordinate.z == 1.0) {
            gl_FragColor = center;
          } else {
            vec4 sum = vec4(0.0);
            sum += center * 0.204164;
            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
            gl_FragColor = sum;
          }`:p.glsl`
          vec4 sum = vec4(0.0);
          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;
          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;
          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;
          gl_FragColor = sum;`}
    }`));1===y.highlightStage&&(f.varyings.add("uv","vec2"),y.gridOptimization&&(f.attributes.add("uv0","vec2"),f.vertex.uniforms.add("coverageTex","sampler2D")),w.add(p.glsl`
      void main() {
        ${y.gridOptimization?p.glsl`
            vec4 cov = texture2D(coverageTex, uv0);
            // if no highlight pixel set in this block, hide block
            if (cov.r == 0.0) {
              gl_Position = vec4(0.0);
              return;
            }`:""}
        gl_Position = vec4(position, 0.0, 1.0);
        uv = position.xy * 0.5 + vec2(0.5);
      }`),f.fragment.uniforms.add("tex","sampler2D"),f.fragment.uniforms.add("origin","sampler2D"),f.fragment.uniforms.add("color","vec4"),f.fragment.uniforms.add("haloColor","vec4"),f.fragment.uniforms.add("outlineSize","float"),f.fragment.uniforms.add("blurSize","float"),f.fragment.uniforms.add("opacities","vec4"),e.add(p.glsl`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = color.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = color.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);
}`));return f}var q=Object.freeze({__proto__:null,build:r});a.HighlightCompositionShader=q;a.build=r})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./RenderTargetHelper"],function(a,p,b){let r=function(){function f(e,l){this._rctx=e;this._compositingHelper=l;this._currentRenderTarget=0;this.dimensions={width:4,height:4};this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};e=this._rctx;
const g="webgl2"===e.webglVersion,d=this.renderTargetHelper=new b.RenderTargetHelper(e);this.mainColorTarget0=d.registerColorTarget({name:"mainColorTarget0"});this.mainColorTarget1=d.registerColorTarget({name:"mainColorTarget1"});this.frontFaceTarget=d.registerColorTarget({name:"frontFaceTarget"});e=c=>d.registerColorTarget({name:c,dataType:5126,internalFormat:g?34836:6408,samplingMode:9728});this.colorFloatTarget=e("colorFloatTarget");this.alphaFloatTarget=e("alphaFloatTarget");this.mainDepth=d.registerDepthTarget({name:"mainDepth"});
this.linearDepth=d.registerColorTarget({name:"linearDepth",samplingMode:9728});this.terrainLinearDepth=d.registerColorTarget({name:"terrainLinearDepth"});this.geometryLinearDepth=d.registerColorTarget({name:"geometryLinearDepth"});this.normal=d.registerColorTarget({name:"normal"});this.highlight=d.registerColorTarget({name:"highlight",internalFormat:g?32854:6408,dataType:32819});this.hudVisibility=d.registerColorTarget({name:"hudVisibility",internalFormat:g?32854:6408,dataType:32819});this.tmpColor=
d.registerColorTarget({name:"tmpColor"});this.tmpDepth=d.registerDepthTarget({name:"tmpDepth"});this.hudColor=d.registerColorTarget({name:"hudColor"})}var w=f.prototype;w.dispose=function(){this.renderTargetHelper.dispose()};w.getFramebuffer=function(e,l){return this.renderTargetHelper.getFramebuffer(this.dimensions,e,l)};w.advanceCurrentRenderTarget=function(){this._currentRenderTarget=0===this._currentRenderTarget&&this._needLastFrameColorTexture?1:0};w.initializeFrame=function(e){const l=this._rctx;
this.dimensions.width=e.fullWidth;this.dimensions.height=e.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);l.setClearStencil(0);e=this._background.color;l.setClearColor(e[0]*e[3],e[1]*e[3],e[2]*e[3],e[3]);l.clearSafe(17664)};w.composite=function(){this._compositingHelper.composite(this.colorTexture,0)};w.renderTmpAndCompositeToMain=function(e,l,g=!1){this.renderToTargets(e,this.tmpColor,g?this.tmpDepth:this.mainDepth,q);this._compositingHelper.composite(this.getColorTexture(this.tmpColor),
l)};w.renderHUDVisibility=function(e,l=!1){this.renderToTargets(e,this.hudVisibility,l?this.tmpDepth:this.mainDepth,y)};w.compositeTransparentTerrainOntoHUDVisibility=function(){this.renderToTargets(()=>{this._compositingHelper.compositeSpecial(this.getColorTexture(this.tmpColor),1)},this.hudVisibility,this.tmpDepth)};w.renderOITPass=function(e,l,g){let d,c;switch(l){case 0:d=this.colorFloatTarget;c=[0,0,0,0];break;case 1:d=this.alphaFloatTarget;c=[1,1,1,1];break;case 2:d=this.frontFaceTarget,c=[0,
0,0,0]}g?this.renderToTargets(e,d,this.tmpDepth,c,!0,!0):this.renderToTargets(e,d,this.mainDepth,c,!1)};w.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)};w.compositeOccludedOntoMain=function(e){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,e)};w.compositeTransparentOntoOpaque=function(e){e?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,
0,0,1E-13),this._rctx.clearSafe(16384)):this.bindFramebuffer();this._compositingHelper.compositeTransparent(this.getColorTexture(this.colorFloatTarget),this.getColorTexture(this.alphaFloatTarget),this.getColorTexture(this.frontFaceTarget))};w.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};w.renderDepthDetached=function(e){this.bindTarget(this.currentColorTarget);e();this.bindTarget(this.currentColorTarget,this.mainDepth)};w.disposeTarget=function(e){this.renderTargetHelper.disposeTargetResource(e)};
w.renderToTargets=function(e,l,g,d,c=!1,u=!1){const t=this._rctx;l=this.bindTarget(l,g);g=0;d&&(t.setClearColor(d[0],d[1],d[2],Math.max(1E-13,d[3])),g|=16384);c&&(g|=256);!1===u?u=0:(!0===u&&(u=255),g|=1024);g&&t.clearSafe(g,u);e();t.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);return l};w.bindTarget=function(e,l){e=this.renderTargetHelper.getFramebuffer(this.dimensions,e,l);this._rctx.bindFramebuffer(e);return e};w.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,
this.dimensions)};w.getGpuMemoryUsage=function(){let e=0;this.renderTargetHelper&&(e+=this.renderTargetHelper.getGpuMemoryUsage());return e};p._createClass(f,[{key:"width",get:function(){return this.dimensions.width}},{key:"height",get:function(){return this.dimensions.height}},{key:"background",get:function(){return this._background},set:function(e){this._background=e}},{key:"currentColorTarget",get:function(){return 0===this._currentRenderTarget?this.mainColorTarget0:this.mainColorTarget1}},{key:"previousColorTarget",
get:function(){return 0===this._currentRenderTarget?this.mainColorTarget1:this.mainColorTarget0}},{key:"currentRenderTarget",get:function(){return this._currentRenderTarget}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},{key:"colorTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",get:function(){return this.renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},
{key:"linearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"terrainLinearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},
{key:"normalTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this.getColorTexture(this.hudVisibility)}},{key:"tmpColorTexture",get:function(){return this.getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this.getColorTexture(this.hudColor)}},{key:"mainColorTexture",
get:function(){return this.getColorTexture(this.currentColorTarget)}},{key:"needLastFrameColorTexture",get:function(){return this._needLastFrameColorTexture},set:function(e){!e&&this._needLastFrameColorTexture&&(this._currentRenderTarget=0,this.disposeTarget(this.mainColorTarget1));this._needLastFrameColorTexture=e}}]);return f}();const q=[0,0,0,0],y=[0,1,0,1];a.OffscreenRendering=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define(["exports",
"../../../webgl/FramebufferObject","../../../webgl/Renderbuffer","../../../webgl/Texture","../../../webgl/Util"],function(a,p,b,r,q){const y={dataType:5121,internalFormat:6408},f={};let w=function(){function e(g){this.rctx=g;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this._nextId=1;this.depthTextureSupported=g.capabilities.depthTexture}var l=e.prototype;l.dispose=function(){this._depthBuffers.forEach(g=>
g.dispose());this._depthBuffers.clear();this._depthTextures.forEach(g=>g.dispose());this._depthTextures.clear();this._colorTextures.forEach(g=>g.dispose());this._colorTextures.clear();this._framebuffers.forEach(g=>g.dispose());this._framebuffers.clear()};l.disposeTargetResource=function(g){g=g.id;this._activeTargets.has(g)&&(this._activeTargets.delete(g),this.disposeWithFramebuffers(this._depthTextures,g),this.disposeWithFramebuffers(this._depthBuffers,g),this.disposeWithFramebuffers(this._colorTextures,
g))};l.disposeWithFramebuffers=function(g,d){const c=g.get(d);c&&(this._framebuffers.forEach((u,t)=>{if(u.colorAttachment===c||u.depthStencilAttachment===c)u.detachAll(),u.dispose(),this._framebuffers.delete(t)}),c.dispose(),g.delete(d))};l.getDepthTexture=function(g,d){if(this.depthTextureSupported){var c=this._depthTextures.get(g.id);!c||c.descriptor.width===d.width&&c.descriptor.height===d.height||(c.dispose(),c=void 0);c||(c=new r(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,
wrapMode:33071,width:d.width,height:d.height}),this._depthTextures.set(g.id,c),this._activeTargets.add(g.id));return c}};l.getAllocatedDepthTexture=function(g){return this._depthTextures.get(g.id)};l.getDepthBuffer=function(g,d){if(!this.depthTextureSupported){var c=this._depthBuffers.get(g.id);c?c.descriptor.width===d.width&&c.descriptor.height===d.height||c.resize(d.width,d.height):(c=new b(this.rctx,{internalFormat:34041,...d}),this._depthBuffers.set(g.id,c),this._activeTargets.add(g.id));return c}};
l.getColorTexture=function(g,d){let c=this._colorTextures.get(g.id);!c||c.descriptor.width===d.width&&c.descriptor.height===d.height||(c.dispose(),c=void 0);c||(c=new r(this.rctx,{target:3553,pixelFormat:6408,internalFormat:g.internalFormat,dataType:g.dataType,samplingMode:null!=g.samplingMode?g.samplingMode:9729,wrapMode:33071,width:d.width,height:d.height}),this._colorTextures.set(g.id,c),this._activeTargets.add(g.id));return c};l.getAllocatedColorTexture=function(g){return this._colorTextures.get(g.id)};
l.registerDepthTarget=function(g={}){return{id:this._nextId++,...f,...g}};l.registerColorTarget=function(g={}){return{id:this._nextId++,...y,...g}};l.getFramebuffer=function(g,d,c){const u=this.getKey(d,c);let t=this._framebuffers.get(u);d=this.getColorTexture(d,g);if(this.depthTextureSupported){var h=c?this.getDepthTexture(c,g):void 0;if(!t)return t=c?new p(this.rctx,{colorTarget:0,depthStencilTarget:4},d,h):new p(this.rctx,{colorTarget:0,depthStencilTarget:0},d),this._framebuffers.set(u,t),t;if(t.width!==
g.width||t.height!==g.height||t.colorTexture!==d||t.depthStencilTexture!==h)t.detachAll(),t.resize(g.width,g.height),t.attachColorTexture(d),t.attachDepthStencilTexture(h);return t}h=c?this.getDepthBuffer(c,g):void 0;if(!t)return t=new p(this.rctx,{colorTarget:0,depthStencilTarget:c?3:0},d,h),this._framebuffers.set(u,t),t;if(t.width!==g.width||t.height!==g.height||t.colorTexture!==d)t.detachAll(),t.resize(g.width,g.height),t.attachColorTexture(d),t.attachDepthStencilBuffer(h);return t};l.getKey=function(g,
d){return`${g.id}_${d?d.id:"X"}_${g.name}${d?"_"+d.name:""}`};l.getGpuMemoryUsage=function(){let g=0;const d=new Set,c=u=>{d.has(u)||(d.add(u),g+=q.getGpuMemoryUsage(u))};this._depthTextures.forEach(c);this._colorTextures.forEach(c);this._depthBuffers.forEach(c);return g};return e}();a.RenderTargetHelper=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils",
"./depthRange","./Util"],function(a,p,b,r,q){let y=function(){function w(l){this.context=l;this.renderPlugins=[];this.slots=[];for(l=0;25>l;++l)this.slots[l]=[]}var e=w.prototype;e.add=function(l,g,d=null){d=g.initializeRenderContext(this.context,d);const c=()=>{this.renderPlugins.push(g);for(let u=0;u<l.length;++u)this.slots[l[u]].push(g);this.context.requestRender()};if(b.isPromise(d))return d.then(c);c()};e.remove=function(l){var g=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(d=>
d!==l);q.assert(this.renderPlugins.length<g,"Removing non-added render plugin");for(g=0;g<this.slots.length;++g)this.slots[g]=this.slots[g].filter(d=>d!==l);l.uninitializeRenderContext();this.context.requestRender()};e.prepareRender=function(l,g){for(const d of this.renderPlugins)d.prepareRender&&d.prepareRender(l,g)};e.render=function(){const l=this.slots[this.context.renderContext.slot];let g=!1;for(const d of l)d.canRender&&d.render(this.context.renderContext)&&(g=!0);return g};e.queryDepthRange=
function(l){const g=f;g.near=Infinity;g.far=-Infinity;for(const d of this.renderPlugins)if(d.queryDepthRange){const c=d.queryDepthRange(l);c&&r.union(g,c,g)}return g};p._createClass(w,[{key:"needsHighlight",get:function(){return this.renderPlugins.some(l=>l.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this.renderPlugins.some(l=>l.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const l=this.slots[18];return!!l&&0<l.length}},{key:"renderOccludedFlags",
get:function(){let l=0;this.renderPlugins.forEach(g=>{g.renderOccludedFlags&&(l|=g.renderOccludedFlags)});return l}}]);return w}();const f={near:0,far:0};a.RenderPluginManager=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/trackingUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../../chunks/builtins ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject ./Camera ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ./Util ../../../../chunks/ShadowCast.glsl ../shaders/ShadowCastTechnique ../../../support/Scheduler ../../../webgl/Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J){u=function(){function I(L,N,R,S,P,Q){this._rctx=L;this._stage=R;this._prepareForShadowMapPass=S;this._renderToShadowMap=P;this._requestRender=Q;this._sampleCount=this._progress=0;this._cachedCamera=new C;this._contentCamera=new C;this._enabled=!1;this._cachedLightDirections=[];this._depthRange=A.ZERO;this._previewing=!1;this._handles=new r;this._cameraForcedForScreenshot=!1;this._shadowMap=new E(L,R.viewingMode);this._shadowMap.enabled=
!0;this._vao=B.createQuadVAO(L);S={rctx:L,viewingMode:R.viewingMode};P=new M.ShadowCastTechniqueConfiguration;P.pass=0;this._accumulationTechnique=new M.ShadowCastTechnique(S,P);this._fbo=new t(L,{colorTarget:0,depthStencilTarget:0,width:0,height:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0});this._accumulationParams={camera:this._cachedCamera,linearDepthTexture:null,shadowMap:this._shadowMap,inverseView:e.create(),projInfo:c.create(),zScale:l.create()};
this._accumulationRenderer=new D.ShadowCastRenderer(N,L,this,Q);this._handles.add(this._stage.resourceController.scheduler.registerTask(H.TaskPriority.SHADOW_ACCUMULATOR,this));this._handles.add(f.reactionInit(()=>R.renderView,V=>{this._handles.remove(I.renderViewHandleKey);y.isNone(V)||this._handles.add(V.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),I.renderViewHandleKey)}))}var F=I.prototype;F.runTask=function(L){for(this._prepareForShadowMapPass(this._cachedCamera,
this._contentCamera);!L.done&&!this._isDoneAccumulating;)this._accumulateShadow(),L.madeProgress();this._requestRender()};F.accumulateFixedSamples=function(){if(this.isAccumulating&&this._canAccumulate){(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();var L=this._cameraForcedForScreenshot?this._sampleCount:Math.min(I.previewSamples,this._sampleCount-this._progress);for(let N=0;N<L;++N)this._accumulateShadow();this._cameraForcedForScreenshot=!1}};F.render=function(){this._accumulationRenderer.render()};
F.dispose=function(){this._stop();this._handles.destroy();this._accumulationRenderer=y.disposeMaybe(this._accumulationRenderer);this._shadowMap=y.disposeMaybe(this._shadowMap);this._fbo=y.disposeMaybe(this._fbo);this._vao=y.disposeMaybe(this._vao);this._accumulationTechnique=y.disposeMaybe(this._accumulationTechnique);this._sampleCount=this._cachedLightDirections.length=0};F.setOptions=function(L){void 0!==L.enabled&&this._setEnabled(L.enabled);void 0!==L.previewing&&this.setPreviewing(L.previewing);
void 0!==L.lightDirections&&this.setLightDirections(L.lightDirections);this._accumulationRenderer.setOptions(L)};F.setPreviewing=function(L){this._previewing!==L&&(this._previewing=L,this._requestRenderIfEnabled())};F.setLightDirections=function(L){this._lightDirections=L};F.setAccumulationDependencies=function(L,N,R,S){this._accumulationParams.linearDepthTexture=L;this._depthRange=N;this._updateCamera(R);this._contentCamera=S};F.readAccumulatedShadow=function(L,N){if(!this._isActive||1>this._progress||
0>L||L>this._fbo.width||0>N||N>this._fbo.height)return 0;const R=O;this._fbo.readPixels(L,N,1,1,6408,5121,R);return R[0]/this._progress};F._start=function(){this._progress=0;this._enabled=!0};F._stop=function(){this._enabled=!1};F._invalidate=function(){this._progress=0;this._requestRenderIfEnabled()};F._clear=function(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(16384);this._progress=0};F._accumulateShadow=function(){this._renderToShadowMap(this._shadowMap,
this._lightDirections[this._progress],this._cachedCamera,this._depthRange);this._rctx.bindFramebuffer(this._fbo);this._rctx.useProgram(this._accumulationTechnique.program);this._accumulationTechnique.bindPipelineState(this._rctx);this._accumulationTechnique.bindPass(this._accumulationParams);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(this._accumulationTechnique.primitiveType,0,J.vertexCount(this._vao,"geometry"));this._progress++};F._updateCamera=function(L){if(!L.equals(this._cachedCamera)){var {fullWidth:N,
fullHeight:R,projectionMatrix:S,viewMatrix:P,center:Q}=L;this._cachedCamera.copyFrom(L);this._fbo.resize(N,R);G.inverseProjectionInfo(S,N,R,this._projInfo,this._zScale);w.translate(this._inverseView,P,Q);w.invert(this._inverseView,this._inverseView);this._opacityFromElevation=1-q.smoothstep(D.shadowCastDisableElevationMin,D.shadowCastDisableElevationMax,L.relativeElevation)}};F._setEnabled=function(L){L!==this._enabled&&(L?this._start():this._stop())};F._requestRenderIfEnabled=function(){this._enabled&&
this._requestRender()};p._createClass(I,[{key:"computedSamples",get:function(){return this._progress}},{key:"shadowCastTexture",get:function(){return this._fbo.colorTexture}},{key:"running",get:function(){return this._isRefining&&this._canAccumulate}},{key:"isAccumulating",get:function(){return this._isPreviewing||this._isRefining}},{key:"_isRefining",get:function(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}},{key:"_isPreviewing",get:function(){return this._isActive&&this._previewing}},
{key:"_isActive",get:function(){return this._enabled&&0<this._sampleCount}},{key:"_canAccumulate",get:function(){return null!==this._accumulationParams.linearDepthTexture&&this._depthRange!==A.ZERO&&this._opacityFromElevation>D.shadowCastDisabledElevationThreshold}},{key:"_isDoneAccumulating",get:function(){return this._progress>=this._sampleCount}},{key:"_lightDirections",get:function(){return this._cachedLightDirections},set:function(L){const N=this._cachedLightDirections;if(!b.equals(N,L,g.equals)){var R=
L.length;N.length=R;this._sampleCount=Math.min(K.shadowCastMaxSamples,R);for(let S=0;S<R;++S){const P=L[S],Q=N[S]||d.create();g.copy(Q,P);N[S]=Q}this._invalidate()}}},{key:"_projInfo",get:function(){return this._accumulationParams.projInfo}},{key:"_zScale",get:function(){return this._accumulationParams.zScale}},{key:"_inverseView",get:function(){return this._accumulationParams.inverseView}},{key:"_opacityFromElevation",get:function(){return this._accumulationRenderer.opacityFromElevation},set:function(L){this._accumulationRenderer.opacityFromElevation=
L}},{key:"test",get:function(){return{lightDirections:this._lightDirections,isDone:()=>this._isDoneAccumulating,isActive:()=>this._isActive}}}]);return I}();u.previewSamples=6;u.renderViewHandleKey="renderView";const O=new Uint8Array(4);a.ShadowAccumulator=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./glUtil3D ../shaders/ShadowCastTechnique ../../../webgl/Util".split(" "),
function(a,p,b,r,q,y,f,w){const e=q.fromValues(.01,0,.25,1),l=1/512;q=function(){function g(c,u,t,h){this._techniqueRep=c;this._rctx=u;this._shadowAccumulator=t;this._requestRender=h;this._enabled=!1;this._vao=y.createQuadVAO(u);this._visualizationConfig=new f.ShadowCastTechniqueConfiguration;this._visualizationConfig.pass=1;this._visualizationConfig.visualization=0;this._visualizeShadowCastTechnique=c.acquire(f.ShadowCastTechnique,this._visualizationConfig);this._visualizationParams={shadowCastMap:this._shadowCastTexture,
sampleScale:0,color:e,threshold:.5,bandSize:.1,opacityFromElevation:1}}var d=g.prototype;d.dispose=function(){this._stop();this._vao=b.disposeMaybe(this._vao);this._visualizeShadowCastTechnique=b.disposeMaybe(this._visualizeShadowCastTechnique);this._shadowAccumulator=null};d.render=function(){this._isRenderingVisualization&&(this._sampleScale=1/this._computedSamples,this._rctx.bindVAO(this._vao),this._rctx.useProgram(this._visualizeShadowCastTechnique.program),this._visualizeShadowCastTechnique.bindPipelineState(this._rctx),
this._visualizeShadowCastTechnique.bindPass(this._visualizationParams),this._rctx.drawArrays(this._visualizeShadowCastTechnique.primitiveType,0,w.vertexCount(this._vao,"geometry")))};d.setOptions=function(c){void 0!==c.enabled&&this._setEnabled(c.enabled);void 0!==c.color&&this._setColor(c.color);void 0!==c.threshold&&(this._threshold=c.threshold);void 0!==c.visualization&&(this._visualization=c.visualization);void 0!==c.bandSize&&(this._bandSize=c.bandSize);void 0!==c.bandsEnabled&&(this._bandsEnabled=
c.bandsEnabled)};d._setColor=function(c){r.exactEquals(c,this._visualizationParams.color)||(r.copy(this._visualizationParams.color,c),this._requestRenderIfRunning())};d._setEnabled=function(c){c!==this._enabled&&(c?this._start():this._stop())};d._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};d._start=function(){this._enabled=!0;this._requestRender()};d._stop=function(){this._enabled=!1;this._requestRender()};p._createClass(g,[{key:"opacityFromElevation",get:function(){return this._visualizationParams.opacityFromElevation},
set:function(c){this._visualizationParams.opacityFromElevation=c}},{key:"_isRenderingVisualization",get:function(){return this._enabled&&0<this._computedSamples&&this.opacityFromElevation>l}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},{key:"_shadowCastTexture",get:function(){return this._shadowAccumulator.shadowCastTexture}},{key:"_sampleScale",get:function(){return this._visualizationParams.sampleScale},set:function(c){this._visualizationParams.sampleScale=
c}},{key:"_threshold",get:function(){return this._visualizationParams.threshold},set:function(c){this._threshold!==c&&(this._visualizationParams.threshold=c,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._visualizationConfig.visualization},set:function(c){if(c!==this._visualization){var u=this._visualizationConfig;u.visualization=c;this._visualizeShadowCastTechnique=this._techniqueRep.releaseAndAcquire(f.ShadowCastTechnique,u,this._visualizeShadowCastTechnique);
this._requestRenderIfRunning()}}},{key:"_bandSize",get:function(){return this._visualizationParams.bandSize},set:function(c){c!==this._bandSize&&(this._visualizationParams.bandSize=c,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._visualizationConfig.bandsEnabled},set:function(c){if(c!==this._bandsEnabled){var u=this._visualizationConfig;u.bandsEnabled=c;this._visualizeShadowCastTechnique=this._techniqueRep.releaseAndAcquire(f.ShadowCastTechnique,u,this._visualizeShadowCastTechnique);
this._requestRenderIfRunning()}}}]);return g}();a.ShadowCastRenderer=q;a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ShadowCastTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCast.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){y=function(c){function u(){return c.apply(this,arguments)||this}b._inheritsLoose(u,c);var t=u.prototype;t.initializeProgram=function(h){const m=u.shader.get().build(this.configuration);return new l.Program(h.rctx,m,w.Default3D)};t.initializePipeline=function(h){return 0===this.configuration.pass?d.makePipelineState({blending:d.separateBlendingParams(1,1,1,1),colorWrite:d.defaultColorWriteParams,depthTest:null,depthWrite:null}):1===this.configuration.pass||2===this.configuration.pass?
d.makePipelineState({blending:e.blendingDefault,colorWrite:d.defaultColorWriteParams,depthTest:null,depthWrite:null}):d.makePipelineState({})};t.bindPass=function(h){0===this.configuration.pass||2===this.configuration.pass?(this.program.bindTexture(h.linearDepthTexture,"depthMap"),h.shadowMap.bind(this.program),h.shadowMap.bindView(this.program,h.camera.center),this.program.setUniform2fv("nearFar",h.camera.nearFar),this.program.setUniformMatrix4fv("inverseView",h.inverseView),this.program.setUniform4fv("projInfo",
h.projInfo),this.program.setUniform2fv("zScale",h.zScale)):1===this.configuration.pass&&(this.program.bindTexture(h.shadowCastMap,"shadowCastMap"),this.program.setUniform1f("sampleScale",h.sampleScale),this.program.setUniform1f("opacityFromElevation",h.opacityFromElevation),this.program.setUniform4fv("color",h.color),0===this.configuration.visualization&&this.configuration.bandsEnabled?this.program.setUniform1f("bandSize",h.bandSize):1===this.configuration.visualization&&this.program.setUniform1f("threshold",
h.threshold))};b._createClass(u,[{key:"primitiveType",get:function(){return 5}}]);return u}(y.ShaderTechnique);y.shader=new q.ReloadableShaderModule(g.ShadowCastShader,()=>new Promise(function(c,u){a(["./ShadowCast.glsl"],c,u)}));q=function(c){function u(){var t=c.apply(this,arguments)||this;t.pass=0;t.visualization=0;t.bandsEnabled=!1;return t}b._inheritsLoose(u,c);return u}(f.ShaderTechniqueConfiguration);r.__decorate([f.parameter({count:3})],q.prototype,"pass",void 0);r.__decorate([f.parameter()],
q.prototype,"visualization",void 0);r.__decorate([f.parameter()],q.prototype,"bandsEnabled",void 0);p.ShadowCastTechnique=y;p.ShadowCastTechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/ShadowCast.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w){function e(d){const c=new w.ShaderBuilder;c.fragment.include(y.RgbaFloatEncoding);c.fragment.include(b.ReadLinearDepth);c.include(q.CameraSpace);c.include(p.ScreenSpacePass);var {pass:u}=d;if(1===u){const {visualization:t,bandsEnabled:h}=d;c.fragment.constants.add("inverseSampleValue","float",255);c.fragment.uniforms.add("shadowCastMap","sampler2D");c.fragment.uniforms.add("sampleScale","float");c.fragment.uniforms.add("opacityFromElevation","float");d=0===t;u=1===t;c.fragment.uniforms.add("color",
"vec4");d?h&&c.fragment.uniforms.add("bandSize","float"):u&&c.fragment.uniforms.add("threshold","float");c.fragment.code.add(f.glsl`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;

        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${u?f.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${d&&h?f.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(color.xyz, color.a * opacityFromElevation ${d?f.glsl`* strength`:""});
      }
    `)}else if(0===u||2===u)c.include(r.ReadShadowMap),c.fragment.uniforms.add("depthMap","sampler2D"),c.fragment.uniforms.add("inverseView","mat4"),c.fragment.uniforms.add("nearFar","vec2"),0===u?c.fragment.constants.add("sampleValue","float",l):c.fragment.constants.add("shadowColor","vec4",[0,0,0,.8]),c.fragment.code.add(f.glsl`
      void main(void) {

        float depth = rgba2float(texture2D(depthMap, uv));
        // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
        if (depth == 0.0) {
          discard;
        }

        float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

        if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
          discard;
        }

        vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
        vec4 worldSpacePos = inverseView * currentPixelPos;

        mat4 shadowMatrix;
        float linearDepth = -currentPixelDepth;
        int i = chooseCascade(linearDepth, shadowMatrix);

        if (i >= uShadowMapNum) {
          discard;
        }

        vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

        // vertex completely outside? -> no shadow
        if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
          discard;
        }

        vec2 uvShadow = cascadeCoordinates(i, lvpos);

        float depthShadow = readShadowMapDepth(uvShadow, uShadowMapTex);
        bool shadow = depthShadow < lvpos.z;

        if (!shadow) {
          discard;
        }

        gl_FragColor = ${0===u?f.glsl`vec4(sampleValue)`:f.glsl`shadowColor`};
      }
    `);return c}const l=1/255;var g=Object.freeze({__proto__:null,shadowCastMaxSamples:255,build:e});a.ShadowCastShader=g;a.build=e;a.shadowCastMaxSamples=255})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.CameraSpace=function(b){b.fragment.uniforms.add("projInfo","vec4");b.fragment.uniforms.add("zScale","vec2");b.fragment.code.add(p.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./Camera ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){function n(X,T){f.set(aa,X[T],X[T+3]);return aa}let z=function(){this.camera=new c;this.lightMat=y.create()},k=function(){function X(Y,ea,ia=0){this.rctx=Y;this.viewingMode=ea;this._enabled=!1;this._snapshots=[];this.maxTextureSize=this.textureSize=0;this.numCascades=1;this.maxNumCascades=4;this.splitSchemeLambda=0;this.warp=!0;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.maxTextureSize=this.rctx.parameters.maxTextureSize;for(Y=0;4>Y;++Y)this.cascades.push(new z);
this.snapshotCount=ia}var T=X.prototype;T.dispose=function(){this.discardDepthTexture();this.discardAllSnapshots()};T.getSnapshot=function(Y){return this.enabled?this._snapshots[Y]:null};T.getCascades=function(){for(let Y=0;Y<this.numCascades;++Y)F[Y]=this.cascades[Y];F.length=this.numCascades;return F};T.start=function(Y,ea,ia){u.assert(this.enabled);this.textureSize=this.computeTextureSize(Y.fullWidth,Y.fullHeight);this.ensureDepthTexture();const {near:la,far:pa}=this.clampNearFar(ia);this.computeCascadeDistances(pa,
la);this.setupMatrices(Y,ea);ia=Y.viewMatrix;Y=Y.projectionMatrix;for(let ua=0;ua<this.numCascades;++ua)this.constructCascade(ua,Y,ia,ea);this.lastOrigin=null;this.clear()};T.finish=function(Y){u.assert(this.enabled);this.rctx.bindFramebuffer(Y)};T.bind=function(Y){this.enabled?(this._depthTextureUnit=Y.bindTexture(this._depthTexture,"uShadowMapTex"),Y.setUniform1f("uDepthHalfPixelSz",.5/this.textureSize),Y.setUniform1i("uShadowMapNum",this.numCascades),Y.setUniform4f("uShadowMapDistance",this.cascadeDistances[0],
1<this.numCascades?this.cascadeDistances[1]:Infinity,2<this.numCascades?this.cascadeDistances[2]:Infinity,3<this.numCascades?this.cascadeDistances[3]:Infinity)):Y.setUniform1f("uDepthHalfPixelSz",-1)};T.bindView=function(Y,ea){if(this.enabled){var ia=this.lastOrigin;if(!ia||ia[0]!==ea[0]||ia[1]!==ea[1]||ia[2]!==ea[2])for(this.lastOrigin=this.lastOrigin||l.create(),e.copy(this.lastOrigin,ea),ia=0;ia<this.numCascades;++ia){q.translate(L,this.cascades[ia].lightMat,ea);for(let la=0;16>la;++la)N[16*ia+
la]=L[la]}Y.setUniformMatrix4fv("uShadowMapMatrix",N)}};T.takeCascadeSnapshotTo=function(Y,ea){u.assert(this.enabled);this.ensureSnapshot(ea);this._bindFbo();const ia=this.rctx;ea=ia.bindTexture(this._snapshots[ea],h.TEXTURE_UNIT_FOR_UPDATES);ia.gl.copyTexSubImage2D(3553,0,Y.camera.viewport[0],Y.camera.viewport[1],Y.camera.viewport[0],Y.camera.viewport[1],Y.camera.viewport[2],Y.camera.viewport[3]);ia.bindTexture(ea,h.TEXTURE_UNIT_FOR_UPDATES)};T.clear=function(){const Y=this.rctx;this._bindFbo();
Y.setClearColor(1,1,1,1);Y.clearSafe(16640)};T.computeTextureSize=function(Y,ea){return Math.min(this.maxTextureSize,2*2**Math.round(.5*Math.log(Y*Y+ea*ea)*Math.LOG2E+.35))};T.ensureDepthTexture=function(){if(null==this._depthTexture||this._depthTexture.descriptor.width!==this.textureSize)this.discardDepthTexture(),this._depthTexture=new h(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize}),this.fbo=new t(this.rctx,
{colorTarget:0,depthStencilTarget:1,width:this.textureSize,height:this.textureSize},this._depthTexture)};T.ensureSnapshot=function(Y){const ea=this._snapshots[Y];b.isSome(ea)&&ea.descriptor.width===this.textureSize||(this.discardSnapshot(Y),this._snapshots[Y]=new h(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize}))};T.discardDepthTexture=function(){this.fbo=b.disposeMaybe(this.fbo);this._depthTexture=
b.disposeMaybe(this._depthTexture)};T.discardSnapshot=function(Y){this._snapshots[Y]=b.disposeMaybe(this._snapshots[Y])};T.discardAllSnapshots=function(){for(let Y=0;Y<this.snapshotCount;++Y)this.discardSnapshot(Y)};T._bindFbo=function(){const Y=this.rctx;b.isSome(this._depthTextureUnit)&&(Y.bindTexture(null,this._depthTextureUnit),this._depthTextureUnit=null);Y.bindFramebuffer(this.fbo)};T.constructCascade=function(Y,ea,ia,la){const pa=this.cascades[Y];var ua=-this.cascadeDistances[Y],wa=-this.cascadeDistances[Y+
1];ua=(ea[10]*ua+ea[14])/Math.abs(ea[11]*ua+ea[15]);ea=(ea[10]*wa+ea[14])/Math.abs(ea[11]*wa+ea[15]);u.assert(ua<ea);for(wa=0;8>wa;++wa){g.set(A,0===wa%4||3===wa%4?-1:1,0===wa%4||1===wa%4?-1:1,4>wa?ua:ea,1);g.transformMat4(B[wa],A,C);for(let Fa=0;3>Fa;++Fa)B[wa][Fa]/=B[wa][3]}e.negate(I,B[0]);q.translate(v,O,I);pa.camera.viewMatrix=v;for(ua=0;8>ua;++ua)e.transformMat4(B[ua],B[ua],pa.camera.viewMatrix);e.copy(D,B[0]);e.copy(E,B[0]);for(ua=1;8>ua;++ua)for(ea=0;3>ea;++ea)D[ea]=Math.min(D[ea],B[ua][ea]),
E[ea]=Math.max(E[ea],B[ua][ea]);D[2]-=200;E[2]+=200;pa.camera.near=-E[2];pa.camera.far=-D[2];this.warp?this.constructTrapezoidalProjection(ia,la,pa):this.constructOrthogonalProjection(pa);q.multiply(pa.lightMat,pa.camera.projectionMatrix,pa.camera.viewMatrix);ia=this.textureSize/2;pa.camera.viewport[0]=0===Y%2?0:ia;pa.camera.viewport[1]=0===Math.floor(Y/2)?0:ia;pa.camera.viewport[2]=ia;pa.camera.viewport[3]=ia};T.constructOrthogonalProjection=function(Y){q.ortho(Y.camera.projectionMatrix,D[0],E[0],
D[1],E[1],Y.camera.near,Y.camera.far)};T.constructTrapezoidalProjection=function(Y,ea,ia){var la=1/B[0][3],pa=1/B[4][3];u.assert(la<pa);la+=Math.sqrt(la*pa);var ua=Math.sin(p.acosClamped(Y[2]*ea[0]+Y[6]*ea[1]+Y[10]*ea[2]));Y=B;var wa=la/ua;ea=G;var Fa=K,La=M;pa=H;la=J;f.set(R,0,0);for(var Ma=0;4>Ma;++Ma)f.add(R,R,Y[Ma]);f.scale(R,R,.25);f.set(S,0,0);for(Ma=4;8>Ma;++Ma)f.add(S,S,Y[Ma]);f.scale(S,S,.25);f.lerp(P[0],Y[4],Y[5],.5);f.lerp(P[1],Y[5],Y[6],.5);f.lerp(P[2],Y[6],Y[7],.5);f.lerp(P[3],Y[7],Y[4],
.5);Ma=0;var Sa=f.squaredDistance(P[0],R);for(var Ia=1;4>Ia;++Ia){var va=f.squaredDistance(P[Ia],R);va<Sa&&(Sa=va,Ma=Ia)}f.subtract(Q,P[Ma],Y[Ma+4]);Ma=Q[0];Q[0]=-Q[1];Q[1]=Ma;f.subtract(V,S,R);0>f.dot(V,Q)&&f.negate(Q,Q);f.lerp(Q,Q,V,ua);f.normalize(Q,Q);ua=Ma=f.dot(f.subtract(ca,Y[0],R),Q);for(Sa=1;8>Sa;++Sa)Ia=f.dot(f.subtract(ca,Y[Sa],R),Q),Ia<ua?ua=Ia:Ia>Ma&&(Ma=Ia);f.copy(ea,R);f.scale(ca,Q,ua-wa);f.add(ea,ea,ca);Ia=-1;va=1;wa=Sa=0;for(let ma=0;8>ma;++ma){f.subtract(ba,Y[ma],ea);f.normalize(ba,
ba);const ta=Q[0]*ba[1]-Q[1]*ba[0];0<ta?ta>Ia&&(Ia=ta,Sa=ma):ta<va&&(va=ta,wa=ma)}u.verify(0<Ia,"leftArea");u.verify(0>va,"rightArea");f.scale(Z,Q,ua);f.add(Z,Z,R);f.scale(ha,Q,Ma);f.add(ha,ha,R);fa[0]=-Q[1];fa[1]=Q[0];Fa=u.rayRay2D(ea,Y[wa],ha,f.add(ca,ha,fa),1,Fa);La=u.rayRay2D(ea,Y[Sa],ha,ca,1,La);pa=u.rayRay2D(ea,Y[Sa],Z,f.add(ca,Z,fa),1,pa);Y=u.rayRay2D(ea,Y[wa],Z,ca,1,la);u.verify(Fa,"rayRay");u.verify(La,"rayRay");u.verify(pa,"rayRay");u.verify(Y,"rayRay");La=G;Y=K;ea=H;pa=J;la=ia.camera.projectionMatrix;
f.subtract(W,ea,pa);f.scale(W,W,.5);U[0]=W[0];U[1]=W[1];U[2]=0;U[3]=W[1];U[4]=-W[0];U[5]=0;U[6]=W[0]*W[0]+W[1]*W[1];U[7]=W[0]*W[1]-W[1]*W[0];U[8]=1;U[6]=-f.dot(n(U,0),La);U[7]=-f.dot(n(U,1),La);La=f.dot(n(U,0),ea)+U[6];Fa=f.dot(n(U,1),ea)+U[7];wa=f.dot(n(U,0),pa)+U[6];pa=f.dot(n(U,1),pa)+U[7];La=-(La+wa)/(Fa+pa);U[0]+=U[1]*La;U[3]+=U[4]*La;U[6]+=U[7]*La;La=1/(f.dot(n(U,0),ea)+U[6]);Fa=1/(f.dot(n(U,1),ea)+U[7]);U[0]*=La;U[3]*=La;U[6]*=La;U[1]*=Fa;U[4]*=Fa;U[7]*=Fa;U[2]=U[1];U[5]=U[4];U[8]=U[7];U[7]+=
1;La=f.dot(n(U,1),Y)+U[7];Fa=f.dot(n(U,2),Y)+U[8];wa=f.dot(n(U,1),ea)+U[7];pa=f.dot(n(U,2),ea)+U[8];La=-.5*(La/Fa+wa/pa);U[1]+=U[2]*La;U[4]+=U[5]*La;U[7]+=U[8]*La;La=f.dot(n(U,1),Y)+U[7];Fa=f.dot(n(U,2),Y)+U[8];wa=-Fa/La;U[1]*=wa;U[4]*=wa;U[7]*=wa;la[0]=U[0];la[1]=U[1];la[2]=0;la[3]=U[2];la[4]=U[3];la[5]=U[4];la[6]=0;la[7]=U[5];la[8]=0;la[9]=0;la[10]=1;la[11]=0;la[12]=U[6];la[13]=U[7];la[14]=0;la[15]=U[8];ia.camera.projectionMatrix[10]=2/(D[2]-E[2]);ia.camera.projectionMatrix[14]=-(D[2]+E[2])/(D[2]-
E[2])};T.setupMatrices=function(Y,ea){q.multiply(x,Y.projectionMatrix,Y.viewMatrix);q.invert(C,x);Y=1===this.viewingMode?Y.eye:e.set(I,0,0,1);q.lookAt(O,[0,0,0],[-ea[0],-ea[1],-ea[2]],Y)};T.clampNearFar=function(Y){let {near:ea,far:ia}=Y;2>ea&&(ea=2);2>ia&&(ia=2);ea>=ia&&(ea=2,ia=4);return{near:ea,far:ia}};T.computeCascadeDistances=function(Y,ea){this.numCascades=Math.min(1+Math.floor(u.logWithBase(Y/ea,4)),this.maxNumCascades);const ia=(Y-ea)/this.numCascades;Y=(Y/ea)**(1/this.numCascades);let la=
ea;for(let pa=0;pa<this.numCascades+1;++pa)this.cascadeDistances[pa]=p.lerp(la,ea,this.splitSchemeLambda),la*=Y,ea+=ia};T.getGpuMemoryUsage=function(){var Y,ea;return this._snapshots.reduce((ia,la)=>ia+m.getGpuMemoryUsage(la),null!=(Y=null==(ea=this.fbo)?void 0:ea.gpuMemoryUsage)?Y:0)};a._createClass(X,[{key:"maxCascades",get:function(){return this.maxNumCascades},set:function(Y){this.maxNumCascades=p.clamp(Math.floor(Y),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(Y){this._enabled=
Y;Y||(this.discardDepthTexture(),this.discardAllSnapshots())}},{key:"snapshotCount",get:function(){return this._snapshots.length},set:function(Y){var ea=this._snapshots.length;if(Y>ea){var ia=Y-ea;this._snapshots.length=Y;for(Y=0;Y<ia;++Y)this._snapshots[ea+Y]=null}else if(Y<this.snapshotCount){ea-=Y;for(ia=0;ia<ea;++ia)this.discardSnapshot(Y+ia);this._snapshots.length=Y}}},{key:"test",get:function(){const Y=this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,
depthTexture:this._depthTexture,set splitSchemeLambda(ea){Y.splitSchemeLambda=ea},get splitSchemeLambda(){return Y.splitSchemeLambda},set warp(ea){Y.warp=ea},get warp(){return Y.warp}}}}]);return X}();const v=y.create(),x=y.create(),C=y.create(),A=d.create(),B=[];for(let X=0;8>X;++X)B.push(d.create());const D=l.create(),E=l.create(),G=w.create(),K=w.create(),M=w.create(),H=w.create(),J=w.create(),O=y.create(),I=l.create(),F=[],L=y.create(),N=new Float32Array(64),R=w.create(),S=w.create(),P=[w.create(),
w.create(),w.create(),w.create()],Q=w.create(),V=w.create(),ca=w.create(),ba=w.create(),Z=w.create(),ha=w.create(),fa=w.create(),aa=w.create(),W=w.create(),U=r.create();return k})},"esri/views/3d/webgl-engine/lib/ShadowHighlightHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec4f32 ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),function(a,p,b,r,q,y,f){let w=function(){function e(g,d){this._rctx=
g;this._maxOpacity=1;this._defaultOptions={shadowColor:r.fromValues(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1};this._technique=new y.ShadowHighlightTechnique({rctx:g,viewingMode:d},null);this._vao=q.createQuadVAO(this._rctx)}var l=e.prototype;l.render=function(g,d){g.shadowMap.enabled&&g.linearDepthTexture&&this.isVisible&&(this._rctx.bindFramebuffer(d),this._rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this._rctx),this._technique.bindPass(this._defaultOptions,
g),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(this._technique.primitiveType,0,f.vertexCount(this._vao,"geometry")))};l.getGpuMemoryUsage=function(){return this._vao?this._vao.size:0};l.setDefaultOptions=function(g){this._defaultOptions=g;this._updateMaxOpacity()};l.dispose=function(){this._vao=b.disposeMaybe(this._vao);this._technique=b.disposeMaybe(this._technique)};l._updateMaxOpacity=function(){const g=this._defaultOptions;this._maxOpacity=Math.max(g.shadowOpacity,g.occludedShadowOpacity)*
g.shadowColor[3]};p._createClass(e,[{key:"highlightShadowMapSlot",get:function(){return this._technique.highlightShadowMapSlot}},{key:"defaultSnapshotSlot",get:function(){return this._technique.defaultSnapshotSlot}},{key:"isVisible",get:function(){return.001953125<=this._maxOpacity*this._technique.opacityElevation*this._technique.dayNightTerminator}}]);return e}();a.ShadowHighlightHelper=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/Util ../../../../chunks/ShadowHighlight.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n){c=function(A){function B(){var E=A.apply(this,arguments)||this;E.opacityElevation=1;E.dayNightTerminator=1;E.highlightShadowMapSlot=0;E.defaultSnapshotSlot=1;return E}b._inheritsLoose(B,A);var D=B.prototype;D.initializeProgram=function(E){var G=B.shader.get();this._viewingMode=E.viewingMode;G=G.build({highlightedThreshold:.99999,selfShadowThreshold:.025});return new t.Program(E.rctx,G,u.Default3D)};D.initializePipeline=function(E){return n.makePipelineState({blending:n.separateBlendingParams(770,
1,771,771),colorWrite:n.defaultColorWriteParams,depthTest:null,depthWrite:null})};D.bindPass=function(E,G){this.opacityElevation=1-r.smoothstep(4E4,5E4,G.camera.relativeElevation);var K=1===this._viewingMode?e.normalize(z,G.camera.center):e.set(z,0,0,1);K=e.dot(K,G.lighting.lightingMainDirection);this.dayNightTerminator=r.smoothstep(0,1,r.clamp(30*K,0,1));this.program.bindTexture(G.linearDepthTexture,"depthMap");this.program.bindTexture(G.highlightColorTexture,"highlightMap");e.transformMat4(k,G.lighting.lightingMainDirection,
G.camera.viewInverseTransposeMatrix);e.normalize(k,k);h.inverseProjectionInfo(G.camera.projectionMatrix,G.camera.fullWidth,G.camera.fullHeight,x,v);y.translate(C,G.camera.viewMatrix,G.camera.center);y.invert(C,C);this.program.setUniform4fv("color",E.shadowColor);this.program.setUniform1f("opacity",E.shadowOpacity);this.program.setUniform1f("occludedOpacity",E.occludedShadowOpacity);this.program.setUniform1f("terminationFactor",this.opacityElevation*this.dayNightTerminator);this.program.setUniform2fv("nearFar",
G.camera.nearFar);this.program.setUniformMatrix4fv("inverseView",C);this.program.setUniform4fv("projInfo",x);this.program.setUniform2fv("zScale",v);this.program.setUniform3fv("lightingMainDirectionView",k);this.program.setUniform2f("texelSize",1/G.linearDepthTexture.descriptor.width,1/G.linearDepthTexture.descriptor.height);G.shadowMap.bind(this.program);G.shadowMap.bindView(this.program,G.camera.center);E=G.shadowMap.getSnapshot(this.highlightShadowMapSlot);q.isSome(E)&&this.program.bindTexture(E,
"highlightDepthTex");E=G.shadowMap.getSnapshot(this.defaultSnapshotSlot);q.isSome(E)&&this.program.bindTexture(E,"defaultDepthTex")};b._createClass(B,[{key:"primitiveType",get:function(){return 5}}]);return B}(c.ShaderTechnique);c.shader=new d.ReloadableShaderModule(m.ShadowHighlightShader,()=>new Promise(function(A,B){a(["./ShadowHighlight.glsl"],A,B)}));const z=l.create(),k=l.create(),v=w.create(),x=g.create(),C=f.create();p.ShadowHighlightTechnique=c;Object.defineProperty(p,"__esModule",{value:!0})})},
"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y,f,w,e){function l(d){const c=new e.ShaderBuilder;c.include(q.ReadShadowMap);c.fragment.include(f.RgbaFloatEncoding);c.fragment.include(r.ReadLinearDepth);c.include(y.CameraSpace);c.include(p.ScreenSpacePass);c.fragment.uniforms.add("defaultDepthTex","sampler2D").add("highlightDepthTex","sampler2D").add("depthMap","sampler2D").add("highlightMap","sampler2D").add("color","vec4").add("nearFar","vec2").add("opacity","float").add("occludedOpacity","float").add("terminationFactor",
"float").add("inverseView","mat4").add("lightingMainDirectionView","vec3").add("texelSize","vec2");c.fragment.constants.add("unoccludedHighlightFlag","vec4",b.unoccludedHighlightFlag).add("highlightedThreshold","float",d.highlightedThreshold).add("selfShadowThreshold","float",d.selfShadowThreshold);c.fragment.code.add(w.glsl`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`);c.fragment.code.add(w.glsl`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseView * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= uShadowMapNum) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float differenceOpacity = opacity;
float bothOpacity = occludedOpacity;
float fragOpacity = (shadowDefault || shaded) ? bothOpacity : differenceOpacity;
gl_FragColor = vec4(color.rgb, color.a * fragOpacity * terminationFactor);
}`);return c}var g=Object.freeze({__proto__:null,build:l});a.ShadowHighlightShader=g;a.build=l})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/boundedPlane"],function(a,p){const b=p.create();return function(){function r(){this._worldPlane=b}a._createClass(r,[{key:"isEnabled",get:function(){return this.plane!==b}},{key:"plane",get:function(){return this._worldPlane},set:function(q){this._worldPlane=q?q:b}}]);return r}()})},
"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../support/requestImageUtils ./glUtil3D ./SMAATechnique ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),function(a,p,b,r,q,y,f,w){let e=function(){function l(d,c){this.rctx=d;this._techniqueRep=c;this.resourceLoadingPromise=null;this.isEnabled=!1}var g=l.prototype;g.loadResources=function(d){if(!this.data||!this.textureArea||!this.textureSearch){const c=
this.resourceLoadingPromise||this.loadDataModule().then(()=>this.loadTextures());d&&c.then(d);this.resourceLoadingPromise||(this.resourceLoadingPromise=c,c.then(()=>this.resourceLoadingPromise=null));return!1}return!0};g.loadDataModule=function(){return this.data?Promise.resolve():(new Promise(function(d,c){a(["./SmaaRenderPassData"],d,c)})).then(d=>{this.data=d})};g.loadTextures=function(){return Promise.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,
9728,6409)]).then(([d,c])=>{this.textureArea=d;this.textureSearch=c})};g.enable=function(){if(this.isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeights||!this._blur){const d=new y.SMAATechniqueConfiguration,c=(u,t)=>this._techniqueRep.releaseAndAcquire(y.SMAATechnique,u,t);d.output=0;this._edgeDetectTechnique=c(d,this._edgeDetectTechnique);d.output=1;this._blendWeights=c(d,this._blendWeights);d.output=2;this._blur=c(d,this._blur)}if(!this.loadResources())return!1;this.vao=q.createScreenSizeTriangleVAO(this.rctx);
this.edges=new f(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});this.blend=new f(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});return this.isEnabled=!0};g.disable=function(){this.isEnabled&&(this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=
null,this.blend.dispose(),this.blend=null,this.edges.dispose(),this.edges=null,this.isEnabled=!1)};g.render=function(d){this.enable();const c=this.rctx,u=c.getBoundFramebufferObject();var t=d.colorTexture.descriptor.width,h=d.colorTexture.descriptor.height;c.bindVAO(this.vao);c.setPipelineState(this._edgeDetectTechnique.pipeline);c.setViewport(0,0,t,h);this.edges.resize(t,h);c.bindFramebuffer(this.edges);c.setClearColor(0,0,0,1);c.clear(16384);c.useProgram(this._edgeDetectTechnique.program);this._edgeDetectTechnique.program.bindTexture(d.colorTexture,
"tColor");this._edgeDetectTechnique.program.setUniform4f("uResolution",1/t,1/h,t,h);c.drawArrays(4,0,3);this.blend.resize(t,h);c.bindFramebuffer(this.blend);c.setClearColor(0,0,1,1);c.clear(16384);c.useProgram(this._blendWeights.program);this._blendWeights.program.setUniform4f("uResolution",1/t,1/h,t,h);this._blendWeights.program.bindTexture(this.textureSearch,"tSearch");this._blendWeights.program.bindTexture(this.textureArea,"tArea");this._blendWeights.program.bindTexture(this.edges.colorTexture,
"tEdges");c.drawArrays(4,0,3);c.bindFramebuffer(u);c.setClearColor(0,1,0,1);c.clear(16384);c.useProgram(this._blur.program);this._blur.program.setUniform4f("uResolution",1/t,1/h,t,h);this._blur.program.bindTexture(d.colorTexture,"tColor");this._blur.program.bindTexture(this.blend.colorTexture,"tBlendWeights");c.drawArrays(4,0,3)};g.loadTextureFromBase64=function(d,c,u){const t=new w(this.rctx,{pixelFormat:u,dataType:5121,wrapMode:33071,samplingMode:c},null);return r.requestImage(d).then(h=>{t.resize(h.width,
h.height);t.setData(h);return t})};b._createClass(l,[{key:"isLoadingResources",get:function(){return null!=this.resourceLoadingPromise}}]);return l}();p.SmaaRenderPass=e;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SMAATechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SMAA.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){y=function(d){function c(){return d.apply(this,arguments)||this}b._inheritsLoose(c,d);var u=c.prototype;u.initializeProgram=function(t){const h=c.shader.get().build({output:this.configuration.output,threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16});return new e.Program(t.rctx,h,w.Default3D)};u.initializePipeline=function(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})};return c}(y.ShaderTechnique);y.shader=new q.ReloadableShaderModule(l.SMAAShader,
()=>new Promise(function(d,c){a(["../shaders/SMAA.glsl"],d,c)}));q=function(d){function c(){var u=d.apply(this,arguments)||this;u.output=0;return u}b._inheritsLoose(c,d);return c}(f.ShaderTechniqueConfiguration);r.__decorate([f.parameter({count:3})],q.prototype,"output",void 0);p.SMAATechnique=y;p.SMAATechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/SMAA.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],
function(a,p,b){function r(y){const f=new b.ShaderBuilder;0===y.output&&(f.attributes.add("position","vec2"),f.vertex.uniforms.add("uResolution","vec4"),f.varyings.add("fTexCoord","vec2"),f.varyings.add("fOffset[3]","vec4"),f.vertex.code.add(p.glsl`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + uResolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),f.fragment.uniforms.add("tColor","sampler2D"),f.fragment.code.add(p.glsl`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${p.glsl.float(y.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${p.glsl.float(y.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `));1===y.output&&(f.attributes.add("position","vec2"),f.vertex.uniforms.add("uResolution","vec4"),f.varyings.add("fTexCoord","vec2"),f.varyings.add("fOffset[3]","vec4"),f.varyings.add("fPixCoord","vec2"),f.vertex.code.add(p.glsl`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * uResolution.zw;
        fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * uResolution.xxyy * float( ${p.glsl.int(y.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),f.fragment.uniforms.add("tEdges","sampler2D").add("tArea","sampler2D").add("tSearch","sampler2D").add("tColor","sampler2D").add("uResolution","vec4"),f.fragment.code.add(p.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture2D( tex, coord + offset.x * uResolution.xy, 0.0 );
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${p.glsl.int(y.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * uResolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * uResolution.x;
        texcoord.x += uResolution.x;
        texcoord.x += 2.0 * uResolution.x;
        texcoord.x -= uResolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${p.glsl.int(y.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * uResolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * uResolution.x;
        texcoord.x -= uResolution.x;
        texcoord.x -= 2.0 * uResolution.x;
        texcoord.x += uResolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${p.glsl.int(y.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * uResolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * uResolution.y;
        texcoord.y -= uResolution.y;
        texcoord.y -= 2.0 * uResolution.y;
        texcoord.y += uResolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${p.glsl.int(y.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * uResolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * uResolution.y;
        texcoord.y += uResolution.y;
        texcoord.y += 2.0 * uResolution.y;
        texcoord.y -= uResolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${p.glsl.int(y.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * uResolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * uResolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * uResolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * uResolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `));2===y.output&&(f.attributes.add("position","vec2"),f.vertex.uniforms.add("uResolution","vec4"),f.varyings.add("fTexCoord","vec2"),f.varyings.add("fOffset[2]","vec4"),f.vertex.code.add(p.glsl`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),f.fragment.uniforms.add("tBlendWeights","sampler2D"),f.fragment.uniforms.add("tColor","sampler2D"),f.fragment.uniforms.add("uResolution","vec4"),f.fragment.code.add(p.glsl`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * uResolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`));return f}var q=Object.freeze({__proto__:null,build:r});a.SMAAShader=q;a.build=r})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../../../support/requestImageUtils ./glUtil3D ./SSAOTechnique ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,p,b,r,q,y,f,w,e,l,
g,d,c,u){let t=function(){function n(k,v,x){this._techniqueRep=k;this._rctx=v;this._requestRender=x;this._enabled=!1;this._ssaoTechniqueConfig=new l.SSAOTechniqueConfiguration;this.quadVAO=null;this._blurSizePx=2;this._attenuation=.5}var z=n.prototype;z.dispose=function(){this.quadVAO=r.disposeMaybe(this.quadVAO)};z.computeSSAO=function(k,v,x){if(!(!this.enabled||r.isNone(this._noiseTexture)||r.isNone(this._ssaoFBO)||r.isNone(this._blur0FBO)||r.isNone(this._blur1FBO))){var C=this._rctx,A=k.fullViewport,
B=A[2],D=A[3],E=B/this._blurSizePx,G=D/this._blurSizePx;this._ssaoFBO.resize(B,D);this._blur0FBO.resize(E,G);this._blur1FBO.resize(E,G);E=1*B;G=1*D;C.bindFramebuffer(this._ssaoFBO);C.setViewport(0,0,B,D);var K=this._ssaoTechnique.program;C.useProgram(K);C.setPipelineState(this._ssaoTechnique.pipeline);K.setUniform2f("rnmScale",B/this._noiseTexture.descriptor.width,D/this._noiseTexture.descriptor.height);g.inverseProjectionInfo(k.projectionMatrix,k.fullWidth,k.fullHeight,m,h);K.setUniform4fv("projInfo",
m);K.setUniform2fv("zScale",h);K.setUniform2f("nearFar",k.near,k.far);B=1/k.computeRenderPixelSizeAtDist(1);K.setUniform1f("projScale",1*B);K.setUniform2f("screenDimensions",E,G);D=y.distance(k.eye,k.center);var M=20*k.computeRenderPixelSizeAtDist(D);M=Math.max(.1,M);K.setUniform1f("radius",M);K.setUniform1f("intensity",4*this._attenuation/M**6);K.bindTexture(this._noiseTexture,"rnm");K.bindTexture(x,"normalMap");K.bindTexture(v,"depthMap");r.isNone(this.quadVAO)&&(this.quadVAO=e.createQuadVAO(this._rctx));
C.bindVAO(this.quadVAO);C.drawArrays(5,0,u.vertexCount(this.quadVAO,"geometry"));K=this._blurTechnique.program;C.useProgram(K);K.bindTexture(this._ssaoFBO.colorTexture,"tex");K.bindTexture(x,"normalMap");K.bindTexture(v,"depthMap");C.setViewport(0,0,E/this._blurSizePx,G/this._blurSizePx);C.bindFramebuffer(this._blur0FBO);K.setUniform2f("screenDimensions",E,G);K.setUniform2f("blurSize",0,1*this._blurSizePx/G);K.setUniform2f("nearFar",k.near,k.far);5E4<D&&(B=Math.max(0,B-(D-5E4)));K.setUniform1f("projScale",
B);C.drawArrays(5,0,u.vertexCount(this.quadVAO,"geometry"));K.setUniform2f("blurSize",1*this._blurSizePx/E,0);C.bindFramebuffer(this._blur1FBO);K.bindTexture(this._blur0FBO.colorTexture,"tex");C.drawArrays(5,0,u.vertexCount(this.quadVAO,"geometry"));C.setViewport(A[0],A[1],A[2],A[3])}};z.bind=function(k,v){this.enabled&&r.isSome(this._blur1FBO)&&r.isSome(this._ssaoFBO)?(k.bindTexture(this._blur1FBO.colorTexture,"ssaoTex"),k.setUniform4f("viewportPixelSz",v.fullViewport[0],v.fullViewport[1],1/this._ssaoFBO.width,
1/this._ssaoFBO.height)):k.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};z._selectPrograms=function(){this._ssaoTechniqueConfig.output=0;this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(l.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);this._ssaoTechniqueConfig.output=1;this._blurTechnique=this._techniqueRep.releaseAndAcquire(l.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)};z._enable=function(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&
this._initialize()}))};z._loadResources=function(k){this._data?k():(new Promise(function(v,x){a(["./SSAOHelperData"],v,x)})).then(v=>{this._data=v;k()})};z._initialize=function(){const k={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},v={colorTarget:0,depthStencilTarget:0};w.requestImage(this._data.noiseTexture).then(x=>{this._enabled&&(this._ssaoFBO=new d(this._rctx,v,k),this._blur0FBO=new d(this._rctx,v,k),this._blur1FBO=new d(this._rctx,v,k),this._noiseTexture=
new c(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:x.width,height:x.height},x),this._requestRender())});this._selectPrograms()};z._disable=function(){this._enabled=!1;this._noiseTexture=r.disposeMaybe(this._noiseTexture);this._blur1FBO=r.disposeMaybe(this._blur1FBO);this._blur0FBO=r.disposeMaybe(this._blur0FBO);this._ssaoFBO=r.disposeMaybe(this._ssaoFBO)};b._createClass(n,[{key:"enabled",get:function(){return this._enabled},set:function(k){k?this._enable():this._disable()}},
{key:"ready",get:function(){return this.enabled&&r.isSome(this._noiseTexture)&&r.isSome(this._ssaoFBO)&&r.isSome(this._blur0FBO)&&r.isSome(this._blur1FBO)}},{key:"gpuMemoryUsage",get:function(){return(r.isSome(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(r.isSome(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(r.isSome(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}},{key:"test",get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}]);return n}();const h=q.create(),m=f.create();p.SSAOHelper=
t;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAO.glsl ../../../webgl/renderState".split(" "),function(a,p,b,r,q,y,f,w,e,l,g){y=function(d){function c(){return d.apply(this,
arguments)||this}b._inheritsLoose(c,d);var u=c.prototype;u.initializeProgram=function(t){var h=c.shader.get();const m=(c.filterRadius+1)/2;h=h.build({output:this.configuration.output,samples:c.samples,filterRadius:c.filterRadius,blurFalloff:1/(2*m*m)});return new e.Program(t.rctx,h,w.Default3D)};u.initializePipeline=function(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})};return c}(y.ShaderTechnique);y.shader=new q.ReloadableShaderModule(l.SSAOShader,()=>new Promise(function(d,
c){a(["../shaders/SSAO.glsl"],d,c)}));y.samples=16;y.filterRadius=4;q=function(d){function c(){var u=d.apply(this,arguments)||this;u.output=0;return u}b._inheritsLoose(c,d);return c}(f.ShaderTechniqueConfiguration);r.__decorate([f.parameter({count:2})],q.prototype,"output",void 0);p.SSAOTechnique=y;p.SSAOTechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/SSAO.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y){function f(e){const l=new y.ShaderBuilder;l.include(p.ScreenSpacePass);1===e.output&&(l.fragment.include(b.ReadLinearDepth),l.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("projScale","float").add("nearFar","vec2"),l.fragment.code.add(q.glsl`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${q.glsl.float(e.blurFalloff)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),l.fragment.code.add(q.glsl`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${q.glsl.int(e.filterRadius)}; r <= ${q.glsl.int(e.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `));0===e.output&&(l.fragment.include(b.ReadLinearDepth),l.include(r.CameraSpace),l.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),l.fragment.code.add(q.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),l.fragment.code.add(q.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),l.fragment.code.add(q.glsl`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${q.glsl.int(e.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;
          vec2 tcTap = tc/screenDimensions;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${q.glsl.int(e.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `));return l}var w=Object.freeze({__proto__:null,build:f});a.SSAOShader=w;a.build=f})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ./bufferLayouts ./edgeBufferWriters ./EdgeRenderer ./EdgeWorkerHandle ./strokes ./util ../TextureBackedBuffer/BufferManager ../../../../support/WatchUpdatingTracking ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N){function R(Q){let V=null,ca=null;for(let Z=0;Z<Q.geometries.length;Z++){var ba;const ha=Q.geometryRecords[Z];if(ha.material.supportsEdges){if(!V)V=ha.transformation;else if(!q.equals(V,ha.transformation))return!1;if(!ca&&w.isSome(ha.origin))ca=ha;else if(w.isSome(null==(ba=ca)?void 0:ba.origin)&&w.isSome(ha.origin)&&ca.origin.id!==ha.origin.id)return!1}}return!0}const S=y.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");
a.EdgeView=function(Q){function V(ba){var Z=Q.call(this,ba)||this;Z.updatingHandles=new F.WatchUpdatingTracking;Z.perObjectData=new Map;Z.perObjectDataEvictionCache=new Set;Z.renderers=new Map;Z.numberOfRenderedEdges=0;Z.gpuMemoryUsage=0;Z.workerAbort=e.createAbortController();Z.tmpModelPosition=z.create();Z.localOrigins=new D.LocalOriginManager(new A.GridLocalOriginFactory(ba.renderSR));return Z}p._inheritsLoose(V,Q);var ca=V.prototype;ca.initialize=function(){this.worker=new H(this.schedule);this.componentColorManager=
new I.BufferManager(this.rctx,2);const ba=G.VertexLayout.createBuffer(4);for(let Z=0;4>Z;Z++)ba.sideness.set(Z,0,0===Z||3===Z?0:1),ba.sideness.set(Z,1,0===Z||1===Z?0:1);this.verticesBufferObject=L.createVertex(this.rctx,35044,ba.buffer)};ca.destroy=function(){this.destroyed||(this.perObjectData.forEach(ba=>this._discardObjectEntry(ba)),this.perObjectData.clear(),this.strokesTexture=w.disposeMaybe(this.strokesTexture),this.componentColorManager=w.destroyMaybe(this.componentColorManager),this.workerAbort.abort(),
this.worker.destroy(),this.verticesBufferObject=w.disposeMaybe(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())};ca.shouldRender=function(){return 0<this.renderers.size};ca.addComponentObject=function(){var ba=p._asyncToGenerator(function*(Z,ha,fa,aa,W,U,X,T){if(!this.hasObject(Z)){var Y;fa=new P(new Promise(ea=>Y=ea),fa.center,fa.radius);this.perObjectData.set(Z,fa);yield this.updatingHandles.addPromise(this.addComponentGeometry(ha,fa,aa,W,U,X,T));this.setNeedsRender();
Y()}});return function(Z,ha,fa,aa,W,U,X,T){return ba.apply(this,arguments)}}();ca.addOrUpdateObject3D=function(){var ba=p._asyncToGenerator(function*(Z,ha,fa,aa){if(this.destroyed)S.warn("Attempt to add an object to a destroyed instance");else{var W=this.perObjectData.get(Z);0<(null==W?void 0:W.renderables.length)&&this.perObjectDataEvictionCache.add(W);var U,X=Z.boundingVolumeWorldSpace.bounds;X=new P(new Promise(Y=>U=Y),k.getCenter(X),k.getRadius(X));this.perObjectData.set(Z,X);var T=[];if(fa.mergeGeometries&&
1<Z.geometries.length&&R(Z))T.push(this.addObjectMergedGeometries(Z,X,ha,fa,aa));else for(let Y=0;Y<Z.geometries.length;Y++){const ea=Z.geometryRecords[Y];ea.material.supportsEdges&&T.push(this.addGeometry(Z,X,Z.geometries[Y],ea,ha[0],fa,aa))}yield this.updatingHandles.addPromise(Promise.all(T));this.perObjectDataEvictionCache.delete(X);this._discardObjectEntry(W);this.setNeedsRender();U()}});return function(Z,ha,fa,aa){return ba.apply(this,arguments)}}();ca._discardObjectEntry=function(ba){ba&&(ba.renderables.length&&
(ba.renderables.forEach(Z=>this.removeRenderable(Z)),this.setNeedsRender()),ba.loaded=null)};ca.hasObject=function(ba){return this.perObjectData.has(ba)};ca.updateAllComponentOpacities=function(){var ba=p._asyncToGenerator(function*(Z,ha){const fa=ha instanceof Array?aa=>ha[aa]:()=>ha;(yield this.updatingHandles.addPromise(this.getObjectEntry(Z))).renderables.forEach(aa=>{const W=aa.components.meta.length;for(let U=0;U<W;U++){const X=fa(U),T=aa.components.meta[U],Y=T.index;T.material.opacity=X;aa.components.buffer.textureBuffer.setDataElement(Y,
1,3,255*X)}this.updateTransparency(aa)});this.setNeedsRender()});return function(Z,ha){return ba.apply(this,arguments)}}();ca.updateAllComponentMaterials=function(){var ba=p._asyncToGenerator(function*(Z,ha,fa,aa){const W=Z instanceof E.Object3D,U=!!fa.slicePlaneEnabled,X=O.determineRendererType(ha),T=M.EdgeRenderer.getKey(X,U,W);(yield this.updatingHandles.addPromise(this.getObjectEntry(Z))).renderables.forEach(Y=>{if(T!==Y.rendererKey){var ea=this.renderers.get(Y.rendererKey);const ia=this.acquireRenderer(X,
U,W);ea.removeRenderable(Y);ea.refCount.decrement();Y.rendererKey=T;ia.addRenderable(Y)}for(ea=0;ea<ha.length;ea++)Y.components.meta[ea].material=ha[ea];aa&&this.updateComponentBuffer(Y.components);this.updateTransparency(Y)});this.setNeedsRender()});return function(Z,ha,fa,aa){return ba.apply(this,arguments)}}();ca.updateObjectVisibility=function(){var ba=p._asyncToGenerator(function*(Z,ha){(yield this.updatingHandles.addPromise(this.getObjectEntry(Z))).renderables.forEach(fa=>fa.visible=ha);this.setNeedsRender()});
return function(Z,ha){return ba.apply(this,arguments)}}();ca.removeObject=function(ba){const Z=this.perObjectData.get(ba);Z&&(this.perObjectData.delete(ba),this._discardObjectEntry(Z))};ca.getObjectEntry=function(){var ba=p._asyncToGenerator(function*(Z){Z=this.perObjectData.get(Z);if(!Z)throw"no object";yield Z.loaded;return Z});return function(Z){return ba.apply(this,arguments)}}();ca.removeAll=function(){this.perObjectData.forEach((ba,Z)=>this.removeObject(Z))};ca.render=function(ba,Z){if(!w.isNone(this.componentColorManager)){this.localOrigins.updateViewMatrices(ba.camera.viewMatrix);
var ha=ba.camera.viewInverseTransposeMatrix,fa=z.create(),aa=new C.TwoVectorPosition,W=new x.VertexPosition.ViewProjectionTransform,U=t.create();n.set(fa,ha[3],ha[7],ha[11]);aa.set(fa);n.copy(W.worldFromView_TH,aa.high);n.copy(W.worldFromView_TL,aa.low);u.fromMat4(W.viewFromCameraRelative_RS,ba.camera.viewMatrix);h.copy(W.projFromView,ba.camera.projectionMatrix);ha=t.create();u.transpose(ha,W.viewFromCameraRelative_RS);u.invert(U,ha);var X=0,T=0;this.renderers.forEach(ea=>{0===ea.refCount.value?(this.renderers.delete(ea.key),
ea.dispose()):ea.forEachRenderable(ia=>{X+=ia.statistics.averageEdgeLength;T++},Z)});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();if(0!==T){var Y={distanceFalloffFactor:40*X/T,minimumEdgeLength:ba.camera.perScreenPixelRatio,transparency:Z,viewProjectionTransform:W,transformNormal_ViewFromGlobal:U};this.updateObjectCameraDistances(ba);this.numberOfRenderedEdges=0;this.renderers.forEach(ea=>{this.renderRegularEdges(ea,ba,Y);this.renderSilhouetteEdges(ea,ba,
Y)})}}};ca.updateTransparency=function(ba){const Z=O.determineEdgeTransparency(ba.components.meta),ha=O.determineObjectTransparency(ba.components.meta);if(Z!==ba.edgeTransparency||ha!==ba.objectTransparency)ba.edgeTransparency=Z,ba.objectTransparency=ha,this.renderers.get(ba.rendererKey).setRenderablesDirty()};ca.computeModelTransformWithLocalOrigin=function(ba,Z,ha){ba.getCombinedStaticTransformation(Z,ha);w.isSome(Z.origin)?this.localOrigins.register(Z.origin):(ba=n.set(this.tmpModelPosition,ha[12],
ha[13],ha[14]),Z.origin=this.localOrigins.acquire(ba));B.applyToModelMatrix(Z.origin.vec3,ha);return Z.origin};ca.updateComponentBuffer=function(ba){const {meta:Z,buffer:ha}=ba;for(ba=0;ba<Z.length;ba++){var fa=Z[ba].material;const aa=Z[ba].index,W=f.clamp(Math.round(fa.size*M.LINE_WIDTH_FRACTION_FACTOR),0,255),U=f.clamp(fa.extensionLength,-M.EXTENSION_LENGTH_OFFSET,255-M.EXTENSION_LENGTH_OFFSET)+M.EXTENSION_LENGTH_OFFSET,X="solid"===fa.type?0:1,T=255*fa.opacity;fa=fa.color;ha.textureBuffer.setData(aa,
0,255*fa[0],255*fa[1],255*fa[2],255*fa[3]);ha.textureBuffer.setData(aa,1,W,U,X,T)}};ca.createComponentBuffers=function(ba){if(w.isNone(this.componentColorManager))return null;const Z=[],ha=this.componentColorManager.getBuffer(ba.length);for(let fa=0;fa<ba.length;fa++){const aa=ba[fa],W=ha.acquireIndex();Z.push({index:W,material:aa})}ba={meta:Z,buffer:ha};this.updateComponentBuffer(ba);return ba};ca.extractEdges=function(ba,Z,ha,fa,aa,W=aa.length){return this.worker.process({data:Z,indices:aa,indicesLength:W,
writerSettings:ba,skipDeduplicate:ha},this.workerAbort.signal,fa)};ca.createEdgeResources=function(ba){const Z={};if(w.isNone(this.verticesBufferObject))return Z;if(0<ba.regular.lodInfo.lengths.length){var ha=new N(this.rctx,G.EdgeShaderAttributeLocations,{vertices:G.glVertexLayout,instances:K.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:L.createVertex(this.rctx,35044,ba.regular.instancesData.buffer)});Z.regular={vao:ha,lod:ba.regular.lodInfo}}0<ba.silhouette.lodInfo.lengths.length&&
(ha=new N(this.rctx,G.EdgeShaderAttributeLocations,{vertices:G.glVertexLayout,instances:K.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:L.createVertex(this.rctx,35044,ba.silhouette.instancesData.buffer)}),Z.silhouette={vao:ha,lod:ba.silhouette.lodInfo});return Z};ca.addGeometry=function(){var ba=p._asyncToGenerator(function*(Z,ha,fa,aa,W,U,X){const T=fa.vertexAttributes.get("position"),Y=fa.indices.get("position"),ea=m.create();Z=this.computeModelTransformWithLocalOrigin(Z,
aa,ea);return this.addPositionData(ha,{position:T,indices:Y,modelTransform:ea,origin:Z},fa.edgeIndicesLength,W,U,X)});return function(Z,ha,fa,aa,W,U,X){return ba.apply(this,arguments)}}();ca.addPositionData=function(){var ba=p._asyncToGenerator(function*(Z,ha,fa,aa,W,U=!1){if(null!=Z.loaded){var X=this.createComponentBuffers([aa]);if(!(w.isNone(X)||0>=fa)){aa=this.acquireRenderer(aa.type,!!W.slicePlaneEnabled);var {modelTransform:T,origin:Y}=ha;W=ha.indices;ha=ha.position;var ea=ha.data.length/ha.size,
ia=G.EdgeInputBufferLayout.createBuffer(ea);for(let ua=0;ua<ea;ua++)ia.position.set(ua,0,ha.data[ua*ha.size]),ia.position.set(ua,1,ha.data[ua*ha.size+1]),ia.position.set(ua,2,ha.data[ua*ha.size+2]);O.fillComponenBufferIndices(X.meta,[0,ia.componentIndex.count],ia.componentIndex);U=yield this.updatingHandles.addPromise(this.extractEdges(aa.writerSettings,ia,!1,U,W,fa));if(null!=Z.loaded){var {regular:la,silhouette:pa}=this.createEdgeResources(U);fa=(la?la.vao.size:0)+(pa?pa.vao.size:0);X={regular:la,
silhouette:pa,transform:{modelMatrix:T,origin:Y},statistics:{gpuMemoryUsage:fa,averageEdgeLength:U.averageEdgeLength},components:X,visible:!0,edgeTransparency:O.determineEdgeTransparency(X.meta),objectTransparency:O.determineObjectTransparency(X.meta),distanceToCamera:0,rendererKey:aa.key};Z.renderables.push(X);aa.addRenderable(X);this.gpuMemoryUsage+=fa}}}});return function(Z,ha,fa,aa,W){return ba.apply(this,arguments)}}();ca.addComponentGeometry=function(){var ba=p._asyncToGenerator(function*(Z,
ha,fa,aa,W,U,X){if(null!=ha.loaded){var T=this.createComponentBuffers(U);if(!w.isNone(T)&&(U=O.determineRendererType(U),X=this.acquireRenderer(U,X.slicePlaneEnabled||!1,!1),U=G.EdgeInputBufferLayout.createBuffer(fa.count),v.copy(U.position,fa),O.fillComponenBufferIndices(T.meta,W,U.componentIndex,aa),aa=yield this.updatingHandles.addPromise(this.extractEdges(X.writerSettings,U,!0,!1,aa)),null!=ha.loaded)){var {regular:Y,silhouette:ea}=this.createEdgeResources(aa);fa=(Y?Y.vao.size:0)+(ea?ea.vao.size:
0);Z={regular:Y,silhouette:ea,transform:Z,statistics:{gpuMemoryUsage:fa,averageEdgeLength:aa.averageEdgeLength},components:T,visible:!0,edgeTransparency:O.determineEdgeTransparency(T.meta),objectTransparency:O.determineObjectTransparency(T.meta),distanceToCamera:0,rendererKey:X.key};ha.renderables.push(Z);X.addRenderable(Z);this.gpuMemoryUsage+=fa}}});return function(Z,ha,fa,aa,W,U,X){return ba.apply(this,arguments)}}();ca.addObjectMergedGeometries=function(){var ba=p._asyncToGenerator(function*(Z,
ha,fa,aa,W){var U=new Map,X=0,T=null,Y=0;for(var ea=0;ea<Z.geometries.length;ea++){var ia=Z.geometries[ea],la=Z.geometryRecords[ea];la.material.supportsEdges&&(!T&&la.origin&&(T=la),la=ia.vertexAttributes.get("position"),Y+=la.data.length/la.size,X+=ia.edgeIndicesLength)}Y=65536<=Y?Uint32Array:Uint16Array;X=X?new Y(X):null;Y=[];ea=0;for(ia=0;ia<Z.geometries.length;ia++){la=Z.geometries[ia];if(!Z.geometryRecords[ia].material.supportsEdges)continue;var pa=la.vertexAttributes.get("position");const ua=
la.indices.get("position");let wa=U.get(pa.data);if(null==wa){wa=Y.length/3;for(let Fa=0;Fa<pa.data.length;Fa+=pa.size)Y.push(pa.data[Fa+0]),Y.push(pa.data[Fa+1]),Y.push(pa.data[Fa+2]);U.set(pa.data,wa)}if(ua)for(pa=0;pa<la.edgeIndicesLength;pa++)X[ea++]=wa+ua[pa]}T=T||Z.geometryRecords[0];U=m.create();T=this.computeModelTransformWithLocalOrigin(Z,T,U);for(ea=0;ea<Z.geometryRecords.length;ea++)Z.geometryRecords[ea].origin=T;yield this.updatingHandles.addPromise(this.addPositionData(ha,{position:{data:Y,
size:3},indices:X,modelTransform:U,origin:T},X.length,fa[0],aa,W))});return function(Z,ha,fa,aa,W){return ba.apply(this,arguments)}}();ca.acquireRenderer=function(ba,Z,ha=!0){const fa=M.EdgeRenderer.getKey(ba,Z,ha);let aa=this.renderers.get(fa);w.isNone(this.strokesTexture)&&(this.strokesTexture=J.generateStrokesTexture(this.rctx));aa||(aa=new M.EdgeRenderer(this.rctx,this.techniqueRepository,{type:ba,slicePlaneEnabled:Z,strokesTexture:this.strokesTexture,legacy:ha}),this.renderers.set(fa,aa));aa.refCount.increment();
return aa};ca.removeRenderable=function(ba){ba.regular&&(ba.regular.vao.vertexBuffers.instances.dispose(),ba.regular.vao.dispose(!1),ba.regular.vao=null);ba.silhouette&&(ba.silhouette.vao.vertexBuffers.instances.dispose(),ba.silhouette.vao.dispose(!1),ba.silhouette.vao=null);const Z=this.renderers.get(ba.rendererKey);if(Z){Z.removeRenderable(ba);Z.refCount.decrement();"origin"in ba.transform&&this.localOrigins.release(ba.transform.origin);this.gpuMemoryUsage-=ba.statistics.gpuMemoryUsage;for(const ha of ba.components.meta)ba.components.buffer.releaseIndex(ha.index)}};
ca.updateObjectCameraDistances=function(ba){const Z=ba.camera.eye,ha=ba.camera.viewForward,fa=z.create();ba=aa=>{const {center:W,radius:U}=aa;n.sub(fa,W,Z);const X=n.dot(fa,ha),T=X<-U?Infinity:X<U?0:X-U;aa.renderables.forEach(Y=>Y.distanceToCamera=T)};this.perObjectData.forEach(ba);this.perObjectDataEvictionCache.forEach(ba)};ca.renderRegularEdges=function(ba,Z,ha){ba.bindRegularEdges(Z,ha);ba.forEachRenderable(fa=>{if(fa.visible&&fa.regular){var aa=O.computeEdgeCount(fa.regular.lod.lengths,fa.distanceToCamera,
ha);"origin"in fa.transform&&(Z.localViewMatrixForEdges=this.localOrigins.getViewMatrix(fa.transform.origin));ba.renderRegularEdges(fa,Z,aa);this.numberOfRenderedEdges+=aa}},ha.transparency)};ca.renderSilhouetteEdges=function(ba,Z,ha){ba.bindSilhouetteEdges(Z,ha);ba.forEachRenderable(fa=>{if(fa.visible&&fa.silhouette){var aa=O.computeEdgeCount(fa.silhouette.lod.lengths,fa.distanceToCamera,ha);"origin"in fa.transform&&(Z.localViewMatrixForEdges=this.localOrigins.getViewMatrix(fa.transform.origin));
ba.renderSilhouetteEdges(fa,Z,aa);this.numberOfRenderedEdges+=aa}},ha.transparency)};p._createClass(V,[{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"usedMemory",get:function(){return this.gpuMemoryUsage}},{key:"numberOfRenderedPrimitives",get:function(){return this.numberOfRenderedEdges}}]);return V}(r);b.__decorate([l.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);b.__decorate([l.property({constructOnly:!0})],a.EdgeView.prototype,"renderSR",void 0);
b.__decorate([l.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);b.__decorate([l.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);b.__decorate([l.property({constructOnly:!0})],a.EdgeView.prototype,"schedule",void 0);b.__decorate([l.property({readOnly:!0})],a.EdgeView.prototype,"updatingHandles",void 0);b.__decorate([l.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=b.__decorate([c.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],
a.EdgeView);let P=function(Q,V,ca){this.center=V;this.radius=ca;this.renderables=[];this.loaded=Q;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(p,b){const r=-p[0],q=-p[1];p=-p[2];const y=b[3],f=b[7],w=b[11],e=b[15];b[0]+=y*r;b[1]+=y*q;b[2]+=y*p;b[4]+=f*r;b[5]+=f*q;b[6]+=f*p;b[8]+=w*r;b[9]+=w*q;b[10]+=w*p;b[12]+=
e*r;b[13]+=e*q;b[14]+=e*p};a.applyToViewMatrix=function(p,b){const r=p[0],q=p[1];p=p[2];b[12]+=r*b[0]+q*b[4]+p*b[8];b[13]+=r*b[1]+q*b[5]+p*b[9];b[14]+=r*b[2]+q*b[6]+p*b[10];b[14]+=r*b[3]+q*b[7]+p*b[11]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(a,p,b,r){let q=function(){function y(w){this.factory=w;this.originData=new Map}
var f=y.prototype;f.acquire=function(w){return this.register(this.factory.getOrigin(w))};f.register=function(w){const e=this.originData.get(w.id);if(e)return e.refCount++,e.origin;this.originData.set(w.id,{refCount:1,viewMatrix:b.create(),origin:w});return w};f.release=function(w){const e=this.originData.get(w.id);e&&(e.refCount--,0===e.refCount&&this.originData.delete(w.id))};f.updateViewMatrices=function(w){this.originData.forEach(e=>{p.copy(e.viewMatrix,w);r.applyToViewMatrix(e.origin.vec3,e.viewMatrix)})};
f.getViewMatrix=function(w){return this.originData.get(w.id).viewMatrix};return y}();a.LocalOriginManager=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(a,p,b){const r=b.newLayout().vec3f("position").u16("componentIndex").u16("u16padding"),q=b.newLayout().vec2u8("sideness");p=p.glLayout(q);b=b.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",
{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("u8padding",{glPadding:!0}).u16("u16padding",{glPadding:!0});const y=b.clone().vec3f("normal"),f=b.clone().vec3f("normalA").vec3f("normalB"),w=new Map([["position0",0],["position1",1],["componentIndex",2],["variantOffset",3],["variantStroke",4],["variantExtension",5],["normal",6],["normalA",6],["normalB",7],["sideness",8]]);a.CommonInstancesLayout=b;a.EdgeInputBufferLayout=r;a.EdgeShaderAttributeLocations=w;a.RegularEdgeInstancesLayout=
y;a.SilhouetteEdgeInstancesLayout=f;a.VertexLayout=q;a.glVertexLayout=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(a,p,b,r,q,y){function f(n){const z=g;z[0]=n.position0[0];z[1]=n.position0[1];z[2]=n.position0[2];z[3]=n.position1[0];z[4]=n.position1[1];
z[5]=n.position1[2];c[0]=5381;for(n=0;n<d.length;n++)c[0]=31*c[0]+d[n];return c[0]}function w(n){const z=g;z[0]=e(n.position0[0]);z[1]=e(n.position0[1]);z[2]=e(n.position0[2]);z[3]=e(n.position1[0]);z[4]=e(n.position1[1]);z[5]=e(n.position1[2]);c[0]=5381;for(n=0;n<d.length;n++)c[0]=31*c[0]+d[n];return c[0]}function e(n){return Math.round(1E4*n)/1E4}let l=function(){function n(){}var z=n.prototype;z.updateSettings=function(k){this.settings=k;this.edgeHashFunction=k.reducedPrecision?w:f};z.write=function(k,
v,x){var C=this.edgeHashFunction(x);m.seed=C;C=m.getIntRange(0,255);const A=m.getIntRange(0,this.settings.variants-1);var B=m.getFloat();B=-(1-Math.min(B/.7,1))+Math.max(0,B-.7)/(1-.7);B=255*(Math.abs(B)**1.2*(0>B?-1:1)*.5+.5);k.position0.setVec(v,x.position0);k.position1.setVec(v,x.position1);k.componentIndex.set(v,x.componentIndex);k.variantOffset.set(v,C);k.variantStroke.set(v,A);k.variantExtension.set(v,B)};z.trim=function(k,v){return k.slice(0,v)};return n}();const g=new Float32Array(6),d=new Uint32Array(g.buffer),
c=new Uint32Array(1);let u=function(){function n(){this.commonWriter=new l}var z=n.prototype;z.updateSettings=function(k){this.commonWriter.updateSettings(k)};z.allocate=function(k){return y.RegularEdgeInstancesLayout.createBuffer(k)};z.write=function(k,v,x){this.commonWriter.write(k,v,x);b.add(h,x.faceNormal0,x.faceNormal1);b.normalize(h,h);k.normal.setVec(v,h)};z.trim=function(k,v){return this.commonWriter.trim(k,v)};return n}();u.Layout=y.RegularEdgeInstancesLayout;u.glLayout=q.glLayout(y.RegularEdgeInstancesLayout,
1);let t=function(){function n(){this.commonWriter=new l}var z=n.prototype;z.updateSettings=function(k){this.commonWriter.updateSettings(k)};z.allocate=function(k){return y.SilhouetteEdgeInstancesLayout.createBuffer(k)};z.write=function(k,v,x){this.commonWriter.write(k,v,x);k.normalA.setVec(v,x.faceNormal0);k.normalB.setVec(v,x.faceNormal1)};z.trim=function(k,v){return this.commonWriter.trim(k,v)};return n}();t.Layout=y.SilhouetteEdgeInstancesLayout;t.glLayout=q.glLayout(y.SilhouetteEdgeInstancesLayout,
1);const h=r.create(),m=new p;a.CommonBufferWriter=l;a.RegularEdgeBufferWriter=u;a.SilhouetteEdgeBufferWriter=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/debugFlags ../../collections/Component/Material/ComponentTechnique ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){const n={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};let z=function(){function A(){this._value=0}var B=A.prototype;B.increment=function(){this._value++};B.decrement=function(){this._value--};p._createClass(A,[{key:"value",get:function(){return this._value}}]);return A}();const k={solid:0,sketch:1,uber:2};let v=function(){function A(D,E,G){this.rctx=D;this.shaderTechniqueRepository=E;this.config=new m.EdgeShaderTechnique.Configuration;
this.technique=null;this.refCount=new z;this.renderables=new Set;this.sortedRenderables={[1]:{[1]:new q,[2]:new q},[2]:{[1]:new q,[2]:new q}};this.renderablesDirty=!1;this.settings={...n,...G};this.key=A.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings={variants:this.settings.strokesTexture.variants,reducedPrecision:l.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES};this.config.legacy=this.settings.legacy;this.config.mode=k[this.settings.type];this.config.silhouette=
!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=t.doublePrecisionRequiresObfuscation(D)}var B=A.prototype;B.dispose=function(){this.technique=r.releaseMaybe(this.technique)};B.addRenderable=function(D){this.renderables.add(D);this.renderablesDirty=!0};B.removeRenderable=function(D){this.renderables.delete(D);this.renderablesDirty=!0};B.setRenderablesDirty=function(){this.renderablesDirty=
!0};B.forEachRenderable=function(D,E){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[E][1].forAll(D);this.sortedRenderables[E][2].forAll(D)};B.setMultipassParameters=function(D){this.config.multipassTerrainEnabled=D.multipassTerrainEnabled?D.multipassTerrainEnabled:!1;this.config.cullAboveGround=D.cullAboveGround?D.cullAboveGround:!1};B.bindRegularEdges=function(D,E){this.setMultipassParameters(D);this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.releaseAndAcquire(m.EdgeShaderTechnique,
this.config,this.technique);this.technique.bindPass({bindParameters:D,edgeRenderParameters:E});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.useProgram(this.technique.program)};B.bindSilhouetteEdges=function(D,E){this.setMultipassParameters(D);this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.releaseAndAcquire(m.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass({bindParameters:D,edgeRenderParameters:E});this.rctx.setPipelineState(this.technique.pipeline);
this.rctx.useProgram(this.technique.program)};B.renderRegularEdges=function(D,E,G){this.render(D,D.regular.vao,E,G)};B.renderSilhouetteEdges=function(D,E,G){this.render(D,D.silhouette.vao,E,G)};B.render=function(D,E,G,K){this.setUniforms(D,G);this.rctx.bindVAO(E);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,K)};B.setUniforms=function(D,E){const G=this.technique.program;D.components.buffer.textureBuffer.bind(G,"uComponentDataTex","uComponentDataTexInvDim");E.multipassTerrainEnabled&&
(G.setUniform2fv("cameraNearFar",E.camera.nearFar),G.setUniform2fv("inverseViewport",E.inverseViewport),u.bindMultipassTerrainTexture(G,E));if("origin"in D.transform)G.setUniformMatrix4fv("uView",E.localViewMatrixForEdges),G.setUniformMatrix4fv("uModel",D.transform.modelMatrix),d.bindSliceUniforms(G,this.settings,E.slicePlane,D.transform.origin.vec3);else{const K=new h.TwoVectorPosition(D.transform.position),M=y.transpose(x,y.invert(x,D.transform.rotationScale)),H=new g.ComponentDrawParameters;w.copy(H.worldFromModel_TL,
K.low);w.copy(H.worldFromModel_TH,K.high);y.copy(H.worldFromModel_RS,D.transform.rotationScale);y.copy(H.transformNormal_GlobalFromModel,M);c.VertexPosition.bindModelTransform(G,H);G.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",H.transformNormal_GlobalFromModel);D=E.camera.viewInverseTransposeMatrix;D=w.set(C,D[3],D[7],D[11]);d.bindSliceUniforms(G,this.settings,E.slicePlane,D)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(G);G.setUniform1f("uWorldLineRadiusPerDistance",
Math.tan(E.camera.fovY/2)/(E.camera.fullViewport[3]/2))};B.setSketchUniforms=function(D){const E=this.settings.strokesTexture,G=E.texture;r.isNone(G)||(D.bindTexture(G,"uStrokesTexture"),D.setUniform2f("uStrokesTextureScale",1/G.descriptor.width,1/G.descriptor.height),D.setUniform1f("uStrokesLog2Resolution",b.log2(E.resolution)),D.setUniform1f("uStrokesNormalizationScale",E.normalizationScale),D.setUniform1f("uStrokesAmplitude",E.amplitude),D.setUniform1f("uStrokeVariants",E.variants))};B.sortRenderables=
function(){this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();this.sortedRenderables[2][2].clear();this.renderables.forEach(E=>{0!==E.objectTransparency&&0!==E.edgeTransparency&&this.sortedRenderables[E.objectTransparency][E.edgeTransparency].push(E)});const D=(E,G)=>"origin"in E.transform&&"origin"in G.transform?E.transform.origin.id<G.transform.origin.id?-1:E.transform.origin.id>G.transform.origin.id?1:0:0;this.sortedRenderables[1][1].sort(D);
this.sortedRenderables[1][2].sort(D);this.sortedRenderables[2][1].sort(D);this.sortedRenderables[2][2].sort(D)};A.getKey=function(D,E,G){return`edges-t:${D}:${E}:${G}`};return A}();const x=f.create(),C=e.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=v;a.LINE_WIDTH_FRACTION_FACTOR=8;a.componentDataInvDimName="uComponentDataTexInvDim";a.componentDataTexName="uComponentDataTex";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../core/shaderTechnique/ShaderTechniqueConfiguration ../Program ./bufferLayouts ../../../../../chunks/EdgeShaderProgram.glsl ../../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){p.EdgeShaderTechnique=function(c){function u(){return c.apply(this,arguments)||this}b._inheritsLoose(u,c);var t=u.prototype;t.bindPass=function(h){const m=this.program,{edgeRenderParameters:n,bindParameters:z}=h;q.VertexPosition.bindViewProjTransform(m,n.viewProjectionTransform);m.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",n.transformNormal_ViewFromGlobal);m.setUniformMatrix4fv("uProj",z.camera.projectionMatrix);m.setUniform2f("uDepthBias",.5,-4E-4);m.setUniform2f("uPixelToNDC",
2/z.camera.fullViewport[2],2/z.camera.fullViewport[3]);m.setUniform2f("uNDCToPixel",z.camera.fullViewport[2]/2,z.camera.fullViewport[3]/2);m.setUniform1f("uDistanceFalloffFactor",n.distanceFalloffFactor);m.setUniform2f("uViewportDimInv",1/z.camera.fullViewport[2],1/z.camera.fullViewport[3]);m.setUniform1f("uPixelRatio",z.camera.pixelRatio||1)};t.initializeProgram=function(h){var m=u.shader.get();const n=this.configuration;m=m.build({slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,
sliceEnabledForVertexPrograms:!1,silhouette:n.silhouette,legacy:n.legacy,antialiasing:n.antialiasing,mode:n.mode,doublePrecisionRequiresObfuscation:n.doublePrecisionRequiresObfuscation,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new e.Program(h.rctx,m,l.EdgeShaderAttributeLocations)};t.initializePipeline=function(h){return(h=h.rctx.capabilities.blendMinMax)?d.makePipelineState({blending:d.separateBlendingParams(1,1,0,1,32774,h.MAX),depthTest:{func:515},
colorWrite:d.defaultColorWriteParams}):d.makePipelineState({depthTest:{func:515},depthWrite:d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams})};return u}(f.ShaderTechnique);p.EdgeShaderTechnique.shader=new y.ReloadableShaderModule(g.EdgeShaderProgram,()=>new Promise(function(c,u){a(["../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl"],c,u)}));(function(c){let u=function(t){function h(){var m=t.apply(this,arguments)||this;m.slicePlaneEnabled=!1;m.silhouette=!1;m.legacy=!1;m.antialiasing=
!1;m.mode=0;m.doublePrecisionRequiresObfuscation=!1;m.multipassTerrainEnabled=!1;m.cullAboveGround=!1;return m}b._inheritsLoose(h,t);return h}(w.ShaderTechniqueConfiguration);r.__decorate([w.parameter()],u.prototype,"slicePlaneEnabled",void 0);r.__decorate([w.parameter()],u.prototype,"silhouette",void 0);r.__decorate([w.parameter()],u.prototype,"legacy",void 0);r.__decorate([w.parameter()],u.prototype,"antialiasing",void 0);r.__decorate([w.parameter({count:3})],u.prototype,"mode",void 0);r.__decorate([w.parameter()],
u.prototype,"doublePrecisionRequiresObfuscation",void 0);r.__decorate([w.parameter()],u.prototype,"multipassTerrainEnabled",void 0);r.__decorate([w.parameter()],u.prototype,"cullAboveGround",void 0);c.Configuration=u})(p.EdgeShaderTechnique||(p.EdgeShaderTechnique={}));Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/EdgeShaderProgram.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){function t(m){const n=new y.ShaderBuilder,z=n.vertex,k=n.fragment;m.legacy&&z.uniforms.add("uModel","mat4");m.antialiasing&&(z.code.add(q.glsl`#define ANTIALIASING 1`),k.code.add(q.glsl`#define ANTIALIASING 1`));n.include(f.AdjustProjectedPosition,m);n.include(d.LineAmplitude,m);n.include(g.EdgeUtil,m);n.include(u.UnpackAttributes,m);n.include(c.LineOffset,m);n.include(p.Slice,m);n.include(e.DiscardNonSilhouetteEdges,m);n.include(w.DiscardByCoverage,m);n.include(l.DiscardShortEdges,
m);n.varyings.add("vColor","vec4");n.varyings.add("vRadius","float");n.varyings.add("vPosition","vec3");n.varyings.add("vWorldPosition","vec3");n.varyings.add("vViewPos","vec3");n.varyings.add("vLineLengthPixels","float");n.varyings.add("vSizeFalloffFactor","float");z.uniforms.add("uPixelToNDC","vec2");z.uniforms.add("uNDCToPixel","vec2");z.uniforms.add("uPixelRatio","float");n.attributes.add("position0","vec3");n.attributes.add("position1","vec3");n.attributes.add("variantOffset","float");n.attributes.add("variantStroke",
"float");n.attributes.add("variantExtension","float");z.code.add(q.glsl`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0 = worldFromModelPosition(position0);
vec3 worldPosV1 = worldFromModelPosition(position1);
vec3 viewPosV0 = viewFromModelPosition(position0);
vec3 viewPosV1 = viewFromModelPosition(position1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`);m.multipassTerrainEnabled&&(n.fragment.include(b.ReadLinearDepth),n.include(r.multipassTerrainTest,m));n.fragment.code.add(q.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${m.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `);return n}var h=Object.freeze({__proto__:null,build:t});a.EdgeShaderProgram=h;a.build=t})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define(["exports","../../../core/shaderLibrary/attributes/VertexPosition.glsl","../../../core/shaderLibrary/util/IsNaN.glsl","../../../core/shaderModules/interfaces"],function(a,p,b,r){a.AdjustProjectedPosition=function(q,y){q.vertex.include(b.IsNaN);q.include(p.VertexPosition,y);q=q.vertex;q.uniforms.add("uDepthBias",
"vec2");q.uniforms.add("uViewportDimInv","vec2");y.legacy?(q.uniforms.add("uView","mat4"),q.uniforms.add("uProj","mat4")):q.uniforms.add("uTransformNormal_ViewFromGlobal","mat3");y.legacy?q.code.add(r.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = uDepthBias.x;
float offsetZ  = uDepthBias.y;
vec4 projNormal = uProj * uView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
}`):q.code.add(r.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = uDepthBias.x;
float offsetZ  = uDepthBias.y;
vec4 projNormal = uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
}`);q.code.add(r.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = uDepthBias.y;
return sqrt(projPos.z) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,p){a.IsNaN=function(b){const r=p.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;b.code.add(r)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,p){a.DiscardByCoverage=function(b,r){b=b.fragment;b.constants.add("coverageTestThreshold","float",.01);r.antialiasing?b.code.add(p.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):b.code.add(p.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,p){a.DiscardNonSilhouetteEdges=function(b,r){b=b.vertex;r.silhouette?(b.code.add(p.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),r.legacy?b.code.add(p.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):b.code.add(p.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):b.code.add(p.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,p){a.DiscardShortEdges=function(b,r){b=b.vertex;switch(r.mode){case 1:b.code.add(p.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case 2:b.code.add(p.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);
break;case 0:b.code.add(p.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["exports","../../../core/shaderLibrary/util/DoublePrecision.glsl","../../../core/shaderModules/interfaces"],function(a,p,b){function r(q,y){const f=q.vertex;f.uniforms.add("uDistanceFalloffFactor","float");f.code.add(b.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);
}`);f.uniforms.add("uComponentDataTex","sampler2D");f.uniforms.add("uComponentDataTexInvDim","vec2");q.attributes.add("componentIndex","float");f.constants.add("componentColorFieldOffset","float",0);f.constants.add("componentOtherFieldOffset","float",1);f.constants.add("componentFieldCount","float",2);f.constants.add("lineWidthFractionFactor","float",8);f.constants.add("extensionLengthOffset","float",128);f.constants.add("componentTexWidth","float",4096);f.code.add(b.glsl`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * uComponentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec4 colorValue = texture2D(uComponentDataTex, colorIndex);
vec4 otherValue = texture2D(uComponentDataTex, otherIndex);
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5
);
}`);y.legacy?f.code.add(b.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (uModel * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (uView * uModel * vec4(normal, 0.0)).xyz;
}`):(f.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),f.code.add(b.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return uTransformNormal_GlobalFromModel * normal;
}`));y.silhouette?(q.attributes.add("normalA","vec3"),q.attributes.add("normalB","vec3"),f.code.add(b.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(q.attributes.add("normal","vec3"),f.code.add(b.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));y.legacy?f.code.add(b.glsl`vec3 worldFromModelPosition(vec3 position) {
return (uModel * vec4(position, 1.0)).xyz;
}
vec3 viewFromModelPosition(vec3 position) {
return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;
}
vec4 projFromViewPosition(vec3 position) {
return uProj * vec4(position, 1.0);
}`):(q.vertex.include(p.DoublePrecision,y),f.code.add(b.glsl`vec3 worldFromModelPosition(vec3 position) {
vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
uTransform_WorldFromModel_TL,
uTransform_WorldFromModel_TH,
-uTransform_WorldFromView_TL,
-uTransform_WorldFromView_TH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 viewFromModelPosition(vec3 position) {
return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);
}
vec4 projFromViewPosition(vec3 position) {
return uTransform_ProjFromView * vec4(position, 1.0);
}`));f.code.add(b.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}(function(q){q.usesSketchLogic=function(y){return 1===y.mode||2===y.mode};q.usesSolidLogic=function(y){return 0===y.mode||2===y.mode}})(r||(r={}));a.EdgeUtil=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(a,p,b,r){a.LineAmplitude=function(q,y){const f=q.vertex;q.include(r.UnpackAttributes,
y);b.EdgeUtil.usesSketchLogic(y)&&f.uniforms.add("uStrokesAmplitude","float");switch(y.mode){case 0:f.code.add(p.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case 1:f.code.add(p.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return uStrokesAmplitude;
}`);break;case 2:f.code.add(p.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return uStrokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(a,p,b){a.UnpackAttributes=function(r,q){const y=r.vertex;r.include(b.EdgeUtil,q);r.attributes.add("sideness","vec2");2===q.mode?y.code.add(p.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):y.code.add(p.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(q.mode){case 2:y.code.add(p.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case 1:y.code.add(p.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case 0:y.code.add(p.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define(["exports","../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(a,p,b,r,q){a.LineOffset=function(y,f){const w=y.vertex;y.include(q.UnpackAttributes,f);const e=y.fragment;r.EdgeUtil.usesSketchLogic(f)&&(w.uniforms.add("uStrokesTextureScale","vec2"),w.uniforms.add("uStrokesLog2Resolution",
"float"),w.uniforms.add("uStrokeVariants","float"),y.varyings.add("vStrokeUV","vec2"),e.uniforms.add("uStrokesTexture","sampler2D"),e.uniforms.add("uStrokesNormalizationScale","float"),w.code.add(b.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;
vStrokeUV.x += variantOffset;
}`),y.fragment.include(p.RgbaFloatEncoding),e.code.add(b.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * uStrokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(f.mode){case 0:w.code.add(b.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);e.code.add(b.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case 1:w.code.add(b.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);e.code.add(b.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case 2:y.varyings.add("vType","float"),w.code.add(b.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),e.code.add(b.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./EdgeProcessingWorker"],function(a,p,b,r,q){return function(y){function f(e){return y.call(this,"EdgeProcessingWorker","wrappedWork",e)||this}a._inheritsLoose(f,y);var w=f.prototype;w.process=
function(){var e=a._asyncToGenerator(function*(l,g,d){if(d)return q.work(l);l=this._packInput(l);g=yield this.invoke(l,g);return this._unpackOutput(g)});return function(l,g,d){return e.apply(this,arguments)}}();w.getTransferList=function(e){return[e.dataBuffer]};w._packInput=function(e){return{dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate,indicesBuffer:e.indices.buffer,indicesType:p.isUint32Array(e.indices)?"Uint32Array":"Uint16Array",indicesLength:e.indicesLength}};
w._unpackOutput=function(e){return{regular:{instancesData:r.unpackInterleavedBuffer(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:r.unpackInterleavedBuffer(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}};return f}(b.WorkerHandle)})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","../../../../geometry/support/buffer/BufferView",
"./InterleavedLayout"],function(a,p,b){function r(f){const w=[];f.fields.forEach((e,l)=>{var g=e.constructor;w.push([l,{...e,constructor:`${g.ElementType}_${g.ElementCount}`}])});return{stride:f.stride,fields:w,fieldNames:f.fieldNames}}function q(f){const w=b.newLayout();w.stride=f.stride;w.fieldNames=f.fieldNames;f.fields.forEach(e=>w.fields.set(e[0],{...e[1],constructor:y.get(e[1].constructor)}));return w}p=[p.BufferViewFloat,p.BufferViewVec2f,p.BufferViewVec3f,p.BufferViewVec4f,p.BufferViewMat3f,
p.BufferViewMat4f,p.BufferViewFloat64,p.BufferViewVec2f64,p.BufferViewVec3f64,p.BufferViewVec4f64,p.BufferViewMat3f64,p.BufferViewMat4f64,p.BufferViewUint8,p.BufferViewVec2u8,p.BufferViewVec3u8,p.BufferViewVec4u8,p.BufferViewUint16,p.BufferViewVec2u16,p.BufferViewVec3u16,p.BufferViewVec4u16,p.BufferViewUint32,p.BufferViewVec2u32,p.BufferViewVec3u32,p.BufferViewVec4u32,p.BufferViewInt8,p.BufferViewVec2i8,p.BufferViewVec3i8,p.BufferViewVec4i8,p.BufferViewInt16,p.BufferViewVec2i16,p.BufferViewVec3i16,
p.BufferViewVec4i16,p.BufferViewInt32,p.BufferViewVec2i32,p.BufferViewVec3i32,p.BufferViewVec4i32];const y=new Map;p.forEach(f=>y.set(`${f.ElementType}_${f.ElementCount}`,f));a.packInterleavedBuffer=function(f,w){w.push(f.buffer);return{buffer:f.buffer,layout:r(f.layout)}};a.packLayout=r;a.unpackInterleavedBuffer=function(f){return q(f.layout).createView(f.buffer)};a.unpackLayout=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(a,p,b,r,q,y,f,w){function e(){e=p._asyncToGenerator(function*(c){var u={data:y.EdgeInputBufferLayout.createView(c.dataBuffer),indices:"Uint32Array"===c.indicesType?new Uint32Array(c.indicesBuffer):"Uint16Array"===c.indicesType?new Uint16Array(c.indicesBuffer):void 0,indicesLength:c.indicesLength,writerSettings:c.writerSettings,skipDeduplicate:c.skipDeduplicate};c=l(u);u=[u.data.buffer];u.push(c.regular.lodInfo.lengths.buffer);u.push(c.silhouette.lodInfo.lengths.buffer);return{result:{regular:{instancesData:q.packInterleavedBuffer(c.regular.instancesData,
u),lodInfo:{lengths:c.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:q.packInterleavedBuffer(c.silhouette.instancesData,u),lodInfo:{lengths:c.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:c.averageEdgeLength},transferList:u}});return e.apply(this,arguments)}function l(c){var u=c.data,t=c.indices;var h=c.indicesLength;if(c.skipDeduplicate){const m=r.computeNeighbors(t,h,u.count);h={faces:t,facesLength:h,neighbors:m,vertices:u}}else u=b.deduplicate(u.buffer,u.stride/4,{originalIndices:t,
originalIndicesLength:h}),h=r.computeNeighbors(u.indices,h,u.uniqueCount),h={faces:u.indices,facesLength:u.indices.length,neighbors:h,vertices:y.EdgeInputBufferLayout.createView(u.buffer)};g.updateSettings(c.writerSettings);d.updateSettings(c.writerSettings);return w.extractEdges(h,g,d)}const g=new f.RegularEdgeBufferWriter,d=new f.SilhouetteEdgeBufferWriter;a.work=l;a.wrappedWork=function(c){return e.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],
function(a){a.computeNeighbors=function(p,b,r){b/=3;const q=new Uint32Array(r+1),y=new Uint32Array(r+1);var f=(h,m)=>{h<m?q[h+1]++:y[m+1]++};for(var w=0;w<b;w++){var e=p[3*w],l=p[3*w+1],g=p[3*w+2];f(e,l);f(l,g);f(g,e)}w=f=0;for(e=0;e<r;e++)l=q[e+1],g=y[e+1],q[e+1]=f,y[e+1]=w,f+=l,w+=g;const d=new Uint32Array(6*b),c=q[r];f=(h,m,n)=>{h<m?(h=q[h+1]++,d[2*h]=m,d[2*h+1]=n):(m=y[m+1]++,d[2*c+2*m]=h,d[2*c+2*m+1]=n)};for(w=0;w<b;w++)e=p[3*w],l=p[3*w+1],g=p[3*w+2],f(e,l,w),f(l,g,w),f(g,e,w);f=(h,m)=>{const n=
2*h;h=m-h;for(m=1;m<h;m++){const z=d[n+2*m],k=d[n+2*m+1];let v=m-1;for(v;0<=v&&d[n+2*v]>z;v--)d[n+2*v+2]=d[n+2*v],d[n+2*v+3]=d[n+2*v+1];d[n+2*v+2]=z;d[n+2*v+3]=k}};for(w=0;w<r;w++)f(q[w],q[w+1]),f(c+y[w],c+y[w+1]);const u=new Int32Array(3*b),t=(h,m)=>h===p[3*m]?0:h===p[3*m+1]?1:h===p[3*m+2]?2:-1;b=(h,m)=>{h=t(h,m);u[3*m+h]=-1};f=(h,m,n,z)=>{h=t(h,m);u[3*m+h]=z;n=t(n,z);u[3*z+n]=m};for(w=0;w<r;w++){e=q[w];l=q[w+1];g=y[w];const h=y[w+1];for(;e<l&&g<h;){const m=d[2*e],n=d[2*c+2*g];m===n?(f(w,d[2*e+1],
n,d[2*c+2*g+1]),e++,g++):m<n?(b(w,d[2*e+1]),e++):(b(n,d[2*c+2*g+1]),g++)}for(;e<l;)b(w,d[2*e+1]),e++;for(;g<h;)b(d[2*c+2*g],d[2*c+2*g+1]),g++}return u};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../chunks/vec3 ../../../../../chunks/vec3f64".split(" "),function(a,p,b,r,q,y){function f(c,u){const t=
b.acosClamped(c.cosAngle),h=l.fwd,m=l.ortho;q.direction(h,c.position1,c.position0);c=0<q.dot(q.cross(m,c.faceNormal0,c.faceNormal1),h)?-1:1;return t*c>u}function w(c){const u=c.faces.length/3,t=c.faces;c=c.neighbors;var h=0;for(var m=0;m<u;m++){var n=c[3*m+1],z=c[3*m+2],k=t[3*m],v=t[3*m+1],x=t[3*m+2];h+=-1===c[3*m]||k<v?1:0;h+=-1===n||v<x?1:0;h+=-1===z||x<k?1:0}h=new Int32Array(4*h);m=0;for(n=0;n<u;n++){z=c[3*n];k=c[3*n+1];v=c[3*n+2];x=t[3*n];const C=t[3*n+1],A=t[3*n+2];if(-1===z||x<C)h[m++]=x,h[m++]=
C,h[m++]=n,h[m++]=z;if(-1===k||C<A)h[m++]=C,h[m++]=A,h[m++]=n,h[m++]=k;if(-1===v||A<x)h[m++]=A,h[m++]=x,h[m++]=n,h[m++]=v}return h}function e(c){const u=c.faces.length/3,t=c.vertices.position;c=c.faces;const h=g.v0,m=g.v1,n=g.v2,z=new Float32Array(3*u);for(let k=0;k<u;k++){const v=c[3*k+1],x=c[3*k+2];t.getVec(c[3*k],h);t.getVec(v,m);t.getVec(x,n);q.subtract(m,m,h);q.subtract(n,n,h);q.cross(h,m,n);q.normalize(h,h);z[3*k]=h[0];z[3*k+1]=h[1];z[3*k+2]=h[2]}return z}const l={edge:{position0:y.create(),
position1:y.create(),faceNormal0:y.create(),faceNormal1:y.create(),componentIndex:0,cosAngle:0},ortho:y.create(),fwd:y.create()},g={v0:y.create(),v1:y.create(),v2:y.create()},d={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(c,u,t,h=d){const m=c.vertices.position;var n=c.vertices.componentIndex,z=b.deg2rad(h.anglePlanar);h=b.deg2rad(h.angleSignificantEdge);const k=Math.cos(h),v=Math.cos(z),x=l.edge,C=x.position0,A=x.position1,B=x.faceNormal0,D=x.faceNormal1,E=e(c),G=w(c),K=G.length/
4;c=u.allocate(K);h=0;const M=t.allocate(K);let H=0,J=0,O=0;const I=p.range(0,K),F=new Float32Array(K);r.forEach(F,(S,P,Q)=>{m.getVec(G[4*P],C);m.getVec(G[4*P+1],A);Q[P]=q.distance(C,A)});I.sort((S,P)=>F[P]-F[S]);const L=[],N=[];for(let S=0;S<K;S++){var R=I[S];const P=F[R],Q=G[4*R],V=G[4*R+1],ca=G[4*R+2];R=G[4*R+3];const ba=-1===R;m.getVec(Q,C);m.getVec(V,A);if(ba)q.set(B,E[3*ca],E[3*ca+1],E[3*ca+2]),q.copy(D,B),x.componentIndex=n.get(Q),x.cosAngle=q.dot(B,D);else{q.set(B,E[3*ca],E[3*ca+1],E[3*ca+
2]);q.set(D,E[3*R],E[3*R+1],E[3*R+2]);x.componentIndex=n.get(Q);x.cosAngle=q.dot(B,D);if(x.cosAngle>v)continue;-.9999>x.cosAngle&&q.copy(D,B)}J+=P;O++;ba||x.cosAngle<k?(u.write(c,h++,x),L.push(P)):f(x,z)&&(t.write(M,H++,x),N.push(P))}n=new Float32Array(L.reverse());z=new Float32Array(N.reverse());return{regular:{instancesData:u.trim(c,h),lodInfo:{lengths:n}},silhouette:{instancesData:t.trim(M,H),lodInfo:{lengths:z}},averageEdgeLength:J/O}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define(["exports",
"../../../../../core/mathUtils","../../../../../core/maybe","../Util","../../../../webgl/Texture"],function(a,p,b,r,q){function y(e,l){if(!e)return null;var g=e.length/2;const d=.1*g;g=Array(g);let c=0;l=1===l;for(let u=0;u<e.length;u+=2){const t=(e[u]+e[u+1])/2;l?g[c++]=Math.min(d,1-.5*(1-t)):g[c++]=Math.min(d,.5*t)}return g}let f=function(){function e(l,g,d,c,u){this.resolution=l;this.normalizationScale=g;this.amplitude=d;this.variants=c;this.texture=u}e.prototype.dispose=function(){this.texture=
b.disposeMaybe(this.texture)};return e}();const w={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,
-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,
.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,
-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,
-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,
.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,
.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,
.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,
-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,
1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,
.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,
-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,
.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,
.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,
.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,
.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,
3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,
4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,
1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,
.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,
.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,
.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,
.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,
2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,
-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,
.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,
2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,
.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,
.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,
.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,
-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,
.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,
.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,
-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,
.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,
.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,
.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,
.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,
6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,
1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,
-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,
2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,
.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,
.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,
.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=f;a.generateStrokesTexture=
function(e){const l=w.resolution;var g=l/2;const d=new Uint8Array(4*l*l),c=4*l*g;g=w.amplitude;const u=2*g,t=4*l,h=p.log2(l)+1,m=w.strokes.length;let n=(h-1)*m*t;for(const {distance:z,pressure:k}of w.strokes){let v=z,x=k,C=n;for(let A=0;A<h;A++){0!==A&&(v=y(v,0),x=y(x,1));for(let B=0;B<w.resolution;B++){const D=x?x[B%x.length]:1;r.packFloatRGBA((v?v[B%v.length]/u:0)+.5,d,C);r.packFloatRGBA(D,d,C+c);C+=4}C-=t*(m+1)}n+=t}e=new q(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:l,
height:l,wrapMode:10497},d);return new f(l,u,g,m,e)};a.rasterizeStrokes=function(){var e=w.resolution;const l=p.log2(e)+1;var g=w.strokes.length;const d=w.amplitude,c=Math.ceil(2*d+.5);var u;for(u=0;1<=e;)u+=e,e/=2;u+=6*(l+1);g*=c;e=new Uint8ClampedArray(4*u*g);const t=4*u;e.fill(255);let h=24;for(const {distance:m,pressure:n}of w.strokes){let z=m,k=n,v=h;for(let x=0;x<l;x++){0!==x&&(z=y(z,0),k=y(k,1));for(let C=0;C<z.length;C++){const A=z?z[C]:0,B=k?p.clamp(k[C],0,1):1;let D=v;for(let E=-d;E<c-d;E++){const G=
255-255*p.clamp(1-(Math.abs(E-A+.5)-.5*B),0,1);e[D+0]=G;e[D+1]=G;e[D+2]=G;e[D+3]=255;D+=t}v+=4}v+=24}h+=c*t}return new ImageData(e,u,g)};a.strokesDefinition=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/maybe"],function(a,p,b){function r(q){return 0<q.size*q.color[3]*q.opacity}a.computeEdgeCount=function(q,y,f){const w=q.length;y*=f.minimumEdgeLength;f=p.binaryIndexOf(q,
y,!0);q=-1===f?y<q[0]?0:q.length:f;return w-q};a.determineEdgeTransparency=function(q){let y=0;for(const {material:f}of q)if(r(f)){if(1>f.color[3]*f.opacity)return 1;y=2}return y};a.determineObjectTransparency=function(q){let y=0;for(const {material:f}of q)if(r(f)){switch(f.objectTransparency){case 1:case 0:return 1;case 2:if(1>f.opacity)return 1}y=2}return y};a.determineRendererType=function(q){let y=null;for(const f of q)if(q=f.type,r(f))if(b.isNone(y))y=q;else if(y!==q)return"uber";return b.isSome(y)?
y:"solid"};a.estimateLengthAtDistance=function(q,y,f,w){return w/q*f*2*Math.tan(.5*y)};a.fillComponenBufferIndices=function(q,y,f,w){for(let l=0;l<q.length;l++){const g=q[l].index;var e=y[l];const d=y[l+1];if(w)for(;e<d;e++)f.set(w[e],g);else for(;e<d;e++)f.set(e,g)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ./TextureTechnique ./Util ../../../support/Scheduler ../../../webgl/Texture".split(" "),
function(a,p,b,r,q,y,f,w,e,l){const g=r.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");r=function(){function c(t,h,m){this._stage=t;this._rctx=m;this._idToRefCountedTexture=new Map;this._loadingCount=0;this._frameUpdates=new Map;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);this.events=new b;this._textureTechnique=h.acquire(f.TextureTechnique,new f.TextureTechniqueConfiguration);for(h=0;h<this._fallbackTextureData.length;++h)this._fallbackTextureData[h]=
255,this._fallbackTextureTransparentData[h]=0!==(h+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:this._rctx.parameters.maxMaxAnisotropy};this._frameTask=t.resourceController.scheduler.registerTask(e.TaskPriority.TEXTURE_UNLOAD)}var u=c.prototype;u.dispose=function(){this._frameTask.remove();q.isSome(this._fallbackTexture)&&(this._fallbackTexture.dispose(),this._fallbackTexture=null);q.isSome(this._fallbackTextureTransparent)&&
(this._fallbackTextureTransparent.dispose(),this._fallbackTextureTransparent=null);this._stage.forEachOfType(4,t=>t.unload())};u.acquire=function(t,h=!1,m){t=this._getOrCreateRef(t,h,m);t.ref();return t};u.update=function(){let t=!1;this._frameUpdates.forEach(h=>{const m=h.texture.frameUpdate(this._rctx,this._textureTechnique,h.previousToken);0<=m&&m!==h.previousToken&&(h.previousToken=m,t=!0)});t&&this.events.emit("changed",0)};u._getOrCreateRef=function(t,h,m){const n=this._idToRefCountedTexture.get(t);
return n?n:this._createNewRef(t,h,m)};u._createNewRef=function(t,h,m){const n=this._stage.getObject(t);w.assert(void 0!==n);const z=n.events.on("unloaded",()=>{z.remove();this._onTextureUnloaded(t)}),k=new d;this._idToRefCountedTexture.set(t,k);const v=n.load(this._rctx,this._textureTechnique);this._loadingCount++;const x=A=>{this._loadingCount--;this._updateGLTexture(k,A);m&&m(k);n.requiresFrameUpdates&&this._frameUpdates.set(t,{texture:n,previousToken:-1});return k},C=A=>{this._loadingCount--;y.isAbortError(A)||
g.error(A)};y.isPromiseLike(v)?(this._updateGLTexture(k,h?this.fallbackTextureTransparent:this.fallbackTexture),v.then(x,C)):x(v);return k};u._updateGLTexture=function(t,h){t.glTexture=h;this.events.emit("changed",1)};u.release=function(t){const h=this._idToRefCountedTexture.get(t);if(h&&(h.unref(),h.isUnreferenced)){const m=this._stage.getObject(t);this._frameTask.schedule(()=>{h.isUnreferenced&&m.unload()})}};u.getTexture=function(t){return this._stage.getObject(t)};u._onTextureUnloaded=function(t){this._idToRefCountedTexture.delete(t);
this._frameUpdates.delete(t)};p._createClass(c,[{key:"updating",get:function(){return 0<this.loadingCount||this._frameTask.updating}},{key:"loadingCount",get:function(){return this._loadingCount}},{key:"fallbackTexture",get:function(){q.isNone(this._fallbackTexture)&&(this._fallbackTexture=new l(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));return this._fallbackTexture}},{key:"fallbackTextureTransparent",get:function(){q.isNone(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent=
new l(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));return this._fallbackTextureTransparent}}]);return c}();let d=function(){function c(){this._refCount=0;this.glTexture=null}var u=c.prototype;u.ref=function(){++this._refCount};u.unref=function(){0===this._refCount?g.error("Cannot dereference texture that has no references!"):--this._refCount};p._createClass(c,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return c}();a.RefCountedTexture=d;a.TextureRepository=
r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../../../webgl/Texture".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){const c=y.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");a.WaterTextureRepository=function(u){function t(){var m=u.apply(this,arguments)||this;m._data=[];m.loadingState=0;return m}p._inheritsLoose(t,u);var h=t.prototype;h.dispose=function(){this.loadingState=0;this._data.forEach(m=>m.dispose());this._data.length=0};h.loadTextures=function(m){const n=[r.getAssetUrl("esri/images/materials/water/normals.jpg"),r.getAssetUrl("esri/images/materials/water/perturbation.jpg")];
this.loadingState=1;Promise.all(n.map(z=>g.requestImage(z))).then(z=>{z.forEach(k=>this._data.push(new d(m,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:!0,maxAnisotropy:8,width:k.width,height:k.height},k)));this.loadingState=2}).catch(z=>{c.error("Failed to load textures for water material.",z);this.loadingState=0})};h.bind=function(m){this.ready&&(m.bindTexture(this._data[0],"texWaveNormal"),m.bindTexture(this._data[1],"texWavePerturbation"))};p._createClass(t,
[{key:"updating",get:function(){return 1===this.loadingState}},{key:"ready",get:function(){return 2===this.loadingState}}]);return t}(q);b.__decorate([f.property()],a.WaterTextureRepository.prototype,"loadingState",void 0);b.__decorate([f.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=b.__decorate([l.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../lib/AutoDisposable ../../../support/screenshotUtils ../../../webgl/FramebufferObject".split(" "),function(a,p,b,r,q,y,f,w){y=function(e){function l(d,c,u,t=null,h,m=!0){var n=e.call(this)||this;n._rctx=d;n._renderScene=c;n._requestRenderScene=u;n._renderOverlay=t;n.forceCameraHook=
h;n.supersample=m;n._screenshotQueue=[];return n}p._inheritsLoose(l,e);var g=l.prototype;g.dispose=function(){this._rctx=null};g.takeScreenshot=function(d){this._requestRenderScene();const c=r.createResolver();this._screenshotQueue.push({settings:d,resolver:c});return c.promise};g.update=function(d){if(0!==this._screenshotQueue.length){for(const u of this._screenshotQueue){if(this.isDisposed){u.resolver.reject();continue}var c={...u.settings,pixelRatio:u.settings.pixelRatio*d.viewCamera.pixelRatio};
const t=this._ensureScreenshotEncodeCanvas(),h=this._renderScreenshot(d,c);c=f.encodeResult(h,c,t,{flipY:!0,premultipliedAlpha:!0});u.resolver(c)}this._screenshotQueue=[]}};g._renderScreenshotOverlay=function(d,c,u){if(b.isNone(this._renderOverlay))return c;d.width=c.width;d.height=c.height;const t=d.getContext("2d"),h=u.pixelRatio;t.save();t.translate(0,c.height);t.scale(1,-1);u.region&&t.translate(-u.region.x,-u.region.y);t.scale(h,h);c=this._renderOverlay(d,c);t.restore();return c};g._readbackScreenshot=
function(d){return d.resample?this._readbackScreenshotResampled(d):this._readbackScreenshotImmediate(d)};g._readbackScreenshotResampled=function(d){const {framebufferWidth:c,framebufferHeight:u,region:t,resample:h}=d,m=this._ensureScreenshotEncodeCanvas();let n=f.createEmptyImageData(c,u,m);this._rctx.gl.readPixels(0,0,c,u,6408,5121,new Uint8Array(n.data.buffer));n=this._renderScreenshotOverlay(m,n,{...d,region:null});d=f.createEmptyImageData(t.width,t.height,m);return f.resampleHermite(n,d,!0,h.region.x,
u-(h.region.y+h.region.height),h.region.width,h.region.height)};g._readbackScreenshotImmediate=function(d){const {framebufferHeight:c,region:u}=d,t=this._ensureScreenshotEncodeCanvas(),h=f.createEmptyImageData(u.width,u.height,t);this._rctx.gl.readPixels(u.x,c-(u.y+u.height),u.width,u.height,6408,5121,new Uint8Array(h.data.buffer));return this._renderScreenshotOverlay(t,h,d)};g._renderScreenshot=function(d,c){var u=null;const t=d.viewCamera,{framebufferWidth:h,framebufferHeight:m}=c;var n=!1;d=c.disableDecorations&&
d.frameHasDecorations;var z=c.ignorePadding&&t.pixelRatio!==c.pixelRatio;if(d=h!==t.fullWidth||m!==t.fullHeight||d||z){z=t.clone();if(c.ignorePadding){u=q.clone(z.padding);for(n=0;4>n;n++)u[n]=Math.round(u[n]/z.pixelRatio*c.pixelRatio);z.padding=u}z.fullWidth=h;z.fullHeight=m;z.pixelRatio=c.pixelRatio;u=t.fovX-z.fovX;n=t.fovY-z.fovY;0>u&&u<n?z.fovX=t.fovX:0>n&&n<u&&(z.fovY=t.fovY);this.forceCameraHook(z);n=!0;u=new w(this._rctx,{width:z.fullWidth,height:z.fullHeight,colorTarget:0,depthStencilTarget:3});
this._renderScene(u,z,c.disableDecorations)}c=this._readbackScreenshot(c);if(d&&!this._rctx.contextAttributes.alpha)for(d=3;d<c.data.length;d+=4)c.data[d]=255;u&&u.dispose();this._rctx.bindFramebuffer(null);n&&this.forceCameraHook(t);return c};g._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return l}(y.AutoDisposable);a.ScreenshotManager=y;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/webgl/context-util":function(){define(["exports","../../core/maybe"],function(a,p){function b(q,y,f={}){y=1===y?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let w=null;for(const e of y){try{w=q.getContext(e,f)}catch(l){}if(w)break}return w}function r(q,y){(q=q.parentNode)&&(q.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
y+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}a.createContext=b;a.createContextOrErrorHTML=function(q,y,f={}){if(!window.WebGLRenderingContext)return r(q,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),null;y=b(q,y,f);return p.isNone(y)?(r(q,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'),
null):y};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/RenderingContext":function(){define("../../chunks/_rollupPluginBabelHelpers ../../core/maybe ./checkWebGLError ./enums ./InstanceCounter ./renderState ./Texture ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(a,p,b,r,q,y,f,w,e){function l(d,c,u,t){c?t!==c&&d.bindBuffer(u,c.glName):d.bindBuffer(u,null);return c}function g(d,c){switch(d){case 0:return 2*c;case 4:return c/3;case 5:return c-2;case 6:return c-
2;default:return 0}}return function(){function d(u,t={}){this.gl=u;this.instanceCounter=new q.InstanceCounter;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=
!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=
this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap=[];this._numOfTriangles=this._numOfDrawCalls=0;this.webglVersion=w(u)?"webgl2":"webgl";u instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=e.loadCapabilities(u,t);this._parameters=this._loadParameters(t);u=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:u[0],y:u[1],width:u[2],height:u[3]};this._stateTracker=new y.StateTracker({setBlending:h=>{h?(this.setBlendingEnabled(!0),
this.setBlendEquationSeparate(h.opRgb,h.opAlpha),this.setBlendFunctionSeparate(h.srcRgb,h.dstRgb,h.srcAlpha,h.dstAlpha),h=h.color,this.setBlendColor(h.r,h.g,h.b,h.a)):this.setBlendingEnabled(!1)},setCulling:h=>{h?(this.setFaceCullingEnabled(!0),this.setCullFace(h.face),this.setFrontFace(h.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:h=>{h?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(h.factor,h.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:h=>{h?(this.setDepthTestEnabled(!0),
this.setDepthFunction(h.func)):this.setDepthTestEnabled(!1)},setStencilTest:h=>{if(h){this.setStencilTestEnabled(!0);const m=h.function;this.setStencilFunction(m.func,m.ref,m.mask);h=h.operation;this.setStencilOp(h.fail,h.zFail,h.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:h=>{h?(this.setDepthWriteEnabled(!0),this.setDepthRange(h.zNear,h.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:h=>{h?this.setColorMask(h.r,h.g,h.b,h.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:h=>{h?
this.setStencilWriteMask(h.mask):this.setStencilWriteMask(0)}});this.enforceState()}var c=d.prototype;c.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap.length=0;b.webglDebugEnabled()&&this.instanceCounter.printResourceCount()};c.setPipelineState=function(u){this._stateTracker.setPipeline(u)};c.setBlendingEnabled=function(u){this._blendEnabled!==u&&(!0===u?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=u,
this._stateTracker.invalidateBlending())};c.externalTextureUnitUpdate=function(u,t){for(let h=0;h<u.length;++h)this._textureUnitMap[u[h]]=null;0<=t&&(this._activeTextureUnit=t)};c.externalVertexArrayObjectUpdate=function(){const u=this.capabilities.vao;u&&(u.bindVertexArray(null),this._activeVertexArrayObject=null);this._activeIndexBuffer=this._activeVertexBuffer=null};c.externalVertexBufferUpdate=function(){this._activeVertexBuffer=null};c.externalIndexBufferUpdate=function(){this._activeIndexBuffer=
null};c.setBlendColor=function(u,t,h,m){if(u!==this._blendColorState.r||t!==this._blendColorState.g||h!==this._blendColorState.b||m!==this._blendColorState.a)this.gl.blendColor(u,t,h,m),this._blendColorState.r=u,this._blendColorState.g=t,this._blendColorState.b=h,this._blendColorState.a=m,this._stateTracker.invalidateBlending()};c.setBlendFunction=function(u,t){if(u!==this._blendFunctionState.srcRGB||t!==this._blendFunctionState.dstRGB)this.gl.blendFunc(u,t),this._blendFunctionState.srcRGB=u,this._blendFunctionState.srcAlpha=
u,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending()};c.setBlendFunctionSeparate=function(u,t,h,m){if(this._blendFunctionState.srcRGB!==u||this._blendFunctionState.srcAlpha!==h||this._blendFunctionState.dstRGB!==t||this._blendFunctionState.dstAlpha!==m)this.gl.blendFuncSeparate(u,t,h,m),this._blendFunctionState.srcRGB=u,this._blendFunctionState.srcAlpha=h,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=m,this._stateTracker.invalidateBlending()};
c.setBlendEquation=function(u){this._blendEquationState.mode!==u&&(this.gl.blendEquation(u),this._blendEquationState.mode=u,this._blendEquationState.modeAlpha=u,this._stateTracker.invalidateBlending())};c.setBlendEquationSeparate=function(u,t){if(this._blendEquationState.mode!==u||this._blendEquationState.modeAlpha!==t)this.gl.blendEquationSeparate(u,t),this._blendEquationState.mode=u,this._blendEquationState.modeAlpha=t,this._stateTracker.invalidateBlending()};c.setColorMask=function(u,t,h,m){if(this._colorMaskState.r!==
u||this._colorMaskState.g!==t||this._colorMaskState.b!==h||this._colorMaskState.a!==m)this.gl.colorMask(u,t,h,m),this._colorMaskState.r=u,this._colorMaskState.g=t,this._colorMaskState.b=h,this._colorMaskState.a=m,this._stateTracker.invalidateColorWrite()};c.setClearColor=function(u,t,h,m){if(this._clearColor.r!==u||this._clearColor.g!==t||this._clearColor.b!==h||this._clearColor.a!==m)this.gl.clearColor(u,t,h,m),this._clearColor.r=u,this._clearColor.g=t,this._clearColor.b=h,this._clearColor.a=m};
c.setFaceCullingEnabled=function(u){this._polygonCullingEnabled!==u&&(!0===u?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=u,this._stateTracker.invalidateCulling())};c.setPolygonOffsetFillEnabled=function(u){this._polygonOffsetFillEnabled!==u&&(!0===u?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=u,this._stateTracker.invalidatePolygonOffset())};c.setPolygonOffset=function(u,
t){if(this._polygonOffset[0]!==u||this._polygonOffset[1]!==t)this._polygonOffset[0]=u,this._polygonOffset[1]=t,this.gl.polygonOffset(u,t),this._stateTracker.invalidatePolygonOffset()};c.setCullFace=function(u){this._cullFace!==u&&(this.gl.cullFace(u),this._cullFace=u,this._stateTracker.invalidateCulling())};c.setFrontFace=function(u){this._frontFace!==u&&(this.gl.frontFace(u),this._frontFace=u,this._stateTracker.invalidateCulling())};c.setScissorTestEnabled=function(u){this._scissorTestEnabled!==
u&&(!0===u?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=u)};c.setScissorRect=function(u,t,h,m){if(this._scissorRect.x!==u||this._scissorRect.y!==t||this._scissorRect.width!==h||this._scissorRect.height!==m)this.gl.scissor(u,t,h,m),this._scissorRect.x=u,this._scissorRect.y=t,this._scissorRect.width=h,this._scissorRect.height=m};c.setDepthTestEnabled=function(u){this._depthTestEnabled!==u&&(!0===u?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),
this._depthTestEnabled=u,this._stateTracker.invalidateDepthTest())};c.setClearDepth=function(u){this._clearDepth!==u&&(this.gl.clearDepth(u),this._clearDepth=u)};c.setDepthFunction=function(u){this._depthFunction!==u&&(this.gl.depthFunc(u),this._depthFunction=u,this._stateTracker.invalidateDepthTest())};c.setDepthWriteEnabled=function(u){this._depthWriteEnabled!==u&&(this.gl.depthMask(u),this._depthWriteEnabled=u,this._stateTracker.invalidateDepthWrite())};c.setDepthRange=function(u,t){if(this._depthRange.zNear!==
u||this._depthRange.zFar!==t)this.gl.depthRange(u,t),this._depthRange.zNear=u,this._depthRange.zFar=t,this._stateTracker.invalidateDepthWrite()};c.setStencilTestEnabled=function(u){this._stencilTestEnabled!==u&&(!0===u?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=u,this._stateTracker.invalidateStencilTest())};c.setClearStencil=function(u){u!==this._clearStencil&&(this.gl.clearStencil(u),this._clearStencil=u)};c.setStencilFunction=function(u,t,
h){if(this._stencilFunction.func!==u||this._stencilFunction.ref!==t||this._stencilFunction.mask!==h)this.gl.stencilFunc(u,t,h),this._stencilFunction.face=1032,this._stencilFunction.func=u,this._stencilFunction.ref=t,this._stencilFunction.mask=h,this._stateTracker.invalidateStencilTest()};c.setStencilFunctionSeparate=function(u,t,h,m){if(this._stencilFunction.face!==u||this._stencilFunction.func!==t||this._stencilFunction.ref!==h||this._stencilFunction.mask!==m)this.gl.stencilFuncSeparate(u,t,h,m),
this._stencilFunction.face=u,this._stencilFunction.func=t,this._stencilFunction.ref=h,this._stencilFunction.mask=m,this._stateTracker.invalidateStencilTest()};c.setStencilWriteMask=function(u){this._stencilWriteMask!==u&&(this.gl.stencilMask(u),this._stencilWriteMask=u,this._stateTracker.invalidateStencilWrite())};c.setStencilOp=function(u,t,h){if(this._stencilOperation.fail!==u||this._stencilOperation.zFail!==t||this._stencilOperation.zPass!==h)this.gl.stencilOp(u,t,h),this._stencilOperation.face=
1032,this._stencilOperation.fail=u,this._stencilOperation.zFail=t,this._stencilOperation.zPass=h,this._stateTracker.invalidateStencilTest()};c.setStencilOpSeparate=function(u,t,h,m){if(this._stencilOperation.face!==u||this._stencilOperation.fail!==t||this._stencilOperation.zFail!==h||this._stencilOperation.zPass!==m)this.gl.stencilOpSeparate(u,t,h,m),this._stencilOperation.face=u,this._stencilOperation.face=u,this._stencilOperation.fail=t,this._stencilOperation.zFail=h,this._stencilOperation.zPass=
m,this._stateTracker.invalidateStencilTest()};c.setActiveTexture=function(u,t=!1){const h=this._activeTextureUnit;0<=u&&(t||u!==this._activeTextureUnit)&&(this.gl.activeTexture(r.BASE_TEXTURE_UNIT+u),this._activeTextureUnit=u);return h};c.clear=function(u){u&&this.gl.clear(u)};c.clearSafe=function(u,t=255){u&&(u&16384&&this.setColorMask(!0,!0,!0,!0),u&256&&this.setDepthWriteEnabled(!0),u&1024&&this.setStencilWriteMask(t),this.gl.clear(u))};c.drawArrays=function(u,t,h){b.webglDebugEnabled()&&(this._numOfDrawCalls++,
this._numOfTriangles+=g(u,h));this.gl.drawArrays(u,t,h)};c.drawElements=function(u,t,h,m){b.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=g(u,t));this.gl.drawElements(u,t,h,m)};c.logIno=function(){b.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};c.setViewport=function(u,t,h,m){h=Math.max(Math.round(h),1);m=Math.max(Math.round(m),1);const n=this._viewport;if(n.x!==u||n.y!==t||n.width!==h||n.height!==m)n.x=u,n.y=t,n.width=
h,n.height=m,this.gl.viewport(u,t,h,m)};c.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};c.useProgram=function(u){var t;if(u)this._activeShaderProgram!==u&&(null==(t=this._activeShaderProgram)?void 0:t.stop(),this._activeShaderProgram=u,this.gl.useProgram(u.glName));else{var h;null==(h=this._activeShaderProgram)?void 0:h.stop();this._activeShaderProgram=null;this.gl.useProgram(null)}};c.bindTexture=function(u,t,h=!1){(t>=
this.parameters.maxTextureImageUnits||0>t)&&console.error("Input texture unit is out of range of available units!");const m=this._textureUnitMap[t];this.setActiveTexture(t,h);if(p.isNone(u)||null==u.glName)return p.isSome(m)&&this.gl.bindTexture(m.descriptor.target,null),this._textureUnitMap[t]=null,m;if(!h&&m===u)return u.applyChanges(),m;this.gl.bindTexture(u.descriptor.target,u.glName);u.applyChanges();this._textureUnitMap[t]=u;return m};c.unbindTextureAllUnits=function(u){for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._textureUnitMap[t]===
u&&(this.bindTexture(null,t),this._textureUnitMap[t]=null)};c.bindFramebuffer=function(u,t=!1,h=3553){if(p.isNone(u))this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null;else if(t||this._activeFramebuffer!==u)u.initializeAndBind(h),this._activeFramebuffer=u};c.bindBuffer=function(u){u&&(34962===u.bufferType?this._activeVertexBuffer=l(this.gl,u,u.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=l(this.gl,u,u.bufferType,this._activeIndexBuffer))};c.bindRenderbuffer=
function(u){const t=this.gl;u||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==u&&(t.bindRenderbuffer(t.RENDERBUFFER,u.glName),this._activeRenderbuffer=u)};c.unbindBuffer=function(u){34962===u?this._activeVertexBuffer=l(this.gl,null,u,this._activeVertexBuffer):this._activeIndexBuffer=l(this.gl,null,u,this._activeIndexBuffer)};c.bindVAO=function(u=null){p.isNone(u)?this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=
null):this._activeVertexArrayObject!==u&&(u.bind(),this._activeVertexArrayObject=u)};c.getBoundFramebufferObject=function(){return this._activeFramebuffer};c.getBoundVAO=function(){return this._activeVertexArrayObject};c.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(let u=0;u<this.parameters.maxTextureImageUnits;++u)this.bindTexture(null,u);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);
this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);
this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};c.enforceState=function(){const u=this.gl;var t=this.capabilities.vao;t&&t.bindVertexArray(null);for(var h=0;h<this.parameters.maxVertexAttributes;h++)u.disableVertexAttribArray(h);this._activeVertexBuffer?u.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):u.bindBuffer(34962,null);this._activeIndexBuffer?
u.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):u.bindBuffer(34963,null);if(t&&this._activeVertexArrayObject){if(t=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(t)}u.bindFramebuffer(u.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);u.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);u.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,
this._blendColorState.a);u.bindRenderbuffer(u.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?u.enable(this.gl.BLEND):u.disable(this.gl.BLEND);u.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);u.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);u.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,
this._clearColor.a);u.clearDepth(this._clearDepth);u.clearStencil(this._clearStencil);u.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);u.cullFace(this._cullFace);u.depthFunc(this._depthFunction);u.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST);u.depthMask(this._depthWriteEnabled);u.frontFace(this._frontFace);u.lineWidth(1);!0===this._polygonCullingEnabled?u.enable(u.CULL_FACE):
u.disable(u.CULL_FACE);u.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?u.enable(u.POLYGON_OFFSET_FILL):u.disable(u.POLYGON_OFFSET_FILL);u.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?u.enable(u.SCISSOR_TEST):u.disable(u.SCISSOR_TEST);u.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);u.stencilOpSeparate(this._stencilOperation.face,
this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST);u.stencilMask(this._stencilWriteMask);for(t=0;t<this.parameters.maxTextureImageUnits;t++)u.activeTexture(r.BASE_TEXTURE_UNIT+t),u.bindTexture(3553,null),u.bindTexture(34067,null),w(u)&&u.bindTexture(32879,null),h=this._textureUnitMap[t],p.isSome(h)&&u.bindTexture(h.descriptor.target,h.glName);u.activeTexture(r.BASE_TEXTURE_UNIT+this._activeTextureUnit);
u.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height);b.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)};c._loadParameters=function(u){var t;const h=this.capabilities.textureFilterAnisotropic;u=null!=(t=u.maxAnisotropy)?t:Infinity;t={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:h?
Math.min(this.gl.getParameter(h.MAX_TEXTURE_MAX_ANISOTROPY),u):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)};f.TEXTURE_UNIT_FOR_UPDATES=t.maxTextureImageUnits-1;return t};a._createClass(d,[{key:"contextAttributes",get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},{key:"capabilities",get:function(){return this._capabilities}}]);return d}()})},
"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./enums"],function(a,p,b){let r=function(){function q(){this._current=[];this._max=[];for(this._allocations=new Map;this._current.length<b.ResourceType.COUNT;)this._current.push(0),this._max.push(0)}var y=q.prototype;y.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};y.increment=function(f,w){w=++this._current[f];this._max[f]=Math.max(w,this._max[f])};
y.decrement=function(f,w){--this._current[f]};y.printResourceCount=function(){if(0<this.total){console.log("Live objects:");for(let f=0;f<b.ResourceType.COUNT;++f){const w=this._current[f];0<w&&console.log(`${b.ResourceType[f]}: ${w}`)}}if(0<this._allocations.size){console.log(`${this._allocations.size} live object allocations:`);const f=new Map;this._allocations.forEach(w=>{var e;f.set(w,(null!=(e=f.get(w))?e:0)+1)});f.forEach((w,e)=>console.log(w," : ",e))}};p._createClass(q,[{key:"max",get:function(){return this._max}},
{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((f,w)=>f+w,0)}}]);return q}();a.InstanceCounter=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/load":function(){define("exports ./DisjointTimerQuery ./DrawBuffers ./Instancing ./isWebGL2Context ./LoseContext ./VertexArrayObjects".split(" "),function(a,p,b,r,q,y,f){function w(e,l,g,d,c){if(d&&q(e))return!0;if(l[g])return!1;for(const u of c)if(e.getExtension(u))return!0;
return!1}a.loadCapabilities=function(e,l){const g=l.disabledExtensions||{},d=l.debugWebGLExtensions||{};let c,u,t,h,m,n,z,k,v,x,C,A=null,B=null,D=null,E=null;return{get drawBuffers(){C||(C=b.load(e,g));return C},get instancing(){c||(c=r.load(e));return c},get vao(){u||(u=f.load(e,g));return u},get compressedTextureETC(){if(!t)if(g.compressedTextureETC)t=null;else{var G=e.getExtension("WEBGL_compressed_texture_etc");t=G?{COMPRESSED_R11_EAC:G.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:G.COMPRESSED_SIGNED_R11_EAC,
COMPRESSED_RG11_EAC:G.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:G.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:G.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:G.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:G.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:G.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:G.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:G.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}return t},get compressedTextureS3TC(){if(!h)if(g.compressedTextureS3TC)h=
null;else{var G=e.getExtension("WEBGL_compressed_texture_s3tc");h=G?{COMPRESSED_RGB_S3TC_DXT1:G.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:G.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:G.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:G.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}return h},get textureFilterAnisotropic(){if(!m)if(g.textureFilterAnisotropic)m=null;else{var G=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||
e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");m=G?{MAX_TEXTURE_MAX_ANISOTROPY:G.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:G.TEXTURE_MAX_ANISOTROPY_EXT}:null}return m},get disjointTimerQuery(){n||(n=p.createDisjointTimerQuery(e,g));return n},get textureFloat(){if(!z)if(q(e))z={textureFloat:!0,textureFloatLinear:!g.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!g.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),
HALF_FLOAT:e.HALF_FLOAT};else if(e instanceof WebGLRenderingContext){const G=!g.textureHalfFloat&&e.getExtension("OES_texture_half_float");z={textureFloat:!g.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!g.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!G,textureHalfFloatLinear:!g.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:G?G.HALF_FLOAT_OES:void 0}}else z=null;return z},get colorBufferFloat(){if(!k)if(q(e)){var G=
!g.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),K=!g.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),M=!g.colorBufferFloat&&e.getExtension("EXT_float_blend");k=G||K||M?{textureFloat:!!K,textureHalfFloat:!!G,floatBlend:!!M,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}else e instanceof WebGLRenderingContext?(G=!g.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),
K=!g.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),M=!g.colorBufferFloat&&e.getExtension("EXT_float_blend"),k=G||K||M?{textureFloat:!!K,textureHalfFloat:!!G,floatBlend:!!M,RGBA16F:G?G.RGBA16F_EXT:void 0,RGB16F:G?G.RGB16F_EXT:void 0,RGBA32F:K?K.RGBA32F_EXT:void 0}:null):k=null;return k},get blendMinMax(){if(!v)if(q(e))v={MIN:e.MIN,MAX:e.MAX};else if(g.blendMinMax)v=null;else{{const G=e.getExtension("EXT_blend_minmax");v=G?{MIN:G.MIN_EXT,MAX:G.MAX_EXT}:null}}return v},get depthTexture(){null===
A&&(A=w(e,g,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return A},get standardDerivatives(){null===B&&(B=w(e,g,"standardDerivatives",!0,["OES_standard_derivatives"]));return B},get shaderTextureLOD(){null===D&&(D=w(e,g,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return D},get fragDepth(){null===E&&(E=w(e,g,"fragDepth",!0,["EXT_frag_depth"]));return E},get loseContext(){x||(x=y.load(e,d));return x},enable(G){return this[G]}}};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(a,p){let b=function(r,q,y,f,w,e,l,g){this.createQuery=r;this.resultAvailable=q;this.getResult=y;this.disjoint=f;this.beginTimeElapsed=w;this.endTimeElapsed=e;this.createTimestamp=l;this.timestampBits=g};a.DisjointTimerQuery=b;a.createDisjointTimerQuery=function(r,q){if(q.disjointTimerQuery)return null;let y=r.getExtension("EXT_disjoint_timer_query_webgl2");return y&&
p(r)?new b(()=>r.createQuery(),f=>r.getQueryParameter(f,r.QUERY_RESULT_AVAILABLE),f=>r.getQueryParameter(f,r.QUERY_RESULT),()=>r.getParameter(y.GPU_DISJOINT_EXT),f=>r.beginQuery(y.TIME_ELAPSED_EXT,f),()=>r.endQuery(y.TIME_ELAPSED_EXT),f=>y.queryCounterEXT(f,y.TIMESTAMP_EXT),()=>r.getQuery(y.TIMESTAMP_EXT,y.QUERY_COUNTER_BITS_EXT)):(y=r.getExtension("EXT_disjoint_timer_query"))?new b(()=>y.createQueryEXT(),f=>y.getQueryObjectEXT(f,y.QUERY_RESULT_AVAILABLE_EXT),f=>y.getQueryObjectEXT(f,y.QUERY_RESULT_EXT),
()=>r.getParameter(y.GPU_DISJOINT_EXT),f=>y.beginQueryEXT(y.TIME_ELAPSED_EXT,f),()=>y.endQueryEXT(y.TIME_ELAPSED_EXT),f=>y.queryCounterEXT(f,y.TIMESTAMP_EXT),()=>y.getQueryEXT(y.TIMESTAMP_EXT,y.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,p){a.load=function(b,r){return r.disjointTimerQuery?null:p(b)?{drawBuffers:b.drawBuffers.bind(b),MAX_DRAW_BUFFERS:b.MAX_DRAW_BUFFERS,
MAX_COLOR_ATTACHMENTS:b.MAX_COLOR_ATTACHMENTS}:r.drawBuffers?null:(b=b.getExtension("WEBGL_draw_buffers"))?{drawBuffers:b.drawBuffersWEBGL.bind(b),MAX_DRAW_BUFFERS:b.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:b.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports","./isWebGL2Context"],function(a,p){a.load=function(b){return p(b)?{drawArraysInstanced:b.drawArraysInstanced.bind(b),drawElementsInstanced:b.drawElementsInstanced.bind(b),
vertexAttribDivisor:b.vertexAttribDivisor.bind(b)}:(b=b.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:b.drawArraysInstancedANGLE.bind(b),drawElementsInstanced:b.drawElementsInstancedANGLE.bind(b),vertexAttribDivisor:b.vertexAttribDivisorANGLE.bind(b)}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(p,b){const r=b.loseContext&&p.getExtension("WEBGL_lose_context");return r?
{loseRenderingContext:()=>r.loseContext()}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(a,p){a.load=function(b,r){return p(b)?{createVertexArray:b.createVertexArray.bind(b),deleteVertexArray:b.deleteVertexArray.bind(b),bindVertexArray:b.bindVertexArray.bind(b)}:r.vao?null:(b=b.getExtension("OES_vertex_array_object")||b.getExtension("MOZ_OES_vertex_array_object")||b.getExtension("WEBKIT_OES_vertex_array_object"))?
{createVertexArray:b.createVertexArrayOES.bind(b),deleteVertexArray:b.deleteVertexArrayOES.bind(b),bindVertexArray:b.bindVertexArrayOES.bind(b)}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define(["exports","../../../../core/maybe"],function(a,p){function b(y,f){if(p.isNone(y))return null;const w=q(y,f);return p.isNone(w)?null:w===f.graphics?p.isSome(f.graphicsView)?p.unwrap(f.graphicsView.getGraphicFromGraphicUid(y.graphicUid)):
null:(f=f.allLayerViews.find(e=>e.layer===w))?r(f,y):null}function r(y,f){return!y||y.suspended?null:"getGraphicFromIntersectorMetadata"in y&&f?y.getGraphicFromIntersectorMetadata(f):"getGraphicFromGraphicUid"in y&&null!=f.graphicUid?y.getGraphicFromGraphicUid(f.graphicUid):null}function q(y,f){return p.isNone(y)||null==y.layerUid?null:p.isSome(f.graphicsView)&&y.layerUid===f.graphicsView.graphics3d.layer.id?f.graphics:f.map.findLayerByUid(y.layerUid)}a.toGraphic=function(y,f){if(!y.target)return null;
switch(y.target.type){case "stage":return b(y.target.obj.metadata,f);case "external":switch(y.intersector){case "PointRenderer":return y.target.metadata.createGraphic();case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return b(y.target.metadata,f)}}return null};a.toOwner=function(y,f){if(!y.target)return null;switch(y.target.type){case "stage":return q(y.target.obj.metadata,f);case "external":switch(y.intersector){case "PointRenderer":return y=y.target.metadata.layerUid,f=null!=y?f.map.findLayerByUid(y):
null;case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return q(y.target.metadata,f);case "TerrainRenderer":return f.map&&f.map.ground}}return null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,p){function b(){b=p._asyncToGenerator(function*(r,q){if("2d"===r.type)return r.hitTest(q);r=yield r.hitTest(q);const y=r.results[0];q=r.results.findIndex(f=>f.distance!==
y.distance);-1!==q&&(r.results=r.results.slice(0,q));return r});return b.apply(this,arguments)}a.hitTestSelectSameDistance=function(r,q){return b.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities"],function(a,p,b){const r={checkMajorWebPerformanceCaveat:!0};a.check=function(q){q={...r,...q};const y=b();return y.available?q.checkMajorWebPerformanceCaveat&&y.majorPerformanceCaveat?
new p("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):y.supportsHighPrecisionFragment?y.supportsVertexShaderSamplers?y.supportsElementIndexUint?y.supportsStandardDerivatives?y.supportsInstancedArrays?null:new p("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new p("webgl:standard-derivatives-required",
"WebGL support for standard derivatives is required but not supported."):new p("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new p("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new p("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new p("webgl:required","WebGL is required but not supported.")};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities":function(){define(["../../core/maybe","./context-util"],function(a,p){function b(){const q={available:!1,version:0,majorPerformanceCaveat:!1,maxTextureSize:0,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1,supportsInstancedArrays:!1,supportsTextureFloat:!1,supportsColorBufferFloat:!1};var y=document.createElement("canvas");if(!y)return q;var f=
p.createContext(y,1,{failIfMajorPerformanceCaveat:!0});a.isNone(f)&&(f=p.createContext(y,1),a.isSome(f)&&(q.majorPerformanceCaveat=!0));if(a.isNone(f))return q;y=f.getParameter(f.VERSION);if(!y)return q;if(y=y.match(/^WebGL\s+([\d.]*)/)){y=parseFloat(y[1]);q.available=.94<=y;if(y=f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT))q.supportsHighPrecisionFragment=0<y.precision;q.supportsVertexShaderSamplers=0<f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS);q.supportsElementIndexUint=null!==
f.getExtension("OES_element_index_uint");q.supportsStandardDerivatives=null!==f.getExtension("OES_standard_derivatives");q.supportsInstancedArrays=null!==f.getExtension("ANGLE_instanced_arrays");q.supportsTextureFloat=null!==f.getExtension("OES_texture_float");q.supportsColorBufferFloat=null!==f.getExtension("WEBGL_color_buffer_float")&&null!==f.getExtension("EXT_float_blend")}q.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE);(f=document.createElement("canvas"))?(f=p.createContext(f,2),f=a.isSome(f)?
!0:!1):f=!1;q.version=f?2:1;return q}let r;return function(){r||(r=b());return r}})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),function(a,p,b,r,q,y,f,w){r=function(e){function l(g){g=e.call(this,g)||this;g.components=["attribution",
"zoom","navigation-toggle","compass"];return g}a._inheritsLoose(l,e);return l}(w);p.__decorate([b.property()],r.prototype,"components",void 0);return r=p.__decorate([f.subclass("esri.views.ui.3d.DefaultUI3D")],r)})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){r.getLogger("esri.views.ui.DefaultUI");b=function(t){function h(n){n=t.call(this,n)||this;n._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};n.components=[];return n}a._inheritsLoose(h,t);var m=h.prototype;m.initialize=function(){this._handles.add([q.init(this,"components",this._componentsWatcher.bind(this)),q.init(this,"view",this._updateViewAwareWidgets.bind(this))])};m._add=function(n,
z,k,v){if("string"===typeof n&&this._defaultPositionLookup[n]){if(this._find(n))return;n=this._createComponent(n)}t.prototype._add.call(this,n,z,k,v)};m._removeComponents=function(n){n.forEach(z=>{if(z=this._find(z))this.remove(z),z.destroy()})};m._updateViewAwareWidgets=function(n){this.components.forEach(z=>{(z=(z=this._find(z))&&z.widget)&&void 0!==z.view&&(z.view=n)})};m._componentsWatcher=function(n,z){this._removeComponents(z);this._addComponents(n);this._adjustPadding(n)};m._adjustPadding=
function(n){-1!==n.indexOf("attribution")||this._isOverridden("padding")||({top:n}=this.padding,this.padding=n)};m._addComponents=function(n){this.initialized&&n.forEach(z=>this.add(this._createComponent(z),this._defaultPositionLookup[z]))};m._createComponent=function(n){const z=this._createWidget(n);if(z)return new e({id:n,node:z})};m._createWidget=function(n){if("attribution"===n)return this._createAttribution();if("compass"===n)return this._createCompass();if("navigation-toggle"===n)return this._createNavigationToggle();
if("zoom"===n)return this._createZoom()};m._createAttribution=function(){return new g({view:this.view})};m._createCompass=function(){return new d({view:this.view})};m._createNavigationToggle=function(){return new c({view:this.view})};m._createZoom=function(){return new u({view:this.view})};return h}(l);p.__decorate([y.property()],b.prototype,"components",void 0);return b=p.__decorate([w.subclass("esri.views.ui.DefaultUI")],b)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/cast ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e){b=function(l){function g(){var c=l.apply(this,arguments)||this;c.widget=null;return c}a._inheritsLoose(g,l);var d=g.prototype;d.destroy=function(){this.widget&&this.widget.destroy();this.node=null};d.castNode=function(c){if(!c)return this._set("widget",null),null;if("string"===typeof c||c&&"nodeType"in c)return this._set("widget",null),r.byId(c);c&&"function"===typeof c.render&&!c.domNode&&(c.domNode=document.createElement("div"));this._set("widget",c);return c.domNode};
a._createClass(g,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(c){const u=this._get("node");c!==u&&(c&&c.classList.add("esri-component"),u&&u.classList.remove("esri-component"),this._set("node",c))}}]);return g}(b);p.__decorate([q.property({dependsOn:[]})],b.prototype,"id",null);p.__decorate([q.property()],b.prototype,"node",null);p.__decorate([f.cast("node")],b.prototype,"castNode",null);p.__decorate([q.property({readOnly:!0})],b.prototype,
"widget",void 0);return b=p.__decorate([e.subclass("esri.views.ui.Component")],b)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/cast ../../core/Logger ../../core/accessorSupport/decorators/subclass ./Component ../../widgets/support/widgetUtils".split(" "),function(a,
p,b,r,q,y,f,w,e,l,g,d,c){function u(n){return"object"!==typeof n||n instanceof d||"declaredClass"in n||!("component"in n||"index"in n||"position"in n)?null:n}function t(n,{top:z,bottom:k,left:v,right:x}){n.style.top=z;n.style.bottom=k;n.style.left=v;n.style.right=x}const h={left:0,top:0,bottom:0,right:0},m={bottom:30,top:15,right:15,left:15};r=function(n){function z(v){v=n.call(this,v)||this;v._cornerNameToContainerLookup={};v._positionNameToContainerLookup={};v._components=[];v._componentToKey=new Map;
v._handles=new q;v.view=null;v._initContainers();return v}a._inheritsLoose(z,n);var k=z.prototype;k.initialize=function(){this._handles.add([y.init(this,"view.padding, container",this._applyViewPadding.bind(this)),y.init(this,"padding",this._applyUIPadding.bind(this))])};k.destroy=function(){this.container=null;for(const v of this._components)v.destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};k.castPadding=function(v){return"number"===typeof v?{bottom:v,top:v,
right:v,left:v}:{...m,...v}};k.add=function(v,x){let C,A;if(Array.isArray(v))v.forEach(D=>this.add(D,x));else{var B=u(v);B&&({index:C,position:x,component:v,key:A}=B);x&&"object"===typeof x&&({index:C,key:A,position:x}=x);!v||x&&!this._isValidPosition(x)||this._add(v,x,C,A)}};k.remove=function(v,x){if(v){if(Array.isArray(v))return v.map(B=>this.remove(B,x));var C=this._find(v);if(C){var A=this._componentToKey;if(!A.has(v)||A.get(v)===x)return A=this._components.indexOf(C),C.node.parentNode&&C.node.parentNode.removeChild(C.node),
this._componentToKey.delete(v),this._components.splice(A,1)[0]}}};k.empty=function(v){if(Array.isArray(v))return v.map(x=>this.empty(x)).reduce((x,C)=>x.concat(C));v=v||"manual";return"manual"===v?Array.prototype.slice.call(this._manualContainer.children).filter(x=>!x.classList.contains("esri-ui-corner")).map(x=>this.remove(x)):this._isValidPosition(v)?Array.prototype.slice.call(this._cornerNameToContainerLookup[v].children).map(this.remove,this):null};k.move=function(v,x){Array.isArray(v)&&v.forEach(B=>
this.move(B,x));if(v){var C=u(v)||u(x);if(C){var A=C.index;x=C.position;v=C.component||v}(!x||this._isValidPosition(x))&&(v=this.remove(v))&&this.add(v,{position:x,index:A})}};k.find=function(v){return v?(v=this._findById(v))&&(v.widget||v.node):null};k.getPosition=function(v){for(const x in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[x].contains(v))return x;return null};k._add=function(v,x,C,A){v instanceof d||(v=new d({node:v}));this._place({component:v,position:x,
index:C});this._components.push(v);A&&this._componentToKey.set(v,A)};k._find=function(v){return v?v instanceof d?this._findByComponent(v):"string"===typeof v?this._findById(v):this._findByNode(v.domNode||v):null};k._getViewPadding=function(){return this.get("view.padding")||h};k._attachContainers=function(v){v.appendChild(this._innerContainer);v.appendChild(this._manualContainer)};k._initContainers=function(){var v=document.createElement("div");v.classList.add("esri-ui-inner-container");v.classList.add("esri-ui-corner-container");
const x=document.createElement("div");x.classList.add("esri-ui-inner-container");x.classList.add("esri-ui-manual-container");const C=document.createElement("div");C.classList.add("esri-ui-top-left");C.classList.add("esri-ui-corner");v.appendChild(C);const A=document.createElement("div");A.classList.add("esri-ui-top-right");A.classList.add("esri-ui-corner");v.appendChild(A);const B=document.createElement("div");B.classList.add("esri-ui-bottom-left");B.classList.add("esri-ui-corner");v.appendChild(B);
const D=document.createElement("div");D.classList.add("esri-ui-bottom-right");D.classList.add("esri-ui-corner");v.appendChild(D);this._innerContainer=v;this._manualContainer=x;v=c.isRTL();this._cornerNameToContainerLookup={"top-left":C,"top-right":A,"bottom-left":B,"bottom-right":D,"top-leading":v?A:C,"top-trailing":v?C:A,"bottom-leading":v?D:B,"bottom-trailing":v?B:D};this._positionNameToContainerLookup={manual:x,...this._cornerNameToContainerLookup}};k._isValidPosition=function(v){return!!this._positionNameToContainerLookup[v]};
k._place=function(v){const x=v.component,C=v.index;v=this._positionNameToContainerLookup[v.position||"manual"];var A=-1<C,B=x.widget;B&&!B._started&&"function"===typeof B.postMixInProperties&&"function"===typeof B.buildRendering&&"function"===typeof B.postCreate&&"function"===typeof B.startup&&x.widget.startup();A?(A=Array.prototype.slice.call(v.children),0===C?v.firstChild?b.insertBefore(x.node,v.firstChild):v.appendChild(x.node):C>=A.length?v.appendChild(x.node):b.insertBefore(x.node,A[C])):v.appendChild(x.node)};
k._applyViewPadding=function(){const v=this.container;v&&t(v,this._toPxPosition(this._getViewPadding()))};k._applyUIPadding=function(){const v=this._innerContainer;v&&t(v,this._toPxPosition(this.padding))};k._toPxPosition=function(v){return{top:this._toPxUnit(v.top),left:this._toPxUnit(v.left),right:this._toPxUnit(v.right),bottom:this._toPxUnit(v.bottom)}};k._toPxUnit=function(v){return 0===v?"0":v+"px"};k._findByComponent=function(v){let x=null,C;this._components.some(A=>{(C=A===v)&&(x=A);return C});
return x};k._findById=function(v){let x=null,C;this._components.some(A=>{(C=A.id===v)&&(x=A);return C});return x};k._findByNode=function(v){let x=null,C;this._components.some(A=>{(C=A.node===v)&&(x=A);return C});return x};a._createClass(z,[{key:"container",set:function(v){const x=this._get("container");v!==x&&(v&&(v.classList.add("esri-ui"),v.classList.add(c.getCalciteThemeClass()),this._attachContainers(v)),x&&(x.classList.remove("esri-ui"),t(x,{top:"",bottom:"",left:"",right:""}),b.empty(x)),this._set("container",
v))}},{key:"height",get:function(){const v=this.get("view.height")||0;if(0===v)return v;const x=this._getViewPadding();return Math.max(v-(x.top+x.bottom),0)}},{key:"padding",get:function(){return this._get("padding")},set:function(v){v?this._override("padding",v):this._clearOverride("padding")}},{key:"width",get:function(){const v=this.get("view.width")||0;if(0===v)return v;const x=this._getViewPadding();return Math.max(v-(x.left+x.right),0)}}]);return z}(r.EventedAccessor);p.__decorate([f.property()],
r.prototype,"container",null);p.__decorate([f.property()],r.prototype,"height",null);p.__decorate([f.property({value:m})],r.prototype,"padding",null);p.__decorate([e.cast("padding")],r.prototype,"castPadding",null);p.__decorate([f.property()],r.prototype,"view",void 0);p.__decorate([f.property()],r.prototype,"width",null);return r=p.__decorate([g.subclass("esri.views.ui.UI")],r)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){q=function(h){function m(z,k){z=h.call(this,z,k)||this;z._isOpen=!1;z._attributionTextOverflowed=!1;z._prevSourceNodeHeight=0;z.iconClass="esri-icon-description";z.itemDelimiter=" | ";z.label=void 0;z.messages=null;z.view=null;z.viewModel=new g;return z}a._inheritsLoose(m,h);var n=m.prototype;n.initialize=function(){this.own(b.on(this,"viewModel.items","change",()=>this.scheduleRender()))};n.render=function(){return u.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",
{["esri-attribution--open"]:this._isOpen}),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};n.renderPoweredBy=function(){return u.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",u.tsx("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))};n.renderSourcesNode=function(){const z=this._isOpen,k=this._isInteractive(),v=k?0:-1,{attributionText:x}=this,C=k?"button":void 0;return u.tsx("div",
{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:z,["esri-interactive"]:k}),innerHTML:x,role:C,tabIndex:v})};n._afterSourcesNodeCreate=function(z){this._prevSourceNodeHeight=z.clientWidth};n._afterSourcesNodeUpdate=function(z){let k=!1;const {clientHeight:v,clientWidth:x,scrollWidth:C}=z;z=C>=x;const A=this._attributionTextOverflowed!==z;this._attributionTextOverflowed=z;
A&&(k=!0);this._isOpen&&(z=v<this._prevSourceNodeHeight,this._prevSourceNodeHeight=v,z&&(this._isOpen=!1,k=!0));k&&this.scheduleRender()};n._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};n._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};a._createClass(m,[{key:"attributionText",get:function(){return this.viewModel.items.reduce((z,k)=>{-1===z.indexOf(k.text)&&z.push(k.text);return z},[]).join(this.itemDelimiter)}}]);return m}(l);p.__decorate([w.property({readOnly:!0,
dependsOn:["viewModel.items.length","itemDelimiter"]})],q.prototype,"attributionText",null);p.__decorate([w.property()],q.prototype,"iconClass",void 0);p.__decorate([w.property()],q.prototype,"itemDelimiter",void 0);p.__decorate([w.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],q.prototype,"label",void 0);p.__decorate([w.property(),c.messageBundle("esri/widgets/Attribution/t9n/Attribution")],q.prototype,"messages",void 0);p.__decorate([r.aliasOf("viewModel.view")],q.prototype,
"view",void 0);p.__decorate([w.property({type:g})],q.prototype,"viewModel",void 0);p.__decorate([d.accessibleHandler()],q.prototype,"_toggleState",null);return q=p.__decorate([e.subclass("esri.widgets.Attribution")],q)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/SpatialReference".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){function h(k,v){return k&&"copyright"in k&&(!v||"function"===typeof k.originOf&&"user"===k.originOf("copyright"))}function m(k,v){return k.length!==v.length||k.some((x,C)=>x.text!==v[C].text)}function n(k,v,x){x&&v&&(k.find(C=>C.layerView===v&&C.text===x)||k.push({text:x,layerView:v}))}const z=[];b=function(k){function v(C){var A=k.call(this,C)||this;A.clear=()=>{A._fetchedAttributionData.clear();A._pendingAttributions.clear();A.handles.remove("suspension");
A.notifyChange("state")};A._pendingAttributions=new Set;A._fetchedAttributionData=new Map;A.items=new q;A.view=null;A._allLayerViewsChange=B=>{A.handles.remove("suspension");const D=A.get("view.allLayerViews");D&&A.handles.add(D.map(E=>E.watch(["suspended","attributionVisible"],A._updateAttributionItems)),"suspension");B&&B.removed&&B.removed.forEach(E=>{A._pendingAttributions.delete(E);A._fetchedAttributionData.delete(E)});A._updateAttributionItems()};A._updateAttributionItems=()=>{const B=A.get("view.allLayerViews");
z.length=0;B?(B.forEach(D=>{if(!D.suspended&&D.get("layer.attributionVisible")){var E=D.layer;if(h(E,"user"))n(z,D,E.copyright);else if(E.hasAttributionData)if(A._fetchedAttributionData.has(D)){var G=A._fetchedAttributionData.get(D);G?n(z,D,A._getDynamicAttribution(G,A.view,E)):h(E)&&n(z,D,E.copyright)}else A._fetchAttributionData(D);else(G=E.get("portalItem.accessInformation"))?n(z,D,G):n(z,D,E.copyright)}}),m(A.items,z)&&(A.items.removeAll(),A.items.addMany(z)),z.length=0,A.notifyChange("state")):
A.clear()};A.handles.add([f.on(a._assertThisInitialized(A),"view.allLayerViews","change",A._allLayerViewsChange,A._allLayerViewsChange,A.clear),f.whenTrue(a._assertThisInitialized(A),"view.stationary",()=>A._updateAttributionItems())]);return A}a._inheritsLoose(v,k);var x=v.prototype;x.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};x._fetchAttributionData=function(){var C=a._asyncToGenerator(function*(A){if(!this._pendingAttributions.has(A)){this._pendingAttributions.add(A);
var B=yield r.result(A.layer.fetchAttributionData());this._pendingAttributions.has(A)&&(B=B.ok?this._createContributionIndex(B.value,"bing-maps"===A.layer.type):null,this._pendingAttributions.delete(A),this._fetchedAttributionData.set(A,B));this._updateAttributionItems()}});return function(A){return C.apply(this,arguments)}}();x._createContributionIndex=function(C,A){C=C.contributors;const B={};if(!C)return B;for(let K=0;K<C.length;K++){const M=C[K];var D=M.coverageAreas;if(!D)return;for(const H of D){var E=
H.bbox,G=H.zoomMin-(A&&H.zoomMin?1:0);D=H.zoomMax-(A&&H.zoomMax?1:0);for(E={extent:u.geographicToWebMercator({xmin:E[1],ymin:E[0],xmax:E[3],ymax:E[2],spatialReference:t.WGS84}),attribution:M.attribution||"",score:null!=H.score?H.score:100,id:K};G<=D;G++)B[G]=B[G]||[],B[G].push(E)}}B.maxKey=Math.max.apply(null,Object.keys(B));return B};x._getDynamicAttribution=function(C,A,B){const {extent:D,scale:E}=A;B=B.tileInfo.scaleToZoom(E);B=Math.min(C.maxKey,Math.round(B));if(!D||null==B||-1>=B)return"";C=
C[B];const G=u.project(D.center.clone().normalize(),A.spatialReference),K={};return C?C.filter(M=>{const H=!K[M.id]&&G&&c.extentContainsPoint(M.extent,G);H&&(K[M.id]=!0);return H}).sort((M,H)=>H.score-M.score||M.objectId-H.objectId).map(M=>M.attribution).join(", "):""};a._createClass(v,[{key:"state",get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return v}(y.HandleOwner);p.__decorate([w.property({readOnly:!0,type:q})],b.prototype,"items",
void 0);p.__decorate([w.property({readOnly:!0})],b.prototype,"state",null);p.__decorate([w.property()],b.prototype,"view",void 0);return b=p.__decorate([d.subclass("esri.widgets.Attribution.AttributionViewModel")],b)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){r=function(t){function h(n,z){n=t.call(this,n,z)||this;n.goToOverride=null;n.iconClass="esri-icon-locate-circled";n.label=void 0;n.messages=null;n.view=null;n.viewModel=new l;return n}a._inheritsLoose(h,t);var m=h.prototype;m.reset=function(){return this.viewModel.reset()};m.render=function(){const {orientation:n,state:z}=this.viewModel;var k="disabled"===z,v="compass"===("rotation"===z?"rotation":"compass");const x=k?-1:0;k={["esri-disabled"]:k,["esri-interactive"]:!k};
v={["esri-icon-compass"]:v,["esri-icon-dial"]:!v};const {messages:C}=this;return c.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",k),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:x,"aria-label":C.reset,title:C.reset},c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",v),styles:this._toRotationTransform(n)}),c.tsx("span",{class:"esri-icon-font-fallback-text"},C.reset))};m._reset=function(){this.viewModel.reset()};m._toRotationTransform=
function(n){return{transform:`rotateZ(${n.z}deg)`}};return h}(e);p.__decorate([b.aliasOf("viewModel.goToOverride")],r.prototype,"goToOverride",void 0);p.__decorate([f.property()],r.prototype,"iconClass",void 0);p.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],r.prototype,"label",void 0);p.__decorate([f.property(),d.messageBundle("esri/widgets/Compass/t9n/Compass")],r.prototype,"messages",void 0);p.__decorate([b.aliasOf("viewModel.view")],r.prototype,"view",void 0);
p.__decorate([f.property({type:l})],r.prototype,"viewModel",void 0);p.__decorate([g.accessibleHandler()],r.prototype,"_reset",null);return r=p.__decorate([w.subclass("esri.widgets.Compass")],r)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../support/GoTo".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){b=function(d){function c(t){t=d.call(this,t)||this;t._handles=new r;t.orientation={x:0,y:0,z:0};t.view=null;t._updateForCamera=t._updateForCamera.bind(a._assertThisInitialized(t));t._updateForRotation=t._updateForRotation.bind(a._assertThisInitialized(t));t._updateRotationWatcher=t._updateRotationWatcher.bind(a._assertThisInitialized(t));return t}a._inheritsLoose(c,d);var u=c.prototype;u.initialize=function(){this._handles.add(q.init(this,"view",this._updateRotationWatcher))};
u.destroy=function(){this._handles.destroy();this.view=this._handles=null};u.reset=function(){if(this.get("view.ready")){var t={};"2d"===this.view.type?t.rotation=0:t.heading=0;this.callGoTo({target:t})}};u._updateForRotation=function(t){void 0!==t&&null!==t&&(this.orientation={z:t})};u._updateForCamera=function(t){t&&(this.orientation={x:0,y:0,z:-t.heading})};u._updateRotationWatcher=function(t){this._handles.removeAll();t&&("2d"===t.type?this._handles.add(q.init(this,"view.rotation",this._updateForRotation)):
this._handles.add(q.init(this,"view.camera",this._updateForCamera)))};a._createClass(c,[{key:"canShowNorth",get:function(){const t=this.get("view.spatialReference");return!(!t||!t.isWebMercator&&!t.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return c}(g.GoToMixin(b));p.__decorate([y.property({readOnly:!0})],b.prototype,"canShowNorth",null);p.__decorate([y.property()],b.prototype,"orientation",void 0);p.__decorate([y.property({readOnly:!0})],
b.prototype,"state",null);p.__decorate([y.property()],b.prototype,"view",void 0);return b=p.__decorate([l.subclass("esri.widgets.CompassViewModel")],b)})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){r=function(t){function h(n,z){n=t.call(this,n,z)||this;n.iconClass="esri-icon-pan2";n.label=void 0;n.messages=null;n.view=null;n.viewModel=new l;return n}a._inheritsLoose(h,t);var m=h.prototype;m.toggle=function(){return this.viewModel.toggle()};m.render=function(){const n="disabled"===this.get("viewModel.state");var z="pan"===this.get("viewModel.navigationMode");const k={["esri-navigation-toggle__button--active"]:z};z={["esri-navigation-toggle__button--active"]:!z};
const v=n?-1:0,x=this.messages.toggle;return c.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{["esri-disabled"]:n,["esri-navigation-toggle--horizontal"]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:v,"aria-label":x,title:x},c.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",k)},c.tsx("span",{class:"esri-icon-pan"})),c.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",z)},c.tsx("span",{class:"esri-icon-rotate"})))};m._toggle=function(){this.toggle()};a._createClass(h,[{key:"layout",set:function(n){"horizontal"!==n&&(n="vertical");this._set("layout",n)}}]);return h}(e);p.__decorate([f.property()],r.prototype,"iconClass",void 0);p.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],r.prototype,"label",void 0);p.__decorate([f.property({value:"vertical"})],r.prototype,"layout",null);p.__decorate([f.property(),
d.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],r.prototype,"messages",void 0);p.__decorate([b.aliasOf("viewModel.view")],r.prototype,"view",void 0);p.__decorate([f.property({type:l})],r.prototype,"viewModel",void 0);p.__decorate([g.accessibleHandler()],r.prototype,"_toggle",null);return r=p.__decorate([w.subclass("esri.widgets.NavigationToggle")],r)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e,l){b=function(g){function d(u){u=g.call(this,u)||this;u._handles=new r;u.navigationMode="pan";u.view=null;return u}a._inheritsLoose(d,g);var c=d.prototype;c.initialize=function(){this._handles.add(q.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};c.destroy=function(){this._handles.destroy();this.view=this._handles=null};c.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};
c._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a._createClass(d,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}}]);return d}(b);p.__decorate([y.property({readOnly:!0})],b.prototype,"state",null);p.__decorate([y.property()],b.prototype,"navigationMode",void 0);p.__decorate([y.property()],b.prototype,"view",void 0);return b=p.__decorate([l.subclass("esri.widgets.NavigationToggleViewModel")],
b)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){r=function(t){function h(n,z){n=
t.call(this,n,z)||this;n.iconClass="esri-icon-zoom-in-magnifying-glass";n.label=void 0;n.messages=null;n.view=null;n.viewModel=new u;return n}a._inheritsLoose(h,t);var m=h.prototype;m.initialize=function(){this._zoomInButton=new c({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new c({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};m.destroy=function(){this._zoomInButton.destroy();this._zoomOutButton.destroy();this._zoomOutButton=this._zoomInButton=null};
m.render=function(){const n=this.viewModel,z={["esri-zoom--horizontal"]:"horizontal"===this.layout};this._zoomInButton.enabled="ready"===n.state&&n.canZoomIn;this._zoomOutButton.enabled="ready"===n.state&&n.canZoomOut;this._zoomInButton.title=this.messages.zoomIn;this._zoomOutButton.title=this.messages.zoomOut;return d.tsx("div",{class:this.classes("esri-zoom esri-widget",z)},this._zoomInButton.render(),this._zoomOutButton.render())};m.zoomIn=function(){return this.viewModel.zoomIn()};m.zoomOut=function(){return this.viewModel.zoomOut()};
a._createClass(h,[{key:"layout",set:function(n){"horizontal"!==n&&(n="vertical");this._set("layout",n)}}]);return h}(e);p.__decorate([f.property()],r.prototype,"iconClass",void 0);p.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],r.prototype,"label",void 0);p.__decorate([f.property({value:"vertical"})],r.prototype,"layout",null);p.__decorate([f.property(),g.messageBundle("esri/widgets/Zoom/t9n/Zoom")],r.prototype,"messages",void 0);p.__decorate([b.aliasOf("viewModel.view")],
r.prototype,"view",void 0);p.__decorate([f.property({type:u})],r.prototype,"viewModel",void 0);return r=p.__decorate([w.subclass("esri.widgets.Zoom")],r)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../Widget ../support/decorators/accessibleHandler ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){r=function(d){function c(){var t=d.apply(this,arguments)||this;t.enabled=!0;t.iconClass="";t.title="";return t}a._inheritsLoose(c,d);var u=c.prototype;u.render=function(){const t=this.enabled?0:-1,h={[this.iconClass]:!!this.iconClass};return l.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:t,
title:this.title},l.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",h)}),l.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};u._triggerAction=function(){this.action.call(this)};return c}(w);p.__decorate([b.property()],r.prototype,"action",void 0);p.__decorate([b.property()],r.prototype,"enabled",void 0);p.__decorate([b.property()],r.prototype,"iconClass",void 0);p.__decorate([b.property()],r.prototype,"title",void 0);p.__decorate([e.accessibleHandler()],
r.prototype,"_triggerAction",null);return r=p.__decorate([f.subclass("esri.widgets.IconButton")],r)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,p,b,r,q,y,f,w,
e,l,g){b=function(d){function c(t){t=d.call(this,t)||this;t.canZoomIn=!1;t.canZoomOut=!1;return t}a._inheritsLoose(c,d);var u=c.prototype;u.destroy=function(){this.view=null};u.zoomIn=function(){if(this.canZoomIn){var t=this.view;"2d"===t.type?t.mapViewNavigation.zoomIn():r.ignoreAbortErrors(t.goTo({zoomFactor:2}))}};u.zoomOut=function(){if(this.canZoomOut){var t=this.view;"2d"===t.type?t.mapViewNavigation.zoomOut():r.ignoreAbortErrors(t.goTo({zoomFactor:.5}))}};a._createClass(c,[{key:"state",get:function(){return this.get("view.ready")?
"ready":"disabled"}},{key:"view",set:function(t){t?"2d"===t.type?this._zoomConditions=new l({view:t}):"3d"===t.type&&(this._zoomConditions=new g({view:t})):this._zoomConditions=null;this._set("view",t)}}]);return c}(b);p.__decorate([q.property()],b.prototype,"_zoomConditions",void 0);p.__decorate([q.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],b.prototype,"canZoomIn",void 0);p.__decorate([q.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],b.prototype,"canZoomOut",void 0);
p.__decorate([q.property({readOnly:!0})],b.prototype,"state",null);p.__decorate([q.property()],b.prototype,"view",null);return b=p.__decorate([e.subclass("esri.widgets.Zoom.ZoomViewModel")],b)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w){b=function(e){function l(){return e.apply(this,arguments)||this}a._inheritsLoose(l,e);a._createClass(l,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const g=this.get("view.animation.target.scale")||this.get("view.scale"),d=this.get("view.constraints.effectiveMaxScale");return 0===d||g>d}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const g=this.get("view.animation.target.scale")||this.get("view.scale"),d=this.get("view.constraints.effectiveMinScale");
return 0===d||g<d}}]);return l}(b);p.__decorate([r.property({readOnly:!0})],b.prototype,"canZoomIn",null);p.__decorate([r.property({readOnly:!0})],b.prototype,"canZoomOut",null);p.__decorate([r.property()],b.prototype,"view",void 0);return b=p.__decorate([w.subclass("esri.widgets.Zoom.ZoomConditions2D")],b)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w){b=function(e){function l(){return e.apply(this,arguments)||this}a._inheritsLoose(l,e);a._createClass(l,[{key:"canZoomIn",get:function(){return!!this.get("view.ready")}},{key:"canZoomOut",get:function(){return!!this.get("view.ready")}}]);return l}(b);p.__decorate([r.property({readOnly:!0})],b.prototype,"canZoomIn",null);p.__decorate([r.property({readOnly:!0})],b.prototype,"canZoomOut",null);p.__decorate([r.property()],b.prototype,"view",void 0);return b=p.__decorate([w.subclass("esri.widgets.Zoom.ZoomConditions3D")],
b)})},"esri/layers/SceneLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/watchUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/utils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/capabilities ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/RangeInfo ../renderers/support/styleUtils ../rest/support/Query ../support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N,R,S,P,Q,V,ca,ba,Z,ha,fa,aa,W,U,X){const T=["3DObject","Point"],Y=h.getLogger("esri.layers.SceneLayer");q=P.defineFieldProperties();n=function(la){function pa(...wa){wa=la.call(this,...wa)||this;wa.featureReduction=null;wa.rangeInfos=null;wa.operationalLayerType="ArcGISSceneServiceLayer";wa.type="scene";wa.fields=null;wa.floorInfo=null;wa.outFields=null;wa.nodePages=null;wa.materialDefinitions=null;wa.textureSetDefinitions=
null;wa.geometryDefinitions=null;wa.serviceUpdateTimeStamp=null;wa.definitionExpression=null;wa.path=null;wa.labelsVisible=!0;wa.labelingInfo=null;wa.legendEnabled=!0;wa.cachedDrawingInfo={color:!1};wa.popupEnabled=!0;wa.popupTemplate=null;wa.objectIdField=null;wa.globalIdField=null;wa._fieldUsageInfo={};wa.screenSizePerspectiveEnabled=!0;return wa}p._inheritsLoose(pa,la);var ua=pa.prototype;ua.normalizeCtorArgs=function(wa,Fa){return"string"===typeof wa?{url:wa,...Fa}:wa};ua.getField=function(wa){return this.fieldsIndex.get(wa)};
ua.getFieldDomain=function(wa,Fa){var La,Ma,Sa,Ia;return(Fa=null==(La=this.getFeatureType(null==Fa?void 0:Fa.feature))?void 0:null==(Ma=La.domains)?void 0:Ma[wa])&&"inherited"!==Fa.type?Fa:null!=(Sa=null==(Ia=this.getField(wa))?void 0:Ia.domain)?Sa:null};ua.getFeatureType=function(wa){return wa&&m.isSome(this.associatedLayer)?this.associatedLayer.getFeatureType(wa):null};ua.readNodePages=function(wa,Fa,La){"Point"===Fa.layerType&&(wa=Fa.pointNodePages);return null==wa||"object"!==typeof wa?null:ca.I3SNodePageDefinition.fromJSON(wa,
La)};ua.readCachedDrawingInfo=function(wa){if(null==wa||"object"!==typeof wa)wa={};null==wa.color&&(wa.color=!1);return wa};ua.readObjectIdField=function(wa,Fa){!wa&&Fa.fields&&Fa.fields.some(La=>{"esriFieldTypeOID"===La.type&&(wa=La.name);return!!wa});return wa||void 0};ua.readGlobalIdField=function(wa,Fa){!wa&&Fa.fields&&Fa.fields.some(La=>{"esriFieldTypeGlobalID"===La.type&&(wa=La.name);return!!wa});return wa||void 0};ua.readProfile=function(wa,Fa){wa=Fa.store.profile;if(null!=wa&&ea[wa])return ea[wa];
Y.error("Unknown or missing profile",{profile:wa,layer:this});return"mesh-pyramids"};ua.load=function(wa){const Fa=m.isSome(wa)?wa.signal:null,La=this.loadFromPortal({supportedTypes:["Scene Service"]},wa).catch(z.throwIfAbortError).then(()=>this._fetchService(Fa)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,Fa),this._setAssociatedFeatureLayer(Fa)])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>
aa.loadStyleRenderer(this,{origin:"service"},Fa)).then(()=>V.fixRendererFields(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(wa));this.addResolvingPromise(La);return Promise.resolve(this)};ua.createQuery=function(){const wa=new W;"mesh"!==this.geometryType&&(wa.returnGeometry=!0,wa.returnZ=!0);wa.where=this.definitionExpression||"1\x3d1";wa.sqlFormat="standard";return wa};ua.queryExtent=function(wa,Fa){return this._getAssociatedLayerForQuery().then(La=>La.queryExtent(wa||
this.createQuery(),Fa))};ua.queryFeatureCount=function(wa,Fa){return this._getAssociatedLayerForQuery().then(La=>La.queryFeatureCount(wa||this.createQuery(),Fa))};ua.queryFeatures=function(wa,Fa){return this._getAssociatedLayerForQuery().then(La=>La.queryFeatures(wa||this.createQuery(),Fa)).then(La=>{if(null!=La&&La.features)for(const Ma of La.features)Ma.layer=this,Ma.sourceLayer=this;return La})};ua.queryObjectIds=function(wa,Fa){return this._getAssociatedLayerForQuery().then(La=>La.queryObjectIds(wa||
this.createQuery(),Fa))};ua.queryAttachments=function(wa,Fa){return this._getAssociatedLayerForQuery().then(La=>La.queryAttachments(wa,Fa))};ua.getFieldUsageInfo=function(wa){const Fa={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[wa]||Fa:(Y.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),Fa)};ua.createPopupTemplate=function(wa){return U.createPopupTemplate(this,wa)};ua._getAssociatedLayerForQuery=
function(){const wa=this.associatedLayer;return m.isSome(wa)&&wa.loaded?Promise.resolve(wa):this._loadAssociatedLayerForQuery()};ua._loadAssociatedLayerForQuery=function(){var wa=p._asyncToGenerator(function*(){yield this.load();if(m.isNone(this.associatedLayer))throw new t("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{yield this.associatedLayer.load()}catch(Fa){throw new t("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",
{layer:this,error:Fa});}return this.associatedLayer});return function(){return wa.apply(this,arguments)}}();ua.hasCachedStatistics=function(wa){return null!=this.statisticsInfo&&this.statisticsInfo.some(Fa=>Fa.name===wa)};ua.queryCachedStatistics=function(){var wa=p._asyncToGenerator(function*(Fa,La){yield this.load(La);if(!this.statisticsInfo)throw new t("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const Ma=this.fieldsIndex.get(Fa);if(!Ma)throw new t("scenelayer:field-unexisting",
`Field '${Fa}' does not exist on the layer`);for(const Sa of this.statisticsInfo)if(Sa.name===Ma.name)return Fa=k.join(this.parsedUrl.path,Sa.href),u(Fa,{query:{f:"json",token:this.apiKey},responseType:"json",signal:La?La.signal:null}).then(Ia=>Ia.data);throw new t("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");});return function(Fa,La){return wa.apply(this,arguments)}}();ua.saveAs=function(){var wa=p._asyncToGenerator(function*(Fa,La){return this._debouncedSaveOperations(1,
{...La,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},Fa)});return function(Fa,La){return wa.apply(this,arguments)}}();ua.save=function(){var wa=p._asyncToGenerator(function*(){return this._debouncedSaveOperations(0,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})});return function(){return wa.apply(this,arguments)}}();ua.applyEdits=function(){var wa=p._asyncToGenerator(function*(Fa,La){const Ma=yield new Promise(function(Sa,Ia){a(["./graphics/editingSupport"],
Sa,Ia)});yield this.load();if(m.isNone(this.associatedLayer))throw new t(`${this.type}-layer:not-editable`,"Service is not editable");yield this.associatedLayer.load();return Ma.applyEdits(this,this.associatedLayer.source,Fa,La)});return function(Fa,La){return wa.apply(this,arguments)}}();ua.on=function(wa,Fa){return la.prototype.on.call(this,wa,Fa)};ua.validateLayer=function(wa){if(wa.layerType&&-1===T.indexOf(wa.layerType))throw new t("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",
{layerType:wa.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new t("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new t("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});{wa=this.normalReferenceFrame;var Fa=this.spatialReference;let La=!1,Ma=!1;if(null==wa)Ma=La=!0;else switch(Fa=
Fa&&Fa.isGeographic,wa){case "east-north-up":case "earth-centered":La=!0;Ma=Fa;break;case "vertex-reference-frame":La=!0;Ma=!Fa;break;default:La=!1}if(!La)throw new t("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!Ma)throw new t("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");}};ua._getTypeKeywords=function(){const wa=[];if("points"===this.profile)wa.push("Point");else if("mesh-pyramids"===
this.profile)wa.push("3DObject");else throw new t("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return wa};ua._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(const wa of this.fields){const Fa=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(Ma=>Ma.name===wa.name)),La=!!(m.isSome(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(Ma=>Ma&&wa.name===Ma.name));this._fieldUsageInfo[wa.name]=
{supportsLabelingInfo:Fa,supportsRenderer:Fa,supportsPopupTemplate:Fa||La,supportsLayerQuery:La}}};ua._applyAssociatedLayerOverrides=function(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides()};ua._applyAssociatedLayerFieldsOverrides=function(){if(!m.isNone(this.associatedLayer)&&this.associatedLayer.fields){var wa=null;for(const Fa of this.associatedLayer.fields){const La=this.getField(Fa.name);La?(!La.domain&&Fa.domain&&(La.domain=Fa.domain.clone()),La.editable=
Fa.editable,La.nullable=Fa.nullable,La.length=Fa.length):(wa||(wa=this.fields?this.fields.slice():[]),wa.push(Fa.clone()))}wa&&this._set("fields",wa)}};ua._applyAssociatedLayerPopupOverrides=function(){if(!m.isNone(this.associatedLayer)){var wa=["popupTemplate","popupEnabled"],Fa=A.getProperties(this);for(let La=0;La<wa.length;La++){const Ma=wa[La],Sa=this.originIdOf(Ma),Ia=this.associatedLayer.originIdOf(Ma);Sa<Ia&&(2===Ia||3===Ia)&&Fa.setAtOrigin(Ma,this.associatedLayer[Ma],Ia)}}};ua._setAssociatedFeatureLayer=
function(){var wa=p._asyncToGenerator(function*(Fa){if(-1!==["mesh-pyramids","points"].indexOf(this.profile)){Fa=new S.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,this.apiKey,Fa);try{this.associatedLayer=yield Fa.fetch()}catch(La){z.isAbortError(La)||this._logWarningOnPopupEnabled()}}});return function(Fa){return wa.apply(this,arguments)}}();ua._logWarningOnPopupEnabled=function(){v.whenValidOnce(this,["popupTemplate","popupEnabled"],()=>this.popupEnabled&&null!=this.popupTemplate).then(()=>
()=>{const wa=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?Y.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${wa}`):Y.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${wa}`)})};ua._validateElevationInfo=function(){const wa=this.elevationInfo;wa&&("mesh-pyramids"===this.profile&&"absolute-height"!==wa.mode&&Y.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),
wa.featureExpressionInfo&&"0"!==wa.featureExpressionInfo.expression&&Y.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};p._createClass(pa,[{key:"types",get:function(){return m.isSome(this.associatedLayer)?this.associatedLayer.types:[]}},{key:"typeIdField",get:function(){return m.isSome(this.associatedLayer)?this.associatedLayer.typeIdField:null}},{key:"formTemplate",get:function(){return m.isSome(this.associatedLayer)?this.associatedLayer.formTemplate:null}},{key:"fieldsIndex",
get:function(){return new Q(this.fields)}},{key:"elevationInfo",set:function(wa){this._set("elevationInfo",wa);this.loaded&&this._validateElevationInfo()}},{key:"geometryType",get:function(){return ia[this.profile]||"mesh"}},{key:"renderer",set:function(wa){V.fixRendererFields(wa,this.fieldsIndex);this._set("renderer",wa)}},{key:"capabilities",get:function(){var wa=m.isSome(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:F.zeroCapabilities;const {query:Fa,
editing:{supportsGlobalId:La,supportsRollbackOnFailure:Ma,supportsUploadWithItemId:Sa,supportsReturnServiceEditsInSourceSpatialReference:Ia},data:{supportsZ:va,supportsM:ma,isVersioned:ta,supportsAttachment:Ea},operations:{supportsEditing:Ca,supportsUpdate:ka,supportsQuery:sa,supportsQueryAttachments:Ja}}=wa;wa=wa.operations.supportsChangeTracking;return{query:Fa,editing:{supportsGlobalId:La,supportsReturnServiceEditsInSourceSpatialReference:Ia,supportsRollbackOnFailure:Ma,supportsGeometryUpdate:!1,
supportsUploadWithItemId:Sa},data:{supportsAttachment:Ea,supportsZ:va,supportsM:ma,isVersioned:ta},operations:{supportsQuery:sa,supportsQueryAttachments:Ja,supportsEditing:Ca&&wa,supportsAdd:!1,supportsDelete:!1,supportsUpdate:ka&&wa}}}},{key:"editingEnabled",get:function(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges},set:function(wa){null!=wa?this._override("editingEnabled",wa):this._clearOverride("editingEnabled")}},{key:"defaultPopupTemplate",
get:function(){return m.isSome(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}},{key:"displayField",get:function(){return m.isSome(this.associatedLayer)?this.associatedLayer.displayField:null}}]);return pa}(I.SceneService(M.ArcGISService(H.OperationalLayer(J.PortalLayer(O.ScaleRangeLayer(n.MultiOriginJSONMixin(K.APIKeyMixin(G))))))));b.__decorate([x.property({types:{key:"type",base:N["default"],typeMap:{selection:R}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",
write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],n.prototype,"featureReduction",void 0);b.__decorate([x.property({type:[fa["default"]],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],n.prototype,"rangeInfos",void 0);b.__decorate([x.property({json:{read:!1}})],n.prototype,"associatedLayer",void 0);b.__decorate([x.property({type:["show","hide"]})],n.prototype,"listMode",void 0);
b.__decorate([x.property({type:["ArcGISSceneServiceLayer"]})],n.prototype,"operationalLayerType",void 0);b.__decorate([x.property({json:{read:!1},readOnly:!0})],n.prototype,"type",void 0);b.__decorate([x.property({...q.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],n.prototype,"fields",void 0);b.__decorate([x.property()],n.prototype,"types",null);b.__decorate([x.property()],n.prototype,"typeIdField",null);b.__decorate([x.property()],n.prototype,"formTemplate",null);b.__decorate([x.property({readOnly:!0})],
n.prototype,"fieldsIndex",null);b.__decorate([x.property({type:ha,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],n.prototype,"floorInfo",void 0);b.__decorate([x.property(q.outFields)],n.prototype,"outFields",void 0);b.__decorate([x.property({type:ca.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],n.prototype,"nodePages",void 0);b.__decorate([D.reader("service","nodePages",["nodePages","pointNodePages"])],n.prototype,"readNodePages",null);b.__decorate([x.property({type:[ca.I3SMaterialDefinition],
readOnly:!0})],n.prototype,"materialDefinitions",void 0);b.__decorate([x.property({type:[ca.I3STextureSetDefinition],readOnly:!0})],n.prototype,"textureSetDefinitions",void 0);b.__decorate([x.property({type:[ca.I3SGeometryDefinition],readOnly:!0})],n.prototype,"geometryDefinitions",void 0);b.__decorate([x.property({readOnly:!0})],n.prototype,"serviceUpdateTimeStamp",void 0);b.__decorate([x.property({readOnly:!0})],n.prototype,"attributeStorageInfo",void 0);b.__decorate([x.property({readOnly:!0})],
n.prototype,"statisticsInfo",void 0);b.__decorate([x.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],n.prototype,"definitionExpression",void 0);b.__decorate([x.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],n.prototype,"path",void 0);b.__decorate([x.property(L.elevationInfo)],n.prototype,"elevationInfo",null);b.__decorate([x.property({type:String})],n.prototype,"geometryType",
null);b.__decorate([x.property(L.labelsVisible)],n.prototype,"labelsVisible",void 0);b.__decorate([x.property({type:[ba],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:Z.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:Z.reader},write:!0}})],n.prototype,"labelingInfo",void 0);b.__decorate([x.property(L.legendEnabled)],n.prototype,"legendEnabled",void 0);b.__decorate([x.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,
target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(la,pa){var ua,wa;if("number"===typeof la&&0<=la&&1>=la)return la;la=null==(ua=pa.layerDefinition)?void 0:null==(wa=ua.drawingInfo)?void 0:wa.transparency;return void 0!==la?X.transparencyToOpacity(la):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],n.prototype,"opacity",void 0);b.__decorate([x.property({types:c.webSceneRendererTypes,
json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],n.prototype,"renderer",null);b.__decorate([x.property({json:{read:!1}})],n.prototype,"cachedDrawingInfo",void 0);b.__decorate([D.reader("service","cachedDrawingInfo")],n.prototype,"readCachedDrawingInfo",null);b.__decorate([x.property({readOnly:!0,json:{read:!1}})],n.prototype,"capabilities",null);b.__decorate([x.property({type:Boolean,json:{read:!1}})],n.prototype,"editingEnabled",
null);b.__decorate([x.property(L.popupEnabled)],n.prototype,"popupEnabled",void 0);b.__decorate([x.property({type:r,json:{name:"popupInfo",write:!0}})],n.prototype,"popupTemplate",void 0);b.__decorate([x.property({readOnly:!0,json:{read:!1}})],n.prototype,"defaultPopupTemplate",null);b.__decorate([x.property({type:String,json:{read:!1}})],n.prototype,"objectIdField",void 0);b.__decorate([D.reader("service","objectIdField",["objectIdField","fields"])],n.prototype,"readObjectIdField",null);b.__decorate([x.property({type:String,
json:{read:!1}})],n.prototype,"globalIdField",void 0);b.__decorate([D.reader("service","globalIdField",["globalIdField","fields"])],n.prototype,"readGlobalIdField",null);b.__decorate([x.property({readOnly:!0,type:String,json:{read:!1}})],n.prototype,"displayField",null);b.__decorate([x.property({type:String,json:{read:!1}})],n.prototype,"profile",void 0);b.__decorate([D.reader("service","profile",["store.profile"])],n.prototype,"readProfile",null);b.__decorate([x.property({readOnly:!0,type:String,
json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],n.prototype,"normalReferenceFrame",void 0);b.__decorate([x.property(L.screenSizePerspectiveEnabled)],n.prototype,"screenSizePerspectiveEnabled",void 0);n=b.__decorate([E.subclass("esri.layers.SceneLayer")],n);const ea={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
ia={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return n})},"esri/layers/mixins/SceneService":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../../portal/Portal ../../portal/PortalItem ../../webdoc/support/saveUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D){const E=w.getLogger("esri.layers.mixins.SceneService"),G={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};p.SCENE_SERVICE_ITEM_TYPE="Scene Service";p.SceneService=K=>{K=function(M){function H(){var O=M.apply(this,arguments)||this;O.spatialReference=null;O.fullExtent=null;O.heightModelInfo=null;O.minScale=0;O.maxScale=0;O.version={major:Number.NaN,minor:Number.NaN,
versionString:""};O.copyright=null;O.sublayerTitleMode="item-title";O.title=null;O.layerId=null;O.indexInfo=null;O._debouncedSaveOperations=l.debounce(function(){var I=b._asyncToGenerator(function*(F,L,N){switch(F){case 0:return O._save(L);case 1:return O._saveAs(N,L)}});return function(F,L,N){return I.apply(this,arguments)}}());return O}b._inheritsLoose(H,M);var J=H.prototype;J.readSpatialReference=function(O,I){return this._readSpatialReference(I)};J._readSpatialReference=function(O){if(null!=O.spatialReference)return k.fromJSON(O.spatialReference);
O=O.store;O=(O=O.indexCRS||O.geographicCRS)&&parseInt(O.substring(O.lastIndexOf("/")+1,O.length),10);return null!=O?new k(O):null};J.readFullExtent=function(O,I,F){if(null!=O&&"object"===typeof O)return I=null==O.spatialReference?{...O,spatialReference:this._readSpatialReference(I)}:O,n.fromJSON(I,F);F=I.store;I=this._readSpatialReference(I);return null==I||null==F||null==F.extent||!Array.isArray(F.extent)||F.extent.some(L=>-1E38>L)?null:new n({xmin:F.extent[0],ymin:F.extent[1],xmax:F.extent[2],ymax:F.extent[3],
spatialReference:I})};J.readVersion=function(O,I){O=I.store;I=null!=O.version?O.version.toString():"";O={major:Number.NaN,minor:Number.NaN,versionString:I};I=I.split(".");2<=I.length&&(O.major=parseInt(I[0],10),O.minor=parseInt(I[1],10));return O};J.readTitlePortalItem=function(O){return"item-title"!==this.sublayerTitleMode?void 0:O};J.readTitleService=function(O,I){O=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return v.titleFromUrlAndName(this.url,I.name);I=I.name;
if(!I&&this.url){const F=v.parse(this.url);e.isSome(F)&&(I=F.title)}"item-title-and-service-name"===this.sublayerTitleMode&&O&&(I=O+" - "+I);return v.cleanTitle(I)};J.writeUrl=function(O,I,F,L){v.writeUrlWithLayerId(this,O,"layers",I,L)};J._fetchIndexAndUpdateExtent=function(){var O=b._asyncToGenerator(function*(I,F){this.indexInfo=C.fetchIndexInfo(this.parsedUrl.path,this.rootNode,I,this.apiKey,E,F);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(yield this.indexInfo)});return function(I,
F){return O.apply(this,arguments)}}();J._updateExtent=function(O){if("page"===(null==O?void 0:O.type)){var I,F,L=O.rootIndex%O.pageSize;O=null==(I=O.rootPage)?void 0:null==(F=I.nodes)?void 0:F[L];if(null==O||null==O.obb||null==O.obb.center||null==O.obb.halfSize)throw new y("sceneservice:invalid-node-page","Invalid node page.");-1E38>O.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(I=O.obb.halfSize,F=O.obb.center[2],I=Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2]),this.fullExtent.zmin=F-I,
this.fullExtent.zmax=F+I)}else"node"===(null==O?void 0:O.type)&&(F=null==(L=O.rootNode)?void 0:L.mbs,!Array.isArray(F)||4!==F.length||-1E38>F[0]||(I=F[2],F=F[3],this.fullExtent.zmin=I-F,this.fullExtent.zmax=I+F))};J._fetchService=function(){var O=b._asyncToGenerator(function*(I){if(null==this.url)throw new y("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const F=yield this._fetchFirstLayerId(I);
null!=F&&(this.layerId=F)}return this._fetchServiceLayer(I)});return function(I){return O.apply(this,arguments)}}();J._fetchFirstLayerId=function(){var O=b._asyncToGenerator(function*(I){I=yield q(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:I});if(I.data&&Array.isArray(I.data.layers)&&0<I.data.layers.length)return I.data.layers[0].id});return function(I){return O.apply(this,arguments)}}();J._fetchServiceLayer=function(){var O=b._asyncToGenerator(function*(I){I=yield q(this.parsedUrl.path,
{query:{f:"json",token:this.apiKey},responseType:"json",signal:I});I.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));I=I.data;this.read(I,{origin:"service",url:this.parsedUrl});this.validateLayer(I)});return function(I){return O.apply(this,arguments)}}();J._ensureLoadBeforeSave=function(){var O=b._asyncToGenerator(function*(){yield this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&(yield this.beforeSave())});return function(){return O.apply(this,arguments)}}();J.validateLayer=
function(O){};J._updateTypeKeywords=function(O,I,F){O.typeKeywords||(O.typeKeywords=[]);I=I.getTypeKeywords();for(const L of I)O.typeKeywords.push(L);O.typeKeywords&&(O.typeKeywords=O.typeKeywords.filter((L,N,R)=>R.indexOf(L)===N),1===F&&(O.typeKeywords=O.typeKeywords.filter(L=>"Hosted Service"!==L)))};J._saveAs=function(){var O=b._asyncToGenerator(function*(I,F){F={...G,...F};I=B.from(I);I||(E.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new y("sceneservice:portal-item-required",
"_saveAs() requires a portal item to save to")));I.id&&(I=I.clone(),I.id=null);const L=I.portal||A.getDefault();yield this._ensureLoadBeforeSave();I.type="Scene Service";I.portal=L;const N={origin:"portal-item",url:null,messages:[],portal:L,portalItem:I,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},R={layers:[this.write(null,N)]};yield Promise.all(N.resources.pendingOperations);yield this._validateAgainstJSONSchema(R,N,F);I.url=this.url;
I.title||(I.title=this.title);this._updateTypeKeywords(I,F,1);yield L._signIn();yield L.user.addItem({item:I,folder:F&&F.folder,data:R});yield D.saveResources(this.resourceReferences,N,null);this.portalItem=I;m.updateOrigins(N);return N.portalItem=I});return function(I,F){return O.apply(this,arguments)}}();J._save=function(){var O=b._asyncToGenerator(function*(I){I={...G,...I};this.portalItem||(E.error("_save(): requires the .portalItem property to be set"),yield Promise.reject(new y("sceneservice:portal-item-not-set",
"Portal item to save to has not been set on this SceneService")));"Scene Service"!==this.portalItem.type&&(E.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected Scene Service"),yield Promise.reject(new y("sceneservice:portal-item-wrong-type",'Portal item needs to have type "Scene Service"')));yield this._ensureLoadBeforeSave();const F={origin:"portal-item",url:this.portalItem.itemUrl&&g.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||
A.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},L={layers:[this.write(null,F)]};yield Promise.all(F.resources.pendingOperations);yield this._validateAgainstJSONSchema(L,F,I);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,I,0);yield this.portalItem.update({data:L});yield D.saveResources(this.resourceReferences,F,null);
m.updateOrigins(F);return this.portalItem});return function(I){return O.apply(this,arguments)}}();J._validateAgainstJSONSchema=function(){var O=b._asyncToGenerator(function*(I,F,L){F=F.messages.filter(N=>"error"===N.type).map(N=>new y(N.name,N.message,N.details));L&&L.validationOptions.ignoreUnsupported&&(F=F.filter(N=>"layer:unsupported"!==N.name&&"symbol:unsupported"!==N.name&&"symbol-layer:unsupported"!==N.name&&"property:unsupported"!==N.name&&"url:unsupported"!==N.name&&"scenemodification:unsupported"!==
N.name));if(L.validationOptions.enabled&&(I=(yield new Promise(function(N,R){a(["../support/schemaValidator"],N,R)})).validate(I,L.portalItemLayerType),0<I.length)){const N=`Layer item did not validate:\n${I.join("\n")}`;E.error(`_validateAgainstJSONSchema(): ${N}`);if("throw"===L.validationOptions.failPolicy)throw L=I.map(R=>new y("sceneservice:schema-validation",R)).concat(F),new y("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:L});
}if(0<F.length)throw new y("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:F});});return function(I,F,L){return O.apply(this,arguments)}}();b._createClass(H,[{key:"url",set:function(O){O=v.sanitizeUrlWithLayerId({layer:this,url:O,nonStandardUrlAllowed:!1,logger:E});this._set("url",O.url);null!=O.layerId&&this._set("layerId",O.layerId)}},{key:"parsedUrl",get:function(){var O=this._get("url");if(!O)return null;
O=g.urlToObject(O);null!=this.layerId&&(O.path=`${O.path}/layers/${this.layerId}`);return O}}]);return H}(K);r.__decorate([d.property(x.id)],K.prototype,"id",void 0);r.__decorate([d.property({type:k})],K.prototype,"spatialReference",void 0);r.__decorate([u.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],K.prototype,"readSpatialReference",null);r.__decorate([d.property({type:n})],K.prototype,"fullExtent",void 0);r.__decorate([u.reader("fullExtent",["fullExtent",
"store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],K.prototype,"readFullExtent",null);r.__decorate([d.property({readOnly:!0,type:z})],K.prototype,"heightModelInfo",void 0);r.__decorate([d.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],K.prototype,"minScale",void 0);r.__decorate([d.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],
K.prototype,"maxScale",void 0);r.__decorate([d.property({readOnly:!0})],K.prototype,"version",void 0);r.__decorate([u.reader("version",["store.version"])],K.prototype,"readVersion",null);r.__decorate([d.property({type:String,json:{read:{source:"copyrightText"}}})],K.prototype,"copyright",void 0);r.__decorate([d.property({type:String,json:{read:!1}})],K.prototype,"sublayerTitleMode",void 0);r.__decorate([d.property({type:String})],K.prototype,"title",void 0);r.__decorate([u.reader("portal-item","title")],
K.prototype,"readTitlePortalItem",null);r.__decorate([u.reader("service","title",["name"])],K.prototype,"readTitleService",null);r.__decorate([d.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],K.prototype,"layerId",void 0);r.__decorate([d.property(x.url)],K.prototype,"url",null);r.__decorate([h.writer("url")],K.prototype,"writeUrl",null);r.__decorate([d.property()],K.prototype,"parsedUrl",null);r.__decorate([d.property({readOnly:!0})],
K.prototype,"store",void 0);r.__decorate([d.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],K.prototype,"rootNode",void 0);return K=r.__decorate([t.subclass("esri.layers.mixins.SceneService")],K)};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,p){a.updateOrigins=function(b){b&&b.writtenProperties&&b.writtenProperties.forEach(r=>{const q=r.target;r.newOrigin&&
r.oldOrigin!==r.newOrigin&&p.isMultiOriginJSONMixin(q)&&q.updateOrigin(r.propName,r.newOrigin)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(p){return p&&"getAtOrigin"in p&&"originOf"in p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../core/Error",
"../../core/maybe"],function(a,p,b,r,q){function y(){y=p._asyncToGenerator(function*(f,w,e,l,g,d){var c=null;if(q.isSome(e)){c=`${f}/nodepages/`;const u=c+Math.floor(e.rootIndex/e.nodesPerPage);try{return{type:"page",rootPage:(yield b(u,{query:{f:"json",token:l},responseType:"json",signal:d})).data,rootIndex:e.rootIndex,pageSize:e.nodesPerPage,lodMetric:e.lodSelectionMetricType,urlPrefix:c}}catch(t){q.isSome(g)&&g.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",
u,t),c=t}}if(!w)return null;w=w&&w.split("/").pop();f=`${f}/nodes/`;w=f+w;try{return{type:"node",rootNode:(yield b(w,{query:{f:"json",token:l},responseType:"json",signal:d})).data,urlPrefix:f}}catch(u){throw new r("sceneservice:root-node-missing","Root node missing.",{pageError:c,nodeError:u,url:w});}});return y.apply(this,arguments)}a.fetchIndexInfo=function(f,w,e,l,g,d){return y.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(a,p,b,r,q,y,f){function w(){w=p._asyncToGenerator(function*(c,u,t){if(u&&u.resources){var h=u.portalItem===c.portalItem?new Set(c.paths):new Set;c.paths.length=0;c.portalItem=u.portalItem;var m=new Set(u.resources.toKeep.map(k=>k.resource.path)),n=new Set,z=[];m.forEach(k=>{h.delete(k);c.paths.push(k)});for(const k of u.resources.toUpdate)if(h.delete(k.resource.path),m.has(k.resource.path)||n.has(k.resource.path)){const {resource:v,content:x,finish:C,error:A}=k,B=f.getSiblingOfSameTypeI(v,
y.generateUUID());c.paths.push(B.path);z.push(e({resource:B,content:x,finish:C,error:A},t))}else c.paths.push(k.resource.path),z.push(g(k,t)),n.add(k.resource.path);for(const k of u.resources.toAdd)z.push(e(k,t)),c.paths.push(k.resource.path);h.forEach(k=>{k=u.portalItem.resourceFromPath(k);z.push(k.portalItem.removeResource(k).catch(()=>{}))});if(0!==z.length&&(m=yield q.eachAlways(z),q.throwIfAborted(t),t=m.filter(k=>"error"in k).map(k=>k.error),0<t.length))throw new r("save:resources","Failed to save one or more resources",
{errors:t});}});return w.apply(this,arguments)}function e(c,u){return l.apply(this,arguments)}function l(){l=p._asyncToGenerator(function*(c,u){u=yield b.result(c.resource.portalItem.addResource(c.resource,c.content,u));if(!0===u.ok)c.finish&&c.finish(c.resource);else throw c.error&&c.error(u.error),u.error;});return l.apply(this,arguments)}function g(c,u){return d.apply(this,arguments)}function d(){d=p._asyncToGenerator(function*(c,u){u=yield b.result(c.resource.update(c.content,u));if(!0===u.ok)c.finish(c.resource);
else throw c.error(u.error),u.error;});return d.apply(this,arguments)}a.saveResources=function(c,u,t){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/portal/support/resourceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/Error ../../core/maybe ../../core/urlUtils".split(" "),function(a,p,b,r,q,y){function f(){f=p._asyncToGenerator(function*(t,h={},m){yield t.load(m);var n=y.join(t.itemUrl,"resources");const {start:z=
1,num:k=10,sortOrder:v="asc",sortField:x="created"}=h;h={query:{start:z,num:k,sortOrder:v,sortField:x,token:t.apiKey},signal:q.get(m,"signal")};n=yield t.portal._request(n,h);return{total:n.total,nextStart:n.nextStart,resources:n.resources.map(({created:C,size:A,resource:B})=>({created:new Date(C),size:A,resource:t.resourceFromPath(B)}))}});return f.apply(this,arguments)}function w(){w=p._asyncToGenerator(function*(t,h,m,n){if(!t.hasPath())throw new r(`portal-item-resource-${h}:invalid-path`,"Resource does not have a valid path");
const z=t.portalItem;yield z.load(n);h=y.join(z.userItemUrl,"add"===h?"addResources":"updateResources");const [k,v]=g(t.path);m=yield c(m);const x=new FormData;k&&"."!==k&&x.append("resourcesPrefix",k);x.append("fileName",v);x.append("file",m,v);x.append("f","json");q.isSome(n)&&n.access&&x.append("access",n.access);yield z.portal._request(h,{method:"post",body:x,signal:q.get(n,"signal")});return t});return w.apply(this,arguments)}function e(){e=p._asyncToGenerator(function*(t,h,m){if(!h.hasPath())throw new r("portal-item-resources-remove:invalid-path",
"Resource does not have a valid path");yield t.load(m);const n=y.join(t.userItemUrl,"removeResources");yield t.portal._request(n,{method:"post",query:{resource:h.path},signal:q.get(m,"signal")});h.portalItem=null});return e.apply(this,arguments)}function l(){l=p._asyncToGenerator(function*(t,h){yield t.load(h);const m=y.join(t.userItemUrl,"removeResources");return t.portal._request(m,{method:"post",query:{deleteAll:!0},signal:q.get(h,"signal")})});return l.apply(this,arguments)}function g(t){const h=
t.lastIndexOf("/");return-1===h?[".",t]:[t.slice(0,h),t.slice(h+1)]}function d(t){{const k=y.getPathExtension(t);t=q.isNone(k)?[t,""]:[t.slice(0,t.length-k.length-1),`.${k}`]}const [h,m]=t,[n,z]=g(h);return[n,z,m]}function c(t){return u.apply(this,arguments)}function u(){u=p._asyncToGenerator(function*(t){return t instanceof Blob?t:(yield b(t.url,{responseType:"blob"})).data});return u.apply(this,arguments)}a.addOrUpdateResource=function(t,h,m,n){return w.apply(this,arguments)};a.contentToBlob=c;
a.fetchResources=function(t){return f.apply(this,arguments)};a.getSiblingOfSameType=function(t,h){if(!t.hasPath())return null;const [m,,n]=d(t.path);return t.portalItem.resourceFromPath(y.join(m,h+n))};a.getSiblingOfSameTypeI=function(t,h){if(!t.hasPath())return null;const [m,,n]=d(t.path);return t.portalItem.resourceFromPath(y.join(m,h+n))};a.removeAllResources=function(t,h){return l.apply(this,arguments)};a.removeResource=function(t,h,m){return e.apply(this,arguments)};a.splitPrefixFileNameAndExtension=
d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,
supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,
supportsPagination:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,
supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../kernel ../../request ../../core/maybe ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),function(a,p,
b,r,q,y,f,w,e){let l=function(){function g(c,u,t,h){this.parsedUrl=c;this.portalItem=u;this.apiKey=t;this.signal=h;this.rootDocument=null;if(c=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this.urlParts={root:c[1],layerId:parseInt(c[2],10)}}var d=g.prototype;d.fetch=function(){var c=p._asyncToGenerator(function*(){var u;if(!this.urlParts)return null;const t=null!=(u=this.portalItem)?u:yield this.portalItemFromServiceItemId();if(q.isNone(t))return this.loadFromUrl();u=yield this.findAndLoadRelatedPortalItem(t);
return q.isNone(u)?null:this.loadFeatureLayerFromPortalItem(u)});return function(){return c.apply(this,arguments)}}();d.fetchPortalItem=function(){var c=p._asyncToGenerator(function*(){var u;if(!this.urlParts)return null;const t=null!=(u=this.portalItem)?u:yield this.portalItemFromServiceItemId();return q.isNone(t)?null:this.findAndLoadRelatedPortalItem(t)});return function(){return c.apply(this,arguments)}}();d.fetchRootDocument=function(){var c=p._asyncToGenerator(function*(){if(q.isSome(this.rootDocument))return this.rootDocument;
if(q.isNone(this.urlParts))return this.rootDocument={},{};const u={query:{f:"json",token:this.apiKey},responseType:"json",signal:this.signal},t=`${this.urlParts.root}/SceneServer`;try{this.rootDocument=(yield r(t,u)).data}catch{this.rootDocument={}}return this.rootDocument});return function(){return c.apply(this,arguments)}}();d.fetchServiceOwningPortalUrl=function(){var c=p._asyncToGenerator(function*(){var u;const t=null==(u=b.id)?void 0:u.findServerInfo(this.parsedUrl.path);if(null!=t&&t.owningSystemUrl)return t.owningSystemUrl;
u=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const h=(yield r(u,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(h)return h}catch(h){y.throwIfAbortError(h)}return null});return function(){return c.apply(this,arguments)}}();d.findAndLoadRelatedPortalItem=function(){var c=p._asyncToGenerator(function*(u){try{return(yield u.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(t=>"Feature Service"===
t.type)||null}catch(t){return y.throwIfAbortError(t),null}});return function(u){return c.apply(this,arguments)}}();d.loadFeatureLayerFromPortalItem=function(){var c=p._asyncToGenerator(function*(u){yield u.load({signal:this.signal});const t=yield this.findMatchingAssociatedSublayerUrl(u.url);return(new f({url:t,portalItem:u})).load({signal:this.signal})});return function(u){return c.apply(this,arguments)}}();d.loadFromUrl=function(){var c=p._asyncToGenerator(function*(){const u=yield this.findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);
return(new f({url:u})).load({signal:this.signal})});return function(){return c.apply(this,arguments)}}();d.findMatchingAssociatedSublayerUrl=function(){var c=p._asyncToGenerator(function*(u){u=u.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");var t={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};const h=this.urlParts.layerId;var m=this.fetchRootDocument();t=r(u,t);const [n,z]=yield Promise.all([t,m]);m=z&&z.layers;t=n.data&&n.data.layers;if(!Array.isArray(t))throw Error("expected layers array");
if(!Array.isArray(m)){if(h<t.length)return`${u}/${t[h].id}`}else for(let k=0;k<Math.min(m.length,t.length);k++)if(m[k].id===h)return`${u}/${t[k].id}`;throw Error("could not find matching associated sublayer");});return function(u){return c.apply(this,arguments)}}();d.portalItemFromServiceItemId=function(){var c=p._asyncToGenerator(function*(){var u=(yield this.fetchRootDocument()).serviceItemId;if(!u)return null;u=new e({id:u,apiKey:this.apiKey});const t=yield this.fetchServiceOwningPortalUrl();q.isSome(t)&&
(u.portal=new w({url:t}));try{return u.load({signal:this.signal})}catch(h){return y.throwIfAbortError(h),null}});return function(){return c.apply(this,arguments)}}();return g}();a.FetchAssociatedFeatureLayer=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e,l){a.I3SNodePageDefinition=function(g){function d(){var c=g.apply(this,arguments)||this;c.nodesPerPage=null;c.rootIndex=0;c.lodSelectionMetricType=null;return c}p._inheritsLoose(d,g);return d}(r.JSONSupport);b.__decorate([q.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);b.__decorate([q.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);b.__decorate([q.property({type:String})],a.I3SNodePageDefinition.prototype,
"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=b.__decorate([l.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=function(g){function d(){var c=g.apply(this,arguments)||this;c.factor=1;return c}p._inheritsLoose(d,g);return d}(r.JSONSupport);b.__decorate([q.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);b.__decorate([q.property({type:Number})],a.I3SMaterialTexture.prototype,
"factor",void 0);a.I3SMaterialTexture=b.__decorate([l.subclass("esri.layer.support.I3SMaterialTexture")],a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=function(g){function d(){var c=g.apply(this,arguments)||this;c.baseColorFactor=[1,1,1,1];c.baseColorTexture=null;c.metallicRoughnessTexture=null;c.metallicFactor=1;c.roughnessFactor=1;return c}p._inheritsLoose(d,g);return d}(r.JSONSupport);b.__decorate([q.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",
void 0);b.__decorate([q.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);b.__decorate([q.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);b.__decorate([q.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);b.__decorate([q.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=
b.__decorate([l.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=function(g){function d(){var c=g.apply(this,arguments)||this;c.alphaMode="opaque";c.alphaCutoff=.25;c.doubleSided=!1;c.cullFace="none";c.normalTexture=null;c.occlusionTexture=null;c.emissiveTexture=null;c.emissiveFactor=null;c.pbrMetallicRoughness=null;return c}p._inheritsLoose(d,g);return d}(r.JSONSupport);b.__decorate([e.enumeration({opaque:"opaque",mask:"mask",
blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);b.__decorate([q.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);b.__decorate([q.property({type:Boolean})],a.I3SMaterialDefinition.prototype,"doubleSided",void 0);b.__decorate([e.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);b.__decorate([q.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);
b.__decorate([q.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);b.__decorate([q.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);b.__decorate([q.property({type:[Number]})],a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);b.__decorate([q.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=b.__decorate([l.subclass("esri.layer.support.I3SMaterialDefinition")],
a.I3SMaterialDefinition);a.I3STextureFormat=function(g){function d(){return g.apply(this,arguments)||this}p._inheritsLoose(d,g);return d}(r.JSONSupport);b.__decorate([q.property({type:String,json:{read:{source:["name","index"],reader:(g,d)=>null!=g?g:`${d.index}`}}})],a.I3STextureFormat.prototype,"name",void 0);b.__decorate([e.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=b.__decorate([l.subclass("esri.layer.support.I3STextureFormat")],
a.I3STextureFormat);a.I3STextureSetDefinition=function(g){function d(){var c=g.apply(this,arguments)||this;c.atlas=!1;return c}p._inheritsLoose(d,g);return d}(r.JSONSupport);b.__decorate([q.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);b.__decorate([q.property({type:Boolean})],a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=b.__decorate([l.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);
a.I3SGeometryAttribute=function(g){function d(){return g.apply(this,arguments)||this}p._inheritsLoose(d,g);return d}(r.JSONSupport);b.__decorate([e.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);b.__decorate([q.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=b.__decorate([l.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);
a.I3SGeometryCompressedAttributes=function(g){function d(){return g.apply(this,arguments)||this}p._inheritsLoose(d,g);return d}(r.JSONSupport);b.__decorate([e.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);b.__decorate([q.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=b.__decorate([l.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=function(g){function d(){var c=g.apply(this,arguments)||this;c.offset=0;return c}p._inheritsLoose(d,g);return d}(r.JSONSupport);b.__decorate([q.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);b.__decorate([q.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);b.__decorate([q.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);b.__decorate([q.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"uv0",void 0);b.__decorate([q.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"color",void 0);b.__decorate([q.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);b.__decorate([q.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);b.__decorate([q.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);b.__decorate([q.property({type:a.I3SGeometryCompressedAttributes})],
a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=b.__decorate([l.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=function(g){function d(){return g.apply(this,arguments)||this}p._inheritsLoose(d,g);return d}(r.JSONSupport);b.__decorate([e.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);b.__decorate([q.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=
b.__decorate([l.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass".split(" "),function(a,p,b,r,q,y,f,w,e){a.RangeInfo=
function(l){function g(){var d=l.apply(this,arguments)||this;d.name=null;d.field=null;d.currentRangeExtent=null;d.fullRangeExtent=null;d.type="rangeInfo";return d}p._inheritsLoose(g,l);return g}(r.JSONSupport);b.__decorate([q.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);b.__decorate([q.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);b.__decorate([q.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,
"currentRangeExtent",void 0);b.__decorate([q.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);b.__decorate([q.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);a.RangeInfo=b.__decorate([e.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);a["default"]=a.RangeInfo;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){q=function(d){function c(){var u=d.apply(this,arguments)||this;u.type="feature-3d";u.direct3DObjectFeatureLayerDisplayEnabled=l.enableDirect3DObjectFeatureLayerDisplay();return u}a._inheritsLoose(c,d);c.prototype.initialize=function(){this.layer.infoFor3D&&!this.direct3DObjectFeatureLayerDisplayEnabled&&this.addResolvingPromise(Promise.reject(new b("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${this.layer.geometryType}`)));"mesh"!==this.layer.geometryType||
e.canProjectWithoutEngine(this.layer.spatialReference,this.view.spatialReference)||this.addResolvingPromise(Promise.reject(new b("layerview:spatial-reference-incompatible","The spatial references of the feature layer layer is incompatible with the spatial reference of the view")))};return c}(g);p.__decorate([r.property({constructOnly:!0})],q.prototype,"direct3DObjectFeatureLayerDisplayEnabled",void 0);p.__decorate([r.property()],q.prototype,"layer",void 0);return q=p.__decorate([w.subclass("esri.views.3d.layers.FeatureLayerView3D")],
q)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k){f=function(x){function C(B){B=x.call(this,B)||this;B._controllerTotal=0;B._graphicsCoreTotal=0;B.suspendResumeExtentMode="data";return B}a._inheritsLoose(C,x);var A=C.prototype;A.initialize=function(){this.updatingHandles.add(this,"view.floors",()=>this.graphics3d.filterVisibility.filterChanged())};A.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)};A.fetchPopupFeatures=function(){var B=a._asyncToGenerator(function*(D,
E){return(D=this.validateFetchPopupFeatures(E))?Promise.reject(D):this.fetchClientPopupFeatures(E)});return function(D,E){return B.apply(this,arguments)}}();A.setVisibility=function(B,D){this.graphics3d&&this.graphics3d.graphicsCore.setObjectIdVisibility(B,D)};A.createQuery=function(){return x.prototype.createQuery.call(this)};A.queryFeatures=function(B,D){const E=()=>x.prototype.queryFeatures.call(this,B,D);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(B),E):E()};
A.beforeSetController=function(B){B.maximumNumberOfFeatures=this.maximumNumberOfFeatures};A.createController=function(){this.fetcherContext=new t.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const B=new d.FeatureTileController3D({layerView:this,context:this.fetcherContext,graphics:new h.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(B,"serviceDataExtent",D=>{this.graphics3d&&(this.graphics3d.dataExtent=D)},2);this.handles.add(q.init(this,
"suspended",D=>{D?B.suspend():B.resume()},!0));this.updatingHandles.add(this.graphics3d.graphicsCore,"displayFeatureLimit",()=>this.updateDisplayFeatureLimit(B),2);this.handles.add([this.view.resourceController.memoryController.events.on("quality-changed",()=>this.updateDisplayFeatureLimit()),q.whenFalse(this,"updating",()=>{this._graphicsCoreTotal=this._controllerTotal=0;this.notifyChange("updatingProgressValue")})]);return B};A.doRefresh=function(){var B=a._asyncToGenerator(function*(){!this.suspended&&
this.controller&&this.controller.refetch()});return function(){return B.apply(this,arguments)}}();A.getUsedMemory=function(){const B=this.graphics3d&&this.graphics3d.graphicsCore;return(B?B.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)};A.getUnloadedMemory=function(){const B=this.graphics3d&&this.graphics3d.graphicsCore;return(B?B.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*B.usedMemoryPerGraphic:0)};A.ignoresMemoryFactor=function(){return this.controller&&
this.controller.hasMaximumNumberOfFeaturesOverride};A.updateDisplayFeatureLimit=function(B=this.controller){if(B&&this.graphics3d&&this.graphics3d.graphicsCore){var D=this.graphics3d.graphicsCore.displayFeatureLimit,E=this.view.resourceController.memoryController.memoryFactor;B.displayFeatureLimit=1===E?D:{...D,maximumNumberOfFeatures:Math.ceil(D.maximumNumberOfFeatures*E),maximumTotalNumberOfFeatures:Math.ceil(D.maximumTotalNumberOfFeatures*E),minimumTotalNumberOfFeatures:Math.ceil(D.minimumTotalNumberOfFeatures*
E)}}};A._queryFeaturesMesh=function(){var B=a._asyncToGenerator(function*(D,E){yield this._validateQueryFeaturesMesh(D);E=yield E();if(D&&D.outStatistics)return E;D=this.layer.objectIdField;const G=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID,K=[];for(const M of E.features)if(M.geometry){const H=G.get(M.attributes[D]);H&&(M.geometry=g.hydrateGeometry(H.graphic.geometry),K.push(M))}else K.push(M);E.features=K;return E});return function(D,E){return B.apply(this,arguments)}}();A._validateQueryFeaturesMesh=
function(){var B=a._asyncToGenerator(function*(D){if(D){var E=K=>{throw new b("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${K}'`);},G=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const K of G)null!=D[K]&&E(K);"returnM"in D&&D.returnM&&E("returnM");"returnCentroid"in D&&D.returnCentroid&&E("returnCentroid");r.isSome(D.outSpatialReference)&&!D.outSpatialReference.equals(this.view.spatialReference)&&E("outSpatialReference")}});
return function(D){return B.apply(this,arguments)}}();a._createClass(C,[{key:"maximumNumberOfFeatures",get:function(){var B,D;return null!=(B=null==(D=this.controller)?void 0:D.maximumNumberOfFeatures)?B:this._get("maximumNumberOfFeatures")},set:function(B){this._set("maximumNumberOfFeatures",B);this.controller&&(this.controller.maximumNumberOfFeatures=B)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):
!1}},{key:"updatingProgressValue",get:function(){var B,D,E;let G=0;if(null!=(B=this.controller)&&B.updating){B=this.controller.updatingRemaining;const K=Math.max(this.controller.updatingTotal,this._controllerTotal);0<K&&(G=(K-B)/K,this._controllerTotal=K)}B=0;null!=(D=this.graphics3d)&&null!=(E=D.graphicsCore)&&E.updating&&(D=this.graphics3d.graphicsCore.updatingRemaining,E=Math.max(D,this._graphicsCoreTotal),0<E&&(B=(E-D)/E,this._graphicsCoreTotal=E));return.5*(G+B)}},{key:"updatePolicy",get:function(){if(!this.controller)return 0;
switch(this.controller.mode){case "snapshot":{const B=v[this.layer.geometryType];return null==B||this.controller.serviceDataCount>B?0:1}case "tiles":return 0}}},{key:"hasZ",get:function(){const B=this.layer,D=B.capabilities&&B.capabilities.data;return D&&D.supportsZ?"returnZ"in B&&null!=B.returnZ?B.returnZ:D.supportsZ:!1}},{key:"hasM",get:function(){const B=this.layer,D=B.capabilities&&B.capabilities.data;return D&&D.supportsM?"returnM"in B&&null!=B.returnM?B.returnM:!1:!1}},{key:"performanceInfo",
get:function(){var B=this.controller&&this.controller.displayFeatureLimit;B=r.isSome(B)&&B.averageSymbolComplexity;B=r.isSome(B)?`f:${B.primitivesPerFeature},v:${B.primitivesPerCoordinate}`:"n/a";B={...this._getResourceInfo(),storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?this.controller.mode:"n/a",symbolComplexity:B,nodes:this.controller?this.controller.tileDescriptors.length:0};if(this.controller&&B.displayedNumberOfFeatures){const D=this.controller.debug;
B.storedFeatures=D.storedFeatures;B.totalVertices=D.totalVertices}return B}},{key:"test",get:function(){return{updatePolicy:this.updatePolicy,controller:this.controller}}}]);return C}(k.RefreshableLayerView(c.FeatureLikeLayerView3D(n.FeatureLayerView(u.LayerView3D(z)))));p.__decorate([y.property()],f.prototype,"layer",void 0);p.__decorate([y.property()],f.prototype,"controller",void 0);p.__decorate([y.property()],f.prototype,"maximumNumberOfFeatures",null);p.__decorate([y.property()],f.prototype,
"maximumNumberOfFeaturesExceeded",null);p.__decorate([y.property(m.updatingProgress)],f.prototype,"updatingProgress",void 0);p.__decorate([y.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining"]})],f.prototype,"updatingProgressValue",null);p.__decorate([y.property({readOnly:!0})],f.prototype,"updatePolicy",null);p.__decorate([y.property({readOnly:!0})],f.prototype,"hasZ",null);p.__decorate([y.property({readOnly:!0})],
f.prototype,"hasM",null);p.__decorate([y.property()],f.prototype,"suspendResumeExtentMode",void 0);f=p.__decorate([l.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],f);const v={point:5E3,polygon:500,polyline:1E3};return f})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags ../../../views/support/WatchUpdatingTracking".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B){function D(G,K){if(!K)return!1;for(const M of K)if(!G.has(M))return!0;return!1}const E=g.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");a.FeatureTileController3D=function(G){function K(H){H=G.call(this,H)||this;H.type="feature-tile-3d";H.watchUpdatingTracking=new B.WatchUpdatingTracking;H.serviceDataExtent=null;H.serviceDataCount=a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;H.vertexLimitExceeded=!1;H.displayFeatureLimit=
null;H.suspended=!1;H.tileFetcher=null;H.handles=new e;H.fetchDataInfoPromise=null;H.fetchDataInfoAbortController=null;H.lifeCycleAbortController=u.createAbortController();return H}p._inheritsLoose(K,G);var M=K.prototype;M.approximateExtentSizeAtScale=function(H,J){const O=this.layerView.view,I=J.levels[0];return(I.tileSize[0]/(I.scale/H)+I.tileSize[1]/(I.scale/H))/2*Math.ceil((O.width/J.pixelSize+O.height/J.pixelSize)/2)};M.initialize=function(){this.watchUpdatingTracking.add(this,"vertexLimitInfo",
()=>this.watchUpdatingTracking.addPromise(this.updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)));this.watchUpdatingTracking.add(this,"mode",()=>this.modeChanged(),2);this.addResolvingPromise(Promise.resolve().then(()=>this.verifyCapabilities()).then(()=>this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo())).then(()=>this.initializeTileFetcher()))};M.verifyCapabilities=function(){const H=this.layerView.layer;if(!H.get("capabilities.operations.supportsQuery")&&"ogc-feature"!==
H.type)throw new w("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:H});};M.destroy=function(){this.cancelFetchServiceDataInfo();this.tileFetcher=d.destroyMaybe(this.tileFetcher);this.handles=d.destroyMaybe(this.handles);this.tilesHandle=d.removeMaybe(this.tilesHandle);this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null);this.watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",
null)};M.suspend=function(){this.suspended||(this.suspended=!0,d.isSome(this.tileFetcher)&&this.tileFetcher.suspend())};M.resume=function(){this.suspended&&(this.suspended=!1,d.isSome(this.tileFetcher)&&this.tileFetcher.resume())};M.restart=function(){const H=()=>{d.isSome(this.tileFetcher)&&this.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(H,H))};M.refetch=function(){const H=()=>{d.isSome(this.tileFetcher)&&this.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(H,
H))};M.initializeTileFetcher=function(){const H=this.layerView.view;if(H){var J=t.whenOnce(H.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(J);J.then(()=>{const {layerView:O,tileDescriptors:I}=this,F=O.layer,L=new x.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,tileDescriptors:I,features:this.graphics});this.tileFetcher=L;this.suspended?this.tileFetcher.suspend():this.tileFetcher.resume();var N=this.layerView.view.resourceController;
N&&(this.handles.add(N.memoryController.events.on("quality-changed",R=>{L.memoryFactor=R})),this.tileFetcher.memoryFactor=N.memoryController.memoryFactor);(N="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null)&&this.handles.add(t.init(this.layerView.view,"qualitySettings.graphics3D."+N,R=>{L.lodFactor=R||1}));this.watchUpdatingTracking.add(F,"createQueryVersion",()=>this.dataFilterChanged());this.watchUpdatingTracking.add(O,"availableFields",
(R,S)=>this.availableFieldsChanged(S,R));this.watchUpdatingTracking.add(O,"requiredFields",(R,S)=>this.requiredFieldsChanged(S,R));this.handles.add([F.on("apply-edits",R=>this.applyEdits(R)),this.watch("extent",R=>L.filterExtent=R,!0),this.watch("tileDescriptors",R=>L.tileDescriptors=R,!0),t.init(this,"maximumNumberOfFeatures",R=>{L.maximumNumberOfFeatures=R;L.useTileCount=this.serviceDataCount>R},!0),t.init(this,"serviceDataCount",R=>L.useTileCount=R>this.maximumNumberOfFeatures,!0),t.init(A,"FEATURE_TILE_FETCH_SHOW_TILES",
R=>{R&&L&&!L.debugger?(L.debugger=new C.FeatureTileFetcher3DDebugger(L,H.featureTiles.tilingScheme.toTileInfo(),H),L.debugger.update()):!R&&this.tileFetcher&&L.debugger&&(L.debugger.destroy(),L.debugger=null)})]);this.supportsExceedsLimitQuery||this.watchUpdatingTracking.add(this,"maxTotalSnapshotVertices",()=>this.watchUpdatingTracking.addPromise(this.updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)))}).catch(()=>{})}};M.modeChanged=function(){switch(this.mode){case "tiles":this.tilesHandle||
(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:E.warn("Unhandled feature layer mode "+this.mode);case "snapshot":d.isSome(this.tilesHandle)&&(this.tilesHandle.remove(),this.tilesHandle=null)}};M.dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};M.applyEdits=function(H){d.isNone(this.tileFetcher)||this.tileFetcher.applyEdits(H).then(J=>{J&&(J.deletedFeatures.length||J.updatedFeatures.length||
J.addedFeatures.length)&&this.watchUpdatingTracking.addPromise(this.updateServiceDataExtent(this.lifeCycleAbortController.signal))}).catch(J=>{if(!u.isAbortError(J))throw J;})};M.availableFieldsChanged=function(H,J){d.isSome(this.tileFetcher)&&D(this.tileFetcher.availableFields,J)&&this.refetch()};M.requiredFieldsChanged=function(H,J){d.isSome(this.tileFetcher)&&D(this.tileFetcher.availableFields,J)&&this.restart()};M.createVertexLimitExceededQuery=function(H){const J=this.layerView.layer,O=J.createQuery();
O.outStatistics=[new v({statisticType:"exceedslimit",maxVertexCount:H,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];J.capabilities.query.supportsCacheHint&&(O.cacheHint=!0);return O};M.createDataInfoQuery=function(){const H=this.layerView.layer,J=H.createQuery();J.outSpatialReference=this.layerView.view.spatialReference;H.capabilities.query.supportsCacheHint&&(J.cacheHint=!0);return J};M.fullExtentIsAccurate=function(){const H=this.layerView.layer;if(H.definitionExpression)return!1;
switch(H.type){case "feature":return z.isHostedAgolService(H.url);case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}};M.updateServiceDataExtent=function(){var H=p._asyncToGenerator(function*(J){try{yield this.tryUpdateServiceDataExtent(J)}catch(O){u.isAbortError(O)||this._set("serviceDataExtent",l.clone(this.layerView.fullExtentInLocalViewSpatialReference))}});return function(J){return H.apply(this,arguments)}}();M.tryUpdateServiceDataExtent=function(){var H=p._asyncToGenerator(function*(J){var O=
this.layerView;const I=O.layer,F=I.capabilities.query.supportsExtent,L=l.clone(O.fullExtentInLocalViewSpatialReference),N=I.fullExtent,R=this.fullExtentIsAccurate(),S=this.serviceDataCount;F&&S<=a.FeatureTileController3DConstants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!L||!R)&&"queryExtent"in I?(O=this.createDataInfoQuery(),J=yield I.queryExtent(O,{timeout:a.FeatureTileController3DConstants.QUERY_EXTENT_TIMEOUT,signal:J}),this._set("serviceDataExtent",J.extent)):L?this._set("serviceDataExtent",L):N?(J=yield k.projectGeometry(N,
O.view.spatialReference,"portalItem"in I?I.portalItem:null,J),this._set("serviceDataExtent",J)):this._set("serviceDataExtent",null)});return function(J){return H.apply(this,arguments)}}();M.updateServiceDataCount=function(){var H=p._asyncToGenerator(function*(J){const O=this.layerView.layer;if("queryFeatureCount"in O)if(J=yield q.result(O.queryFeatureCount(this.createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:J})),!0===J.ok)this._set("serviceDataCount",
J.value);else{if(u.isAbortError(J.error))throw J.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)});return function(J){return H.apply(this,arguments)}}();M.updateVertexLimitExceeded=function(){var H=p._asyncToGenerator(function*(J,O){var I=this.vertexLimitInfo;if(d.isNone(I))this._set("vertexLimitExceeded",!1);else{var F=1<this.minimumNumberOfVerticesForGeometry;
if(0>=I.primitivesPerFeature||F){var {primitivesPerFeature:L,primitivesPerCoordinate:N,maximumTotalNumberOfPrimitives:R}=I;0!==L&&d.isSome(J)&&(yield J);I=this.serviceDataCount;var S=I!==a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;J=S?Math.ceil((R-I*L)/(N||1)):Math.ceil(R/(N||1));F&&(J=Math.min(J,5E6));if(S&&this.minimumNumberOfVerticesForGeometry*I>J)this._set("vertexLimitExceeded",!0);else if(this.supportsExceedsLimitQuery)if(O=yield q.result(this.layerView.layer.queryFeatures(this.createVertexLimitExceededQuery(J),
{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:O})),!1===O.ok){if(u.isAbortError(O.error))throw O.error;this._set("vertexLimitExceeded",!1)}else(O=O.value.features[0])&&O.attributes?this._set("vertexLimitExceeded",!!O.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);else this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>J)}else this._set("vertexLimitExceeded",!1)}});return function(J,O){return H.apply(this,arguments)}}();M.fetchServiceDataInfo=
function(){var H=p._asyncToGenerator(function*(){this.cancelFetchServiceDataInfo();let J=u.createAbortController();const O=J.signal;var I=this.updateServiceDataCount(O);I=u.eachAlways([I,this.updateVertexLimitExceeded(I,O)]);const F=I.then(()=>this.updateServiceDataExtent(O)).catch(L=>{u.isAbortError(L)||E.error("#fetchServiceDataInfo()",L)}).then(()=>{F===this.fetchDataInfoPromise&&(this.fetchDataInfoAbortController=this.fetchDataInfoPromise=null);J=null});J&&(this.fetchDataInfoPromise=F);this.fetchDataInfoAbortController=
J;return I.then(()=>{},()=>{})});return function(){return H.apply(this,arguments)}}();M.cancelFetchServiceDataInfo=function(){const H=this.fetchDataInfoAbortController;H&&(this.fetchDataInfoPromise=this.fetchDataInfoAbortController=null,H.abort())};p._createClass(K,[{key:"extent",set:function(H){if(H&&!H.spatialReference.equals(this.layerView.view.spatialReference))E.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var J=this._get("extent");J===H||J&&H&&J.equals(H)||
(H=H?H.clone():null,this._set("extent",H))}}},{key:"updating",get:function(){return!!(d.isSome(this.tileFetcher)&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&d.isSome(this.tileFetcher)?this.tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&
d.isSome(this.tileFetcher)?this.tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&d.isSome(this.tileFetcher)?this.tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return d.isSome(this.tileFetcher)?this.tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!d.isSome(this.tileFetcher)||!this.tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return d.isSome(this.displayFeatureLimit)?
this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(H){H!==this.maximumNumberOfFeatures&&(null==H?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",H))}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var H=this.layerView.layer;if("feature"===H.type&&d.isSome(H.infoFor3D))return"snapshot";if(this.serviceDataCount===a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT||
this.vertexLimitExceeded)return"tiles";var J=this.layerView.view;J=(J=J&&J.featureTiles)&&J.tilingScheme;return H&&H.minScale&&this.serviceDataExtent&&J&&(H=this.approximateExtentSizeAtScale(H.minScale,J),(this.serviceDataExtent.width/H+this.serviceDataExtent.height/H)/2>a.FeatureTileController3DConstants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){const H=
this._get("maxTotalSnapshotVertices")||0,J="snapshot"===this.mode&&d.isSome(this.tileFetcher)&&this.tileFetcher.totalVertices||0;return Math.max(H,J)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new y([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new y}},{key:"test",get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}}},{key:"vertexLimitInfo",get:function(){if(d.isNone(this.displayFeatureLimit)||
d.isNone(this.displayFeatureLimit.averageSymbolComplexity))return null;const {averageSymbolComplexity:H,maximumTotalNumberOfPrimitives:J}=this.displayFeatureLimit,{primitivesPerCoordinate:O,primitivesPerFeature:I}=H,F=this._get("vertexLimitInfo");return d.isNone(F)||F.maximumTotalNumberOfPrimitives!==J||F.primitivesPerCoordinate!==O||F.primitivesPerFeature!==I?{primitivesPerCoordinate:O,primitivesPerFeature:I,maximumTotalNumberOfPrimitives:J}:F}},{key:"supportsExceedsLimitQuery",get:function(){const H=
this.layerView.layer;return H.capabilities&&H.capabilities.operations&&H.capabilities.operations.supportsExceedsLimitStatistics}},{key:"minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return 0}}},{key:"debug",get:function(){return{storedFeatures:d.isSome(this.tileFetcher)?this.tileFetcher.storedFeatures:0,totalFeatures:d.isSome(this.tileFetcher)?
this.tileFetcher.totalFeatures:0,totalVertices:d.isSome(this.tileFetcher)?this.tileFetcher.totalVertices:0}}}]);return K}(c.EsriPromiseMixin(r));b.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);b.__decorate([h.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"graphics",void 0);b.__decorate([h.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);b.__decorate([h.property({constructOnly:!0})],a.FeatureTileController3D.prototype,
"context",void 0);b.__decorate([h.property()],a.FeatureTileController3D.prototype,"extent",null);b.__decorate([h.property()],a.FeatureTileController3D.prototype,"updating",null);b.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"watchUpdatingTracking",void 0);b.__decorate([h.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);b.__decorate([h.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);b.__decorate([h.property()],a.FeatureTileController3D.prototype,
"expectedFeatureDiff",null);b.__decorate([h.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);b.__decorate([h.property()],a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);b.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);b.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,
"vertexLimitExceeded",void 0);b.__decorate([h.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);b.__decorate([h.property({type:Number})],a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"mode",null);b.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);b.__decorate([h.property({readOnly:!0,dependsOn:["mode"]})],a.FeatureTileController3D.prototype,
"tileDescriptors",null);b.__decorate([h.property()],a.FeatureTileController3D.prototype,"tileFetcher",void 0);b.__decorate([h.property()],a.FeatureTileController3D.prototype,"fetchDataInfoPromise",void 0);b.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"vertexLimitInfo",null);a.FeatureTileController3D=b.__decorate([n.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],a.FeatureTileController3D);a.FeatureTileController3DConstants=void 0;(function(G){G.NO_SERVICE_DATA_COUNT=
Infinity;G.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;G.reset=function(){G.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;G.QUERY_STATISTICS_TIMEOUT=12E3;G.QUERY_EXTENT_TIMEOUT=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C){function A(J){return"dummy-tile-full-extent"===J.id}function B(J){let O=0;for(const I of J)I.features&&0<I.features.length&&I.alive&&(O=Math.max(O,I.descriptor.lij[0]));return O}function D(J){J.setFeatures([],0,null);J.featuresMissing=!1;return 4}function E(J){return w.isNone(J)?new Set:new Set(J.map(O=>O.name))}function G(J,O){if(w.isNone(J)||w.isNone(O))return E(O);const I=new Set;for(const {name:F}of O)J.has(F)&&I.add(F);return I}const K=
y.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");a.FeatureTileFetcher3D=function(J){function O(F){F=J.call(this,F)||this;F._useTileCount=!1;F.updating=!1;F.updatingTotal=0;F.updatingRemaining=0;F.expectedFeatureDiff=0;F.maximumNumberOfFeaturesExceeded=!1;F.maximumNumberOfFeaturesExceededThrottle=1E3;F._fullRatio=1;F._farRatio=1;F.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};F.handles=new q;F._frameTask=C.ImmediateTask;F._dirty=!1;F.featureTiles=new Map;F.displayingFeatureReferences=
new Map;F.numDisplayingFeatureReferences=0;F.suspended=!0;F.pendingEdits=null;return F}p._inheritsLoose(O,J);var I=O.prototype;I.initialize=function(){this.handles.add(g.on(this,"tileDescriptors","change",()=>this.setDirty(),()=>this.setDirty()));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?k.MultiFeatureReference:k.SingleFeatureReference;const F=this.context.scheduler;w.isSome(F)&&(this._frameTask=F.registerTask(C.TaskPriority.FEATURE_TILE_FETCHER,
this));this.setDirty()};I.destroy=function(){this._frameTask.remove();this.handles=w.destroyMaybe(this.handles);this.featureTiles.forEach(F=>{this.cancelFetchTile(F);this.removeTile(F)});this.featureTiles.clear();this.displayingFeatureReferences.clear();this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};I.restart=function(){this.featureTiles.forEach(F=>{this.cancelFetchTile(F);this.clearTile(F);this.resetFetchTile(F)});w.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();
this.setDirty()};I.refetch=function(){this.featureTiles.forEach(F=>{this.cancelFetchTile(F);this.resetFetchTile(F)});w.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};I.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};I.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())};I.pause=function(){this.paused&&(this.featureTiles.forEach(F=>this.cancelFetchTile(F)),this.updated())};I.unpause=function(){this.paused||(this.setDirty(),
this.updated())};I.applyEdits=function(F){this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:e.createAbortController()},this.pause());const L=this.pendingEdits;L.count++;const N=L.edits.then(()=>F.result.catch(R=>{if(e.isAbortError(R))throw R;return null}).then(R=>{if(!R)return R;this.applyEditsDeleteFeatures(R.deletedFeatures);return this.applyEditsAddUpdateFeatures(R.addedFeatures,R.updatedFeatures,L.controller.signal).then(()=>R)}).then(R=>{0===--L.count&&(this.pendingEdits===
L&&(this.pendingEdits=null),w.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.unpause(),this.updated());return R}));L.edits=N;this.updated();return N};I.applyEditsDeleteFeatures=function(F){if(0!==F.length){var L=this.context.globalIdField,N=L&&this.availableFields.has(L),R=new Set,S=this.objectIdField;F.forEach(({objectId:P,globalId:Q})=>{(!P||0>P)&&L?(N||K.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${L} to be included the layer's outFields for updates to be reflected in the view`),
(P=this.features.find(V=>V.attributes&&V.attributes[L]===Q))&&R.add(m.getObjectId(P,S))):R.add(P)});this.featureTiles.forEach(P=>{if(P.features){var Q=P.features.filter(V=>!R.has(m.getObjectId(V,this.objectIdField)));Q.length!==P.features.length&&(P.setFeatures(Q,0,P.availableFields),this.invalidateCounts())}})}};I.applyEditsAddUpdateFeatures=function(){var F=p._asyncToGenerator(function*(L,N,R){const S=[],P=new Set;L.forEach(V=>S.push(V.objectId));N.forEach(V=>{S.push(V.objectId);P.add(V.objectId)});
if(0!==S.length){var Q=[];this.featureTiles.forEach(V=>{(V=this.applyEditsAddUpdateTile(V,S,P,R))&&Q.push(V)});yield e.eachAlways(Q)}});return function(L,N,R){return F.apply(this,arguments)}}();I.applyEditsAddUpdateTile=function(){var F=p._asyncToGenerator(function*(L,N,R,S){if(L.features){var P=this.createQuery(L);P.resultType=void 0;P.cacheHint=!1;P.objectIds=N;N=yield this.queryFeatures(P,S);S=null;0<R.size&&(P=L.features.filter(Q=>!R.has(m.getObjectId(Q,this.objectIdField))),P.length!==L.features.length&&
(S=P));if(0<N.features.length){S||(S=L.features.slice());for(const Q of N.features)S.push(Q)}S&&(L.hasPreciseFeatureCount&&(L.numFeatures=Math.max(L.numFeatures,S.length)),L.setFeatures(S,0,G(L.availableFields,N.fields)),this.invalidateCounts())}});return function(L,N,R,S){return F.apply(this,arguments)}}();I.queryFeatures=function(F,L){return this.context.query.queryFeaturesDehydrated(F,{signal:L,timeout:6E5})};I.setDirty=function(){this._dirty=!0;this.updated()};I.runTask=function(F){this._frameTask.processQueue(F);
if(this._dirty&&this.constructed){this._dirty=!1;var L=this.getListOfTiles();this.markTilesNotAlive(L);if(F.run(()=>this.addTiles(L,F))&&F.run(()=>this.filterExtentTiles(L,F))&&F.run(()=>this.removeTiles(L,F))&&!F.done){var N=this.sortTiles(L);F.run(()=>this.displayTiles(N,F))&&F.run(()=>this.fetchTiles(N,F))&&F.run(()=>this.updateMemoryEstimates(N,F))||this.setDirty();this.updated();this.updating||this.updateMaximumNumberOfFeaturesExceeded()}else this.setDirty()}};I.markTilesNotAlive=function(F){for(const L of F)L.alive=
!1};I.addTiles=function(F,L){if(this.suspended)return!1;this.tileDescriptors.forEach(N=>{const R=this.featureTiles.get(N.id);R?R.alive=!0:L.done||(F.push(this.addTile(N)),L.madeProgress())});return L.hasProgressed};I.filterExtentTiles=function(F,L){for(const N of F){if(L.done)break;N.alive&&(N.filtered=!N.intersects(this.filterExtent),N.filtered&&(this.clearTile(N),L.madeProgress()))}return L.hasProgressed};I.removeTiles=function(F,L){for(let N=F.length-1;0<=N&&!L.done;N--){const R=F[N];R.alive||
(this.removeTile(R),N!==F.length-1&&(F[N]=F[F.length-1]),F.pop(),L.madeProgress())}return L.hasProgressed};I.sortTiles=function(F){F.sort((L,N)=>L.descriptor.loadPriority-N.descriptor.loadPriority);return F};I.displayTiles=function(F,L){const N=this.updateRatio(F),R=S=>{const P=1>this._fullRatio?N(S)*this._farRatio:1;S.reduceFeatures(P,this.memoryFactor,this.objectIdField)&&this.setDirty();return this.showTile(S)};for(const S of F)if(!L.run(()=>R(S))){this.setDirty();break}return L.hasProgressed};
I.fetchTiles=function(F,L){if(this.paused)return!1;var N=!1;for(const S of F)if(S.needsFetching){var R=w.isSome(this.context.memoryCache)?this.context.memoryCache.pop(S.id):null;if(w.isSome(R))S.cache=R,this.setDirty(),this.scheduleUpdated(),L.madeProgress();else if(this.needsNumFeatures(S)&&(N=e.createAbortController(),R=this.fetchTileCount(S,N.signal),this._handleRequest(S,R,N,()=>S.numFeatures=v.FAILED_FEATURE_COUNT),N=!0,L.madeProgress()),L.done)return!0}if(N)return L.hasProgressed;for(const S of F)if(S.needsFetching&&
(F=e.createAbortController(),N=this.fetchTile(S,F.signal),this._handleRequest(S,N,F,P=>{S.setFeatures([],0,null);this.invalidateCounts();S.featuresMissing=!1;this.context.logFetchError(K,P)}),L.madeProgress(),L.done))return!0;return L.hasProgressed};I.updateMemoryEstimates=function(F,L){F.some(N=>L.run(()=>N.updateMemoryEstimates())?!1:(this.setDirty(),!0));return L.hasProgressed};I.reclip=function(F,L){if(this.constructed){var N=[];this.featureTiles.forEach(R=>{w.isNone(R.displayingFeatures)||0===
R.displayingFeatures.length||(R.intersectionIncludingBorrowed(L,M),R.intersectionIncludingBorrowed(F,H),h.equals(M,H)||N.push(R))});this.refreshDisplayingFeatures(N);this.updated()}};I.refreshDisplayingFeatures=function(F){const L=new Set,N=this.changes.updates;for(const R of F)if(!w.isNone(R.displayingFeatures))for(const S of R.displayingFeatures)F=m.getObjectId(S,this.objectIdField),L.has(F)||(L.add(F),{feature:F}=this.displayingFeatureReferences.get(F),N.removes.push(F),N.adds.push(F));this.applyChanges()};
I.updated=function(){let F=0;this.paused||this.featureTiles.forEach(N=>N.isFetching?++F:0);var L=this._dirty||0<F||!!this.pendingEdits;this._set("updating",L);if(L){let N=0,R=0,S=0,P=0,Q=0;const V=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach(ba=>{++R;if(ba.isFetching&&ba.hasPreciseFeatureCount){const Z=this.maximumFeaturesForTile(ba)*(1-ba.emptyFeatureRatio),ha=w.isSome(ba.displayingFeatures)?ba.displayingFeatures.length*V:0;Q+=Z-ha}ba.needsFetching?
++P:0<ba.numFeatures&&(++S,N+=ba.numFeatures)});P+=F;let ca=L=0;N?(ca=N,L=Math.min(P*N/S,N)):(ca=R,L=P);Q=Math.min(this.maximumNumberOfFeatures-this.features.length,Q);this._set("updatingTotal",ca);this._set("updatingRemaining",L);this._set("expectedFeatureDiff",Q)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};I.updateMaximumNumberOfFeaturesExceeded=function(){const F=f.someMap(this.featureTiles,L=>L.perTileMaximumNumberOfFeaturesExceeded);
this._set("maximumNumberOfFeaturesExceeded",F)};I.updateRatio=function(F){const L=B(F),N=P=>1/(1<<Math.max(0,L-P.descriptor.lij[0]));let R=0,S=0;for(const P of F)F=P.numFeatures,R+=F,S+=F*N(P);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/R);this._farRatio=this.maximumNumberOfFeatures/S;this.scheduleUpdated();return N};I.maximumFeaturesUpdated=function(F,L){F!==L&&(L>F&&this.featureTiles.forEach(N=>{if(N.featuresMissing){var R=this.maximumFeaturesForTile(N);N.features&&(N.features.length>=
R||5===N.fetchStatus)||(this.cancelFetchTile(N),this.resetFetchTile(N))}}),this.setDirty())};I.addTile=function(F){F=new v.FeatureTile(F);this.featureTiles.set(F.id,F);this.resetFetchTile(F);this.referenceDisplayingFeaturesFromRelatedTiles(F);return F};I.referenceDisplayingFeaturesFromRelatedTiles=function(F){const L=F.descriptor.resolution;this.featureTiles.forEach(N=>{if(!(w.isNone(N.displayingFeatures)||F===N||F.descriptor.lij&&N.descriptor.lij&&!x.tilesAreRelated(F.descriptor.lij,N.descriptor.lij))){w.isNone(F.displayingFeatures)&&
(F.displayingFeatures=[]);F.descriptor.extent&&N.descriptor.extent&&(w.isNone(F.extentIncludingBorrowedFeatures)&&(F.extentIncludingBorrowedFeatures=h.clone(F.descriptor.extent)),h.expand(F.extentIncludingBorrowedFeatures,N.descriptor.extent,F.extentIncludingBorrowedFeatures));for(const R of N.displayingFeatures)F.displayingFeatures.push(R),N=this.displayingFeatureReferences.get(m.getObjectId(R,this.objectIdField)),N.ref(N.feature,L),this.numDisplayingFeatureReferences++}});F.featureLimit=w.isSome(F.displayingFeatures)?
F.displayingFeatures.length:0};I.removeTile=function(F){this.clearTile(F);this.featureTiles.delete(F.id)};I.resetFetchTile=function(F){F.filtered=!F.intersects(this.filterExtent);F.filtered?F.needsFetching&&(F.fetchStatus=4):F.fetchStatus=0};I.cancelFetchTile=function(F){const L=F.requestController;w.isSome(L)&&(F.requestController=null,F.resetFetching(),L.abort())};I.fetchTileCount=function(){var F=p._asyncToGenerator(function*(L,N){L.numFeatures=yield this.fetchCount(L,N);this.updateRatio(this.getListOfTiles());
return 3===L.fetchStatus?1:0});return function(L,N){return F.apply(this,arguments)}}();I.fetchTile=function(){var F=p._asyncToGenerator(function*(L,N){var R=this.maximumFeaturesForTile(L);if(0>=R)return D(L);const S=this.getMaxRecordCount(L);var P=Math.ceil(R/S);if(A(L)||!this.context.capabilities.supportsMaxRecordCountFactor||L.numFeatures<=R&&P>z.MAX_MAX_RECORD_COUNT_FACTOR)return this.fetchPagedTile(L,N);P=this.createQuery(L);P.maxRecordCountFactor=Math.ceil(R/S);L.isRefetching&&L.features&&0<
L.features.length&&(P.maxRecordCountFactor=Math.max(Math.ceil(L.features.length/(1-L.emptyFeatureRatio)/S)+1,P.maxRecordCountFactor));const {features:Q,exceededTransferLimit:V,fields:ca}=yield this.queryFeatures(P,N);R=V?P.maxRecordCountFactor>=z.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5;yield this._frameTask.schedule(()=>{L.featuresMissing=Q.length<L.numFeatures||V;const ba=this._removeEmptyFeatures(Q);L.setFeatures(Q,ba,E(ca))},N);this.invalidateCounts();return R});return function(L,N){return F.apply(this,
arguments)}}();I.fetchCount=function(){var F=p._asyncToGenerator(function*(L,N){return this.context.query.queryFeatureCount(this.createFeatureCountQuery(L),{signal:N})});return function(L,N){return F.apply(this,arguments)}}();I.fetchPagedTile=function(){var F=p._asyncToGenerator(function*(L,N){let R=0,S=0,P,Q=0,V=this.maximumFeaturesForTile(L)-Q;const ca=this.getMaxRecordCount(L);let ba=null;for(;;){const Z=this.createQuery(L),ha=this.setPagingParameters(Z,R,V,ca),{features:fa,exceededTransferLimit:aa,
fields:W}=yield this.queryFeatures(Z,N);yield this._frameTask.schedule(()=>{ha&&(R+=w.unwrap(Z.num));Q+=fa.length;S+=this._removeEmptyFeatures(fa);L.featuresMissing=R<L.numFeatures||aa;P=P?P.concat(fa):fa;ba=G(ba,W);L.setFeatures(P,S,ba)},N);this.invalidateCounts();this.setDirty();V=this.maximumFeaturesForTile(L)-Q;if(!ha||!aa||0>=V)return aa?4:5}});return function(L,N){return F.apply(this,arguments)}}();I.createFeatureCountQuery=function(F){F=this.createQuery(F);this.context.capabilities.supportsCacheHint&&
(F.resultType=void 0,F.cacheHint=!0);return F};I.createQuery=function(F){const L=this.context.createQuery(),N=F.descriptor.extent;N&&(L.geometry=h.toExtent(N,this.context.tilingScheme.spatialReference));this.setResolutionParams(L,F);this.useTileQuery(F)?L.resultType="tile":this.context.capabilities.supportsCacheHint&&(L.cacheHint=!0);return L};I.setPagingParameters=function(F,L,N,R){if(!this.context.capabilities.supportsPagination)return!1;F.start=L;0<N&&this.context.capabilities.supportsMaxRecordCountFactor?
(F.maxRecordCountFactor=Math.ceil(N/R),F.num=Math.min(F.maxRecordCountFactor*R,N)):F.num=Math.min(R);return!0};I.getEffectiveTileResolution=function(F){if(null==F.descriptor.resolution)return null;const L=1===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(F.descriptor.resolution,L)/this.lodFactor};I.setResolutionParams=function(F,L){this.supportsResolution&&(L=this.getEffectiveTileResolution(L),null!=L&&(this.context.capabilities.supportsQuantization?
F.quantizationParameters=new n({mode:"view",originPosition:"upper-left",tolerance:L,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(F.maxAllowableOffset=L)))};I._removeEmptyFeatures=function(F){const L=F.length;for(let N=0;N<F.length;)m.hasVertices(F[N].geometry)?++N:(F[N]=F[F.length-1],--F.length);return L-F.length};I.needsNumFeatures=function(F){return this.useTileCount&&F.needsFeatureCount&&!A(F)};I.getMaxRecordCount=function(F){const {tileMaxRecordCount:L,maxRecordCount:N}=
this.context;return this.useTileQuery(F)&&w.isSome(L)&&0<L&&this.context.capabilities.supportsResultType?L:w.isSome(N)&&0<N?N:2E3};I.useTileQuery=function(F){return A(F)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};I._handleRequest=function(F,L,N,R){F.fetchStatus=F.needsRefetching?3:2;F.requestController=N;let S=!1;L.then(P=>{F.requestController=null;F.fetchStatus=P}).catch(P=>{F.requestController===N&&(F.requestController=null,F.fetchStatus=4);e.isAbortError(P)?
S=!0:R(P)}).then(()=>{S||this.setDirty();this.scheduleUpdated()})};I.scheduleUpdated=function(){this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(l.schedule(()=>{this.handles.remove("scheduleUpdated");this.updated()}),"scheduleUpdated")};I.showTile=function(F){if(w.isSome(F.displayingFeatures)&&!F.needsDisplayUpdate)return!1;var L=F.features;if(0===F.featureLimit||!L)return L=w.isSome(F.displayingFeatures)&&0<F.displayingFeatures.length,this.hideTileFeatures(F),F.displayingFeatures=
[],L;const N=F.descriptor.resolution,R=this.changes.updates,S=this.changes.adds,P=Math.min(F.featureLimit,L.length);F.featureLimit=P;for(let V=0;V<P;++V){var Q=L[V];const ca=m.getObjectId(Q,this.objectIdField),ba=this.displayingFeatureReferences.get(ca);ba?(Q=ba.ref(Q,N),Q.oldVersion!==Q.newVersion&&(R.removes.push(Q.oldVersion),R.adds.push(Q.newVersion))):(this.displayingFeatureReferences.set(ca,new this.FeatureReferenceClass(Q,N)),S.push(Q));this.numDisplayingFeatureReferences++}this.hideTileFeatures(F);
this.applyChanges();F.displayingFeatures=L.slice(0,P);return!0};I.hideTile=function(F){this.cancelFetchTile(F);this.hideTileFeatures(F)};I.hideTileFeatures=function(F){if(!w.isNone(F.displayingFeatures)){var L=this.changes.updates,N=this.changes.removes;for(const S of F.displayingFeatures){const P=m.getObjectId(S,this.objectIdField);var R=this.displayingFeatureReferences.get(P);R&&((R=R.unref(F.descriptor.resolution),this.numDisplayingFeatureReferences--,R)?R.oldVersion!==R.newVersion&&(null==R.newVersion?
(this.displayingFeatureReferences.delete(P),N.push(R.oldVersion)):(L.adds.push(R.newVersion),L.removes.push(R.oldVersion))):console.error("Hiding unreferenced feature"))}this.applyChanges();F.displayingFeatures=null}};I.applyChanges=function(){var F=this.changes.updates;0<F.removes.length&&(this.features.removeMany(F.removes),F.removes.length=0);0<F.adds.length&&(this.features.addMany(F.adds),F.adds.length=0);F=this.changes.adds;const L=this.changes.removes,N=Math.min(F.length,L.length);let R=0;for(;R<
N;){const S=Math.min(R+200,N);this.features.addMany(F.slice(R,S));this.features.removeMany(L.slice(R,S));R=S}F.length>N&&this.features.addMany(0===R?F:F.slice(R));L.length>N&&this.features.removeMany(0===R?L:L.slice(R));F.length=0;L.length=0};I.clearTile=function(F){this.hideTile(F);F.features&&w.isSome(this.context.memoryCache)&&this.context.memoryCache.put(F.id,F.cache,16+F.estimatedSize);F.setFeatures(null,0,null);this.invalidateCounts()};I.invalidateCounts=function(){this.notifyChange("totalVertices");
this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};I.getListOfTiles=function(){return Array.from(this.featureTiles.values())};I.maximumFeaturesForTile=function(F){const L=F.hasPreciseFeatureCount?F.numFeatures:Infinity;return Math.min(Math.ceil((F.hasPreciseFeatureCount?L:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-F.emptyFeatureRatio)),L)};p._createClass(O,[{key:"maximumNumberOfFeatures",set:function(F){F=F||Infinity;const L=this._get("maximumNumberOfFeatures");
F===L||1>F||(this._set("maximumNumberOfFeatures",F),this.maximumFeaturesUpdated(L,F))}},{key:"memoryFactor",set:function(F){this.memoryFactor!==F&&(this._set("memoryFactor",F),this.setDirty())}},{key:"lodFactor",set:function(F){this.lodFactor!==F&&(this._set("lodFactor",F),this.supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&w.isSome(this.context.query.queryFeatureCount)},set:function(F){this._useTileCount=F;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",
get:function(){let F=0;this.featureTiles.forEach(L=>F+=L.estimatedUnusedSize);return F}},{key:"totalVertices",get:function(){let F=0;this.featureTiles.forEach(L=>F+=L.numVertices);return F}},{key:"totalFeatures",get:function(){let F=0;this.featureTiles.forEach(L=>F+=L.numFeatures);return F}},{key:"filterExtent",set:function(F){if(F&&this.context.tilingScheme&&!F.spatialReference.equals(this.context.tilingScheme.spatialReference))K.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");
else{var L=this._get("filterExtent");L===F||L&&F&&L.equals(F)||(F=F?F.clone():null,this._set("filterExtent",F),this.reclip(F,L))}}},{key:"paused",get:function(){return this.suspended||!!this.pendingEdits}},{key:"availableFields",get:function(){let F=null;this.featureTiles.forEach(L=>{w.isNone(L.displayingFeatures)||0===L.displayingFeatures.length||(w.isNone(F)?F=new Set(L.availableFields):F.forEach(N=>{L.availableFields.has(N)||w.unwrap(F).delete(N)}))});return w.isSome(F)?F:new Set}},{key:"running",
get:function(){return this.updating}},{key:"supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"storedFeatures",get:function(){return this.getListOfTiles().reduce((F,L)=>F+(L.features?L.features.length:0),0)}},{key:"test",get:function(){return{process:F=>this.runTask(F),getFeatureTileById:F=>this.featureTiles.get(F),forEachFeatureTile:F=>this.featureTiles.forEach(F)}}}]);return O}(r);b.__decorate([d.property({constructOnly:!0})],
a.FeatureTileFetcher3D.prototype,"features",void 0);b.__decorate([d.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);b.__decorate([d.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([d.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);b.__decorate([d.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);b.__decorate([d.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",
null);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updating",void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",
null);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalVertices",null);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);b.__decorate([d.property()],a.FeatureTileFetcher3D.prototype,
"filterExtent",null);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);a.FeatureTileFetcher3D=b.__decorate([t.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],a.FeatureTileFetcher3D);const M=h.create(),H=h.create();b=a.FeatureTileFetcher3D;a.contextCapabilitiesFromLayer=function(J){const O=J.capabilities.query;a:switch(J.geometryType){case "polyline":J=!0;break a;case "polygon":J=J.capabilities&&J.capabilities.query&&J.capabilities.query.supportsQuantization;
break a;default:J=!1}return{supportsMultipleResolutions:J,supportsPagination:!(!O||!O.supportsPagination),supportsResultType:!(!O||!O.supportsResultType),supportsCacheHint:!(!O||!O.supportsCacheHint),supportsQuantization:!(!O||!O.supportsQuantization),supportsQuantizationEditMode:!(!O||!O.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!O||!O.supportsMaxRecordCountFactor),supportsFormatPBF:!(!O||!O.supportsFormatPBF)}};a["default"]=b;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/support/featureReference":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../layers/graphics/dehydratedFeatures","../../../../layers/graphics/dehydratedFeatureComparison"],function(a,p,b,r){b=function(){function f(e,l){this.highestResolutionVersion=null;this.versions=[];this.ref(e,l)}var w=f.prototype;w.ref=function(e,l){const g=this.feature;y.oldVersion=g;this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});
for(var d of this.versions)if(d.resolution===l){d.refCount++;if((l=this.highestResolutionVersion===d&&!r.equals(e,d.feature))||this.highestResolutionVersion!==d)d.feature=e;y.newVersion=l?e:g;return y}d={feature:e,resolution:l,refCount:1};this.versions.push(d);!this.highestResolutionVersion||l<this.highestResolutionVersion.resolution?(y.newVersion=e,this.highestResolutionVersion=d):y.newVersion=g;return y};w.unref=function(e){for(let l=0;l<this.versions.length;l++){const g=this.versions[l];if(g.resolution===
e)return g.refCount--,y.oldVersion=this.feature,0===g.refCount&&(this.versions[l]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===g&&(this.recalculateHighestResolutionVersion(),y.oldVersion=g.feature)),y.newVersion=this.feature,y}return null};w.recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{var e=this.versions[0];for(let l=1;l<this.versions.length;l++){const g=this.versions[l];g.resolution<
e.resolution&&(e=g)}this.highestResolutionVersion=e}};p._createClass(f,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},{key:"feature",get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null}}]);return f}();let q=function(){function f(e){this._feature=e;this.refCount=1}var w=f.prototype;w.ref=function(e){++this.refCount;y.oldVersion=this._feature;
this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});r.equals(this._feature,e)||(this._feature=e);y.newVersion=this._feature;return y};w.unref=function(){y.oldVersion=this._feature;if(0<this.refCount&&(this.refCount--,!this.isReferenced))return y.newVersion=null,y;y.newVersion=this._feature;return y};p._createClass(f,[{key:"isReferenced",get:function(){return 0!==this.refCount}},{key:"isSingle",get:function(){return 1===this.refCount}},{key:"feature",get:function(){return this._feature}}]);
return f}();const y={oldVersion:null,newVersion:null};a.MultiFeatureReference=b;a.SingleFeatureReference=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),function(a,p,b,r,q,y){const f=new Set;let w=function(){function l(d){this.descriptor=
d;this.fetchStatus=0;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=f;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}var g=l.prototype;g.setFeatures=function(d,c,u){this._availableFields=r.unwrapOr(u,f);this._features=d;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=
!0;d&&0<d.length?(this._emptyFeatureRatio=c/(d.length+c),this._numVertices=d.reduce((t,h)=>t+y.numVertices(h.geometry),0)):this._numVertices=this._emptyFeatureRatio=0};g.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var d=0;d<this._features.length;++d){const c=y.estimateSize(this._features[d]);this._estimatedSize+=c;d>=this.featureLimit&&(this._estimatedUnusedSize+=c)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=
0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(d=this.featureLimit;d<this._features.length;++d)this._estimatedUnusedSize+=y.estimateSize(this._features[d]);return!0}return!1};g.resetFetching=function(){this.fetchStatus=3===this.fetchStatus?1:0};g.intersects=function(d){if(!d||!this.descriptor.extent)return!0;q.fromExtent(d,e);return q.intersects(this.descriptor.extent,e)};g.intersectionIncludingBorrowed=function(d,c){const u=r.isSome(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:
this.descriptor.extent;if(!d&&!u)return q.copy(c,q.POSITIVE_INFINITY),c;d?(q.fromExtent(d,c),q.intersection(c,u,c)):q.copy(c,u);return c};g._shuffle=function(d){this._features.sort((c,u)=>y.getObjectId(c,d)-y.getObjectId(u,d));b.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};g.reduceFeatures=function(d,c,u){if(0>=d)return!1;if(!this._features)return this.featureLimit=0,!1;let t=!1;this.featureLimit=Math.ceil(this.numFeatures*d);this.featureLimit>this._features.length&&
(this.featureLimit=this._features.length,4===this.fetchStatus&&0<this._features.length&&(this.fetchStatus=1,t=!0));!this._shuffled&&1>d&&this._shuffle(u);d=Math.max(this.featureLimit,Math.ceil(c*this.numFeatures));this._features.length>d&&(this._features.length=d,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4));return t};p._createClass(l,[{key:"displayingFeatures",get:function(){return this._displayingFeatures},set:function(d){this._displayingFeatures=d;this.extentIncludingBorrowedFeatures=
null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit},set:function(d){this._featureLimit!==d&&(this._featureLimit=d,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},
{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(d){this._numFeatures=d}},{key:"hasPreciseFeatureCount",get:function(){return-1<this._numFeatures}},{key:"needsFeatureCount",get:function(){return-1===this._numFeatures}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){this.updateMemoryEstimates();return this._estimatedSize}},
{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"isFetching",get:function(){return 2===this.fetchStatus||3===this.fetchStatus}},{key:"isRefetching",get:function(){return 3===this.fetchStatus}},{key:"needsFetching",get:function(){return 0===this.fetchStatus||1===this.fetchStatus}},{key:"needsRefetching",get:function(){return 1===this.fetchStatus}},{key:"isFetched",get:function(){return 4===this.fetchStatus||5===this.fetchStatus}},{key:"needsDisplayUpdate",get:function(){var d;
if(d=!!this._features){a:{d=this._features;var c=this.displayingFeatures,u=this.featureLimit;if(r.isNone(c)||r.isNone(d)||u!==c.length||u>d.length)d=!1;else{for(let t=0;t<u;++t)if(d[t]!==c[t]){d=!1;break a}d=!0}}d=!d}return d}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(d){this.requestController=
null;this._availableFields=d.availableFields;this._features=d.features;this._numFeatures=d.numFeatures;this._emptyFeatureRatio=d.emptyFeatureRatio;this.fetchStatus=d.fetchStatus;this.featuresMissing=d.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}]);return l}();const e=q.create();a.FAILED_FEATURE_COUNT=-2;a.FeatureTile=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),
function(a,p,b,r,q,y,f,w,e){const l=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let g=function(){function d(u,t,h){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=u;this.view=h;this.tilingScheme=new e(t);this.loadedSymbols=l.map(m=>new f(new q({material:{color:[m[0],
m[1],m[2],.6]},outline:{color:"black",size:1}})));this.loadingSymbols=[new f(new q({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new f(new q({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new f(new q({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}var c=d.prototype;c.destroy=function(){this.enabled=!1};c.update=function(){this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:u=>
u.isFetching,symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:u=>!u.isFetching,symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:u=>!u.isFetching,symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(u=>{this.view.graphics.removeMany(u)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(u=>{this.view.graphics.removeMany(u)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(u=>
{this.view.graphics.removeMany(u)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};c.showDataExtent=function(u){this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);u&&(u=r.fromExtent(u),this.dataExtentGraphic=new b({geometry:u,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};c.synchronizeMaps=function(u,t){const h=[];u.forEach((m,
n)=>{const z=this.tileFetcher.test.getFeatureTileById(n);z&&t.filter(z)||(this.view.graphics.removeMany(m),h.push(n))});h.forEach(m=>u.delete(m));this.tileFetcher.test.forEachFeatureTile(m=>{if(t.filter(m)&&!u.has(m.id)){const [k,v,x]=m.descriptor.lij;this.tilingScheme.ensureMaxLod(k);var n=this.tilingScheme.getExtentGeometry(k,v,x),z=new b({geometry:n,symbol:t.symbols[k%t.symbols.length]});n=new b({geometry:n.center,symbol:new y({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",
border:{color:"black"}},symbolLayers:[new w({text:`${k}/${v}/${x}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})});z=[z,n];u.set(m.id,z);this.view.graphics.addMany(z)}})};p._createClass(d,[{key:"enabled",get:function(){return this._enabled},set:function(u){this._enabled=u;this.update()}}]);return d}();a.FeatureTileFetcher3DDebugger=g;a["default"]=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../renderers/support/renderingInfoUtils ../../../rest/support/Query ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./support/projectExtentUtils ../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z){a.FeatureLikeLayerView3D=k=>{k=function(v){function x(){var A=v.apply(this,arguments)||this;A.controller=null;A.updatePolicy=1;A.suspendResumeExtentMode="computed";A.slicePlaneEnabled=!1;A.drapeSourceType=1;A.fullExtentInLocalViewSpatialReference=null;A.suspendResumeExtent=null;A._controllerCreated=!1;A.clippingExtent=null;A.supportsHeightUnitConversion=!0;A.pendingController=null;A.queryEngine=null;return A}p._inheritsLoose(x,v);var C=x.prototype;C.initialize=
function(){const A=this.layer;"isTable"in A&&A.isTable?this.addResolvingPromise(Promise.reject(new r("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:A}))):(this._set("graphics3d",new h({owner:this,layer:A,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,suspendResumeExtentMode:this.suspendResumeExtentMode,
updateClippingExtent:B=>this.updateClippingExtent(B)})),this.updatingHandles.add(this,"updatePolicy",B=>this.graphics3d.graphicsCore.preferredUpdatePolicy=B),this.updatingHandles.add(this,"suspendResumeExtentMode",B=>{this.graphics3d.suspendResumeExtentMode=B}),this.addResolvingPromise(this.graphics3d.setup().then(()=>this.validateGeometryType()).then(()=>this.queryEngine=new m["default"]({layerView:this,priority:z.TaskPriority.FEATURE_QUERY_ENGINE})).then(()=>n.toViewIfLocal(this)).then(B=>this.fullExtentInLocalViewSpatialReference=
B).then(()=>this.initializeController())),this.notifyChange("updating"))};C.destroy=function(){this.destroyPendingController();this.controller=q.destroyMaybe(this.controller);this._set("graphics3d",q.destroyMaybe(this.graphics3d));this.queryEngine=q.destroyMaybe(this.queryEngine);this.loadedGraphics=null};C.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};C.notifyGraphicGeometryChanged=function(A){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(A)};
C.notifyGraphicVisibilityChanged=function(A){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(A)};C.getRenderingInfo=function(A,B,D){A=u.getRenderingInfo(A,{renderer:B,arcade:D});q.isSome(A)&&A.color&&(B=A.color,B[0]/=255,B[1]/=255,B[2]/=255);return A};C.getRenderingInfoAsync=function(){var A=p._asyncToGenerator(function*(B,D,E,G){return u.getRenderingInfoAsync(B,{renderer:D,arcade:E,...G})});return function(B,D,E,G){return A.apply(this,arguments)}}();C.getGraphicFromGraphicUid=function(A){var B;
let D=null;null==(B=this.loadedGraphics)?void 0:B.forEach(E=>{E.uid===A&&(D=d.hydrateGraphic(E,this.layer))});return D};C.whenGraphicBounds=function(A,B){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(A,B):null};C.computeAttachmentOrigin=function(A,B){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(A,B):null};C.getSymbolLayerSize=function(A,B){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(A,B):null};C.queryFeatures=function(A,
B){return this.queryEngine.executeQuery(this._ensureQuery(A),q.get(B,"signal"))};C.queryObjectIds=function(A,B){return this.queryEngine.executeQueryForIds(this._ensureQuery(A),q.get(B,"signal"))};C.queryFeatureCount=function(A,B){return this.queryEngine.executeQueryForCount(this._ensureQuery(A),q.get(B,"signal"))};C.queryExtent=function(A,B){return this.queryEngine.executeQueryForExtent(this._ensureQuery(A),q.get(B,"signal"))};C._ensureQuery=function(A){return q.isNone(A)?this.createQuery():t.from(A)};
C.highlight=function(A){return this.graphics3d.highlight(A,this.layer.objectIdField)};C.maskOccludee=function(A){return this.graphics3d.maskOccludee(A)};C.canResume=function(){return v.prototype.canResume.call(this)&&(!this.graphics3d||!this.graphics3d.suspended)};C.getSuspendInfo=function(){const A=v.prototype.getSuspendInfo.call(this);return this.graphics3d?{...A,...this.graphics3d.suspendInfo}:A};C.isUpdating=function(){var A,B;return!this.graphics3d||this.graphics3d.destroyed?!1:!(this._controllerCreated&&
(null==(A=this.controller)||!A.updating)&&null!=(B=this.view.basemapTerrain)&&B.ready&&!this.graphics3d.updating)};C.initializeController=function(){var A=p._asyncToGenerator(function*(){const B=this.createController();this.pendingController=B;yield B.when();this.setControllerWhenInitialized(B)});return function(){return A.apply(this,arguments)}}();C.setControllerWhenInitialized=function(){var A=p._asyncToGenerator(function*(B){try{yield this.when()}catch(D){}this._controllerCreated=!0;this.notifyChange("updating");
!this.isResolved()||this.destroyed?this.destroyPendingController():(yield y.whenTrueOnce(this.view,"basemapTerrain.ready"),this.beforeSetController(B),this.pendingController=null,this.controller=B,this.loadedGraphics=B.graphics,this.notifyChange("updating"))});return function(B){return A.apply(this,arguments)}}();C.updateClippingExtent=function(A){this.clippingExtent=A;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=
A,!0}};C.validateGeometryType=function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":return Promise.reject(new r("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}};C._getResourceInfo=function(){const A=this.controller&&this.controller instanceof c.FeatureTileController3D?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:A?A.maximumNumberOfFeatures:
-1,totalNumberOfFeatures:A?A.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}};p._createClass(x,[{key:"legendEnabled",get:function(){var A,B;return this.canResume()&&!(null!=(A=this.graphics3d)&&null!=(B=A.frustumVisibility)&&B.suspended)}},{key:"graphics3DGraphics",get:function(){return this.graphics3d?
this.graphics3d.graphicsCore.graphics3DGraphics:null}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}},{key:"symbolUpdateType",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);return x}(k);b.__decorate([f.property()],k.prototype,"loadedGraphics",void 0);b.__decorate([f.property()],k.prototype,"suspended",
void 0);b.__decorate([f.property({readOnly:!0})],k.prototype,"legendEnabled",null);b.__decorate([f.property()],k.prototype,"updating",void 0);b.__decorate([f.property()],k.prototype,"controller",void 0);b.__decorate([f.property()],k.prototype,"graphics3d",void 0);b.__decorate([f.property({readOnly:!0})],k.prototype,"updatePolicy",void 0);b.__decorate([f.property({readOnly:!0})],k.prototype,"suspendResumeExtentMode",void 0);b.__decorate([f.property({type:Boolean})],k.prototype,"slicePlaneEnabled",
void 0);b.__decorate([f.property({readOnly:!0})],k.prototype,"suspendInfo",void 0);return k=b.__decorate([g.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],k)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../rest/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../../../support/WatchUpdatingTracking".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D){r=function(G){function K(H){H=G.call(this,H)||this;H._handles=new y;H.watchUpdatingTracking=new D.WatchUpdatingTracking;H.suspendResumeExtentMode="computed";H.dataExtent=null;H.suspendResumeExtent=null;return H}a._inheritsLoose(K,G);var M=K.prototype;M.normalizeCtorArgs=function(H){const J=H.frustumVisibilityEnabled?new v:null,O=H.scaleVisibilityEnabled?new C:null,I=(H.filterVisibilityEnabled||H.timeExtentVisibilityEnabled)&&"multipatch"!==
H.layer.geometryType?new k.Graphics3DFilterVisibility:null,F=H.elevationAlignmentEnabled?new z:null,L=new n.Graphics3DCore({owner:H.owner,layer:H.layer,preferredUpdatePolicy:H.preferredUpdatePolicy,elevationFeatureExpressionEnabled:H.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:H.owner.hasZ,hasM:H.owner.hasM}),{updateClippingExtent:N,suspendResumeExtentMode:R,dataExtent:S}=H;return{graphicsCore:L,frustumVisibility:J,scaleVisibility:O,filterVisibility:I,elevationAlignment:F,updateClippingExtent:N,
suspendResumeExtentMode:R,dataExtent:S}};M.initialize=function(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",()=>this.scaleVisibility.layerMinMaxScaleChangeHandler());this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",()=>this.filterVisibility.filterChanged()),this.watchUpdatingTracking.add(this.owner,"timeExtent",()=>this.filterVisibility.filterChanged()));this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",
(H,J)=>{u.diff(H,J)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())});this.watchUpdatingTracking.add(this.layer,"labelsVisible",()=>this.graphicsCore.updateVisibilityInfo());this.watchUpdatingTracking.add(this.layer,"labelingInfo",(H,J)=>{u.diff(H,J)&&this.graphicsCore.updateLabelingInfo()})};M.setup=function(){var H=a._asyncToGenerator(function*(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const J=this.owner,O=this.owner.view.basemapTerrain,I=
(F,L,N)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(F,L,N);this.scaleVisibility&&this.scaleVisibility.setup(J,this.layer,I,this.graphicsCore,O);this.filterVisibility&&("filter"in J||"timeExtent"in J)&&this.filterVisibility.setup(J,this.graphicsCore);this.elevationAlignment&&this.elevationAlignment.setup(J,I,this.graphicsCore,J.view.elevationProvider);this._set("objectStates",new x.Graphics3DObjectStates(this.graphicsCore));this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,
this.scaleVisibility));this._set("deconfliction",J.view.deconflictor.addGraphicsOwner(this.graphicsCore));yield f.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}));this.watchUpdatingTracking.add(this.layer,"renderer",F=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(F)));this.watchUpdatingTracking.add(J,
"fullOpacity",()=>this.graphicsCore.opacityChange());this.setupSuspendResumeExtent();this.updateClippingExtent&&(this.watchUpdatingTracking.add(J.view,"clippingArea",()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&(yield f.logOnError(this.graphicsCore.updateLabelingInfo()))});return function(){return H.apply(this,arguments)}}();M.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);var H=
"watchUpdatingTracking frustumVisibility scaleVisibility filterVisibility elevationAlignment objectStates graphicsCore".split(" ");for(const J of H)if(H=this[J])H.destroy(),this._set(J,null);this._set("layer",null);this._set("owner",null)};M.maskOccludee=function(H){const {set:J,handle:O}=this.objectStates.acquireSet(1,null);this.objectStates.setUid(J,H.uid);return O};M.highlight=function(H,J){if(H instanceof h){const {set:O,handle:I}=this.objectStates.acquireSet(0,J);this.owner.queryObjectIds(H).then(F=>
this.objectStates.setObjectIds(O,F));return I}if("number"===typeof H||"string"===typeof H||H instanceof b)return this.highlight([H],J);"toArray"in H&&(H=H.toArray());if(Array.isArray(H)&&0<H.length){if(H[0]instanceof b)if(null!=B.attributeLookup(this.layer.fieldsIndex,H[0].attributes,J))H=H.map(O=>B.attributeLookup(this.layer.fieldsIndex,O.attributes,J));else{H=H.map(F=>F.uid);const {set:O,handle:I}=this.objectStates.acquireSet(0,null);this.objectStates.setUids(O,H);return I}if("number"===typeof H[0]||
"string"===typeof H[0]){const {set:O,handle:I}=this.objectStates.acquireSet(0,J);this.objectStates.setObjectIds(O,H);return I}}return E};M._updateClippingExtent=function(){const H=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(H,this.owner.view.spatialReference)&&(this.updateClippingExtent(H)||this.graphicsCore.recreateAllGraphics())};M.setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(w.init(this,"suspendResumeExtentMode",()=>
{this._handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this._handles.add([w.init(this.graphicsCore,"computedExtent",H=>this.updateSuspendResumeExtent(H)),this.graphicsCore.watch("extentPadding",()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this._handles.add([w.init(this,"dataExtent",H=>this.updateSuspendResumeExtent(H)),this.graphicsCore.watch("extentPadding",()=>this.updateSuspendResumeExtent(this.dataExtent))],
"suspendResumeExtentMode");break;default:q.neverReached(this.suspendResumeExtentMode)}}))};M.updateSuspendResumeExtent=function(H){H?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(H,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};M.extentToSuspendResumeRect=function(H,J){const O=this.owner.view.spatialReference;if(!H.spatialReference.equals(O)){if(!t.canProject(H,O))return;H=t.project(H,O)}return A.enlargeExtent(H,J,m.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};
M.suspendResumeExtentChanged=function(H){this.frustumVisibility&&this.frustumVisibility.setExtent(H);this.scaleVisibility&&this.scaleVisibility.setExtent(H)};a._createClass(K,[{key:"suspended",get:function(){var H;return null==(H=this.scaleVisibility)?void 0:H.suspended}},{key:"suspendInfo",get:function(){var H,J;const O={};null!=(H=this.scaleVisibility)&&H.suspended&&(O.outsideScaleRange=!0);null!=(J=this.frustumVisibility)&&J.suspended&&(O.outsideOfView=!0);return O}},{key:"updating",get:function(){var H,
J,O;return!!(null!=(H=this.graphicsCore)&&H.updating||null!=(J=this.frustumVisibility)&&J.updating||null!=(O=this.watchUpdatingTracking)&&O.updating)}}]);return K}(r);p.__decorate([e.property({aliasOf:"graphicsCore.layer"})],r.prototype,"layer",void 0);p.__decorate([e.property({aliasOf:"graphicsCore.owner"})],r.prototype,"owner",void 0);p.__decorate([e.property({constructOnly:!0})],r.prototype,"updateClippingExtent",void 0);p.__decorate([e.property({constructOnly:!0})],r.prototype,"graphicsCore",
void 0);p.__decorate([e.property({constructOnly:!0})],r.prototype,"scaleVisibility",void 0);p.__decorate([e.property({constructOnly:!0})],r.prototype,"filterVisibility",void 0);p.__decorate([e.property({constructOnly:!0})],r.prototype,"elevationAlignment",void 0);p.__decorate([e.property({constructOnly:!0})],r.prototype,"frustumVisibility",void 0);p.__decorate([e.property({readOnly:!0})],r.prototype,"deconfliction",void 0);p.__decorate([e.property({readOnly:!0})],r.prototype,"labeling",void 0);p.__decorate([e.property({readOnly:!0})],
r.prototype,"objectStates",void 0);p.__decorate([e.property({readOnly:!0})],r.prototype,"watchUpdatingTracking",void 0);p.__decorate([e.property()],r.prototype,"suspendResumeExtentMode",void 0);p.__decorate([e.property()],r.prototype,"dataExtent",void 0);p.__decorate([e.property({readOnly:!0})],r.prototype,"suspended",null);p.__decorate([e.property({readOnly:!0})],r.prototype,"suspendInfo",null);p.__decorate([e.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating",
"watchUpdatingTracking.updating"]})],r.prototype,"updating",null);r=p.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],r);const E={remove(){},pause(){},resume(){}};return r})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../symbols ../../../../core/Accessor ../../../../core/has ../../../../core/Error ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N,R,S,P,Q,V,ca,ba,Z,ha,fa,aa,W,U,X,T,Y,ea,ia,la,pa,ua,wa,Fa,La,Ma,Sa){var Ia;const va=H.create(),ma=O.create(),ta=n.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");a.Graphics3DCore=Ia=function(Ja){function Ta(qa){var ra=Ja.call(this,qa)||this;ra.propertiesPool=new ia.PropertiesPool({computedExtent:wa},p._assertThisInitialized(ra));ra.computedExtent=null;ra.currentRenderer=null;ra.rendererHasGeometryOperations=
!1;ra.graphicStateTracking=null;ra.symbolCreationContext=new ha.Graphics3DSymbolCreationContext((Da,Pa)=>ra._frameTask.schedule(Da,Pa));ra.graphics3DGraphics=new Map;ra.stageLayer=null;ra.stage=null;ra.graphicsDrapedUids=new Set;ra.graphicsBySymbol=new Map;ra.symbolConversionCache=new Map;ra.symbols=new Map;ra.graphicsWithoutSymbol=new Map;ra.graphicsWaitingForSymbol=new Set;ra._handles=new m;ra._frameTask=ua.ImmediateTask;ra.suspendSymbolCleanup=!1;ra._spatialReference=null;ra.arcadeOnDemand=null;
ra.rendererChangeAbortController=null;ra.elevationInfoChangeAbortController=null;ra.setupAbortController=null;ra.elevationAlignment=null;ra.scaleVisibility=null;ra.filterVisibility=null;ra._spatialIndex=null;ra.extentPadding=0;ra._updatingPendingLoadedGraphicsChange=null;ra.featureStore=null;ra.deconflictor=null;ra.labeler=null;ra.objectStates=null;ra.viewElevationProvider=null;ra.stageLayerElevationProvider=null;ra.sharedSymbolResourcesOwnerHandle=null;ra.whenGraphics3DGraphicRequests={};ra.pendingUpdates=
new Map;ra.numberOfGraphics=0;ra.numberOfGraphicsProvidingElevation=0;ra.pendingAdds=0;ra.pendingRemoves=0;ra.pendingUpdatesPool=new x({allocator:Da=>Da||new Ea,deallocator:Da=>{Da.clear();return Da}});ra.symbolWarningLogged=!1;ra.geometryWarningLogged=!1;ra.objectIdInvisibleSet=new Set;ra._whenSymbolRemoved=new x;ra.preferredUpdatePolicy=1;ra.forcedUpdatePolicy=null;ra.elevationFeatureExpressionEnabled=!0;ra.owner=null;ra.layer=null;ra.graphicSymbolSupported=!0;ra.getRenderingInfoWithoutRenderer=
!1;ra.hasZ=null;ra.hasM=null;ra._usedMemory=0;ra._visible=void 0;ra._startCreateGraphics=!1;return ra}p._inheritsLoose(Ta,Ja);var da=Ta.prototype;da.getConvertedSymbol=function(qa){if("web-style"===qa.type)return qa.clone();var ra=this.symbolConversionCache.get(qa.id);if(void 0!==ra)return ra;ra=Q.to3D(qa,!0,!1,this.hasLabelingContext(qa));const Da=ra.symbol||null;Da||ra.error&&ta.error(ra.error.message);this.symbolConversionCache.set(qa.id,Da);return Da};da.getSymbolComplexitiesUsedOrRenderer=function(qa){if(v.isNone(qa))return[];
var ra=qa.getSymbols(),Da="backgroundFillSymbol"in qa&&qa.backgroundFillSymbol;if(!(Da||ra&&ra.length))return[];qa=[];Da=this.getSymbolComplexityUsedOrRenderer(Da);v.isSome(Da)&&qa.push(Da);for(const Pa of ra)ra=this.getSymbolComplexityUsedOrRenderer(Pa),v.isSome(ra)&&qa.push(ra);return qa};da.getSymbolComplexityUsedOrRenderer=function(qa){if(v.isNone(qa))return null;const ra=this.symbols.get(qa.id);return v.isSome(ra)?ra.complexity:(qa=this.getConvertedSymbol(qa))?T.defaultSymbolComplexity(qa):null};
da.getSymbolComplexitiesUsed=function(){const qa=[];this.symbols.forEach(ra=>{v.isSome(ra)&&qa.push(ra.complexity)});return qa};da.initialize=function(){this._spatialReference=this.owner.view.spatialReference;this._set("featureStore",new ba["default"]({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:()=>this.spatialIndex,forAllGraphics:qa=>this.graphics3DGraphics.forEach(qa)}))};da.setup=function(){var qa=
p._asyncToGenerator(function*(ra){this.setupAbortController=C.createAbortController();const Da=this.setupAbortController.signal;this._set("elevationAlignment",ra.elevationAlignment);this._set("scaleVisibility",ra.scaleVisibility);this._set("filterVisibility",ra.filterVisibility);this._set("deconflictor",ra.deconflictor);this._set("labeler",ra.labeler);this._set("objectStates",ra.objectStates);const Pa=this.owner.view;this.viewElevationProvider=new V.ViewElevationProvider(this._spatialReference,Pa);
this.initializeStage(Pa,this.layer.uid);this.symbolCreationContext.sharedResources=Pa.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=Pa.sharedSymbolResources.addGraphicsOwner(this.owner);v.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=Pa.sharedSymbolResources.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=Pa.renderCoordsHelper;this.symbolCreationContext.layer=
this.layer;this.symbolCreationContext.layerView=this.owner;this.symbolCreationContext.localOriginFactory=new la.GridLocalOriginFactory(Pa.renderSpatialReference);this.symbolCreationContext.elevationProvider=Pa.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=Qa=>this.notifyGraphicGeometryChanged(Qa);this.symbolCreationContext.notifyGraphicVisibilityChanged=Qa=>this.notifyGraphicVisibilityChanged(Qa);ra=ca.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);
this.symbolCreationContext.featureExpressionInfoContext=yield ca.createContext(ra,this._spatialReference,ta);C.throwIfAborted(Da);this.symbolCreationContext.screenSizePerspectiveEnabled=Pa.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled;ra="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:
"view.screenSizePerspectiveEnabled";this._handles.add([this.watch("suspendedOrOutsideOfView",()=>this._frameTask.reschedule(()=>this.updateLayerVisibility())),this.owner.watch(ra,()=>{const Qa=Pa.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;if(Qa!==this.symbolCreationContext.screenSizePerspectiveEnabled){var na;this.symbolCreationContext.screenSizePerspectiveEnabled=Qa;null==(na=this.labeler)?void 0:na.reset();this.recreateAllGraphics()}}),this.owner.watch("slicePlaneEnabled",
Qa=>this.slicePlaneEnabledChange(!!Qa)),this.owner.view.watch("pixelRatio",()=>this.pixelRatioChange()),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",Qa=>this.physicalBasedRenderingChange(Qa)),B.when(Pa.basemapTerrain,"tilingScheme",Qa=>{Qa.spatialReference.equals(this.symbolCreationContext.overlaySR)||(this.symbolCreationContext.overlaySR=Pa.basemapTerrain.spatialReference);this._handles.has("loaded-graphics")?this.recreateAllGraphics():this._handles.add([B.on(this.owner,
"loadedGraphics","change",na=>this.graphicsCollectionChanged(na),()=>this.recreateAllGraphics()),B.on(this.owner,"loadedGraphics","after-changes",()=>this._signalUpdatingDuringAsyncLoadedGraphicsChange(),()=>this._signalUpdatingDuringAsyncLoadedGraphicsChange())],"loaded-graphics")}),B.whenFalse(this,"asyncUpdates",()=>this.runTask(ua.noBudget),!0),B.init(this,"effectiveUpdatePolicy",Qa=>{v.isSome(this.stageLayer)&&(this.stageLayer.updatePolicy=Qa);this.symbolCreationContext.isAsync=0===this.effectiveUpdatePolicy;
1===Qa&&this.runTask(ua.noBudget)},!0)]);this._frameTask=Pa.resourceController.scheduler.registerTask(ua.TaskPriority.GRAPHICS_CORE,this);this.owner.layer&&"featureReduction"in this.owner.layer&&this._handles.add(this.owner.watch("layer.featureReduction",()=>this.deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");try{yield this.rendererChange(this.layer.renderer)}catch{}C.throwIfAborted(Da);this.setupAbortController=null});return function(ra){return qa.apply(this,
arguments)}}();da.abortSetup=function(){this.setupAbortController&&(this.setupAbortController.abort(),this.setupAbortController=null)};da.destroy=function(){this.abortSetup();this.abortRendererChange();this.abortElevationInfoChange();this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._updatingPendingLoadedGraphicsChange&&(this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=null);this.clear();v.isSome(this.graphicStateTracking)&&
(this.graphicStateTracking.destroy(),this.graphicStateTracking=null);this.stage&&(this.stage.remove(this.stageLayer),this.stage=this.stageLayer=null);this._handles=v.destroyMaybe(this._handles);this._frameTask.remove();this._frameTask=ua.ImmediateTask;this._spatialReference=null;this._set("owner",null);for(const qa in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[qa].reject(new h("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;
this.sharedSymbolResourcesOwnerHandle=v.removeMaybe(this.sharedSymbolResourcesOwnerHandle);this.propertiesPool=v.destroyMaybe(this.propertiesPool);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();this._spatialIndex=v.destroyMaybe(this._spatialIndex);this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",null))};da.clear=function(){var qa;this.objectStates&&this.objectStates.allGraphicsDeleted();v.isSome(this.graphicStateTracking)&&
this.graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(ra=>ra.destroy());null==(qa=this._spatialIndex)?void 0:qa.clear();this.graphics3DGraphics.clear();this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(ra=>{v.isSome(ra)&&ra.destroy()});this.symbols.clear();this.graphicsBySymbol.clear();this.graphicsWithoutSymbol.clear();this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=
this.pendingAdds=0;this.notifyChange("updating");this.notifyChange("running");this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};da.initializeStage=function(qa,ra){this.stage=qa._stage;this.stageLayer=new pa.WebGLLayer({isPickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},ra);this.stage.add(this.stageLayer);qa=this.stageLayer.events;qa.on("objectTransformation",Da=>this.notifyGraphicGeometryChanged(Da.metadata.graphicUid));qa.on("visibilityChanged",
Da=>this.notifyGraphicVisibilityChanged(Da.metadata.graphicUid));qa.on("objectGeometryAdded",Da=>this.notifyGraphicGeometryChanged(Da.object.metadata.graphicUid));qa.on("objectGeometryRemoved",Da=>this.notifyGraphicGeometryChanged(Da.object.metadata.graphicUid));qa.on("vertexAttrsUpdated",Da=>this.notifyGraphicGeometryChanged(Da.object.metadata.graphicUid))};da.notifyGraphicGeometryChanged=function(qa){v.isNone(this.graphicStateTracking)||(qa=this.graphics3DGraphics.get(qa))&&this.graphicStateTracking.updateGraphicGeometry(qa)};
da.notifyGraphicVisibilityChanged=function(qa){v.isNone(this.graphicStateTracking)||(qa=this.graphics3DGraphics.get(qa))&&this.graphicStateTracking.updateGraphicVisibility(qa)};da.updateLayerVisibility=function(){var qa=this.numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;qa=!this.suspendedOrOutsideOfView&&!qa;qa!==this._visible&&((this._visible=qa)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};
da.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};da.getGraphics3DGraphicById=function(qa){return this.graphics3DGraphics.get(qa)};da.getGraphics3DGraphicByObjectId=function(qa){var ra;return null!=(ra=this.owner.layer)&&ra.objectIdField?this._findGraphics3DGraphicByObjectId(qa):null};da._getGraphicObjectID=function(qa,ra=this.owner.layer&&this.owner.layer.objectIdField){return L.getObjectId(qa,ra)};da.updateLabelingInfo=
function(){var qa=p._asyncToGenerator(function*(ra){const Da=this.deconflictor&&this.deconflictor.labelingInfoChange(ra);ra=this.labeler&&this.labeler.labelingInfoChange(ra);yield C.eachAlways([Da,ra])});return function(ra){return qa.apply(this,arguments)}}();da.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};da.runTask=function(qa){this._frameTask.processQueue(qa);this._applyPendingUpdates(qa);this.notifyChange("running");
this.running||this.notifyChange("updating");this.notifyChange("updatingRemaining")};da.setObjectIdVisibility=function(qa,ra){ra?this.objectIdInvisibleSet.delete(qa):this.objectIdInvisibleSet.add(qa);qa=this._findGraphics3DGraphicByObjectId(qa);v.isSome(qa)&&this._updateUserVisibility(qa)};da._findGraphics3DGraphicByObjectId=function(qa){return z.findInMap(this.graphics3DGraphics,ra=>this._getGraphicObjectID(ra.graphic)===qa)};da._updateUserVisibility=function(qa){if(v.isNone(qa))return!1;var ra=qa.graphic;
const Da=this._getGraphicObjectID(ra);ra=ra.visible&&!this.owner.suspended&&(v.isNone(Da)||!this.objectIdInvisibleSet.has(Da));return qa.setVisibilityFlag(0,ra,0)};da.whenGraphics3DGraphic=function(qa){var ra=this.graphics3DGraphics.get(qa.uid);if(ra)return Promise.resolve(ra);if(ra=this.whenGraphics3DGraphicRequests[qa.uid])return ra.promise;ra=C.createDeferred();this.whenGraphics3DGraphicRequests[qa.uid]=ra;return ra.promise};da.boundsForGraphics3DGraphic=function(){var qa=p._asyncToGenerator(function*(ra,
Da){const Pa=this._spatialReference,Qa=this.owner.view.renderSpatialReference,na=this.owner.view.basemapTerrain.spatialReference;var Aa=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:v.isSome(Da)&&Da.useViewElevation,minDemResolution:v.isSome(Da)&&Da.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null;ra=yield ra.getProjectedBoundingBox((Ra,Ua,Wa)=>J.projectBuffer(Ra,Qa,Ua,Ra,Pa,Ua,Wa),(Ra,Ua,Wa)=>J.projectBuffer(Ra,na,Ua,Ra,Pa,Ua,Wa),Aa,v.get(Da,
"signal"));if(!ra)return null;Da=ra.boundingBox;ra.requiresDrapedElevation&&(Aa=this.symbolCreationContext.elevationProvider)&&(O.center(Da,va),Aa=v.unwrapOr(Aa.getElevation(va[0],va[1],0,Pa,"ground"),0),Da[2]=Math.min(Da[2],Aa),Da[5]=Math.max(Da[5],Aa));return{boundingBox:Da,screenSpaceObjects:ra.screenSpaceObjects}});return function(ra,Da){return qa.apply(this,arguments)}}();da.whenGraphicBounds=function(qa,ra){return B.whenOnce(this.owner,"loadedGraphics").then(()=>{const Da=this.owner.layer&&
this.owner.layer.objectIdField,Pa=this.owner.loadedGraphics.find(Qa=>Qa===qa?!0:Da&&Qa.attributes&&qa.attributes&&Qa.attributes[Da]===qa.attributes[Da]);if(Pa)return this.whenGraphics3DGraphic(Pa);throw new h("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(Da=>this.boundsForGraphics3DGraphic(Da,ra))};da.computeAttachmentOrigin=function(qa,ra){qa=this.graphics3DGraphics.get(qa.uid);if(!qa)return null;var Da=qa.computeAttachmentOrigin();if(0===Da.render.num&&0===Da.draped.num)return null;
M.set(Ca,0,0,0);qa=0;if(0<Da.render.num){if(!J.projectVectorToVector(Da.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,ka,ra))return null;M.add(Ca,Ca,ka);qa++}if(0<Da.draped.num){const [Pa,Qa]=Da.draped.origin;Da=v.unwrapOr(this.viewElevationProvider.getElevation(Pa,Qa,"ground"),0);M.set(ka,Pa,Qa,Da);if(!J.projectVectorToVector(ka,this.viewElevationProvider.spatialReference,ka,ra))return null;M.add(Ca,Ca,ka);qa++}1<qa&&M.scale(Ca,Ca,1/qa);return new Fa({x:Ca[0],y:Ca[1],
z:Ca[2],spatialReference:ra})};da.getSymbolLayerSize=function(qa,ra){var Da=this.symbols.get(qa.id);if(v.isNone(Da))throw new h("internal:symbol-not-part-of-view","Symbol is not part of this view");qa=qa.symbolLayers.indexOf(ra);if(-1===qa)throw new h("internal:missing-symbol-layer","Symbol layer is not in symbol");Da=Da.getSymbolLayerSize(qa);if(null==Da)throw new h("internal:missing-size","Symbol layer has no valid size");return Da};da.graphicsCollectionChanged=function(qa){this._startCreateGraphics&&
(this.add(qa.added),this.remove(qa.removed))};da.graphicUpdateHandler=function(qa){var ra=qa.graphic.uid;const Da=this.graphics3DGraphics.get(ra);ra=this.graphicsWithoutSymbol.get(ra);if(Da||ra)switch(qa.property){case "visible":this.graphicUpdateVisibleHandler(Da);break;case "geometry":this.graphicUpdateGeometryHandler(Da,qa);break;case "symbol":this.graphicUpdateSymbolHandler(Da,qa)}};da.graphicUpdateGeometryHandler=function(qa,ra){const Da=ra.graphic.geometry;if(v.isNone(Da))this.recreateGraphic(ra.graphic);
else if(v.isNone(qa)){if(qa=ra.graphic.symbol&&ra.graphic.symbol.id)if(qa=this.symbols.get(qa),v.isSome(qa)&&0===qa.loadStatus)return;this.recreateGraphic(ra.graphic)}else{var Pa=qa.graphics3DSymbol;!v.isNone(ra.newValue)&&Pa.updateGeometry(qa,ra.newValue)||this.recreateGraphic(qa.graphic);this.expandComputedExtent(Da)}};da.graphicUpdateSymbolHandler=function(qa,ra){var Da=ra.graphic;const Pa=v.isSome(qa)?qa.graphics3DSymbol:v.isSome(ra.oldValue)?this.symbols.get(ra.oldValue.id):null;if(v.isNone(Pa)||
v.isNone(ra.newValue))this.recreateGraphic(Da);else{var Qa=Pa.symbol;ra=this.getConvertedSymbol(ra.newValue);if(ra.type!==Qa.type||"web-style"===ra.type||"web-style"===Qa.type)this.recreateGraphic(Da);else{var na=this.graphicsBySymbol.get(Qa.id);if(na&&1!==na.size)this.recreateGraphic(Da);else if(na=K.diff(Qa,ra),v.isNone(na))this.updateSymbolMapping(Qa.id,ra);else if(na={diff:na,graphics3DGraphicPatches:[],symbolStatePatches:[]},Pa.prepareSymbolPatch(na),K.isEmpty(na.diff)){var Aa=this._getRenderingInfo(Da);
if(v.isNone(Aa))this.recreateGraphic(Da);else{Da=Pa.extentPadding;for(const Ra of na.symbolStatePatches)Ra();Da!==Pa.extentPadding&&this.recomputeExtentPadding();if(v.isSome(qa))for(const Ra of na.graphics3DGraphicPatches)Ra(qa,Aa);this.updateSymbolMapping(Qa.id,ra)}}else this.recreateGraphic(Da)}}};da.graphicUpdateVisibleHandler=function(qa){this._updateUserVisibility(qa)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};da.recreateGraphics=function(qa){this.suspendSymbolCleanup=
!0;this.remove(qa);this.add(qa);this.suspendSymbolCleanup=!1;1===this.effectiveUpdatePolicy&&this._cleanupSymbols()};da.recreateGraphic=function(qa){this.recreateGraphics([qa])};da._beginGraphicUpdate=function(qa){this.graphicsWaitingForSymbol.add(qa.uid);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating")};da._endGraphicUpdate=function(qa){qa&&(this.graphicsWaitingForSymbol.delete(qa.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))};
da.recomputeExtentPadding=function(){let qa=0;this.symbols.forEach(ra=>{v.isSome(ra)&&(qa=Math.max(qa,ra.extentPadding))});this._set("extentPadding",qa)};da.expandComputedExtent=function(qa){var ra=qa.spatialReference;L.computeAABB(qa,ma);qa=this._spatialReference;var Da=Ia.tmpVec;!ra.equals(qa)&&J.projectXYZToVector(ma[0],ma[1],0,ra,Da,qa)&&(ma[0]=Da[0],ma[1]=Da[1],J.projectXYZToVector(ma[3],ma[4],0,ra,Da,qa),ma[3]=Da[0],ma[4]=Da[1]);if(k.isFinite(ma[0])&&k.isFinite(ma[3])&&k.isFinite(ma[1])&&k.isFinite(ma[4])){ra=
this.computedExtent;Da=null;var Pa=k.isFinite(ma[2])&&k.isFinite(ma[5]),Qa=Pa&&(!ra||null==ra.zmin||ma[2]<ra.zmin);Pa=Pa&&(!ra||null==ra.zmax||ma[5]>ra.zmax);if(ra){if(ma[0]<ra.xmin||ma[1]<ra.ymin||ma[3]>ra.xmax||ma[4]>ra.ymax||Qa||Pa)Da=this.propertiesPool.get("computedExtent"),Da.xmin=Math.min(ma[0],ra.xmin),Da.ymin=Math.min(ma[1],ra.ymin),Da.xmax=Math.max(ma[3],ra.xmax),Da.ymax=Math.max(ma[4],ra.ymax),Da.spatialReference=qa}else Da=this.propertiesPool.get("computedExtent"),Da.xmin=ma[0],Da.ymin=
ma[1],Da.xmax=ma[3],Da.ymax=ma[4],Da.spatialReference=qa;Da&&(Qa&&(Da.zmin=ma[2]),Pa&&(Da.zmax=ma[5]),this._set("computedExtent",Da))}};da.abortElevationInfoChange=function(){this.elevationInfoChangeAbortController&&(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)};da.elevationInfoChange=function(){var qa=p._asyncToGenerator(function*(){this.abortElevationInfoChange();const ra=C.createAbortController();this.elevationInfoChangeAbortController=ra;const Da=
ca.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=yield ca.createContext(Da,this._spatialReference,ta);C.throwIfAborted(ra);this.elevationInfoChangeAbortController=null;this.labeler&&this.labeler.elevationInfoChange();this.forEachGraphics3DSymbol((Pa,Qa,na)=>{Pa.globalPropertyChanged("elevationInfo",Qa)?Qa.forEach(Aa=>{const Ra=Aa.graphic;Aa=Aa.labelGraphics;for(const Ua of Aa)Ua.graphics3DSymbolLayer.updateGraphicElevationContext(Ra,
Ua)}):this._recreateSymbol(na)});this.updateStageLayerElevationProvider();this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()});return function(){return qa.apply(this,arguments)}}();da.updateStageLayerElevationProvider=function(){if(this.stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),
this.stageLayerElevationProvider=null}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this.numberOfGraphicsProvidingElevation&&(this.stageLayerElevationProvider=new Y.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))};da.clearSymbolsAndGraphics=function(){var qa,ra,Da,Pa,Qa;this.clear();null==(qa=this.filterVisibility)?
void 0:qa.clear();null==(ra=this.labeler)?void 0:ra.reset();null==(Da=this.deconflictor)?void 0:Da.clear();null==(Pa=this.elevationAlignment)?void 0:Pa.clear();null==(Qa=this.stageLayer)?void 0:Qa.invalidateSpatialQueryAccelerator();this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)};da.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};
da.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};da._recreateSymbol=
function(qa){var ra=this.graphicsBySymbol.get(qa);const Da=[];ra&&(ra.forEach((Pa,Qa)=>{var na;const Aa=Pa.usedMemory;this._conditionalRemove(Pa,Qa);null==(na=this._spatialIndex)?void 0:na.remove(Pa);Da.push(Pa.graphic);Pa.destroy();this.removeGraphics3DGraphic(Qa,Aa);this.updateLayerVisibility();this.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(qa,new Map));ra=this.symbols.get(qa);v.isSome(ra)&&ra.destroy();this.symbols.delete(qa);this.add(Da)};da._conditionalRemove=function(qa,
ra){qa.isDraped&&this.graphicsDrapedUids.delete(ra);this.objectStates&&this.objectStates.removeGraphic(qa);this.labeler&&this.labeler.removeGraphic(qa);this.deconflictor&&this.deconflictor.removeGraphic(qa);v.isSome(this.graphicStateTracking)&&this.graphicStateTracking.removeGraphic(qa)};da.add=function(qa){qa&&0!==qa.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(0===this._updatePolicyForGraphics(qa)?this._addDelayed(qa):this._addImmediate(qa),this.notifyChange("updating")):
ta.error("#add()","Cannot add graphics before terrain surface has been initialized"))};da._updatePolicyForGraphics=function(qa){if(1===this.effectiveUpdatePolicy&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const ra of qa)if(v.isSome(ra.geometry)&&"mesh"===ra.geometry.type&&!ra.geometry.loaded)return 0;return this.effectiveUpdatePolicy};da._addImmediate=function(qa){this.symbolWarningLogged=this.geometryWarningLogged=!1;for(const ra of qa)this._addGraphic(ra,this._getRenderingInfo(ra,
ta),1);this._cleanupSymbols();this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};da._addDelayed=function(qa){for(const ra of qa){qa=ra.uid;let Da=this.pendingUpdates.get(qa);Da?Da.add?0!==Da.state&&Da.abortController.abort():this.pendingAdds++:(Da=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(qa,Da));Da.add=ra}this.notifyChange("running");this.notifyChange("updatingRemaining")};da.remove=function(qa){0===
this.effectiveUpdatePolicy?this._removeDelayed(qa):this._removeImmediate(qa);this.notifyChange("updating")};da._removeImmediate=function(qa){for(const ra of qa)this._removeGraphic(ra);this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};da._removeDelayed=function(qa){for(const Da of qa){qa=Da.uid;var ra=this.pendingUpdates.get(qa);ra?ra.add&&(ra.remove?ra.add=null:this.pendingUpdates.delete(qa),1===ra.state&&ra.abortController.abort(),this.pendingAdds--):
(ra=this.pendingUpdatesPool.pushNew(),ra.remove=Da,this.pendingUpdates.set(qa,ra),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining")};da._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&ta.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};da._applyPendingUpdates=function(qa){var ra;
this.symbolWarningLogged=this.geometryWarningLogged=!1;if(0===this.pendingUpdates.size&&null!=(ra=this._spatialIndex)&&ra.updating)this._spatialIndex.update();else{for(const [Da,Pa]of this.pendingUpdates){if(qa.done)break;Pa.add&&0===Pa.state&&this._processPendingUpdateNew(Pa);ra=this.effectiveUpdatePolicy;!Pa.remove||Pa.add&&2!==Pa.state||(this.pendingRemoves--,qa.madeProgress(),this._removeGraphic(Pa.remove),Pa.remove=null,ra=1);if(Pa.add)switch(Pa.state){case 2:this._addGraphic(Pa.add,Pa.renderingInfo,
ra);Pa.add=null;this.pendingAdds--;qa.madeProgress();break;case 3:Pa.add=null,this.pendingAdds--}null==Pa.remove&&null==Pa.add&&this.pendingUpdates.delete(Da)}0===this.pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}};da._processPendingUpdateNew=function(qa){if(qa.add){var ra=qa.add.geometry;v.isSome(ra)&&"mesh"===ra.type&&!ra.loaded?this._processPendingUpdateNewMesh(qa,ra):this._processPendingUpdateNewRenderingInfo(qa)}else qa.state=2};da._processPendingUpdateNewMesh=
function(qa,ra){qa.state=1;qa.abortController=C.createAbortController();ra.load({signal:qa.abortController.signal}).then(()=>{qa.abortController=null;this._processPendingUpdateNewRenderingInfo(qa)},Da=>this._processPendingUpdateNewError(qa,Da))};da._processPendingUpdateNewError=function(qa,ra){qa.abortController=null;C.isAbortError(ra)?qa.state=0:qa.state=3};da._processPendingUpdateNewRenderingInfo=function(qa){v.isNone(this.layer.renderer)||"dictionary"!==this.layer.renderer.type?(qa.renderingInfo=
this._getRenderingInfo(qa.add,ta),qa.state=2):(qa.state=1,qa.abortController=C.createAbortController(),this._getRenderingInfoAsync(qa.add,{signal:qa.abortController.signal}).then(ra=>{v.isNone(ra)||v.isNone(ra.symbol)?(ta&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,ta.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),qa.renderingInfo=null):qa.renderingInfo=ra;qa.state=2},ra=>{qa.abortController=null;C.isAbortError(ra)?qa.state=0:qa.state=3}))};da._addGraphic=
function(qa,ra,Da){this.graphicsWithoutSymbol.set(qa.uid,qa);if(!v.isNone(ra)&&!v.isNone(ra.symbol)&&L.hasGeometry(qa)){var Pa=this.getOrCreateGraphics3DSymbol(ra.symbol,ra.renderer);if(!v.isNone(Pa)){this.expandComputedExtent(qa.geometry);this._beginGraphicUpdate(qa);var Qa=new Z(qa,ra,this.layer),na=!1,Aa=Wa=>{Wa===Pa.symbol.id&&(na=!0)};this._whenSymbolRemoved.push(Aa);var Ra=()=>{if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(Aa);if(!(na||Pa.destroyed||this.graphicSymbolSupported&&
qa.symbol&&qa.symbol.id!==Pa.symbol.id)){if(this.graphicsWaitingForSymbol.has(qa.uid)){const Wa=this._createGraphics3DGraphic(Pa,Qa);this._spatialIndex&&v.isSome(Wa)&&this._spatialIndex.add(Wa)}this._endGraphicUpdate(qa)}--Pa.referenced;this.featureStore.events.emit("changed");this.labeler&&this.owner.view.labeler.setDirty()}},Ua=Wa=>{this.destroyed||(this._whenSymbolRemoved.removeUnordered(Aa),na||(C.isAbortError(Wa)?this.add([qa]):Pa.destroyed||this._endGraphicUpdate(qa)))};0===Da?Pa.load(()=>this._frameTask.schedule(Ra),
Wa=>this._frameTask.schedule(()=>Ua(Wa))):Pa.load(Ra,Ua)}}};da._removeGraphic=function(qa){qa=qa.uid;const ra=this.graphics3DGraphics.get(qa);if(ra){var Da;ra.graphics3DSymbol.onRemoveGraphic(ra);const Pa=ra.usedMemory,Qa=ra.isElevationSource;this._conditionalRemove(ra,qa);null==(Da=this._spatialIndex)?void 0:Da.remove(ra);this.graphicsBySymbol.get(ra.graphics3DSymbol.symbol.id).delete(qa);this.graphicsWithoutSymbol.delete(qa);this.removeGraphics3DGraphic(qa,Pa,Qa);ra.destroy();this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(qa),
this.graphicsWaitingForSymbol.delete(qa),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))};da.hasLabelingContext=function(qa){if(qa instanceof La||qa instanceof Ma){const ra=this.symbolCreationContext.layer;return ra.labelingInfo?ra.labelingInfo.some(Da=>Da.symbol===qa):!1}return!1};da.hasValidSymbolCreationContext=function(qa){return qa instanceof La&&!this.hasLabelingContext(qa)?(ta.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),
!1):!0};da._getRenderingInfo=function(qa,ra){const Da=qa.geometry;if(v.isNone(Da))return ra&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,ra.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!J.canProjectWithoutEngine(Da.spatialReference,this._spatialReference))return ra&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,ra.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&
v.isSome(qa.symbol))return ra&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,ra.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;qa=this.rendererHasGeometryOperations?N.hydrateGraphic(qa,this.layer):qa;qa=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||v.isSome(this.currentRenderer))?this.owner.getRenderingInfo(qa,this.currentRenderer,v.unwrap(this.arcadeOnDemand)):{symbol:qa.symbol||P.getDefaultSymbol3D(qa.geometry)};
return v.isNone(qa)||v.isNone(qa.symbol)?(ra&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,ra.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):qa};da._getRenderingInfoAsync=function(qa,ra){if(v.isNone(qa.geometry))return ta&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,ta.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&v.isSome(qa.symbol))return ta&&!this.symbolWarningLogged&&
(this.symbolWarningLogged=!0,ta.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;qa=this.rendererHasGeometryOperations?N.hydrateGraphic(qa,this.layer):qa;return this.owner.getRenderingInfoAsync(qa,v.unwrap(this.currentRenderer),v.unwrap(this.arcadeOnDemand),ra)};da.createGraphics3DSymbol=function(qa,ra){if(!this.hasValidSymbolCreationContext(qa))return null;qa=this.getConvertedSymbol(qa);if(!qa)return null;let Da;v.isSome(ra)&&"backgroundFillSymbol"in
ra&&ra.backgroundFillSymbol&&(ra=Q.to3D(ra.backgroundFillSymbol,!1,!0),ra.symbol&&"web-style"!==ra.symbol.type&&(Da=ra.symbol.symbolLayers));const Pa=fa.make(qa,this.symbolCreationContext,Da);Pa.load(()=>{const Qa=Pa.extentPadding;Qa>this.extentPadding&&this._set("extentPadding",Qa);this.notifyChange("averageSymbolComplexity")},()=>{});return Pa};da.getOrCreateGraphics3DSymbol=function(qa,ra){let Da=this.symbols.get(qa.id);void 0===Da&&(Da=qa instanceof Sa?new aa(qa,Pa=>this._frameTask.schedule(Pa),
Pa=>this.createGraphics3DSymbol(Pa,ra)):this.createGraphics3DSymbol(qa,ra),this.symbols.set(qa.id,Da));v.isSome(Da)&&++Da.referenced;return Da};da.trackGraphicState=function(qa){v.isNone(this.graphicStateTracking)&&(this.graphicStateTracking=new W.GraphicStateTracking(this));return this.graphicStateTracking.add(qa)};da.addGraphics3DGraphic=function(qa){this._usedMemory+=qa.usedMemory;this.graphics3DGraphics.set(qa.graphic.uid,qa);this.numberOfGraphics++;qa.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,
this.updateStageLayerElevationProvider());this.updateLayerVisibility()};da.removeGraphics3DGraphic=function(qa,ra,Da=!1){this._usedMemory-=ra;this.graphics3DGraphics.delete(qa);this.numberOfGraphics--;Da&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};da._createGraphics3DGraphic=function(qa,ra){var Da,Pa,Qa,na;const Aa=ra.graphic;this.graphicsWithoutSymbol.delete(Aa.uid);if(!this.symbols.has(qa.symbol.id))return this.add([Aa]),null;
if(this.graphics3DGraphics.has(Aa.uid))return null;ra=qa.createGraphics3DGraphic(ra);if(v.isNone(ra))return null;this.addGraphics3DGraphic(ra);qa=qa.symbol.id;this.graphicsBySymbol.has(qa)||this.graphicsBySymbol.set(qa,new Map);this.graphicsBySymbol.get(qa).set(Aa.uid,ra);ra.isDraped&&this.graphicsDrapedUids.add(Aa.uid);ra.centroid=null;v.isSome(Aa.geometry)&&"point"!==Aa.geometry.type&&(ra.centroid=U.computeCentroid(Aa.geometry,this._spatialReference));this._updateUserVisibility(ra);v.isSome(this.scaleVisibility)&&
this.scaleVisibility.updateVisibility(ra);null==(Da=this.filterVisibility)?void 0:Da.updateVisibility(ra);null==(Pa=this.deconflictor)?void 0:Pa.addGraphic(ra);null==(Qa=this.labeler)?void 0:Qa.addGraphic(ra);null==(na=this.objectStates)?void 0:na.addGraphic(ra);this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,ra);ra.initialize(this.stage,this.stageLayer,this.owner);v.isSome(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(ra);if(Da=this.whenGraphics3DGraphicRequests[Aa.uid])delete this.whenGraphics3DGraphicRequests[Aa.uid],
Da.resolve(ra);return ra};da.abortRendererChange=function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)};da.rendererChange=function(){var qa=p._asyncToGenerator(function*(ra){this.abortRendererChange();if(ra!==this.currentRenderer)if(this.validateRenderer(ra),v.isNone(ra)&&this.currentRendererChange(null,!1),R.isSupportedRenderer3D(ra))if(v.isSome(ra)&&ra.arcadeRequired){var Da=C.createAbortController();this.rendererChangeAbortController=
Da;const {arcadeUtils:Pa}=yield this.ensureArcade();C.throwIfAborted(Da);Pa.hasGeometryOperations(ra)&&(yield Pa.enableGeometryOperations(),C.throwIfAborted(Da));0===this.effectiveUpdatePolicy?yield this._frameTask.schedule(()=>this.currentRendererChange(ra,!0),Da.signal):this.currentRendererChange(ra,!0);this.rendererChangeAbortController=null}else 0===this.effectiveUpdatePolicy?(this.rendererChangeAbortController=Da=C.createAbortController(),yield this._frameTask.schedule(()=>this.currentRendererChange(ra,
!1),Da.signal),this.rendererChangeAbortController=null):this.currentRendererChange(ra,!1);else this.currentRendererChange(ra,!1)});return function(ra){return qa.apply(this,arguments)}}();da.ensureArcade=function(){var qa=p._asyncToGenerator(function*(){v.isNone(this.arcadeOnDemand)&&(this.arcadeOnDemand=yield S.loadArcade());return this.arcadeOnDemand});return function(){return qa.apply(this,arguments)}}();da.currentRendererChange=function(qa,ra){this.currentRenderer=qa;this.rendererHasGeometryOperations=
ra;this.symbolCreationContext.arcade=v.unwrap(this.arcadeOnDemand);ra=this.symbolCreationContext.renderer;if(qa!==ra)if(this.symbolConversionCache.clear(),v.isNone(qa))this.symbolCreationContext.renderer=null,this.recreateAllGraphics();else{var Da=K.diff(ra,qa);this.updateUnchangedSymbolMappings(Da,qa,ra);this.symbolCreationContext.renderer=qa;v.isNone(Da)||("complete"===Da.type?this.recreateAllGraphics():"partial"===Da.type&&(this.applyRendererDiff(Da,qa,ra)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),
this.notifyChange("averageSymbolComplexity"))}};da.diffHasSymbolChange=function(qa){for(const ra in qa.diff)switch(ra){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete qa.diff[ra];break;default:return!0}return!1};da.applySymbolSetDiff=function(qa,ra,Da){qa=qa||[];ra=ra||[];const Pa=[];for(const Qa of ra){const na=this.graphicsBySymbol.get(Qa.id);na&&na.forEach((Aa,Ra)=>{var Ua=Aa.graphic,Wa=this.layer instanceof F?this.layer:
null;const ab=v.unwrap(this.arcadeOnDemand);if(Qa!==Da.defaultSymbol||Da.getSymbol(N.hydrateGraphic(Ua,Wa),{arcade:ab})!==Da.defaultSymbol)Wa=Aa.usedMemory,qa.length||Da.defaultSymbol?Pa.push(Ua):this.graphicsWithoutSymbol.set(Ra,Ua),Ua=this.graphics3DGraphics.get(Ra),this._conditionalRemove(Ua,Ra),Aa.destroy(),na.delete(Ra),this.removeGraphics3DGraphic(Ra,Wa),this.updateLayerVisibility()});this._whenSymbolRemoved.forAll(Aa=>Aa(Qa.id))}if(qa.length||Pa.length)this.graphicsWithoutSymbol.forEach(Qa=>
Pa.push(Qa)),this.graphicsWithoutSymbol.clear(),this.add(Pa);this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};da.applyUniqueValueRendererDiff=function(qa,ra,Da){const Pa=qa.diff.defaultSymbol,Qa=qa.diff.uniqueValueInfos;if(Pa||Qa){const na=Qa?Qa.added.map(Ra=>Ra.symbol):[],Aa=Qa?Qa.removed.map(Ra=>Ra.symbol):[];if(Qa)for(let Ra=0;Ra<Qa.changed.length;Ra++)na.push(Qa.changed[Ra].newValue.symbol),Aa.push(Qa.changed[Ra].oldValue.symbol);
Pa?(Da.defaultSymbol&&Aa.push(Da.defaultSymbol),ra.defaultSymbol&&na.push(ra.defaultSymbol)):Da.defaultSymbol&&na.length&&Aa.push(ra.defaultSymbol);this.applySymbolSetDiff(na,Aa,ra);delete qa.diff.defaultSymbol;delete qa.diff.uniqueValueInfos;return!0}return!1};da.calculateUnchangedSymbolMapping=function(qa,ra,Da){const Pa=na=>v.isSome(na)?na.id:null;if(ra instanceof g&&Da instanceof g&&(v.isNone(qa)||"partial"===qa.type)){var Qa=qa&&qa.diff;qa=Qa&&Qa.defaultSymbol;Qa=(Qa=Qa&&Qa.uniqueValueInfos)?
Qa.unchanged.map(na=>({oldId:Pa(na.oldValue.symbol),newId:Pa(na.newValue.symbol)})):Da.uniqueValueInfos.map((na,Aa)=>({oldId:Pa(na.symbol),newId:Pa(ra.uniqueValueInfos[Aa].symbol)}));!qa&&Da.defaultSymbol&&Qa.push({oldId:Pa(Da.defaultSymbol),newId:Pa(ra.defaultSymbol)});return Qa}return[]};da.updateSymbolMapping=function(qa,ra){const Da=ra?"string"===typeof ra?ra:ra.id:null;ra="string"===typeof ra?null:ra;if(qa&&qa!==Da){var Pa=this.graphicsBySymbol.get(qa);this.graphicsBySymbol.delete(qa);void 0!==
Pa&&this.graphicsBySymbol.set(Da,Pa);Pa=this.symbols.get(qa);void 0!==Pa&&(this.symbols.delete(qa),this.symbols.set(Da,Pa),v.isSome(Pa)&&(v.isSome(ra)?Pa.symbol=ra:Pa.symbol.id=Da))}};da.updateUnchangedSymbolMappings=function(qa,ra,Da){qa=this.calculateUnchangedSymbolMapping(qa,ra,Da);for(const {oldId:Pa,newId:Qa}of qa)this.updateSymbolMapping(Pa,Qa)};da.applyRendererDiff=function(qa,ra,Da){if(this.diffHasSymbolChange(qa))return!1;if(ra instanceof g&&Da instanceof g&&this.applyUniqueValueRendererDiff(qa,
ra,Da)&&0===Object.keys(qa.diff).length)return!0;for(const [Pa]of this.graphicsBySymbol)if(Da=this.symbols.get(Pa),v.isSome(Da)&&!Da.applyRendererDiff(qa,ra))return!1;return!0};da.opacityChange=function(){this.forEachGraphics3DSymbol((qa,ra)=>qa.globalPropertyChanged("opacity",ra));this.updateStageLayerVisibility()};da.slicePlaneEnabledChange=function(qa){qa!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=qa,this.stageLayer.isSliceable=qa,this.forEachGraphics3DSymbol((ra,
Da)=>ra.globalPropertyChanged("slicePlaneEnabled",Da)),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};da.physicalBasedRenderingChange=function(qa){qa!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=qa,this.forEachGraphics3DSymbol((ra,Da,Pa)=>{ra.globalPropertyChanged("physicalBasedRenderingEnabled",Da)||this._recreateSymbol(Pa)}))};da.pixelRatioChange=function(){this.forEachGraphics3DSymbol((qa,
ra,Da)=>{qa.globalPropertyChanged("pixelRatio",ra)||this._recreateSymbol(Da)})};da._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=A.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})};da.setClippingExtent=function(qa,ra){const Da=this.symbolCreationContext.clippingExtent,Pa=I.create();ea.toBoundingRect(qa,Pa,ra)?this.symbolCreationContext.clippingExtent=
O.fromRect(O.create(),Pa):this.symbolCreationContext.clippingExtent=null;return!O.equals(this.symbolCreationContext.clippingExtent,Da)};da.modifyGraphics3DGraphicVisibilities=function(qa){let ra=!1;this.graphics3DGraphics.forEach(Da=>{qa(Da)&&(ra=!0)});ra&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};da.forEachGraphics3DSymbol=function(qa){for(const [ra,Da]of this.symbols){if(v.isNone(Da))break;const Pa=this.graphicsBySymbol.get(ra);qa(Da,Pa||sa,ra)}};
da.updateAllGraphicsVisibility=function(){this.filterVisibility&&(this.filterVisibility.dirty=!0);this.modifyGraphics3DGraphicVisibilities(qa=>{const ra=this._updateUserVisibility(qa);qa=v.isSome(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(qa);return ra||qa})};da.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(qa=>qa.setVisibilityFlag(0,!1,0))};da.validateRenderer=function(qa){(qa=R.validateTo3D(qa))&&ta.warn(`Renderer for layer '${this.layer.title?`${this.layer.title}, `:
""}, id:${this.layer.id}' is not supported in a SceneView`,qa.message)};da.volatileGraphicsUpdated=function(){this.labeler&&this.labeler.reset();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};da._cleanupSymbols=function(){if(!(0<this.graphicsWaitingForSymbol.size||this.suspendSymbolCleanup)){var qa=!1;this.symbols.forEach((ra,Da)=>{if(!(v.isNone(ra)||0<ra.referenced)){var Pa=this.graphicsBySymbol.get(Da);Pa&&0!==Pa.size||(this.graphicsBySymbol.delete(Da),this.symbols.delete(Da),
ra&&ra.destroy(),qa=!0)}});qa&&(this.recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}};da.snapshotInternals=function(){return{graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this.symbols.keys()].sort(),graphicsBySymbol:[...this.graphicsBySymbol.keys()].sort().map(qa=>({symbolId:qa,graphics:[...this.graphicsBySymbol.get(qa).keys()].sort()})),graphicsWithoutSymbol:[...this.graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this.graphicsDrapedUids].sort(),
pendingUpdates:this.pendingUpdates}};p._createClass(Ta,[{key:"spatialIndex",get:function(){this._spatialIndex||(this._spatialIndex=new X.SpatialIndex2D({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));this._spatialIndex.update();return this._spatialIndex}},{key:"effectiveUpdatePolicy",get:function(){return v.isSome(this.currentRenderer)&&"dictionary"===
this.currentRenderer.type?0:v.unwrapOr(this.forcedUpdatePolicy,this.preferredUpdatePolicy)}},{key:"updating",get:function(){var qa,ra;return!!(0<this.graphicsWaitingForSymbol.size||this.running||null!=(qa=this.elevationAlignment)&&qa.updating||v.isSome(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(ra=this.filterVisibility)&&ra.updating||this.rendererChangeAbortController||this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating)}},
{key:"running",get:function(){var qa;return 0<this.pendingUpdates.size||!(null==(qa=this._spatialIndex)||!qa.updating)}},{key:"suspendedOrOutsideOfView",get:function(){var qa;return this.owner.suspended||(null==(qa=this.owner.suspendInfo)?void 0:qa.outsideOfView)}},{key:"updatingRemaining",get:function(){var qa,ra;return this.updating?this.pendingUpdates.size+.1*((null==(qa=this._spatialIndex)?void 0:qa.updatingRemaining)||0)+.1*((null==(ra=this.elevationAlignment)?void 0:ra.updatingRemaining)||0):
0}},{key:"displayFeatureLimit",get:function(){var qa=this.owner&&this.owner.view&&this.owner.view.qualitySettings;const ra=qa?qa.graphics3D.minTotalNumberOfFeatures:0,Da=qa?qa.graphics3D.maxTotalNumberOfFeatures:0;qa=qa?qa.graphics3D.maxTotalNumberOfPrimitives:0;const Pa=this.averageSymbolComplexity;var Qa=Math.max(1,v.isSome(Pa)?Pa.primitivesPerFeature:1),na=v.isSome(Pa)&&0<Pa.drawCallsPerFeature?Da/Pa.drawCallsPerFeature*.3:Da;Qa=Math.max(ra,Math.min(Da,Math.ceil(qa/Qa),na));return(na=this._get("displayFeatureLimit"))&&
na.minimumTotalNumberOfFeatures===ra&&na.maximumTotalNumberOfFeatures===Da&&na.maximumTotalNumberOfPrimitives===qa&&na.averageSymbolComplexity===Pa&&na.maximumNumberOfFeatures===Qa?na:{minimumTotalNumberOfFeatures:ra,maximumTotalNumberOfFeatures:Da,maximumTotalNumberOfPrimitives:qa,averageSymbolComplexity:Pa,maximumNumberOfFeatures:Qa}}},{key:"averageSymbolComplexity",get:function(){const qa=T.averageSymbolComplexities(this.symbolComplexities),ra=this._get("averageSymbolComplexity");return 0===qa.numComplexities||
v.isSome(ra)&&(qa.estimated&&(ra.primitivesPerFeature>=qa.primitivesPerFeature||ra.primitivesPerCoordinate>=qa.primitivesPerCoordinate||ra.drawCallsPerFeature>=qa.drawCallsPerFeature)||ra.primitivesPerFeature===qa.primitivesPerFeature&&ra.primitivesPerCoordinate===qa.primitivesPerCoordinate&&ra.drawCallsPerFeature===qa.drawCallsPerFeature)?ra:qa}},{key:"spatialReference",get:function(){return this._spatialReference}},{key:"usedMemory",get:function(){const qa=v.isSome(this.averageSymbolComplexity)&&
this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0;return this._usedMemory+qa}},{key:"usedMemoryPerGraphic",get:function(){return this._usedMemory&&this.numberOfGraphics?30<Math.abs(this.pendingAdds-this.pendingRemoves)/this.numberOfGraphics?0:this._usedMemory/this.numberOfGraphics:v.isSome(this.averageSymbolComplexity)?this.averageSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):
0}},{key:"unprocessedMemoryEstimate",get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)}},{key:"symbolComplexities",get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()}},{key:"graphics3DGraphicsByObjectID",get:function(){const qa=this.owner.layer&&this.owner.layer.objectIdField;if(!qa)return null;const ra=new Map;this.graphics3DGraphics.forEach(Da=>{if(Da){var Pa=
this._getGraphicObjectID(Da.graphic,qa);v.isSome(Pa)&&ra.set(Pa,Da)}});return ra}},{key:"labelsEnabled",get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())}},{key:"symbolUpdateType",get:function(){if(0<this.pendingUpdates.size)return"unknown";let qa=0,ra=0;return z.someMap(this.symbols,(Da,Pa)=>{if(v.isSome(Da)){Da=Da.getFastUpdateStatus();if(0<Da.loading)return!0;this.graphicsBySymbol.has(Pa)&&(ra+=Da.fast,qa+=Da.slow)}return!1})?"unknown":0<=ra&&0===qa?"fast":0<=qa&&0===ra?
"slow":"mixed"}},{key:"test",get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size,forceUpdatePolicy:qa=>{this.forcedUpdatePolicy=qa}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}}}]);return Ta}(u);a.Graphics3DCore.tmpVec=H.create();b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"computedExtent",void 0);
b.__decorate([D.property()],a.Graphics3DCore.prototype,"currentRenderer",void 0);b.__decorate([D.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);b.__decorate([D.property()],a.Graphics3DCore.prototype,"_frameTask",void 0);b.__decorate([D.property()],a.Graphics3DCore.prototype,"rendererChangeAbortController",void 0);b.__decorate([D.property()],a.Graphics3DCore.prototype,"elevationInfoChangeAbortController",void 0);b.__decorate([D.property()],a.Graphics3DCore.prototype,
"setupAbortController",void 0);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"elevationAlignment",void 0);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"scaleVisibility",void 0);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"filterVisibility",void 0);b.__decorate([D.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);b.__decorate([D.property()],
a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"featureStore",void 0);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"deconflictor",void 0);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"labeler",void 0);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"objectStates",void 0);b.__decorate([D.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",
void 0);b.__decorate([D.property()],a.Graphics3DCore.prototype,"forcedUpdatePolicy",void 0);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);b.__decorate([D.property({constructOnly:!0})],a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);b.__decorate([D.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);b.__decorate([D.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);b.__decorate([D.property({constructOnly:!0})],
a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);b.__decorate([D.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);b.__decorate([D.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);b.__decorate([D.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,
"updatingRemaining",null);b.__decorate([D.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);b.__decorate([D.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);b.__decorate([D.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);b.__decorate([D.property({constructOnly:!0})],
a.Graphics3DCore.prototype,"hasM",void 0);a.Graphics3DCore=Ia=b.__decorate([G.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);let Ea=function(){function Ja(){this.renderingInfo=this.add=null;this.state=0;this.remove=null}Ja.prototype.clear=function(){this.renderingInfo=this.add=null;this.state=0;this.remove=this.abortController=null};return Ja}();const Ca=H.create(),ka=H.create(),sa=new Map;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/rendererConversion":function(){define(["exports",
"../../core/has","../../core/Error","../../core/maybe","../../symbols/support/symbolConversion"],function(a,p,b,r,q){function y(l){return r.isNone(l)||"simple"===l.type||"unique-value"===l.type||"class-breaks"===l.type||"dictionary"===l.type}function f(l,g){if(!g)return null;g=Array.isArray(g)?g:[g];if(0<g.length){const d=g.map(u=>u.details.symbol.type||u.details.symbol.declaredClass).filter(u=>!!u);d.sort();const c=[];d.forEach((u,t)=>{0!==t&&u===d[t-1]||c.push(u)});return new b("renderer-conversion-3d:unsupported-symbols",
`Renderer contains symbols (${c.join(", ")}) which are not supported in 3D`,{renderer:l,symbolErrors:g})}return null}function w(l){const g=l.uniqueValueInfos.map(c=>q.to3D(c.symbol).error).filter(c=>!!c),d=q.to3D(l.defaultSymbol);d.error&&g.unshift(d.error);return f(l,g)}function e(l){const g=l.classBreakInfos.map(c=>q.to3D(c.symbol).error).filter(c=>!!c),d=q.to3D(l.defaultSymbol);d.error&&g.unshift(d.error);return f(l,g)}a.isSupportedRenderer3D=y;a.validateTo3D=function(l){if(r.isNone(l))return null;
if(!y(l))return new b("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${l.type||l.declaredClass}'`,{renderer:l});switch(l.type){case "simple":return f(l,q.to3D(l.symbol).error);case "unique-value":return w(l);case "class-breaks":return e(l)}return null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/has ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ./defaults ./defaultsJSON".split(" "),
function(a,p,b,r,q,y,f,w,e,l){const g=f.fromSimpleMarkerSymbol(e.defaultPointSymbol2D),d=q.fromSimpleLineSymbol(e.defaultPolylineSymbol2D),c=w.fromSimpleFillSymbol(e.defaultPolygonSymbol2D),u=new y({symbolLayers:[new r({material:{color:l.defaultColor},edges:{type:"solid",size:"1px",color:l.defaultOutlineColor}})]});a.getDefaultSymbol3D=function(t){if(b.isNone(t))return null;switch(t.type){case "mesh":return u;case "point":case "multipoint":return g;case "polyline":return d;case "polygon":case "extent":return c}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){a.Graphics3DFeatureStore=function(n){function z(v){var x=n.call(this,v)||this;x.events=new q;x.hasZ=null;x.hasM=null;x.objectIdField=null;x.spatialReference=null;x.featureAdapter={getAttribute(C,A){return"graphic"in C?C.graphic.attributes[A]:h.optimizedFeatureQueryEngineAdapter.getAttribute(C,A)},getAttributes(C){return"graphic"in C?C.graphic.attributes:h.optimizedFeatureQueryEngineAdapter.getAttributes(C)},getObjectId:C=>"graphic"in C?c.getObjectId(C.graphic,
x.objectIdField):h.optimizedFeatureQueryEngineAdapter.getObjectId(C),getGeometry:C=>"graphic"in C?C.getAsOptimizedGeometry(x.hasZ,x.hasM):h.optimizedFeatureQueryEngineAdapter.getGeometry(C),getCentroid:(C,A)=>{if("graphic"in C){let B=null;y.isSome(C.centroid)?B=C.centroid:"point"===C.graphic.geometry.type&&d.projectPoint(C.graphic.geometry,m,x.spatialReference)&&(B=m);C=Array(2+(A.hasZ?1:0)+(A.hasM?1:0));y.isNone(B)?(C[0]=0,C[1]=0,C[2]=0,C[3]=0):(C[0]=B.x,C[1]=B.y,A.hasZ&&(C[2]=B.hasZ?B.z:0),A.hasM&&
(C[A.hasZ?3:2]=B.hasM?B.m:0));return new t([],C)}return h.optimizedFeatureQueryEngineAdapter.getCentroid(C,A)},cloneWithGeometry:(C,A)=>"graphic"in C?new u["default"](A,x.featureAdapter.getAttributes(C),null,x.featureAdapter.getObjectId(C)):h.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(C,A)};return x}p._inheritsLoose(z,n);var k=z.prototype;k.forEach=function(v){this.forAllGraphics(x=>{v(x)})};k.forEachInBounds=function(v,x){this.getSpatialIndex().forEachInBounds(v,x)};k.forEachBounds=function(v,
x,C){const A=this.getSpatialIndex();for(const B of v)v=this.featureAdapter.getObjectId(B),y.isSome(A.getBounds(v,C))&&x(C)};return z}(r);b.__decorate([f.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);b.__decorate([f.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forAllGraphics",void 0);b.__decorate([f.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);b.__decorate([f.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,
"hasM",void 0);b.__decorate([f.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);b.__decorate([f.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"spatialReference",void 0);a.Graphics3DFeatureStore=b.__decorate([g.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);const m={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};a["default"]=a.Graphics3DFeatureStore;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,p,b,r){const q={getObjectId(y){return y.objectId},getAttributes(y){return y.attributes},getAttribute(y,f){return y.attributes[f]},cloneWithGeometry(y,f){return new b["default"](f,y.attributes,null,y.objectId)},getGeometry(y){return y.geometry},getCentroid(y,f){y.centroid||(y.centroid=p.getCentroidOptimizedGeometry(new r,y.geometry,
f.hasZ,f.hasM));return y.centroid}};a["default"]=q;a.optimizedFeatureQueryEngineAdapter=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/centroid":function(){define(["exports","../../core/maybe"],function(a,p){function b(q,y,f,w,e,l,g=1){l=e?l?4:3:l?3:2;let d=f,c=f+l,u=0,t=0,h=f=0,m=0;for(let n=0,z=w-1;n<z;n++,d+=l,c+=l){w=y[d];const k=y[d+1],v=y[d+2],x=y[c],C=y[c+1],A=y[c+2];let B=w*C-x*k;h+=B;u+=(w+x)*B;t+=(k+C)*B;e&&(B=w*A-x*v,f+=(v+A)*B,m+=B);w<q[0]&&(q[0]=w);w>q[1]&&
(q[1]=w);k<q[2]&&(q[2]=k);k>q[3]&&(q[3]=k);e&&(v<q[4]&&(q[4]=v),v>q[5]&&(q[5]=v))}0<h*g&&(h*=-1);0<m*g&&(m*=-1);if(!h)return null;q=[u,t,.5*h];e&&(q[3]=f,q[4]=.5*m);return q}function r(q,y,f,w,e){e=w?e?4:3:e?3:2;let l=y,g=y+e,d=0,c=0,u=0,t=0;for(let z=0,k=f-1;z<k;z++,l+=e,g+=e){var h=q[l];const v=q[l+1],x=q[l+2],C=q[g],A=q[g+1],B=q[g+2];if(w){{var m=C-h;var n=A-v;const D=B-x;m=Math.sqrt(m*m+n*n+D*D)}}else m=C-h,n=A-v,m=Math.sqrt(m*m+n*n);m&&(d+=m,w?(h=[h+.5*(C-h),v+.5*(A-v),x+.5*(B-x)],c+=m*h[0],
u+=m*h[1],t+=m*h[2]):(h=[h+.5*(C-h),v+.5*(A-v)],c+=m*h[0],u+=m*h[1]))}return 0<d?w?[c/d,u/d,t/d]:[c/d,u/d]:0<f?w?[q[y],q[y+1],q[y+2]]:[q[y],q[y+1]]:null}a.getCentroidOptimizedGeometry=function(q,y,f,w,e){if(p.isNone(y)||!y.lengths.length)return null;const l="upperLeft"===(null==e?void 0:e.originPosition)?-1:1;q.lengths.length&&(q.lengths.length=0);q.coords.length&&(q.coords.length=0);e=q.coords;const g=[],d=f?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,
Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:u}=y,t=f?w?4:3:w?3:2;let h=0;for(var m of c){const n=b(d,u,h,m,f,w,l);n&&g.push(n);h+=m*t}g.sort((n,z)=>{let k=l*n[2]-l*z[2];0===k&&f&&(k=n[4]-z[4]);return k});g.length&&(m=6*g[0][2],e[0]=g[0][0]/m,e[1]=g[0][1]/m,f&&(m=6*g[0][4],e[2]=0!==m?g[0][3]/m:0),e[0]<d[0]||e[0]>d[1]||e[1]<d[2]||e[1]>d[3]||f&&(e[2]<d[4]||e[2]>d[5]))&&(e.length=
0);if(!e.length)if(y=y.lengths[0]?r(u,0,c[0],f,w):null)e[0]=y[0],e[1]=y[1],f&&2<y.length&&(e[2]=y[2]);else return null;return q};a.lineCentroid=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],function(a){a.Graphics3DSymbolCreationContext=function(p){this.schedule=p;this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=
this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1};a.Graphics3DSymbolLayerCreationContext=function(){};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,p,b){a.make=function(r,q,y){let f;switch(r.type){case "point-3d":f=
p;break;default:f=b}return new f(r,q,y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/asyncUtils","../../../../core/promiseUtils","./Graphics3DCalloutSymbolLayerFactory","./Graphics3DSymbol"],function(a,p,b,r,q){return function(y){function f(e,l,g){e=y.call(this,e,l,g)||this;e.calloutSymbolLayer=null;e.symbol.hasVisibleCallout()&&(e.calloutSymbolLayer=r.make(e.symbol,
l));return e}a._inheritsLoose(f,y);var w=f.prototype;w.doLoad=function(){var e=a._asyncToGenerator(function*(l){const g=this.calloutSymbolLayer?p.result(this.calloutSymbolLayer.load()):null;try{yield y.prototype.doLoad.call(this,l)}catch(u){var d;null==(d=this.calloutSymbolLayer)?void 0:d.abortLoad();throw u;}if(b.isAborted(l)){var c;null==(c=this.calloutSymbolLayer)?void 0:c.abortLoad();throw b.createAbortError();}g&&(yield g)});return function(l){return e.apply(this,arguments)}}();w.destroy=function(){y.prototype.destroy.call(this);
this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()};w.createGraphics3DGraphic=function(e,l){l=y.prototype.createGraphics3DGraphic.call(this,e,l);this.calloutSymbolLayer&&(e=this.createCalloutGraphic(e))&&l.addAuxiliaryGraphic(e);return l};w.globalPropertyChanged=function(e,l){return y.prototype.globalPropertyChanged.call(this,e,l)?this.calloutSymbolLayer?this.calloutSymbolLayer.globalPropertyChanged(e,l,g=>this._getCalloutGraphicLayer(g)):!0:!1};w.updateGeometry=function(e,l){const g=y.prototype.updateGeometry.call(this,
e,l);return g&&this.calloutSymbolLayer&&(e=this._getCalloutGraphicLayer(e))?this.calloutSymbolLayer.updateGeometry(e,l):g};w.createCalloutGraphic=function(e){const l=e.renderingInfo;e.renderingInfo={renderer:l.renderer,symbol:l.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(e)};w._getCalloutGraphicLayer=function(e){for(const l of e._auxiliaryGraphics)if(l.graphics3DSymbolLayer===
this.calloutSymbolLayer)return l};return f}(q)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../core/arrayUtils","../../../../core/maybe","../../../../layers/graphics/dehydratedFeatures"],function(a,p,b,r){let q=function(){function y(w){this.graphicsCore=w;this.idToState=new Map;this.states=new Set;const e=w.owner.layer&&w.owner.layer.objectIdField;e?(this.getGraphicId=l=>r.getObjectId(l,e),this.getGraphics3DGraphicById=l=>this.graphicsCore.getGraphics3DGraphicByObjectId(l)):
(this.getGraphicId=l=>l.uid,this.getGraphics3DGraphicById=l=>this.graphicsCore.getGraphics3DGraphicById(l))}var f=y.prototype;f.destroy=function(){this.idToState.clear();this.states.forEach((w,e)=>this.remove(e))};f.add=function(w){const e={remove:()=>this.remove(w)};if(this.states.has(w))return e;const l=this.getGraphicId(w.graphic),g=this.getGraphics3DGraphicById(l);this.states.has(w)||this.states.add(w);this.ensureStateList(l).push(w);w.displaying=b.isSome(g)?g.isVisible():!1;w.isDraped=b.isSome(g)?
g.isDraped:!1;w.tracking=!0;b.isSome(g)&&w.emit("changed",{});return e};f.remove=function(w){if(this.states.has(w)){if(this.idToState.size){const e=this.getGraphicId(w.graphic),l=this.idToState.get(e);l&&(p.remove(l,w),0===l.length&&this.idToState.delete(e))}this.states.delete(w);w.tracking=!1;w.displaying=!1}};f.addGraphic=function(w){this.forEachState(w,e=>{e.displaying=w.isVisible();e.isDraped=w.isDraped;e.emit("changed",{})})};f.removeGraphic=function(w){this.forEachState(w,e=>{e.displaying=!1;
e.isDraped=!1})};f.updateGraphicGeometry=function(w){this.forEachState(w,e=>{e.emit("changed",{})})};f.updateGraphicVisibility=function(w){this.forEachState(w,e=>{e.displaying=w.isVisible()})};f.allGraphicsDeleted=function(){this.states.forEach(w=>{w.displaying=!1})};f.ensureStateList=function(w){var e=this.idToState.get(w);if(e)return e;e=[];this.idToState.set(w,e);return e};f.forEachState=function(w,e){0!==this.states.size&&0!==this.idToState.size&&(w=this.getGraphicId(w.graphic),w=this.idToState.get(w),
null!=w&&w.forEach(e))};return y}();a.GraphicStateTracking=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){a.SpatialIndex2D=function(u){function t(m){m=u.call(this,m)||this;m._index=new l.PooledRBush(9,q("csp-restrictions")?n=>({minX:n.extent[0],minY:n.extent[1],maxX:n.extent[2],maxY:n.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);m._missing=new Set;m._boundsByFeature=new Map;m.spatialReference=null;m.hasZ=null;m.hasM=null;m.objectIdField=null;m.updating=!1;return m}p._inheritsLoose(t,u);var h=t.prototype;h.setup=function(m){this._addMany(m)};h.destroy=
function(){this._missing.clear();this._index.destroy();this._index=null;this._boundsByFeature.clear();this._boundsByFeature=null};h.update=function(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())};h.queryGraphicUIDsInExtent=function(m,n,z){n.equals(this.spatialReference)&&(c.minX=m[0],c.minY=m[1],c.maxX=m[2],c.maxY=m[3],this.update(),this._index.search(c,k=>z(k.graphic.uid)))};h.add=function(m){this._missing.add(m);this.updating=!0};
h.remove=function(m){this._missing.delete(m)?this.updating=0<this._missing.size:(this._index.remove(m),m=d.getObjectId(m.graphic,this._get("objectIdField")),null!=m&&this._boundsByFeature.delete(m))};h._addMany=function(m){if(0!==m.length){var n=this._get("objectIdField");for(const z of m){z.computeExtent(this.spatialReference);const k=d.getObjectId(z.graphic,n);null!=k&&this._boundsByFeature.set(k,z.extent)}this._index.load(m)}};h.clear=function(){this._index.clear();this._missing.clear();this._boundsByFeature.clear();
this.updating=!1};h.forEachInBounds=function(m,n){c.minX=m[0];c.minY=m[1];c.maxX=m[2];c.maxY=m[3];this.update();this._index.search(c,z=>{n(z)})};h.getBounds=function(m,n){this.update();return(m=this._boundsByFeature.get(m))?g.fromRect(n,m):null};p._createClass(t,[{key:"updatingRemaining",get:function(){return this._missing.size}}]);return t}(r);b.__decorate([y.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);b.__decorate([y.property({constructOnly:!0})],a.SpatialIndex2D.prototype,
"hasZ",void 0);b.__decorate([y.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);b.__decorate([y.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"objectIdField",void 0);b.__decorate([y.property()],a.SpatialIndex2D.prototype,"updating",void 0);b.__decorate([y.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=b.__decorate([e.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);const c={minX:0,minY:0,maxX:0,
maxY:0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/libs/rbush/PooledRBush":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../arrayUtils ../../maybe ../../PooledArray ../../../chunks/quickselect".split(" "),function(a,p,b,r,q,y){function f(B,D){w(B,0,B.children.length,D,B)}function w(B,D,E,G,K){K||(K=new C([]));K.minX=Infinity;K.minY=Infinity;K.maxX=-Infinity;K.maxY=-Infinity;for(let M=D,H;M<E;M++)H=B.children[M],e(K,B.leaf?G(H):H);return K}function e(B,
D){B.minX=Math.min(B.minX,D.minX);B.minY=Math.min(B.minY,D.minY);B.maxX=Math.max(B.maxX,D.maxX);B.maxY=Math.max(B.maxY,D.maxY)}function l(B,D){return B.minX-D.minX}function g(B,D){return B.minY-D.minY}function d(B){return(B.maxX-B.minX)*(B.maxY-B.minY)}function c(B){return B.maxX-B.minX+(B.maxY-B.minY)}function u(B,D){return B.minX<=D.minX&&B.minY<=D.minY&&D.maxX<=B.maxX&&D.maxY<=B.maxY}function t(B,D){return D.minX<=B.maxX&&D.minY<=B.maxY&&D.maxX>=B.minX&&D.maxY>=B.minY}function h(B,D,E,G,K){for(D=
[D,E];D.length;){E=r.assumeNonNull(D.pop());const M=r.assumeNonNull(D.pop());if(E-M<=G)continue;const H=M+Math.ceil((E-M)/G/2)*G;y.quickselect(B,H,M,E,K);D.push(M,H,H,E)}}let m=function(){function B(E=9,G){this.compareMinX=l;this.compareMinY=g;this.toBBox=function(K){return K};this._maxEntries=Math.max(4,E||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));G&&("function"===typeof G?this.toBBox=G:this._initFormat(G));this.clear()}var D=B.prototype;D.destroy=function(){this.clear();n.prune();
z.prune();k.prune();v.prune()};D.all=function(E){this._all(this.data,E)};D.search=function(E,G){let K=this.data;const M=this.toBBox;if(t(E,K))for(n.clear();K;){for(let H=0,J=K.children.length;H<J;H++){const O=K.children[H],I=K.leaf?M(O):O;t(E,I)&&(K.leaf?G(O):u(E,I)?this._all(O,G):n.push(O))}K=n.pop()}};D.collides=function(E){let G=this.data;const K=this.toBBox;if(!t(E,G))return!1;for(n.clear();G;){for(let M=0,H=G.children.length;M<H;M++){const J=G.children[M],O=G.leaf?K(J):J;if(t(E,O)){if(G.leaf||
u(E,O))return!0;n.push(J)}}G=n.pop()}return!1};D.load=function(E){if(!E.length)return this;if(E.length<this._minEntries){for(let G=0,K=E.length;G<K;G++)this.insert(E[G]);return this}E=this._build(E.slice(0,E.length),0,E.length-1,0);if(this.data.children.length)if(this.data.height===E.height)this._splitRoot(this.data,E);else{if(this.data.height<E.height){const G=this.data;this.data=E;E=G}this._insert(E,this.data.height-E.height-1,!0)}else this.data=E;return this};D.insert=function(E){E&&this._insert(E,
this.data.height-1);return this};D.clear=function(){this.data=new C([]);return this};D.remove=function(E){if(!E)return this;let G=this.data,K=null,M=0,H=!1,J;const O=this.toBBox(E);k.clear();for(v.clear();G||0<k.length;){if(!G){var I;G=r.assumeNonNull(k.pop());K=k.data[k.length-1];M=null!=(I=v.pop())?I:0;H=!0}if(G.leaf&&(J=b.indexOf(G.children,E,G.children.length,G.indexHint),-1!==J)){G.children.splice(J,1);k.push(G);this._condense(k);break}H||G.leaf||!u(G,O)?K?(M++,G=K.children[M],H=!1):G=null:(k.push(G),
v.push(M),M=0,K=G,G=G.children[0])}return this};D.toJSON=function(){return this.data};D.fromJSON=function(E){this.data=E;return this};D._all=function(E,G){for(z.clear();E;){var K;if(!0===E.leaf)for(const M of E.children)G(M);else z.pushArray(E.children);E=null!=(K=z.pop())?K:null}};D._build=function(E,G,K,M){var H=K-G+1,J=this._maxEntries;if(H<=J)return E=new C(E.slice(G,K+1)),f(E,this.toBBox),E;M||(M=Math.ceil(Math.log(H)/Math.log(J)),J=Math.ceil(H/J**(M-1)));const O=new A([]);O.height=M;H=Math.ceil(H/
J);J=H*Math.ceil(Math.sqrt(J));for(h(E,G,K,J,this.compareMinX);G<=K;G+=J){const I=Math.min(G+J-1,K);h(E,G,I,H,this.compareMinY);for(let F=G;F<=I;F+=H)O.children.push(this._build(E,F,Math.min(F+H-1,I),M-1))}f(O,this.toBBox);return O};D._chooseSubtree=function(E,G,K,M){for(;;){M.push(G);if(!0===G.leaf||M.length-1===K)break;let H=Infinity,J=Infinity,O=void 0;for(let I=0,F=G.children.length;I<F;I++){const L=G.children[I],N=d(L),R=(Math.max(L.maxX,E.maxX)-Math.min(L.minX,E.minX))*(Math.max(L.maxY,E.maxY)-
Math.min(L.minY,E.minY))-N;R<J?(J=R,H=N<H?N:H,O=L):R===J&&N<H&&(H=N,O=L)}G=O||G.children[0]}return G};D._insert=function(E,G,K){var M=this.toBBox;K=K?E:M(E);k.clear();M=this._chooseSubtree(K,this.data,G,k);M.children.push(E);for(e(M,K);0<=G;)if(k.data[G].children.length>this._maxEntries)this._split(k,G),G--;else break;this._adjustParentBBoxes(K,k,G)};D._split=function(E,G){const K=E.data[G];var M=K.children.length;const H=this._minEntries;this._chooseSplitAxis(K,H,M);(M=this._chooseSplitIndex(K,H,
M))?(M=K.children.splice(M,K.children.length-M),M=K.leaf?new C(M):new A(M),M.height=K.height,f(K,this.toBBox),f(M,this.toBBox),G?E.data[G-1].children.push(M):this._splitRoot(K,M)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};D._splitRoot=function(E,G){this.data=new A([E,G]);this.data.height=E.height+1;f(this.data,this.toBBox)};D._chooseSplitIndex=function(E,G,K){let M,H,J=void 0;M=H=Infinity;for(let I=G;I<=K-G;I++){var O=w(E,0,I,this.toBBox);const F=w(E,I,
K,this.toBBox),L=Math.max(0,Math.min(O.maxX,F.maxX)-Math.max(O.minX,F.minX))*Math.max(0,Math.min(O.maxY,F.maxY)-Math.max(O.minY,F.minY));O=d(O)+d(F);L<M?(M=L,J=I,H=O<H?O:H):L===M&&O<H&&(H=O,J=I)}return J};D._chooseSplitAxis=function(E,G,K){const M=E.leaf?this.compareMinX:l,H=E.leaf?this.compareMinY:g,J=this._allDistMargin(E,G,K,M);G=this._allDistMargin(E,G,K,H);J<G&&E.children.sort(M)};D._allDistMargin=function(E,G,K,M){E.children.sort(M);M=this.toBBox;var H=w(E,0,G,M);const J=w(E,K-G,K,M);let O=
c(H)+c(J);for(let I=G;I<K-G;I++){const F=E.children[I];e(H,E.leaf?M(F):F);O+=c(H)}for(K=K-G-1;K>=G;K--)H=E.children[K],e(J,E.leaf?M(H):H),O+=c(J);return O};D._adjustParentBBoxes=function(E,G,K){for(;0<=K;K--)e(G.data[K],E)};D._condense=function(E){for(let G=E.length-1;0<=G;G--){const K=E.data[G];if(0===K.children.length)if(0<G){const M=E.data[G-1],H=M.children;H.splice(b.indexOf(H,K,H.length,M.indexHint),1)}else this.clear();else f(K,this.toBBox)}};D._initFormat=function(E){const G=["return a"," - b",
";"];this.compareMinX=new Function("a","b",G.join(E[0]));this.compareMinY=new Function("a","b",G.join(E[1]));this.toBBox=new Function("a","return {minX: a"+E[0]+", minY: a"+E[1]+", maxX: a"+E[2]+", maxY: a"+E[3]+"};")};return B}();const n=new q,z=new q,k=new q,v=new q({deallocator:void 0});q=function(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity};let x=function(B){function D(){var E=B.apply(this,arguments)||this;E.height=1;E.indexHint=new b.PositionHint;return E}p._inheritsLoose(D,
B);return D}(q),C=function(B){function D(E){var G=B.call(this)||this;G.children=E;G.leaf=!0;return G}p._inheritsLoose(D,B);return D}(x),A=function(B){function D(E){var G=B.call(this)||this;G.children=E;G.leaf=!1;return G}p._inheritsLoose(D,B);return D}(x);a.BBox=q;a.PooledRBush=m;a["default"]=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quickselect":function(){define(["exports"],function(a){var p={exports:{}};(function(b){(function(r){r=r();void 0!==r&&(b.exports=r)})(function(){function r(f,
w,e,l,g){for(;l>e;){if(600<l-e){var d=l-e+1,c=w-e+1,u=Math.log(d),t=.5*Math.exp(2*u/3);u=.5*Math.sqrt(u*t*(d-t)/d)*(0>c-d/2?-1:1);r(f,w,Math.max(e,Math.floor(w-c*t/d+u)),Math.min(l,Math.floor(w+(d-c)*t/d+u)),g)}d=f[w];c=e;t=l;q(f,e,w);for(0<g(f[l],d)&&q(f,e,l);c<t;){q(f,c,t);c++;for(t--;0>g(f[c],d);)c++;for(;0<g(f[t],d);)t--}0===g(f[e],d)?q(f,e,t):(t++,q(f,t,l));t<=w&&(e=t+1);w<=t&&(l=t-1)}}function q(f,w,e){var l=f[w];f[w]=f[e];f[e]=l}function y(f,w){return f<w?-1:f>w?1:0}return function(f,w,e,l,
g){r(f,w,e||0,l||f.length-1,g||y)}})})(p);a.quickselect=p.exports})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z){const k=f.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider");a.StageLayerElevationProvider=function(E){function G(M){M=E.call(this,M)||this;M.elevationOffset=0;M._layerHandes=new y;return M}p._inheritsLoose(G,E);var K=G.prototype;K.initialize=function(){this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=new z.Intersector(this.view.state.viewingMode);this.intersector.options.store=
0;var M=this.computeLayerExtent(this.stageLayer);this.zmin=M[2];this.zmax=M[5];M=this.stageLayer.events;this._layerHandes.add([M.on("layerObjectAdded",H=>this.objectChanged(H.object)),M.on("layerObjectRemoved",H=>this.objectChanged(H.object)),M.on("objectGeometryAdded",H=>this.objectChanged(H.object)),M.on("objectGeometryRemoved",H=>this.objectChanged(H.object)),M.on("vertexAttrsUpdated",H=>this.objectChanged(H.object)),M.on("objectTransformation",H=>this.objectChanged(H))])};K.dispose=function(){this._layerHandes.destroy()};
K.elevationInfoChanged=function(){const M=null!=this.layer?this.layer.elevationInfo:null;if(null!=M&&"on-the-ground"!==M.mode){const H=e.getMetersPerVerticalUnitForSR(this.layer.spatialReference),J=n.getMetersPerUnit(M.unit);this.elevationOffset=w.unwrapOr(M.offset,0)*J/H}else this.elevationOffset=0};K.getElevation=function(M,H,J,O){A[0]=M;A[1]=H;A[2]=J;if(!this.renderCoordsHelper.toRenderCoords(A,O,A))return k.error("could not project point for elevation alignment"),null;M=this.elevationOffset;H=
this.zmin+M;this.renderCoordsHelper.setAltitude(B,this.zmax+M,A);this.renderCoordsHelper.setAltitude(D,H,A);this.intersector.reset(B,D);this.intersector.intersect(this.intersectLayers,null,null,1,null,I=>I.metadata&&I.metadata.isElevationSource);return this.intersector.results.min.getIntersectionPoint(A)?this.renderCoordsHelper.getAltitude(A):null};K.objectChanged=function(M){var H;if(null!=(H=M.metadata)&&H.isElevationSource&&this.spatialReference){h.empty(v);M.metadata.lastValidElevationBB.isEmpty()||
this.expandExtent(M.metadata.lastValidElevationBB.min,M.metadata.lastValidElevationBB.max,v);H=M.boundingVolumeWorldSpace.min;var J=M.boundingVolumeWorldSpace.max;this.expandExtent(H,J,v);h.toRect(v,x);this.zmin=Math.min(this.zmin,v[2]);this.zmax=Math.max(this.zmax,v[5]);C.extent=x;C.spatialReference=this.spatialReference;this.emit("elevation-change",C);u.copy(M.metadata.lastValidElevationBB.min,H);u.copy(M.metadata.lastValidElevationBB.max,J)}};K.computeLayerExtent=function(M){h.empty(v);M.objects.forAll(H=>
this.expandExtent(H.boundingVolumeWorldSpace.min,H.boundingVolumeWorldSpace.max,v));return v};K.expandExtent=function(M,H,J){for(let O=0;8>O;++O)A[0]=O&1?M[0]:H[0],A[1]=O&2?M[1]:H[1],A[2]=O&4?M[2]:H[2],this.renderCoordsHelper.fromRenderCoords(A,A,this.spatialReference),h.expandWithVec3(J,A);return J};return G}(q.EventedMixin(r));b.__decorate([l.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);b.__decorate([l.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,
"stageLayer",void 0);b.__decorate([l.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);b.__decorate([l.property({readOnly:!0,aliasOf:"view.spatialReference"})],a.StageLayerElevationProvider.prototype,"spatialReference",void 0);a.StageLayerElevationProvider=b.__decorate([c.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);const v=h.empty(),x=m.empty(),C={spatialReference:null,extent:x,context:"scene"},A=t.create(),
B=t.create(),D=t.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){b=function(u){function t(){var m=u.apply(this,arguments)||this;m.dirtyExtents=new d.ExtentSet;m.globalDirty=!1;m.averageExtentUpdateSize=0;m.dirtyGraphicsSet=new Set;m.handles=new q;m.updateElevation=!1;m.layerView=null;m.graphicsCore=null;m.events=new r;return m}a._inheritsLoose(t,u);var h=t.prototype;h.setup=function(m,n,z,k){this.layerView=m;this.queryGraphicUIDsInExtent=n;this.graphicsCore=z;this.elevationProvider=k;m=this.layerView.view.resourceController.scheduler;
this.handles.add([k.on("elevation-change",v=>this._elevationChanged(v)),this.layerView.watch("suspended",()=>this.suspendedChange()),m.registerTask(c.TaskPriority.ELEVATION_ALIGNMENT,this)])};h.destroy=function(){this.dirtyGraphicsSet.clear();this.handles.destroy();this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=this.handles=null};h.clear=function(){this.dirtyGraphicsSet.clear();this.notifyChange("updating")};h.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=
!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))};h.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};h.runTask=function(m){this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,m.madeProgress());for(m.run(()=>this.dirtyExtents.merge(m));this.running&&!m.done;)this._updateDirtyGraphics(m),this._updateDirtyExtents(m);this.layerView.view.deconflictor.setDirty();this.notifyChange("updating")};
h._updateDirtyGraphics=function(m){const n=this.layerView.view.renderCoordsHelper,z=0===this.graphicsCore.effectiveUpdatePolicy;for(const k of this.dirtyGraphicsSet.keys()){const v=this.graphicsCore.getGraphics3DGraphicById(k);this.dirtyGraphicsSet.delete(k);y.isSome(v)&&(v.alignWithElevation(this.elevationProvider,n,z),m.madeProgress());if(m.done)break}};h._updateDirtyExtents=function(m){for(;!this.dirtyExtents.empty&&!m.done;){const n=this.dirtyExtents.pop(),z=this.elevationProvider.spatialReference;
this.events.emit("invalidate-elevation",{extent:n,spatialReference:z});const k=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(n,z,v=>{const x=this.graphicsCore.getGraphics3DGraphicById(v);y.isSome(x)&&x.needsElevationUpdates()&&this.dirtyGraphicsSet.add(v)});this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-k)+.9*this.averageExtentUpdateSize;m.madeProgress()}};h.markAllGraphicsElevationDirty=function(){this.dirtyExtents.clear();this.dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((m,
n)=>this.dirtyGraphicsSet.add(n))};h._elevationChanged=function(m){if("scene"!==m.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:n,spatialReference:z}=m;this.layerView.suspended?(this.updateElevation||(m=this.graphicsCore.computedExtent)&&n[2]>m.xmin&&n[0]<m.xmax&&n[3]>m.ymin&&n[1]<m.ymax&&(this.updateElevation=!0),this.events.emit("invalidate-elevation",{extent:n,spatialReference:z})):(-Infinity===n[0]?this.globalDirty=
!0:this.dirtyExtents.add(n),this.notifyChange("updating"))}};a._createClass(t,[{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return 0<this.dirtyGraphicsSet.size||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}},{key:"updatingRemaining",get:function(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}}]);return t}(b);p.__decorate([f.property({readOnly:!0})],b.prototype,"updating",null);p.__decorate([f.property({readOnly:!0})],
b.prototype,"updatingRemaining",null);return b=p.__decorate([g.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],b)})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,p,b,r,q){let y=function(){function f(){this._extents=new b({allocator:e=>e||r.create()});this._tmpExtent=r.create();this._dirty=
!1}var w=f.prototype;w.clear=function(){this._extents.clear()};w.add=function(e){this.contains(e)||(this.removeContained(e),r.copy(this._extents.pushNew(),e),this._dirty=!0)};w.pop=function(){this._dirty&&this.mergeTight();return this._extents.pop()};w.merge=function(e){this.mergeTight(e);return e.hasProgressed};w.mergeTight=function(e=q.noBudget){const l=this._extents,g=new Set;let d=0;for(;d!==l.length;){l.sort((c,u)=>c[0]-u[0]);d=l.length;g.clear();for(let c=0;c<l.length;++c){if(e.done)return;
const u=l.getItemAt(c);for(let t=c+1;t<l.length;++t){const h=l.getItemAt(t);if(h[0]>=u[2])break;g.add(h)}g.forEach(t=>{if(u!==t)if(t[2]<=u[0])g.delete(t);else{var h=r.area(u),m=r.area(t),n=this._tmpExtent;r.expand(u,t,n);h+=m;.05>(r.area(n)-h)/h&&(r.copy(u,n),g.delete(t),l.remove(t),e.madeProgress())}});g.add(u)}}this._dirty=!1};w.contains=function(e){return this._extents.some(l=>r.contains(l,e))};w.removeContained=function(e){this._extents.filterInPlace(l=>!r.contains(e,l))};p._createClass(f,[{key:"empty",
get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"test",get:function(){const e=this;return{containsPoint:l=>e._extents.some(g=>r.containsPoint(g,l))}}}]);return f}();a.ExtentSet=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./QueryEngine ../../../layers/support/FeatureFilter ../../../support/floorFilterUtils ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m){const n=y.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");a.Graphics3DFilterVisibility=function(z){function k(...x){x=z.call(this,...x)||this;x.filter=null;x._dirty=!1;x._querying=!1;x._handles=new q;return x}p._inheritsLoose(k,z);var v=k.prototype;v.setup=function(x,C){this._layerView=x;this._core=C;this._objectIdField=x.layer.objectIdField;this._queryEngine=new u["default"]({layerView:this._layerView,priority:m.TaskPriority.FILTER_VISIBILITY});
this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(m.TaskPriority.FILTER_VISIBILITY,this));this._handles.add(e.on(C.owner,"loadedGraphics","after-changes",A=>this._graphicsChanged(A),()=>this.dirty=!0));this.filterChanged()};v.destroy=function(){this._handles.destroy();this._handles=null;this.clear();this._core=this._layerView=null};v.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(x=>x.clearVisibilityFlag(2)),this._queryResult=
null,this._querying=!1);this.dirty=!1;this.notifyChange("updating")};v._graphicsChanged=function(x){this._queryEngine&&0===(x.type&1)||(this.dirty=!0)};v.updateVisibility=function(x){this.active&&(x.hasVisibilityFlag(2,0)||x.setVisibilityFlag(2,!1,0),this.dirty=!0)};v.filterChanged=function(){const x=this.recomputeFilter();x!==this.filter&&(this.filter=x,this.dirty=!0)};v.recomputeFilter=function(){var x="filter"in this._layerView?this._layerView.filter:null;const C="timeExtent"in this._layerView?
this._layerView.timeExtent:null,A=h.getFloorFilterClause(this._layerView);if(f.isNone(C)&&f.isNone(A))return x;x=f.isSome(x)?x.clone():new t;f.isSome(C)&&(x.timeExtent=f.isSome(x.timeExtent)?x.timeExtent.intersection(C):C);f.isSome(A)&&(x.where=null==x.where||""===x.where?A:`(${x.where}) AND (${A})`);return x};v.runTask=function(x){this.active?(!this._dirty||this._querying||x.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(C=>{this._queryResult=C;this._querying=
!1}).catch(C=>{w.isAbortError(C)||(n.warn("FeatureFilter query failed: "+C,{error:C}),this._queryResult=new Set,this._core.graphics3DGraphics.forEach(A=>this._queryResult.add(this._getFeatureId(A.graphic))),this._querying=!1)}),x.madeProgress()),this._queryResult&&!x.done&&(this._core.modifyGraphics3DGraphicVisibilities(C=>{if(x.done)return!1;const A=this._queryResult.has(this._getFeatureId(C.graphic));return C.setVisibilityFlag(2,A,0)?(x.madeProgress(),!0):!1}),x.done||(this._queryResult=null)),
this.notifyChange("updating")):this.clear()};v._getFeatureId=function(x){return null==x.objectId?x.attributes[this._objectIdField]:x.objectId};p._createClass(k,[{key:"updating",get:function(){return this._dirty||this._querying||null!=this._queryResult}},{key:"active",get:function(){return this.filter&&0<this._core.graphics3DGraphics.size}},{key:"running",get:function(){return this._dirty&&!this._querying||null!=this._queryResult}},{key:"dirty",set:function(x){this._dirty!==x&&(this._dirty=x,this.notifyChange("updating"))}}]);
return k}(r);b.__decorate([l.property({readOnly:!0})],a.Graphics3DFilterVisibility.prototype,"updating",null);a.Graphics3DFilterVisibility=b.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],a.Graphics3DFilterVisibility);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){const m=c["default"];a.QueryEngine=function(n){function z(v){v=n.call(this,v)||this;v._dataQueryEngineInstance=null;return v}p._inheritsLoose(z,n);var k=z.prototype;k.destroy=function(){this.clear()};k.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};k.executeQueryForIdSet=function(){var v=p._asyncToGenerator(function*(x,C){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(x),
C)});return function(x,C){return v.apply(this,arguments)}}();k.executeQueryForCount=function(){var v=p._asyncToGenerator(function*(x,C){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(x),C)});return function(x,C){return v.apply(this,arguments)}}();k.executeQueryForExtent=function(){var v=p._asyncToGenerator(function*(x,C){const {count:A,extent:B}=yield this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(x),C);x=d.fromJSON(B);return{count:A,extent:x}});return function(x,
C){return v.apply(this,arguments)}}();k.executeQueryForIds=function(){var v=p._asyncToGenerator(function*(x,C){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(x),C)});return function(x,C){return v.apply(this,arguments)}}();k.executeQueryForLatestObservations=function(){var v=p._asyncToGenerator(function*(x,C){x=yield this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(x),C);x=u.fromJSON(x);x.features.forEach(A=>{A.layer=this.layer;A.sourceLayer=this.layer});
return x});return function(x,C){return v.apply(this,arguments)}}();k.executeQuery=function(){var v=p._asyncToGenerator(function*(x,C){x=yield this.dataQueryEngine.executeQuery(this._ensureQueryJSON(x),C);x=u.fromJSON(x);x.features.forEach(A=>{A.layer=this.layer;A.sourceLayer=this.layer});return x});return function(x,C){return v.apply(this,arguments)}}();k._ensureQueryJSON=function(v){if(y.isNone(v))return this.defaultQueryJSON;"outSpatialReference"in v&&!v.outSpatialReference&&(v.outSpatialReference=
this.spatialReference);return v.toJSON()};k.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const v="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,x=this.layer.objectIdField,C=h.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),A=this.layer.fields.map(H=>H.toJSON()),B=this.layerView.view.resourceController.scheduler,D=this.priority,E=this.spatialReference.toJSON(),G=this.layerView.graphics3d.graphicsCore.featureStore,
{hasZ:K,hasM:M}=this.layerView;return this._dataQueryEngineInstance=new m({hasZ:K,hasM:M,geometryType:C,fields:A,timeInfo:v,spatialReference:E,objectIdField:x,featureStore:G,scheduler:B,priority:D})};p._createClass(z,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new t({outSpatialReference:this.spatialReference})).toJSON()}},
{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);return z}(q);b.__decorate([f.property({constructOnly:!0})],a.QueryEngine.prototype,"layerView",void 0);b.__decorate([f.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);b.__decorate([f.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],a.QueryEngine.prototype,"spatialReference",void 0);b.__decorate([f.property({readOnly:!0,aliasOf:"layerView.layer"})],a.QueryEngine.prototype,"layer",
void 0);b.__decorate([f.property({readOnly:!0})],a.QueryEngine.prototype,"queryGeometryType",null);b.__decorate([f.property({readOnly:!0})],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=b.__decorate([g.subclass("esri.views.3d.layers.graphics.QueryEngine")],a.QueryEngine);a["default"]=a.QueryEngine;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../support/PromiseQueue ../../../support/arcadeOnDemand".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C){function A(H){return H.every(J=>"exceedslimit"!==J.statisticType)}const B=new Set,D=new y.MemCacheStorage(2E6);let E=0,G=function(){function H(O){this.capabilities={query:h.queryCapabilities};this.geometryType=O.geometryType;this.hasM=O.hasM;this.hasZ=O.hasZ;this.objectIdField=O.objectIdField;this.spatialReference=O.spatialReference;this.definitionExpression=O.definitionExpression;this.featureStore=O.featureStore;this.aggregateAdapter=O.aggregateAdapter;
this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=O.timeInfo;O.cacheSpatialQueries&&(this._geometryQueryCache=new y.MemCache(E++ +"$$",D));this.fieldsIndex=new v(O.fields);O.scheduler&&O.priority&&(this._frameQueue=new x,this._frameTask=O.scheduler.registerTask(O.priority,this))}var J=H.prototype;J.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&
this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null);this.fieldsIndex.destroy()};J.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};J.executeQuery=function(){var O=p._asyncToGenerator(function*(I={},F){let L=r.clone(I),N;try{L=yield this._schedule(()=>k.normalizeQuery(L,this.definitionExpression,this.spatialReference),F),L=yield this._reschedule(()=>this._checkQuerySupport(L),
F),N=yield this._reschedule(()=>this._executeGeometryQuery(L,F),F),N=yield this._reschedule(()=>N.executeAggregateIdsQuery(L),F),N=yield this._reschedule(()=>N.executeObjectIdsQuery(L),F),N=yield this._reschedule(()=>N.executeTimeQuery(L),F),N=yield this._reschedule(()=>N.executeAttributesQuery(L),F)}catch(R){if(R!==k.QUERY_ENGINE_EMPTY_RESULT)throw R;N=new m([],null,this)}return N.createQueryResponse(L)});return function(){return O.apply(this,arguments)}}();J.executeQueryForCount=function(){var O=
p._asyncToGenerator(function*(I={},F){let L=r.clone(I),N;L.returnGeometry=!1;L.returnCentroid=!1;L.outSR=null;try{L=yield this._schedule(()=>k.normalizeQuery(L,this.definitionExpression,this.spatialReference),F),L=yield this._reschedule(()=>this._checkQuerySupport(L),F),N=yield this._reschedule(()=>this._executeGeometryQuery(L,F),F),N=yield this._reschedule(()=>N.executeAggregateIdsQuery(L),F),N=yield this._reschedule(()=>N.executeObjectIdsQuery(L),F),N=yield this._reschedule(()=>N.executeTimeQuery(L),
F),N=yield this._reschedule(()=>N.executeAttributesQuery(L),F)}catch(R){if(R!==k.QUERY_ENGINE_EMPTY_RESULT)throw R;return 0}return N.createQueryResponseForCount(L)});return function(){return O.apply(this,arguments)}}();J.executeQueryForExtent=function(){var O=p._asyncToGenerator(function*(I={},F){let L=r.clone(I),N;I=L.outSR;try{L=yield this._schedule(()=>k.normalizeQuery(L,this.definitionExpression,this.spatialReference),F);L=yield this._reschedule(()=>this._checkQuerySupport(L),F);L.returnGeometry=
!0;L.returnCentroid=!1;L.outSR=null;N=yield this._reschedule(()=>this._executeGeometryQuery(L,F),F);N=yield this._reschedule(()=>N.executeAggregateIdsQuery(L),F);N=yield this._reschedule(()=>N.executeObjectIdsQuery(L),F);N=yield this._reschedule(()=>N.executeTimeQuery(L),F);N=yield this._reschedule(()=>N.executeAttributesQuery(L),F);const R=N.size;if(!R)return{count:R,extent:null};w.set(M,w.NEGATIVE_INFINITY);this.featureStore.forEachBounds(N.items,Q=>w.expandWithAABB(M,Q),K);const S={xmin:M[0],ymin:M[1],
xmax:M[3],ymax:M[4],spatialReference:k.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(M[2])&&isFinite(M[5])&&(S.zmin=M[2],S.zmax=M[5]);const P=t.project(S,N.spatialReference,I);P.spatialReference=k.cleanFromGeometryEngine(I||this.spatialReference);if(0===P.xmax-P.xmin){const Q=f.getMetersPerUnitForSR(P.spatialReference);P.xmin-=Q;P.xmax+=Q}if(0===P.ymax-P.ymin){const Q=f.getMetersPerUnitForSR(P.spatialReference);P.ymin-=Q;P.ymax+=Q}if(this.hasZ&&null!=P.zmin&&null!=P.zmax&&0===
P.zmax-P.zmin){const Q=f.getMetersPerUnitForSR(P.spatialReference);P.zmin-=Q;P.zmax+=Q}return{count:R,extent:P}}catch(R){if(R===k.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw R;}});return function(){return O.apply(this,arguments)}}();J.executeQueryForIds=function(){var O=p._asyncToGenerator(function*(I={},F){return this.executeQueryForIdSet(I,F).then(L=>Array.from(L))});return function(){return O.apply(this,arguments)}}();J.executeQueryForIdSet=function(){var O=p._asyncToGenerator(function*(I=
{},F){let L=r.clone(I),N;L.returnGeometry=!1;L.returnCentroid=!1;L.outSR=null;try{L=yield this._schedule(()=>k.normalizeQuery(L,this.definitionExpression,this.spatialReference),F);L=yield this._reschedule(()=>this._checkQuerySupport(L),F);N=yield this._reschedule(()=>this._executeGeometryQuery(L,F),F);N=yield this._reschedule(()=>N.executeAggregateIdsQuery(L),F);N=yield this._reschedule(()=>N.executeObjectIdsQuery(L),F);N=yield this._reschedule(()=>N.executeTimeQuery(L),F);N=yield this._reschedule(()=>
N.executeAttributesQuery(L),F);const R=N.items,S=new Set;yield this._reschedule(()=>{for(const P of R)S.add(N.featureAdapter.getObjectId(P))},F);return S}catch(R){if(R===k.QUERY_ENGINE_EMPTY_RESULT)return new Set;throw R;}});return function(){return O.apply(this,arguments)}}();J.executeQueryForSnapping=function(){var O=p._asyncToGenerator(function*(I,F){const {point:L,distance:N,types:R}=I;if(0===R)return{candidates:[]};const S=yield this._reschedule(()=>this._checkQuerySupport(I.query),F),P=!c.equals(L.spatialReference,
this.spatialReference);P&&(yield t.checkProjectionSupport(L.spatialReference,this.spatialReference));var Q="number"===typeof N?N:N.x,V="number"===typeof N?N:N.y;Q={xmin:L.x-Q,xmax:L.x+Q,ymin:L.y-V,ymax:L.y+V,spatialReference:L.spatialReference};Q=P?t.project(Q,this.spatialReference):Q;if(!Q)return{candidates:[]};V=(yield d.normalizeCentralMeridian(g.fromJSON(L),null,{signal:F}))[0];const ca=(yield d.normalizeCentralMeridian(g.fromJSON(Q),null,{signal:F}))[0];if(q.isNone(V)||q.isNone(ca))return{candidates:[]};
let ba=new m(this._searchFeatures(this._getQueryBBoxes(ca.toJSON())),null,this);ba=yield this._reschedule(()=>ba.executeObjectIdsQuery(S),F);ba=yield this._reschedule(()=>ba.executeTimeQuery(S),F);ba=yield this._reschedule(()=>ba.executeAttributesQuery(S),F);F=V.toJSON();F=P?t.project(F,this.spatialReference):F;return ba.createSnappingResponse({...I,point:F,distance:P?Math.max(Q.xmax-Q.xmin,Q.ymax-Q.ymin)/2:N},L.spatialReference)});return function(I,F){return O.apply(this,arguments)}}();J.executeQueryForLatestObservations=
function(){var O=p._asyncToGenerator(function*(I={},F){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new b("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:I,timeInfo:this.timeInfo});let L=r.clone(I),N;try{L=yield this._schedule(()=>k.normalizeQuery(L,this.definitionExpression,this.spatialReference),F),L=yield this._reschedule(()=>this._checkQuerySupport(L),F),N=yield this._reschedule(()=>this._executeGeometryQuery(L,F),F),N=yield this._reschedule(()=>N.executeAggregateIdsQuery(L),
F),N=yield this._reschedule(()=>N.executeObjectIdsQuery(L),F),N=yield this._reschedule(()=>N.executeTimeQuery(L),F),N=yield this._reschedule(()=>N.executeAttributesQuery(L),F),N=yield this._reschedule(()=>N.filterLatest(),F)}catch(R){if(R!==k.QUERY_ENGINE_EMPTY_RESULT)throw R;N=new m([],null,this)}return N.createQueryResponse(L)});return function(){return O.apply(this,arguments)}}();J.executeQueryForSummaryStatistics=function(){var O=p._asyncToGenerator(function*(I={},F,L){I=r.clone(I);let N;try{I=
yield this._schedule(()=>k.normalizeQuery(I,this.definitionExpression,this.spatialReference),L),I=yield this._reschedule(()=>this._checkSummaryStatisticsSupport(I,F),L),N=yield this._reschedule(()=>this._executeGeometryQuery(I,L),L),N=yield this._reschedule(()=>N.executeAggregateIdsQuery(I),L),N=yield this._reschedule(()=>N.executeObjectIdsQuery(I),L),N=yield this._reschedule(()=>N.executeTimeQuery(I),L),N=yield this._reschedule(()=>N.executeAttributesQuery(I),L)}catch(R){if(R!==k.QUERY_ENGINE_EMPTY_RESULT)throw R;
N=new m([],null,this)}return N.createSummaryStatisticsResponse(I,F)});return function(){return O.apply(this,arguments)}}();J._schedule=function(){var O=p._asyncToGenerator(function*(I,F){return this._frameQueue?this._frameQueue.push(I,F):I()});return function(I,F){return O.apply(this,arguments)}}();J._reschedule=function(){var O=p._asyncToGenerator(function*(I,F){return this._frameQueue?this._frameQueue.unshift(I,F):I()});return function(I,F){return O.apply(this,arguments)}}();J.runTask=function(O){for(this._budget=
O;!O.done&&this._frameQueue&&this._frameQueue.process();)O.madeProgress();this._budget=null};J._getAll=function(){if(!this._allItems){const O=[];this.featureStore.forEach(I=>O.push(I));this._allItems=new m(O,null,this)}return this._allItems};J._executeGeometryQuery=function(){var O=p._asyncToGenerator(function*(I,F){var L=this;const {geometry:N,outSR:R,spatialRel:S,returnGeometry:P,returnCentroid:Q}=I,V=P||Q,ca=c.isValid(R)&&!c.equals(this.spatialReference,R),ba=this._geometryQueryCache?ca&&V?JSON.stringify({geometry:N,
spatialRelationship:S,outSpatialReference:R}):JSON.stringify({geometry:N,spatialRelationship:S}):null;if(ba){var Z=this._geometryQueryCache.get(ba);if(!q.isUndefined(Z))return Z}Z=function(){var W=p._asyncToGenerator(function*(U){if(ca&&V)return U=yield U.project(R),ba&&L._geometryQueryCache.put(ba,U,U.size||1),U;ba&&L._geometryQueryCache.put(ba,U,U.size||1);return U});return function(U){return W.apply(this,arguments)}}();if(!N)return Z(this._getAll());const ha=this.featureAdapter;if("esriSpatialRelDisjoint"===
S){I=this._searchFeatures(this._getQueryBBoxes(N));if(!I.length)return Z(this._getAll());let W,U;const X=new Set;for(var fa of I)X.add(ha.getObjectId(fa));yield this._reschedule(()=>{let T=0;W=Array(X.size);this.featureStore.forEach(Y=>W[T++]=Y);U=X},F);I=yield this._reschedule(p._asyncToGenerator(function*(){const T=yield n.getSpatialQueryOperator(S,N,L.geometryType,L.hasZ,L.hasM);return new m(yield L._runSpatialFilter(W,Y=>!U.has(ha.getObjectId(Y))||T(ha.getGeometry(Y)),F),N,L)}),F);return Z(I)}fa=
this._searchFeatures(this._getQueryBBoxes(N));if(!fa.length)return Z=new m([],N,this),ba&&this._geometryQueryCache.put(ba,Z,Z.size||1),Z;if(this._canExecuteSoloPass(N,I))return Z(new m(fa,N,this));const aa=yield n.getSpatialQueryOperator(S,N,this.geometryType,this.hasZ,this.hasM);I=yield this._runSpatialFilter(fa,W=>aa(ha.getGeometry(W)),F);return Z(new m(I,N,this))});return function(I,F){return O.apply(this,arguments)}}();J._runSpatialFilter=function(){var O=p._asyncToGenerator(function*(I,F,L){var N=
this;if(!F)return I;if(!this._budget)return I.filter(Q=>F(Q));let R=0;const S=[],P=function(){var Q=p._asyncToGenerator(function*(){for(;R<I.length;){const V=I[R];F(V)&&S.push(V);N._budget.done&&(yield N._reschedule(()=>P(),L));++R}});return function(){return Q.apply(this,arguments)}}();return this._reschedule(()=>P(),L).then(()=>S)});return function(I,F,L){return O.apply(this,arguments)}}();J._canExecuteSoloPass=function(O,I){const {geometryType:F}=this;({spatialRel:I}=I);return n.canQueryWithRBush(O)&&
("esriSpatialRelEnvelopeIntersects"===I||"esriGeometryPoint"===F&&("esriSpatialRelIntersects"===I||"esriSpatialRelContains"===I||"esriSpatialRelWithin"===I))};J._getQueryBBoxes=function(O){if(n.canQueryWithRBush(O)){if(g.isExtent(O))return[e.fromValues(O.xmin,O.ymin,O.xmax,O.ymax)];if(g.isPolygon(O))return O.rings.map(I=>e.fromValues(Math.min(I[0][0],I[2][0]),Math.min(I[0][1],I[2][1]),Math.max(I[0][0],I[2][0]),Math.max(I[0][1],I[2][1])))}return[l.getBoundsXY(e.create(),O)]};J._searchFeatures=function(O){for(const L of O)this.featureStore.forEachInBounds(L,
N=>{B.add(N)});const I=Array(B.size);let F=0;B.forEach(L=>I[F++]=L);B.clear();return I};J._checkSummaryStatisticsSupport=function(){var O=p._asyncToGenerator(function*(I,F){if(0>I.distance||null!=I.geometryPrecision||I.multipatchOption||I.pixelSize||I.relationParam||I.text||I.outStatistics||I.groupByFieldsForStatistics||I.having||I.orderByFields)throw new b("feature-store:unsupported-query","Unsupported query options",{query:I});return Promise.all([this._checkAttributesQuerySupport(I),this._checkSummaryStatisticsParamsSupport(F),
n.checkSpatialQuerySupport(I,this.geometryType,this.spatialReference),t.checkProjectionSupport(this.spatialReference,I.outSR)]).then(()=>I)});return function(I,F){return O.apply(this,arguments)}}();J._checkSummaryStatisticsParamsSupport=function(){var O=p._asyncToGenerator(function*(I){var F=[];I.valueExpression&&({arcadeUtils:F}=yield C.loadArcade(),F=F.extractFieldNames(I.valueExpression));I.field&&F.push(I.field);I.normalizationField&&F.push(I.normalizationField);if(!F.length)throw new b("feature-store:unsupported-query",
"params should have at least a field or valueExpression",{params:I});u.validateFields(this.fieldsIndex,F,"params contains missing fields")});return function(I){return O.apply(this,arguments)}}();J._checkQuerySupport=function(){var O=p._asyncToGenerator(function*(I){if(0>I.distance||null!=I.geometryPrecision||I.multipatchOption||I.pixelSize||I.relationParam||I.text)throw new b("feature-store:unsupported-query","Unsupported query options",{query:I});return Promise.all([this._checkAttributesQuerySupport(I),
this._checkStatisticsQuerySupport(I),n.checkSpatialQuerySupport(I,this.geometryType,this.spatialReference),t.checkProjectionSupport(this.spatialReference,I.outSR)]).then(()=>I)});return function(I){return O.apply(this,arguments)}}();J._checkAttributesQuerySupport=function(O){const {outFields:I,orderByFields:F,returnDistinctValues:L,outStatistics:N}=O,R=N?N.map(S=>S.outStatisticFieldName&&S.outStatisticFieldName.toLowerCase()):[];if(F&&0<F.length){const S=F.map(P=>{const Q=P.toLowerCase();return-1<
Q.indexOf(" asc")?Q.split(" asc")[0]:-1<Q.indexOf(" desc")?Q.split(" desc")[0]:P}).filter(P=>-1===R.indexOf(P));u.validateFields(this.fieldsIndex,S,"orderByFields contains missing fields")}if(I&&0<I.length)u.validateFields(this.fieldsIndex,I,"outFields contains missing fields");else if(L)throw new b("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:O});u.validateWhere(this.fieldsIndex,O.where)};J._checkStatisticsQuerySupport=function(){var O=p._asyncToGenerator(function*(I){const {outStatistics:F,
groupByFieldsForStatistics:L,having:N}=I;var R=L&&L.length,S=F&&F.length;if(N){if(!R||!S)throw new b("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:I});u.validateHaving(this.fieldsIndex,N,F)}if(S&&A(F)){S=F.map(P=>P.onStatisticField);u.validateFields(this.fieldsIndex,S,"onStatisticFields contains missing fields");R&&u.validateFields(this.fieldsIndex,L,"groupByFieldsForStatistics contains missing fields");for(const P of F){const {onStatisticField:Q,
statisticType:V}=P;if(("percentile_disc"===V||"percentile_cont"===V)&&"statisticParameters"in P){if({statisticParameters:R}=P,!R)throw new b("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:P,query:I});}else if("count"!==V&&Q&&u.hasInvalidFieldType(Q,this.fieldsIndex))throw new b("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:P,query:I});}}});return function(I){return O.apply(this,arguments)}}();p._createClass(H,
[{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){const O=this.featureStore.fullBounds;return O?{xmin:O[0],ymin:O[1],xmax:O[2],ymax:O[3],spatialReference:k.cleanFromGeometryEngine(this.spatialReference)}:null}},{key:"timeExtent",get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=z.getTimeExtent(this.timeInfo,this.featureStore):null}},{key:"running",get:function(){return 0<this._frameQueue.length}}]);
return H}();const K=w.create(),M=w.create();a.Feature=function(H,J=null,O,I,F){this.attributes=H;this.geometry=O;this.centroid=I;this.filterFlags=F;this.groupId=-1;this.displayId=J};a["default"]=G;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache"],function(a,p,b){function r(e,l){return e?f.get(e,l):null}function q(e,l,g,d=!0){const c=[];for(const u of l)if("*"!==u&&
!e.has(u))if(d){l=y(u);try{const t=r(l,e);if(!t)throw new p("feature-store:unsupported-query","invalid SQL expression",{where:l});if(!t.isStandardized)throw new p("feature-store:unsupported-query","expression is not standard",{clause:t});q(e,t.fieldNames,"expression contains missing fields")}catch(t){if((l=t&&t.details)&&(l.clause||l.where))throw t;l&&l.missingFields?c.push(...l.missingFields):c.push(u)}}else c.push(u);if(c.length)throw new p("feature-store:unsupported-query",g,{missingFields:c});
}function y(e){return e.split(" as ")[0]}const f=new b.WhereClauseCache(50,500),w=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.getAliasFromFieldName=function(e){return e.split(" as ")[1]};a.getExpressionFromFieldName=y;a.getWhereClause=r;a.hasInvalidFieldType=function(e,l){return(e=l.get(e))?!w.has(e.type):!1};a.validateFields=q;a.validateHaving=function(e,l,g){if(!l)return!0;const d=
f.get(l,e);if(!d)throw new p("feature-store:unsupported-query","invalid SQL expression",{having:l});if(!d.isAggregate)throw new p("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:l});q(e,d.fieldNames,"having contains missing fields");if(!d.getExpressions().every(c=>{const {aggregateType:u,field:t}=c,h=e.has(t)&&e.get(t).name;return g.some(m=>{const {onStatisticField:n,statisticType:z}=m;return(e.has(n)&&e.get(n).name)===h&&z.toLowerCase().trim()===u})}))throw new p("feature-store:unsupported-query",
"expressions in having should also exist in outStatistics",{having:l});return!0};a.validateWhere=function(e,l){if(!l)return!0;const g=f.get(l,e);if(!g)throw new p("feature-store:unsupported-query","invalid SQL expression",{where:l});if(!g.isStandardized)throw new p("feature-store:unsupported-query","where clause is not standard",{where:l});q(e,g.fieldNames,"where clause contains missing fields");return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereClauseCache":function(){define(["exports",
"../ItemCache","./WhereClause"],function(a,p,b){let r=function(){function q(y,f){this._cache=new p(y);this._invalidCache=new p(f)}q.prototype.get=function(y,f){const w=`${f.uid}:${y}`,e=this._cache.get(w);if(e)return e;if(void 0!==this._invalidCache.get(w))return null;try{const l=b.WhereClause.create(y,f);this._cache.put(w,l);return l}catch{return this._invalidCache.put(w,null),null}};return q}();a.WhereClauseCache=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereClause":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../has ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),
function(a,p,b,r,q,y){function f(M,H){M+="";return M.length>=H?M:Array(H-M.length+1).join("0")+M}function w(M,H,J="0",O="0",I="0",F="0",L="",N="0",R="0"){return"+"===L||"-"===L?(M=`${f(parseInt(M,10),4)}-${f(parseInt(H,10),2)}-${f(parseInt(J,10),2)}`,H="",10>parseFloat(F)&&(H="0"),O=`${f(parseInt(O,10),2)}:${f(parseInt(I,10),2)}:${H+parseFloat(F).toString()}`,L=`${L}${f(parseInt(N,10),2)}:${f(parseInt(R,10),2)}`,new Date(M+"T"+O+L)):new Date(parseInt(M,10),parseInt(H,10)-1,parseInt(J,10),parseInt(O,
10),parseInt(I,10),parseFloat(F))}function e(M){let H=x.exec(M);if(null!==H){const [,J,O,I,F,L,N]=H;return w(J,O,I,F,L,N)}H=C.exec(M);if(null!==H){const [,J,O,I,F,L,N,R,S,P]=H;return w(J,O,I,F,L,N,R,S,P)}H=A.exec(M);if(null!==H){const [,J,O,I,F,L,N,R,S]=H;return w(J,O,I,F,L,"0",N,R,S)}H=B.exec(M);if(null!==H){const [,J,O,I,F,L]=H;return w(J,O,I,F,L)}H=v.exec(M);if(null!==H){const [,J,O,I]=H;return w(J,O,I)}throw Error("SQL Invalid Timestamp");}function l(M){M=v.exec(M);if(null===M)throw Error("SQL Invalid Date");
const [,H,J,O]=M;return new Date(parseInt(H,10),parseInt(J,10)-1,parseInt(O,10))}function g(M){return Array.isArray(M)?M:[M]}function d(M){return null!==M?!0!==M:null}function c(M,H){return null!=M&&null!=H?!0===M&&!0===H:!1===M||!1===H?!1:null}function u(M,H){return null!=M&&null!=H?!0===M||!0===H:!0===M||!0===H?!0:null}function t(M,H){if(null==M)return null;let J=!1;for(const O of H)if(null==O)J=null;else if(M===O){J=!0;break}return J}function h(M,H,J){if(null==M)return null;let O="",I=0;for(let F=
0;F<H.length;F++){const L=H.charAt(F);switch(I){case 0:L===J?I=1:O=0<="-[]/{}()*+?.\\^$|".indexOf(L)?O+("\\"+L):"%"===L?O+".*":"_"===L?O+".":O+L;break;case 1:O=0<="-[]/{}()*+?.\\^$|".indexOf(L)?O+("\\"+L):O+L,I=0}}return(new RegExp("^"+O+"$")).test(M)}function m(M){return M instanceof Date?M.valueOf():M}function n(M,H,J){if(null==H||null==J)return null;H=m(H);J=m(J);switch(M){case "\x3c\x3e":return H!==J;case "\x3d":return H===J;case "\x3e":return H>J;case "\x3c":return H<J;case "\x3e\x3d":return H>=
J;case "\x3c\x3d":return H<=J}}function z(M,H,J){if(H instanceof q.SqlInterval)if(J instanceof Date)switch(M){case "+":return new Date(H.valueInMilliseconds()+J.getTime());case "-":return H.valueInMilliseconds()-J.getTime();case "*":return H.valueInMilliseconds()*J.getTime();case "/":return H.valueInMilliseconds()/J.getTime()}else if(J instanceof q.SqlInterval)switch(M){case "+":return q.SqlInterval.createFromMilliseconds(H.valueInMilliseconds()+J.valueInMilliseconds());case "-":return q.SqlInterval.createFromMilliseconds(H.valueInMilliseconds()-
J.valueInMilliseconds());case "*":return H.valueInMilliseconds()*J.valueInMilliseconds();case "/":return H.valueInMilliseconds()/J.valueInMilliseconds()}else H=H.valueInMilliseconds();else if(J instanceof q.SqlInterval)if(H instanceof Date)switch(M){case "+":return new Date(J.valueInMilliseconds()+H.getTime());case "-":return new Date(H.getTime()-J.valueInMilliseconds());case "*":return H.getTime()*J.valueInMilliseconds();case "/":return H.getTime()/J.valueInMilliseconds()}else J=J.valueInMilliseconds();
else if(H instanceof Date&&"number"===typeof J)switch(J*=864E5,H=H.getTime(),M){case "+":return new Date(H+J);case "-":return new Date(H-J);case "*":return new Date(H*J);case "/":return new Date(H/J)}else if(J instanceof Date&&"number"===typeof H)switch(H*=864E5,J=J.getTime(),M){case "+":return new Date(H+J);case "-":return new Date(H-J);case "*":return new Date(H*J);case "/":return new Date(H/J)}switch(M){case "+":return H+J;case "-":return H-J;case "*":return H*J;case "/":return H/J}}function k(M,
H,J,O){M=O.getAttribute(M,H);return null!=M&&1===J[H]?new Date(M):M}const v=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,C=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,A=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,B=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,D=new Set(["current_timestamp","current_date","current_time"]);let E=function(){function M(){}
M.makeBool=function(H){return!0===H};M.featureValue=function(H,J,O,I){return k(H,J,O,I)};M.equalsNull=function(H){return null===H};M.applyLike=function(H,J,O){return h(H,J,O)};M.ensureArray=function(H){return g(H)};M.applyIn=function(H,J){return t(H,J)};M.currentDate=function(){const H=new Date;H.setHours(0,0,0,0);return H};M.makeSqlInterval=function(H,J,O){return q.SqlInterval.createFromValueAndQualifer(H,J,O)};M.convertInterval=function(H){return H instanceof q.SqlInterval?H.valueInMilliseconds():
H};M.currentTimestamp=function(){return new Date};M.compare=function(H,J,O){return n(H,J,O)};M.calculate=function(H,J,O){return z(H,J,O)};M.makeComparable=function(H){return m(H)};M.evaluateFunction=function(H,J){return q.evaluateFunction(H,J)};M.lookup=function(H,J){H=J[H];return void 0===H?null:H};M.between=function(H,J){return null==H||null==J[0]||null==J[1]?null:H>=J[0]&&H<=J[1]};M.notbetween=function(H,J){return null==H||null==J[0]||null==J[1]?null:H<J[0]||H>J[1]};M.ternaryNot=function(H){return d(H)};
M.ternaryAnd=function(H,J){return c(H,J)};M.ternaryOr=function(H,J){return u(H,J)};return M}(),G=function(){function M(J,O){this.fieldsIndex=O;this.datefields={};this.parameters={};this._hasDateFunctions=void 0;this.parseTree=y.WhereGrammar.parse(J);const {isStandardized:I,isAggregate:F,referencedFieldNames:L}=this.extractExpressionInfo(O);this.referencedFieldNames=L;this.isStandardized=I;this.isAggregate=F}M.create=function(J,O){return new M(J,O)};var H=M.prototype;H.testSet=function(J,O=K){const I=
{};for(const F of this.fieldNames)I[F]=J.map(L=>O.getAttribute(L,F));return!!this.evaluateNode(this.parseTree,{attributes:I},K)};H.calculateValue=function(J,O=K){J=this.evaluateNode(this.parseTree,J,O);return J instanceof q.SqlInterval?J.valueInMilliseconds()/864E5:J};H.calculateValueCompiled=function(J,O=K){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(J,this.parameters,O,this.datefields);if(b("csp-restrictions"))return this.calculateValue(J,O);this.compileMe();
return this.parseTree._compiledVersion(J,this.parameters,O,this.datefields)};H.testFeature=function(J,O=K){return!!this.evaluateNode(this.parseTree,J,O)};H.testFeatureCompiled=function(J,O=K){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(J,this.parameters,O,this.datefields);if(b("csp-restrictions"))return this.testFeature(J,O);this.compileMe();return!!this.parseTree._compiledVersion(J,this.parameters,O,this.datefields)};H.getFunctions=function(){const J=new Set;
this.visitAll(this.parseTree,O=>{"function"===O.type&&J.add(O.name.toLowerCase())});return Array.from(J)};H.getExpressions=function(){const J=new Map;this.visitAll(this.parseTree,O=>{if("function"===O.type){const I=O.name.toLowerCase();O=O.args.value[0];if("column_ref"===O.type){O=O.column;const F=`${I}-${O}`;J.has(F)||J.set(F,{aggregateType:I,field:O})}}});return[...J.values()]};H.getVariables=function(){const J=new Set;this.visitAll(this.parseTree,O=>{"param"===O.type&&J.add(O.value.toLowerCase())});
return Array.from(J)};H.compileMe=function(){const J="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",J)).bind(E)};H.extractExpressionInfo=function(J){const O=[],I=new Set;let F=!0,L=!0;this.visitAll(this.parseTree,N=>{switch(N.type){case "column_ref":{const R=J.get(N.column);let S,P;R?S=P=R.name:(P=N.column,S=P.toLowerCase());!R||"date"!==R.type&&"esriFieldTypeDate"!==
R.type||(this.datefields[R.name]=1);I.has(S)||(I.add(S),O.push(P));N.column=P;break}case "function":{const {name:R,args:S}=N;N=S.value.length;F&&(F=q.isStandardized(R,N));L&&(L=r.isAggregate(R,N))}}});return{referencedFieldNames:Array.from(O),isStandardized:F,isAggregate:L}};H.visitAll=function(J,O){if(null!=J)switch(O(J),J.type){case "when_clause":this.visitAll(J.operand,O);this.visitAll(J.value,O);break;case "case_expression":for(const I of J.clauses)this.visitAll(I,O);"simple"===J.format&&this.visitAll(J.operand,
O);null!==J.else&&this.visitAll(J.else,O);break;case "expr_list":for(const I of J.value)this.visitAll(I,O);break;case "unary_expr":this.visitAll(J.expr,O);break;case "binary_expr":this.visitAll(J.left,O);this.visitAll(J.right,O);break;case "function":this.visitAll(J.args,O)}};H.evaluateNodeToJavaScript=function(J){switch(J.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(J.value)+", "+JSON.stringify(J.qualifier)+","+JSON.stringify(J.op)+")";case "case_expression":var O=
"";if("simple"===J.format){var I="this.makeComparable("+this.evaluateNodeToJavaScript(J.operand)+")";O="( ";for(let F=0;F<J.clauses.length;F++)O+=" ("+I+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(J.clauses[F].operand)+")) ? ("+this.evaluateNodeToJavaScript(J.clauses[F].value)+") : "}else for(O="( ",I=0;I<J.clauses.length;I++)O+=" this.makeBool("+this.evaluateNodeToJavaScript(J.clauses[I].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(J.clauses[I].value)+") : ";
O=null!==J.else?O+this.evaluateNodeToJavaScript(J.else):O+"null";return O+=" )";case "param":return"this.lookup("+JSON.stringify(J.value.toLowerCase())+",lookups)";case "expr_list":O="[";for(I of J.value)"["!==O&&(O+=","),O+=this.evaluateNodeToJavaScript(I);return O+="]";case "unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(J.expr)+")";case "binary_expr":switch(J.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+
" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+" )";case "IS":if("null"!==J.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(J.left)+")";case "ISNOT":if("null"!==J.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(J.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(J.left)+",this.ensureArray("+
this.evaluateNodeToJavaScript(J.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(J.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(J.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(J.left)+
","+this.evaluateNodeToJavaScript(J.right)+","+JSON.stringify(J.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+","+JSON.stringify(J.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(J.operator)+","+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+
JSON.stringify(J.operator)+","+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+")"}throw Error("Not Supported Operator "+J.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(J.value);case "date":return"(new Date("+l(J.value).getTime().toString()+"))";case "timestamp":return"(new Date("+e(J.value).getTime().toString()+"))";case "current_time":return"date"===J.mode?"this.currentDate()":"this.currentTimestamp()";case "column_ref":return"this.featureValue(feature,"+
JSON.stringify(J.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(J.name)+","+this.evaluateNodeToJavaScript(J.args)+")"}throw Error("Unsupported sql syntax "+J.type);};H.evaluateNode=function(J,O,I){switch(J.type){case "interval":return O=this.evaluateNode(J.value,O,I),q.SqlInterval.createFromValueAndQualifer(O,J.qualifier,J.op);case "case_expression":if("simple"===J.format){var F=m(this.evaluateNode(J.operand,O,I));for(var L=0;L<J.clauses.length;L++)if(F===
m(this.evaluateNode(J.clauses[L].operand,O,I)))return this.evaluateNode(J.clauses[L].value,O,I)}else for(F=0;F<J.clauses.length;F++)if(!0===this.evaluateNode(J.clauses[F].operand,O,I))return this.evaluateNode(J.clauses[F].value,O,I);return null!==J.else?this.evaluateNode(J.else,O,I):null;case "param":return this.parameters[J.value.toLowerCase()];case "expr_list":F=[];for(L of J.value)F.push(this.evaluateNode(L,O,I));return F;case "unary_expr":return d(this.evaluateNode(J.expr,O,I));case "binary_expr":switch(J.operator){case "AND":return c(this.evaluateNode(J.left,
O,I),this.evaluateNode(J.right,O,I));case "OR":return u(this.evaluateNode(J.left,O,I),this.evaluateNode(J.right,O,I));case "IS":if("null"!==J.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(J.left,O,I);case "ISNOT":if("null"!==J.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(J.left,O,I);case "IN":return F=g(this.evaluateNode(J.right,O,I)),t(this.evaluateNode(J.left,O,I),F);case "NOT IN":return F=g(this.evaluateNode(J.right,O,I)),d(t(this.evaluateNode(J.left,
O,I),F));case "BETWEEN":return F=this.evaluateNode(J.left,O,I),J=this.evaluateNode(J.right,O,I),null==F||null==J[0]||null==J[1]?null:F>=m(J[0])&&F<=m(J[1]);case "NOTBETWEEN":return F=this.evaluateNode(J.left,O,I),J=this.evaluateNode(J.right,O,I),null==F||null==J[0]||null==J[1]?null:F<m(J[0])||F>m(J[1]);case "LIKE":return h(this.evaluateNode(J.left,O,I),this.evaluateNode(J.right,O,I),J.escape);case "NOT LIKE":return d(h(this.evaluateNode(J.left,O,I),this.evaluateNode(J.right,O,I),J.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return n(J.operator,
this.evaluateNode(J.left,O,I),this.evaluateNode(J.right,O,I));case "-":case "+":case "*":case "/":return z(J.operator,this.evaluateNode(J.left,O,I),this.evaluateNode(J.right,O,I))}case "null":case "bool":case "string":case "number":return J.value;case "date":return l(J.value);case "timestamp":return e(J.value);case "current_time":return O=new Date,"date"===J.mode&&O.setHours(0,0,0,0),O;case "column_ref":return k(O,J.column,this.datefields,I);case "function":return O=this.evaluateNode(J.args,O,I),
this.isAggregate?r.aggregateFunction(J.name,O):q.evaluateFunction(J.name,O)}throw Error("Unsupported sql syntax "+J.type);};p._createClass(M,[{key:"fieldNames",get:function(){return this.referencedFieldNames}},{key:"hasDateFunctions",get:function(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=!1;this.visitAll(this.parseTree,J=>{"current_time"===J.type?this._hasDateFunctions=!0:"function"===J.type&&(this._hasDateFunctions=this._hasDateFunctions||D.has(J.name.toLowerCase()))});
return this._hasDateFunctions}}]);return M}();const K={getAttribute(M,H){return(M&&"object"===typeof M.attributes?M.attributes:M)[H]}};a.WhereClause=G;a.defaultAttributeAdapter=K;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/AggregateFunctions":function(){define(["exports"],function(a){function p(q){let y=0;for(let f=0;f<q.length;f++)y+=q[f];return y/q.length}function b(q){const y=p(q),f=q.length;let w=0;for(const e of q)w+=(e-y)**2;return 1<f?w/(f-1):0}const r={min:{minParams:1,
maxParams:1,evaluate:q=>null==q[0]?null:Math.min.apply(Math,q[0])},max:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.max.apply(Math,q[0])},avg:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:p(q[0])},sum:{minParams:1,maxParams:1,evaluate:q=>{if(null==q[0])q=null;else{{q=q[0];let y=0;for(let f=0;f<q.length;f++)y+=q[f];q=y}}return q}},stddev:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.sqrt(b(q[0]))},count:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:q[0].length},
var:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:b(q[0])}};a.aggregateFunction=function(q,y){const f=r[q.toLowerCase()];if(null==f)throw Error("Function Not Recognised");if(y.length<f.minParams||y.length>f.maxParams)throw Error(`Invalid Parameter count for call to ${q.toUpperCase()}`);return f.evaluate(y)};a.isAggregate=function(q,y){q=r[q.toLowerCase()];return null!=q&&y>=q.minParams&&y<=q.maxParams};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/StandardizedFunctions":function(){define(["exports",
"../string"],function(a,p){let b=function(){function q(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}q.fixDefaults=function(y){if(null!==y.precision||null!==y.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};q.createFromMilliseconds=function(y){const f=new q;f.second=y/1E3;return f};q.createFromValueAndQualifer=function(y,f,w){let e=null;const l=new q;l.op="-"===w?"-":"+";if("interval-period"===f.type){q.fixDefaults(f);if("year"===
f.period||"month"===f.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(y))l[f.period]=parseFloat(y);else throw Error("Illegal Interval");}else{q.fixDefaults(f.start);q.fixDefaults(f.end);if("year"===f.start.period||"month"===f.start.period)throw Error("Year-Month Intervals not supported");if("year"===f.end.period||"month"===f.end.period)throw Error("Year-Month Intervals not supported");switch(f.start.period){case "day":switch(f.end.period){case "hour":e=/^[0-9]{1,} [0-9]{1,}$/;
if(e.test(y))l[f.start.period]=parseFloat(y.split(" ")[0]),l[f.end.period]=parseFloat(y.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":e=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(e.test(y))l[f.start.period]=parseFloat(y.split(" ")[0]),y=y.split(" ")[1].split(":"),l.hour=parseFloat(y[0]),l.minute=parseFloat(y[1]);else throw Error("Illegal Interval");break;case "second":e=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(y))l[f.start.period]=parseFloat(y.split(" ")[0]),
y=y.split(" ")[1].split(":"),l.hour=parseFloat(y[0]),l.minute=parseFloat(y[1]),l.second=parseFloat(y[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(f.end.period){case "minute":e=/^[0-9]{1,}:[0-9]{1,}$/;if(e.test(y))l.hour=parseFloat(y.split(":")[0]),l.minute=parseFloat(y.split(":")[1]);else throw Error("Illegal Interval");break;case "second":e=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(y))y=y.split(":"),l.hour=parseFloat(y[0]),
l.minute=parseFloat(y[1]),l.second=parseFloat(y[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(f.end.period){case "second":e=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(y))y=y.split(":"),l.minute=parseFloat(y[0]),l.second=parseFloat(y[1]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return l};q.prototype.valueInMilliseconds=function(){return("-"===this.op?
-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return q}();const r={extract:{minParams:2,maxParams:2,evaluate:([q,y])=>{if(null==y)return null;if(y instanceof Date)switch(q.toUpperCase()){case "SECOND":return y.getSeconds();case "MINUTE":return y.getMinutes();case "HOUR":return y.getHours();case "DAY":return y.getDate();case "MONTH":return y.getMonth()+1;case "YEAR":return y.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");
}},substring:{minParams:2,maxParams:3,evaluate:q=>{if(2===q.length){const [y,f]=q;return null==y||null==f?null:y.toString().substring(f-1)}if(3===q.length){const [y,f,w]=q;return null==y||null==f||null==w?null:0>=w?"":y.toString().substring(f-1,f+w-1)}}},position:{minParams:2,maxParams:2,evaluate:([q,y])=>null==q||null==y?null:y.indexOf(q)+1},trim:{minParams:2,maxParams:3,evaluate:q=>{var y=3===q.length,f=y?q[1]:" ";y=y?q[2]:q[1];if(null==f||null==y)return null;f=`(${p.escapeRegExpString(f)})`;switch(q[0]){case "BOTH":return y.replace(new RegExp(`^${f}*|${f}*$`,
"g"),"");case "LEADING":return y.replace(new RegExp(`^${f}*`,"g"),"");case "TRAILING":return y.replace(new RegExp(`${f}*$`,"g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.abs(q[0])},ceiling:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.ceil(q[0])},floor:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.floor(q[0])},log:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.log(q[0])},log10:{minParams:1,
maxParams:1,evaluate:q=>null==q[0]?null:Math.log(q[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.sin(q[0])},cos:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.cos(q[0])},tan:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.tan(q[0])},asin:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.asin(q[0])},acos:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.acos(q[0])},atan:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.atan(q[0])},
sign:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:0<q[0]?1:0>q[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:q=>null==q[0]||null==q[1]?null:q[0]**q[1]},mod:{minParams:2,maxParams:2,evaluate:q=>null==q[0]||null==q[1]?null:q[0]%q[1]},round:{minParams:1,maxParams:2,evaluate:q=>{const y=q[0];q=2===q.length?10**q[1]:1;return null==y?null:Math.round(y*q)/q}},truncate:{minParams:1,maxParams:2,evaluate:q=>null==q[0]?null:1===q.length?parseInt(q[0].toFixed(0),10):parseFloat(q[0].toFixed(q[1]))},
char_length:{minParams:1,maxParams:1,evaluate:q=>"string"===typeof q[0]||q[0]instanceof String?q[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:q=>{let y="";for(let f=0;f<q.length;f++){if(null==q[f])return null;y+=q[f].toString()}return y}},lower:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:q[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:q[0].toString().toUpperCase()}};a.SqlInterval=b;a.evaluateFunction=function(q,y){const f=r[q.toLowerCase()];
if(null==f)throw Error("Function Not Recognised");if(y.length<f.minParams||y.length>f.maxParams)throw Error(`Invalid Parameter count for call to ${q.toUpperCase()}`);return f.evaluate(y)};a.isStandardized=function(q,y){q=r[q.toLowerCase()];return null!=q&&y>=q.minParams&&y<=q.maxParams};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,p){var b={exports:{}};(function(q){(function(y,f){q.exports&&
(q.exports=f())})(p.commonjsGlobal,function(){function y(f,w,e,l){this.message=f;this.expected=w;this.found=e;this.location=l;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,y)}(function(f,w){function e(){this.constructor=f}e.prototype=w.prototype;f.prototype=new e})(y,Error);y.buildMessage=function(f,w){function e(c){return c.charCodeAt(0).toString(16).toUpperCase()}function l(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,
"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+e(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+e(u)})}function g(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+e(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+e(u)})}var d={literal:function(c){return'"'+
l(c.text)+'"'},class:function(c){var u="",t;for(t=0;t<c.parts.length;t++)u+=c.parts[t]instanceof Array?g(c.parts[t][0])+"-"+g(c.parts[t][1]):g(c.parts[t]);return"["+(c.inverted?"^":"")+u+"]"},any:function(c){return"any character"},end:function(c){return"end of input"},other:function(c){return c.description}};return"Expected "+function(c){var u=Array(c.length),t;for(t=0;t<c.length;t++){var h=t;var m=c[t];m=d[m.type](m);u[h]=m}u.sort();if(0<u.length){for(c=t=1;t<u.length;t++)u[t-1]!==u[t]&&(u[c]=u[t],
c++);u.length=c}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}(f)+" but "+(w?'"'+l(w)+'"':"end of input")+" found."};return{SyntaxError:y,parse:function(f,w){function e(oa,ya){return{type:"literal",text:oa,ignoreCase:ya}}function l(oa,ya,xa){return{type:"class",parts:oa,inverted:ya,ignoreCase:xa}}function g(oa){var ya=lc[oa],xa;if(!ya){for(xa=oa-1;!lc[xa];)xa--;ya=lc[xa];for(ya={line:ya.line,column:ya.column};xa<oa;)10===
f.charCodeAt(xa)?(ya.line++,ya.column=1):ya.column++,xa++;lc[oa]=ya}return ya}function d(oa,ya){var xa=g(oa),Na=g(ya);return{start:{offset:oa,line:xa.line,column:xa.column},end:{offset:ya,line:Na.line,column:Na.column}}}function c(oa){ja<Db||(ja>Db&&(Db=ja,Fc=[]),Fc.push(oa))}function u(){var oa=ja;var ya=ka();if(ya!==da)if(ya=h(),ya!==da){var xa=ka();xa!==da?oa=ya:(ja=oa,oa=da)}else ja=oa,oa=da;else ja=oa,oa=da;return oa}function t(){var oa=ja;var ya=h();if(ya!==da){var xa=[];var Na=ja;var Za=ka();
if(Za!==da){var fb=ta();if(fb!==da){var gb=ka();if(gb!==da){var ib=h();ib!==da?Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)}else ja=Na,Na=da}else ja=Na,Na=da}else ja=Na,Na=da;for(;Na!==da;)xa.push(Na),Na=ja,Za=ka(),Za!==da?(fb=ta(),fb!==da?(gb=ka(),gb!==da?(ib=h(),ib!==da?Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da);if(xa!==da){oa={type:"expr_list"};ya=[ya];for(Na=0;Na<xa.length;Na++)ya.push(xa[Na][3]);oa.value=ya}else ja=oa,oa=da}else ja=oa,oa=da;return oa}function h(){var oa=
ja;var ya=m();if(ya!==da){var xa=[];var Na=ja;var Za=ka();if(Za!==da){var fb=T();if(fb!==da){var gb=ka();if(gb!==da){var ib=m();ib!==da?Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)}else ja=Na,Na=da}else ja=Na,Na=da}else ja=Na,Na=da;for(;Na!==da;)xa.push(Na),Na=ja,Za=ka(),Za!==da?(fb=T(),fb!==da?(gb=ka(),gb!==da?(ib=m(),ib!==da?Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da);xa!==da?oa=ya=Ta(ya,xa):(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function m(){var oa=ja;var ya=n();if(ya!==
da){var xa=[];var Na=ja;var Za=ka();if(Za!==da){var fb=X();if(fb!==da){var gb=ka();if(gb!==da){var ib=n();ib!==da?Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)}else ja=Na,Na=da}else ja=Na,Na=da}else ja=Na,Na=da;for(;Na!==da;)xa.push(Na),Na=ja,Za=ka(),Za!==da?(fb=X(),fb!==da?(gb=ka(),gb!==da?(ib=n(),ib!==da?Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da);xa!==da?oa=ya=Ta(ya,xa):(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function n(){var oa=ja;var ya=U();if(ya===da){ya=ja;if(33===f.charCodeAt(ja)){var xa=
Da;ja++}else xa=da,0===Xa&&c(Pa);if(xa!==da){var Na=ja;Xa++;if(61===f.charCodeAt(ja)){var Za=Qa;ja++}else Za=da,0===Xa&&c(na);Xa--;Za===da?Na=void 0:(ja=Na,Na=da);Na!==da?ya=xa=[xa,Na]:(ja=ya,ya=da)}else ja=ya,ya=da}ya!==da?(xa=ka(),xa!==da?(Na=n(),Na!==da?oa=ya={type:"unary_expr",operator:"NOT",expr:Na}:(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da);if(oa===da)if(oa=ja,ya=x(),ya!==da)if(xa=ka(),xa!==da){xa=[];Na=ja;Za=ka();if(Za!==da){var fb=z();if(fb!==da){var gb=ka();if(gb!==da){var ib=x();ib!==da?
Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)}else ja=Na,Na=da}else ja=Na,Na=da}else ja=Na,Na=da;if(Na!==da)for(;Na!==da;)xa.push(Na),Na=ja,Za=ka(),Za!==da?(fb=z(),fb!==da?(gb=ka(),gb!==da?(ib=x(),ib!==da?Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da);else xa=da;xa!==da&&(xa={type:"arithmetic",tail:xa});xa===da&&(xa=ja,Na=v(),Na!==da?(Za=ka(),Za!==da?(Za=Ea(),Za!==da?(Za=ka(),Za!==da?(Za=t(),Za!==da?(fb=ka(),fb!==da?(fb=Ca(),fb!==da?xa=Na={op:Na,right:Za}:(ja=xa,xa=da)):(ja=xa,
xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da),xa===da&&(xa=ja,Na=v(),Na!==da?(Za=ka(),Za!==da?(Za=Ea(),Za!==da?(Za=ka(),Za!==da?(Za=Ca(),Za!==da?xa=Na={op:Na,right:{type:"expr_list",value:[]}}:(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da),xa===da&&(xa=ja,Na=v(),Na!==da?(Za=ka(),Za!==da?(Za=H(),Za!==da?xa=Na={op:Na,right:Za}:(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da))),xa===da&&(xa=ja,Za=U(),Za!==da?(Na=ka(),Na!==da?(Na=Y(),Na!==da?(fb=
ka(),fb!==da?(fb=x(),fb!==da?(gb=ka(),gb!==da?(gb=X(),gb!==da?(Za=ka(),Za!==da?(Za=x(),Za!==da?xa=Za={op:"NOT"+Na,right:{type:"expr_list",value:[fb,Za]}}:(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da),xa===da&&(xa=ja,Za=Y(),Za!==da?(Na=ka(),Na!==da?(Na=x(),Na!==da?(fb=ka(),fb!==da?(fb=X(),fb!==da?(gb=ka(),gb!==da?(gb=x(),gb!==da?xa=Za={op:Za,right:{type:"expr_list",value:[Na,gb]}}:(ja=xa,xa=da)):(ja=xa,xa=da)):
(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)),xa===da&&(xa=ja,Na=aa(),Na!==da?(Za=ka(),Za!==da?(Za=U(),Za!==da?(Za=ka(),Za!==da?(Za=x(),Za!==da?xa=Na={op:Na+"NOT",right:Za}:(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da),xa===da&&(xa=ja,Na=aa(),Na!==da?(Za=ka(),Za!==da?(Za=x(),Za!==da?xa=Na={op:Na,right:Za}:(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)),xa===da&&(xa=ja,Na=k(),Na!==da?(Za=ka(),Za!==da?(Za=N(),Za!==da?(fb=ka(),fb!==da?(fb=ja,f.substr(ja,
6).toLowerCase()===Gd?(gb=f.substr(ja,6),ja+=6):(gb=da,0===Xa&&c(Hd)),gb!==da?(gb=ja,Xa++,ib=K(),Xa--,ib===da?gb=void 0:(ja=gb,gb=da),gb!==da?fb="ESCAPE":(ja=fb,fb=da)):(ja=fb,fb=da),fb!==da?(fb=ka(),fb!==da?(fb=R(),fb!==da?xa=Na={op:Na,right:Za,escape:fb.value}:(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da),xa===da&&(xa=ja,Na=k(),Na!==da?(Za=ka(),Za!==da?(Za=N(),Za!==da?xa=Na={op:Na,right:Za,escape:""}:(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,
xa=da))))));xa===da&&(xa=null);xa!==da?(oa=ya,ya=xa,""==ya||void 0==ya||null==ya?ya=oa:(xa=null,ya=xa="arithmetic"==ya.type?Ta(oa,ya.tail):Ja(ya.op,oa,ya.right,ya.escape)),oa=ya):(ja=oa,oa=da)}else ja=oa,oa=da;else ja=oa,oa=da;return oa}function z(){if(f.substr(ja,2)===Aa){var oa=Aa;ja+=2}else oa=da,0===Xa&&c(Ra);oa===da&&(62===f.charCodeAt(ja)?(oa=Ua,ja++):(oa=da,0===Xa&&c(Wa)),oa===da&&(f.substr(ja,2)===ab?(oa=ab,ja+=2):(oa=da,0===Xa&&c(eb)),oa===da&&(f.substr(ja,2)===db?(oa=db,ja+=2):(oa=da,0===
Xa&&c(lb)),oa===da&&(60===f.charCodeAt(ja)?(oa=Ha,ja++):(oa=da,0===Xa&&c(Ka)),oa===da&&(61===f.charCodeAt(ja)?(oa=Qa,ja++):(oa=da,0===Xa&&c(na)),oa===da&&(f.substr(ja,2)===Ga?(oa=Ga,ja+=2):(oa=da,0===Xa&&c(Oa))))))));return oa}function k(){var oa=oa=ja;var ya=U();if(ya!==da){var xa=ka();if(xa!==da){var Na=W();Na!==da?oa=ya=[ya,xa,Na]:(ja=oa,oa=da)}else ja=oa,oa=da}else ja=oa,oa=da;oa!==da&&(oa=oa[0]+" "+oa[2]);oa===da&&(oa=W());return oa}function v(){var oa=oa=ja;var ya=U();if(ya!==da){var xa=ka();
if(xa!==da){var Na=fa();Na!==da?oa=ya=[ya,xa,Na]:(ja=oa,oa=da)}else ja=oa,oa=da}else ja=oa,oa=da;oa!==da&&(oa=oa[0]+" "+oa[2]);oa===da&&(oa=fa());return oa}function x(){var oa=ja;var ya=A();if(ya!==da){var xa=[];var Na=ja;var Za=ka();if(Za!==da){var fb=C();if(fb!==da){var gb=ka();if(gb!==da){var ib=A();ib!==da?Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)}else ja=Na,Na=da}else ja=Na,Na=da}else ja=Na,Na=da;for(;Na!==da;)xa.push(Na),Na=ja,Za=ka(),Za!==da?(fb=C(),fb!==da?(gb=ka(),gb!==da?(ib=A(),ib!==da?Na=Za=[Za,
fb,gb,ib]:(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da);xa!==da?oa=ya=Ta(ya,xa):(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function C(){if(43===f.charCodeAt(ja)){var oa=za;ja++}else oa=da,0===Xa&&c(Ba);oa===da&&(45===f.charCodeAt(ja)?(oa=Va,ja++):(oa=da,0===Xa&&c(Ya)));return oa}function A(){var oa=ja;var ya=D();if(ya!==da){var xa=[];var Na=ja;var Za=ka();if(Za!==da){var fb=B();if(fb!==da){var gb=ka();if(gb!==da){var ib=D();ib!==da?Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)}else ja=Na,Na=da}else ja=
Na,Na=da}else ja=Na,Na=da;for(;Na!==da;)xa.push(Na),Na=ja,Za=ka(),Za!==da?(fb=B(),fb!==da?(gb=ka(),gb!==da?(ib=D(),ib!==da?Na=Za=[Za,fb,gb,ib]:(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da)):(ja=Na,Na=da);xa!==da?oa=ya=Ta(ya,xa):(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function B(){if(42===f.charCodeAt(ja)){var oa=$a;ja++}else oa=da,0===Xa&&c(bb);oa===da&&(47===f.charCodeAt(ja)?(oa=cb,ja++):(oa=da,0===Xa&&c(kb)));return oa}function D(){var oa=R();if(oa===da){var ya=ja;var xa=ja;var Na=V();if(Na!==da){var Za=
ca();if(Za!==da){var fb=ba();fb!==da?xa=Na=parseFloat(Na+Za+fb):(ja=xa,xa=da)}else ja=xa,xa=da}else ja=xa,xa=da;xa===da&&(xa=ja,Na=V(),Na!==da?(Za=ca(),Za!==da?xa=Na=parseFloat(Na+Za):(ja=xa,xa=da)):(ja=xa,xa=da),xa===da&&(xa=ja,Na=V(),Na!==da?(Za=ba(),Za!==da?xa=Na=parseFloat(Na+Za):(ja=xa,xa=da)):(ja=xa,xa=da),xa===da&&(xa=ja,Na=V(),Na!==da&&(Na=parseFloat(Na)),xa=Na)));var gb=xa;if(gb!==da){var ib=ja;Xa++;var Id=G();Xa--;Id===da?ib=void 0:(ja=ib,ib=da);ib!==da?ya=gb={type:"number",value:gb}:(ja=
ya,ya=da)}else ja=ya,ya=da;oa=ya;if(oa===da){var Wb=ja;var Lb=ja;if(f.substr(ja,4).toLowerCase()===Jd){var mc=f.substr(ja,4);ja+=4}else mc=da,0===Xa&&c(Kd);if(mc!==da){var Xb=ja;Xa++;var Ld=K();Xa--;Ld===da?Xb=void 0:(ja=Xb,Xb=da);Xb!==da?Lb=mc=[mc,Xb]:(ja=Lb,Lb=da)}else ja=Lb,Lb=da;var Ib=Lb;Ib!==da&&(Ib={type:"bool",value:!0});Wb=Ib;if(Wb===da){Wb=ja;var Mb=ja;if(f.substr(ja,5).toLowerCase()===Md){var nc=f.substr(ja,5);ja+=5}else nc=da,0===Xa&&c(Nd);if(nc!==da){var Yb=ja;Xa++;var Od=K();Xa--;Od===
da?Yb=void 0:(ja=Yb,Yb=da);Yb!==da?Mb=nc=[nc,Yb]:(ja=Mb,Mb=da)}else ja=Mb,Mb=da;Ib=Mb;Ib!==da&&(Ib={type:"bool",value:!1});Wb=Ib}oa=Wb;if(oa===da){var Nb=ja;if(f.substr(ja,4).toLowerCase()===Pd){var oc=f.substr(ja,4);ja+=4}else oc=da,0===Xa&&c(Qd);if(oc!==da){var Zb=ja;Xa++;var Rd=K();Xa--;Rd===da?Zb=void 0:(ja=Zb,Zb=da);Zb!==da?Nb=oc=[oc,Zb]:(ja=Nb,Nb=da)}else ja=Nb,Nb=da;var Gc=Nb;Gc!==da&&(Gc={type:"null",value:null});oa=Gc;if(oa===da){var Gb=ja;var Ob=ja;if(f.substr(ja,4).toLowerCase()===Sd){var Hc=
f.substr(ja,4);ja+=4}else Hc=da,0===Xa&&c(Td);if(Hc!==da){var pc=ja;Xa++;var Ud=K();Xa--;Ud===da?pc=void 0:(ja=pc,pc=da);pc!==da?Ob=Hc="DATE":(ja=Ob,Ob=da)}else ja=Ob,Ob=da;var gd=Ob;if(gd!==da){var Vd=ka();if(Vd!==da){var hd=N();hd!==da?Gb=gd={type:"date",value:hd.value}:(ja=Gb,Gb=da)}else ja=Gb,Gb=da}else ja=Gb,Gb=da;oa=Gb;if(oa===da){var Hb=ja;var Pb=ja;if(f.substr(ja,9).toLowerCase()===Wd){var Ic=f.substr(ja,9);ja+=9}else Ic=da,0===Xa&&c(Xd);if(Ic!==da){var qc=ja;Xa++;var Yd=K();Xa--;Yd===da?
qc=void 0:(ja=qc,qc=da);qc!==da?Pb=Ic="TIMESTAMP":(ja=Pb,Pb=da)}else ja=Pb,Pb=da;var id=Pb;if(id!==da){var Zd=ka();if(Zd!==da){var jd=N();jd!==da?Hb=id={type:"timestamp",value:jd.value}:(ja=Hb,Hb=da)}else ja=Hb,Hb=da}else ja=Hb,Hb=da;oa=Hb;if(oa===da){var nb=ja;var $b=la();if($b!==da){var Jc=ka();if(Jc!==da){if(45===f.charCodeAt(ja)){var Eb=Va;ja++}else Eb=da,0===Xa&&c(Ya);Eb===da&&(43===f.charCodeAt(ja)?(Eb=za,ja++):(Eb=da,0===Xa&&c(Ba)));if(Eb!==da){var Kc=ka();if(Kc!==da){var ac=N();if(ac!==da){var $d=
ka();if($d!==da){var kd=O();kd!==da?nb=$b={type:"interval",value:ac,qualifier:kd,op:Eb}:(ja=nb,nb=da)}else ja=nb,nb=da}else ja=nb,nb=da}else ja=nb,nb=da}else ja=nb,nb=da}else ja=nb,nb=da}else ja=nb,nb=da;nb===da&&(nb=ja,$b=la(),$b!==da?(Jc=ka(),Jc!==da?(Eb=N(),Eb!==da?(Kc=ka(),Kc!==da?(ac=O(),ac!==da?nb=$b={type:"interval",value:Eb,qualifier:ac,op:""}:(ja=nb,nb=da)):(ja=nb,nb=da)):(ja=nb,nb=da)):(ja=nb,nb=da)):(ja=nb,nb=da));oa=nb}}}}}}var mb=oa;if(mb===da){var qb=ja;var Qb=ja;if(f.substr(ja,7).toLowerCase()===
ae){var Lc=f.substr(ja,7);ja+=7}else Lc=da,0===Xa&&c(be);if(Lc!==da){var rc=ja;Xa++;var ce=K();Xa--;ce===da?rc=void 0:(ja=rc,rc=da);rc!==da?Qb=Lc="EXTRACT":(ja=Qb,Qb=da)}else ja=Qb,Qb=da;var ld=Qb;if(ld!==da){var de=ka();if(de!==da){var ee=Ea();if(ee!==da){var fe=ka();if(fe!==da){var zb=pa();zb===da&&(zb=ua(),zb===da&&(zb=wa(),zb===da&&(zb=Fa(),zb===da&&(zb=La(),zb===da&&(zb=Ma())))));var md=zb;if(md!==da){var ge=ka();if(ge!==da){var he=ea();if(he!==da){var ie=ka();if(ie!==da){var nd=h();if(nd!==
da){var je=ka();if(je!==da){var ke=Ca();ke!==da?qb=ld={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:md},nd]}}:(ja=qb,qb=da)}else ja=qb,qb=da}else ja=qb,qb=da}else ja=qb,qb=da}else ja=qb,qb=da}else ja=qb,qb=da}else ja=qb,qb=da}else ja=qb,qb=da}else ja=qb,qb=da}else ja=qb,qb=da}else ja=qb,qb=da;mb=qb;if(mb===da){var pb=ja;var Rb=ja;if(f.substr(ja,9).toLowerCase()===le){var Mc=f.substr(ja,9);ja+=9}else Mc=da,0===Xa&&c(me);if(Mc!==da){var sc=ja;Xa++;var ne=K();Xa--;
ne===da?sc=void 0:(ja=sc,sc=da);sc!==da?Rb=Mc="SUBSTRING":(ja=Rb,Rb=da)}else ja=Rb,Rb=da;var od=Rb;if(od!==da){var oe=ka();if(oe!==da){var pe=Ea();if(pe!==da){var qe=ka();if(qe!==da){var Nc=h();if(Nc!==da){var re=ka();if(re!==da){var se=ea();if(se!==da){var te=ka();if(te!==da){var Oc=h();if(Oc!==da){var ue=ka();if(ue!==da){var wb=ja;var Sb=ja;if(f.substr(ja,3).toLowerCase()===ve){var Pc=f.substr(ja,3);ja+=3}else Pc=da,0===Xa&&c(we);if(Pc!==da){var tc=ja;Xa++;var xe=K();Xa--;xe===da?tc=void 0:(ja=
tc,tc=da);tc!==da?Sb=Pc="FOR":(ja=Sb,Sb=da)}else ja=Sb,Sb=da;var bc=Sb;if(bc!==da){var pd=ka();if(pd!==da){var qd=h();if(qd!==da){var rd=ka();rd!==da?wb=bc=[bc,pd,qd,rd]:(ja=wb,wb=da)}else ja=wb,wb=da}else ja=wb,wb=da}else ja=wb,wb=da;wb===da&&(wb=null);wb!==da?(bc=Ca(),bc!==da?pb=od={type:"function",name:"substring",args:{type:"expr_list",value:wb?[Nc,Oc,wb[2]]:[Nc,Oc]}}:(ja=pb,pb=da)):(ja=pb,pb=da)}else ja=pb,pb=da}else ja=pb,pb=da}else ja=pb,pb=da}else ja=pb,pb=da}else ja=pb,pb=da}else ja=pb,pb=
da}else ja=pb,pb=da}else ja=pb,pb=da}else ja=pb,pb=da}else ja=pb,pb=da;mb=pb;if(mb===da){var hb=ja;var cc=ia();if(cc!==da){var Qc=ka();if(Qc!==da){var Rc=Ea();if(Rc!==da){var Sc=ka();if(Sc!==da){var Ab=J();Ab===da&&(Ab=null);if(Ab!==da){var Tc=ka();if(Tc!==da){var dc=h();if(dc!==da){var Uc=ka();if(Uc!==da){var Vc=ea();if(Vc!==da){var ye=ka();if(ye!==da){var sd=h();if(sd!==da){var ze=ka();if(ze!==da){var Ae=Ca();Ae!==da?hb=cc={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",
value:null==Ab?"BOTH":Ab},dc,sd]}}:(ja=hb,hb=da)}else ja=hb,hb=da}else ja=hb,hb=da}else ja=hb,hb=da}else ja=hb,hb=da}else ja=hb,hb=da}else ja=hb,hb=da}else ja=hb,hb=da}else ja=hb,hb=da}else ja=hb,hb=da}else ja=hb,hb=da}else ja=hb,hb=da}else ja=hb,hb=da;hb===da&&(hb=ja,cc=ia(),cc!==da?(Qc=ka(),Qc!==da?(Rc=Ea(),Rc!==da?(Sc=ka(),Sc!==da?(Ab=J(),Ab===da&&(Ab=null),Ab!==da?(Tc=ka(),Tc!==da?(dc=h(),dc!==da?(Uc=ka(),Uc!==da?(Vc=Ca(),Vc!==da?hb=cc={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",
value:null==Ab?"BOTH":Ab},dc]}}:(ja=hb,hb=da)):(ja=hb,hb=da)):(ja=hb,hb=da)):(ja=hb,hb=da)):(ja=hb,hb=da)):(ja=hb,hb=da)):(ja=hb,hb=da)):(ja=hb,hb=da)):(ja=hb,hb=da));mb=hb;if(mb===da){var rb=ja;var Tb=ja;if(f.substr(ja,8).toLowerCase()===Be){var Wc=f.substr(ja,8);ja+=8}else Wc=da,0===Xa&&c(Ce);if(Wc!==da){var uc=ja;Xa++;var De=K();Xa--;De===da?uc=void 0:(ja=uc,uc=da);uc!==da?Tb=Wc="POSITION":(ja=Tb,Tb=da)}else ja=Tb,Tb=da;var td=Tb;if(td!==da){var Ee=ka();if(Ee!==da){var Fe=Ea();if(Fe!==da){var Ge=
ka();if(Ge!==da){var ud=h();if(ud!==da){var He=ka();if(He!==da){var Ie=fa();if(Ie!==da){var Je=ka();if(Je!==da){var vd=h();if(vd!==da){var Ke=ka();if(Ke!==da){var Le=Ca();Le!==da?rb=td={type:"function",name:"position",args:{type:"expr_list",value:[ud,vd]}}:(ja=rb,rb=da)}else ja=rb,rb=da}else ja=rb,rb=da}else ja=rb,rb=da}else ja=rb,rb=da}else ja=rb,rb=da}else ja=rb,rb=da}else ja=rb,rb=da}else ja=rb,rb=da}else ja=rb,rb=da}else ja=rb,rb=da;mb=rb;if(mb===da){var vb=ja;var ec;var Bb=ja;Bb=ec=E();if(Bb===
da)if(Bb=ja,96===f.charCodeAt(ja)?(ec=wd,ja++):(ec=da,0===Xa&&c(xd)),ec!==da){var vc=[];if(yd.test(f.charAt(ja))){var Fb=f.charAt(ja);ja++}else Fb=da,0===Xa&&c(zd);if(Fb!==da)for(;Fb!==da;)vc.push(Fb),yd.test(f.charAt(ja))?(Fb=f.charAt(ja),ja++):(Fb=da,0===Xa&&c(zd));else vc=da;vc!==da?(96===f.charCodeAt(ja)?(Fb=wd,ja++):(Fb=da,0===Xa&&c(xd)),Fb!==da?Bb=ec=vc.join(""):(ja=Bb,Bb=da)):(ja=Bb,Bb=da)}else ja=Bb,Bb=da;var Xc=Bb;if(Xc!==da){var Me=ka();if(Me!==da){var Ne=Ea();if(Ne!==da){var Oe=ka();if(Oe!==
da){var fc=t();fc===da&&(fc=null);if(fc!==da){var Pe=ka();if(Pe!==da){var Qe=Ca();Qe!==da?vb=Xc={type:"function",name:Xc,args:fc?fc:{type:"expr_list",value:[]}}:(ja=vb,vb=da)}else ja=vb,vb=da}else ja=vb,vb=da}else ja=vb,vb=da}else ja=vb,vb=da}else ja=vb,vb=da}else ja=vb,vb=da;mb=vb;if(mb===da){var xb;var jb=ja;var gc=Sa();if(gc!==da){var Yc=ka();if(Yc!==da){var hc=h();if(hc!==da){var Zc=ka();if(Zc!==da){var Jb=[];for(xb=P();xb!==da;)Jb.push(xb),xb=P();if(Jb!==da)if(xb=ka(),xb!==da){var wc=Ia();wc!==
da?jb=gc={type:"case_expression",format:"simple",operand:hc,clauses:Jb,else:null}:(ja=jb,jb=da)}else ja=jb,jb=da;else ja=jb,jb=da}else ja=jb,jb=da}else ja=jb,jb=da}else ja=jb,jb=da}else ja=jb,jb=da;if(jb===da)if(jb=ja,gc=Sa(),gc!==da)if(Yc=ka(),Yc!==da)if(hc=h(),hc!==da)if(Zc=ka(),Zc!==da){Jb=[];for(xb=P();xb!==da;)Jb.push(xb),xb=P();if(Jb!==da)if(xb=ka(),xb!==da)if(wc=Q(),wc!==da){var Re=ka();if(Re!==da){var Se=Ia();Se!==da?jb=gc={type:"case_expression",format:"simple",operand:hc,clauses:Jb,else:wc.value}:
(ja=jb,jb=da)}else ja=jb,jb=da}else ja=jb,jb=da;else ja=jb,jb=da;else ja=jb,jb=da}else ja=jb,jb=da;else ja=jb,jb=da;else ja=jb,jb=da;else ja=jb,jb=da;var $c=jb;if($c===da){var yb;var ob=ja;var ic=Sa();if(ic!==da){var ad=ka();if(ad!==da){var Kb=[];for(yb=S();yb!==da;)Kb.push(yb),yb=S();if(Kb!==da)if(yb=ka(),yb!==da){var xc=Ia();xc!==da?ob=ic={type:"case_expression",format:"searched",clauses:Kb,else:null}:(ja=ob,ob=da)}else ja=ob,ob=da;else ja=ob,ob=da}else ja=ob,ob=da}else ja=ob,ob=da;if(ob===da)if(ob=
ja,ic=Sa(),ic!==da)if(ad=ka(),ad!==da){Kb=[];for(yb=S();yb!==da;)Kb.push(yb),yb=S();if(Kb!==da)if(yb=ka(),yb!==da)if(xc=Q(),xc!==da){var Te=ka();if(Te!==da){var Ue=Ia();Ue!==da?ob=ic={type:"case_expression",format:"searched",clauses:Kb,else:xc.value}:(ja=ob,ob=da)}else ja=ob,ob=da}else ja=ob,ob=da;else ja=ob,ob=da;else ja=ob,ob=da}else ja=ob,ob=da;else ja=ob,ob=da;$c=ob}mb=$c;if(mb===da){var yc;var Ub=ja;var Ad=G();if(Ad!==da){var bd=[];for(yc=M();yc!==da;)bd.push(yc),yc=M();bd!==da?Ub=Ad+=bd.join(""):
(ja=Ub,Ub=da)}else ja=Ub,Ub=da;var zc=Ub;if(zc!==da){var cd=zc;zc=/^CURRENT_DATE$/i.test(cd)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(cd)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:cd}}mb=zc;if(mb===da&&(mb=H(),mb===da)){mb=ja;var Bd=Ea();if(Bd!==da){var Ve=ka();if(Ve!==da){var dd=h();if(dd!==da){var We=ka();if(We!==da){var Xe=Ca();Xe!==da?(dd.paren=!0,mb=Bd=dd):(ja=mb,mb=da)}else ja=mb,mb=da}else ja=mb,mb=da}else ja=mb,mb=da}else ja=mb,mb=da}}}}}}}}return mb}
function E(){var oa;var ya=ja;var xa=G();if(xa!==da){var Na=[];for(oa=K();oa!==da;)Na.push(oa),oa=K();Na!==da?ya=xa+=Na.join(""):(ja=ya,ya=da)}else ja=ya,ya=da;return ya}function G(){if(tb.test(f.charAt(ja))){var oa=f.charAt(ja);ja++}else oa=da,0===Xa&&c(Ac);return oa}function K(){if(Bc.test(f.charAt(ja))){var oa=f.charAt(ja);ja++}else oa=da,0===Xa&&c(jc);return oa}function M(){if(kc.test(f.charAt(ja))){var oa=f.charAt(ja);ja++}else oa=da,0===Xa&&c(Vb);return oa}function H(){var oa=ja;if(64===f.charCodeAt(ja)){var ya=
ub;ja++}else ya=da,0===Xa&&c(ed);if(ya!==da){var xa=E();xa!==da?oa=ya=[ya,xa]:(ja=oa,oa=da)}else ja=oa,oa=da;oa!==da&&(oa={type:"param",value:oa[1]});return oa}function J(){var oa=ja;if(f.substr(ja,7).toLowerCase()===Ye){var ya=f.substr(ja,7);ja+=7}else ya=da,0===Xa&&c(Ze);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="LEADING":(ja=oa,oa=da)}else ja=oa,oa=da;oa===da&&(oa=ja,f.substr(ja,8).toLowerCase()===$e?(ya=f.substr(ja,8),ja+=8):(ya=da,0===Xa&&c(af)),ya!==da?
(ya=ja,Xa++,xa=K(),Xa--,xa===da?ya=void 0:(ja=ya,ya=da),ya!==da?oa="TRAILING":(ja=oa,oa=da)):(ja=oa,oa=da),oa===da&&(oa=ja,f.substr(ja,4).toLowerCase()===bf?(ya=f.substr(ja,4),ja+=4):(ya=da,0===Xa&&c(cf)),ya!==da?(ya=ja,Xa++,xa=K(),Xa--,xa===da?ya=void 0:(ja=ya,ya=da),ya!==da?oa="BOTH":(ja=oa,oa=da)):(ja=oa,oa=da)));return oa}function O(){var oa=ja;var ya=ja;var xa=I();if(xa!==da){var Na=ka();if(Na!==da)if(Na=Ea(),Na!==da)if(Na=ka(),Na!==da)if(Na=L(),Na!==da){var Za=ka();Za!==da?(Za=Ca(),Za!==da?
ya=xa={type:"interval-period",period:xa.value,precision:Na,secondary:null}:(ja=ya,ya=da)):(ja=ya,ya=da)}else ja=ya,ya=da;else ja=ya,ya=da;else ja=ya,ya=da;else ja=ya,ya=da}else ja=ya,ya=da;ya===da&&(ya=ja,xa=I(),xa!==da&&(xa=sb(xa)),ya=xa);if(ya!==da)if(xa=ka(),xa!==da)if(xa=ja,f.substr(ja,2).toLowerCase()===df?(Na=f.substr(ja,2),ja+=2):(Na=da,0===Xa&&c(ef)),Na!==da?(Na=ja,Xa++,Za=K(),Xa--,Za===da?Na=void 0:(ja=Na,Na=da),Na!==da?xa="TO":(ja=xa,xa=da)):(ja=xa,xa=da),xa!==da)if(xa=ka(),xa!==da){xa=
ja;Na=I();Na!==da&&(Na={type:"interval-period",period:Na.value,precision:null,secondary:null});xa=Na;if(xa===da){xa=ja;Na=Ma();if(Na!==da)if(Na=ka(),Na!==da)if(Na=Ea(),Na!==da)if(Na=ka(),Na!==da)if(Na=L(),Na!==da)if(Za=ka(),Za!==da)if(Za=ta(),Za!==da)if(Za=ka(),Za!==da)if(Za=F(),Za!==da){var fb=ka();fb!==da?(fb=Ca(),fb!==da?xa=Na=Cb(Na,Za):(ja=xa,xa=da)):(ja=xa,xa=da)}else ja=xa,xa=da;else ja=xa,xa=da;else ja=xa,xa=da;else ja=xa,xa=da;else ja=xa,xa=da;else ja=xa,xa=da;else ja=xa,xa=da;else ja=xa,
xa=da;else ja=xa,xa=da;xa===da&&(xa=ja,Na=Ma(),Na!==da?(Na=ka(),Na!==da?(Na=Ea(),Na!==da?(Na=ka(),Na!==da?(Na=L(),Na!==da?(Za=ka(),Za!==da?(Za=Ca(),Za!==da?xa=Na={type:"interval-period",period:"second",precision:Na,secondary:null}:(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da)):(ja=xa,xa=da),xa===da&&(xa=ja,Na=Ma(),Na!==da&&(Na={type:"interval-period",period:"second",precision:null,secondary:null}),xa=Na))}xa!==da?oa=ya={type:"interval-qualifier",start:ya,
end:xa}:(ja=oa,oa=da)}else ja=oa,oa=da;else ja=oa,oa=da;else ja=oa,oa=da;else ja=oa,oa=da;oa===da&&(oa=ja,xa=I(),xa!==da?(ya=ka(),ya!==da?(ya=Ea(),ya!==da?(ya=ka(),ya!==da?(ya=F(),ya!==da?(Na=ka(),Na!==da?(Na=Ca(),Na!==da?oa=xa={type:"interval-period",period:xa.value,precision:ya,secondary:null}:(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da),oa===da&&(oa=ja,xa=I(),xa!==da&&(xa=sb(xa)),oa=xa,oa===da&&(oa=ja,xa=Ma(),xa!==da?(ya=ka(),ya!==da?(ya=
Ea(),ya!==da?(ya=ka(),ya!==da?(ya=L(),ya!==da?(Na=ka(),Na!==da?(Na=ta(),Na!==da?(xa=ka(),xa!==da?(xa=F(),xa!==da?(Na=ka(),Na!==da?(Na=Ca(),Na!==da?oa=xa=Cb(ya,xa):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da),oa===da&&(oa=ja,xa=Ma(),xa!==da?(ya=ka(),ya!==da?(ya=Ea(),ya!==da?(ya=ka(),ya!==da?(ya=F(),ya!==da?(Na=ka(),Na!==da?(Na=Ca(),Na!==da?oa=xa={type:"interval-period",period:"second",
precision:ya,secondary:null}:(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da),oa===da&&(oa=ja,xa=Ma(),xa!==da&&(xa={type:"interval-period",period:"second",precision:null,secondary:null}),oa=xa)))));return oa}function I(){var oa=ja;oa=wa();oa!==da&&(oa={type:"string",value:"day"});oa===da&&(oa=ja,oa=Fa(),oa!==da&&(oa={type:"string",value:"hour"}),oa===da&&(oa=ja,oa=La(),oa!==da&&(oa={type:"string",value:"minute"}),oa===da&&(oa=ja,oa=ua(),oa!==
da&&(oa={type:"string",value:"month"}),oa===da&&(oa=ja,oa=pa(),oa!==da&&(oa={type:"string",value:"year"})))));return oa}function F(){var oa=Z();oa!==da&&(oa=parseFloat(oa));return oa}function L(){var oa=Z();oa!==da&&(oa=parseFloat(oa));return oa}function N(){var oa=R();oa===da&&(oa=H());return oa}function R(){var oa=ja;if(39===f.charCodeAt(ja)){var ya=Cc;ja++}else ya=da,0===Xa&&c(Dc);ya===da&&(f.substr(ja,2)===Cd?(ya=Cd,ja+=2):(ya=da,0===Xa&&c(ff)));if(ya!==da){ya=[];var xa=ja;f.substr(ja,2)===Ec?
(xa=Ec,ja+=2):(xa=da,0===Xa&&c(Dd));xa!==da&&(xa="'");xa===da&&(Ed.test(f.charAt(ja))?(xa=f.charAt(ja),ja++):(xa=da,0===Xa&&c(Fd)));for(;xa!==da;)ya.push(xa),xa=ja,f.substr(ja,2)===Ec?(xa=Ec,ja+=2):(xa=da,0===Xa&&c(Dd)),xa!==da&&(xa="'"),xa===da&&(Ed.test(f.charAt(ja))?(xa=f.charAt(ja),ja++):(xa=da,0===Xa&&c(Fd)));ya!==da?(39===f.charCodeAt(ja)?(xa=Cc,ja++):(xa=da,0===Xa&&c(Dc)),xa!==da?oa=ya={type:"string",value:ya.join("")}:(ja=oa,oa=da)):(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function S(){var oa=
ja;var ya=va();if(ya!==da)if(ya=ka(),ya!==da)if(ya=h(),ya!==da){var xa=ka();xa!==da?(xa=ma(),xa!==da?(xa=ka(),xa!==da?(xa=h(),xa!==da?oa=ya={type:"when_clause",operand:ya,value:xa}:(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)}else ja=oa,oa=da;else ja=oa,oa=da;else ja=oa,oa=da;return oa}function P(){var oa=ja;var ya=va();if(ya!==da)if(ya=ka(),ya!==da)if(ya=h(),ya!==da){var xa=ka();xa!==da?(xa=ma(),xa!==da?(xa=ka(),xa!==da?(xa=h(),xa!==da?oa=ya={type:"when_clause",operand:ya,value:xa}:
(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da)}else ja=oa,oa=da;else ja=oa,oa=da;else ja=oa,oa=da;return oa}function Q(){var oa=ja;var ya=ja;if(f.substr(ja,4).toLowerCase()===gf){var xa=f.substr(ja,4);ja+=4}else xa=da,0===Xa&&c(hf);if(xa!==da){xa=ja;Xa++;var Na=K();Xa--;Na===da?xa=void 0:(ja=xa,xa=da);xa!==da?ya="ELSE":(ja=ya,ya=da)}else ja=ya,ya=da;ya!==da?(ya=ka(),ya!==da?(ya=h(),ya!==da?oa={type:"else_clause",value:ya}:(ja=oa,oa=da)):(ja=oa,oa=da)):(ja=oa,oa=da);return oa}function V(){var oa=
Z();if(oa===da){oa=ja;if(45===f.charCodeAt(ja)){var ya=Va;ja++}else ya=da,0===Xa&&c(Ya);ya===da&&(43===f.charCodeAt(ja)?(ya=za,ja++):(ya=da,0===Xa&&c(Ba)));if(ya!==da){var xa=Z();xa!==da?oa=ya=ya[0]+xa:(ja=oa,oa=da)}else ja=oa,oa=da}return oa}function ca(){var oa=ja;if(46===f.charCodeAt(ja)){var ya=jf;ja++}else ya=da,0===Xa&&c(kf);ya!==da?(ya=Z(),ya===da&&(ya=null),ya!==da?oa="."+(null!=ya?ya:""):(ja=oa,oa=da)):(ja=oa,oa=da);return oa}function ba(){var oa;var ya=oa=ja;if(lf.test(f.charAt(ja))){var xa=
f.charAt(ja);ja++}else xa=da,0===Xa&&c(mf);xa!==da?(nf.test(f.charAt(ja))?(xa=f.charAt(ja),ja++):(xa=da,0===Xa&&c(of)),xa===da&&(xa=null),xa!==da?ya="e"+(null===xa?"":xa):(ja=ya,ya=da)):(ja=ya,ya=da);ya!==da?(xa=Z(),xa!==da?oa=ya+xa:(ja=oa,oa=da)):(ja=oa,oa=da);return oa}function Z(){var oa=[];var ya=ha();if(ya!==da)for(;ya!==da;)oa.push(ya),ya=ha();else oa=da;oa!==da&&(oa=oa.join(""));return oa}function ha(){if(pf.test(f.charAt(ja))){var oa=f.charAt(ja);ja++}else oa=da,0===Xa&&c(qf);return oa}function fa(){var oa=
ja;if(f.substr(ja,2).toLowerCase()===rf){var ya=f.substr(ja,2);ja+=2}else ya=da,0===Xa&&c(sf);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="IN":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function aa(){var oa=ja;if(f.substr(ja,2).toLowerCase()===tf){var ya=f.substr(ja,2);ja+=2}else ya=da,0===Xa&&c(uf);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="IS":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function W(){var oa=ja;if(f.substr(ja,
4).toLowerCase()===vf){var ya=f.substr(ja,4);ja+=4}else ya=da,0===Xa&&c(wf);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="LIKE":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function U(){var oa=ja;if(f.substr(ja,3).toLowerCase()===xf){var ya=f.substr(ja,3);ja+=3}else ya=da,0===Xa&&c(yf);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="NOT":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function X(){var oa=ja;if(f.substr(ja,3).toLowerCase()===
zf){var ya=f.substr(ja,3);ja+=3}else ya=da,0===Xa&&c(Af);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="AND":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function T(){var oa=ja;if(f.substr(ja,2).toLowerCase()===Bf){var ya=f.substr(ja,2);ja+=2}else ya=da,0===Xa&&c(Cf);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="OR":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function Y(){var oa=ja;if(f.substr(ja,7).toLowerCase()===Df){var ya=f.substr(ja,
7);ja+=7}else ya=da,0===Xa&&c(Ef);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="BETWEEN":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function ea(){var oa=ja;if(f.substr(ja,4).toLowerCase()===Ff){var ya=f.substr(ja,4);ja+=4}else ya=da,0===Xa&&c(Gf);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="FROM":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function ia(){var oa=ja;if(f.substr(ja,4).toLowerCase()===Hf){var ya=f.substr(ja,4);ja+=4}else ya=
da,0===Xa&&c(If);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="TRIM":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function la(){var oa=ja;if(f.substr(ja,8).toLowerCase()===Jf){var ya=f.substr(ja,8);ja+=8}else ya=da,0===Xa&&c(Kf);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="INTERVAL":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function pa(){var oa=ja;if(f.substr(ja,4).toLowerCase()===Lf){var ya=f.substr(ja,4);ja+=4}else ya=da,0===
Xa&&c(Mf);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="YEAR":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function ua(){var oa=ja;if(f.substr(ja,5).toLowerCase()===Nf){var ya=f.substr(ja,5);ja+=5}else ya=da,0===Xa&&c(Of);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="MONTH":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function wa(){var oa=ja;if(f.substr(ja,3).toLowerCase()===Pf){var ya=f.substr(ja,3);ja+=3}else ya=da,0===Xa&&c(Qf);
if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="DAY":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function Fa(){var oa=ja;if(f.substr(ja,4).toLowerCase()===Rf){var ya=f.substr(ja,4);ja+=4}else ya=da,0===Xa&&c(Sf);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="HOUR":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function La(){var oa=ja;if(f.substr(ja,6).toLowerCase()===Tf){var ya=f.substr(ja,6);ja+=6}else ya=da,0===Xa&&c(Uf);if(ya!==da){ya=
ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="MINUTE":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function Ma(){var oa=ja;if(f.substr(ja,6).toLowerCase()===Vf){var ya=f.substr(ja,6);ja+=6}else ya=da,0===Xa&&c(Wf);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="SECOND":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function Sa(){var oa=ja;if(f.substr(ja,4).toLowerCase()===Xf){var ya=f.substr(ja,4);ja+=4}else ya=da,0===Xa&&c(Yf);if(ya!==da){ya=ja;Xa++;
var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="CASE":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function Ia(){var oa=ja;if(f.substr(ja,3).toLowerCase()===Zf){var ya=f.substr(ja,3);ja+=3}else ya=da,0===Xa&&c($f);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="END":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function va(){var oa=ja;if(f.substr(ja,4).toLowerCase()===ag){var ya=f.substr(ja,4);ja+=4}else ya=da,0===Xa&&c(bg);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;
xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="WHEN":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function ma(){var oa=ja;if(f.substr(ja,4).toLowerCase()===cg){var ya=f.substr(ja,4);ja+=4}else ya=da,0===Xa&&c(dg);if(ya!==da){ya=ja;Xa++;var xa=K();Xa--;xa===da?ya=void 0:(ja=ya,ya=da);ya!==da?oa="THEN":(ja=oa,oa=da)}else ja=oa,oa=da;return oa}function ta(){if(44===f.charCodeAt(ja)){var oa=eg;ja++}else oa=da,0===Xa&&c(fg);return oa}function Ea(){if(40===f.charCodeAt(ja)){var oa=gg;ja++}else oa=da,0===Xa&&c(hg);
return oa}function Ca(){if(41===f.charCodeAt(ja)){var oa=ig;ja++}else oa=da,0===Xa&&c(jg);return oa}function ka(){var oa;var ya=[];for(oa=sa();oa!==da;)ya.push(oa),oa=sa();return ya}function sa(){if(kg.test(f.charAt(ja))){var oa=f.charAt(ja);ja++}else oa=da,0===Xa&&c(lg);return oa}function Ja(oa,ya,xa,Na){oa={type:"binary_expr",operator:oa,left:ya,right:xa};void 0!==Na&&(oa.escape=Na);return oa}function Ta(oa,ya){for(var xa=0;xa<ya.length;xa++)oa=Ja(ya[xa][1],oa,ya[xa][3]);return oa}w=void 0!==w?
w:{};var da={},qa={start:u},ra=u,Da="!",Pa=e("!",!1),Qa="\x3d",na=e("\x3d",!1),Aa="\x3e\x3d",Ra=e("\x3e\x3d",!1),Ua="\x3e",Wa=e("\x3e",!1),ab="\x3c\x3d",eb=e("\x3c\x3d",!1),db="\x3c\x3e",lb=e("\x3c\x3e",!1),Ha="\x3c",Ka=e("\x3c",!1),Ga="!\x3d",Oa=e("!\x3d",!1),za="+",Ba=e("+",!1),Va="-",Ya=e("-",!1),$a="*",bb=e("*",!1),cb="/",kb=e("/",!1),tb=/^[A-Za-z_\x80-\uFFFF]/,Ac=l([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Bc=/^[A-Za-z0-9_]/,jc=l([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),kc=/^[A-Za-z0-9_.\x80-\uFFFF]/,
Vb=l([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),ub="@",ed=e("@",!1),sb=function(oa){return{type:"interval-period",period:oa.value,precision:null,secondary:null}},Cb=function(oa,ya){return{type:"interval-period",period:"second",precision:oa,secondary:ya}},Cc="'",Dc=e("'",!1),Cd="N'",ff=e("N'",!1),Ec="''",Dd=e("''",!1),Ed=/^[^']/,Fd=l(["'"],!0,!1),jf=".",kf=e(".",!1),pf=/^[0-9]/,qf=l([["0","9"]],!1,!1),lf=/^[eE]/,mf=l(["e","E"],!1,!1),nf=/^[+\-]/,of=l(["+","-"],!1,!1),Pd="null",
Qd=e("NULL",!0),Jd="true",Kd=e("TRUE",!0),Md="false",Nd=e("FALSE",!0),rf="in",sf=e("IN",!0),tf="is",uf=e("IS",!0),vf="like",wf=e("LIKE",!0),Gd="escape",Hd=e("ESCAPE",!0),xf="not",yf=e("NOT",!0),zf="and",Af=e("AND",!0),Bf="or",Cf=e("OR",!0),Df="between",Ef=e("BETWEEN",!0),Ff="from",Gf=e("FROM",!0),ve="for",we=e("FOR",!0),le="substring",me=e("SUBSTRING",!0),ae="extract",be=e("EXTRACT",!0),Hf="trim",If=e("TRIM",!0),Be="position",Ce=e("POSITION",!0),Wd="timestamp",Xd=e("TIMESTAMP",!0),Sd="date",Td=e("DATE",
!0),Ye="leading",Ze=e("LEADING",!0),$e="trailing",af=e("TRAILING",!0),bf="both",cf=e("BOTH",!0),df="to",ef=e("TO",!0),Jf="interval",Kf=e("INTERVAL",!0),Lf="year",Mf=e("YEAR",!0),Nf="month",Of=e("MONTH",!0),Pf="day",Qf=e("DAY",!0),Rf="hour",Sf=e("HOUR",!0),Tf="minute",Uf=e("MINUTE",!0),Vf="second",Wf=e("SECOND",!0),Xf="case",Yf=e("CASE",!0),Zf="end",$f=e("END",!0),ag="when",bg=e("WHEN",!0),cg="then",dg=e("THEN",!0),gf="else",hf=e("ELSE",!0),eg=",",fg=e(",",!1),gg="(",hg=e("(",!1),ig=")",jg=e(")",!1),
kg=/^[ \t\n\r]/,lg=l([" ","\t","\n","\r"],!1,!1),wd="`",xd=e("`",!1),yd=/^[^`]/,zd=l(["`"],!0,!1),ja=0,lc=[{line:1,column:1}],Db=0,Fc=[],Xa=0;if("startRule"in w){if(!(w.startRule in qa))throw Error("Can't start parsing from rule \""+w.startRule+'".');ra=qa[w.startRule]}var fd=ra();if(fd!==da&&ja===f.length)return fd;fd!==da&&ja<f.length&&c({type:"end"});throw function(oa,ya,xa){return new y(y.buildMessage(oa,ya),oa,ya,xa)}(Fc,Db<f.length?f.charAt(Db):null,Db<f.length?d(Db,Db+1):d(Db,Db));}}})})(b);
let r=function(){function q(){}q.parse=function(y){return b.exports.parse(y)};return q}();a.WhereGrammar=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(a,p,b,r,q,y,f){function w(h,
m){if(!m)return null;if("x"in m){var n={x:0,y:0};[n.x,n.y]=h(m.x,m.y,d);null!=m.z&&(n.z=m.z);null!=m.m&&(n.m=m.m);return n}if("xmin"in m)return n={xmin:0,ymin:0,xmax:0,ymax:0},[n.xmin,n.ymin]=h(m.xmin,m.ymin,d),[n.xmax,n.ymax]=h(m.xmax,m.ymax,d),m.hasZ&&(n.zmin=m.zmin,n.zmax=m.zmax,n.hasZ=!0),m.hasM&&(n.mmin=m.mmin,n.mmax=m.mmax,n.hasM=!0),n;if("rings"in m)return{rings:e(m.rings,h),hasM:m.hasM,hasZ:m.hasZ};if("paths"in m)return{paths:e(m.paths,h),hasM:m.hasM,hasZ:m.hasZ};if("points"in m)return{points:l(m.points,
h),hasM:m.hasM,hasZ:m.hasZ}}function e(h,m){const n=[];for(const z of h)n.push(l(z,m));return n}function l(h,m){const n=[];for(const z of h)h=m(z[0],z[1],[0,0]),n.push(h),2<z.length&&h.push(z[2]),3<z.length&&h.push(z[3]);return n}function g(){g=p._asyncToGenerator(function*(h,m){m&&(h=Array.isArray(h)?h.map(n=>b.isSome(n.geometry)&&n.geometry.spatialReference):[h],yield r.initializeProjection(h.map(n=>({source:n,dest:m}))))});return g.apply(this,arguments)}const d=[0,0],c=w.bind(null,f.lngLatToXY),
u=w.bind(null,f.xyToLngLat),t=new (function(){function h(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}var m=h.prototype;m.push=function(){var n=p._asyncToGenerator(function*(z,k,v){if(!(z&&z.length&&k&&v)||y.equals(k,v))return z;const x={geometries:z,inSpatialReference:k,outSpatialReference:v,resolve:null};this._jobs.push(x);return new Promise(C=>{x.resolve=C;null===this._timer&&(this._timer=setTimeout(this._process,10))})});return function(z,k,v){return n.apply(this,arguments)}}();
m._process=function(){this._timer=null;const n=this._jobs.shift();if(n){var {geometries:z,inSpatialReference:k,outSpatialReference:v,resolve:x}=n;f.canProject(k,v)?y.isWebMercator(v)?x(z.map(c)):x(z.map(u)):x(r.projectMany(q.jsonAdapter,z,k,v,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return h}());a.checkProjectionSupport=function(h,m){return g.apply(this,arguments)};a.project=function(h,m,n){if(!h)return h;n||(n=m,m=h.spatialReference);return y.isValid(m)&&y.isValid(n)&&
!y.equals(m,n)?f.canProject(m,n)?y.isWebMercator(n)?c(h):u(h):r.projectMany(q.jsonAdapter,[h],m,n,null)[0]:h};a.projectMany=function(h,m,n){return t.push(h,m,n)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){let p=function(f,w,e){this.x=f;this.y=w;this.spatialReference=e;this.m=this.z=void 0},b=function(f,w,e,l){this.rings=f;this.spatialReference=w;this.hasM=this.hasZ=void 0;e&&(this.hasZ=e);l&&(this.hasM=l)},r=
function(f,w,e,l){this.paths=f;this.spatialReference=w;this.hasM=this.hasZ=void 0;e&&(this.hasZ=e);l&&(this.hasM=l)},q=function(f,w,e,l){this.points=f;this.spatialReference=w;this.hasM=this.hasZ=void 0;e&&(this.hasZ=e);l&&(this.hasM=l)},y=function(f,w,e,l,g){this.xmin=f;this.ymin=w;this.xmax=e;this.ymax=l;this.spatialReference=g;this.mmax=this.mmin=this.zmax=this.zmin=void 0};a.jsonAdapter={convertToGEGeometry:function(f,w){return null==w?null:f.convertJSONToGeometry(w)},exportPoint:function(f,w,
e){e=new p(f.getPointX(w),f.getPointY(w),e);const l=f.hasZ(w),g=f.hasM(w);l&&(e.z=f.getPointZ(w));g&&(e.m=f.getPointM(w));return e},exportPolygon:function(f,w,e){return new b(f.exportPaths(w),e,f.hasZ(w),f.hasM(w))},exportPolyline:function(f,w,e){return new r(f.exportPaths(w),e,f.hasZ(w),f.hasM(w))},exportMultipoint:function(f,w,e){return new q(f.exportPoints(w),e,f.hasZ(w),f.hasM(w))},exportExtent:function(f,w,e){var l=f.hasZ(w);const g=f.hasM(w);e=new y(f.getXMin(w),f.getYMin(w),f.getXMax(w),f.getYMax(w),
e);l&&(l=f.getZExtent(w),e.zmin=l.vmin,e.zmax=l.vmax);g&&(f=f.getMExtent(w),e.mmin=f.vmin,e.mmax=f.vmax);return e}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils ../../support/fieldUtils ../../../smartMapping/statistics/support/utils ../../../support/arcadeOnDemand".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){function u(n){return n.substr(24,12)+n.substr(19,4)+n.substr(16,2)+n.substr(14,2)+n.substr(11,2)+n.substr(9,2)+n.substr(6,2)+n.substr(4,2)+n.substr(2,2)+n.substr(0,2)}function t(n,z,k,v){if(k&&"esriFieldTypeDate"===k.type){const x=(new Date(n)).getTime(),C=(new Date(z)).getTime();if(!isNaN(x)&&!isNaN(C))return v?C-x:x-C}return"number"===typeof n&&"number"===typeof z?v?z-n:n-z:"string"===typeof n&&"string"===typeof z?(n=n.toUpperCase(),z=z.toUpperCase(),!k||"esriFieldTypeGUID"!==
k.type&&"esriFieldTypeGlobalID"!==k.type?v=(v?n>z:n<z)?-1:(v?n<z:n>z)?1:0:(k=u(n),z=u(z),v=(v?k>z:k<z)?-1:(v?k<z:k>z)?1:0),v):v?1:-1}function h(n,z,k,v,x,C){x-=k;C-=v;n=Math.min(1,Math.max(0,((n-k)*x+(z-v)*C)/(x*x+C*C)));return{x:k+x*n,y:v+C*n}}function m(n,z){return n?z?4:3:z?3:2}return function(){function n(k,v,x){this.items=k;this.queryGeometry=v;this.definitionExpression=x.definitionExpression;this.geometryType=x.geometryType;this.hasM=x.hasM;this.hasZ=x.hasZ;this.objectIdField=x.objectIdField;
this.spatialReference=x.spatialReference;this.fieldsIndex=x.fieldsIndex;this.timeInfo=x.timeInfo;this.featureAdapter=x.featureAdapter;this.aggregateAdapter=x.aggregateAdapter}var z=n.prototype;z.createQueryResponseForCount=function(k){const v=new y(k,this.featureAdapter,this.fieldsIndex);if(!k.outStatistics)return v.countDistinctValues(this.items);const {groupByFieldsForStatistics:x,having:C}=k;if(null==x||!x.length)return 1;const A=new Map,B=new Map,D=new Set;k=k.outStatistics;for(const G of k){({statisticType:k}=
G);k="exceedslimit"!==k?G.onStatisticField:void 0;if(!B.has(k)){var E=[];for(const K of x){const M=this._getAttributeValues(v,K,A);E.push(M)}B.set(k,this._calculateUniqueValues(E,v.returnDistinctValues))}k=B.get(k);for(const K in k){const {data:M,items:H}=k[K];E=M.join(",");C&&!v.validateItems(H,C)||D.add(E)}}return D.size};z.createQueryResponse=function(k){let v;v=k.outStatistics?k.outStatistics.some(x=>"exceedslimit"===x.statisticType)?this._createExceedsLimitQueryResponse(k):this._createStatisticsQueryResponse(k):
this._createFeatureQueryResponse(k);k.returnQueryGeometry&&(r.isValid(k.outSR)&&!r.equals(this.queryGeometry.spatialReference,k.outSR)?v.queryGeometry=l.cleanFromGeometryEngine({spatialReference:k.outSR,...w.project(this.queryGeometry,this.queryGeometry.spatialReference,k.outSR)}):v.queryGeometry=l.cleanFromGeometryEngine({spatialReference:k.outSR,...this.queryGeometry}));return v};z.createSnappingResponse=function(k,v){const x=this.featureAdapter,C=m(this.hasZ,this.hasM),{x:A,y:B}=k.point,D="number"===
typeof k.distance?k.distance:k.distance.x,E="number"===typeof k.distance?k.distance:k.distance.y,G={candidates:[]},K="esriGeometryPolygon"===this.geometryType;v=this.getPointCreator(k.point,this.spatialReference,v);for(const N of this.items){var M=x.getGeometry(N);if(p.isNone(M))continue;const {coords:R,lengths:S}=M;if(k.types&1){M=0;for(var H=0;H<S.length;H++){var J=S[H];for(var O=0;O<J;O++,M+=C){var I=R[M],F=R[M+1];if(O!==J-1){const P=R[M+C],Q=R[M+C+1],{x:V,y:ca}=h(A,B,I,F,P,Q);var L=(A-V)/D;const ba=
(B-ca)/E;L=L*L+ba*ba;1>=L&&G.candidates.push({type:"edge",objectId:x.getObjectId(N),distance:Math.sqrt(L),target:v(V,ca),start:v(I,F),end:v(P,Q)})}}}}if(k.types&2)for(M=K?R.length-C:R.length,H=0;H<M;H+=C)J=R[H],O=R[H+1],I=(A-J)/D,F=(B-O)/E,I=I*I+F*F,1>=I&&G.candidates.push({type:"vertex",objectId:x.getObjectId(N),distance:Math.sqrt(I),target:v(J,O)})}G.candidates.sort((N,R)=>N.distance-R.distance);return G};z.getPointCreator=function(k,v,x){const C=p.isSome(x)&&!r.equals(v,x)?A=>w.project(A,v,x):
A=>A;return null!=k.z&&null!=k.m?(A,B)=>C({x:A,y:B,z:k.z,m:k.m}):null!=k.z?(A,B)=>C({x:A,y:B,z:k.z}):null!=k.m?(A,B)=>C({x:A,y:B,m:k.m}):(A,B)=>C({x:A,y:B})};z.executeAttributesQuery=function(k){var v=f.getWhereClause(k.where,this.fieldsIndex);if(!v)return Promise.resolve(this);if(v.isStandardized){let x=0;const C=[];for(const A of this.items)v.testFeature(A,this.featureAdapter)&&(C[x++]=A);v=new n(C,this.queryGeometry,this);v.definitionExpression=k.where;return Promise.resolve(v)}return Promise.reject(new TypeError("Where clause is not standardized"))};
z.executeAggregateIdsQuery=function(k){if(!k.aggregateIds||!k.aggregateIds.length||p.isNone(this.aggregateAdapter))return Promise.resolve(this);const v=new Set;for(const C of k.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(C).forEach(A=>v.add(A));const x=this.featureAdapter.getObjectId;return Promise.resolve(new n(this.items.filter(C=>v.has(x(C))),this.queryGeometry,this))};z.executeObjectIdsQuery=function(k){if(!k.objectIds||!k.objectIds.length)return Promise.resolve(this);const v=new Set(k.objectIds),
x=this.featureAdapter.getObjectId;return Promise.resolve(new n(this.items.filter(C=>v.has(x(C))),this.queryGeometry,this))};z.executeTimeQuery=function(k){k=e.getTimeOperator(this.timeInfo,k.timeExtent,this.featureAdapter);if(!p.isSome(k))return Promise.resolve(this);k=this.items.filter(k);return Promise.resolve(new n(k,this.queryGeometry,this))};z.filterLatest=function(){const {trackIdField:k,startTimeField:v,endTimeField:x}=this.timeInfo;var C=x||v;const A=new Map,B=this.featureAdapter.getAttribute;
for(const D of this.items){const E=B(D,k),G=B(D,C),K=A.get(E);(!K||G>B(K,C))&&A.set(E,D)}C=Array.from(A.values());return Promise.resolve(new n(C,this.queryGeometry,this))};z.project=function(){var k=a._asyncToGenerator(function*(v){if(!v||r.equals(this.spatialReference,v))return this;const x=this.featureAdapter,C=(yield w.projectMany(this.items.map(A=>l.getGeometry(this.geometryType,this.hasZ,this.hasM,x.getGeometry(A))),this.spatialReference,v)).map((A,B)=>x.cloneWithGeometry(this.items[B],q.convertFromGeometry(A,
this.hasZ,this.hasM)));return new n(C,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:v,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})});return function(v){return k.apply(this,arguments)}}();z.createSummaryStatisticsResponse=function(){var k=a._asyncToGenerator(function*(v,x){const {field:C,normalizationField:A,normalizationType:B,
normalizationTotal:D,minValue:E,maxValue:G}=x;var K=new y(v,this.featureAdapter,this.fieldsIndex);v=this.fieldsIndex.isDateField(C);x=x.valueExpression?yield this._getAttributeExpressionValues(K,x.valueExpression,x.viewInfoParams):this._getAttributeNormalizedValues(K,{field:C,normalizationField:A,normalizationType:B,normalizationTotal:D});K=d.isNullCountSupported({normalizationType:B,normalizationField:A,minValue:E,maxValue:G});x=g.isStringField(this.fieldsIndex.get(C))?d.calculateStringStatistics({values:x,
supportsNullCount:K}):d.calculateStatistics({values:x,minValue:E,maxValue:G,useSampleStdDev:!B,supportsNullCount:K});return d.processStatsResult(x,v)});return function(v,x){return k.apply(this,arguments)}}();z._sortFeatures=function(k,v,x){if(1<k.length&&v&&v.length)for(const C of v.reverse()){v=C.split(" ");const A=v[0],B=this.fieldsIndex.get(A),D=v[1]&&"desc"===v[1].toLowerCase();k.sort((E,G)=>{E=x(E,A,B);G=x(G,A,B);return t(E,G,B,D)})}};z._createFeatureQueryResponse=function(k){const v=this.items,
{geometryType:x,hasM:C,hasZ:A,objectIdField:B,spatialReference:D}=this,{outFields:E,outSR:G,quantizationParameters:K,resultRecordCount:M,resultOffset:H,returnZ:J,returnM:O}=k,I=null!=M?v.length>(H||0)+M:!1,F=E&&(-1<E.indexOf("*")?[...this.fieldsIndex.fields]:E.map(L=>this.fieldsIndex.get(L)));return{exceededTransferLimit:I,features:this._createFeatures(k,v),fields:F,geometryType:x,hasM:C&&O,hasZ:A&&J,objectIdFieldName:B,spatialReference:l.cleanFromGeometryEngine(G?G:D),transform:K&&b.toQuantizationTransform(K)||
null}};z._createFeatures=function(k,v){const x=new y(k,this.featureAdapter,this.fieldsIndex),{hasM:C,hasZ:A}=this,{orderByFields:B,quantizationParameters:D,returnGeometry:E,returnCentroid:G,maxAllowableOffset:K,resultOffset:M,resultRecordCount:H,returnZ:J=!1,returnM:O=!1}=k,I=A&&J,F=C&&O;k=[];var L=0;v=[...v];this._sortFeatures(v,B,(S,P,Q)=>x.getFieldValue(S,P,Q));if(E||G){var N=b.toQuantizationTransform(D);if(E&&!G)for(var R of v)k[L++]={attributes:x.getAttributes(R),geometry:l.getGeometry(this.geometryType,
this.hasZ,this.hasM,this.featureAdapter.getGeometry(R),K,N,I,F)};else if(!E&&G)for(const S of v)k[L++]={attributes:x.getAttributes(S),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(S,this),N)};else for(const S of v)k[L++]={attributes:x.getAttributes(S),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(S,this),N),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(S),K,N,I,F)}}else for(N of v)(R=x.getAttributes(N))&&(k[L++]=
{attributes:R});L=M||0;null!=H&&(k=k.slice(L,Math.min(k.length,L+H)));return k};z._createExceedsLimitQueryResponse=function(k){var v=!1;let x=Number.POSITIVE_INFINITY,C=Number.POSITIVE_INFINITY;v=Number.POSITIVE_INFINITY;for(const A of k.outStatistics)if("exceedslimit"===A.statisticType){x=null!=A.maxPointCount?A.maxPointCount:Number.POSITIVE_INFINITY;C=null!=A.maxRecordCount?A.maxRecordCount:Number.POSITIVE_INFINITY;v=null!=A.maxVertexCount?A.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===
this.geometryType)v=this.items.length>x;else if(this.items.length>C)v=!0;else{k=this.hasZ?this.hasM?4:3:this.hasM?3:2;const A=this.featureAdapter;v=this.items.reduce((B,D)=>{D=A.getGeometry(D);return B+(p.isSome(D)&&D.coords.length||0)},0)/k>v}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(v)}}]}};z._createStatisticsQueryResponse=function(k){var v={attributes:{}};
const x=[],C=new Map,A=new Map,B=new Map,D=new Map,E=new y(k,this.featureAdapter,this.fieldsIndex);var G=k.outStatistics;const {groupByFieldsForStatistics:K,having:M,orderByFields:H}=k;k=K&&K.length;const J=!!k,O=J&&K[0],I=J&&!this.fieldsIndex.get(O);for(const S of G){const {outStatisticFieldName:P,statisticType:Q}=S;G=S;var F="exceedslimit"!==Q?S.onStatisticField:void 0;const V="percentile_disc"===Q||"percentile_cont"===Q,ca=J&&1===k&&(F===O||I)&&"count"===Q;if(J){if(!B.has(F)){var L=[];for(const ba of K){var N=
this._getAttributeValues(E,ba,C);L.push(N)}B.set(F,this._calculateUniqueValues(L,E.returnDistinctValues))}L=B.get(F);for(const ba in L){const {count:Z,data:ha,items:fa,itemPositions:aa}=L[ba];N=ha.join(",");if(!M||E.validateItems(fa,M)){const W=D.get(N)||{attributes:{}};var R=null;if(ca)R=Z;else{const U=this._getAttributeValues(E,F,C);R=aa.map(X=>U[X]);R=V&&"statisticParameters"in G?this._getPercentileValue(G,R):this._getStatisticValue(G,R,null,E.returnDistinctValues)}W.attributes[P]=R;K.forEach((U,
X)=>W.attributes[this.fieldsIndex.get(U)?U:`EXPR_${X+1}`]=ha[X]);D.set(N,W)}}}else F=this._getAttributeValues(E,F,C),v.attributes[P]=V&&"statisticParameters"in G?this._getPercentileValue(G,F):this._getStatisticValue(G,F,A,E.returnDistinctValues);x.push({name:P,alias:P,type:"esriFieldTypeDouble"})}v=J?Array.from(D.values()):[v];this._sortFeatures(v,H,(S,P)=>S.attributes[P]);return{fields:x,features:v}};z._getStatisticValue=function(k,v,x,C){const {onStatisticField:A,statisticType:B}=k;k=null;k=null!=
x&&x.has(A)?x.get(A):g.isStringField(this.fieldsIndex.get(A))?d.calculateStringStatistics({values:v,returnDistinct:C}):d.calculateStatistics({values:v,minValue:null,maxValue:null,useSampleStdDev:!0});x&&x.set(A,k);return k["var"===B?"variance":B]};z._getPercentileValue=function(k,v){const {onStatisticField:x,statisticParameters:C,statisticType:A}=k,{value:B,orderBy:D}=C,E="desc"===D,G=this.fieldsIndex.get(x);k=[...v].filter(K=>null!=K).sort((K,M)=>t(K,M,G,E));return this._calculatePercentile(k,B,
"percentile_disc"===A)};z._getAttributeValues=function(k,v,x){if(x.has(v))return x.get(v);const C=this.fieldsIndex.get(v),A=this.items.map(B=>k.getFieldValue(B,v,C));x.set(v,A);return A};z._getAttributeNormalizedValues=function(k,v){return this.items.map(x=>k.getNormalizedValue(x,{field:v.field,fieldInfo:this.fieldsIndex.get(v.field),normalizationField:v.normalizationField,normalizationFieldInfo:this.fieldsIndex.get(v.normalizationField),normalizationType:v.normalizationType,normalizationTotal:v.normalizationTotal}))};
z._getAttributeExpressionValues=function(){var k=a._asyncToGenerator(function*(v,x,C){const {arcadeUtils:A}=yield c.loadArcade(),B=A.createFunction(x),D=C&&A.getViewInfo(C);return this.items.map(E=>v.getExpressionValue(E,{compiledFunc:B,viewInfo:D},A))});return function(v,x,C){return k.apply(this,arguments)}}();z._calculateUniqueValues=function(k,v){const x={},C=this.items,A=C.length;for(let B=0;B<A;B++){const D=C[B],E=[];for(const K of k)E.push(K[B]);const G=E.join(",");v?null==x[G]&&(x[G]={count:1,
data:E,items:[D],itemPositions:[B]}):null==x[G]?x[G]={count:1,data:E,items:[D],itemPositions:[B]}:(x[G].count++,x[G].items.push(D),x[G].itemPositions.push(B))}return x};z._calculatePercentile=function(k,v,x){if(0===k.length)return null;if(0>=v)return k[0];if(1<=v)return k[k.length-1];var C=(k.length-1)*v,A=Math.floor(C);v=A+1;C%=1;A=k[A];const B=k[v];return v>=k.length||x||"string"===typeof A||"string"===typeof B?A:A*(1-C)+B*C};a._createClass(n,[{key:"size",get:function(){return this.items.length}}]);
return n}()})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["../../../core/maybe","./attributeSupport","../../../smartMapping/statistics/support/utils"],function(a,p,b){return function(){function r(y,f,w){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=y.returnDistinctValues;this.fieldsIndex=w;this.featureAdapter=f;if((f=y.outFields)&&-1===f.indexOf("*")){this.outFields=f;y=0;for(const l of f){var e=p.getExpressionFromFieldName(l);e=(f=this.fieldsIndex.get(e))?
null:p.getWhereClause(e,w);f=f?f.name:p.getAliasFromFieldName(l)||`FIELD_EXP_${y++}`;this._fieldDataCache.set(l,{alias:f,clause:e})}}}var q=r.prototype;q.countDistinctValues=function(y){if(!this.returnDistinctValues)return y.length;y.forEach(f=>this.getAttributes(f));return this._returnDistinctMap.size};q.getAttributes=function(y){y=this._processAttributesForOutFields(y);return this._processAttributesForDistinctValues(y)};q.getFieldValue=function(y,f,w){const e=w?w.name:f;let l=null;this._fieldDataCache.has(e)?
l=this._fieldDataCache.get(e).clause:w||(l=p.getWhereClause(f,this.fieldsIndex),this._fieldDataCache.set(e,{alias:e,clause:l}));return w?this.featureAdapter.getAttribute(y,e):l.calculateValue(y,this.featureAdapter)};q.getNormalizedValue=function(y,f){const w=f.normalizationType,e=f.normalizationTotal;let l=this.getFieldValue(y,f.field,f.fieldInfo);w&&Number.isFinite(l)&&(y=this.getFieldValue(y,f.normalizationField,f.normalizationFieldInfo),l=b.getNormalizedValue(l,w,y,e));return l};q.getExpressionValue=
function(y,f,w){y={attributes:this.featureAdapter.getAttributes(y)};y=w.createExecContext(y,f.viewInfo);return w.executeFunction(f.compiledFunc,y)};q.validateItem=function(y,f){this._fieldDataCache.has(f)||this._fieldDataCache.set(f,{alias:f,clause:p.getWhereClause(f,this.fieldsIndex)});return this._fieldDataCache.get(f).clause.testFeature(y,this.featureAdapter)};q.validateItems=function(y,f){this._fieldDataCache.has(f)||this._fieldDataCache.set(f,{alias:f,clause:p.getWhereClause(f,this.fieldsIndex)});
return this._fieldDataCache.get(f).clause.testSet(y,this.featureAdapter)};q._processAttributesForOutFields=function(y){const f=this.outFields;if(!f||!f.length)return this.featureAdapter.getAttributes(y);const w={};for(const e of f){const {alias:l,clause:g}=this._fieldDataCache.get(e);w[l]=g?g.calculateValue(y,this.featureAdapter):this.featureAdapter.getAttribute(y,l)}return w};q._processAttributesForDistinctValues=function(y){if(a.isNone(y)||!this.returnDistinctValues)return y;var f=this.outFields,
w=[];if(f)for(const l of f){var {alias:e}=this._fieldDataCache.get(l);w.push(y[e])}else for(e in y)w.push(y[e]);f=`${(f||["*"]).join(",")}=${w.join(",")}`;w=this._returnDistinctMap.get(f)||0;this._returnDistinctMap.set(f,++w);return 1<w?null:y};return r}()})},"esri/smartMapping/statistics/support/utils":function(){define(["exports","../../../core/Error","../../../core/maybe","../../../layers/support/fieldUtils"],function(a,p,b,r){function q(e,l){return new p(e,l)}function y(e,l){e=b.isSome(e)?e:"";
b.isSome(l)&&l&&(e=e?"("+e+") AND ("+l+")":l);return e}function f(e){const l=e.layer;return e.fields.filter(g=>!l.getField(g))}function w(e){const l=e.layer;return e.fields.filter(g=>{g=l.getFieldUsageInfo(g);return!g||!g.supportsStatistics})}a.calculateStatistics=function(e){const {values:l,useSampleStdDev:g,supportsNullCount:d}=e;var c=Number.POSITIVE_INFINITY;let u=Number.NEGATIVE_INFINITY,t=null,h=null;var m=null;let n=null,z=0;const k=null==e.minValue?-Infinity:e.minValue;e=null==e.maxValue?
Infinity:e.maxValue;for(const v of l)Number.isFinite(v)?v>=k&&v<=e&&(t+=v,c=Math.min(c,v),u=Math.max(u,v),z++):"string"===typeof v&&z++;if(z&&null!=t){h=t/z;m=0;for(const v of l)Number.isFinite(v)&&v>=k&&v<=e&&(m+=(v-h)**2);n=g?1<z?m/(z-1):0:0<z?m/z:0;m=Math.sqrt(n)}else u=c=null;c={avg:h,count:z,max:u,min:c,stddev:m,sum:t,variance:n};d&&(c.nullcount=l.length-z);return c};a.calculateStringStatistics=function(e){const l=e.returnDistinct?[...new Set(e.values)]:e.values,g=l.filter(c=>null!=c).length,
d={count:g};e.supportsNullCount&&(d.nullcount=l.length-g);return d};a.createError=q;a.getNormalizedValue=function(e,l,g,d){let c=null;switch(l){case "log":0!==e&&(c=Math.log(e)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(d)&&0!==d&&(c=e/d*100);break;case "field":Number.isFinite(g)&&0!==g&&(c=e/g);break;case "natural-log":0<e&&(c=Math.log(e));break;case "square-root":0<e&&(c=e**.5)}return c};a.getRangeExpr=function(e,l,g){l=null!=l?e+" \x3e\x3d "+l:"";e=null!=g?e+" \x3c\x3d "+g:"";g=
"";return(g=l&&e?y(l,e):l||e)?"("+g+")":""};a.getSQLFilterForNormalization=function(e){const l=e.field,g=e.normalizationType;e=e.normalizationField;let d;if("log"===g)d="(NOT "+l+" \x3d 0)";else if("field"===g)d="(NOT "+e+" \x3d 0)";else if("natural-log"===g||"square-root"===g)d=`(${l} > 0)`;return d};a.isNullCountSupported=function(e){const l=null!=e.minValue||null!=e.maxValue,g=!!e.sqlExpression&&e.supportsSQLExpression;return!(null!=e.normalizationField||null!=e.normalizationType)&&!l&&!g};a.mergeWhereClauses=
y;a.processStatsResult=function(e,l){if(!l)return e;["avg","stddev","variance"].forEach(g=>{null!=e[g]&&(e[g]=Math.ceil(e[g]))});return e};a.verifyBasicFieldValidity=function(e,l,g){const d=f({layer:e,fields:l});if(d.length)return q(g,"Unknown fields: "+d.join(", ")+". You can only use fields defined in the layer schema");e=w({layer:e,fields:l});if(e.length)return q(g,"Unsupported fields: "+e.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")};
a.verifyFieldType=function(e,l,g,d){let c=null;if(!l)c=q(g,"'field' is not defined in the layer schema");else if(l.name===e.objectIdField||-1===d.indexOf(l.type))c=q(g,"'field' should be one of these types: "+d.join(","));return c};a.verifyNumericField=function(e,l,g){let d;l?l.name!==e.objectIdField&&r.isNumericField(l)||(d=q(g,"'field' should be one of these numeric types: "+r.numericTypes.join(","))):d=q(g,"'field' is not defined in the layer schema");return d};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function p(q,y,f,w,e){if(null!=w&&null!=e)return l=>{const g=q.getAttribute(l,y);l=q.getAttribute(l,f);return(null==g||g<=e)&&(null==l||l>=w)};if(null!=w)return l=>{l=q.getAttribute(l,f);return null==l||l>=w};if(null!=e)return l=>{l=q.getAttribute(l,y);return null==l||l<=e}}function b(q,y,f,w){if(null!=f&&null!=w&&f===w)return e=>q.getAttribute(e,y)===f;if(null!=f&&null!=w)return e=>{e=q.getAttribute(e,
y);return e>=f&&e<=w};if(null!=f)return e=>q.getAttribute(e,y)>=f;if(null!=w)return e=>q.getAttribute(e,y)<=w}function r(){return()=>!1}a.getTimeExtent=function(q,y){if(!q)return null;const f=y.featureAdapter,{startTimeField:w,endTimeField:e}=q;let l=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;if(w&&e)y.forEach(d=>{const c=f.getAttribute(d,w);d=f.getAttribute(d,e);null==c||isNaN(c)||(l=Math.min(l,c));null==d||isNaN(d)||(g=Math.max(g,d))});else{const d=w||e;y.forEach(c=>{c=f.getAttribute(c,
d);null==c||isNaN(c)||(l=Math.min(l,c),g=Math.max(g,c))})}return{start:l,end:g}};a.getTimeOperator=function(q,y,f){if(!y||!q)return null;const {startTimeField:w,endTimeField:e}=q;if(!w&&!e)return null;const {start:l,end:g}=y;return null===l&&null===g?null:void 0===l&&void 0===g?r():w&&e?p(f,w,e,l,g):b(f,w||e,l,g)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){function t(H,J,O,I=H.hasZ,F=H.hasM){if(q.isNone(J))return null;const L=H.hasZ&&I,N=H.hasM&&F;return O?(H=d.quantizeOptimizedGeometry(G,J,H.hasZ,H.hasM,"esriGeometryPoint",O,I,F),d.convertToPoint(H,L,N)):d.convertToPoint(J,L,N)}function h(){h=b._asyncToGenerator(function*(H,J,O){const {outFields:I,orderByFields:F,groupByFieldsForStatistics:L,outStatistics:N}=H;if(I)for(var R=0;R<I.length;R++)I[R]=I[R].trim();if(F)for(R=0;R<F.length;R++)F[R]=F[R].trim();if(L)for(R=
0;R<L.length;R++)L[R]=L[R].trim();if(N)for(R=0;R<N.length;R++)N[R].onStatisticField&&(N[R].onStatisticField=N[R].onStatisticField.trim());H.geometry&&!H.outSR&&(H.outSR=H.geometry.spatialReference);return n(H,J,O)});return h.apply(this,arguments)}function m(){m=b._asyncToGenerator(function*(H,J,O){return n(H,J,O)});return m.apply(this,arguments)}function n(H,J,O){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(H,J,O){if(!H)return null;var {where:I}=H;H.where=I=I&&I.trim();
if(!I||/^1 *= *1$/.test(I)||J&&J===I)H.where=null;if(!H.geometry)return H;J=yield k(H);H.distance=0;H.units=null;"esriSpatialRelEnvelopeIntersects"===H.spatialRel&&({spatialReference:I}=H.geometry,J=f.getGeometryExtent(J),J.spatialReference=I);H.geometry=J;yield u.checkProjectionSupport(J.spatialReference,O);J=(yield e.normalizeCentralMeridian(w.fromJSON(J)))[0];if(q.isNone(J))throw B;J=J.toJSON();J=yield u.project(J,J.spatialReference,O);if(!J)throw B;J.spatialReference=O;H.geometry=J;return H});
return z.apply(this,arguments)}function k(H){return v.apply(this,arguments)}function v(){v=b._asyncToGenerator(function*(H){const {geometry:J,distance:O,units:I}=H;if(null==O||"vertexAttributes"in J)return J;var F=J.spatialReference;H=I?A.fromJSON(I):y.getUnitString(F);F=F&&(l.isGeographic(F)||l.isWebMercator(F))?J:yield u.checkProjectionSupport(F,l.WGS84).then(()=>u.project(J,l.WGS84));return(yield x())(F.spatialReference,F,O,H)});return v.apply(this,arguments)}function x(){return C.apply(this,arguments)}
function C(){C=b._asyncToGenerator(function*(){return(yield new Promise(function(H,J){a(["../../../geometry/geometryEngineJSON"],H,J)})).geodesicBuffer});return C.apply(this,arguments)}const A=new r.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),B=Object.freeze({}),D=new c,E=new c,G=new c,K={esriGeometryPoint:d.convertToPoint,esriGeometryPolyline:d.convertToPolyline,
esriGeometryPolygon:d.convertToPolygon,esriGeometryMultipoint:d.convertToMultipoint},M=(H,J)=>"_geVersion"!==H?J:void 0;p.QUERY_ENGINE_EMPTY_RESULT=B;p.cleanFromGeometryEngine=function(H){return H&&"_geVersion"in H?JSON.parse(JSON.stringify(H,M)):H};p.getCentroid=function(H,J,O){if("esriGeometryPolygon"!==H.geometryType||!J||!J.centroid&&!J.geometry)return null;J.centroid||(J.centroid=g.getCentroidOptimizedGeometry(new c,J.geometry,H.hasZ,H.hasM));return t(H,J.centroid,O)};p.getGeometry=function(H,
J,O,I,F,L,N=J,R=O){const S=J&&N,P=O&&R;I=q.isSome(I)?"coords"in I?I:I.geometry:null;if(q.isNone(I))return null;if(F)return J=d.generalizeOptimizedGeometry(E,I,J,O,H,F,N,R),L&&(J=d.quantizeOptimizedGeometry(G,J,S,P,H,L)),K[H](J,S,P);if(L)return L=d.quantizeOptimizedGeometry(G,I,J,O,H,L,N,R),K[H](L,S,P);d.removeZMValues(D,I,J,O,N,R);return K[H](D,S,P)};p.normalizeFilter=function(H,J,O){return m.apply(this,arguments)};p.normalizeQuery=function(H,J,O){return h.apply(this,arguments)};p.normalizeQueryLike=
n;p.transformCentroid=t;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),function(a,p,b,r,q,y,f,w,
e,l,g,d,c){function u(){return new Promise(function(n,z){a(["../../../geometry/geometryEngineJSON"],n,z)})}function t(){t=b._asyncToGenerator(function*(n,z,k){const {spatialRel:v,geometry:x}=n;if(x){if(!0!==m.spatialRelationship[v])throw new r("feature-store:unsupported-query","Unsupported query spatial relationship",{query:n});if(w.isValid(x.spatialReference)&&w.isValid(k)){if(!0!==m.queryGeometry[f.getJsonType(x)])throw new r("feature-store:unsupported-query","Unsupported query geometry type",{query:n});
if(!0!==m.layerGeometry[z])throw new r("feature-store:unsupported-query","Unsupported layer geometry type",{query:n});if(n.outSR)return d.checkProjectionSupport(n.geometry&&n.geometry.spatialReference,n.outSR)}}});return t.apply(this,arguments)}const h={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",
esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},m={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},
layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};p.canQueryWithRBush=function(n){if(f.isExtent(n))return!0;if(f.isPolygon(n)){for(const z of n.rings)if(5!==z.length||z[0][0]!==z[1][0]||z[0][0]!==z[4][0]||z[2][0]!==z[3][0]||z[0][1]!==z[3][1]||z[0][1]!==z[4][1]||z[1][1]!==z[2][1])return!1;return!0}return!1};p.checkSpatialQuerySupport=function(n,z,k){return t.apply(this,arguments)};p.getSpatialQueryOperator=function(n,
z,k,v,x){if(f.isPolygon(z)&&"esriGeometryPoint"===k&&("esriSpatialRelIntersects"===n||"esriSpatialRelContains"===n)){const C=l.convertFromPolygon(new g,z,!1,!1);return Promise.resolve(A=>e.polygonContainsPoint(C,!1,!1,A))}if(f.isPolygon(z)&&"esriGeometryMultipoint"===k){const C=l.convertFromPolygon(new g,z,!1,!1);if("esriSpatialRelContains"===n)return Promise.resolve(A=>e.polygonContainsMultipoint(C,!1,!1,A,v,x))}if(f.isExtent(z)&&"esriGeometryPoint"===k&&("esriSpatialRelIntersects"===n||"esriSpatialRelContains"===
n))return Promise.resolve(C=>q.extentContainsPoint(z,c.getGeometry(k,v,x,C)));if(f.isExtent(z)&&"esriGeometryMultipoint"===k&&"esriSpatialRelContains"===n)return Promise.resolve(C=>q.extentContainsMultipoint(z,c.getGeometry(k,v,x,C)));if(f.isExtent(z)&&"esriSpatialRelIntersects"===n){const C=y.getExtentIntersector(k);return Promise.resolve(A=>C(z,c.getGeometry(k,v,x,A)))}return u().then(C=>{const A=C[h[n]].bind(null,z.spatialReference,z);return B=>A(c.getGeometry(k,v,x,B))})};Object.defineProperty(p,
"__esModule",{value:!0})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,p){a.extentIntersectsExtent=p.extentIntersectsExtent;a.extentIntersectsMultipoint=p.extentIntersectsMultipoint;a.extentIntersectsPoint=p.extentIntersectsPoint;a.extentIntersectsPolygon=p.extentIntersectsPolygon;a.extentIntersectsPolyline=p.extentIntersectsPolyline;a.getFeatureExtentIntersector=p.getFeatureExtentIntersector;a.isSelfIntersecting=p.isSelfIntersecting;a.segmentIntersects=
p.segmentIntersects;a.getExtentIntersector=function(b){return"mesh"===b?p.extentIntersectsExtent:p.getFeatureExtentIntersector(b)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function p(b,r,q,y,f){if(!b)return!1;r=r?q?4:3:q?3:2;const {coords:w,lengths:e}=b;q=!1;b=0;for(const g of e){var l=b;for(let d=b,c=b+g*r;d<c;d+=r){l=d+r;l===c&&(l=b);const u=w[d],t=w[d+1],h=w[l];l=w[l+1];(t<f&&l>=f||l<f&&t>=f)&&u+(f-t)/(l-t)*(h-
u)<y&&(q=!q)}b+=g*r}return q}a.polygonContainsCoords=p;a.polygonContainsMultipoint=function(b,r,q,y,f,w){f=f?w?4:3:w?3:2;const {coords:e,lengths:l}=y;if(!l)return!1;for(let g=0,d=0;g<l.length;g++,d+=f)if(!p(b,r,q,e[d],e[d+1]))return!1;return!0};a.polygonContainsPoint=function(b,r,q,y){return p(b,r,q,y.coords[0],y.coords[1])};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/support/FeatureFilter":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../TimeExtent ../../../core/jsonMap ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ../../../geometry/support/jsonUtils ../../../rest/support/Query".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){var h;e=new q.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});q=new q.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});y=h=function(m){function n(k){k=m.call(this,k)||this;k.where=null;k.geometry=null;k.spatialRelationship="intersects";k.hiddenIds=new Set;k.distance=void 0;k.objectIds=null;k.units=null;k.timeExtent=null;k.enabled=!1;return k}a._inheritsLoose(n,m);var z=n.prototype;z.writeWhere=function(k,v){v.where=k||"1\x3d1"};z.enable=function(){this._set("enabled",!0)};
z.createQuery=function(k={}){const {where:v,geometry:x,spatialRelationship:C,timeExtent:A,objectIds:B,units:D,distance:E}=this;return new t({geometry:f.clone(x),objectIds:f.clone(B),spatialRelationship:C,timeExtent:f.clone(A),where:v,units:D,distance:E,...k})};z.clone=function(){const {where:k,geometry:v,spatialRelationship:x,hiddenIds:C,timeExtent:A,objectIds:B,units:D,distance:E}=this,G=new Set;C.forEach(K=>G.add(K));return new h({geometry:f.clone(v),hiddenIds:G,objectIds:f.clone(B),spatialRelationship:x,
timeExtent:f.clone(A),where:k,units:D,distance:E})};return n}(y.JSONSupport);p.__decorate([w.property({type:String})],y.prototype,"where",void 0);p.__decorate([c.writer("where")],y.prototype,"writeWhere",null);p.__decorate([w.property({types:b.geometryTypes,json:{read:u.fromJSON,write:!0}})],y.prototype,"geometry",void 0);p.__decorate([w.property({type:String,json:{read:{source:"spatialRel",reader:e.read},write:{target:"spatialRel",writer:e.write}}})],y.prototype,"spatialRelationship",void 0);p.__decorate([w.property({json:{write:(m,
n,z)=>n[z]=Array.from(m),read:m=>new Set(m)}})],y.prototype,"hiddenIds",void 0);p.__decorate([w.property({type:Number,json:{write:{overridePolicy(m){return{enabled:0<m}}}}})],y.prototype,"distance",void 0);p.__decorate([w.property({type:[Number],json:{write:!0}})],y.prototype,"objectIds",void 0);p.__decorate([w.property({type:String,json:{read:q.read,write:{writer:q.write,overridePolicy(m){return{enabled:m&&0<this.distance}}}}})],y.prototype,"units",void 0);p.__decorate([w.property({type:r,json:{write:!0}})],
y.prototype,"timeExtent",void 0);p.__decorate([w.property({readOnly:!0})],y.prototype,"enabled",void 0);return y=h=p.__decorate([d.subclass("esri.views.layers.support.FeatureFilter")],y)})},"esri/views/support/floorFilterUtils":function(){define(["exports"],function(a){function p(b,r){if(null==b||!b.length)return null;b=b.filter(q=>""!==q).map(q=>`'${q}'`);b.push("''");return`${r} IN (${b.join(",")}) OR ${r} IS NULL`}a.combineFloorsDefinitionExpression=function(b,r){({definitionExpression:r}=r);return b?
r?`(${r}) AND (${b})`:b:r};a.getFloorFilterClause=function(b){var r;const q=b.layer;return"floorInfo"in q&&null!=(r=q.floorInfo)&&r.floorField&&"floors"in b.view?p(b.view.floors,q.floorInfo.floorField):null};a.getLayerFloorFilterClause=function(b,r){var q;return"floorInfo"in r&&null!=(q=r.floorInfo)&&q.floorField?p(b,r.floorInfo.floorField):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projectionEllipsoid ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c){b=function(u){function t(){var m=u.apply(this,arguments)||this;m.suspended=!1;m.extent=null;m.extentIntersectionDirty=!0;m._isVisibleBelowSurface=!1;m.handles=new r;m.layerView=null;m.updating=!0;return m}a._inheritsLoose(t,u);var h=t.prototype;h.setup=function(m){this.layerView=m;this.extentIntersection=new d.FrustumExtentIntersection({renderCoordsHelper:m.view.renderCoordsHelper});m=m.view;const n=m.basemapTerrain,z=m.resourceController.scheduler;this.handles.add([m.on("resize",
()=>this.viewChange()),m.state.watch("camera",()=>this.viewChange(),!0),z.registerTask(c.TaskPriority.FRUSTUM_VISIBILITY,this),n.on("elevation-bounds-change",()=>this.elevationBoundsChange())]);"local"===m.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([q.init(n,["opacity","wireframe"],()=>this.updateIsVisibleBelowSurface()),q.init(m,"map.ground.navigationConstraint.type",()=>this.updateIsVisibleBelowSurface())])};h.destroy=function(){this.extentIntersection=this.extent=this.layerView=
null;this.handles&&(this.handles.destroy(),this.handles=null)};h._setDirty=function(){this.updating||this._set("updating",!0)};h.setExtent=function(m){this.extent=m;this.extentIntersectionDirty=!0;this._setDirty()};h.viewChange=function(){this._setDirty()};h.elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=!0};h.updateIsVisibleBelowSurface=function(){const m=this.layerView.view,n=m.basemapTerrain,z=m.map.ground&&m.map.ground.navigationConstraint&&"none"===m.map.ground.navigationConstraint.type;
this.isVisibleBelowSurface="local"===m.viewingMode||!n.opaque||z};h.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var m=this.layerView.view;if(this._isVisibleBelowSurface)var n=-.3*g.getReferenceEllipsoid(m.spatialReference).radius;else{const {min:z,max:k}=m.basemapTerrain.elevationBounds;n=z-Math.max(1,(k-z)*(1.2-1))}this.extentIntersection.update(this.extent,m.spatialReference,n)}};h.runTask=function(){this._set("updating",!1);if(this.extent){this.updateExtentIntersection();
var m=this.layerView.view.frustum,n=g.getReferenceEllipsoid(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(m,n))}else this._set("suspended",!1)};a._createClass(t,[{key:"isVisibleBelowSurface",set:function(m){this._isVisibleBelowSurface=m;this._setDirty();this.extentIntersectionDirty=!0}},{key:"running",get:function(){return this.updating}}]);return t}(b);p.__decorate([y.property({readOnly:!0})],b.prototype,"suspended",void 0);p.__decorate([y.property({readOnly:!0})],
b.prototype,"updating",void 0);return b=p.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],b)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils","./Graphics3DObjectStateSet"],function(a,p,b,r){let q=function(){function y(w){this._graphicsCore=w;this._stateSets=[]}var f=y.prototype;f.destroy=function(){this._stateSets&&this._stateSets.forEach(w=>w.objectStateSet.removeAll());
this._stateSets=null};f.acquireSet=function(w,e){const l=new r.Graphics3DObjectStateSet(w,e);this._stateSets.push(l);w=b.makeHandle(()=>this.releaseSet(l));return{set:l,handle:w}};f.releaseSet=function(w){w.objectStateSet.removeAll();w=this._stateSets?this._stateSets.indexOf(w):-1;-1!==w&&this._stateSets.splice(w,1)};f._addObjectStateSet=function(w,e){w.addObjectStateSet(e.stateType,e.objectStateSet)};f._removeObjectStateSet=function(w,e){w.removeObjectState(e.objectStateSet)};f.setUid=function(w,
e){w.ids.add(e);(e=this._graphicsCore.graphics3DGraphics.get(e))&&this._addObjectStateSet(e,w)};f.setUids=function(w,e){e.forEach(l=>this.setUid(w,l))};f.setObjectIds=function(w,e){e.forEach(l=>w.ids.add(l));this.initializeSet(w)};f.addGraphic=function(w){this._stateSets.forEach(e=>{!e.paused&&e.hasGraphic(w)&&this._addObjectStateSet(w,e)})};f.removeGraphic=function(w){this._stateSets.forEach(e=>{e.hasGraphic(w)&&this._removeObjectStateSet(w,e)})};f.allGraphicsDeleted=function(){this._stateSets&&
this._stateSets.forEach(w=>w.objectStateSet.removeAll())};f.initializeSet=function(w){const e=this._graphicsCore.graphics3DGraphics;w.objectIdField?e.forEach(l=>{l&&w.hasGraphic(l)&&this._addObjectStateSet(l,w)}):w.ids.forEach(l=>{(l=e.get(l))&&this._addObjectStateSet(l,w)})};p._createClass(y,[{key:"test",get:function(){return{states:this._stateSets}}}]);return y}();a.Graphics3DObjectStates=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports",
"../../webgl-engine/lib/Object3DStateSet"],function(a,p){let b=function(){function r(q,y){this.stateType=q;this.objectIdField=y;this.objectStateSet=new p.Object3DStateSet;this.ids=new Set;this.paused=!1}r.prototype.hasGraphic=function(q){return this.objectIdField?this.ids.has(q.graphic.attributes[this.objectIdField]):this.ids.has(q.graphic.uid)};return r}();a.Graphics3DObjectStateSet=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports"],
function(a){let p=function(){function b(){this.items=[]}var r=b.prototype;r.addObject=function(q,y){this.items.push({type:0,objectStateId:y,object:q})};r.addRenderGeometry=function(q,y,f){this.items.push({type:1,objectStateId:y,renderGeometry:q,owner:f})};r.addExternal=function(q,y){this.items.push({type:2,objectStateId:y,remove:q})};r.remove=function(q){for(let y=this.items.length-1;0<=y;--y){const f=this.items[y];f.objectStateId===q&&(this._removeObjectStateItem(f),this.items.splice(y,1))}};r.removeObject=
function(q){for(let y=this.items.length-1;0<=y;--y){const f=this.items[y];0===f.type&&f.object===q&&(this._removeObjectStateItem(f),this.items.splice(y,1))}};r.removeRenderGeometry=function(q){for(let y=this.items.length-1;0<=y;--y){const f=this.items[y];1===f.type&&f.renderGeometry===q&&(this._removeObjectStateItem(f),this.items.splice(y,1))}};r.removeAll=function(){this.items.forEach(q=>{this._removeObjectStateItem(q)});this.items=[]};r._removeObjectStateItem=function(q){switch(q.type){case 0:0===
q.objectStateId.channel?q.object.removeHighlight(q.objectStateId):1===q.objectStateId.channel&&q.object.removeOcclude(q.objectStateId);break;case 1:q.owner.removeRenderGeometryObjectState(q.renderGeometry,q.objectStateId);break;case 2:q.remove(q.objectStateId)}};return b}();a.Object3DStateSet=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){b=function(c){function u(){var h=c.apply(this,arguments)||this;h._scaleRangeActive=!1;h.layerScaleRangeVisibilityQuery=!1;h.handles=new r;h.layerView=null;h.layer=null;h.queryGraphicUIDsInExtent=null;h.extent=null;h.graphicsCore=null;h.basemapTerrain=null;h.layerScaleEnabled=!0;h.suspended=!1;h.updating=!0;return h}a._inheritsLoose(u,c);var t=u.prototype;t.setup=function(h,m,n,z,k){this.layerView=h;this.layer=m;this.queryGraphicUIDsInExtent=n;this.graphicsCore=z;
this.basemapTerrain=k;this.updateScaleRangeActive();this.handles.add(this.layerView.view.resourceController.scheduler.registerTask(d.TaskPriority.SCALE_VISIBILITY,this))};t.destroy=function(){this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=this.handles=null};t._setDirty=function(){this.updating||this._set("updating",!0)};t.setExtent=function(h){this.extent=h;this._setDirty()};t.scaleRangeActive=function(){return this._scaleRangeActive};t.updateScaleRangeActive=
function(){var h=this.layer;let m=this.layerScaleEnabled&&(0<h.minScale||0<h.maxScale);h.labelingInfo&&!m&&(m=h.labelingInfo.some(n=>n&&(0<n.minScale||0<n.maxScale)));h=this._scaleRangeActive!==m;(this._scaleRangeActive=m)&&!this.handles.has("terrain-events")&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",n=>this.scaleUpdateHandler(n)),"terrain-events"),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):
!m&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return h};t.runTask=function(){const h=this.layerView.view.basemapTerrain;this.extent&&h&&h.ready&&this._scaleRangeActive&&this.layerScaleEnabled?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,h.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,m=>this.finishUpdate(m))):this.finishUpdate(!0)};t.finishUpdate=function(h){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",
!h);this._set("updating",!1)};t.visibleAtLayerScale=function(h){return!this.layerScaleEnabled||g.scaleBoundsPredicate(h,this.layer.minScale||0,this.layer.maxScale||0)};t.visibleAtLabelScale=function(h,m){return g.scaleBoundsPredicate(h,m.minScale||0,m.maxScale||0)};t.graphicScale=function(h){let m;q.isSome(h.centroid)?m=h.centroid:q.isSome(h.graphic.geometry)&&"point"===h.graphic.geometry.type&&(m=h.graphic.geometry);return m?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(m):
1:null};t.graphicVisible=function(h){if(!this.layerScaleEnabled)return!0;h=this.graphicScale(h);return this.visibleAtLayerScale(h)};t.updateVisibility=function(h){if(this._scaleRangeActive){const m=this.graphicVisible(h);return h.setVisibilityFlag(1,m,0)}return!1};t.updateGraphicLabelScaleVisibility=function(h){if(!this._scaleRangeActive||!h.labelGraphics||0===h.labelGraphics.length)return!1;const m=this.graphicScale(h);if(h=this.updateLabelScaleVisibility(h,m))this.layerView.view.deconflictor.setDirty(),
this.layerView.view.labeler.setDirty();return h};t.updateLabelScaleVisibility=function(h,m){if(!h.labelGraphics||0===h.labelGraphics.length)return!1;const n=h.labelGraphics[0]._labelClass;return n&&null!=n.minScale&&null!=n.maxScale&&(m=this.visibleAtLabelScale(m,n),h.setVisibilityFlag(1,m,1))?!0:!1};t.scaleUpdateHandler=function(h){this._setDirty();if(!this.layerView.suspended){var m=h.extent,n=h.scale,z=this.visibleAtLayerScale(n),k=!1;this.queryGraphicUIDsInExtent(m,h.spatialReference,v=>{v=this.graphicsCore.getGraphics3DGraphicById(v);
if(!q.isNone(v)){var x=v.centroid;q.isSome(x)&&(m[0]>x.x||m[1]>x.y||m[2]<x.x||m[3]<x.y)||(v.setVisibilityFlag(1,z,0)&&(k=!0),this.updateLabelScaleVisibility(v,n)&&(k=!0))}});k&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}};t.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(h=>h.clearVisibilityFlag(1)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();
this._setDirty()};a._createClass(u,[{key:"running",get:function(){return!(!this.layerView.view.basemapTerrain||!this.updating)}}]);return u}(b);p.__decorate([y.property({constructOnly:!0})],b.prototype,"layerScaleEnabled",void 0);p.__decorate([y.property({readOnly:!0})],b.prototype,"suspended",void 0);p.__decorate([y.property({readOnly:!0})],b.prototype,"updating",void 0);return b=p.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],b)})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],
function(a){a.attributeLookup=function(p,b,r){if(!r||null==b)return null;if(!p){a:{p=r.toLowerCase();for(var q in b)if(q.toLowerCase()===p){b=b[q];break a}b=null}return b}return(q=p.get(r))?b[q.name]:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../core/maybe","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,p,b,r){a.toViewIfLocal=function(q){const y=
q.view.spatialReference,f=q.layer.fullExtent;var w=f&&f.spatialReference;if(!w)return Promise.resolve(null);if(w.equals(y))return Promise.resolve(f.clone());w=b.project(f,y);return p.isSome(w)?Promise.resolve(w):q.view.state.isLocal?r.projectGeometry(f,y,q.layer.portalItem).then(e=>!q.destroyed&&e?e:void 0).catch(()=>null):Promise.resolve(null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,p,b,r,q){let y=function(){function f(e){this._capabilities=this._memoryCache=null;const l=e.layerView.layer;this.layerView=e.layerView;this.objectIdField=l.objectIdField;this.globalIdField="globalIdField"in l?l.globalIdField:null;this.returnZ=e.returnZ;this.returnM=e.returnM;const g=this.layerView.view.resourceController;this.query=q.createFeatureTileQuery3D(l,d=>g.schedule(d));g&&this.memoryCacheEnabled&&(this._memoryCache=
g.memoryController.getMemCache(l.uid))}var w=f.prototype;w.destroy=function(){this._memoryCache=b.destroyMaybe(this._memoryCache);this.query.destroy()};w.createQuery=function(){const e=this.layerView.layer.createQuery();e.outFields=this.layerView.availableFields;e.returnZ=this.returnZ;e.returnM=this.returnM;e.outSpatialReference=this.tilingScheme.spatialReference;return e};w.logFetchError=function(e,l){e.error("#fetchTile()",this.layerView.layer,l&&l.message?l.message:l)};p._createClass(f,[{key:"memoryCacheEnabled",
get:function(){switch(this.layerView.layer.source.type){case "feature-layer":case "ogc-feature":return!0;case "csv":case "geojson":case "memory":case "wfs":return!1}}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this.layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this.layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const e=this.layerView.view.resourceController;return e?e.scheduler:null}},
{key:"geometryType",get:function(){return this.layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this.layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this.layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return b.isSome(this._capabilities)?this._capabilities:this._capabilities=r.contextCapabilitiesFromLayer(this.layerView.layer)}}]);
return f}();a.FeatureTileFetcher3DLayerViewContext=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){let t=function(z){function k(x){return z.call(this,x)||this}p._inheritsLoose(k,z);var v=k.prototype;v.queryFeatureCount=function(x,C){return this.layer.queryFeatureCount(x,C)};v.destroy=function(){this._decoder=q.destroyMaybe(this._decoder)};v._createRequestOptions=function(x){return{...x,query:{...this.layer.customParameters,token:this.layer.apiKey,...null==x?void 0:x.query}}};p._createClass(k,[{key:"queryFeaturesDehydrated",get:function(){var x=this.layer.capabilities;
if((x=x&&x.query)&&x.supportsFormatPBF){var C,A;q.isNone(this._decoder)&&(this._decoder=new u.PBFDecoder(this.schedule));const B={sourceSpatialReference:null!=(C=null==(A=this.layer.spatialReference)?void 0:A.toJSON())?C:null,applyTransform:!0,maxStringAttributeLength:1024};return(D,E)=>c.runQuery(this.layer.parsedUrl,D,"pbf",this._createRequestOptions(E)).then(G=>{y.throwIfAborted(E);return q.isSome(this._decoder)?this._decoder.invoke({buffer:G.data,options:B},E.signal):Promise.reject(y.createAbortError())})}return(B,
D)=>c.executeQuery(this.layer.parsedUrl,B,this.layer.spatialReference,this._createRequestOptions(D)).then(E=>d.fromFeatureSetJSON(E.data))}}]);return k}(r);b.__decorate([f.property({constructOnly:!0})],t.prototype,"layer",void 0);b.__decorate([f.property({constructOnly:!0})],t.prototype,"schedule",void 0);b.__decorate([f.property({readOnly:!0})],t.prototype,"queryFeaturesDehydrated",null);t=b.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],t);let h=
function(z){function k(x){return z.call(this,x)||this}p._inheritsLoose(k,z);var v=k.prototype;v.queryFeaturesDehydrated=function(x,C){return this.layer.queryFeatures(x,C)};v.queryFeatureCount=function(x,C){return this.layer.queryFeatureCount(x,C)};return k}(r);b.__decorate([f.property({constructOnly:!0})],h.prototype,"layer",void 0);b.__decorate([f.property({readOnly:!0})],h.prototype,"queryFeaturesDehydrated",null);h=b.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],
h);let m=function(z){function k(v){return z.call(this,v)||this}p._inheritsLoose(k,z);k.prototype.queryFeaturesDehydrated=function(v,x){return this.layer.queryFeatures(v,x)};return k}(r);b.__decorate([f.property({constructOnly:!0})],m.prototype,"layer",void 0);m=b.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],m);let n=function(z){function k(x){return z.call(this,x)||this}p._inheritsLoose(k,z);var v=k.prototype;v.queryFeaturesDehydrated=function(x,
C){return this.source.queryFeaturesJSON(x,C).then(d.fromFeatureSetJSON,A=>{if(A&&"query-features-json:unsupported"===A.name)return this.layer.queryFeatures(x,C);throw A;})};v.queryFeatureCount=function(x,C){return this.layer.queryFeatureCount(x,C)};return k}(r);b.__decorate([f.property({constructOnly:!0})],n.prototype,"layer",void 0);b.__decorate([f.property({constructOnly:!0})],n.prototype,"source",void 0);n=b.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],
n);a.createFeatureTileQuery3D=function(z,k){return"feature"===z.type&&"feature-layer"===z.source.type?q.isSome(z.infoFor3D)?new h({layer:z}):new t({layer:z,schedule:k}):"feature"===z.type&&"memory"===z.source.type||"csv"===z.type||"geojson"===z.type||"wfs"===z.type?new n({layer:z,source:z.source}):"ogc-feature"===z.type?new m({layer:z}):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Graphic ../../../core/maybe ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,p,b,r,q,y,f){let w=function(){function l(d){this._schedule=d;this._handle=new e(d)}var g=l.prototype;g.destroy=function(){this._handle.destroy()};g.invoke=function(d,c){if(!d.buffer||0===d.buffer.byteLength)return Promise.resolve(null);d.options.sourceSpatialReference&&d.options.sourceSpatialReference instanceof y&&(d.options={...d.options,sourceSpatialReference:d.options.sourceSpatialReference.toJSON()});return this._handle.invoke(d,c).then(u=>this._schedule(()=>{u.spatialReference=y.fromJSON(u.spatialReference);
if(u.fields)for(var t=0;t<u.fields.length;t++)u.fields[t]=f.fromJSON(u.fields[t]);t=u.spatialReference;for(const h of u.features)h.uid=b.generateUID(),r.isSome(h.geometry)&&(h.geometry.spatialReference=t);return u}))};return l}(),e=function(l){function g(d){return l.call(this,"PBFDecoderWorker","_parseFeatureQuery",d)||this}p._inheritsLoose(g,l);g.prototype.getTransferList=function(d){return[d.buffer]};return g}(q.WorkerHandle);a.PBFDecoder=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/EventedSet":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/SetUtils"],function(a,p,b,r){b=function(q){function y(){var w=q.apply(this,arguments)||this;w._set=new Set;return w}p._inheritsLoose(y,q);var f=y.prototype;f.clear=function(){if(0<this._set.size){const w=this.toArray();this._set.clear();this.emit("after-changes",{type:2});this.emit("change",{added:[],removed:w})}};f.addMany=function(w){if(0!==w.length){for(const e of w)this._set.add(e);this.emit("after-changes",{type:1});
this.emit("change",{added:w,removed:[]})}};f.remove=function(w){this._set.delete(w)&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:[w]}))};f.removeMany=function(w){const e=[];for(const l of w)this._set.delete(l)&&e.push(l);0<e.length&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:e}))};f.toArray=function(){return[...this._set]};f.find=function(w){let e;r.someSet(this._set,l=>w(l)?(e=l,!0):!1);return e};f.forEach=function(w){this._set.forEach(e=>
w(e))};p._createClass(y,[{key:"length",get:function(){return this._set.size}}]);return y}(b);a.EventedSet=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/FeatureLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/fieldUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/FeatureEffect ./support/FeatureFilter ./support/popupUtils ../support/floorFilterUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k){const v=q.getLogger("esri.views.layers.FeatureLayerView");q=x=>{x=function(C){function A(...D){D=C.call(this,...D)||this;D._updatingRequiredFieldsPromise=null;D.effect=null;D.filter=null;D.timeExtent=null;D.layer=null;D.requiredFields=[];D.view=null;return D}p._inheritsLoose(A,C);var B=A.prototype;B.initialize=function(){w.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter effect layer.timeInfo layer.floorInfo timeExtent".split(" "),
()=>this._handleRequiredFieldsChange(),!0);w.on(this,"view.floors","change",()=>this._handleRequiredFieldsChange());w.on(this,"layer.sublayer","change",()=>this._handleRequiredFieldsChange())};B.highlight=function(D){throw Error("missing implementation");};B.createQuery=function(){var D={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};D=y.isSome(this.filter)?this.filter.createQuery(D):new t(D);if("feature"===this.layer.type){const E=k.getFloorFilterClause(this);y.isSome(E)&&
(D.where=D.where?`(${D.where}) AND (${E})`:E)}y.isSome(this.timeExtent)&&(D.timeExtent=y.isSome(D.timeExtent)?D.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return D};B.queryFeatures=function(D,E){throw Error("missing implementation");};B.queryObjectIds=function(D,E){throw Error("missing implementation");};B.queryFeatureCount=function(D,E){throw Error("missing implementation");};B.queryExtent=function(D,E){throw Error("missing implementation");};B._loadArcadeModules=function(D){if(D.get("expressionInfos.length"))return h.loadArcade()};
B._handleRequiredFieldsChange=function(){const D=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",D);D.then(()=>{this._updatingRequiredFieldsPromise===D&&this._set("_updatingRequiredFieldsPromise",null)})};B._updateRequiredFields=function(){var D=p._asyncToGenerator(function*(){if(this.layer&&this.view){var E="3d"===this.view.type,{layer:G,layer:{fieldsIndex:K,objectIdField:M}}=this,H="renderer"in G&&G.renderer,J="orderBy"in G&&G.orderBy,O=G.featureReduction,I=new Set;H=yield f.eachAlways([H?
H.collectRequiredFields(I,K):null,u.collectLabelingFields(I,G),E?u.collectElevationFields(I,G):null,y.isSome(this.filter)?u.collectFilterFields(I,G,this.filter):null,this.effect?u.collectFilterFields(I,G,this.effect.filter):null,O?u.collectFeatureReductionFields(I,G,O):null,J?u.collectOrderByInfos(I,G,J):null]);G.timeInfo&&this.timeExtent&&u.collectFields(I,G.fieldsIndex,[G.timeInfo.startField,G.timeInfo.endField]);"feature"===G.type&&G.floorInfo&&u.collectFields(I,G.fieldsIndex,[G.floorInfo.floorField]);
"subtype-group"===G.type&&(u.collectField(I,K,G.subtypeField),J=G.sublayers.map(F=>{var L;return Promise.all([null==(L=F.renderer)?void 0:L.collectRequiredFields(I,K),u.collectLabelingFields(I,F)])}),yield f.eachAlways(J));for(const F of H)F.error&&v.error(F.error);u.collectField(I,K,M);E&&"displayField"in G&&G.displayField&&u.collectField(I,K,G.displayField);E=Array.from(I).sort();this._set("requiredFields",E)}});return function(){return D.apply(this,arguments)}}();B.validateFetchPopupFeatures=function(D){if(y.isNone(D))return null;
for(const E of D.clientGraphics){const G=E.layer;if("popupEnabled"in G&&!G.popupEnabled)return new r("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:G});if("popupTemplate"in G&&!z.getFetchPopupTemplate(G,D))return new r("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:G})}};B.fetchClientPopupFeatures=function(){var D=p._asyncToGenerator(function*(E){var G=y.isSome(E)?E.clientGraphics:null;if(!G||0===G.length)return Promise.resolve([]);const K=
[],M=[],H=yield this.createPopupQuery(E);for(const O of G){var {layer:J}=O;if(!("popupEnabled"in J))continue;G=u.unpackFieldNames(this.layer.fieldsIndex,H.outFields);J=z.getFetchPopupTemplate(J,E);if(!y.isSome(J))continue;const I=yield this._loadArcadeModules(J);I&&I.arcadeUtils.hasGeometryOperations(J)||!u.featureHasFields(G,O)?M.push(O):K.push(O)}if("stream"===this.layer.type||0===M.length)return Promise.resolve(K);H.objectIds=M.map(O=>O.attributes[this.layer.objectIdField]);return this.layer.queryFeatures(H).then(O=>
K.concat(O.features)).catch(()=>M)});return function(E){return D.apply(this,arguments)}}();B.createPopupQuery=function(){var D=p._asyncToGenerator(function*(E){const G=this.layer.createQuery(),K=new Set;var M=!1,H=y.isSome(E)&&E.clientGraphics?E.clientGraphics.map(J=>J.layer):[this.layer];for(const J of H)if("popupEnabled"in J&&(H=z.getFetchPopupTemplate(J,E),y.isSome(H))){M=(M=yield this._loadArcadeModules(H))&&M.arcadeUtils.hasGeometryOperations(H);M=!("point"!==this.layer.geometryType&&!M);H=yield z.getRequiredFields(this.layer,
H);for(const O of H)K.add(O)}G.returnGeometry=M;G.returnZ=M;G.returnM=M;G.outFields=Array.from(K);G.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(E=k.getFloorFilterClause(this),y.isSome(E)&&(G.where=G.where?`(${G.where}) AND (${E})`:E));return G});return function(E){return D.apply(this,arguments)}}();B.canResume=function(){return!C.prototype.canResume.call(this)||y.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};p._createClass(A,[{key:"availableFields",get:function(){const {layer:D,
layer:{fieldsIndex:E},requiredFields:G}=this;return"outFields"in D&&D.outFields?u.fixFields(E,[...u.unpackFieldNames(E,D.outFields),...G]):u.fixFields(E,G)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(D){v.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return A}(x);b.__decorate([e.property()],x.prototype,"_updatingRequiredFieldsPromise",void 0);b.__decorate([e.property({readOnly:!0})],
x.prototype,"availableFields",null);b.__decorate([e.property({type:m})],x.prototype,"effect",void 0);b.__decorate([e.property({type:n})],x.prototype,"filter",void 0);b.__decorate([e.property(c.combinedViewLayerTimeExtentProperty)],x.prototype,"timeExtent",void 0);b.__decorate([e.property()],x.prototype,"layer",void 0);b.__decorate([e.property({type:Number})],x.prototype,"maximumNumberOfFeatures",null);b.__decorate([e.property({readOnly:!0,type:Boolean})],x.prototype,"maximumNumberOfFeaturesExceeded",
null);b.__decorate([e.property({readOnly:!0})],x.prototype,"requiredFields",void 0);b.__decorate([e.property()],x.prototype,"suspended",void 0);b.__decorate([e.property()],x.prototype,"view",void 0);return x=b.__decorate([d.subclass("esri.views.layers.FeatureLayerView")],x)};a.FeatureLayerView=q;a["default"]=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/support/FeatureEffect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./FeatureFilter".split(" "),
function(a,p,b,r,q,y,f,w,e){var l;b=l=function(g){function d(){var c=g.apply(this,arguments)||this;c.filter=null;c.includedEffect=null;c.excludedEffect=null;c.excludedLabelsVisible=!1;return c}a._inheritsLoose(d,g);d.prototype.clone=function(){return new l({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};return d}(b.JSONSupport);p.__decorate([r.property({type:e,json:{write:!0}})],b.prototype,
"filter",void 0);p.__decorate([r.property({json:{write:!0}})],b.prototype,"includedEffect",void 0);p.__decorate([r.property({json:{write:!0}})],b.prototype,"excludedEffect",void 0);p.__decorate([r.property({type:Boolean,json:{write:!0}})],b.prototype,"excludedLabelsVisible",void 0);return b=l=p.__decorate([w.subclass("esri.views.layers.support.FeatureEffect")],b)})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe",
"../../../layers/support/fieldUtils"],function(a,p,b,r){function q(){q=p._asyncToGenerator(function*(y,f=y.popupTemplate){if(!b.isSome(f))return[];const w=yield f.getRequiredFields(y.fieldsIndex);({lastEditInfoEnabled:f}=f);const {objectIdField:e,typeIdField:l,globalIdField:g,relationships:d}=y;if(w.includes("*"))return["*"];f=f?yield r.getFeatureEditFields(y):[];const c=r.fixFields(y.fieldsIndex,[...w,...f]);l&&c.push(l);c&&e&&y.fieldsIndex.has(e)&&-1===c.indexOf(e)&&c.push(e);c&&g&&y.fieldsIndex.has(g)&&
-1===c.indexOf(g)&&c.push(g);d&&d.forEach(u=>{({keyField:u}=u);c&&u&&y.fieldsIndex.has(u)&&-1===c.indexOf(u)&&c.push(u)});return c});return q.apply(this,arguments)}a.getFetchPopupTemplate=function(y,f){return y.popupTemplate?y.popupTemplate:b.isSome(f)&&f.defaultPopupTemplateEnabled&&b.isSome(y.defaultPopupTemplate)?y.defaultPopupTemplate:null};a.getRequiredFields=function(y){return q.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/RefreshableLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e,l){w=g=>{g=function(d){function c(){return d.apply(this,arguments)||this}p._inheritsLoose(c,d);c.prototype.initialize=function(){this.handles.add(y.on(this,"layer","refresh",()=>{this.doRefresh().catch(u=>{q.isAbortError(u)||r.getLogger(this.declaredClass).error(u)})}),"RefreshableLayerView")};return c}(g);b.__decorate([f.property()],g.prototype,"layer",void 0);return g=b.__decorate([l.subclass("esri.layers.mixins.RefreshableLayerView")],g)};a.RefreshableLayerView=w;a["default"]=
w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N,R,S,P,Q,V,ca,ba,Z){const ha=q.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),fa=k.create();q=function(W){function U(){var T=W.apply(this,arguments)||this;T.type="point-cloud-3d";T.maximumPointCount=4E6;T.slicePlaneEnabled=!1;T._renderer=null;T._rendererAdded=!1;T._renderedNodes=new Set;T._nodeScales=new Map;T._updateViewNeeded=!0;T._lodFactor=1;T._maxLoggedBoxWarnings=5;T._pageMultiplier=1;T._nodeLoadEpoch=
0;T._indexQueue=[];T._workQueue=[];T._idleQueue=new G;T._indexPagesLoading=new Map;T._loadingNodes=new Map;T._recalcWork=!0;T._layerIsVisible=!1;T._codedDomainPopulationPromise=null;T._codedDomainPopulationAbortController=null;T._totalWork=0;T._index=null;T._loadingInitNodePage=!1;T._nodeIdArray=[];return T}a._inheritsLoose(U,W);var X=U.prototype;X.initialize=function(){const T=this.view.resourceController;this._worker=new H.PointCloudWorkerHandle(ia=>T.schedule(ia));this.addResolvingPromise(this._worker.promise);
this._tmpPoint=v.makeDehydratedPoint(0,0,0,this.layer.spatialReference);J.checkPointCloudLayerValid(this.layer);J.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=T.createStreamDataRequester(2);this._dataRequester=T.createStreamDataRequester(3);this._initRenderer();const Y=this._initNodePages(),ea=this.view.resourceController.memoryController;this._memCache=ea.getMemCache(this.layer.uid);this.updatingHandles.add(this,"_clippingBox",()=>this._setUpdateViewNeeded(),
2);this.updatingHandles.add(this,"_elevationOffset",()=>this._elevationOffsetChanged(),2);this.updatingHandles.add(this.layer,"renderer",()=>this._rendererChanged(),2);this.updatingHandles.add(this.layer,"filters",()=>this._reload(),2);this.updatingHandles.add(this.layer,"outFields",()=>this._reload(),2);this.updatingHandles.add(this.layer,"scaleRangeId",()=>this._setUpdateViewNeeded());this.updatingHandles.add(this,"clippingArea",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this.view.state,
"contentCamera",()=>this._setUpdateViewNeeded());this.handles.add([this.view.basemapTerrain.on("scale-change",ia=>this._scaleUpdateHandler(ia)),ea.events.on("quality-changed",()=>this._setUpdateViewNeeded())]);this.addResolvingPromise(Y);this.when(()=>{this.handles.add([T.scheduler.registerTask(Z.TaskPriority.POINT_CLOUD_LAYER,this),T.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(this,"suspended",ia=>{ia?this._clearNodeState():this._setUpdateViewNeeded()},
2)])},()=>{this.updatingHandles.removeAll();this.handles.removeAll()})};X._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};X.destroy=function(){this.cancelLoading();this._worker&&(this._worker.destroy(),this._worker=null);this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null);this._codedDomainPopulationPromise=
null};X._initRenderer=function(){this._renderer=new R.PointRenderer({createGraphic:(T,Y,ea)=>this._createGraphic(T,Y,ea)});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(this,"_clippingBox",T=>this._renderer.clippingBox=T,2);this.updatingHandles.add(this,"suspended",T=>this._setPointsVisible(!T),2);this.updatingHandles.add(this,"pointScale",T=>this._renderer.scaleFactor=T,2);this._renderer.minSizePx=Math.sqrt(2);this.updatingHandles.add(this,"useRealWorldSymbolSizes",T=>this._renderer.useRealWorldSymbolSizes=
T,2);this.updatingHandles.add(this,"pointSize",T=>{const Y=w.pt2px(T);this._renderer.size=T;this._renderer.sizePx=Y},2);this.updatingHandles.add(this,"slicePlaneEnabled",T=>this._renderer.slicePlane=T,2);this.updatingHandles.add(this,"inverseDensity",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this,"maximumPointCount",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",T=>{this._lodFactor=T;this._setUpdateViewNeeded()},
2)};X._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};X._createGraphic=function(T,Y,ea){const ia=y.isSome(T.pointIdFilterMap)?T.pointIdFilterMap[Y]:Y;ea=this.view.computeMapPointFromVec3d(ea);const la=this._createGraphicAttributes(T,ia);return new N.PointGraphic({pointCloudMetadata:{nodeId:T.id,pointIndexInNode:Y,attributePointIndexInNode:ia,epoch:this._nodeLoadEpoch},geometry:ea,attributes:la,layer:this.layer,sourceLayer:this.layer})};X._createGraphicAttributes=
function(T,Y){const ea={};for(const ia of T.attributes)this._encodeGraphicAttribute(ia.attributeInfo,ia.values,Y,ea);return ea};X._encodeGraphicAttribute=function(T,Y,ea,ia){var la=T.storageInfo&&T.storageInfo.attributeValues;const pa=la?la.valuesPerElement:1;if(1===pa)ia[T.name]=Y[ea];else if("UInt8"===la.valueType&&4>=pa){la=0;ea*=pa;for(let ua=ea;ua<ea+pa;ua++)la=(la<<8)+Y[ua];ia[T.name]=la}else ia[T.name]=void 0};X._setPointsVisible=function(T){T&&!this._rendererAdded?(this.view._stage.addRenderPlugin([4],
this._renderer),this._rendererAdded=!0):!T&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};X._rendererChanged=function(){this._renderer.useFixedSizes=F.rendererUsesFixedSizes(this.layer.renderer);this._reload()};X._reload=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};X._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};X._scaleUpdateHandler=function(T){this.layer.minScale||
this.layer.maxScale?m.projectBoundingRect(T.extent,T.spatialReference,aa,this.layer.spatialReference)&&(this._nodeScales.forEach((Y,ea)=>{this._renderedNodes.has(ea)?(Y=this._index.getNode(ea),z.containsPoint(aa,Y.obb.center)&&this._nodeScales.set(ea,T.scale)):this._nodeScales.delete(ea)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};X.displayNodes=function(T){this._workQueue=O.nodeDiff([...this._renderedNodes],T,this._index);O.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,
this._index);O.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<T.length||this._loadingInitNodePage;this.notifyChange("suspended")};X.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};X._cancelNodeLoading=function(){const T=[];this._loadingNodes.forEach(({abortController:Y})=>T.push(Y));this._loadingNodes.clear();for(const Y of T)Y.abort();this._workQueue=[];this._idleQueue.cancelAll();
this._totalWork=this._computeWork();this._updateLoading()};X._updateQueues=function(){const T=new Set;this._workQueue.forEach(ia=>ia.load.forEach(la=>T.add(la)));const Y=[],ea=new Map;this._loadingNodes.forEach((ia,la)=>{T.has(la)?ea.set(la,ia):Y.push(ia)});this._loadingNodes=ea;for(const {abortController:ia}of Y)ia.abort();this._workQueue=this._workQueue.filter(ia=>{for(const la of ia.load)if(this._loadingNodes.has(la))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();
this._updateLoading()};X._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:T})=>T.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};X._clearNodeState=function(){this._nodeLoadEpoch++;this._renderedNodes.forEach(T=>this._removeFromRenderer(T));this._cancelNodeLoading()};X._idleBegin=function(){this._setUpdateViewNeeded()};X._idleEnd=function(){this._setUpdateViewNeeded()};X.runTask=function(T){if(this.suspended)this._updateViewNeeded&&
(this._updateViewNeeded=!1,T=this._isRootNodeVisible(),T!==this._layerIsVisible&&(this._layerIsVisible=T,this.notifyChange("suspended")),this._updateLoading());else{for(T.run(()=>this._updateWorkQueues());0<this._indexQueue.length&&T.run(()=>this._processIndexQueue()););for(this._processWorkQueue(T);0<this._idleQueue.length&&T.run(()=>this._idleQueue.process()););}};X._processIndexQueue=function(){const T=this._indexQueue.shift(),Y=this._loadNodePage(T);this._indexPagesLoading.set(T,Y);Y.promise.then(ea=>
{this._index.addPage(T,ea,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(T)},()=>{this._indexPagesLoading.delete(T)});return!0};X._processWorkQueue=function(T){for(;!T.done;){const Y=this._scheduleWorkEntry();if(y.isNone(Y))break;this._processWorkEntry(Y);T.madeProgress()}};X._scheduleWorkEntry=function(){let T=this._workQueue.length;for(;T--;){const Y=this._workQueue.shift();if(Y.remove.find(ea=>!this._renderedNodes.has(ea)))this._workQueue.push(Y);
else return Y}return null};X._processWorkEntry=function(T){if(0===T.load.length)for(const Y of T.remove)this._removeFromRenderer(Y);else Promise.all(T.load.map(Y=>{const ea=f.createAbortController(),ia=this._memCache.pop(Y.toString());y.isSome(ia)?this._loadingNodes.set(Y,{abortController:ea,promise:Promise.resolve(ia)}):this._loadingNodes.has(Y)||this._loadingNodes.set(Y,{abortController:ea,promise:this.loadNode(Y,ea.signal)});return this._loadingNodes.get(Y).promise})).then(Y=>{for(let ea=0;ea<
T.load.length;ea++)if(Y[ea]){const ia=this._setupRendererData(T.load[ea],Y[ea]);this._addToRenderer(ia)}for(const ea of T.remove)this._removeFromRenderer(ea)}).catch(()=>{}).then(()=>{for(const Y of T.load)this._loadingNodes.delete(Y);this._updateLoading();this._recalcWork&&0===this._idleQueue.length&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()};X.populateClassCodeCodedDomain=function(){var T=a._asyncToGenerator(function*(Y,
ea){const ia=this.layer.fieldsIndex.get("CLASS_CODE");ia&&!ia.domain&&-1!==Y.indexOf(ia.name)&&(Y=yield b.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:ea})),!1!==Y.ok&&(Y=(Y=Y.value)&&Y.labels&&Y.labels.labels)&&Array.isArray(Y)&&(ia.domain=new C({name:"CLASS_CODE",codedValues:Y.map(la=>new x["default"]({code:la.value,name:la.label}))})))});return function(Y,ea){return T.apply(this,arguments)}}();X.prepareFetchPopupFeatures=function(){var T=a._asyncToGenerator(function*(Y){this._codedDomainPopulationPromise||
(this._codedDomainPopulationAbortController=f.createAbortController(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(Y,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise});return function(Y){return T.apply(this,arguments)}}();X.whenGraphicAttributes=function(){var T=a._asyncToGenerator(function*(Y,ea){var ia=this;const la=this._splitGraphicsPerNode(Y),pa=this.layer.attributeStorageInfo,
ua=ea.map(La=>F.getAttributeInfo(pa,La)),wa=function(){var La=a._asyncToGenerator(function*(Ma,Sa){const Ia=ia._index.getNode(Sa);yield b.forEach(ua,function(){var va=a._asyncToGenerator(function*(ma){const ta=ma.useElevation?yield ia._loadElevationAttributeFromGeometry(Ia.resourceId):yield ia._loadAndParseAttribute(Ia,ma);if(ta)for(const Ea of Ma)ia._isValidPointGraphic(Ea)&&ia._encodeGraphicAttribute(ma,ta,Ea.pointCloudMetadata.attributePointIndexInNode,Ea.attributes)});return function(ma){return va.apply(this,
arguments)}}())});return function(Ma,Sa){return La.apply(this,arguments)}}(),Fa=[];la.forEach((La,Ma)=>{Fa.push(wa(La,Ma))});yield f.eachAlways(Fa);return Y});return function(Y,ea){return T.apply(this,arguments)}}();X._isValidPointGraphic=function(T){return T instanceof N.PointGraphic&&T.pointCloudMetadata&&T.pointCloudMetadata.epoch===this._nodeLoadEpoch};X._splitGraphicsPerNode=function(T){const Y=new Map;for(const ea of T){if(!this._isValidPointGraphic(ea))continue;T=ea.pointCloudMetadata;const ia=
Y.get(T.nodeId);ia?ia.push(ea):Y.set(T.nodeId,[ea])}return Y};X._loadAndParseAttribute=function(){var T=a._asyncToGenerator(function*(Y,ea){const ia=yield this._loadAttribute(Y.resourceId,ea,null);return y.isSome(ia)?L.getAttributeValues({attributeInfo:ea,buffer:ia},null,Y.vertexCount):null});return function(Y,ea){return T.apply(this,arguments)}}();X._loadElevationAttributeFromGeometry=function(){var T=a._asyncToGenerator(function*(Y){Y=L.readGeometry(this.layer.store.defaultGeometrySchema,yield this._loadGeometry(Y,
null));return L.elevationFromPositions(Y,Y.length/3)});return function(Y){return T.apply(this,arguments)}}();X.highlight=function(T){if(!T)return{remove(){}};T=r.isCollection(T)?T.toArray():Array.isArray(T)?T:[T];return this._renderer.highlight(T.map(Y=>this._graphicToPointDefinition(Y)))};X._graphicToPointDefinition=function(T){if(!this._isValidPointGraphic(T))return null;const {nodeId:Y,pointIndexInNode:ea}=T.pointCloudMetadata;return null!=Y&&null!=ea?{nodeId:Y,pointId:ea}:null};X._computeWork=
function(){let T=0;for(const Y of this._workQueue)T+=Y.load.length+Y.remove.length;T+=this._loadingNodes.size;T+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;T+=this._loadingInitNodePage?100:0;return T+=this._updateViewNeeded?100:0};X._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};X.canResume=function(){return W.prototype.canResume.call(this)&&this._layerIsVisible};X.isUpdating=function(){return this.suspended?this._updateViewNeeded:
0<this._computeWork()};X._initNodePages=function(){const T=this.layer.store.index;this._index=new I(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,T.nodesPerPage||T.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=T.nodesPerPage?1:T.nodePerIndexBlock;return this._loadNodePage(0).promise.then(Y=>
{this._index.addPage(0,Y,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})};X._loadNodePage=function(T){const Y=f.createAbortController();return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${T*this._pageMultiplier}`,Y.signal).then(ea=>ea.nodes.map((ia,la)=>({resourceId:null!=ia.resourceId?ia.resourceId:T*this._index.pageSize+la,obb:ia.obb,firstChild:ia.firstChild,childCount:ia.childCount,vertexCount:null!=ia.vertexCount?ia.vertexCount:ia.pointCount,lodThreshold:null!=
ia.lodThreshold?ia.lodThreshold:ia.effectiveArea}))),abortController:Y}};X._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;let T=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const Y=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();let ea=this._computeNodesForMinimumDensity(T),ia=this._computePointCount(ea),la=Math.sqrt(ia/(.75*Y));for(;ia>Y;)T*=la,ea=this._computeNodesForMinimumDensity(T),ia=this._computePointCount(ea),la=Math.sqrt(2);this.displayNodes(ea);
this._updateViewNeeded=!1;this._updateLoading();return!0};X._computePointCount=function(T){let Y=0;for(let ea=0;ea<T.length;ea++){const ia=this._index.getNode(T[ea]);ia&&(Y+=ia.vertexCount)}return Y};X._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};X._isRootNodeVisible=function(){let T=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(Y,ea,ia)=>{T=ia;return!1},pageMiss:()=>{}});return T};
X._computeNodesForMinimumDensity=function(T){const Y=this.view.state.contentCamera,ea=Y.frustum,ia=this._clippingBox,la=Y.viewForward,pa=t.dot(la,Y.eye),ua=k.fromNormalAndOffset(la,-pa,fa),wa=Y.perScreenPixelRatio/2,Fa=T*T,La=this._nodeIdArray;La.length=0;const {minScale:Ma,maxScale:Sa}=ba.extractSafeScaleBounds(this.layer),Ia=0===Ma&&0===Sa?va=>La.push(va):va=>{const ma=this._getScale(va);ba.scaleBoundsPredicate(ma,Ma,Sa)&&La.push(va)};this._traverseVisible({frustum:ea,clippingBox:ia},{predicate:(va,
ma,ta)=>{if(!ta)return!1;if(0===ma.childCount)return Ia(va),!1;ta=this._index.getRenderObb(va);return this._computeAveragePixelArea(ta,ma.lodThreshold,ma.vertexCount,ua,wa)<=Fa?(Ia(va),!1):!0},pageMiss:(va,ma)=>{Ia(va);0>this._indexQueue.indexOf(ma)&&this._indexQueue.push(ma)}});return La};X._getScale=function(T){var Y=this._nodeScales.get(T);null==Y&&(Y=this._index.getNode(T).obb.center,this._tmpPoint.x=Y[0],this._tmpPoint.y=Y[1],this._tmpPoint.z=Y[2],Y=this.view.basemapTerrain.getScale(this._tmpPoint),
this._nodeScales.set(T,Y));return Y};X._computeAveragePixelArea=function(T,Y,ea,ia,la){T=Math.max(1E-7,Q.minimumDistancePlane(T,ia));return Y/(T*T)/(4*la*la)/ea};X.loadNode=function(T,Y){try{return this.loadNodeAsync(T,Y)}catch(ea){throw f.isAbortError(ea)||ha.error(ea),ea;}};X.loadAdditionalUserAttributes=function(){var T=a._asyncToGenerator(function*(Y,ea,ia){var la=this.layer.outFields;if(!la)return[];la=E.unpackFieldNames(this.layer.fieldsIndex,la);Y=new Set(Y.map(wa=>y.isSome(wa)?wa.name:null));
const pa=this.layer.attributeStorageInfo,ua=[];for(const wa of la)Y.has(wa)||(la=F.getAttributeInfo(pa,wa))&&ua.push(ea(la));ea=yield f.eachAlwaysValues(ua);f.throwIfAborted(ia);return y.mapSome(ea,wa=>wa)});return function(Y,ea,ia){return T.apply(this,arguments)}}();X.loadNodeAsync=function(){var T=a._asyncToGenerator(function*(Y,ea){var ia=this;const la=this._index.getNode(Y),pa=F.getRendererInfo(this.layer),ua=F.getFilterInfo(this.layer),wa=la.resourceId,Fa=function(){var La=a._asyncToGenerator(function*(Ma){if(y.isNone(Ma))return null;
if(Ma.useElevation)return{attributeInfo:Ma,buffer:null};const Sa=yield ia._loadAttribute(wa,Ma,ea);return y.isSome(Sa)?{attributeInfo:Ma,buffer:Sa}:null});return function(Ma){return La.apply(this,arguments)}}();return this._idleQueue.push(a._asyncToGenerator(function*(){var La=ia._loadGeometry(wa,ea);const {primaryAttribute:Ma,modulationAttribute:Sa}=pa,Ia=Fa(Ma),va=Fa(Sa);var ma=ua.map(Ta=>Ta.attributeInfo);const ta=ma.map(Ta=>Fa(Ta));ma=ia.loadAdditionalUserAttributes([Ma,Sa,...ma],Fa,ea);const [Ea,
Ca,ka,sa,Ja]=yield Promise.all([La,Ia,va,Promise.all(ta),ma]);f.throwIfAborted(ea);La={geometryBuffer:Ea,primaryAttributeData:Ca,modulationAttributeData:ka,filterAttributesData:sa,userAttributesData:Ja,schema:ia.layer.store.defaultGeometrySchema,rendererInfo:pa,filterInfo:ua,obb:ia._index.getRenderObb(Y),elevationOffset:ia._elevationOffset,inSR:ia.layer.spatialReference.toJSON(),outSR:ia.view.renderCoordsHelper.spatialReference.toJSON()};return ia._worker.invoke(La,ea)}),ea)});return function(Y,ea){return T.apply(this,
arguments)}}();X._loadGeometry=function(){var T=a._asyncToGenerator(function*(Y,ea){return this._requestData(`${this.baseUrl}/nodes/${Y}/geometries/0`,ea)});return function(Y,ea){return T.apply(this,arguments)}}();X._loadAttribute=function(){var T=a._asyncToGenerator(function*(Y,ea,ia){return y.isNone(ea)||!ea.storageInfo?null:this._requestData(`${this.baseUrl}/nodes/${Y}/attributes/${ea.storageInfo.key}`,ia)});return function(Y,ea,ia){return T.apply(this,arguments)}}();X._requestNodePage=function(T,
Y){return this._indexRequester.request(T,"json",{query:{f:"json",token:this.layer.apiKey},signal:Y})};X._requestData=function(T,Y){return this._dataRequester.request(T,"binary",{query:{token:this.layer.apiKey},signal:Y})};X._removeFromRenderer=function(T){if(this._renderedNodes.has(T)){const Y=this._renderer.removeNode(T);this._renderedNodes.delete(T);this._nodeScales.delete(T);this._memCache.put(Y.id.toString(),Y,5*Y.coordinates.length+128)}};X._addToRenderer=function(T){this._renderedNodes.has(T.id)||
(this._renderedNodes.add(T.id),this._renderer.addNode(T))};X._setupRendererData=function(T,Y){const ea=this._index.getNode(T),ia=Math.sqrt(ea.lodThreshold/ea.vertexCount),la=this._index.getRenderObb(T);if(R.PointRenderer.isInstanceOfNode(Y))return Y.splatSize=ia,Y.obb=la,Y.origin=h.clone(Y.obb.center),Y;var pa=.01*Math.max(la.halfSize[0],la.halfSize[1],la.halfSize[2]);if(Y.obb.halfSize[0]>la.halfSize[0]+pa||Y.obb.halfSize[1]>la.halfSize[1]+pa||Y.obb.halfSize[2]>la.halfSize[2]+pa)0<this._maxLoggedBoxWarnings&&
(pa=ua=>`[${ua.halfSize[0]}, ${ua.halfSize[1]}, ${ua.halfSize[2]}]`,ha.warn(`Node ${T} reported bounding box too small. got ${pa(la)} but points cover ${pa(Y.obb)}`),0===--this._maxLoggedBoxWarnings&&ha.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(T,Y.obb);return{id:T,coordinates:Y.points,origin:h.clone(la.center),rgb:Y.rgb,attributes:Y.attributes,pointIdFilterMap:Y.pointIdFilterMap,highlights:null,splatSize:ia,obb:la,isLeaf:0===ea.childCount}};
X.getUsedMemory=function(){let T=0;this._renderer.forEachNode(Y=>{T+=160;T+=e.estimateSize(Y.coordinates);for(const ea of Y.attributes)Y=ea.values,e.isArrayBuffer(Y.buffer)&&(T+=e.estimateSize(Y))});return T};X.getUnloadedMemory=function(){var T=this._renderedNodes.size;if(4>T)return 0;const Y=[...this._renderedNodes].reduce((la,pa)=>la+this._index.getNode(pa).vertexCount);let ea=this._loadingNodes.size;for(var ia=0;ia<this._workQueue.length;ia++)ea+=this._workQueue[ia].load.length,ea-=this._workQueue[ia].remove.length;
if(0>ea)return 0;ia=ea*Y/T;T=(this.getUsedMemory()-160*T)/Y;return ia*T+160*ea};X.ignoresMemoryFactor=function(){return!1};a._createClass(U,[{key:"pointScale",get:function(){const T=F.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return T&&null!=T.scaleFactor?T.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){const T=F.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return T&&null!=T.useRealWorldSymbolSizes?T.useRealWorldSymbolSizes:!1}},{key:"pointSize",get:function(){const T=
F.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return T&&null!=T.size?T.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",get:function(){var T=F.getRendererInfo(this.layer);const Y=new Set;T.primaryAttribute&&Y.add(T.primaryAttribute.name);T.modulationAttribute&&Y.add(T.primaryAttribute.name);if(T=F.getFilterInfo(this.layer))for(const ea of T)Y.add(ea.attributeInfo.name);if(this.layer.outFields)for(const ea of E.unpackFieldNames(this.layer.fieldsIndex,
this.layer.outFields))Y.add(ea);return Array.from(Y)}},{key:"_clippingBox",get:function(){if(!this.view||!this.view.clippingArea)return null;const T=n.create();return P.projectToBoundingBox(this.view.clippingArea,T,this.view.renderSpatialReference)?T:null}},{key:"_elevationOffset",get:function(){const T=this.layer&&this.layer.elevationInfo;if(T&&"absolute-height"===T.mode){const Y=l.getMetersPerVerticalUnitForSR(this.layer.spatialReference),ea=K.getMetersPerUnit(T.unit);return y.unwrapOr(T.offset,
0)*ea/Y}return 0}},{key:"running",get:function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||0<this._idleQueue.length}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;const T=this._computeWork();return 1-Math.min(this._totalWork,T)/this._totalWork}},{key:"performanceInfo",get:function(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((T,
Y)=>T+this._index.getNode(Y).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]);return U}(S.PopupSceneLayerView(M.LayerView3D(ca)));p.__decorate([g.property()],q.prototype,"layer",void 0);p.__decorate([g.property({readOnly:!0,
aliasOf:"layer.parsedUrl.path"})],q.prototype,"baseUrl",void 0);p.__decorate([g.property({readOnly:!0})],q.prototype,"pointScale",null);p.__decorate([g.property({readOnly:!0})],q.prototype,"useRealWorldSymbolSizes",null);p.__decorate([g.property({readOnly:!0})],q.prototype,"pointSize",null);p.__decorate([g.property({readOnly:!0})],q.prototype,"inverseDensity",null);p.__decorate([g.property()],q.prototype,"maximumPointCount",void 0);p.__decorate([g.property({readOnly:!0})],q.prototype,"availableFields",
null);p.__decorate([g.property({readOnly:!0})],q.prototype,"_clippingBox",null);p.__decorate([g.property({readOnly:!0})],q.prototype,"_elevationOffset",null);p.__decorate([g.property({type:Boolean})],q.prototype,"slicePlaneEnabled",void 0);p.__decorate([g.property()],q.prototype,"updating",void 0);p.__decorate([g.property(V.updatingProgress)],q.prototype,"updatingProgress",void 0);p.__decorate([g.property({readOnly:!0})],q.prototype,"updatingProgressValue",null);q=p.__decorate([u.subclass("esri.views.3d.layers.PointCloudLayerView3D")],
q);const aa=z.create();return q})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/workers/WorkerHandle"],function(a,p,b,r){r=function(q){function y(f){return q.call(this,"PointCloudWorker","transform",f)||this}p._inheritsLoose(y,q);y.prototype.getTransferList=function(f){const w=[f.geometryBuffer];b.isSome(f.primaryAttributeData)&&f.primaryAttributeData.buffer&&w.push(f.primaryAttributeData.buffer);
b.isSome(f.modulationAttributeData)&&f.modulationAttributeData.buffer&&w.push(f.modulationAttributeData.buffer);if(b.isSome(f.filterAttributesData))for(const e of f.filterAttributesData)b.isSome(e)&&e.buffer&&w.push(e.buffer);for(const e of f.userAttributesData)e.buffer&&w.push(e.buffer);return w};return y}(r.WorkerHandle);a.PointCloudWorkerHandle=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf32 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../rest/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M){function H(va){return va&&parseInt(va.substring(va.lastIndexOf("/")+1,va.length),10)}function J(va,ma){var ta=ma[0],Ea=ma[1];ma=ma[3];const Ca=va[0]-ta;ta-=va[2];const ka=va[1]-Ea;va=Ea-va[3];Ea=Math.max(Ca,ta,0);const sa=Math.max(ka,va,0);Ea=Ea*Ea+sa*sa;return Ea>ma*ma?0:0<Ea?1:-Math.max(Ca,ta,ka,va)>ma?3:2}function O(va,ma,ta){const Ea=[],Ca=ta&&ta.missingFields;ta=ta&&ta.originalFields;for(const ka of va){va=ka.toLowerCase();
let sa=!1;for(const Ja of ma)if(va===Ja.name.toLowerCase()){Ea.push(Ja.name);sa=!0;ta&&ta.push(ka);break}!sa&&Ca&&Ca.push(ka)}return Ea}function I(){I=p._asyncToGenerator(function*(va,ma,ta,Ea,Ca){if(0===ma.length)return[];const ka=va.attributeStorageInfo;if(f.isSome(va.associatedLayer))try{return yield L(va.associatedLayer,ma,ta,Ea)}catch(sa){if(va.associatedLayer.loaded)throw sa;}if(ka){ma=F(ma,ta,Ca);if(f.isNone(ma))throw new q("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");
const sa=va.parsedUrl.path;va=yield Promise.all(ma.map(Ja=>S(sa,ka,Ja.node,Ja.indices,Ea).then(Ta=>{for(let da=0;da<Ja.graphics.length;da++){const qa=Ja.graphics[da],ra=Ta[da];if(qa.attributes)for(const Da in qa.attributes)Da in ra||(ra[Da]=qa.attributes[Da]);qa.attributes=ra}return Ja.graphics})));return r.flatten(va)}throw new q("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available");});return I.apply(this,arguments)}function F(va,ma,ta){const Ea=new Map,
Ca=[];ta=ta();for(const Ja of va){var ka=Ja.attributes[ma];for(var sa=0;sa<ta.length;sa++){va=ta[sa];const Ta=va.featureIds.indexOf(ka);if(0<=Ta){ka=Ea.get(va.node);ka||(ka={node:va.node,indices:[],graphics:[]},Ca.push(ka),Ea.set(va.node,ka));ka.indices.push(Ta);for(ka.graphics.push(Ja);0<sa;sa--)ta[sa]=ta[sa-1];ta[0]=va;break}}}return Ca}function L(va,ma,ta,Ea){return N.apply(this,arguments)}function N(){N=p._asyncToGenerator(function*(va,ma,ta,Ea){ma.sort((sa,Ja)=>sa.attributes[ta]-Ja.attributes[ta]);
var Ca=ma.map(sa=>sa.attributes[ta]);const ka=[];Ea=O(Ea,va.fields,{originalFields:ka});va=yield R(va,Ca,Ea);for(Ca=0;Ca<ma.length;Ca++){const sa=ma[Ca],Ja=va[Ca],Ta={};if(sa.attributes)for(const da in sa.attributes)Ta[da]=sa.attributes[da];for(let da=0;da<ka.length;da++)Ta[ka[da]]=Ja[Ea[da]];sa.attributes=Ta}return ma});return N.apply(this,arguments)}function R(va,ma,ta){var Ea=va.capabilities.query.maxRecordCount;if(null!=Ea&&ma.length>Ea)return Ea=r.splitIntoChunks(ma,Ea),Promise.all(Ea.map(Ca=>
R(va,Ca,ta))).then(r.flatten);Ea=new B({objectIds:ma,outFields:ta,orderByFields:[va.objectIdField]});return va.queryFeatures(Ea).then(Ca=>{if(Ca&&Ca.features&&Ca.features.length===ma.length)return Ca.features.map(ka=>ka.attributes);throw new q("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function S(va,ma,ta,Ea,Ca){const ka=[];for(const sa of ma)sa&&-1!==Ca.indexOf(sa.name)&&ka.push({url:`${va}/nodes/${ta.resources.attributes}/attributes/${sa.key}/0`,
storageInfo:sa});return w.eachAlways(ka.map(sa=>b(sa.url,{responseType:"array-buffer"}).then(Ja=>D.readBinaryAttribute(sa.storageInfo,Ja.data)))).then(sa=>{const Ja=[];for(const Ta of Ea){const da={};for(let qa=0;qa<sa.length;qa++)null!=sa[qa].value&&(da[ka[qa].storageInfo.name]=P(sa[qa].value,Ta));Ja.push(da)}return Ja})}function P(va,ma){if(!va)return null;ma=va[ma];return e.isInt16Array(va)?-32768===ma?null:ma:e.isInt32Array(va)?ma===W?null:ma:ma!==ma?null:ma}function Q(va){var ma=va.store.indexCRS||
va.store.geographicCRS;const ta=void 0===ma?va.store.indexWKT:void 0;if(ta)if(va.spatialReference){if(ta!==va.spatialReference.wkt)throw new q("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new q("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});ma=ma?new v(H(ma)):va.spatialReference;
return ma.equals(va.spatialReference)?va.spatialReference:ma}function V(va){var ma=va.store.vertexCRS||va.store.projectedCRS;const ta=void 0===ma?va.store.vertexWKT:void 0;if(ta)if(va.spatialReference){if(ta!==va.spatialReference.wkt)throw new q("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new q("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference",
"Found vertexWKT in the scene layer store but no layer spatial reference",{});ma=ma?new v(H(ma)):va.spatialReference;return ma.equals(va.spatialReference)?va.spatialReference:ma}function ca(va,ma,ta){if(!z.canProjectWithoutEngine(va,ma))throw new q("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===ta&&!ba(va,ma))throw new q("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",
{});}function ba(va,ma){return va.equals(ma)||va.isWGS84&&ma.isWebMercator}function Z(va,ma,ta){const Ea=Q(va);va=V(va);ca(Ea,ma,ta);ca(va,ma,ta)}function ha(va,ma,ta,Ea,Ca=0){if(Ea===k.getSphericalPCPF(Ea))if(ma.isGeographic){Ea=k.getReferenceEllipsoid(ma);var ka=1+Math.max(0,Ca)/(Ea.radius+va.center[2]);h.set(ta.center,va.center[0],va.center[1],va.center[2]+Ca);z.projectBuffer(ta.center,ma,0,ta.center,k.getSphericalPCPF(ma),0,1);u.copy(ta.quaternion,va.quaternion);u.conjugate(pa,va.quaternion);
h.set(Ma,0,0,1);h.transformQuat(Ma,Ma,pa);h.set(Ma,va.halfSize[0]*Math.abs(Ma[0]),va.halfSize[1]*Math.abs(Ma[1]),va.halfSize[2]*Math.abs(Ma[2]));h.scale(Ma,Ma,Ea.inverseFlattening);h.add(ta.halfSize,va.halfSize,Ma);h.scale(ta.halfSize,ta.halfSize,ka)}else{M.corners(va,ua);h.set(ta.center,va.center[0],va.center[1],va.center[2]+Ca);z.computeTranslationToOriginAndRotation(ma,ta.center,la,k.getSphericalPCPF(ma));h.set(ta.center,la[12],la[13],la[14]);Ea=2*Math.sqrt(1+la[0]+la[5]+la[10]);pa[0]=(la[6]-la[9])/
Ea;pa[1]=(la[8]-la[2])/Ea;pa[2]=(la[1]-la[4])/Ea;pa[3]=.25*Ea;u.multiply(ta.quaternion,pa,va.quaternion);u.conjugate(pa,ta.quaternion);var sa=Ea=va=0;for(ka of ua)ka[2]+=Ca,z.projectBuffer(ka,ma,0,ka,k.getSphericalPCPF(ma),0,1),h.sub(Ma,ka,ta.center),h.transformQuat(Ma,Ma,pa),va=Math.max(va,Math.abs(Ma[0])),Ea=Math.max(Ea,Math.abs(Ma[1])),sa=Math.max(sa,Math.abs(Ma[2]));h.set(ta.halfSize,va,Ea,sa)}else if(ma.isWGS84&&(Ea.isWebMercator||A.isPlateCarree(Ea))){ka=l.fromQuat(ia,va.quaternion);h.copy(ea,
va.center);ea[2]+=Ca;Ca=k.getSphericalPCPF(Ea);z.projectBuffer(ea,ma,0,ea,Ca,0,1);for(ma=0;8>ma;++ma){for(sa=0;3>sa;++sa)Y[sa]=va.halfSize[sa]*(0!==(ma&1<<sa)?-1:1);for(sa=0;3>sa;++sa){let Ja=ea[sa];for(let Ta=0;3>Ta;++Ta)Ja+=Y[Ta]*ka[3*Ta+sa];X[3*ma+sa]=Ja}}z.projectBuffer(X,Ca,0,X,Ea,0,8);M.compute(T,ta)}else va===ta?(ta.center[2]+=Ca,z.projectBuffer(ta.center,ma,0,ta.center,Ea,0,1)):(h.set(ta.center,va.center[0],va.center[1],va.center[2]+Ca),z.projectBuffer(ta.center,ma,0,ta.center,Ea,0,1),u.copy(ta.quaternion,
va.quaternion),h.copy(ta.halfSize,va.halfSize))}const fa=x.create(),aa=n.create(),W=-(2**31);n=G.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let U=function(){this.material=this.edgeMaterial=null;this.castShadows=!0};const X=new Float64Array(24),T={data:X,size:3},Y=m.create(),ea=m.create(),ia=g.create(),la=c.create(),pa=t.create(),ua=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],wa=C.create(),Fa=C.create(),La=M.create(),Ma=[0,0,0],Sa={data:Array(72),size:3},Ia=c.create();
a.SymbolInfo=U;a.addWraparound=function(va,ma){return(va|0)+(ma|0)|0};a.checkPointCloudLayerCompatibleWithView=function(va,ma){ca(va.spatialReference,ma.spatialReference,ma.viewingMode)};a.checkPointCloudLayerValid=function(va){var ma;(ma=null==va.store||null==va.store.defaultGeometrySchema)||(va=va.store.defaultGeometrySchema,ma=!!(null==va.geometryType||"points"!==va.geometryType||null!=va.topology&&"PerAttributeArray"!==va.topology||null!=va.encoding&&""!==va.encoding&&"lepcc-xyz"!==va.encoding||
null==va.vertexAttributes||null==va.vertexAttributes.position));if(ma)throw new q("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkSceneLayerCompatibleWithView=function(va,ma){Z(va,ma.spatialReference,ma.viewingMode)};a.checkSceneLayerValid=function(va){var ma;(ma=null==va.store||null==va.store.defaultGeometrySchema)||(ma=va.store.defaultGeometrySchema,ma=!!(null!=ma.geometryType&&"triangles"!==ma.geometryType||null!=ma.topology&&
"PerAttributeArray"!==ma.topology||null==ma.vertexAttributes||null==ma.vertexAttributes.position));if(ma)throw new q("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:va.parsedUrl.path});};a.checkSpatialReference=ca;a.checkSpatialReferences=Z;a.computeVisibilityObb=function(va,ma,ta,Ea,Ca,ka){if(!ka||0===ka.length||f.isNone(ma))return null;const sa=E.computeGlobalTransformation(va.mbs,Ca,ta,ma);d.invert(Ia,sa);let Ja;const Ta=()=>{if(!Ja)if(Ja=
ua,C.empty(Fa),f.isSome(va.serviceObb)){ha(va.serviceObb,ta,La,ma,Ca);M.corners(La,Ja);for(var Da of Ja)h.transformMat4(Da,Da,Ia),C.expandPointInPlace(Fa,Da)}else{var Pa=va.mbs;Da=Pa[3];z.projectVectorToVector(Pa,ta,Ma,ma);h.transformMat4(Ma,Ma,Ia);Ma[2]+=Ca;for(Pa=0;8>Pa;++Pa){const Qa=Ja[Pa];h.copy(Qa,[Ma[0]+(Pa&1?Da:-Da),Ma[1]+(Pa&2?Da:-Da),Ma[2]+(Pa&4?Da:-Da)]);C.expandPointInPlace(Fa,Qa)}}};let da=Infinity,qa=-Infinity;const ra=Da=>{if("replace"===Da.type&&(Da=Da.geometry,Da.hasZ)){C.empty(wa);
var Pa=Da.spatialReference||Ea;Da=Da.rings.reduce((Qa,na)=>na.reduce((Aa,Ra)=>{z.projectVectorToVector(Ra,Pa,Ma,ma);h.transformMat4(Ma,Ma,Ia);C.expandPointInPlace(wa,Ma);return Math.min(Ma[2],Aa)},Qa),Infinity);Ta();C.intersects(Fa,wa)&&(da=Math.min(da,Da),qa=Math.max(qa,Da))}};ka.forEach(Da=>ra(Da));if(Infinity===da)return null;ka=(Da,Pa,Qa)=>{h.transformMat4(Ma,Qa,sa);Da[Pa+0]=Ma[0];Da[Pa+1]=Ma[1];Da[Pa+2]=Ma[2];Pa+=24;Qa[2]=da;h.transformMat4(Ma,Qa,sa);Da[Pa+0]=Ma[0];Da[Pa+1]=Ma[1];Da[Pa+2]=Ma[2];
Pa+=24;Qa[2]=qa;h.transformMat4(Ma,Qa,sa);Da[Pa+0]=Ma[0];Da[Pa+1]=Ma[1];Da[Pa+2]=Ma[2]};for(let Da=0;8>Da;++Da)ka(Sa.data,3*Da,Ja[Da]);return M.compute(Sa)};a.containsDraco=function(va){if(y("disable-feature:i3s-draco")||!va)return!1;for(const ta of va)for(const Ea of ta.geometryBuffers){var ma;if("draco"===(null==(ma=Ea.compressedAttributes)?void 0:ma.encoding))return!0}return!1};a.extractWkid=H;a.filterInPlace=function(va,ma,ta){let Ea=0,Ca=0;for(let ka=0;ka<ma.length&&Ea<va.length;ka++)va[Ea]===
ma[ka]&&(ta(ka)&&(va[Ca]=va[Ea],Ca++),Ea++);va.length=Ca};a.findFieldsCaseInsensitive=O;a.findIntersectingNodes=function(va,ma,ta,Ea,Ca,ka){Ca.traverse(ta,sa=>{var Ja=sa.mbs;ma!==Ea&&(Ja=aa,z.projectBoundingSphere(sa.mbs,Ea,Ja,ma));Ja=J(va,Ja);if(0===Ja)return!1;ka(sa,Ja);return!0})};a.getCacheKeySuffix=function(va,ma){return f.isNone(ma)?"@null":ma===k.getSphericalPCPF(ma)?"@ECEF":va.equals(ma)?"":null!=ma.wkid?"@"+ma.wkid:null};a.getCachedAttributeValue=P;a.getClipAABB=function(va,ma){if(0===ma.rotationScale[1]&&
0===ma.rotationScale[2]&&0===ma.rotationScale[3]&&0===ma.rotationScale[5]&&0===ma.rotationScale[6]&&0===ma.rotationScale[7])return fa[0]=(va[0]-ma.position[0])/ma.rotationScale[0],fa[1]=(va[1]-ma.position[1])/ma.rotationScale[4],fa[2]=(va[2]-ma.position[2])/ma.rotationScale[8],fa[3]=(va[3]-ma.position[0])/ma.rotationScale[0],fa[4]=(va[4]-ma.position[1])/ma.rotationScale[4],fa[5]=(va[5]-ma.position[2])/ma.rotationScale[8],fa};a.getIndexCrs=Q;a.getSymbolInfo=function(va){const ma=new U;var ta=!1;let Ea=
!1;for(const ka of va.symbolLayers.items)if("fill"===ka.type&&ka.enabled){var Ca=ka.material;va=ka.edges;f.isSome(Ca)&&!ta&&(ta=Ca.color,Ca=K.parseColorMixMode(Ca.colorMixMode),f.isSome(ta)?ma.material={color:[ta.r/255,ta.g/255,ta.b/255],alpha:ta.a,colorMixMode:Ca}:ma.material={color:[1,1,1],alpha:1,colorMixMode:1},ma.castShadows=ka.castShadows,ta=!0);f.isSome(va)&&!Ea&&(ma.edgeMaterial=G.createMaterialFromEdges(va,{}),Ea=!0)}ma.material||(ma.material={color:[1,1,1],alpha:1,colorMixMode:1});return ma};
a.getVertexCrs=V;a.intersectBoundingBoxWithMbs=function(va,ma){var ta=ma[0],Ea=ma[1],Ca=ma[2];ma=ma[3];const ka=va[0]-ta;ta-=va[3];const sa=va[1]-Ea;Ea-=va[4];const Ja=va[2]-Ca;va=Ca-va[5];Ca=Math.max(ka,ta,0);const Ta=Math.max(sa,Ea,0),da=Math.max(Ja,va,0);Ca=Ca*Ca+Ta*Ta+da*da;return Ca>ma*ma?0:0<Ca?1:-Math.max(ka,ta,sa,Ea,Ja,va)>ma?3:2};a.intersectBoundingRectWithMbs=J;a.isSupportedLocalModeProjection=ba;a.objectIdFilter=function(va,ma,ta){let Ea=0,Ca=0;for(;Ea<ta.length;)0<=r.binaryIndexOf(va,
ta[Ea])===ma&&(ta[Ca]=ta[Ea],Ca++),Ea++;ta.length=Ca};a.rendererNeedsTextures=function(va){if(null==va||"simple"!==va.type&&"class-breaks"!==va.type&&"unique-value"!==va.type||("unique-value"===va.type||"class-breaks"===va.type)&&null==va.defaultSymbol)return!0;va=va.getSymbols();if(0===va.length)return!0;for(const ma of va){if("mesh-3d"!==ma.type||0===ma.symbolLayers.length)return!0;for(const ta of ma.symbolLayers.items)if("fill"!==ta.type||f.isNone(ta.material)||f.isNone(ta.material.color)||"replace"!==
ta.material.colorMixMode)return!0}return!1};a.transformObb=ha;a.transparentEdgeMaterial=n;a.whenGraphicAttributes=function(va,ma,ta,Ea,Ca){return I.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define(["exports","../../../../core/Error","../../../../core/lang","../../../../core/Logger","./LEPCC"],function(a,p,b,r,q){function y(x,C,A){let B="",D=0;for(;D<A;){var E=x[C+D];if(128>E)B+=String.fromCharCode(E),D++;else if(192<=
E&&224>E){if(D+1>=A)throw new p("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");B+=String.fromCharCode((E&31)<<6|x[C+D+1]&63);D+=2}else if(224<=E&&240>E){if(D+2>=A)throw new p("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");B+=String.fromCharCode((E&15)<<12|(x[C+D+1]&63)<<6|x[C+D+2]&63);D+=3}else if(240<=E&&248>E){if(D+3>=A)throw new p("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");E=(E&7)<<18|(x[C+D+1]&
63)<<12|(x[C+D+2]&63)<<6|x[C+D+3]&63;B=65536<=E?B+String.fromCharCode((E-65536>>10)+55296,(E&1023)+56320):B+String.fromCharCode(E);D+=4}else throw new p("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return B}function f(x,C){const A={byteOffset:0,byteCount:0,fields:Object.create(null)};let B=0;for(let D=0;D<C.length;D++){const E=C[D],G=E.valueType||E.type;A.fields[E.property]=(0,v[G])(x,B);B+=k[G].BYTES_PER_ELEMENT}A.byteCount=B;return A}function w(x,C,A){const B=[];let D,
E=0,G;for(G=0;G<x;G+=1){D=C[G];if(0<D){if(B.push(y(A,E,D-1)),0!==A[E+D-1])throw new p("string-array-error","Invalid string array: missing null termination.");}else B.push(null);E+=D}return B}function e(x,C){return new k[C.valueType](x,C.byteOffset,C.count*C.valuesPerElement)}function l(x,C){return new Uint8Array(x,C.byteOffset,C.byteCount)}function g(x,C,A){x=null!=C.header?f(x,C.header):{byteOffset:0,byteCount:0,fields:{count:A}};A={header:x,byteOffset:x.byteCount,byteCount:0,entries:Object.create(null)};
let B=x.byteCount;for(let D=0;D<C.ordering.length;D++){const E=C.ordering[D],G=b.clone(C[E]);G.count=x.fields.count;if("String"===G.valueType){if(G.byteOffset=B,G.byteCount=x.fields[E+"ByteCount"],"UTF-8"!==G.encoding)throw new p("unsupported-encoding","Unsupported String encoding.",{encoding:G.encoding});}else if(h(G.valueType)){const K=m(G.valueType);B+=0!==B%K?K-B%K:0;G.byteOffset=B;G.byteCount=K*G.valuesPerElement*G.count}else throw new p("unsupported-value-type","Unsupported binary valueType",
{valueType:G.valueType});B+=G.byteCount;A.entries[E]=G}A.byteCount=B-A.byteOffset;return A}function d(x,C,A){C!==x&&n.error(`Invalid ${A} buffer size\n expected: ${x}, actual: ${C})`);if(C<x)throw new p("buffer-too-small","Binary buffer is too small",{expectedSize:x,actualSize:C});}function c(x){return{isDraco:!1,isLegacy:!1,color:null!=x.color,normal:null!=x.normal,uv0:null!=x.uv0,uvRegion:null!=x.uvRegion,featureIndex:null!=x.faceRange&&null!=x.featureId}}function u(x){const C={isDraco:!1,isLegacy:!0,
color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const A of x.ordering)if(x.vertexAttributes[A])switch(A){case "normal":C.normal=!0;break;case "color":C.color=!0;break;case "uv0":C.uv0=!0;break;case "region":C.uvRegion=!0}x.featureAttributes&&x.featureAttributeOrder&&(C.featureIndex=!0);return C}function t(x){const C={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const A of x)switch(A){case "normal":C.normal=!0;break;case "uv0":C.uv0=!0;break;case "color":C.color=
!0;break;case "uv-region":C.uvRegion=!0;break;case "feature-index":C.featureIndex=!0}return C}function h(x){return k.hasOwnProperty(x)}function m(x){return h(x)?k[x].BYTES_PER_ELEMENT:0}const n=r.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),z={position:"position",normal:"normal",color:"color",uv0:"uv0",region:"uvRegion"},k={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},v={Float32:(x,C)=>(new DataView(x,
0)).getFloat32(C,!0),Float64:(x,C)=>(new DataView(x,0)).getFloat64(C,!0),UInt8:(x,C)=>(new DataView(x,0)).getUint8(C),Int8:(x,C)=>(new DataView(x,0)).getInt8(C),UInt16:(x,C)=>(new DataView(x,0)).getUint16(C,!0),Int16:(x,C)=>(new DataView(x,0)).getInt16(C,!0),UInt32:(x,C)=>(new DataView(x,0)).getUint32(C,!0),Int32:(x,C)=>(new DataView(x,0)).getInt32(C,!0)};a.createAttributeDataIndex=g;a.createGeometryDescriptor=function(x,C){return x&&x.compressedAttributes&&"draco"===x.compressedAttributes.encoding?
t(x.compressedAttributes.attributes):x?c(x):u(C)};a.createGeometryDescriptorForDraco=t;a.createGeometryDescriptorFromDefinition=c;a.createGeometryDescriptorFromSchema=u;a.createGeometryIndexFromSchema=function(x,C){var A=f(x,C&&C.header);let B=A.byteCount;const D={isDraco:!1,header:A,byteOffset:A.byteCount,byteCount:0,vertexAttributes:{}};A=A.fields;var E=null!=A.vertexCount?A.vertexCount:A.count;for(var G of C.ordering){if(!C.vertexAttributes[G])continue;const M={...C.vertexAttributes[G],byteOffset:B,
count:E};D.vertexAttributes[z[G]?z[G]:"_"+G]=M;B+=m(M.valueType)*M.valuesPerElement*E}G=A.faceCount;if(C.faces&&G){D.faces={};for(var K of C.ordering)C.faces[K]&&(E={...C.faces[K],byteOffset:B,count:G},D.faces[K]=E,B+=m(E.valueType)*E.valuesPerElement*G)}K=A.featureCount;if(C.featureAttributes&&C.featureAttributeOrder&&K){D.featureAttributes={};for(const M of C.featureAttributeOrder)C.featureAttributes[M]&&(A={...C.featureAttributes[M],byteOffset:B,count:K},D.featureAttributes[M]=A,G="UInt64"===A.valueType?
8:m(A.valueType),B+=G*A.valuesPerElement*K)}d(B,x.byteLength,"geometry");D.byteCount=B-D.byteOffset;return D};a.createRawView=l;a.createTypedView=e;a.getBytesPerValue=m;a.isValueType=h;a.readBinaryAttribute=function(x,C,A){if("lepcc-rgb"===x.encoding)return q.decodeRGB(C);if("lepcc-intensity"===x.encoding)return q.decodeIntensity(C);if(null!=x.encoding&&""!==x.encoding)throw new p("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");x["attributeByteCounts "]&&!x.attributeByteCounts&&
(n.warn("Warning: Trailing space in 'attributeByteCounts '."),x.attributeByteCounts=x["attributeByteCounts "]);"ObjectIds"===x.ordering[0]&&x.hasOwnProperty("objectIds")&&(n.warn("Warning: Case error in objectIds"),x.ordering[0]="objectIds");A=g(C,x,A);d(A.byteOffset+A.byteCount,C.byteLength,"attribute");if(x=A.entries.attributeValues||A.entries.objectIds){if("String"===x.valueType){A=A.entries.attributeByteCounts;const B=e(C,A);C=l(C,x);return w(A.count,B,C)}return e(C,x)}throw new p("bad-attribute-storage-info",
"Bad attributeStorageInfo specification.");};a.readHeader=f;a.readStringArray=w;a.valueType2ArrayBufferReader=v;a.valueType2TypedArrayClassMap=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,p){function b(f,w,e){return{identifier:String.fromCharCode.apply(null,new Uint8Array(f,e+y.identifierOffset,y.identifierLength)),version:w.getUint16(e+y.versionOffset,!0),checksum:w.getUint32(e+y.checksumOffset,
!0)}}function r(f,w,e){const l=[];w=q(f,w,l);const g=[];for(let d=0;d<l.length;d++){g.length=0;w=q(f,w,g);for(let c=0;c<g.length;c++)e.push(g[c]+l[d])}return w}function q(f,w,e){var l=new DataView(f,w),g=l.getUint8(0);const d=g&31;var c=!!(g&32),u=(g&192)>>6;g=0;if(0===u)g=l.getUint32(1,!0),w+=5;else if(1===u)g=l.getUint16(1,!0),w+=3;else if(2===u)g=l.getUint8(1),w+=2;else throw new p("lepcc-decode-error","Bad count type");if(c)throw new p("lepcc-decode-error","LUT not implemented");f=new Uint8Array(f,
w,Math.ceil(g*d/8));u=c=l=0;const t=-1>>>32-d;for(let h=0;h<g;h++){for(;c<d;)l|=f[u]<<c,c+=8,u+=1;e[h]=l&t;l>>>=d;c-=d;32<c+d&&(l|=f[u-1]>>8-c)}return w+u}const y={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(f){const w=new DataView(f,0);var e=0;const {identifier:l,version:g}=b(f,w,e);e+=y.byteCount;if("Intensity "!==l)throw new p("lepcc-decode-error","Bad identifier");if(1<g)throw new p("lepcc-decode-error","Unknown version");
var d=e;var c=w.getUint32(d+0,!0);var u=w.getUint32(d+4,!0);var t=w.getUint32(d+8,!0);var h=w.getUint16(d+12,!0);var m=w.getUint8(d+14);w.getUint8(d+15);e+=16;if(u*2**32+c!==f.byteLength)throw new p("lepcc-decode-error","Bad size");c=new Uint16Array(t);if(8===m){if(t+e!==f.byteLength)throw new p("lepcc-decode-error","Bad size");f=new Uint8Array(f,e,t);for(e=0;e<t;e++)c[e]=f[e]*h}else if(16===m){if(2*t+e!==f.byteLength)throw new p("lepcc-decode-error","Bad size");f=new Uint16Array(f,e,t);for(e=0;e<
t;e++)c[e]=f[e]*h}else{m=[];if(q(f,e,m)!==f.byteLength)throw new p("lepcc-decode-error","Bad size");for(f=0;f<t;f++)c[f]=m[f]*h}return c};a.decodeRGB=function(f){var w=new DataView(f,0),e=0;const {identifier:l,version:g}=b(f,w,e);e+=y.byteCount;if("ClusterRGB"!==l)throw new p("lepcc-decode-error","Bad identifier");if(1<g)throw new p("lepcc-decode-error","Unknown version");var d=e;var c=w.getUint32(d+0,!0);var u=w.getUint32(d+4,!0);var t=w.getUint32(d+8,!0);var h=w.getUint16(d+12,!0);var m=w.getUint8(d+
14);d=w.getUint8(d+15);e+=16;if(u*2**32+c!==f.byteLength)throw new p("lepcc-decode-error","Bad size");if((2===m||1===m)&&0===d){if(3*h+t+e!==f.byteLength||256<h)throw new p("lepcc-decode-error","Bad count");w=new Uint8Array(f,e,3*h);e=new Uint8Array(f,e+3*h,t);f=new Uint8Array(3*t);for(h=0;h<t;h++)c=e[h],f[3*h]=w[3*c],f[3*h+1]=w[3*c+1],f[3*h+2]=w[3*c+2];return f}if(0===m&&0===d){if(3*t+e!==f.byteLength||0!==h)throw new p("lepcc-decode-error","Bad count");return(new Uint8Array(f,e)).slice()}if(2>=
m&&1===d){if(e+3!==f.byteLength||1!==h)throw new p("lepcc-decode-error","Bad count");f=w.getUint8(e);h=w.getUint8(e+1);e=w.getUint8(e+2);w=new Uint8Array(3*t);for(c=0;c<t;c++)w[3*c]=f,w[3*c+1]=h,w[3*c+2]=e;return w}throw new p("lepcc-decode-error","Bad method "+m+","+d);};a.decodeXYZ=function(f){var w=new DataView(f,0),e=0;const {identifier:l,version:g}=b(f,w,e);e+=y.byteCount;if("LEPCC     "!==l)throw new p("lepcc-decode-error","Bad identifier");if(1<g)throw new p("lepcc-decode-error","Unknown version");
var d=e;var c=w.getUint32(d+0,!0);var u=w.getUint32(d+4,!0);var t=w.getFloat64(d+8,!0);var h=w.getFloat64(d+16,!0);var m=w.getFloat64(d+24,!0);var n=w.getFloat64(d+32,!0);var z=w.getFloat64(d+40,!0);var k=w.getFloat64(d+48,!0);var v=w.getFloat64(d+56,!0);var x=w.getFloat64(d+64,!0);var C=w.getFloat64(d+72,!0);var A=w.getUint32(d+80,!0);w.getUint32(d+84,!0);e+=88;if(u*2**32+c!==f.byteLength)throw new p("lepcc-decode-error","Bad size");c=new Float64Array(3*A);u=[];A=[];w=[];d=[];e=r(f,e,u);e=r(f,e,
A);e=r(f,e,w);e=r(f,e,d);if(e!==f.byteLength)throw new p("lepcc-decode-error","Bad length");e=f=0;for(let B=0;B<u.length;B++){e+=u[B];let D=0;for(let E=0;E<A[B];E++){D+=w[f];const G=d[f];c[3*f]=Math.min(n,t+2*v*D);c[3*f+1]=Math.min(z,h+2*x*e);c[3*f+2]=Math.min(k,m+2*C*G);f++}}return{errorX:v,errorY:x,errorZ:C,result:c}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec3f64",
"../../../../geometry/projection","../../../../geometry/projectionEllipsoid"],function(a,p,b,r,q){function y(f,w,e){const l=b.create(),g=2**(4*Math.ceil(Math.log(f[3])*Math.LOG2E/4)+1);if(e.isGeographic){var d=g/q.getReferenceEllipsoid(e).radius*180/Math.PI;e=Math.max(-90,Math.min(90,Math.round(f[1]/d)*d));d/=Math.cos((Math.abs(e)-d/2)/180*Math.PI);l[0]=Math.round(f[0]/d)*d;l[1]=e}else e=Math.round(f[1]/g),l[0]=Math.round(f[0]/g)*g,l[1]=e*g;l[2]=Math.round((f[2]+w)/g)*g;return l}a.computeGlobalTransformation=
function(f,w,e,l){f=y(f,w,e);w=p.create();r.computeTranslationToOriginAndRotation(e,f,w,l);return w};a.getLocalOrigin=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],function(a,p){function b(e,l,g){for(;0<e;){const d=l.indexOf(e);if(0<=d)return d;e=g.getParentId(e)}return l.indexOf(e)}function r(e,l,g){const d=[l.remove[0]],c=[];for(;1===d.length;){const t=d.pop();c.length=0;for(let h=0;h<l.load.length;h++){let m=
l.load[h];for(var u=g.getParentId(m);u!==t;)m=u,u=g.getParentId(m);u=d.indexOf(m);0>u&&(u=d.length,d.push(m),c.push([]));c[u].push(l.load[h])}}l.load=d;for(l=0;l<d.length;l++)1<c[l].length?e.push({remove:[d[l]],load:c[l]}):d[l]=c[l][0]}const q=[!1],y=[null],f=[!1],w=[null];a.nodeDiff=function(e,l,g){for(var d=0;d<l.length;d++)f[d]=!1,w[d]=null;for(d=0;d<e.length;d++)q[d]=!1,y[d]=null;for(d=0;d<l.length;d++){var c=b(l[d],e,g);0<=c&&(f[d]=!0,null!=y[c]?y[c].push(l[d]):y[c]=[l[d]])}for(d=0;d<e.length;d++)c=
b(e[d],l,g),0<=c&&(q[d]=!0,null!=w[c]?w[c].push(e[d]):w[c]=[e[d]]);g=[];for(d=0;d<e.length;d++)null!=y[d]||q[d]||g.push({load:[],remove:[e[d]]});for(d=0;d<l.length;d++)null!=w[d]||f[d]||g.push({load:[l[d]],remove:[]});for(d=0;d<l.length;d++)null!=w[d]&&(1<w[d].length||w[d][0]!==l[d])&&g.push({load:[l[d]],remove:w[d]});for(l=0;l<e.length;l++)null!=y[l]&&(1<y[l].length||y[l][0]!==e[l])&&g.push({load:y[l],remove:[e[l]]});return g};a.sortFrontToBack=function(e,l,g){return e.sort((d,c)=>{if(0===d.load.length&&
0===c.load.length)return 0;if(0===d.load.length)return-1;if(0===c.load.length)return 1;if(0===d.remove.length&&0===c.remove.length)return d=g.getRenderCenter(d.load[0]),c=g.getRenderCenter(c.load[0]),p.dot(d,l)-p.dot(c,l);if(0===d.remove.length)return-1;if(0===c.remove.length)return 1;if(1===d.load.length&&1===c.load.length)return d=g.getRenderCenter(d.load[0]),c=g.getRenderCenter(c.load[0]),p.dot(d,l)-p.dot(c,l);if(1===d.load.length)return-1;if(1===c.load.length)return 1;d=g.getRenderCenter(d.remove[0]);
c=g.getRenderCenter(c.remove[0]);return p.dot(d,l)-p.dot(c,l)})};a.splitWorkEntries=function(e,l,g){for(let d=0;d<e.length;++d){const c=e[d];c.load.length>l&&1===c.remove.length&&r(e,c,g)}};a.splitWorkEntry=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(a,p,b){return function(){function r(y,f,w){this._pages=[];this.pageSize=0;this._renderSR=
this._nodeSR=null;this._nodeSR=y;this._renderSR=f;this.pageSize=w}var q=r.prototype;q.addPage=function(y,f,w=0){for(;this._pages.length<y;)this._pages.push(null);var e=this._nodeSR,l=this._renderSR,g=new b.ObbArray(f.length);for(var d=0;d<f.length;d++)p.transformObb(f[d].obb,e,g.obbs[d],l,w);w=g.obbs;this._pages[y]={nodes:f,renderObbs:w,parents:new Uint32Array(this.pageSize)};y=this._pages;f=this.pageSize;for(w=[0];w.length;)for(e=w.pop(),l=y[e/f|0].nodes[e%f],g=0;g<l.childCount;g++)d=l.firstChild+
g,null!=y[d/f|0]&&(y[d/f|0].parents[d%f]=e,w.push(d))};q.hasPage=function(y){return!!this._pages[y]};q.getNode=function(y){const f=this.pageSize;return this._pages[y/f|0].nodes[y%f]};q.getRenderObb=function(y){const f=this.pageSize;return this._pages[y/f|0].renderObbs[y%f]};q.getRenderCenter=function(y){return this.getRenderObb(y).center};q.setRenderObb=function(y,f){const w=this.pageSize;b.set(f,this._pages[y/w|0].renderObbs[y%w])};q.getParentId=function(y){const f=this.pageSize;return this._pages[y/
f|0].parents[y%f]};q.hasNodes=function(y,f){var w=y/this.pageSize|0;for(y=(y+f-1)/this.pageSize|0;w<=y;w++)if(null==this._pages[w])return!1;return!0};q.forEachNodeId=function(y){for(let f=0;f<this._pages.length;f++){const w=this._pages[f];if(w)for(let e=0;e<w.nodes.length;e++)y(f*this.pageSize+e)}};q.createVisibilityTraverse=function(){var y=this,f=[],w=[],e=a.create();return(l,g)=>{if(y.hasNodes(0,1))for(f.length=0,f.push(0),w.length=0,w.push(0);0<f.length;){var d=f.pop();let n=w.pop();var c=y.getNode(d),
u=y.getRenderObb(d),t=!0;if(null!=l.clippingBox){var h=1<<l.frustum.length;if(0===(n&h)){var m=b.toAaBoundingBox(u,e);a.contains(l.clippingBox,m)?n|=h:a.intersects(l.clippingBox,m)||(t=!1)}}for(h=0;h<l.frustum.length&&t;h++)if(m=1<<h,0===(n&m)){const z=b.intersectPlane(u,l.frustum[h]);0<z?t=!1:0>z&&(n|=m)}if(g.predicate(d,c,t)){u=c.firstChild;c=c.childCount;t=!1;m=u/y.pageSize|0;for(h=(u+c-1)/y.pageSize|0;m<=h;m++)if(!y.hasPage(m)){g.pageMiss(d,m);t=!0;break}if(!t)for(d=0;d<c;d++)f.push(u+d),w.push(n)}}}};
return r}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function p(r,q){for(const y of r)if(y.name===q&&null!=y.attributeValues&&"UInt8"===y.attributeValues.valueType&&3===y.attributeValues.valuesPerElement)return{name:q,storageInfo:y,useElevation:!1};return null}function b(r,q){for(const y of r)if(y.name===q)return r="embedded-elevation"===y.encoding,{name:q,storageInfo:r?null:y,useElevation:r};return"elevation"===q.toLowerCase()?{name:q,storageInfo:null,
useElevation:!0}:null}a.getAttributeInfo=b;a.getFilterInfo=function(r){const q=r.filters;return q?q.map(y=>({filterJSON:y.toJSON(),attributeInfo:b(r.attributeStorageInfo,y.field)})):[]};a.getFixedSizeAlgorithm=function(r){return(r=r&&r.pointSizeAlgorithm)&&"fixed-size"===r.type?r:null};a.getRendererInfo=function(r){const q=r.renderer;var y=q&&q.type;const f=q&&r.renderer.toJSON()||null;let w=null,e=!1;"point-cloud-unique-value"===y?w=b(r.attributeStorageInfo,q.field):"point-cloud-stretch"===y?w=b(r.attributeStorageInfo,
q.field):"point-cloud-class-breaks"===y?w=b(r.attributeStorageInfo,q.field):(w="point-cloud-rgb"===y?p(r.attributeStorageInfo,q.field):p(r.attributeStorageInfo,"RGB"),e=null!=w);y=null;q&&q.colorModulation&&(y=b(r.attributeStorageInfo,q.colorModulation.field));return{rendererJSON:f,isRGBRenderer:e,primaryAttribute:w,modulationAttribute:y}};a.getSplatSizeAlgorithm=function(r){return(r=r&&r.pointSizeAlgorithm)&&"splat"===r.type?r:null};a.rendererUsesFixedSizes=function(r){return(r=r&&r.pointSizeAlgorithm)&&
r.type?"fixed-size"===r.type:!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),function(a,p,b,r,q,y,f){function w(g,d){const c=new Float64Array(d);for(let u=0;u<d;u++)c[u]=g[3*u+2];return c}function e(g){return null==
g||"none"===g?null:"low-four-bit"===g?d=>d&15:"high-four-bit"===g?d=>(d&240)>>4:"absolute-value"===g?d=>Math.abs(d):"modulo-ten"===g?d=>d%10:null}function l(g){let d=0;for(const c of g?g:[])d|=1<<c;return d}a.elevationFromPositions=w;a.evaluateRenderer=function(g,d,c,u){const {rendererJSON:t,isRGBRenderer:h}=g;var m=g=null;if(d&&h)g=d;else if(d&&"pointCloudUniqueValueRenderer"===t.type){m=q.fromJSON(t);var n=m.colorUniqueValueInfos;g=new Uint8Array(3*u);var z=e(m.fieldTransformType);for(var k=0;k<
u;k++){var v=(z?z(d[k]):d[k])+"";for(var x=0;x<n.length;x++)if(0<=n[x].values.indexOf(v)){g[3*k]=n[x].color.r;g[3*k+1]=n[x].color.g;g[3*k+2]=n[x].color.b;break}}}else if(d&&"pointCloudStretchRenderer"===t.type)for(m=r.fromJSON(t),n=m.stops,g=new Uint8Array(3*u),z=e(m.fieldTransformType),k=0;k<u;k++)if(v=z?z(d[k]):d[k],x=n.length-1,v<n[0].value)g[3*k]=n[0].color.r,g[3*k+1]=n[0].color.g,g[3*k+2]=n[0].color.b;else if(v>=n[x].value)g[3*k]=n[x].color.r,g[3*k+1]=n[x].color.g,g[3*k+2]=n[x].color.b;else for(x=
1;x<n.length;x++){if(v<n[x].value){v=(v-n[x-1].value)/(n[x].value-n[x-1].value);g[3*k]=n[x].color.r*v+n[x-1].color.r*(1-v);g[3*k+1]=n[x].color.g*v+n[x-1].color.g*(1-v);g[3*k+2]=n[x].color.b*v+n[x-1].color.b*(1-v);break}}else if(d&&"pointCloudClassBreaksRenderer"===t.type)for(m=b.fromJSON(t),n=m.colorClassBreakInfos,g=new Uint8Array(3*u),z=e(m.fieldTransformType),k=0;k<u;k++)for(v=z?z(d[k]):d[k],x=0;x<n.length;x++){if(v>=n[x].minValue&&v<=n[x].maxValue){g[3*k]=n[x].color.r;g[3*k+1]=n[x].color.g;g[3*
k+2]=n[x].color.b;break}}else for(g=new Uint8Array(3*u),d=0;d<g.length;d++)g[d]=255;if(c&&m&&m.colorModulation)for(d=m.colorModulation.minValue,m=m.colorModulation.maxValue,n=0;n<u;n++)z=c[n],z=z>=m?1:z<=d?.3:.3+.7*(z-d)/(m-d),g[3*n]*=z,g[3*n+1]*=z,g[3*n+2]*=z;return g};a.filterInPlace=function(g,d,c,u,t){const h=g.length/3;let m=0;for(let C=0;C<h;C++){let A=!0;for(let B=0;B<u.length&&A;B++){var {filterJSON:n}=u[B],z=t[B].values[C];switch(n.type){case "pointCloudValueFilter":var k="exclude"===n.mode;
-1!==n.values.indexOf(z)===k&&(A=!1);break;case "pointCloudBitfieldFilter":k=l(n.requiredSetBits);n=l(n.requiredClearBits);if((z&k)!==k||0!==(z&n))A=!1;break;case "pointCloudReturnFilter":var v=z&15,x=z>>>4&15;z=1<x;k=1===v;v=v===x;x=!1;for(const D of n.includedReturns)if("last"===D&&v||"firstOfMany"===D&&k&&z||"lastOfMany"===D&&v&&z||"single"===D&&!z){x=!0;break}x||(A=!1)}}A&&(c[m]=C,g[3*m]=g[3*C],g[3*m+1]=g[3*C+1],g[3*m+2]=g[3*C+2],d[3*m]=d[3*C],d[3*m+1]=d[3*C+1],d[3*m+2]=d[3*C+2],m++)}return m};
a.getAttributeValues=function(g,d,c){return p.isSome(g)&&g.attributeInfo.useElevation?w(d,c):p.isSome(g)?y.readBinaryAttribute(g.attributeInfo.storageInfo,g.buffer,c):null};a.readGeometry=function(g,d){if(null==g.encoding||""===g.encoding){g=y.createGeometryIndexFromSchema(d,g);if(p.isNone(g.vertexAttributes.position))return;d=y.createTypedView(d,g.vertexAttributes.position);var c=g.header.fields;g=[c.offsetX,c.offsetY,c.offsetZ];c=[c.scaleX,c.scaleY,c.scaleZ];const u=d.length/3,t=new Float64Array(3*
u);for(let h=0;h<u;h++)t[3*h]=d[3*h]*c[0]+g[0],t[3*h+1]=d[3*h+1]*c[1]+g[1],t[3*h+2]=d[3*h+2]*c[2]+g[2];return t}if("lepcc-xyz"===g.encoding)return f.decodeXYZ(d).result};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){var c;q=c=function(u){function t(h){h=u.call(this,h)||this;h.type="point-cloud-class-breaks";h.field=null;h.legendOptions=null;h.fieldTransformType=null;h.colorClassBreakInfos=null;return h}a._inheritsLoose(t,u);t.prototype.clone=function(){return new c({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:b.clone(this.colorClassBreakInfos),legendOptions:b.clone(this.legendOptions)})};return t}(l);p.__decorate([w.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
q.prototype,"type",void 0);p.__decorate([r.property({json:{write:!0},type:String})],q.prototype,"field",void 0);p.__decorate([r.property({type:g["default"],json:{write:!0}})],q.prototype,"legendOptions",void 0);p.__decorate([r.property({type:l.fieldTransformTypeKebabDict.apiValues,json:{type:l.fieldTransformTypeKebabDict.jsonValues,read:l.fieldTransformTypeKebabDict.read,write:l.fieldTransformTypeKebabDict.write}})],q.prototype,"fieldTransformType",void 0);p.__decorate([r.property({type:[d["default"]],
json:{write:!0}})],q.prototype,"colorClassBreakInfos",void 0);return q=c=p.__decorate([e.subclass("esri.renderers.PointCloudClassBreaksRenderer")],q)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){f=b.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});r=function(c){function u(h){h=c.call(this,h)||this;h.type=void 0;h.pointSizeAlgorithm=null;h.colorModulation=null;h.pointsPerInch=10;return h}a._inheritsLoose(u,c);var t=u.prototype;t.clone=function(){console.warn(".clone() is not implemented for "+
this.declaredClass);return null};t.cloneProperties=function(){return{pointSizeAlgorithm:q.clone(this.pointSizeAlgorithm),colorModulation:q.clone(this.colorModulation),pointsPerInch:q.clone(this.pointsPerInch)}};return u}(r.JSONSupport);p.__decorate([y.property({type:f.apiValues,readOnly:!0,nonNullable:!0,json:{type:f.jsonValues,read:!1,write:f.write}})],r.prototype,"type",void 0);p.__decorate([y.property({types:d.pointSizeAlgorithmTypes,json:{write:!0}})],r.prototype,"pointSizeAlgorithm",void 0);
p.__decorate([y.property({type:g["default"],json:{write:!0}})],r.prototype,"colorModulation",void 0);p.__decorate([y.property({json:{write:!0},nonNullable:!0,type:Number})],r.prototype,"pointsPerInch",void 0);r=p.__decorate([l.subclass("esri.renderers.PointCloudRenderer")],r);(r||(r={})).fieldTransformTypeKebabDict=new b.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return r})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e){var l;a.ColorModulation=l=function(g){function d(){var c=g.apply(this,arguments)||this;c.field=null;c.minValue=0;c.maxValue=255;return c}p._inheritsLoose(d,g);d.prototype.clone=function(){return new l({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};return d}(r.JSONSupport);b.__decorate([q.property({type:String,json:{write:!0}})],a.ColorModulation.prototype,"field",void 0);b.__decorate([q.property({type:Number,nonNullable:!0,json:{write:!0}})],a.ColorModulation.prototype,
"minValue",void 0);b.__decorate([q.property({type:Number,nonNullable:!0,json:{write:!0}})],a.ColorModulation.prototype,"maxValue",void 0);a.ColorModulation=l=b.__decorate([e.subclass("esri.renderers.support.pointCloud.ColorModulation")],a.ColorModulation);a["default"]=a.ColorModulation;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],
function(a,p,b,r){a.pointSizeAlgorithmTypes={key:"type",base:p["default"],typeMap:{"fixed-size":b["default"],splat:r["default"]}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e,l){r=new r.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});a.PointSizeAlgorithm=function(g){function d(){return g.apply(this,arguments)||this}p._inheritsLoose(d,g);return d}(q.JSONSupport);b.__decorate([y.property({type:r.apiValues,readOnly:!0,nonNullable:!0,json:{type:r.jsonValues,read:!1,write:r.write}})],a.PointSizeAlgorithm.prototype,"type",void 0);a.PointSizeAlgorithm=b.__decorate([l.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
a.PointSizeAlgorithm);a["default"]=a.PointSizeAlgorithm;a.typeKebabDictionary=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,p,b,r,q,y,f,w,e,l){var g;a.PointSizeFixedSizeAlgorithm=g=function(d){function c(){var u=d.apply(this,arguments)||this;u.type="fixed-size";u.size=0;u.useRealWorldSymbolSizes=null;return u}p._inheritsLoose(c,d);c.prototype.clone=function(){return new g({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};return c}(l["default"]);b.__decorate([w.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],a.PointSizeFixedSizeAlgorithm.prototype,"type",void 0);b.__decorate([r.property({type:Number,
nonNullable:!0,json:{write:!0}})],a.PointSizeFixedSizeAlgorithm.prototype,"size",void 0);b.__decorate([r.property({type:Boolean,json:{write:!0}})],a.PointSizeFixedSizeAlgorithm.prototype,"useRealWorldSymbolSizes",void 0);a.PointSizeFixedSizeAlgorithm=g=b.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],a.PointSizeFixedSizeAlgorithm);a["default"]=a.PointSizeFixedSizeAlgorithm;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,p,b,r,q,y,f,w,e,l){var g;a.PointSizeSplatAlgorithm=g=function(d){function c(){var u=d.apply(this,arguments)||this;u.type="splat";u.scaleFactor=1;return u}p._inheritsLoose(c,d);c.prototype.clone=function(){return new g({scaleFactor:this.scaleFactor})};return c}(l["default"]);b.__decorate([w.enumeration({pointCloudSplatAlgorithm:"splat"})],a.PointSizeSplatAlgorithm.prototype,"type",void 0);b.__decorate([r.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],a.PointSizeSplatAlgorithm.prototype,
"scaleFactor",void 0);a.PointSizeSplatAlgorithm=g=b.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],a.PointSizeSplatAlgorithm);a["default"]=a.PointSizeSplatAlgorithm;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){var d;a.ColorClassBreakInfo=d=function(c){function u(){var t=c.apply(this,arguments)||this;t.description=null;t.label=null;t.minValue=0;t.maxValue=0;t.color=null;return t}p._inheritsLoose(u,c);u.prototype.clone=function(){return new d({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:y.clone(this.color)})};return u}(q.JSONSupport);b.__decorate([f.property({type:String,json:{write:!0}})],a.ColorClassBreakInfo.prototype,
"description",void 0);b.__decorate([f.property({type:String,json:{write:!0}})],a.ColorClassBreakInfo.prototype,"label",void 0);b.__decorate([f.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],a.ColorClassBreakInfo.prototype,"minValue",void 0);b.__decorate([f.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],a.ColorClassBreakInfo.prototype,"maxValue",void 0);b.__decorate([f.property({type:r,json:{type:[w.Integer],
write:!0}})],a.ColorClassBreakInfo.prototype,"color",void 0);a.ColorClassBreakInfo=d=b.__decorate([g.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],a.ColorClassBreakInfo);a["default"]=a.ColorClassBreakInfo;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){var c;q=c=function(u){function t(h){h=u.call(this,h)||this;h.type="point-cloud-stretch";h.field=null;h.legendOptions=null;h.fieldTransformType=null;h.stops=null;return h}a._inheritsLoose(t,u);t.prototype.clone=function(){return new c({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),stops:b.clone(this.stops),legendOptions:b.clone(this.legendOptions)})};return t}(l);p.__decorate([w.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],
q.prototype,"type",void 0);p.__decorate([r.property({json:{write:!0},type:String})],q.prototype,"field",void 0);p.__decorate([r.property({type:g["default"],json:{write:!0}})],q.prototype,"legendOptions",void 0);p.__decorate([r.property({type:l.fieldTransformTypeKebabDict.apiValues,json:{type:l.fieldTransformTypeKebabDict.jsonValues,read:l.fieldTransformTypeKebabDict.read,write:l.fieldTransformTypeKebabDict.write}})],q.prototype,"fieldTransformType",void 0);p.__decorate([r.property({type:[d],json:{write:!0}})],
q.prototype,"stops",void 0);return q=c=p.__decorate([e.subclass("esri.renderers.PointCloudStretchRenderer")],q)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){var c;q=c=function(u){function t(h){h=u.call(this,h)||this;h.type="point-cloud-unique-value";h.field=null;h.fieldTransformType=null;h.colorUniqueValueInfos=null;h.legendOptions=null;return h}a._inheritsLoose(t,u);t.prototype.clone=function(){return new c({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),colorUniqueValueInfos:b.clone(this.colorUniqueValueInfos),legendOptions:b.clone(this.legendOptions)})};return t}(l);
p.__decorate([w.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],q.prototype,"type",void 0);p.__decorate([r.property({json:{write:!0},type:String})],q.prototype,"field",void 0);p.__decorate([r.property({type:l.fieldTransformTypeKebabDict.apiValues,json:{type:l.fieldTransformTypeKebabDict.jsonValues,read:l.fieldTransformTypeKebabDict.read,write:l.fieldTransformTypeKebabDict.write}})],q.prototype,"fieldTransformType",void 0);p.__decorate([r.property({type:[d["default"]],json:{write:!0}})],
q.prototype,"colorUniqueValueInfos",void 0);p.__decorate([r.property({type:g["default"],json:{write:!0}})],q.prototype,"legendOptions",void 0);return q=c=p.__decorate([e.subclass("esri.renderers.PointCloudUniqueValueRenderer")],q)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){var d;a.ColorUniqueValueInfo=d=function(c){function u(){var t=c.apply(this,arguments)||this;t.description=null;t.label=null;t.values=null;t.color=null;return t}p._inheritsLoose(u,c);u.prototype.clone=function(){return new d({description:this.description,label:this.label,values:y.clone(this.values),color:y.clone(this.color)})};return u}(q.JSONSupport);b.__decorate([f.property({type:String,json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"description",void 0);b.__decorate([f.property({type:String,
json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"label",void 0);b.__decorate([f.property({type:[String],json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"values",void 0);b.__decorate([f.property({type:r,json:{type:[w.Integer],write:!0}})],a.ColorUniqueValueInfo.prototype,"color",void 0);a.ColorUniqueValueInfo=d=b.__decorate([g.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],a.ColorUniqueValueInfo);a["default"]=a.ColorUniqueValueInfo;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,p,b,r,q,y,f,w,e){var l;a.PointGraphic=l=function(g){function d(u){return g.call(this,u)||this}p._inheritsLoose(d,
g);var c=d.prototype;c.clone=function(){return new l(this.cloneProperties())};c.cloneProperties=function(){const {pointCloudMetadata:u}=this;return{...g.prototype.cloneProperties.call(this),pointCloudMetadata:u}};return d}(r);b.__decorate([q.property({constructOnly:!0})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=l=b.__decorate([e.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f32 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./PointHighlights ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/Slice.glsl ../../webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/shaders/PointRendererTechnique ../../../webgl/BufferObject ../../../webgl/VertexArrayObject".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C){function A(G,K,M,H,J){if(M.drawScreenSpace)return M.fixedSize*K*H;J=(J?256:64)*K*H;return M.drawFixedSize?Math.min(M.fixedSize/2,J):0<M.screenMinSize?Math.min(Math.max(M.screenMinSize*K*H,G/2),J):Math.min(G/2,J)}function B(G){return b.isSome(G.component)?G.component:-1}function D(G,K){if(b.isNone(G))return G;G=G.filter(M=>M.id!==K);return 0===G.length?null:G}const E={positions:[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],
colors:[{name:"color",count:3,type:5121,offset:0,stride:3,normalized:!0}]};a.PointRenderer=function(){function G(M){this._params=M;this.type="Point";this.isGround=!1;this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null};this._highlights=new t.PointHighlights({forEachNode:H=>this.forEachNode(H),addHighlight:(H,J,O)=>this.addHighlight(H,J,O),removeHighlight:(H,J)=>this.removeHighlight(H,J)});this.canRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=
0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=d.create(d.POSITIVE_INFINITY);this._techniqueConfig=new v.PointRendererTechniqueConfiguration;this.tempMatrix4=y.create();this.tempVec3=e.create();this.nodes=new r}var K=G.prototype;K.initializeRenderContext=function(M){this._context=M;this._techniqueRep=this._context.shaderTechniqueRep;M.requestRender()};K.uninitializeRenderContext=function(){};K.intersect=function(M,H,J,O){const I=l.create(),F=
l.create(),L=l.create(),N=l.create(),R=c.create(),S=M.camera.perScreenPixelRatio/2,P=M.camera.near,Q=this._getSizeParams();w.subtract(F,O,J);const V=1/w.length(F);w.scale(F,F,V);w.negate(L,F);g.set(R,F[0],F[1],F[2],-w.dot(F,J));let ca=function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""};const ba=new ca,Z=new ca,ha=[],fa=d.create(),aa=d.create(this._clipBox);d.offset(aa,-J[0],-J[1],-J[2],aa);this.nodes.forAll(T=>{const Y=T.splatSize*this._scaleFactor;var ea=h.minimumDistancePlane(T.obb,
R),ia=h.maximumDistancePlane(T.obb,R);ea-=Q.drawScreenSpace?0:A(Y,ea+P,Q,S,T.isLeaf);ia-=Q.drawScreenSpace?0:A(Y,ia+P,Q,S,T.isLeaf);ea=null!=ba.dist&&null!=Z.dist&&ba.dist<ea*V&&Z.dist>ia*V;if(!(0>ia||ea)&&(ia=A(Y,ia+P,Q,S,T.isLeaf),h.intersectLine(T.obb,J,F,ia))){ia*=ia;h.toAaBoundingBox(T.obb,fa);d.offset(fa,-J[0],-J[1],-J[2],fa);ea=!d.contains(aa,fa);w.subtract(N,T.origin,J);var la=T.coordinates.length/3;for(let Fa=0;Fa<la;Fa++){I[0]=N[0]+T.coordinates[3*Fa];I[1]=N[1]+T.coordinates[3*Fa+1];I[2]=
N[2]+T.coordinates[3*Fa+2];if(ea&&!d.containsPoint(aa,I))continue;var pa=w.dot(I,F),ua=w.squaredLength(I)-pa*pa;if(ua>ia)continue;var wa=pa+P;const La=Q.drawScreenSpace?0:A(Y,wa,Q,S,T.isLeaf);if(0>pa-La)continue;wa-=La;wa=A(Y,wa,Q,S,T.isLeaf);if(ua>wa*wa)continue;const Ma=(pa-La)*V;pa=Sa=>{var Ia=Fa,va=Sa.point;null==va&&(va=l.create());va[0]=T.origin[0]+T.coordinates[3*Ia];va[1]=T.origin[1]+T.coordinates[3*Ia+1];va[2]=T.origin[2]+T.coordinates[3*Ia+2];Sa.point=va;Sa.dist=Ma;Sa.normal=L;Sa.node=T;
Sa.pointId=Fa;Sa.layerUid=this.layerUid};(null==ba.dist||Ma<ba.dist)&&(null==H||H(J,O,Ma))&&pa(ba);0!==M.options.store&&(null==Z.dist||Ma>Z.dist)&&(null==H||H(J,O,Ma))&&pa(Z);2!==M.options.store||null!=H&&!H(J,O,Ma)||(ua=new ca,pa(ua),ha.push(ua))}}});const W=T=>{const {layerUid:Y,node:ea,pointId:ia}=T;return{type:"external",point:T.point,metadata:{layerUid:Y,createGraphic:()=>this._params.createGraphic(ea,ia,T.point)}}},U=(T,Y)=>{const ea=W(Y);T.set(ea,`${Y.layerUid}/${Y.node.id}/${Y.pointId}`,Y.dist,
Y.normal,f.IDENTITY,void 0);T.intersector="PointRenderer"};if(null!=ba.dist){var X=M.results.min;(null==X.dist||ba.dist<X.dist)&&U(X,ba)}null!=Z.dist&&0!==M.options.store&&(X=M.results.max,(null==X.dist||Z.dist>X.dist)&&U(X,Z));if(2===M.options.store){X=u.fromPoints(J,O);for(const T of ha){const Y=new k.IntersectorResult(X);U(Y,T);M.results.all.push(Y)}}};K.render=function(M){if(0!==M.pass&&2!==M.pass&&5!==M.pass)return!1;const H=2===M.pass,J=M.rctx;this.nodes.forAll(P=>{null==P.vao&&this._initNode(M,
P)});const O=this._getSizeParams(),I=this.selectTechnique(M,O),F=I.program;if(null==F||0===this.nodes.length)return!0;const L=this._clipBox,N=!d.equals(L,d.POSITIVE_INFINITY,(P,Q)=>P===Q);N||(w.set(this.tempVec3,-Infinity,-Infinity,-Infinity),F.setUniform3fv("uClipMin",this.tempVec3),w.set(this.tempVec3,Infinity,Infinity,Infinity),F.setUniform3fv("uClipMax",this.tempVec3));J.useProgram(F);I.bindPipelineState(J);F.setUniformMatrix4fv("uProjectionMatrix",M.camera.projectionMatrix);H&&F.setUniform2f("nearFar",
M.camera.near,M.camera.far);M.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/M.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/M.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=M.highlightDepthTexture,n.bindOutputHighlight(F,this._bindParameters));const R=M.camera.pixelRatio;O.drawFixedSize&&F.setUniform2f("uPointScale",O.fixedSize*R,M.camera.fullHeight);const S=this._slicePlaneEnabled?M.sliceHelper&&M.sliceHelper.plane:null;this.nodes.forAll(P=>{if(0!==
P.coordinates.length&&(!M.isHighlightPass||P.highlights)){F.setUniform2f("uScreenMinMaxSize",O.screenMinSize*R,(P.isLeaf?256:64)*R);O.drawFixedSize||F.setUniform2f("uPointScale",P.splatSize*this._scaleFactor*R,M.camera.fullHeight/R);var Q=P.origin;N&&(w.set(this.tempVec3,L[0]-Q[0],L[1]-Q[1],L[2]-Q[2]),F.setUniform3fv("uClipMin",this.tempVec3),w.set(this.tempVec3,L[3]-Q[0],L[4]-Q[1],L[5]-Q[2]),F.setUniform3fv("uClipMax",this.tempVec3));q.identity(this.tempMatrix4);q.translate(this.tempMatrix4,this.tempMatrix4,
Q);q.multiply(this.tempMatrix4,M.camera.viewMatrix,this.tempMatrix4);F.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);m.bindSliceUniforms(F,I.configuration,S,Q);J.bindVAO(P.vao);M.isHighlightPass?this._renderHighlightFragments(J,P):J.drawArrays(0,0,P.coordinates.length/3)}});return!0};K._renderHighlightFragments=function(M,H){var J=H.highlights;if(!b.isNone(J)){H=b.unwrap(J[0].component);var O=H+1;for(let I=1;I<J.length;I++){const F=b.unwrap(J[I].component);F!==O&&(O-=H,0<O&&M.drawArrays(0,
H,O),H=F);O=F+1}J=O-H;0<J&&M.drawArrays(0,H,J)}};K.addNode=function(M){this.nodes.push(M);this._highlights.nodeAdded(M);this._requestRender()};K.removeNode=function(M){let H=null;this.nodes.filterInPlace(J=>J.id===M?(H=J,J.vao=b.disposeMaybe(J.vao),this._highlights.nodeRemoved(J),!1):!0);this._requestRender();return H};K.forEachNode=function(M){this.nodes.forAll(M)};K.removeAll=function(){this.nodes.forAll(M=>M.vao=b.disposeMaybe(M.vao));this._highlights.removeAll();this.nodes.clear();this._requestRender()};
K.highlight=function(M){return this._highlights.add(M)};K.addHighlight=function(M,H,J){var O=M.highlights;b.isNone(O)&&(O=[]);H={component:H,id:J};O.push(H);H=B(H);for(J=O.length-1;0<J&&H<B(O[J-1]);)[O[J-1],O[J]]=[O[J],O[J-1]],--J;M.highlights=O;this._requestRender()};K.removeHighlight=function(M,H){M.highlights=D(M.highlights,H);this._requestRender()};K._initNode=function(M,H){M=M.rctx;H.vao=new C(M,z.Default3D,E,{positions:x.createVertex(M,35044,H.coordinates),colors:x.createVertex(M,35044,H.rgb)})};
K._requestRender=function(){this._context&&this._context.requestRender()};K._getSizeParams=function(){const M=this._useFixedSizes,H=M&&!this._useRealWorldSymbolSizes;return{drawScreenSpace:H,drawFixedSize:M,fixedSize:H?this._sizePx:this._size,screenMinSize:M?0:this._minSizePx}};K.selectTechnique=function(M,H){this._techniqueConfig.drawScreenSize=H.drawScreenSpace;this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled;this._techniqueConfig.sceneHasOcludees=M.hasOccludees;this._techniqueConfig.output=
2===M.pass?1:5===M.pass?4:0;return this._techniqueRep.releaseAndAcquire(v.PointRendererTechnique,this._techniqueConfig,this._technique)};p._createClass(G,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},{key:"useFixedSizes",get:function(){return this._useFixedSizes},set:function(M){this._useFixedSizes!==M&&(this._useFixedSizes=M,this._requestRender())}},{key:"scaleFactor",get:function(){return this._scaleFactor},set:function(M){this._scaleFactor!==M&&(this._scaleFactor=
M,this._requestRender())}},{key:"minSizePx",get:function(){return this._minSizePx},set:function(M){this._minSizePx!==M&&(this._minSizePx=M,this._requestRender())}},{key:"useRealWorldSymbolSizes",get:function(){return this._useRealWorldSymbolSizes},set:function(M){this._useRealWorldSymbolSizes!==M&&(this._useRealWorldSymbolSizes=M,this._requestRender())}},{key:"size",get:function(){return this._size},set:function(M){this._size!==M&&(this._size=M,this._requestRender())}},{key:"sizePx",get:function(){return this._sizePx},
set:function(M){this._sizePx!==M&&(this._sizePx=M,this._requestRender())}},{key:"clippingBox",set:function(M){d.set(this._clipBox,M||d.POSITIVE_INFINITY)}},{key:"slicePlane",get:function(){return this._slicePlaneEnabled},set:function(M){this._slicePlaneEnabled!==M&&(this._slicePlaneEnabled=M,this._requestRender())}},{key:"intersectionHandlerId",get:function(){return this.layerUid}}]);return G}();(function(G){G.isInstanceOfNode=function(K){return K.hasOwnProperty("splatSize")}})(a.PointRenderer||(a.PointRenderer=
{}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils","../../../../core/maybe","../../webgl-engine/lib/Object3DStateID"],function(a,p,b,r,q){let y=function(){function w(l){this.context=l;this.highlights=new Set}var e=w.prototype;e.destroy=function(){this.highlights=null};e.add=function(l){const g=new f(l);this.highlights.add(g);this.enableSet(g);
return b.makeHandle(()=>this.removeSet(g))};e.removeSet=function(l){this.disableSet(l);this.highlights.delete(l)};e.enableSet=function(l){l.enabled||(l.enabled=!0,this.context.forEachNode(g=>this.enableSetForNode(l,g)))};e.enableSetForNode=function(l,g){if(l.enabled){var d=l.ids.get(g.id);d&&d.forEach(c=>this.context.addHighlight(g,c,l.id))}};e.disableSet=function(l){l.enabled&&(l.enabled=!1,this.context.forEachNode(g=>this.disableSetForNode(l,g)))};e.disableSetForNode=function(l,g){l.enabled||this.context.removeHighlight(g,
l.id)};e.nodeAdded=function(l){this.highlights.forEach(g=>this.enableSetForNode(g,l))};e.nodeRemoved=function(l){this.highlights.forEach(g=>this.disableSetForNode(g,l))};e.removeAll=function(){this.highlights.forEach(l=>this.disableSet(l))};p._createClass(w,[{key:"hasHighlights",get:function(){return 0<this.highlights.size}}]);return w}(),f=function(){function w(e){this.id=new q.Object3DStateID(0);this.ids=new Map;this.enabled=!1;for(const l of e)r.isSome(l)&&this.add(l.nodeId,l.pointId)}w.prototype.add=
function(e,l){const g=this.ids.get(e);g?g.add(l):this.ids.set(e,new Set([l]))};return w}();a.PointHighlights=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/renderState".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){y=function(c){function u(h,m,n){return c.call(this,h,m,n)||this}b._inheritsLoose(u,c);var t=u.prototype;t.initializeProgram=function(h){var m=u.shader.get();const n=this.configuration;m=m.build({output:n.output,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:n.drawScreenSize});return new e.Program(h.rctx,m,w.Default3D)};t.initializePipeline=function(){return d.makePipelineState({depthTest:{func:513},
depthWrite:d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams,stencilWrite:this.configuration.sceneHasOcludees?l.stencilWriteMaskOn:null,stencilTest:this.configuration.sceneHasOcludees?l.stencilBaseAllZerosParams:null})};return u}(y.ShaderTechnique);y.shader=new q.ReloadableShaderModule(g.PointRendererShader,()=>new Promise(function(c,u){a(["./PointRenderer.glsl"],c,u)}));q=function(c){function u(){var t=c.apply(this,arguments)||this;t.output=0;t.slicePlaneEnabled=!1;t.drawScreenSize=
!1;t.sceneHasOcludees=!1;return t}b._inheritsLoose(u,c);return u}(f.ShaderTechniqueConfiguration);r.__decorate([f.parameter({count:8})],q.prototype,"output",void 0);r.__decorate([f.parameter()],q.prototype,"slicePlaneEnabled",void 0);r.__decorate([f.parameter()],q.prototype,"drawScreenSize",void 0);r.__decorate([f.parameter()],q.prototype,"sceneHasOcludees",void 0);p.PointRendererTechnique=y;p.PointRendererTechniqueConfiguration=q;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,p,b,r,q,y){function f(e){const l=new y.ShaderBuilder,g=0===e.output,d=1===e.output,c=4===e.output;l.extensions.add("GL_OES_standard_derivatives");l.include(p.Slice,e);l.attributes.add("position","vec3");l.attributes.add("color","vec3");l.vertex.uniforms.add("uModelViewMatrix","mat4").add("uProjectionMatrix","mat4").add("uScreenMinMaxSize","vec2").add("uPointScale","vec2").add("uClipMin","vec3").add("uClipMax","vec3");d?(l.vertex.uniforms.add("nearFar","vec2"),l.varyings.add("depth","float")):
4!==e.output&&l.varyings.add("vColor","vec3");l.vertex.code.add(q.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < uClipMin.x || position.y < uClipMin.y || position.z < uClipMin.z ||
        position.x > uClipMax.x || position.y > uClipMax.y || position.z > uClipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = uModelViewMatrix * vec4(position, 1.0);

      float pointSize = uPointScale.x;
      vec4 position = uProjectionMatrix * camera;
     ${e.drawScreenSize?q.glsl`
      float clampedScreenSize = pointSize;`:q.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = uProjectionMatrix * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = uPointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = uProjectionMatrix * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${d?q.glsl`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:""}
     ${g?q.glsl`vColor = color;`:""}
    }
  `);l.fragment.include(r.RgbaFloatEncoding,e);c&&l.include(b.OutputHighlight);l.fragment.code.add(q.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${d?q.glsl`gl_FragColor = float2rgba(depth);`:""}
      ${c?q.glsl`outputHighlight();`:""}
      ${g?q.glsl`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `);return l}var w=Object.freeze({__proto__:null,build:f});a.PointRendererShader=w;a.build=f})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){a.PopupSceneLayerView=c=>{c=function(u){function t(){return u.apply(this,arguments)||this}p._inheritsLoose(t,u);var h=t.prototype;h._validateFetchPopupFeatures=function(m){const {layer:n}=this,{popupEnabled:z}=n;if(!z)return new r("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:n});if(!d.getFetchPopupTemplate(n,m))return new r("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:n})};h.prepareFetchPopupFeatures=
function(){var m=p._asyncToGenerator(function*(n){});return function(n){return m.apply(this,arguments)}}();h.fetchPopupFeatures=function(){var m=p._asyncToGenerator(function*(n,z){if(n=this._validateFetchPopupFeatures(z))return Promise.reject(n);n=q.isSome(z)?z.clientGraphics:null;if(!n||0===n.length)return Promise.resolve([]);const k=[],v=[];var x="scene"===this.layer.type&&q.isSome(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;z=g.unpackFieldNames(this.layer.fieldsIndex,yield d.getRequiredFields(x,
d.getFetchPopupTemplate(this.layer,z)));yield this.prepareFetchPopupFeatures(z);x=new Set;for(const C of n)g.populateMissingFields(z,C,x)?v.push(C):k.push(C);return 0===v.length?Promise.resolve(k):this.whenGraphicAttributes(v,[...x]).catch(()=>v).then(C=>k.concat(C))});return function(n,z){return m.apply(this,arguments)}}();return t}(c);return c=b.__decorate([l.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],c)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../rest/support/Query ./I3SMeshView3D ./LayerView3D ./i3s/attributeEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/updatingProperties ../../layers/SceneLayerView ../../layers/support/FeatureFilter ../../support/floorFilterUtils ../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K){const M=r.getLogger("esri.views.3d.layers.SceneLayerView3D");r=x.defineFieldProperties();d=function(H){function J(){var I=H.apply(this,arguments)||this;I.type="scene-layer-3d";I.lodFactor=1;I.progressiveLoadFactor=1;I._elevationContext="scene";I._isIntegratedMesh=!1;I._supportsLabeling=!0;I._interactiveEditingSessions=new Map;I._queryEngine=null;return I}a._inheritsLoose(J,H);var O=J.prototype;O.initialize=function(){this.fieldsHelper=
new A.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(this.layer,"rangeInfos",I=>this._rangeInfosChanged(I),2);this.updatingHandles.add(this.layer,"renderer",I=>this.updatingHandles.addPromise(this._rendererChange(I)),2);for(const I of"parsedDefinitionExpression filter viewFilter.parsedWhereClause viewFilter.parsedGeometry viewFilter.sortedObjectIds floorFilterClause".split(" "))this.updatingHandles.add(this,I,()=>this._filterChange());for(const I of["filter","viewFilter.parsedGeometry"])this.updatingHandles.add(this,
I,()=>this._geometryFilterChange());this.handles.add(this.layer.on("apply-edits",I=>this.updatingHandles.addPromise(I.result)));this.handles.add(this.layer.on("edits",I=>this._handleEdits(I)))};O.destroy=function(){this.fieldsHelper=q.destroyMaybe(this.fieldsHelper)};O._rangeInfosChanged=function(I){null!=I&&0<I.length&&M.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};O.createQuery=function(){const I={outFields:["*"],returnGeometry:!1,
outSpatialReference:this.view.spatialReference};return q.isSome(this.filter)?this.filter.createQuery(I):new g(I)};O.queryExtent=function(I,F){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(I),null==F?void 0:F.signal)};O.queryFeatureCount=function(I,F){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(I),null==F?void 0:F.signal)};O.queryFeatures=function(I,F){return this._ensureQueryEngine().executeQuery(this._ensureQuery(I),null==F?void 0:F.signal).then(L=>
{if(null==L||!L.features)return L;const N=this.layer;for(const R of L.features)R.layer=N,R.sourceLayer=N;return L})};O.queryObjectIds=function(I,F){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(I),null==F?void 0:F.signal)};O._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};O._createQueryEngine=function(){const I=t.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);
return new m["default"]({layerView:this,priority:K.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new z["default"]({featureAdapter:new n.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:I}),forAllFeatures:(F,L)=>this._forAllFeatures((N,R,S)=>F({id:N,index:R,meta:S}),L,2),getFeatureExtent:I,sourceSpatialReference:k.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};O.highlight=function(I){const F=
this._highlights;if(I instanceof g){const {set:L,handle:N}=F.acquireSet();this.queryObjectIds(I).then(R=>F.setFeatureIds(L,R));return N}return H.prototype.highlight.call(this,I)};O.createInteractiveEditSession=function(I){return u.createInteractiveEditSession(this.attributeEditingContext,I)};O._createLayerGraphic=function(I){I=new b(null,null,I);I.layer=this.layer;I.sourceLayer=this.layer;return I};O.canResume=function(){return H.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};
O.getFilters=function(){const I=H.prototype.getFilters.call(this);this.floorFilterClause&&this.addSqlFilter(I,this.floorFilterClause,this.logError);this.addSqlFilter(I,this.parsedDefinitionExpression,this.logError);q.isSome(this.viewFilter)&&this.viewFilter.addFilters(I,this.view,this._controller.crsIndex,this._collection);return I};O._ensureQuery=function(I){return this._addDefinitionExpressionToQuery(q.isNone(I)?this.createQuery():g.from(I))};O._handleEdits=function(I){u.processAttributeEdits(this.attributeEditingContext,
I)};O.computeNodeFiltering=function(I){const F=this.viewFilter;return q.isNone(F)||F.isMBSGeoemtryVisible(I,this.view.spatialReference,this._controller.crsIndex)?0:1};a._createClass(J,[{key:"filter",get:function(){return q.isSome(this.viewFilter)?this.viewFilter.filter:null},set:function(I){q.isNone(I)||!h.I3SMeshViewFilter.checkSupport(I)?this.viewFilter=null:q.isSome(this.viewFilter)?this.viewFilter.filter=I:this.viewFilter=new h.I3SMeshViewFilter({filter:I,layerFieldsIndex:this.layer.fieldsIndex,
loadAsyncModule:F=>this._loadAsyncModule(F),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(F,L)=>this.addSqlFilter(F,L,this.logError)})}},{key:"requiredFields",get:function(){var I,F;return null!=(I=null==(F=this.fieldsHelper)?void 0:F.requiredFields)?I:[]}},{key:"floorFilterClause",get:function(){const I=G.getFloorFilterClause(this);return q.isSome(I)?l.WhereClause.create(I,this.layer.fieldsIndex):null}},{key:"lodCrossfadeinDuration",get:function(){var I,F;return null!=(I=null==(F=this.view)?
void 0:F.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration)?I:0}},{key:"lodCrossfadeoutDuration",get:function(){var I,F;return null!=(I=null==(F=this.view)?void 0:F.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration)?I:0}},{key:"lodCrossfadeUncoveredDuration",get:function(){var I,F;return null!=(I=null==(F=this.view)?void 0:F.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration)?I:0}},{key:"attributeEditingContext",get:function(){return{sessions:this._interactiveEditingSessions,
fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:I=>this._forAllNodes(F=>q.isSome(F)?I(F.node,F.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,getAttributeData:I=>this.getAttributeData(I),setAttributeData:(I,F)=>this.setAttributeData(I,F),clearMemCache:()=>this.clearMemCache()}}},{key:"hasGeometryFilter",get:function(){const I=this.viewFilter;return q.isSome(I)&&q.isSome(I.parsedGeometry)}}]);
return J}(d.I3SMeshView3D(v.DefinitionExpressionSceneLayerView(C.PopupSceneLayerView(c.LayerView3D(D)))));p.__decorate([y.property({aliasOf:"layer"})],d.prototype,"i3slayer",void 0);p.__decorate([y.property()],d.prototype,"suspended",void 0);p.__decorate([y.property(B.updatingProgress)],d.prototype,"updatingProgress",void 0);p.__decorate([y.property({type:E})],d.prototype,"filter",null);p.__decorate([y.property()],d.prototype,"viewFilter",void 0);p.__decorate([y.property(r.requiredFields)],d.prototype,
"requiredFields",null);p.__decorate([y.property(r.availableFields)],d.prototype,"availableFields",void 0);p.__decorate([y.property()],d.prototype,"fieldsHelper",void 0);p.__decorate([y.property()],d.prototype,"floorFilterClause",null);p.__decorate([y.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],d.prototype,"lodFactor",void 0);p.__decorate([y.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],d.prototype,"updatingProgressValue",void 0);return d=
p.__decorate([e.subclass("esri.views.3d.layers.SceneLayerView3D")],d)})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SAttributeOverrides ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/lib/BasisUtil".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N,R,S,P,Q,V,ca,ba,Z,ha,fa,aa,W,U,X,T,Y,ea,ia,la,pa,ua,wa){function Fa(ra){const Da=ra.metallicRoughness;return Da&&0<=Da.baseColorTextureId||Da&&0<=Da.metallicRoughnessTextureId||0<=ra.normalTextureId||0<=ra.emissiveTextureId||0<=ra.occlusionTextureId}function La(ra){return g.isSome(ra)&&t.isArrayBuffer(ra.data)}function Ma(ra,Da){ra=1024+ra.interleavedVertexData.byteLength+(ra.indices?ra.indices.byteLength:0)+ra.positionData.data.byteLength+
ra.positionData.indices.byteLength;if(g.isSome(Da))for(const Pa of Da)g.isSome(Pa)&&t.isArrayBuffer(Pa.data)&&(ra+=Pa.data.byteLength);return ra}function Sa(ra,Da){return 104857600<Da.byteSize?(ma.warn(`Node is too big to store in IndexedDB cache: ${ra.id} (${Da.byteSize} bytes)`),!1):0<Da.byteSize}function Ia(ra){if(0===ra.length)return null;const Da=new Float64Array(10*ra.length);ra.forAll((Pa,Qa)=>{let na=Pa.serviceObb;g.isNone(na)&&(na=sa,B.copy(na.center,Pa.mbs),na.halfSize[0]=na.halfSize[1]=
na.halfSize[2]=Pa.mbs[3]);Pa=10*Qa;Da[Pa+0]=na.center[0];Da[Pa+1]=na.center[1];Da[Pa+2]=na.center[2];Da[Pa+3]=na.halfSize[0];Da[Pa+4]=na.halfSize[1];Da[Pa+5]=na.halfSize[2];Da[Pa+6]=na.quaternion[0];Da[Pa+7]=na.quaternion[1];Da[Pa+8]=na.quaternion[2];Da[Pa+9]=na.quaternion[3]});return Da}function va(ra,Da){ra.forEach(Pa=>Pa.opacity=Da)}const ma=e.getLogger("esri.views.3d.layers.SceneLayerView3D"),ta=[1,1,1,1];let Ea=function(ra){function Da(Pa,Qa,na,Aa,Ra,Ua,Wa){var ab=ra.call(this)||this;ab.node=
Pa;ab.featureIds=Qa;ab.objectHandle=na;ab.cachedRendererVersion=Aa;ab.attributeInfo=Ra;ab.material=Ua;ab.textures=Wa;ab.cachedEdgeMaterials=[];ab.cachedSymbology=null;return ab}b._inheritsLoose(Da,ra);return Da}(ba.NodeCrossfadeMetaData);const Ca=K.create(),ka=K.create(),sa=ia.create(),Ja=[0,0,0,0],Ta=new q([0,0,0,0]),da=[0,0,0,0],qa={remove(){},pause(){},resume(){}};p.I3SMeshView3D=ra=>{ra=function(Da){function Pa(...na){na=Da.call(this,na)||this;na._elevationProvider=null;na._intersectionHandler=
null;na._nodeId2Meta=new Map;na._nodeId2MetaReloading=new Map;na._i3sWasmLoaded=!1;na._hasLoadedPBRTextures=!1;na._asyncModuleLoading=0;na._addTasks=new Map;na._rendererVersion=0;na._colorVariable=null;na._opacityVariable=null;na._rendererFields=null;na._symbologyFields=null;na._symbologyOverride=null;na._symbologyOverrideFields=null;na._symbolInfos=new Map;na._idbCache=new X.IDBCache("esri-scenelayer-cache","geometries");na.holeFilling="auto";na._hasColors=!1;na._hasTextures=!1;na._hasData=!1;na.slicePlaneEnabled=
!1;na._modifications=[];na._layerUrl="";na._cacheKeySuffix=null;na._arcade=null;na._tmpAttributeOnlyGraphic=new y(null,null,{});na._crossfadeHelper=new ba.I3SCrossfadeHelper(b._assertThisInitialized(na));return na}b._inheritsLoose(Pa,Da);var Qa=Pa.prototype;Qa.initialize=function(){this.preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);const na=this.view.resourceController;this.attributeOverrides=new ca.I3SAttributeOverrides(this.i3slayer,na.memoryController);this._worker=new S.I3SMeshWorkerHandle(Ra=>
na.schedule(Ra));this.addResolvingPromise(this._worker.promise);this._worker.setLegacySchema(this.layerUid,this.i3slayer.store.defaultGeometrySchema);U.checkSceneLayerValid(this.i3slayer);U.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new M({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this._highlights=
new V({collection:this._collection,forAllFeatures:Ra=>this._forAllFeatures(Ra,null,1),forAllFeaturesOfNode:(Ra,Ua)=>this._forAllFeaturesOfNode(Ra,Ua)});if(this._isIntegratedMesh||!this.i3slayer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var Aa=this.i3slayer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(Aa&&Aa.faceRange&&Aa.id)}this._hasVertexColors=null!=this.i3slayer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.i3slayer.cachedDrawingInfo||
!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.getMemCache(this.i3slayer.uid,Ra=>this._deleteComponentObject(Ra));this._intersectionHandler=new fa.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:Ra=>g.isSome(this._controller.index)&&
g.isSome(this._controller.index.rootNode)?this._controller.index.traverse(this._controller.index.rootNode,Ua=>{var Wa=Ua.index;Wa=this._nodeId2Meta.get(Wa)||this._nodeId2MetaReloading.get(Wa);return Ra(Ua,g.isSome(Wa)?Wa.objectHandle:null)}):()=>{}});this._elevationProvider=new Z({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR();this.updatingHandles.add(this,"view.clippingArea",()=>this._clippingAreaChanged(),2);this.updatingHandles.add(this,
"fullOpacity",Ra=>this._opacityChange(Ra));this.updatingHandles.add(this,"slicePlaneEnabled",Ra=>this._slicePlaneEnabledChange(Ra));this.updatingHandles.add(this,"elevationOffset",(Ra,Ua)=>{this._reloadAll(Ua);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(this,"filter",()=>this._filterChange(),2);this.updatingHandles.add(this,"view.qualitySettings.physicallyBasedRenderingEnabled",()=>this._updatePBR());Aa=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(this,
"rendererTextureUsage",Aa);this.updatingHandles.add(this,"uncompressedTextureDownsamplingEnabled",Aa);this.updatingHandles.add(this,"suspended",Ra=>this._suspendedChange(Ra),2);this.updatingHandles.add(this.i3slayer,"labelsVisible",()=>this._labelingChanged(),2);this.updatingHandles.add(this.i3slayer,"labelingInfo",()=>this._labelingChanged(),2);this.updatingHandles.add(this,"_modifications",()=>this._modificationsChanged(),2);this.handles.add([m.init(Y,"I3S_TREE_SHOW_TILES",Ra=>{if(Ra&&!this._treeDebugger){const Ua=
this._controller.crsIndex;(new Promise(function(Wa,ab){a(["./support/I3STreeDebugger"],Wa,ab)})).then(({I3STreeDebugger:Wa})=>{!this._treeDebugger&&Y.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new Wa({lv:this,view:this.view,nodeSR:Ua}))})}else Ra||Y.I3S_TREE_SHOW_TILES||(this._treeDebugger=g.destroyMaybe(this._treeDebugger))}),m.init(Y,"I3S_SHOW_MODIFICATIONS",()=>this._showModifications())]);this._cacheKeySuffix=U.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(Ra=>
ma.warn(`Failed to initialize IndexedDB cache: ${Ra}`))};Qa.destroy=function(){this._clearAddTasks();this.attributeOverrides=g.destroyMaybe(this.attributeOverrides);this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const na=this._worker;na&&(na.destroyContext(this.i3slayer.uid).then(()=>
na.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=g.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=g.destroyMaybe(this._labeler);this._treeDebugger=g.destroyMaybe(this._treeDebugger);this._controller=g.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),
this._visibleGeometryChangedSchedulerHandle=null)};Qa.memEstimateTextureAdded=function(na){na=na.estimatedTexMemRequired;this.gpuMemoryEstimate+=na;this.texMemoryEstimate+=na;return na};Qa.memEstimateTextureRemoved=function(na){na=na.estimatedTexMemRequired;this.gpuMemoryEstimate-=na;this.texMemoryEstimate-=na};Qa.memEstimateGeometryAdded=function(na){na=this._collection.getObjectGPUMemoryUsage(na);this.gpuMemoryEstimate+=na;this.geoMemoryEstimate+=na;return na};Qa.memEstimateGeometryRemoved=function(na){na=
this._collection.getObjectGPUMemoryUsage(na);this.gpuMemoryEstimate-=na;this.geoMemoryEstimate-=na};Qa.isNodeLoaded=function(na){return this._nodeId2Meta.has(na)};Qa.isNodeReloading=function(na){return this._nodeId2MetaReloading.has(na)};Qa.getUsedMemory=function(){let na=g.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Aa=>na+=g.isSome(Aa)?Aa.node.memory:0);this._nodeId2MetaReloading.forEach(Aa=>na+=g.isSome(Aa)?Aa.node.memory:0);return na};Qa.getUnloadedMemory=function(){return(g.isSome(this._controller)?
this._controller.unloadedMemoryEstimate:0)+(g.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)};Qa.ignoresMemoryFactor=function(){return!1};Qa._labelingChanged=function(){if(!J.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)g.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!g.isSome(this._labeler)){var na=new R({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach(Aa=>g.isSome(Aa)&&this._addMetaToLabeler(na,Aa));
this._labeler=na}};Qa._loadAsyncModule=function(na){++this._asyncModuleLoading;return na.then(Aa=>{--this._asyncModuleLoading;return Aa},Aa=>{--this._asyncModuleLoading;throw Aa;})};Qa._modificationsChanged=function(){if(!this._i3sWasmLoaded&&this._hasModifications)this._i3sWasmLoaded=P.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var na=this.i3slayer.uid,Aa=this.i3slayer.spatialReference;this._worker.setModifications(na,
this._modifications,Aa);var Ra=S.toWasmModification(this._modifications,Aa);P.setModificationsSync({context:na,modifications:Ra,isGeodetic:Aa.isGeographic});this._controller.modificationsChanged();var Ua=this._hasModifications?new d:null;this._nodeId2Meta.forEach((Wa,ab)=>{g.isNone(Wa)?this._nodeId2Meta.delete(ab):Wa.node.hasModifications?(this._nodeId2Meta.delete(ab),this._nodeId2MetaReloading.set(ab,Wa)):g.isSome(Ua)&&Ua.push(Wa.node)});g.isSome(Ua)&&this._nodeId2MetaReloading.forEach(Wa=>Ua.push(Wa.node));
g.isSome(Ua)&&0<Ua.length&&(this.updateNodeModificationStatus(Ua),Ua.forAll(Wa=>{if(2!==Wa.imModificationImpact){const ab=this._nodeId2Meta.get(Wa.index);this._controller.invalidateGeometryVisibility(Wa.index);this._nodeId2Meta.delete(Wa.index);g.isSome(ab)&&this._nodeId2MetaReloading.set(Wa.index,ab)}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}};Qa._showModifications=function(){g.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),
this._modificationGraphics=null);if(Y.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var na={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Aa={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Ra of this._modifications)Ra.geometry.spatialReference=this.i3slayer.spatialReference,this._modificationGraphics.push(new y({geometry:Ra.geometry,symbol:{...Aa,color:na[Ra.type]}}));this.view.graphics.addMany(this._modificationGraphics)}};
Qa._addMetaToLabeler=function(na,Aa){na.addNodeMeta(Aa,(Ra,Ua)=>this._createAttributes(Ra,Ua))};Qa._suspendedChange=function(na){na?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};
Qa.getLoadedAttributes=function(na){na=this._nodeId2Meta.get(na);if(g.isSome(na)&&g.isSome(na.attributeInfo))return na.attributeInfo.loadedAttributes};Qa.getAttributeData=function(na){na=this._nodeId2Meta.get(na);if(g.isSome(na)&&g.isSome(na.attributeInfo))return na.attributeInfo.attributeData};Qa.setAttributeData=function(na,Aa){na=this._nodeId2Meta.get(na);g.isSome(na)&&g.isSome(na.attributeInfo)&&(na.attributeInfo.attributeData=Aa,this._attributeValuesChanged(na))};Qa.updateAttributes=function(){var na=
b._asyncToGenerator(function*(Aa,Ra,Ua){Aa=this._nodeId2Meta.get(Aa);g.isSome(Aa)&&(yield this.attributeOverrides.apply(Aa.featureIds,Ra,Ua),Aa.attributeInfo=Ra,this._attributeValuesChanged(Aa))});return function(Aa,Ra,Ua){return na.apply(this,arguments)}}();Qa._attributeValuesChanged=function(na){na.cachedRendererVersion=this._getInvalidRendererVersion();na.filteredIds=null;g.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(na,(Aa,Ra)=>this._createAttributes(Aa,Ra));this._updateEngineObject(na)};
Qa.clearMemCache=function(){g.isSome(this._memCache)&&this._memCache.clear()};Qa.getVisibleNodes=function(){const na=[];this._nodeId2Meta.forEach(Aa=>g.isSome(Aa)&&na.push(Aa.node));return na};Qa.getLoadedNodeIndices=function(na){this._nodeId2Meta.forEach((Aa,Ra)=>na.push(Ra));this._nodeId2MetaReloading.forEach((Aa,Ra)=>na.push(Ra))};Qa.preLoadBasis=function(){!w("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&2)&&g.applySome(this.i3slayer.textureSetDefinitions,na=>na.some(Aa=>Aa.formats.some(Ra=>
"basis"===Ra.format||"ktx2"===Ra.format)))&&wa.loadBasis()};Qa._getVertexBufferLayout=function(na,Aa){na={hasTexture:Fa(na.params.material),hasNormals:Aa.normal,hasRegions:Aa.uvRegion};return pa.glLayout(ua.createVertexBufferLayout(this._getGeometryParameters(na)))};Qa._getObjectIdField=function(){return this.i3slayer.objectIdField||"OBJECTID"};Qa._findGraphicNodeAndIndex=function(na){const Aa=T.attributeLookup(this.i3slayer.fieldsIndex,na.attributes,this._getObjectIdField());let Ra=null;l.someMap(this._nodeId2Meta,
Ua=>{if(g.isNone(Ua))return!1;const Wa=Ua.featureIds.indexOf(Aa);if(-1===Wa)return!1;Ra={node:Ua.node,index:Wa};return!0});return Ra};Qa._getGraphicIndices=function(na,Aa){na=this._nodeId2Meta.get(na.index);if(g.isNone(na))return[];const Ra=[],Ua=this._getObjectIdField(),Wa=this.i3slayer.fieldsIndex;for(const ab of Aa)Aa=T.attributeLookup(Wa,ab.attributes,Ua),Aa=na.featureIds.indexOf(Aa),-1!==Aa&&Ra.push(Aa);return Ra};Qa.whenGraphicBounds=function(na){na=this._findGraphicNodeAndIndex(na);if(!na)return Promise.reject();
var Aa=this._nodeId2Meta.get(na.node.index);if(g.isNone(Aa))return Promise.reject();na=ha.boundingBoxCornerPoints(na.index,this._collection,Aa.objectHandle,new Float64Array(24));if(G.projectBuffer(na,this.view.renderSpatialReference,0,na,this.view.spatialReference,0,8))return Aa=K.empty(),K.expandWithBuffer(Aa,na,0,8),Promise.resolve({boundingBox:Aa,screenSpaceObjects:[]})};Qa.whenGraphicAttributes=function(na,Aa){return U.whenGraphicAttributes(this.i3slayer,na,this._getObjectIdField(),Aa,()=>[...this._nodeId2Meta.values()].filter(g.isSome))};
Qa.getGraphicFromIntersectorMetadata=function(na){if(null==na.nodeIndex||null==na.componentIndex)return null;const Aa=this._nodeId2Meta.get(na.nodeIndex);return g.isNone(Aa)||null==Aa.featureIds||na.componentIndex>=Aa.featureIds.length?null:this._createGraphic(na.componentIndex,Aa)};Qa._getCacheKey=function(na){return`${this._layerUrl}/v${19}/${na.id}${this._cacheKeySuffix}`};Qa._getMemCacheKey=function(na,Aa=this.elevationOffset){return na+"#"+Aa};Qa.loadCachedGPUData=function(na){return g.isSome(this._memCache)?
this._memCache.pop(this._getMemCacheKey(na.index)):null};Qa.deleteCachedGPUData=function(na){g.isSome(na)&&this._deleteComponentObject(na)};Qa._cacheGPUData=function(na,Aa=this.elevationOffset){if(g.isNone(this._memCache))this._deleteComponentObject(na);else{var Ra=this._controller.indexDepth-na.node.level;this._memCache.put(this._getMemCacheKey(na.node.index,Aa),na,na.node.memory,Ra)}};Qa.loadMissingTextures=function(na,Aa,Ra,Ua){const Wa=na.filter((ab,eb)=>{if(0===(ab.usage&this.rendererTextureUsage))return!1;
if(g.isNone(Aa))return!0;ab=aa.selectEncoding(ab.encodings,this.supportedTextureEncodings);eb=Aa[eb];return g.isNone(eb)||null==eb.data||ab&&eb.encoding!==ab.encoding?!0:!1});return 0===Wa.length?Promise.resolve(!1):Ra(Wa,Ua).then(ab=>{let eb=0;for(let db=0;db<na.length;db++)eb<ab.length&&ab[eb].id===na[db].id&&(Aa[db]=ab[eb],eb++);return!0})};Qa.loadCachedNodeData=function(na,Aa,Ra){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(na),Aa).then(Ua=>{if(null==Ua)return null;if(Ua.nodeVersion!==
na.version)return this._idbCache.remove(this._getCacheKey(na)),null;na.geometryObb=Ua.geometryObb;return this.loadMissingTextures(Ua.requiredTextures,Ua.textureData,Ra,Aa).then(Wa=>{Wa&&this._idbCache.initialized&&g.isSome(Ua.textureData)&&(Ua.byteSize=Ma(Ua.transformedGeometry,Ua.textureData),Ua.textureData.every(La)&&Sa(na,Ua)&&this._idbCache.put(this._getCacheKey(na),Ua).catch(ab=>ma.warn(`Failed to update node with textures in IndexedDB cache: ${na.id}: ${ab}`)));c.throwIfAborted(Aa);return Ua})}):
Promise.resolve(null)};Qa.addNode=function(na,Aa,Ra){return"geometryData"in Aa?this._addData(na,Aa.attributeDataInfo,()=>this._transformNode(na,Aa,Ra).then(Ua=>this._safeReschedule(()=>{if(g.isNone(Ua))return na.hasModifications=!1,this._addCachedNodeData(na,null,Ra);na.hasModifications=Ua.transformedGeometry.hasModifications;const {obb:Wa,componentOffsets:ab,featureIds:eb,transformedGeometry:db}=Ua;var lb=W.computeGlobalTransformation(na.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference);
na.geometryObb=ia.create([Wa.center.x,Wa.center.y,Wa.center.z],[Wa.extents.x,Wa.extents.y,Wa.extents.z],[Wa.orientation.x,Wa.orientation.y,Wa.orientation.z,Wa.orientation.w]);B.transformMat4(na.geometryObb.center,na.geometryObb.center,lb);Aa.geometryData.componentOffsets=ab;eb&&(Aa.geometryData.featureIds=Array.prototype.slice.call(eb));lb={nodeVersion:na.version,geometryData:Aa.geometryData,requiredTextures:Aa.requiredTextures,textureData:Aa.textureData,transformedGeometry:db,globalTrafo:lb,geometryObb:na.geometryObb,
byteSize:Ma(db,Aa.textureData)};if(this._idbCacheEnabled&&this._idbCache.initialized&&Sa(na,lb)){const Ha=g.isSome(lb.textureData)?lb.textureData.map(Ka=>La(Ka)?Ka:null):null;this._idbCache.put(this._getCacheKey(na),{...lb,textureData:Ha}).catch(Ka=>ma.warn(`Failed to store node in IndexedDB cache: ${na.id}: ${Ka}`))}return this._addCachedNodeData(na,lb,Ra)},Ra))):Promise.reject()};Qa.computeVisibilityObb=function(na){return U.computeVisibilityObb(na,this.view.renderSpatialReference,this._controller.crsIndex,
this.i3slayer.spatialReference,this.elevationOffset,this._modifications)};Qa._transformNode=function(na,Aa,Ra){var Ua=Aa.geometryData.geometries;const Wa=Array(Ua.length);for(var ab=0;ab<Ua.length;++ab)Wa[ab]=this._getVertexBufferLayout(Ua[ab],Aa.geometryDescriptor);Ua=na.mbs;ab=this.elevationOffset;var eb=this._controller.crsIndex,db=this._controller.crsVertex;const lb=this.view.renderSpatialReference,Ha=W.getLocalOrigin(Ua,ab,eb),Ka=W.computeGlobalTransformation(Ua,ab,eb,lb);eb=G.getProjectorName(eb,
db);db=G.getProjectorName(db,lb);return g.isNone(eb)||g.isNone(db)?Promise.resolve(null):this._worker.invoke({context:this.i3slayer.uid,geometryBuffer:Aa.geometryBuffer,geometryData:Aa.geometryData,geometryDescriptor:Aa.geometryDescriptor,layouts:Wa,localOrigin:Ha,globalTrafo:Ka,mbs:Ua,obb:na.serviceObb,elevationOffset:ab,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:eb,vertexToRenderProjector:db},
Ra)};Qa._setNewNodeOpacity=function(na){this._setNodeOpacity(na,this.nodeCrossfadingEnabled?0:this.fullOpacity)};Qa.addCachedGPUData=function(na,Aa,Ra){na.geometryObb=ia.clone(this._collection.getComponentObb(Aa.objectHandle));this._controller.isGeometryVisible(na)?(g.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,Aa),na=na.index,this._addNodeMeta(na,Aa),this.updateNodeState(na,Ra),this._collection.setObjectVisibility(Aa.objectHandle,1),this._updateMaterial(Aa),this._setNewNodeOpacity(Aa),
this._updateEngineObject(Aa),this._highlights.objectCreated(Aa),g.isSome(this._treeDebugger)&&this._treeDebugger.update()):this._cacheGPUData(Aa)};Qa.addCachedNodeData=function(na,Aa,Ra,Ua){return this._addData(na,Ra,()=>this._addCachedNodeData(na,Aa,Ua))};Qa._addCachedNodeData=function(){var na=b._asyncToGenerator(function*(Aa,Ra,Ua){if(this.suspended||!this._controller.isGeometryVisible(Aa))this._removeNodeStageData(Aa.index,this.elevationOffset,this._nodeId2MetaReloading);else if(g.isNone(Ra))this._addNodeMeta(Aa.index,
null);else{var Wa=this._addTasks.get(Aa.index),{geometryData:ab,transformedGeometry:eb,globalTrafo:db}=Ra;yield this.attributeOverrides.apply(ab.featureIds,Wa.attributeInfo,Ua);var lb=g.isSome(Ra.textureData)?Ra.textureData.filter(sb=>g.isSome(sb)&&0!==(sb.usage&this.rendererTextureUsage)):[];!w("disable-feature:i3s-basis")&&lb.some(sb=>g.isSome(sb)&&(2===sb.encoding||1===sb.encoding))&&(yield wa.loadBasis());Aa.memory=0;var {componentOffsets:Ha,geometries:Ka,featureIds:Ga}=ab,Oa=this._collection,
za=Ka[0],{layout:Ba,indices:Va,interleavedVertexData:Ya,positionData:$a,hasColors:bb}=eb,cb=this._materialParameters(za,Ba),kb=Ha||new Uint32Array([0,Va?Va.length:Ya.byteLength/Ba[0].stride]);kb={vertices:{data:Ya,count:Ya.byteLength/Ba[0].stride,layoutParameters:cb.geometryParams},positionData:{positions:$a.data,indices:$a.indices},indices:Va,componentOffsets:kb};var tb=za.transformation?A.clone(za.transformation):A.create();C.multiply(tb,db,tb);za=C.getTranslation(D.create(),tb);tb=v.fromMat4(x.create(),
tb);var Ac=this.view.renderSpatialReference,Bc=this.view.basemapTerrain.spatialReference,jc=D.create(),kc=[1,1,1];G.localLinearScaleFactors(za,Ac,kc,Bc)||ma.errorOnce("Unsupported coordinate system for IM overlay");G.projectVectorToVector(za,Ac,jc,Bc);var Vb=Oa.createObject({toMapSpace:[jc[0],jc[1],kc[0],kc[1]],geometry:kb,obb:g.unwrap(Aa.geometryObb),transform:{position:za,rotationScale:tb}});lb=this._initMaterialAndTextures(Vb,cb.material,lb,2===cb.geometryParams.textureCoordinates);Aa.memory+=
this.memEstimateGeometryAdded(Vb);Aa.memory+=lb.reduce((sb,Cb)=>sb+(g.isSome(Cb)?this.memEstimateTextureAdded(Cb):0),0);kb=!!cb.material.hasParametersFromSource;cb="blend"!==cb.material.alphaMode&&1<=cb.material.metallicRoughness.baseColorFactor[3];var ub=new Ea(Aa,Ga,Vb,this._getInvalidRendererVersion(),Wa.attributeInfo,{hasParametersFromSource:kb,isOpaque:cb},lb);Wa.meta=ub;!this._hasTextures&&Ra.requiredTextures.some(({usage:sb})=>0!==(sb&19))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=
this._hasColors||bb;this._hasTextures=this._hasTextures||!!Aa.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var ed=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(ub).then(sb=>{g.isSome(sb)&&sb.updateObjectVisibility(ub.objectHandle,!1);return this._safeReschedule(()=>{var Cb=this._addTasks.get(Aa.index);if(Cb)if(g.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,ub),this._addNodeMeta(Aa.index,ub),Cb.meta=null,this.suspended)this._removeNodeStageData(Aa.index,
this.elevationOffset);else{Oa.setObjectVisibility(Vb,1);g.isSome(sb)&&sb.updateObjectVisibility(ub.objectHandle,!0);ub.attributeInfo=Cb.attributeInfo;Cb=ub.cachedRendererVersion!==this._rendererVersion;var Cc=ed!==this.slicePlaneEnabled;this._setObjectSymbolColors(ub);var Dc=this._applyFiltersToNode(ub);(Cb||g.isSome(sb)&&(Cc||Dc))&&this._addOrUpdateEdgeRendering(ub);this._visibleGeometryChanged(ub);this._highlights.objectCreated(ub);this._updateMaterial(ub);this._setNewNodeOpacity(ub);g.isSome(this._treeDebugger)&&
this._treeDebugger.update()}},Ua)}).catch(sb=>{g.isSome(Wa.meta)&&(this._deleteComponentObject(Wa.meta),Wa.meta=null);throw sb;})}});return function(Aa,Ra,Ua){return na.apply(this,arguments)}}();Qa._addNodeMeta=function(na,Aa){this._removeNodeStageData(na,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(na)){ma.error("Removing duplicated node");const Ra=this._nodeId2Meta.get(na);g.isSome(Ra)&&this._deleteComponentObject(Ra)}g.isSome(Aa)&&(Aa.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&
va(Aa.cachedEdgeMaterials,0));this._nodeId2Meta.set(na,Aa)};Qa._safeReschedule=function(na,Aa){c.throwIfAborted(Aa);return this._controller.reschedule(na,Aa)};Qa._materialParameters=function(na,Aa){na=na.params.material;const Ra=Aa.some(Wa=>"uvRegion"===Wa.name);Aa=Aa.some(Wa=>"normalCompressed"===Wa.name);const Ua=Fa(na);return{geometryParams:this._getGeometryParameters({hasTexture:Ua,hasNormals:Aa,hasRegions:Ra}),material:na}};Qa._initMaterialAndTextures=function(na,Aa,Ra,Ua){const Wa=this._stage.renderView,
ab=Ra.map(eb=>aa.createTexture(eb,Aa,Ua,Wa));for(const eb of ab)g.isSome(eb)&&this._stage.add(eb);this._collection.updateMaterial(na,eb=>{aa.configureMaterial(eb,Aa,ab,Ra,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR(),isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(eb)});return ab};Qa._getGeometryParameters=function(na){return{textureCoordinates:na.hasTexture?
na.hasRegions?2:1:0,colors:this._hasVertexColors,normals:na.hasNormals&&!this._isIntegratedMesh}};Qa._addData=function(na,Aa,Ra){let Ua=this._addTasks.get(na.index);Ua?Ua.attributeInfo=Aa:(Ua={...c.createResolver(),attributeInfo:Aa,meta:null},this._addTasks.set(na.index,Ua),Ra().then(Ua.resolve,Ua.reject).then(()=>this._addTasks.delete(na.index)).catch(Wa=>{this._addTasks.delete(na.index);throw Wa;}));return Ua.promise};Qa._clearAddTasks=function(){this._addTasks.forEach(na=>{g.isSome(na.meta)&&(this._deleteComponentObject(na.meta),
na.meta=null)});this._addTasks.clear()};Qa._clippingAreaChanged=function(){const na=K.create();ea.projectToBoundingBox(this.view.clippingArea,na,this.view.renderSpatialReference)?this._clippingArea=na:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};Qa._geometryFilterChange=function(){this._controller.geometryFilterChanged(this.hasGeometryFilter)};Qa._filterChange=function(){this._applyFilters(!1)};Qa._applyFilters=function(na){this._filters=
this.getFilters();na?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Aa=>{g.isSome(Aa)&&this._applyFiltersToNode(Aa)&&(this._addOrUpdateEdgeRendering(Aa),this._visibleGeometryChanged(Aa))})};Qa.getFilters=function(){const na=[];this._clippingArea&&na.push((Aa,Ra)=>this._boundingboxFilter(Aa,Ra,this._clippingArea));return na};Qa.addSqlFilter=function(na,Aa,Ra){if(g.isSome(Aa)){const Ua=Aa.fieldNames;na.push((Wa,ab)=>this._sqlFilter(Wa,ab,Aa,Ua,Ra))}};Qa._sqlFilter=function(na,
Aa,Ra,Ua,Wa){const ab={},eb=this._createLayerGraphic(ab),db=this.i3slayer.objectIdField,lb=Aa.featureIds,Ha=g.isSome(Aa.attributeInfo)&&Aa.attributeInfo.attributeData;Ua.every(Ka=>null!=Ha[Ka]||Ka===db)&&U.filterInPlace(na,lb,Ka=>{ab[db]=lb[Ka];for(const Ga of Ua)Ga!==db&&(ab[Ga]=U.getCachedAttributeValue(Ha[Ga],Ka));try{return Ra.testFeature(eb)}catch(Ga){return Wa(Ga),!1}})};Qa._boundingboxNodeTest=function(na,Aa){G.projectBoundingSphere(na.node.mbs,this._controller.crsIndex,da,this.view.renderSpatialReference);
return U.intersectBoundingBoxWithMbs(Aa,da)};Qa._boundingboxFeatureTest=function(na,Aa,Ra){return K.intersects(Ra,this._collection.getComponentAabb(na.objectHandle,Aa,Ca))};Qa._boundingboxFilter=function(na,Aa,Ra){var Ua=this._collection;const Wa=this._boundingboxNodeTest(Aa,Ra);if(3!==Wa)if(0===Wa)na.length=0;else if(Ua=Ua.getComponentCount(Aa.objectHandle),Ua.invisible+Ua.visible===Aa.featureIds.length){var ab=this._transformAABB(ka,Ra,Aa.objectHandle);U.filterInPlace(na,Aa.featureIds,eb=>this._boundingboxFeatureTest(Aa,
eb,ab))}};Qa._transformAABB=function(na,Aa,Ra){var Ua=this._collection.getObjectTransform(Ra);Ra=Ua.position;Ua=Ua.rotationScale;na[0]=(Aa[0]-Ra[0])/Ua[0];na[1]=(Aa[1]-Ra[1])/Ua[4];na[2]=(Aa[2]-Ra[2])/Ua[8];na[3]=(Aa[3]-Ra[0])/Ua[0];na[4]=(Aa[4]-Ra[1])/Ua[4];na[5]=(Aa[5]-Ra[2])/Ua[8];return na};Qa._addOrUpdateEdgeRendering=function(na,Aa=!0){if(g.isNone(this._edgeView))return Promise.resolve(null);const Ra=na.objectHandle,Ua=this._edgeView.hasObject(Ra),{hasEdges:Wa,perFeatureEdgeMaterials:ab}=this._getFilteredEdgeMaterials(na),
eb={slicePlaneEnabled:this.slicePlaneEnabled};if(Wa)return Ua?(this.nodeCrossfadingEnabled&&(na=this.getNodeOpacity(na),va(ab,na)),this._edgeView.updateAllComponentMaterials(Ra,ab,eb,Aa),this._edgeView.updateObjectVisibility(Ra,!0),Promise.resolve(this._edgeView)):this._collection.addEdges(Ra,this._edgeView,ab,eb).then(()=>this._edgeView);Ua&&this._edgeView.removeObject(Ra);return Promise.resolve(null)};Qa._removeEdgeRendering=function(na){g.isSome(this._edgeView)&&this._edgeView.hasObject(na.objectHandle)&&
this._edgeView.removeObject(na.objectHandle)};Qa._applyFiltersToNode=function(na){return this._applyFiltersToNodeComponents(na)?(g.isSome(this._labeler)&&this._labeler.applyFilterChange(na),!0):!1};Qa._applyFiltersToNodeComponents=function(na){const Aa=this._collection;var Ra=0===Aa.getComponentCount(na.objectHandle).invisible;Aa.setAllComponentVisibilities(na.objectHandle,"all");if(0===this._filters.length)return na.filteredIds=null,!Ra;this._updateCachedFilteredIds(na);if(na.filteredIds===na.featureIds)return!Ra;
Ra=this._computeFilteredComponentIndices(na);Aa.setAllComponentVisibilities(na.objectHandle,Ra);return!0};Qa._updateCachedFilteredIds=function(na){if(null==na.filteredIds||na.appliedFilters!==this._filters)na.filteredIds=this._computeFilteredIds(na),na.appliedFilters=this._filters};Qa._computeFilteredIds=function(na){const Aa=na.featureIds.slice();for(const Ra of this._filters)if(Ra(Aa,na),0===Aa.length)break;return Aa.length===na.featureIds.length?na.featureIds:Aa};Qa._computeFilteredComponentIndices=
function(na){const Aa=[];na.featureIds.forEach((Ra,Ua)=>{na.filteredIds[Aa.length]===Ra&&Aa.push(Ua)});return Aa};Qa._removeAllNodeDataFromStage=function(na=this.elevationOffset){this._nodeId2Meta.forEach((Aa,Ra)=>this._removeNodeStageData(Ra,na));this._nodeId2MetaReloading.forEach((Aa,Ra)=>this._removeNodeStageData(Ra,na,this._nodeId2MetaReloading))};Qa.removeNode=function(na){const Aa=this.elevationOffset;this._removeNodeStageData(na,Aa);this._removeNodeStageData(na,Aa,this._nodeId2MetaReloading)};
Qa._removeNodeStageData=function(na,Aa,Ra=this._nodeId2Meta){const Ua=Ra.get(na);g.isNone(Ua)?Ra.delete(na):(this._collection.setObjectVisibility(Ua.objectHandle,0),this._visibleGeometryChanged(Ua),this._removeEdgeRendering(Ua),g.isSome(this._labeler)&&this._labeler.removeNodeMeta(Ua),Ra.delete(na),this._highlights.objectDeleted(Ua),Ra===this._nodeId2Meta?(this._cacheGPUData(Ua,Aa),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Ua)):this._deleteComponentObject(Ua),g.isSome(this._treeDebugger)&&
this._treeDebugger.update())};Qa._deleteComponentObject=function(na){g.isSome(this._edgeView)&&this._edgeView.removeObject(na.objectHandle);this.memEstimateGeometryRemoved(na.objectHandle);this._collection.destroyObject(na.objectHandle);if(na.textures)for(const Aa of na.textures)this.memEstimateTextureRemoved(Aa),this._stage.remove(Aa)};Qa.updateNodeState=function(na,Aa){na=this._nodeId2Meta.get(na);g.isSome(na)&&this._collection.updateMaterial(na.objectHandle,Ra=>Ra.polygonOffsetEnabled=0===Aa)};
Qa._invalidateAllSymbols=function(){this._rendererVersion=U.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};Qa._getInvalidRendererVersion=function(){return U.addWraparound(this._rendererVersion,-1)};Qa._rendererChange=function(){var na=b._asyncToGenerator(function*(Aa){this._currentRenderer=Aa;this.notifyChange("rendererTextureUsage");this._rendererVersion=U.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=
null;this._invalidateAllSymbols();Aa&&(this._rendererFields=yield Aa.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&Aa&&"arcadeRequired"in Aa&&Aa.arcadeRequired&&(this._arcade=yield F.loadArcade());if(Aa&&"visualVariables"in Aa&&Aa.visualVariables)for(const Ra of Aa.visualVariables)"color"===Ra.type?this._colorVariable=Ra:"opacity"===Ra.type?this._opacityVariable=Ra:ma.warn(`Unsupported visual variable type for 3D Object Scene Services: ${Ra.type}`);if(Aa)for(const Ra of Aa.getSymbols())"mesh-3d"!==
Ra.type&&ma.error(`Symbols of type '${Ra.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()});return function(Aa){return na.apply(this,arguments)}}();Qa._getCachedEdgeMaterials=function(na){this._hasSymbolColors&&na.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(na);return na.cachedEdgeMaterials};Qa._getSymbolColors=function(na){this._hasSymbolColors&&na.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(na);
const Aa=na.cachedSymbology;return(Ra,Ua)=>{Ra*=5;E.set(Ua.externalColor,Aa[Ra+0]/255,Aa[Ra+1]/255,Aa[Ra+2]/255,Aa[Ra+3]/255);Ua.externalColorMixMode=Aa[Ra+4]&15;Ua.castShadows=0!==(Aa[Ra+4]&16);Ua.pickable=0!==(Aa[Ra+4]&32)}};Qa._getSymbolInfo=function(na,Aa){Aa=na&&na.getSymbol(Aa,{arcade:this._arcade});if(!(Aa instanceof L))return null;na=Aa.id;if(this._symbolInfos.has(na))return this._symbolInfos.get(na);Aa=U.getSymbolInfo(Aa);this._symbolInfos.set(na,Aa);return Aa};Qa._setSymbologyOverride=function(na,
Aa){this._symbologyOverride!==na&&(this._symbologyOverride=na,this._symbologyOverrideFields=Aa,this._invalidateAllSymbols(),this._updateSymbologyFields())};Qa._updateSymbologyFields=function(){this._symbologyFields=g.isSome(this._symbologyOverrideFields)&&0<this._symbologyOverrideFields.length?g.isSome(this._rendererFields)&&0<this._rendererFields.length?H.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};
Qa._updateCachedRendererData=function(na){na.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var Aa=this._tmpAttributeOnlyGraphic,Ra={};Aa.attributes=Ra;var Ua=this._currentRenderer,Wa=g.isSome(na.attributeInfo)&&na.attributeInfo.attributeData,ab=null!=na.featureIds?this.i3slayer.objectIdField:null,eb=null!=Wa&&g.isSome(this._symbologyFields)&&0<this._symbologyFields.length,db=eb?[]:null,lb=eb?[]:null;if(eb&&g.isSome(this._symbologyFields))for(var Ha of this._symbologyFields){var Ka=
Wa[Ha];Ka&&(db.push(Ha),lb.push(Ka))}na.cachedSymbology||(na.cachedSymbology=new Uint8Array(5*na.featureIds.length));Wa={color:Ja,castShadows:!0,pickable:!0,colorMixMode:1,edgeMaterial:null};Ha=this.fullOpacity;Ha=this.nodeCrossfadingEnabled?this.getNodeOpacity(na):Ha;Ka=null;var Ga=2,Oa=U.transparentEdgeMaterial,za=0;for(let $a=0;$a<na.featureIds.length;$a++){null!=ab&&(Ra[ab]=na.featureIds[$a]);if(eb)for(var Ba=0;Ba<db.length;Ba++)Ra[db[Ba]]=U.getCachedAttributeValue(lb[Ba],$a);var Va=this._getSymbolInfo(Ua,
Aa);let bb=Ba=null;if(Ua&&"visualVariables"in Ua){if(this._colorVariable){var Ya=I.getColor(this._colorVariable,Aa,{color:Ta,arcade:this._arcade});Ya&&(Ba=Ja,Ba[0]=Ya.r/255,Ba[1]=Ya.g/255,Ba[2]=Ya.b/255,this._opacityVariable||null===Ya.a||(bb=Ya.a))}this._opacityVariable&&(bb=I.getOpacity(this._opacityVariable,Aa,{arcade:this._arcade}))}Va&&Va.material&&(Ya=Va.material,Ba=g.isNone(Ba)||g.isNone(bb)?Q.overrideColor(Ba,bb,Ya.color,Ya.alpha,ta,Ja):Q.overrideColor(Ba,bb,null,null,ta,Ja));g.isNone(Ba)&&
(Ba=Ja,Ba[0]=1,Ba[1]=1,Ba[2]=1,Ba[3]=1);Wa.pickable=!0;Wa.castShadows=Va?Va.castShadows:!0;Wa.colorMixMode=Va&&Va.material?Va.material.colorMixMode:1;Wa.edgeMaterial=Va?Va.edgeMaterial:null;g.isSome(this._symbologyOverride)&&(Wa.color=Ba,this._symbologyOverride(Aa,Wa),Ba=Wa.color);if(g.isSome(Wa.edgeMaterial)){Va=0>=Ba[3]?0:1<=Ba[3]&&(na.material.isOpaque||3===Wa.colorMixMode)?2:1;if(Wa.edgeMaterial!==Ka||Va!==Ga)Oa={...Wa.edgeMaterial,opacity:Ha,objectTransparency:Va},Ka=Wa.edgeMaterial,Ga=Va;na.cachedEdgeMaterials[$a]=
Oa}else na.cachedEdgeMaterials[$a]=U.transparentEdgeMaterial;na.cachedSymbology[za+0]=Math.round(255*Ba[0]);na.cachedSymbology[za+1]=Math.round(255*Ba[1]);na.cachedSymbology[za+2]=Math.round(255*Ba[2]);na.cachedSymbology[za+3]=Math.round(255*Ba[3]);na.cachedSymbology[za+4]=Wa.colorMixMode|+Wa.castShadows<<4|+Wa.pickable<<5;za+=5}}};Qa._getFilteredEdgeMaterials=function(na){var Aa=this._getCachedEdgeMaterials(na);this.nodeCrossfadingEnabled||va(Aa,this.fullOpacity);if(g.isNone(na.filteredIds))return{hasEdges:Aa.some(Wa=>
Wa!==U.transparentEdgeMaterial),perFeatureEdgeMaterials:Aa};let Ra=0,Ua=!1;Aa=Aa.map((Wa,ab)=>{if(na.featureIds[ab]!==na.filteredIds[Ra])return U.transparentEdgeMaterial;Ua=Ua||Wa!==U.transparentEdgeMaterial;Ra++;return Wa});return{hasEdges:Ua,perFeatureEdgeMaterials:Aa}};Qa._setObjectSymbolColors=function(na){if(this._hasSymbolColors){var Aa=na.objectHandle;na=this._getSymbolColors(na);this._collection.setComponentData(Aa,na);this._stage.renderView.setNeedsRender()}};Qa._reloadAll=function(na=this.elevationOffset){this._removeAllNodeDataFromStage(na);
null!=this._controller&&this._controller.restartNodeLoading()};Qa._opacityChange=function(na){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(Aa=>{g.isNone(Aa)||(this._collection.updateMaterial(Aa.objectHandle,Ra=>Ra.objectOpacity=na),va(Aa.cachedEdgeMaterials,na),this._updateEdgeRendering(Aa))})};Qa._updateMaterial=function(na){this._collection.updateMaterial(na.objectHandle,Aa=>{Aa.commonMaterialParameters.slicePlaneEnabled=this.slicePlaneEnabled;
Aa.usePBR=this._usePBR();this._updateMaterialOverlay(Aa)})};Qa._updateMaterialOverlay=function(na){};Qa._updateEngineObject=function(na){this._setObjectSymbolColors(na);this._applyFiltersToNode(na);this._addOrUpdateEdgeRendering(na);this._visibleGeometryChanged(na)};Qa._slicePlaneEnabledChange=function(na){this._intersectionHandler&&(this._intersectionHandler.slicePlane=na);g.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=na);this._nodeId2Meta.forEach(Aa=>{g.isNone(Aa)||(this._collection.updateMaterial(Aa.objectHandle,
Ra=>{Ra.commonMaterialParameters.slicePlaneEnabled=na}),this._updateEdgeRendering(Aa,!1))})};Qa._updatePBR=function(){this._nodeId2Meta.forEach(na=>{g.isNone(na)||this._collection.updateMaterial(na.objectHandle,Aa=>{Aa.usePBR=this._usePBR()})});this._hasLoadedPBRTextures=!0};Qa._usePBR=function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled};Qa._updateEdgeRendering=function(na,Aa=!0){g.isSome(this._edgeView)&&this._edgeView.hasObject(na.objectHandle)&&this._addOrUpdateEdgeRendering(na,
Aa)};Qa._forAllNodes=function(na){this._nodeId2Meta.forEach(na)};Qa._forAllFeatures=function(na,Aa,Ra=0){l.someMap(this._nodeId2Meta,Ua=>{if(g.isNone(Ua))return!1;if(g.isSome(Aa))switch(Aa(Ua)){case 0:return!0;case 2:return!1}let Wa=1;switch(Ra){case 1:Wa=this._forAllFeaturesOfNode(Ua,na);break;case 0:Wa=this._forVisibleFeaturesOfNode(Ua,na);break;case 2:Wa=this._forAllFeaturesOfNodeInClippingArea(Ua,na)}return 0===Wa})};Qa._forAllFeaturesOfNode=function(na,Aa){let Ra=1;const Ua=na.featureIds;for(let Wa=
0;Wa<Ua.length&&(Ra=Aa(Ua[Wa],Wa,na),0!==Ra);Wa++);return Ra};Qa._forVisibleFeaturesOfNode=function(na,Aa){let Ra=1;const Ua=na.featureIds;this._collection.forEachVisibleComponent(na.objectHandle,Wa=>{Ra=Aa(Ua[Wa],Wa,na);return 1===Ra});return Ra};Qa._forAllFeaturesOfNodeInClippingArea=function(na,Aa){if(null==this._clippingArea)return this._forAllFeaturesOfNode(na,Aa);var Ra=this._boundingboxNodeTest(na,this._clippingArea);if(0===Ra)return 1;if(3===Ra)return this._forAllFeaturesOfNode(na,Aa);Ra=
na.featureIds;const Ua=U.getClipAABB(this._clippingArea,this._collection.getObjectTransform(na.objectHandle));for(let Wa=0;Wa<Ra.length;Wa++){if(!this._boundingboxFeatureTest(na,Wa,Ua))continue;const ab=Aa(Ra[Wa],Wa,na);if(0===ab)return ab}return 1};Qa._createAttributes=function(na,Aa){const Ra={};null!=Aa.featureIds&&(Ra[this._getObjectIdField()]=Aa.featureIds[na]);Aa=g.isSome(Aa.attributeInfo)&&Aa.attributeInfo.attributeData;if(g.isSome(Aa))for(const Ua of Object.keys(Aa))Ra[Ua]=U.getCachedAttributeValue(Aa[Ua],
na);return Ra};Qa._createGraphic=function(na,Aa){return this._createLayerGraphic(this._createAttributes(na,Aa))};Qa.highlight=function(na){const Aa=this._highlights;"number"===typeof na?na=[na]:na instanceof y?na=[na]:na instanceof f&&(na=na.toArray());if(Array.isArray(na)&&0<na.length){if(na[0]instanceof y){const Ra=this.i3slayer.fieldsIndex,Ua=this._getObjectIdField();na=na.map(eb=>T.attributeLookup(Ra,eb.attributes,Ua));const {set:Wa,handle:ab}=Aa.acquireSet();Aa.setFeatureIds(Wa,na);return ab}if("number"===
typeof na[0]){const {set:Ra,handle:Ua}=Aa.acquireSet();Aa.setFeatureIds(Ra,na);return Ua}}return qa};Qa._visibleGeometryChanged=function(na){this._elevationProvider&&(this._elevationProvider.objectChanged(na.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=u.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})))};Qa.getNodeOpacityByIndex=function(na){na=this._nodeId2Meta.get(na);return this.getNodeOpacity(na)};
Qa.getNodeOpacity=function(na){return g.isSome(na)?this._collection.getMaterial(na.objectHandle).objectOpacity:0};Qa.isNodeFullyFadedIn=function(na){return this._crossfadeHelper.isNodeFullyFadedIn(na)};Qa.getNodeCrossfadeMetaData=function(na){return this._nodeId2Meta.get(na)};Qa.markNodeToRemove=function(na){this._controller&&this._controller.markNodeToRemove(na)};Qa.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};Qa.foreachCrossfadeNode=function(na){this._nodeId2Meta.forEach((Aa,
Ra)=>na(Ra,Aa))};Qa.fadeNode=function(na,Aa,Ra){if(this.nodeCrossfadingEnabled){var Ua=this._nodeId2Meta.get(na);g.isSome(Ua)&&this._crossfadeHelper.fadeNode(na,Ua,Aa,Ra)}};Qa.setNodeOpacityByIndex=function(na,Aa){na=this._nodeId2Meta.get(na);g.isSome(na)&&this._setNodeOpacity(na,Aa)};Qa._setNodeOpacity=function(na,Aa){this._collection.updateMaterial(na.objectHandle,Ra=>Ra.objectOpacity=Aa);this._setNodeEdgeOpacity(na,Aa)};Qa._setNodeEdgeOpacity=function(na,Aa){g.isSome(this._edgeView)&&na.cachedEdgeMaterials&&
(va(na.cachedEdgeMaterials,Aa),na=na.objectHandle,this._edgeView.hasObject(na)&&this._edgeView.updateAllComponentOpacities(na,Aa))};Qa.updateNodeModificationStatus=function(na){var Aa=na.length;if(this._hasModifications&&!(0>=Aa)&&!0===this._i3sWasmLoaded){Aa=this.i3slayer.uid;var Ra=Ia(na);if(g.isSome(Ra)){P.filterObbsForModificationsSync({context:Aa,buffer:Ra.buffer});const Ua=new Float64Array(Ra.buffer);na.forAll((Wa,ab)=>{ab=P.interpretObbModificationResults(Ua[ab]);Wa.imModificationImpact=ab;
0!==ab&&this._controller.invalidateGeometryVisibility(Wa.index)})}}};Qa.notifyUpdate=function(){this.notifyChange("updating")};Qa.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};Qa.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||g.isSome(this._labeler)&&this._labeler.updating||this._crossfadeHelper.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading};b._createClass(Pa,[{key:"lodCrossfadeoutDuration",
get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return U.rendererNeedsTextures(this._currentRenderer)?this._usePBR()||
this._hasLoadedPBRTextures?63:37:this._usePBR()||this._hasLoadedPBRTextures?44:36}},{key:"elevationOffset",get:function(){const na=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=na&&"absolute-height"===na.mode){const Aa=h.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),Ra=N.getMetersPerUnit(na.unit);return g.unwrapOr(na.offset,0)*Ra/Aa}return 0}},{key:"supportedTextureEncodings",get:function(){return aa.getSupportedEncodings(this.view._stage.renderView.capabilities)}},
{key:"uncompressedTextureDownsamplingEnabled",get:function(){var na;const Aa=null==(na=this.view)?void 0:na.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled;na=0===(this.supportedTextureEncodings&4);return Aa&&na}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&0===this._modifications.length&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"supportsNodeCrossFading",get:function(){var na,Aa;return!(null!=(na=this.view)&&null!=(Aa=na._stage)&&
Aa.renderView.hasShadowsEnabled)}},{key:"nodeCrossfadingEnabled",get:function(){return this.supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},{key:"nodeFadeoutEnabled",get:function(){return this.supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"performanceInfo",get:function(){const na={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,
core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.getUnloadedMemory()/1048576).toFixed(1)+"MB"};g.isSome(this._memCache)&&(na.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(na.IDBCache=Math.round(100*
this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(na));return na}},{key:"test",get:function(){const na=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const Aa=[];na._forAllFeatures(Ra=>{Aa.push(Ra);return 1},null,0);Aa.sort((Ra,Ua)=>Ra-Ua);return Aa},get numNodes(){return na._nodeId2Meta.size}}}},{key:"_hasModifications",get:function(){return this._modifications&&0<this._modifications.length}}]);return Pa}(ra);r.__decorate([n.property()],ra.prototype,
"_hasLoadedPBRTextures",void 0);r.__decorate([n.property()],ra.prototype,"_asyncModuleLoading",void 0);r.__decorate([n.property()],ra.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);r.__decorate([n.property()],ra.prototype,"view",void 0);r.__decorate([n.property()],ra.prototype,"i3slayer",void 0);r.__decorate([n.property()],ra.prototype,"_controller",void 0);r.__decorate([n.property()],ra.prototype,"_labeler",void 0);r.__decorate([n.property()],ra.prototype,"updating",void 0);r.__decorate([n.property()],
ra.prototype,"suspended",void 0);r.__decorate([n.property()],ra.prototype,"holeFilling",void 0);r.__decorate([n.property(la.updatingProgress)],ra.prototype,"updatingProgress",void 0);r.__decorate([n.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],ra.prototype,"updatingProgressValue",void 0);r.__decorate([n.property({readOnly:!0})],ra.prototype,"hasTexturesOrVertexColors",null);r.__decorate([n.property({readOnly:!0})],ra.prototype,"rendererTextureUsage",null);r.__decorate([n.property({readOnly:!0})],
ra.prototype,"elevationOffset",null);r.__decorate([n.property({type:Boolean})],ra.prototype,"slicePlaneEnabled",void 0);r.__decorate([n.property()],ra.prototype,"supportedTextureEncodings",null);r.__decorate([n.property()],ra.prototype,"uncompressedTextureDownsamplingEnabled",null);r.__decorate([n.property({type:[O]})],ra.prototype,"_modifications",void 0);return ra=r.__decorate([k.subclass("esri.views.3d.layers.I3SMeshView3D")],ra)};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M){function H(R,S){return f.isSome(R)&&R.length===S.length&&R.every(P=>0<=J(S,P.name))}function J(R,S){S=S.toLowerCase();for(let P=0;P<R.length;P++)if(R[P].name.toLowerCase()===S)return P;return-1}const O=y.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");b=function(R){function S(Q){Q=R.call(this,Q)||this;Q.screenSizeFactor=0;Q.featureTarget=5E4;Q.fixedFeatureTarget=!1;Q.updating=!0;Q.updatingProgress=1;Q.leavesReached=
!1;Q.scaleVisibilityEnabled=!0;Q._featureLOD=1;Q._stableFeatureLOD=!1;Q._isIdle=!1;Q._cameraDirty=!0;Q._invisibleDirty=!1;Q._newLoadingNodes=new w({deallocator:null});Q._loadedNodeScales=new Map;Q._modificationsNodeFilteringArray=new w;Q._downloadingCount=0;Q._loadingNodes=new Map;Q._updatingNodes=new Map;Q._progressMaxNumNodes=1;Q._requiredAttributes=[];Q._requiredAttributesDirty=!0;Q._updatesDisabled=!1;Q.disableIDBCache=!1;Q._disableMemCache=!1;Q._restartNodeLoading=!1;Q._fields=null;Q._attributeStorageInfo=
null;Q._handles=new r;Q._idleQueue=new z;Q._elevationUpdateNodes=new w({deallocator:null});Q._errorCount=0;return Q}a._inheritsLoose(S,R);var P=S.prototype;P.initialize=function(){this._disableMemCache=!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData;this._lodHandling=new x(this.layerView);const Q=this.layerView.i3slayer;this.layer=Q;this._defaultGeometrySchema=Q.store.defaultGeometrySchema;this.disableIDBCache=q("disable-feature:idb-cache");"fields"in Q&&(this._fields=Q.fields,
this._attributeStorageInfo=Q.attributeStorageInfo);this.addResolvingPromise(Promise.all([this.layer.indexInfo,this.layer.when(),this.layerView.when()]).then(([V])=>{var ca;if(!this.destroyed&&this.layerView&&!this.layerView.destroyed){var ba=this.layerView.view;this._setClippingArea(ba.clippingArea);var Z=this.layerView.view.resourceController;this._handles.add([g.init(ba,"pointsOfInterest.focus.renderLocation",ha=>this._pointOfInterestChanged(ha)),Z.memoryController.events.on("quality-changed",()=>
this._setCameraDirty()),g.init(this.layerView,"suspended",ha=>{const fa=ha?()=>this._updateViewData():()=>this._updateIdleState(!0),aa=ha?()=>{}:()=>this._updateIdleState(!1);this._idleStateCallbacks?(ha&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=fa,this._idleStateCallbacks.idleEnd=aa):this._idleStateCallbacks=Z.scheduler.registerIdleStateCallbacks(fa,aa)}),k.addTask(this.layerView.view.resourceController.scheduler,{update:(ha,fa)=>this._frame(ha,fa),needsUpdate:()=>
this.updating}),this.watch("uncompressedTextureDownsamplingEnabled",()=>this.restartNodeLoading()),this.watch(["featureTarget","fixedFeatureTarget"],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),ba.state.watch("contentCamera",()=>this._setCameraDirty()),this.layer.watch("elevationInfo",()=>this._elevationInfoChanged()),this.layer.watch(["minScale","maxScale"],()=>this._scaleBoundsChanged()),this.layerView.watch("lodFactor",()=>this._setCameraDirty()),this.layerView.watch("availableFields?",
()=>this._requiredFieldsChange()),this.layerView.watch("holeFilling",ha=>f.isSome(this._index)&&(this._index.holeFilling=ha))]);this._updateScaleHandles();this._viewportQueries=new D(this.crsIndex,ba.renderCoordsHelper,ba.state.contentCamera,!ba.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,ba.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this.lod,angleDependentLoD:.5>this.lod});this._index=new v.I3SIndex(Q,
V,this.indexStreamController,this._viewportQueries,O,this.layerView.holeFilling,ha=>this.layerView.isNodeLoaded(ha),ha=>this.layerView.isNodeReloading(ha),ha=>this._shouldLoadNode(ha),ha=>this._enableFromGPUCache(ha,1),ha=>this._needsUpdate(ha),()=>!this.indexStreamController.busy,ha=>this.layerView.computeVisibilityObb?this.layerView.computeVisibilityObb(ha):null,null!=(ca=this.layerView)&&ca.computeNodeFiltering?ha=>this.layerView.computeNodeFiltering(ha):void 0);V=f.isSome(this.layer.modifications)&&
this.layer.modifications&&0<this.layer.modifications.length;this._index.imModificationsChanged(V);this._startNodeLoading()}}));this._tmpPoint=n.makeDehydratedPoint(0,0,0,this.crsIndex)};P.updateNodeModificationStatus=function(Q){const V=this._index,ca=this.layerView;f.isSome(V)&&ca&&ca.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),Q.forAll(ba=>{ba=V.getNode(ba);f.isSome(ba)&&this._modificationsNodeFilteringArray.push(ba)}),ca.updateNodeModificationStatus(this._modificationsNodeFilteringArray),
this._invisibleDirty=!0)};P.destroy=function(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;I.prune();f.isSome(F)&&(F.hide(),F=null)};P._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const Q=this._attributeStorageInfo,V=this._fields,ca=this.layer.objectIdField;return this.layerView.availableFields.map(ba=>
{const Z=J(Q,ba);ba=J(V,ba);return 0<=Z&&0<=ba?{index:Z,name:V[ba].name,field:V[ba],attributeStorageInfo:Q[Z]}:null}).filter(ba=>null!=ba&&ba.name!==ca)};P._requiredFieldsChange=function(){const Q=this._getRequiredAttributes();H(this._requiredAttributes,Q)||(this._requiredAttributes=Q,this._requiredAttributesDirty=!1,this.restartNodeLoading())};P.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};P._setClippingArea=function(Q){const V=h.create();E.projectToBoundingBox(Q,
V,this.layerView.view.renderSpatialReference)?this._clippingArea=V:this._clippingArea=null};P._pointOfInterestChanged=function(Q){f.isSome(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(Q),f.isSome(this._index)&&(this._index.progressiveLoadPenalty=L.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))};P.updateClippingArea=function(Q){this._setClippingArea(Q);f.isSome(this._viewportQueries)&&f.isSome(this._index)&&(this._viewportQueries.updateExtent(this._clippingArea),
this._index.invalidateVisibilityCache());this._setCameraDirty()};P._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};P.updateElevationChanged=function(Q,V){const ca=this._index;if(!f.isNone(ca)){var ba=ca.rootNode;if(!f.isNone(ba)){var Z=this._elevationUpdateNodes;Z.clear();B.findIntersectingNodes(Q,V,ba,this.crsIndex,ca,ha=>Z.push(ha.index));Z.forAll(ha=>{ca.invalidateBoundingVolumeCache(ha);ha===ba.index&&
this.notifyChange("rootNodeVisible")});Z.length&&this.restartNodeLoading()}}};P.getParentIndex=function(Q){return f.isSome(this._index)&&this._index.getParentIndex(Q)};P._elevationInfoChanged=function(){f.isSome(this._index)&&this._index.updateElevationInfo(this.layer.elevationInfo);this._setCameraDirty()};P._updateScaleHandles=function(){this._handles.remove("scale-bounds");this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",Q=>this._scaleUpdateHandler(Q)),
"scale-bounds")};P._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};P._scaleUpdateHandler=function(Q){this._updateScaleInBoundingRect(Q.scale,Q.extent,Q.spatialReference);this._setCameraDirty()};P._updateScaleInBoundingRect=function(Q,V,ca){const ba=this._index;f.isNone(ba)||!f.isNone(ba.rootNode)&&t.projectBoundingRect(V,ca,N,this.crsIndex)&&this._loadedNodeScales.forEach((Z,ha)=>{Z=ba.getNode(ha);f.isSome(Z)&&
m.containsPoint(N,Z.mbs)&&this._loadedNodeScales.set(ha,Q)})};P.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};P.schedule=function(Q,V){return this._idleQueue.push(Q,V)};P.reschedule=function(Q,V){return this._idleQueue.unshift(Q,V)};P._frame=function(Q,V){if(this.layerView.suspended)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||f.isNone(this._index))return-Infinity;this._processLogError(Q,
V);return this._index.getPriority()};P._processLogError=function(Q,V){try{this._process(Q,V)}catch(ca){50>this._errorCount?O.error("Error during processing: "+ca):50===this._errorCount&&O.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};P._process=function(Q,V){this._restartNodeLoading&&this._startNodeLoading();if(null!=this._nodeLoader&&!f.isNone(this._index)){this._updateViewData();this._invisibleDirty&&this._removeInvisibleNodes(Q)&&(this._invisibleDirty=
!1);this.isIntegratedMesh&&(Q.enabled=!1);Q.run(()=>this._processIndex(Q));this._updateFeatureLOD();Q.run(()=>this._processCache(Q));this.isIntegratedMesh&&(Q.enabled=!0);for(Q.run(()=>this._processNodes(Q,V));!Q.done&&this._idleQueue.process();)Q.madeProgress();Q.run(()=>this._prefetchIndex());V.numIndexLoading+=this._index.getIndexLoading();V.numNodesLoading+=this._downloadingCount;Q.run(()=>this._lodHandling.lodGlobalHandling(Q));this._evaluateUpdating()}};P._processIndex=function(Q){if(f.isNone(this._index))return!1;
this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update([...this._loadingNodes.keys()],Q,V=>this.updateNodeModificationStatus(V)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),Q=this._index.featureEstimate.leavesReached,this._index.isLoading()||Q===this._get("leavesReached")||this._set("leavesReached",Q));return this._index.load()};
P._prefetchIndex=function(){return f.isNone(this._index)||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};P._updateFeatureLOD=function(){if(this.isGraphics3D&&!f.isNone(this._index)&&!f.isNone(this._viewportQueries)){var Q=!this._index.isLoading(),V=this.featureTarget*this.baseLOD,ca=this._index.featureEstimate;ca.estimate=ca.estimate||V/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(Q&&
ca.estimate<V){if(ca.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(V/ca.estimate,1.001));Q=this.lod;V=this._index.checkFeatureTarget(V,Q);V!==Q&&(this._featureLOD=V/this.baseLOD,this._stableFeatureLOD=!0)}else if(ca.estimate>1.2*V||Q&&ca.estimate>V){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(ca.estimate/V-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);
this._index.requestUpdate()}};P._processCache=function(Q){const V=this._index;if(f.isNone(V))return!1;for(;0<this._newLoadingNodes.length&&!Q.done;){var ca=this._newLoadingNodes.pop();for(ca=V.getParent(ca);f.isSome(ca)&&!this.layerView.isNodeLoaded(ca.index)&&this._isNodeInScaleBounds(ca);ca=V.getParent(ca.index))if(this._enableFromGPUCache(ca,0)){Q.madeProgress();break}}return Q.hasProgressed};P._processNodes=function(Q,V){if(f.isNone(this._index))return!1;let ca=(this._isIdle?100:2)-this._loadingNodes.size;
const ba=this._index.updates;ba.cancel.forEach(this._cancelNode,this);for(ba.cancel=[];0<ba.remove.length&&!Q.done;)this.layerView.removeNode(ba.remove.pop()),Q.madeProgress();for(;0<ba.update.length&&!Q.done;){var Z=this._index.getNode(ba.update.pop());f.isSome(Z)&&(this._updateLoadedNode(Z),Q.madeProgress())}for(;0<ba.add.length&&!Q.done&&0<ca;){--ca;Z=this._index.getNode(ba.add.back());if(f.isNone(Z)||2!==Z.cacheState&&!this._hasNodeLoadToken(V))break;ba.add.pop();this._loadNode(Z);Q.madeProgress()}return Q.hasProgressed};
P._cancelAllNodes=function(){this._loadingNodes.forEach(Q=>Q.abort());this._loadingNodes.clear();this._updatingNodes.forEach(Q=>Q.abort());this._updatingNodes.clear()};P._cancelNode=function(Q){const V=this._loadingNodes.get(Q);V&&(V.abort(),this._loadingNodes.delete(Q))};P._hasNodeLoadToken=function(Q){return!this._isIdle&&2<=Q.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<G.maxDownloadSlots&&!this.dataStreamController.busy};P._evaluateUpdating=function(){var Q=!1,V=0;this.layerView.suspended?
V=(Q=this._cameraDirty)?0:1:(Q=f.isSome(this._index)?this._index.getIndexMissing():0,V=f.isSome(this._index)?this._index.updates.add.length:0,V=Q+3*V+2*this._loadingNodes.size,Q=!!(0<V||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===V&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(V,this._progressMaxNumNodes),V=1-V/this._progressMaxNumNodes);this.updating=Q;this.updatingProgress=
V};P._updateViewData=function(){if(this._cameraDirty&&!f.isNone(this._index)&&!f.isNone(this._viewportQueries)){var Q=this.layerView.view,{contentCamera:V,fixedContentCamera:ca}=Q.state;this.screenSizeFactor=1/(V.perScreenPixelRatio/2);this._viewportQueries.updateCamera(V,!ca||this.isGraphics3D);this._viewportQueries.setPointOfInterest(Q.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=
L.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};P._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};P.isGeometryVisible=function(Q){return f.isSome(this._index)&&this._index.isGeometryVisible(Q.index)};P.updateVisibility=function(Q){f.isSome(this._index)&&
this._index.invalidateNodeVisibilityCache(Q)};P.updateBoundingVolume=function(Q){f.isSome(this._index)&&this._index.invalidateBoundingVolumeCache(Q)};P.invalidateGeometryVisibility=function(Q){f.isSome(this._index)&&this._index.invalidateGeometryVisibility(Q)};P.invalidateVisibilityObbs=function(){f.isSome(this._index)&&this._index.invalidateVisibilityObbs()};P.modificationsChanged=function(){if(f.isSome(this._index)){const Q=f.isSome(this.layer.modifications)&&this.layer.modifications&&0<this.layer.modifications.length;
this._index.imModificationsChanged(Q)}this._invisibleDirty=!0};P._shouldLoadNode=function(Q){return this._lodHandling.shouldLoadNode(Q)&&!this._shouldDropNode(Q)&&this._isNodeInScaleBounds(Q)?f.isSome(this._index)?this._index.isGeometryVisible(Q.index):!1:!1};P._shouldDropNode=function(Q){if(f.isNone(this._viewportQueries))return!1;const V=this.lodDropFactor;return 1<=V||!this._lodHandling.hasNoVisibleChildren(Q)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(Q))-this._viewportQueries.minDistance>
(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*V};P._startNodeLoading=function(){this._restartNodeLoading=!1;const Q=this._index;this._updatesDisabled||f.isNone(Q)||f.isNone(this._viewportQueries)||(this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1),this._nodeLoader=new C(this.layer,this.dataStreamController,O,this._defaultGeometrySchema,this._requiredAttributes,{textureEncodings:this.layerView.supportedTextureEncodings,
uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:!this.isMeshPyramid}),Q.requestUpdate(),this._lodHandling.startNodeLoading(V=>this._isNodeInScaleBounds(V),(V,ca)=>this._removeNodes(V,ca,1),Q,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating())};P.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};P.cancelNodeLoading=function(){this.isNodeLoading()&&
(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};P._removeInvisibleNodes=function(Q){const V=this._index;if(f.isNone(V)||f.isNone(this._viewportQueries))return!1;I.clear();this.layerView.getLoadedNodeIndices(I);const ca=0===this._viewportQueries.maxDistance,ba=ca?()=>!1:Z=>this._shouldDropNode(Z);I.filterInPlace(Z=>{const ha=V.getNode(Z);return f.isNone(ha)||!V.isGeometryVisible(Z)||
ba(ha)||!this._isNodeInScaleBounds(ha)});0<I.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(I,Q,0);if(ca&&1>this.lodDropFactor)return!1;if(0===I.length)return!0;I.clear();return!1};P.markNodeToRemove=function(Q){I.push(Q)};P.removeMarkedNodes=function(){this._removeNodes(I,M.noBudget,0)};P._removeNodes=function(Q,V,ca){const ba=Q.length;if(0!==ba&&!V.done){for(f.isSome(this._index)&&this._index.requestUpdate();0<Q.length&&!V.done;){const Z=Q.pop(),ha=this._index;1===ca&&this.layerView.nodeFadeoutEnabled&&
f.isSome(ha)&&ha.isGeometryVisible(Z)?this.layerView.fadeNode(Z,1,!0):this.layerView.removeNode(Z);V.madeProgress()}if(0<this._loadedNodeScales.size)for(V=Q.length;V<ba;V++)this._loadedNodeScales.delete(Q.data[V])}};P._needsUpdate=function(Q){if(!Q.resources.hasFeatureData||this._updatingNodes.has(Q.index))return!1;Q=this.layerView.getLoadedAttributes(Q.index);return null!=Q&&Q!==this._requiredAttributes};P._updateLoadedNode=function(Q){const V=l.createAbortController();this._updatingNodes.set(Q.index,
V);const ca=this.layerView.getLoadedAttributes(Q.index);(H(ca,this._requiredAttributes)?Promise.resolve(this.layerView.getAttributeData(Q.index)):this._nodeLoader.loadAttributes(Q,this._requiredAttributes,V.signal)).then(ba=>this.schedule(()=>this.layerView.updateAttributes(Q.index,{loadedAttributes:this._requiredAttributes,attributeData:ba},V.signal),V.signal)).catch(ba=>{if(!l.isAbortError(ba))return this.layerView.updateAttributes(Q.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},
V.signal)}).catch(()=>{}).then(()=>{this._updatingNodes.delete(Q.index);this._evaluateUpdating()});this._evaluateUpdating()};P._loadNode=function(Q){if(this._loadingNodes.has(Q.index))O.error("already loading node "+Q.index);else{var V=l.createAbortController();this._loadingNodes.set(Q.index,V);var ca=()=>{this._loadingNodes.get(Q.index)===V&&this._loadingNodes.delete(Q.index);this._evaluateUpdating()};this._evaluateUpdating();this._loadAndAddNode(Q,V.signal).then(ca).catch(ba=>{ca();if(!l.isAbortError(ba))throw ba;
})}};P._loadAndAddNode=function(Q,V){return 1===Q.cacheState?this._loadUncached(Q,V):this._loadCached(Q,V).then(ca=>{ca||(Q.cacheState=1,f.isSome(this._index)&&this._index.updates.add.push(Q.index))}).catch(ca=>{if(!l.isAbortError(ca))throw Q.cacheState=1,ca;})};P._enableFromGPUCache=function(Q,V){if(this._disableMemCache||f.isNone(this._index))return!1;if(0===V&&!this._index.useNodeAsHole(Q.index))return!0;const ca=this._loadCachedGPUData(Q);if(!ca)return!1;this.layerView.addCachedGPUData(Q,ca,V);
this._nodeAdded();return!0};P._loadCachedGPUData=function(Q){Q=this.layerView.loadCachedGPUData(Q);if(f.isSome(Q)&&f.isSome(Q.attributeInfo)&&H(Q.attributeInfo.loadedAttributes,this._requiredAttributes))return Q;this.layerView.deleteCachedGPUData(Q);return null};P._nodeAdded=function(){f.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};P._loadCached=function(Q,V){if(this._enableFromGPUCache(Q,1))return Promise.resolve(!0);const ca=this.layerView;
return!this.disableIDBCache&&ca.loadCachedNodeData&&ca.addCachedNodeData?this.schedule(()=>ca.loadCachedNodeData(Q,V,(ba,Z)=>this._nodeLoader.loadTextures(Q,ba,Z)),V).then(ba=>{if(f.isNone(ba))return!1;const Z=this._requiredAttributes;return this.reschedule(()=>this._nodeLoader.loadAttributes(Q,Z,V),V).then(ha=>this.reschedule(()=>ca.addCachedNodeData(Q,ba,{loadedAttributes:Z,attributeData:ha},V),V)).then(()=>{this._nodeAdded();return!0})}):Promise.resolve(!1)};P._loadUncached=function(Q,V){this._downloadingCount++;
return this._nodeLoader.loadNodeData(Q,V).catch(ca=>{this._downloadingCount--;throw ca;}).then(ca=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(Q,ca,V),V)}).then(()=>{this._nodeAdded();Q.cacheState=2}).catch(ca=>{if(!l.isAbortError(ca))throw O.error("#loadNodeData()",this.layer,`Failed to load node '${Q.id}'`,ca),Q.failed=!0,f.isSome(this._index)&&this._index.requestUpdate(),ca;})};P._updateIdleState=function(Q){Q!==this._isIdle&&(this._isIdle=Q,this._evaluateUpdating(),
Q&&this._index&&f.isSome(this._index)&&this._index.resetFailedNodes())};P._getScale=function(Q){if(this._loadedNodeScales.has(Q.index))return this._loadedNodeScales.get(Q.index);this._tmpPoint.x=Q.mbs[0];this._tmpPoint.y=Q.mbs[1];this._tmpPoint.z=Q.mbs[2];const V=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);this.layerView.isNodeLoaded(Q.index)&&this._loadedNodeScales.set(Q.index,V);return V};P._isNodeInScaleBounds=function(Q){if(!this.areScaleBoundsActive)return!0;Q=this._getScale(Q);
const {minScale:V,maxScale:ca}=K.extractSafeScaleBounds(this.layer);return K.scaleBoundsPredicate(Q,V,ca)};P.updateStats=function(Q){Q.index=f.isSome(this._index)?this._index.size:0;this.isGraphics3D&&(Q.detail=this._featureLOD,Q.target=this.featureTarget*this.baseLOD);f.isSome(this._index)&&this._index.updateStats(Q)};P.notifyLODUpdate=function(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();f.isSome(this._index)&&this._index.requestUpdate()};P.geometryFilterChanged=function(Q){const V=
this._index;f.isSome(V)&&V.layerFilterChanged(Q);this.requestUpdate()};a._createClass(S,[{key:"isMeshPyramid",get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType}},{key:"isGraphics3D",get:function(){return"points"===this.layer.profile}},{key:"indexStreamController",get:function(){const Q=this.layerView.view.resourceController.createStreamDataRequester(2);return new A.I3SStreamDataController(Q,this.layer.apiKey)}},{key:"dataStreamController",get:function(){const Q=
this.layerView.view.resourceController.createStreamDataRequester(3);return new A.I3SStreamDataController(Q,this.layer.apiKey)}},{key:"crsVertex",get:function(){return B.getVertexCrs(this.layer)}},{key:"crsIndex",get:function(){return B.getIndexCrs(this.layer)}},{key:"rootNodeVisible",get:function(){if(f.isSome(this._index)){const Q=this._index.rootNode;if(f.isSome(Q))return this._updateViewData(),this._index.isNodeVisible(Q.index)}return!0}},{key:"index",get:function(){return this._index}},{key:"isIntegratedMesh",
get:function(){return"integrated-mesh"===this.layer.type}},{key:"areScaleBoundsActive",get:function(){const {minScale:Q,maxScale:V}=K.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<Q||0<V)}},{key:"unloadedMemoryEstimate",get:function(){return f.isNone(this._index)||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor}},{key:"indexDepth",get:function(){return f.isSome(this._index)?this._index.maxLevel:0}},{key:"disableMemCache",set:function(Q){this.layerView.loadCachedGPUData&&
this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=Q}},{key:"lod",get:function(){return this._featureLOD*this.baseLOD}},{key:"baseLOD",get:function(){const Q=this.layerView.lodFactor,V=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<Q?Q:1)*V}},{key:"lodDropFactor",get:function(){if(this.fixedFeatureTarget)return 1;const Q=this.layerView.view.resourceController.memoryController;return(Math.min(Q.memoryFactor,.5)-
Q.minQuality)/(.5-Q.minQuality)}},{key:"test",get:function(){const Q=this;return{index:this._index,set disableUpdates(V){(Q._updatesDisabled=V)?Q.cancelNodeLoading():Q.requestUpdate()},set disableIDBCache(V){Q.disableIDBCache=V},set ignoreServiceObb(V){f.isSome(Q._index)&&(Q._index.ignoreServiceObb=V)},shouldLoadNode:V=>Q._shouldLoadNode(V)}}}]);return S}(e.EsriPromiseMixin(b));p.__decorate([d.property({readOnly:!0})],b.prototype,"isMeshPyramid",null);p.__decorate([d.property({readOnly:!0})],b.prototype,
"isGraphics3D",null);p.__decorate([d.property({readOnly:!0})],b.prototype,"indexStreamController",null);p.__decorate([d.property({readOnly:!0})],b.prototype,"dataStreamController",null);p.__decorate([d.property({readOnly:!0})],b.prototype,"crsVertex",null);p.__decorate([d.property({readOnly:!0})],b.prototype,"crsIndex",null);p.__decorate([d.property()],b.prototype,"screenSizeFactor",void 0);p.__decorate([d.property()],b.prototype,"featureTarget",void 0);p.__decorate([d.property()],b.prototype,"fixedFeatureTarget",
void 0);p.__decorate([d.property()],b.prototype,"layerView",void 0);p.__decorate([d.property()],b.prototype,"layer",void 0);p.__decorate([d.property({})],b.prototype,"updating",void 0);p.__decorate([d.property({})],b.prototype,"updatingProgress",void 0);p.__decorate([d.property({readOnly:!0})],b.prototype,"leavesReached",void 0);p.__decorate([d.property({constructOnly:!0})],b.prototype,"scaleVisibilityEnabled",void 0);p.__decorate([d.property({readOnly:!0,dependsOn:[]})],b.prototype,"rootNodeVisible",
null);b=p.__decorate([u.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],b);const I=new w({deallocator:null});let F;const L={factorIM:.2,factor3dObject:.05,distancePenalty:10},N=m.create();return b})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/arrayUtils","../../../support/Scheduler"],function(a,p,b,r){let q=function(){function f(e){this.referenceCount=0;this.callbacks=[];this.runIndex=0;
this.handle=e.registerTask(r.TaskPriority.I3S_CONTROLLER,this)}var w=f.prototype;w.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)};w.runTask=function(e){this.sort();const l=this.callbacks,g={numIndexLoading:0,numNodesLoading:0};for(let d=0;d<l.length&&!e.done;++d)l[d].priority=l[d].update(e,g),this.runIndex=d};w.sort=function(){const e=this.callbacks;let l=e.length;for(let g=this.runIndex;0<g;g--){const d=e[g-1];let c=g;for(;c<e.length&&d.priority<=e[c].priority&&(c!==l||
d.priority<e[c].priority);)e[c-1]=e[c],c++;e[c-1]=d;l=c-1}this.runIndex=0};w.add=function(e){this.sort();e.priority=Infinity;this.callbacks.unshift(e)};w.remove=function(e){b.removeUnordered(this.callbacks,e);this.runIndex=this.callbacks.length;this.sort()};p._createClass(f,[{key:"running",get:function(){for(const e of this.callbacks)if(e.needsUpdate())return!0;return!1}}]);return f}();const y=new Map;a.addTask=function(f,w){let e=y.get(f);null==e&&(e=new q(f),y.set(f,e));e.add(w);return{remove:()=>
{null!=e&&(e.remove(w),0<e.callbacks.length||(y.delete(f),e.destroy()),e=null)}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../chunks/vec4f64 ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),function(a,p,b,r,q,y,f,w,e,l){function g(x){b.isSome(x.node)&&
(x.node.renderMbs[3]=-1,b.isSome(x.node.serviceObbInRenderSR)&&(x.node.serviceObbInRenderSR.halfSize[0]=-1));b.isSome(x.ref)&&(x.ref.renderMbs[3]=-1,b.isSome(x.ref.serviceObbInRenderSR)&&(x.ref.serviceObbInRenderSR.halfSize[0]=-1))}function d(x,C){return 0===C?0:x/C|0}function c(x,C){return 0===C?x:x%C}function u(x){if(x)for(let C=0;C<x.length;C++)for(const A of k)if(A[0]===x[C].metricType)return{lodMetric:A[1],maxError:x[C].maxError};return{lodMetric:0,maxError:0}}function t(x){return Math.sqrt(4/
Math.PI*x)}let h=function(x,C,A,B,D){this.childOffset=x;this.childCount=C;this.visibilityCache=A;this.ref=B;this.node=D;this.useAsHole=0;this.filterImpact=2},m=function(){function x(A,B,D,E,G,K,M,H,J,O,I,F,L,N){this.streamDataController=D;this.viewportQueries=E;this.logger=G;this.holeFilling=K;this._isLoaded=M;this._isReloading=H;this._isSelected=J;this._enable=O;this._needsUpdate=I;this._canRequest=F;this._computeVisibilityObb=L;this._computeNodeFiltering=N;this._dirty=!0;this._nodePages=[];this.lodMetric=
this.rootIndex=this.nodesPerPage=this.nodeCount=0;this.lodConversion=R=>R;this.urlPrefix="";this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState=new Map;this._version=e.addWraparound(0,2);this._visibilityCacheVersion=e.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;
this._missing=new r({deallocator:null});this._prefetch=new r({deallocator:null});this._updates=new z;this._imModificationUncategorized=new r({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._layerHasFilter=this.layerHasModifications=!1;this.logLayer=A;A.serviceUpdateTimeStamp&&A.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=`${A.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1;this.init(B)}var C=x.prototype;
C.init=function(A){if("page"===A.type){this.urlPrefix=A.urlPrefix;this.nodesPerPage=A.pageSize;this.rootIndex=A.rootIndex;switch(A.lodMetric){case "maxScreenThreshold":this.lodMetric=1;break;case "maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=t}this.addPage(d(this.rootIndex,this.nodesPerPage),A.rootPage)}else"node"===A.type&&(this.urlPrefix=A.urlPrefix,this._nodePages.push({nodes:[],children:[],parents:[]}),this.makeRefNode(new w.NodeBase(A.rootNode.id,null),-1),(A=this._validateNode(A.rootNode.id,
A.rootNode))&&this.addNode(A,0))};C.loadPage=function(A){this._loading.add(A);this.streamDataController.request(this.urlPrefix+A,"json").then(B=>{this._loading.delete(A);this.addPage(A,B)}).catch(B=>{this._loading.delete(A);q.isAbortError(B)||(this._failedPages.add(A),this.logger.error("#loadPage()",this.logLayer,`Error when loading page ${A}`,B))})};C.addPage=function(A,B){for(let G=this._nodePages.length;G<A;G++)this._nodePages[G]=null;const D=[],E=[];B=B.nodes.map((G,K)=>{const M=D.length,H=G.children?
G.children.length:0;E.push(-1);for(var J=0;J<H;J++)D.push(G.children[J]);const O=`${G.index}`;J=l.clone(G.obb);const I=f.fromArray([J.center[0],J.center[1],J.center[2],y.length(J.halfSize)]),F=G.mesh&&G.mesh.attribute,L=G.mesh&&G.mesh.geometry,N=G.mesh&&G.mesh.material;G=new w.Node(O,A*this.nodesPerPage+K,I,H,0,{hasSharedResource:!1,hasFeatureData:!!L,attributes:F&&null!=F.resource?`${F.resource}`:null,geometry:L&&null!=L.resource?`${L.resource}`:null,texture:N&&null!=N.resource?`${N.resource}`:null,
geometryDefinition:L?L.definition:-1,materialDefinition:N?N.definition:-1},this.lastUpdate,this.lodMetric,this.lodConversion(G.lodThreshold),L?L.featureCount:null);G.serviceObb=J;G.visibilityObb=this._computeVisibilityObb(G);G.vertexCount=L?L.vertexCount:0;return new h(M,H,e.addWraparound(this._visibilityCacheVersion,-2),null,G)});this._nodePages[A]={nodes:B,children:D,parents:E};this.nodeCount+=B.length;this.updateParentsAndLevel()};C.updateParentsAndLevel=function(){const A=[],B=(D,E,G)=>{const K=
this.getPage(D);if(b.isSome(K)){const M=c(D,this.nodesPerPage);K.parents[M]=E;E=K.nodes[M].node;b.isSome(E)&&(E.level=G,A.push(D))}};for(B(this.rootIndex,-1,0);A.length;){const D=A.pop(),E=this.getNode(D);if(b.isSome(E))for(let G=0;G<E.childCount;G++){const K=this.getChildIndex(E,G);B(K,D,E.level+1);this._maxLevel=Math.max(this._maxLevel,E.level+1)}}};C.getPage=function(A){return this._nodePages[d(A,this.nodesPerPage)]};C.getNodeInternal=function(A){const B=this.getPage(A);return b.isNone(B)?null:
B.nodes[c(A,this.nodesPerPage)]};C.addNode=function(A,B){null!=A.children&&this.populateChildren(B,A.children);var D=this.getParent(B);D=b.isSome(D)?D.level+1:0;this._maxLevel=Math.max(this._maxLevel,A.children?D+1:D);const {lodMetric:E,maxError:G}=u(A.lodSelection),K=b.unwrap(this.getNodeInternal(B));K.node=new w.Node(A.id,B,f.fromArray(A.mbs),K.childCount,D,A.resources,A.version,E,G,A.numFeatures);A.obb&&(K.node.serviceObb=l.clone(A.obb));K.node.visibilityObb=this._computeVisibilityObb(K.node);
b.isSome(K.ref)&&(null==K.ref.mbs&&(K.ref.mbs=A.mbs),K.node.renderMbs=K.ref.renderMbs,K.node.serviceObbInRenderSR=K.ref.serviceObbInRenderSR,K.ref.visibilityObb=K.node.visibilityObb);return K.node};C.makeRefNode=function(A,B){const D=this._nodePages[0],E=D.nodes.length;D.nodes.push(new h(0,0,e.addWraparound(this._visibilityCacheVersion,-2),A,null));this.nodeCount++;D.parents.push(B);A.renderMbs[3]=-1;b.isSome(A.serviceObbInRenderSR)&&(A.serviceObbInRenderSR.halfSize[0]=-1);return E};C.populateChildren=
function(A,B){var D=b.unwrap(this.getNodeInternal(A));const E=b.unwrap(this.getPage(A));D.childOffset=E.children.length;D.childCount=B.length;for(D=0;D<B.length;D++){const G=this.makeRefNode(B[D],A);E.children.push(G)}};C.getNode=function(A){A=this.getNodeInternal(A);return b.isSome(A)?A.node:null};C.getIndexById=function(A){let B;this.forAllNodes((D,E)=>{b.isSome(D.node)&&D.node.id===A?B=E:b.isSome(D.ref)&&D.ref.id===A&&(B=E)});return B};C.getNodeById=function(A){A=this.getIndexById(A);return 0<=
A?this.getNode(A):null};C.getChildIndex=function(A,B){const D=this.getPage(A.index);if(b.isNone(D))return-1;A=D.nodes[c(A.index,this.nodesPerPage)];return D.children[A.childOffset+B]};C.getParentIndex=function(A){const B=this.getPage(A);return b.isSome(B)?B.parents[c(A,this.nodesPerPage)]:-1};C.getParent=function(A){A=this.getParentIndex(A);return 0<=A?this.getNode(A):null};C.isLeaf=function(A){A=this.getNodeInternal(A);return b.isSome(A)&&0===A.childCount};C.invalidateVisibilityCache=function(){this._visibilityCacheVersion=
e.addWraparound(this._visibilityCacheVersion,2)};C.invalidateNodeVisibilityCache=function(A){A=this.getNodeInternal(A);b.isSome(A)&&this.invalidateNodeVisibilityCacheInternal(A)};C.invalidateNodeVisibilityCacheInternal=function(A){A.visibilityCache=e.addWraparound(this._visibilityCacheVersion,-2)};C.invalidateBoundingVolumeCache=function(A){A=this.getNodeInternal(A);b.isSome(A)&&(g(A),this.invalidateNodeVisibilityCacheInternal(A))};C.invalidateGeometryVisibility=function(A){A=this.getNodeInternal(A);
b.isSome(A)&&b.isSome(A.node)&&(A.node.geometryObb=null,A.node.renderMbs[3]=-1,b.isSome(A.node.serviceObbInRenderSR)&&(A.node.serviceObbInRenderSR.halfSize[0]=-1))};C.invalidateVisibilityObbs=function(){b.isNone(this.rootNode)||this.traverse(this.rootNode,A=>{A.visibilityObb=this._computeVisibilityObb(A);A.geometryObb=null;return!0})};C.isNodeVisible=function(A){A=this.getNodeInternal(A);if(b.isNone(A)||b.isSome(A.ref)&&!A.ref.mbs)return!0;if((A.visibilityCache&-2)!==this._visibilityCacheVersion){var B=
A.node;const E=b.isSome(B)&&(b.isNone(A.ref)||b.isSome(B.visibilityObb))?B:b.isSome(A.ref)?A.ref:null;if(this._layerHasFilter&&this._computeNodeFiltering&&(b.isSome(B)||b.isSome(A.ref))&&2===A.filterImpact){var D=b.isSome(B)?B.mbs:b.isSome(A.ref)?A.ref.mbs:null;A.filterImpact=null!=D?this._computeNodeFiltering(D):0}D=b.isSome(B)&&1===A.filterImpact;B=!(b.isSome(B)&&2===B.imModificationImpact)&&(!E||this.viewportQueries.isNodeVisible(E))&&!D;A.visibilityCache=this._visibilityCacheVersion+(B?1:0);return B}return 1===
(A.visibilityCache&1)};C.isGeometryVisible=function(A){if(!this.isNodeVisible(A))return!1;A=this.getNodeInternal(A);return b.isSome(A)&&b.isSome(A.node)&&b.isSome(A.node.geometryObb)&&(!this.layerHasModifications||4!==A.node.imModificationImpact)?this.viewportQueries.isGeometryVisible(A.node):!0};C._traverseCoverage=function(A,B,D,E,G){A=this.getPage(A);if(!b.isNone(A)&&0!==B.childCount){var K=B.childOffset+B.childCount,M=[];for(B=B.childOffset;B<K;++B){const H=A.children[B],J=this.getNodeInternal(H);
b.isSome(J)&&b.isSome(J.node)&&this.isGeometryVisible(H)&&M.push(J)}E/=M.length;for(const H of M)A=b.unwrap(H.node).index,this._isLoaded(A)||this._isReloading(A)?(G.delta=Math.max(G.delta,D),G.coverage+=E):this._traverseCoverage(A,H,D+1,E,G)}};C.useNodeAsHole=function(A){if("off"===this.holeFilling)return!1;const B=this.getNodeInternal(A);if(b.isNone(B))return!1;if("always"===this.holeFilling)return!0;if((B.useAsHole&-2)===this._version)return 1===(B.useAsHole&1);const D={delta:0,coverage:0};this._traverseCoverage(A,
B,0,1,D);A=.5>=D.delta*D.coverage;B.useAsHole=this._version+(A?1:0);return A};C.destroy=function(){this._updates.add.prune();this._updates.update.prune()};C.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;this._version=e.addWraparound(this._version,2)};C.imModificationsChanged=function(A){this.layerHasModifications=A;this.forAllNodes(({node:B})=>{b.isSome(B)&&(B.imModificationImpact=4,B.visibilityObb=this._computeVisibilityObb(B),B.hasModifications&&this.invalidateGeometryVisibility(B.index))});
this.invalidateVisibilityCache()};C.layerFilterChanged=function(A){this._layerHasFilter=A;this.forAllNodes(B=>{b.isSome(B)&&(B.filterImpact=2,B=B.node,b.isSome(B)&&this.invalidateNodeVisibilityCache(B.index))});this.invalidateVisibilityCache()};C.update=function(A,B,D){if(this._dirty){this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(A,this._missing);n.clear();var E=!0,G=new v,K=new v,M=this._imModificationUncategorized;
M.clear();var H=new Set;this.traverseVisible((O,I,F)=>{if(b.isNone(I))I=this.entryPriority(O),Infinity===I&&(I=this.entryPriority(F)),O=d(O,this.nodesPerPage),n.set(O,Math.max(I,n.get(O)||0)),this._loading.has(O)||this._failedPages.has(O)||this._missing.push(O),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,I);else{var L=I.node;this._updateNodeFeatureEstimate(L,K);if(b.isNone(L))I=this.entryPriority(O),this._loading.has(O)||this._failedNodes.has(O)||(this._missing.push(O),n.set(O,I)),this._maxProcessingPrio=
Math.max(this._maxProcessingPrio,I);else{F=b.unwrap(this.getPage(O));if(0===this._missing.length&&0===this.nodesPerPage)for(let N=0;N<I.childCount;N++){const R=F.children[I.childOffset+N],S=this.getNodeInternal(R);!b.isSome(S)||S.node||this._loading.has(R)||this._failedNodes.has(R)||(n.set(R,this.entryPriority(R)),this._prefetch.push(R))}!L.failed&&L.resources.hasFeatureData&&(H.add(L.id),this._isLoaded(O)?(G.known+=L.memory,++G.knownNodes,this._isSelected(L)?0<I.childCount&&(E=!1):(G.unremoved+=
L.memory,E=!1),this._needsUpdate(L)&&(I=this.entryPriority(O),n.set(O,I),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,I),this._updates.update.push(O))):(L.memory&&(G.known+=L.memory,++G.knownNodes),this._isSelected(L)?(0<I.childCount&&(E=!1),L.memory?(G.missing+=L.memory,G.known+=L.memory,++G.knownNodes):++G.missingNodes,0<=A.indexOf(L.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this.entryPriority(O)),this._updates.cancel=this._updates.cancel.filter(N=>N!==L.index)):
!B.done&&this._enable(L)?B.madeProgress():(I=this.entryPriority(O),n.set(O,I),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,I),this._updates.add.push(O),this.layerHasModifications&&D&&b.isSome(L)&&4===L.imModificationImpact&&M.push(O))):this._isReloading(O)&&this._updates.remove.push(O)))}}});var J=this._updates.add;0<J.length&&this.layerHasModifications&&(0<M.length&&D(M),J.filterInPlace(O=>{var I=this.getNodeInternal(O);(I=b.isNone(I)||b.isNone(I.node)||2!==I.node.imModificationImpact)||
this.invalidateNodeVisibilityCache(O);return I}));this._unloadedMemoryEstimate=G.missing-G.unremoved;3<G.knownNodes&&0<G.missingNodes&&(this._unloadedMemoryEstimate+=G.known/G.knownNodes*G.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(K);this._featureEstimate.leavesReached=E;this._missing.sort((O,I)=>O-I);this._missing.filterInPlace((O,I)=>1>I||this._missing.data[I-1]!==O);this._missing.sort((O,I)=>
n.get(O)-n.get(I));0<this._missing.length&&(this._maxUnloadedPrio=n.get(this._missing.back()),this._prefetch.clear());this._updates.add.filterInPlace(O=>n.get(O)>=this._maxUnloadedPrio).sort((O,I)=>n.get(O)-n.get(I));this._updates.update.sort((O,I)=>n.get(O)-n.get(I));this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;n.clear()}};C.checkFeatureTarget=function(A,B){const D=this.viewportQueries.updateScreenSpaceErrorBias(B);let E=B,G=B,K=D,M=10;for(;M--;){const H=
new v;this._updateFeatureEstimate(E,H);if(this._computeFeatureEstimate(H)<=A){if(E>=B||0<H.missingNodes||0===M)break;K=E;E=.5*(E+G)}else G=E,E=.5*(E+K)}this._version=e.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(D);return Math.min(B,E)};C._updateFeatureEstimate=function(A,B){this._version=e.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(A);this.traverseVisible((D,E)=>this._updateNodeFeatureEstimate(b.isSome(E)&&E.node,B))};C._updateNodeFeatureEstimate=
function(A,B){b.isNone(A)||A.failed||b.isNone(A.numFeatures)||(this._isLoaded(A.index)?(B.known+=A.numFeatures,++B.knownNodes,this._isSelected(A)||(B.unremoved+=A.numFeatures)):this._isSelected(A)&&(b.isSome(A.numFeatures)?(B.missing+=A.numFeatures,B.known+=A.numFeatures,++B.knownNodes):++B.missingNodes))};C._computeFeatureEstimate=function(A){let B=A.known-A.unremoved;3<A.knownNodes&&0<A.missingNodes&&(B+=A.known/A.knownNodes*A.missingNodes);return Math.max(0,B)};C.load=function(){return this._load(this._missing)};
C.prefetch=function(){this._prefetch.sort((A,B)=>n.get(A)-n.get(B));return this._load(this._prefetch)};C._load=function(A){if(0===A.length||!this._canRequest())return!1;for(;0<A.length&&this._canRequest();)0===this.nodesPerPage?this._loadNode(A.pop()):this.loadPage(A.pop());return!0};C.isLoading=function(){return 0<this._indexMissing};C.getIndexLoading=function(){return this._loading.size};C.getIndexMissing=function(){return this._indexMissing};C.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};
C.nodeTraversalState=function(A){if(b.isNone(A))return null;let B=this._nodeTraversalState.get(A.index);if(B&&(B.version&-2)===this._version)return B;const D=this.viewportQueries.getLodLevel(A),E=this.viewportQueries.hasLOD(A);var G=!0;E?(G=this.getParentIndex(A.index),G=0<=G?(G=this._nodeTraversalState.get(G))&&D>G.lodLevel:0<D):G=0===A.childCount;if(B)return B.lodLevel=D,B.isChosen=G,B.version=this._version+1,B;B=new w.NodeTraversalState(E,G,D,this._version+1);this._nodeTraversalState.set(A.index,
B);return B};C._loadNode=function(A){this._loading.add(A);const B=b.unwrap(this.getNodeInternal(A)).ref;if(b.isNone(B))this._failedNodes.add(A);else{var D=B.id,E=this.urlPrefix+D,G=()=>{this._loading.delete(A);0===this._missing.length&&0===this._loading.size&&this.requestUpdate()};this.streamDataController.request(E,"json").then(K=>{G();K=this._validateNode(D,K);null!=K&&(K.obb&&this.invalidateNodeVisibilityCache(A),K=this.addNode(K,A),this.nodeTraversalState(K))},K=>{G();q.isAbortError(K)||(this.logger.error("#loadNode()",
this.logLayer,"Error loading node: "+E),this._failedNodes.add(A))})}};C._validateNode=function(A,B){if(null==B||"object"!==typeof B||B.id!==A)return this.logger.error("#validateNode()",this.logLayer,`Invalid node. Wrong type or wrong id "${A}"`),null;if(!Array.isArray(B.mbs))return this.logger.error("#validateNode()",this.logLayer,`Invalid bounding volume on node ${A}.`),null;B.sharedResource&&"./shared"!==B.sharedResource.href&&"./shared/"!==B.sharedResource.href&&this.logger.warn("#validateNode()",
this.logLayer,`Invalid shared resource href on node "${A}"`);null==B.geometryData||Array.isArray(B.geometryData)&&1===B.geometryData.length&&"./geometries/0"===B.geometryData[0].href||this.logger.warn("#validateNode()",this.logLayer,`Invalid geometry data on node "${A}"`);null==B.attributeData||Array.isArray(B.attributeData)&&!B.attributeData.some((K,M)=>K.href!==`./attributes/f_${M}/0`)||this.logger.warn("#validateNode()",this.logLayer,`Invalid attribute data on node "${A}"`);B.featureData&&1<B.featureData.length&&
this.logger.warn("#validateNode()",this.logLayer,`Node ${A} has ${B.featureData.length} bundles. Only the first bundle will be loaded.`);const D=B.hasOwnProperty("obb")&&!this.ignoreServiceObb?B.obb:null,E=B.featureData&&1===B.featureData.length&&B.featureData[0].featureRange?B.featureData[0].featureRange[1]-B.featureData[0].featureRange[0]+1:null;var G=K=>{if(null==K)return null;var M=H=>this.logger.error("#validateNode()",this.logLayer,`Invalid node reference on node ${A}: ${H}`);if("number"===
typeof K.id)M(`id ${K.id} is a number instead of a string.`);else if("string"!==typeof K.id||!Array.isArray(K.mbs))return M("Missing or invalid id."),null;if(!Array.isArray(K.mbs))return M(`Invalid bounding volume on reference ${K.id}.`),null;K.href&&K.href!=="../"+K.id&&this.logger.error("#validateNode()",this.logLayer,`Invalid node href on node "${A}"`);M=K.hasOwnProperty("obb")&&!this.ignoreServiceObb?K.obb:null;K=new w.NodeBase(`${K.id}`,K.mbs);K.serviceObb=M;K.visibilityObb=this._computeVisibilityObb(K);
return K};G=Array.isArray(B.children)?B.children.map(G).filter(K=>null!=K):null;return{id:A,mbs:B.mbs,obb:D,children:G,resources:{hasFeatureData:B.featureData&&0<B.featureData.length,hasSharedResource:null!=B.sharedResource,attributes:B.attributeData?A:null,texture:B.textureData&&0<B.textureData.length?A:null,geometry:null!=B.geometryData?A:null},version:"string"===typeof B.version?B.version:null,lodSelection:Array.isArray(B.lodSelection)?B.lodSelection:null,numFeatures:E}};C.resetFailedNodes=function(){this._failedNodes.clear();
this._failedPages.clear();this.forAllNodes(A=>{b.isSome(A.node)&&(A.node.failed=!1)})};C.entryPriority=function(A){var B=this.getNodeInternal(A),D=this.getParentIndex(A);if(b.isNone(B)||0>D&&null==B.node)return 0>D?Infinity:this.entryPriority(D);let E=0;B.node&&0<=D&&(D=this._nodeTraversalState.get(D),null!=D&&(E=D.lodLevel));for(D=this.progressiveLoadPenalty;0<=A;A=this.getParentIndex(A))if(this._isLoaded(A)){D=0;break}B=b.isSome(B.ref)?this.viewportQueries.distToPOI(B.ref):b.isSome(B.node)?this.viewportQueries.distToPOI(B.node):
0;return-B-E*(B+this.progressiveLoadPenalty)+D};C.traverseVisible=function(A){const B=this.getNodeInternal(this.rootIndex);b.isNone(B)?A(this.rootIndex,null,null):this._traverseVisible(this.rootIndex,-1,B,A)};C._traverseVisible=function(A,B,D,E){if(D.node&&0===D.childCount)this.isGeometryVisible(A)&&E(A,D,B);else if(this.isNodeVisible(A)&&(E(A,D,B),null!=D.node&&(B=this.nodeTraversalState(D.node),!B.nodeHasLOD||B.lodLevel!==this._maxLodLevel))){B=b.unwrap(this.getPage(A));for(let G=0;G<D.childCount;G++){const K=
B.children[D.childOffset+G],M=this.getNodeInternal(K);b.isSome(M)?this._traverseVisible(K,A,M,E):E(K,null,A)}}};C.traverse=function(A,B){B(A)&&this.traverseChildren(A,B)};C.traverseChildren=function(A,B){A=A.index;const D=this.getNodeInternal(A);b.isSome(D)&&this._traverseChildren(A,D,B)};C._traverseChildren=function(A,B,D){A=this.getPage(A);if(!b.isNone(A)){var E=B.childOffset+B.childCount;for(B=B.childOffset;B<E;++B){const G=A.children[B],K=this.getNodeInternal(G);b.isSome(K)&&b.isSome(K.node)&&
D(K.node)&&this._traverseChildren(G,K,D)}}};C.updateStats=function(A){0<this._updates.add.length&&(A.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)A.index+=" + "+this._indexMissing||this._prefetch.length;A.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){const B=this._featureEstimate.estimate-A.features;0<B?A.features+=" + "+B:0>B&&(A.features+=" - "+-B)}};C.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};
C.updateElevationInfo=function(A){this.forAllNodes(g);this.viewportQueries.updateElevationInfo(A)};C.forAllNodes=function(A){for(let B=0;B<this._nodePages.length;B++){const D=this._nodePages[B];if(D){const E=B*this.nodesPerPage;for(let G=0;G<D.nodes.length;G++)A(D.nodes[G],E+G)}}};p._createClass(x,[{key:"rootNode",get:function(){return this.getNode(this.rootIndex)}},{key:"size",get:function(){return this.nodeCount}},{key:"maxLevel",get:function(){return this._maxLevel}},{key:"dirty",get:function(){return this._dirty}},
{key:"updates",get:function(){return this._updates}},{key:"featureEstimate",get:function(){return this._featureEstimate}},{key:"test",get:function(){return{addNode:(A,B)=>this.addNode(A,B)}}}]);return x}();const n=new Map;let z=function(){function x(){this.update=new r({deallocator:null});this.add=new r({deallocator:null});this.remove=new r({deallocator:null});this.cancel=[]}x.prototype.reset=function(C,A){this.add.clear();this.update.clear();this.cancel=C;this.missing=A};return x}();const k=[["maxScreenThreshold",
1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];let v=function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0};a.I3SIndex=m;a.selectErrorMetric=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f64"],function(a,p,b){let r=function(y,f){this.id=y;this.mbs=f;this.renderMbs=b.fromArray([0,
0,0,-1]);this.imModificationImpact=4},q=function(y){function f(w,e,l,g,d,c,u,t,h,m){w=y.call(this,w,l)||this;w.index=e;w.childCount=g;w.level=d;w.resources=c;w.version=u;w.lodMetric=t;w.maxError=h;w.numFeatures=m;w.failed=!1;w.hasModifications=!1;w.cacheState=0;w.vertexCount=0;w.memory=0;return w}p._inheritsLoose(f,y);return f}(r);a.Node=q;a.NodeBase=r;a.NodeTraversalState=function(y,f,w,e){this.nodeHasLOD=y;this.isChosen=f;this.lodLevel=w;this.version=e};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray"],function(a,p,b){let r=function(){function y(w){this.layerView=w;this._lodGlobalDirty=!1}var f=y.prototype;f.startNodeLoading=function(w,e,l,g){this._maxLodLevel=g.maxLodLevel;this._index=l;this._isNodeInScaleBounds=w;this._removeNodes=e};f.shouldLoadNode=function(w){if(p.isNone(w))return!1;const e=this._index.nodeTraversalState(w);return this.isChosenMaxLOD(e)?
!0:e.isChosen?this._childrenRequireLoading(w):!1};f.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};f.lodGlobalHandling=function(w){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var e=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-1)));q.clear();this._lodGlobalHandling(this._index.rootNode,e,!1);e=q.length;this._removeNodes(q,w);w=q.length<e;0!==q.length&&(this._lodGlobalDirty=!0);q.clear();return w};f._lodGlobalHandling=function(w,
e,l){if(p.isNone(w))return!1;const g=w.index,d=this._index,c=this.layerView;var u=d.nodeTraversalState(w);const t=this.isChosenMaxLOD(u);u=c.isNodeLoaded(g);const h=c.nodeCrossfadingEnabled;if(h&&u&&t){var m=!l&&this.hasNoVisibleChildren(w);c.fadeNode(g,0,!m)}m=u&&(!c.isNodeFullyFadedIn||c.isNodeFullyFadedIn(g));if(u&&(c.updateNodeState(g,t?1:0),t))return m&&this._removeChildrenRecursive(w),m;var n=0<w.childCount;let z=n;if(n)for(n=0;n<w.childCount;n++){const k=d.getChildIndex(w,n),v=d.getNode(k);
p.isSome(v)?d.isGeometryVisible(k)&&!this._lodGlobalHandling(v,e,l||m)&&this._isNodeInScaleBounds(v)&&(z=!1):d.isNodeVisible(k)&&(z=!1)}(e=u&&!t&&(z||q.length<e))&&q.push(g);!h||e||!u||l||z||c.fadeNode(g,0,!1);w=!w.resources.hasFeatureData;return z||m&&!e||w};f._removeChildrenRecursive=function(w){this._index.traverseChildren(w,e=>{(this.layerView.isNodeLoaded(e.index)||this.layerView.isNodeReloading(e.index))&&q.push(e.index);return!0})};f.hasNoVisibleChildren=function(w){let e=!0;this._index.traverseChildren(w,
l=>e&&this._index.isNodeVisible(l.index)?this.layerView.isNodeLoaded(l.index)?e=!1:!0:!1);return e};f._childrenRequireLoading=function(w){let e=!1,l=!0;this._index.traverseChildren(w,g=>{if(!l||!this._index.isNodeVisible(g.index))return!1;const d=this._index.nodeTraversalState(g);this.isChosenMaxLOD(d)&&this._index.isGeometryVisible(g.index)&&(e=!0);return this.layerView.isNodeLoaded(g.index)?l=!1:!0});return l&&e};f.isChosenMaxLOD=function(w){return w.isChosen&&(!w.nodeHasLOD||w.lodLevel===this._maxLodLevel)};
a._createClass(y,[{key:"requiresLODGlobalHandling",get:function(){return null!=this._index&&!0===this._lodGlobalDirty}}]);return y}();const q=new b({deallocator:null});return r})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ./I3SBinaryReader ./I3SMaterialUtil".split(" "),function(a,p,b,r,q,
y,f,w,e){return function(){function l(d,c,u,t,h,m){this.streamDataController=c;this.logger=u;this.defaultGeometrySchema=t;this.requiredAttributes=h;this.options=m;this.logLayer=d;this.layerUrl=d.parsedUrl.path;this.geometryDefinitions=d.geometryDefinitions;if(d.materialDefinitions){const n=d.textureSetDefinitions;this.materialAndTextures=d.materialDefinitions.map(z=>e.getMaterialAndTextures(n,z))}}var g=l.prototype;g.load=function(d,c,u){return this.streamDataController.request(d,c,u)};g.loadAttribute=
function(d,c,u){return this.load(`${this.layerUrl}/nodes/${d.resources.attributes}/attributes/${c.key}/0`,"binary",u).then(t=>w.readBinaryAttribute(c,t))};g.loadAttributes=function(d,c,u){return y.eachAlways(c.map(t=>this.loadAttribute(d,t.attributeStorageInfo,u))).then(t=>{const h={};for(let m=0;m<c.length;++m)if(t[m].value)h[c[m].name]=t[m].value;else{if(y.isAbortError(t[m].error))throw t[m].error;this.logger.error("#loadAttributes",this.logLayer,`Failed to load attributeData for '${c[m].name}' on node '${d.id}'`,
t[m].error)}return h})};g.loadNodeData=function(){var d=a._asyncToGenerator(function*(c,u){var t=null!=this.requiredAttributes&&c.resources.attributes?p.result(this.loadAttributes(c,this.requiredAttributes,u)):null;var h=this.geometryDefinitions;var m={bufferDefinition:null,bufferIndex:0};if(!(null==h||0>c.resources.geometryDefinition)&&(h=0<=c.resources.geometryDefinition?h[c.resources.geometryDefinition].geometryBuffers:null,null!=h))for(var n=0;n<h.length;n++){var z=h[n];if(null!=z.compressedAttributes){if("draco"===
z.compressedAttributes.encoding&&!b("disable-feature:i3s-draco")){m.bufferIndex=n;m.bufferDefinition=z;break}}else m.bufferIndex=n,m.bufferDefinition=h[n]}const {bufferDefinition:k,bufferIndex:v}=m;n=(z=!!c.resources.geometry)?p.result(this.loadGeometry(c.resources.geometry,v,u)):null;h=c.resources.hasSharedResource?yield this.loadShared(c,u):null;var x=(m=this.materialAndTextures&&0<=c.resources.materialDefinition?this.materialAndTextures[c.resources.materialDefinition]:null!=h?e.getMaterialAndTexturesFromShared(h):
null)&&m.material;m=m&&m.textures;const C=`${c.id}`,A=!z&&this.options.loadFeatureData;z=A?yield this.loadFeatureData(C,u):null;if(A)a:{for(D of z.featureData)if(x=D.geometries,null!=x)for(var B of x){var D={featureIds:[D.id],featureDataPosition:D.position,geometries:[B]};break a}D=null}else D={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:x}}],featureDataPosition:[0,0,0]};if(B=q.isNone(D)){B=[];for(var E of z.featureData)null!=E.position&&B.push({featureIds:[E.id],featureDataPosition:E.position,
geometries:null})}E=B;B=null!=m&&0<m.length?p.result(this.loadTextures(c,m,u)):null;u=c=null;n&&(c=p.assertResult(yield n),(u=this.defaultGeometrySchema)&&h&&h.materialDefinitions&&(n=Object.keys(h.materialDefinitions)[0],!h.materialDefinitions[n].params.vertexRegions&&u.vertexAttributes.region&&(u=r.clone(u),delete u.vertexAttributes.region)),u=w.createGeometryDescriptor(k,u));h=B?p.assertResult(yield B):null;t=(t=t?p.assertResult(yield t):{})?{attributeData:t,loadedAttributes:this.requiredAttributes}:
null;return q.isSome(D)?{geometryData:D,attributeDataInfo:t,geometryBuffer:c,geometryDescriptor:u,requiredTextures:m,textureData:h}:q.isSome(E)?{pointData:E,attributeDataInfo:t,geometryBuffer:c,geometryDescriptor:u,requiredTextures:m,textureData:h}:Promise.reject()});return function(c,u){return d.apply(this,arguments)}}();l.addAbsoluteHrefTexture=function(d,c){d=d.textureDefinitions;if(null!=d)for(const u of Object.keys(d))for(const t of d[u].images)Array.isArray(t.href)?t.hrefConcat=t.href.map(h=>
f.makeAbsolute(h,c)):t.hrefConcat=f.makeAbsolute(t.href,c)};l.fixTextureEncodings=function(d){d=d.textureDefinitions;if(null!=d)for(const u in d){const t=d[u];if(Array.isArray(t.encoding))for(var c=0;c<t.encoding.length;c++){const h=t.encoding[c];"data:"===h.substring(0,5)&&(t.encoding[c]=h.substring(5))}else c=t.encoding,"data:"===c.substring(0,5)&&(t.encoding=c.substring(5))}};g.loadShared=function(d,c){const u=`${this.layerUrl}/nodes/${d.resources.geometry}/shared`;return this.load(u,"json",c).then(t=>
{l.fixTextureEncodings(t);l.addAbsoluteHrefTexture(t,u);return t})};g.loadTexture=function(d,c,u,t,h,m){let n=!1;return 4===h||1===h||2===h?this.load(d,"binary",m).then(z=>({id:c,usage:u,data:z,encoding:h,downsampled:n})):this.load(d,"image",m).then(z=>{var k=z;if(t&&4096<=z.width*z.height){k=Math.ceil(z.width/2);const v=Math.ceil(z.height/2),x=document.createElement("canvas");x.width=k;x.height=v;x.getContext("2d").drawImage(z,0,0,k,v);k=x;n=!0}return{id:c,usage:u,data:k,encoding:h,downsampled:n}})};
g.loadTextures=function(d,c,u){const t=this.options.uncompressedTextureDownsamplingEnabled,h=this.options.textureUsageMask;return Promise.all(c.map(m=>{if(0===(m.usage&h))return null;const n=e.selectEncoding(m.encodings,this.options.textureEncodings);return null==n?(this.logger.error("#loadTextures",this.logLayer,`No known encoding for texture found on node ${d.id}`),Promise.reject()):this.loadTexture(`${this.layerUrl}/nodes/${d.resources.texture||d.id}/textures/${n.name}`,m.id,m.usage,t,n.encoding,
u)}))};g.loadFeatureData=function(d,c){return this.load(`${this.layerUrl}/nodes/${d}/features/0`,"json",c)};g.loadGeometry=function(d,c,u){return this.load(`${this.layerUrl}/nodes/${d}/geometries/${c}`,"binary",u)};return l}()})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/Texture".split(" "),
function(a,p,b,r,q,y,f,w,e){function l(m){return m.sort((n,z)=>n.encoding-z.encoding)}function g(m,n,z){if(r.isNone(m)||0===z)return null;for(let k=0;k<m.length;k++){const v=m[k];if(r.isSome(v)&&0!==(v.usage&z))return n[k].id}return null}function d(m){switch(m){case 1:return e.Texture.KTX2_ENCODING;case 2:return e.Texture.BASIS_ENCODING;case 4:return e.Texture.DDS_ENCODING;case 8:return"image/png";case 16:return"image/jpeg";case 32:return"image/ktx";default:return""}}const c={ktx2:1,basis:2,dds:4,
png:8,jpg:16,"ktx-etc2":32},u={[e.Texture.KTX2_ENCODING]:2,[e.Texture.BASIS_ENCODING]:2,[e.Texture.DDS_ENCODING]:4,"image/png":8,"image/jpg":16,"image/jpeg":16,"image/ktx":32},t={s:33071,t:33071},h={s:10497,t:10497};a.configureMaterial=function(m,n,z,k,v,x){const C=x.rendererTextureUsage;var A=n.metallicRoughness.baseColorFactor;const B=b.clamp(n.metallicRoughness.baseColorFactor[3],0,1);m.baseColor=[A[0],A[1],A[2],B];m.hasParametersFromSource=!!n.hasParametersFromSource;m.usePBR=x.usePBR;m.mrrFactors=
[n.metallicRoughness.metallicFactor,n.metallicRoughness.roughnessFactor,n.hasParametersFromSource?.2:.5];m.emissiveFactor=n.emissiveFactor;m.isIntegratedMesh=x.isIntegratedMesh;m.alphaCutoff="mask"===n.alphaMode?n.alphaCutoff:f.defaultMaskAlphaCutoff;m.alphaDiscardMode="opaque"===n.alphaMode?1:"mask"===n.alphaMode?2:3;if(A=g(k,z,33&C))m.baseColorTexture=new q.RenderTexture(v,A);if(A=g(k,z,2&C))m.metallicRoughnessTexture=new q.RenderTexture(v,A);if(A=g(k,z,16&C))m.emissionTexture=new q.RenderTexture(v,
A);if(A=g(k,z,8&C))m.occlusionTexture=new q.RenderTexture(v,A);if(z=g(k,z,4&C))m.normalTexture=new q.RenderTexture(v,z);m.commonMaterialParameters.slicePlaneEnabled=x.slicePlaneEnabled;m.commonMaterialParameters.doubleSided=n.doubleSided;m.commonMaterialParameters.cullFace=n.cullFace;m.ellipsoidMode=w.getEllipsoidMode(x.viewSpatialReference)};a.createTexture=function(m,n,z,k){if(r.isNone(m)||null==m.data)return null;const v=m.data;var x=!(v instanceof HTMLImageElement)||b.isPowerOfTwo(v.width)&&b.isPowerOfTwo(v.height),
C=k.renderingContext.parameters.maxMaxAnisotropy;k=z&&!k.capabilities.shaderTextureLOD?1:C;x=x&&!m.downsampled&&1<k;z=z||!n.wrapTextures?t:h;C=d(m.encoding);return new e.Texture(v,{mipmap:x,maxAnisotropy:k,encoding:C,wrap:z,components:m.usage&1?"opaque"===n.alphaMode?3:4:3,noUnpackFlip:!0})};a.getMaterialAndTextures=function(m,n){const z=new Map,k=(G,K)=>{if(r.isNone(G))return-1;if(z.has(G.id))return G=z.get(G.id),G.usage|=K,G.id;const M=z.size;z.set(G.id,{id:M,usage:K});return M};var v=n.pbrMetallicRoughness;
const x=v&&v.baseColorFactor,C=n.emissiveFactor,A=null==n.normalTexture&&null==n.emissiveTexture&&null==n.occlusionTexture&&(v?null==v.metallicRoughnessTexture&&1===v.roughnessFactor&&(1===v.metallicFactor||0===v.metallicFactor):!0),B=A?y.PBRSchematicMRRValues[0]:v?v.metallicFactor:1,D=A?y.PBRSchematicMRRValues[1]:v?v.roughnessFactor:1;v={baseColorFactor:x?[x[0],x[1],x[2],x[3]]:[1,1,1,1],baseColorTextureId:k(v&&v.baseColorTexture,"mask"===n.alphaMode?33:1),metallicRoughnessTextureId:k(v&&v.metallicRoughnessTexture,
2),metallicFactor:B,roughnessFactor:D};n={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,doubleSided:n.doubleSided,cullFace:"none"===n.cullFace?0:"back"===n.cullFace?2:"front"===n.cullFace?1:void 0,normalTextureId:k(n.normalTexture,4),emissiveTextureId:k(n.emissiveTexture,16),occlusionTextureId:k(n.occlusionTexture,8),emissiveFactor:C?[C[0],C[1],C[2]]:[0,0,0],metallicRoughness:v,wrapTextures:!1,hasParametersFromSource:A};const E=[];z.forEach(({usage:G},K)=>{var M=r.isSome(m)&&m[K]&&m[K].formats;
M=M?l(M.map(({name:H,format:J})=>({name:H,encoding:c[J]}))):[];E.push({id:K,usage:G,encodings:M})});return{material:n,textures:E}};a.getMaterialAndTexturesFromShared=function(m){var n=m&&m.materialDefinitions?Object.keys(m.materialDefinitions)[0]:null,z=m&&m.textureDefinitions?Object.keys(m.textureDefinitions)[0]:null;n=n&&m.materialDefinitions[n];z=z&&m.textureDefinitions[z];m={alphaMode:"opaque",alphaCutoff:f.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,
occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0};if(null!=n){n=n.params;n.diffuse&&(m.metallicRoughness.baseColorFactor=[n.diffuse[0],n.diffuse[1],n.diffuse[2],1]);null!=n.doubleSided&&(m.doubleSided=n.doubleSided,m.cullFace=n.doubleSided?0:2);if("none"===n.cullFace||"front"===n.cullFace||"back"===n.cullFace)m.cullFace="none"===
n.cullFace?0:"back"===n.cullFace?2:1;n.transparency&&(m.metallicRoughness.baseColorFactor[3]=b.clamp(1-n.transparency,0,1));if(n.useVertexColorAlpha||1>m.metallicRoughness.baseColorFactor[3])m.alphaMode="blend"}n=[];if(null!=z){!z.wrap||"repeat"!==z.wrap[0]&&"repeat"!==z.wrap[1]||(m.wrapTextures=!0);let k=1;"rgba"===z.channels&&(m.alphaMode="blend",k|=32);const v=z.images[z.images.length-1],x=C=>C&&C.split("/").pop();z=Array.isArray(z.encoding)?l(z.encoding.map((C,A)=>({name:x(v.href[A]),encoding:u[C]||
0}))):[{name:x(v.href),encoding:u[z.encoding]||0}];n.push({id:0,usage:k,encodings:z});m.metallicRoughness.baseColorTextureId=0}return{material:m,textures:n}};a.getSupportedEncodings=function(m){const n=!!m.compressedTextureS3TC;m=!!m.compressedTextureETC;const z=p("disable-feature:i3s-basis")?0:3;return 24|(n?z|4:0)|(m?z:0)};a.selectEncoding=function(m,n){return m.find(z=>0!==(z.encoding&n))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports",
"../../../../../core/maybe"],function(a,p){let b=function(){function r(y,f){this._textureRep=y;this._textureId=f;this._textureRef=p.applySome(this._textureId,w=>this._textureRep.acquire(w))}var q=r.prototype;q.dispose=function(){this._textureRef=p.applySome(this._textureId,y=>{this._textureRep.release(y)})};q.bind=function(y,f,w){if(p.isSome(this._textureRef)){const e=this._textureRef.glTexture;y.bindTexture(e,f);y.setUniform2f(w,e.descriptor.width,e.descriptor.height)}};return r}();a.RenderTexture=
b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,p){a.getEllipsoidMode=function(b){return b&&p.isMars(b)?2:b&&p.isMoon(b)?3:1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],
function(a,p,b){let r=function(){function q(f,w){this.requester=f;this.apiKey=w;this.activeRequests=new Set}var y=q.prototype;y.request=function(f,w,e){const l=b.createAbortController();e=b.onAbortOrThrow(e,()=>l.abort());f=this.requester.request(f,w,{signal:l.signal,query:{token:this.apiKey}});const g={response:f,abortController:l,abortHandle:e};this.activeRequests.add(g);b.always(f,()=>{var d;g.abortController=null;null==(d=g.abortHandle)?void 0:d.remove();g.abortHandle=null;this.activeRequests.delete(g)});
return f};y.cancelAll=function(){this.activeRequests.forEach(f=>{var w,e;null==(w=f.abortController)?void 0:w.abort();f.abortController=null;null==(e=f.abortHandle)?void 0:e.remove()});this.activeRequests.clear()};p._createClass(q,[{key:"busy",get:function(){return this.requester.busy}}]);return q}();a.I3SStreamDataController=r;a["default"]=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/frustum ../../../../chunks/sphere ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){return function(){function t(m,n,z,k,v,x,C,A={}){this.indexSR=m;this._renderCoordsHelper=n;this.extent=v;this.elevationProvider=x;this.options=A;this._frustum=f.create();this._useFrustumCulling=!1;this._poi=b.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=b.create();this._tmp2=b.create();this._tmp3=b.create();this._tmp0=b.create();this.screenspaceErrorBias=A.screenspaceErrorBias||1;this.progressiveLoadFactor=A.progressiveLoadFactor||
1;this.updateCamera(z,k);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(C);this.tmpPoint=e.makeDehydratedPoint(0,0,0,m)}var h=t.prototype;h.updateElevationInfo=function(m){null==m?this._elevationContext=null:(this._elevationContext=g.ElevationContext.fromElevationInfo(m),this._elevationContext.updateFeatureExpressionInfoContext(d.createContextWithoutExpressionSupport(d.extractExpressionInfo(m,!1))))};h.updateCamera=function(m,n){(this._useFrustumCulling=n)&&f.fromMatrix(m.viewMatrix,
m.projectionMatrix,this._frustum);this._screenSizeFactor=1/(m.perScreenPixelRatio/2);this._camPos=m.eye;this.minDistance=Infinity;this.maxDistance=0};h.setPointOfInterest=function(m){this._poi=m};h.updateScreenSpaceErrorBias=function(m){const n=this.screenspaceErrorBias;this.screenspaceErrorBias=m;return n};h.updateExtent=function(m){this.extent=m};h.getRenderMbs=function(m){const n=m.renderMbs;0>n[3]&&(r.copy(n,m.mbs),this._elevationContext&&1E5>n[3]&&(this.tmpPoint.x=n[0],this.tmpPoint.y=n[1],this.tmpPoint.z=
n[2],n[2]=l.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)),q.projectBoundingSphere(n,this.indexSR,n,this.engineSR));return n};h.getVisibilityObb=function(m){if(a.isSome(m.visibilityObb))return m.visibilityObb;const n=m.serviceObb;if(!(a.isNone(n)||0>n.halfSize[0]))return m.serviceObbInRenderSR=this._computeRenderObb(n,m.serviceObbInRenderSR,m.mbs[3]),m.serviceObbInRenderSR};h._computeRenderObb=function(m,n,z){a.isNone(n)&&(n=
u.create());if(0>n.halfSize[0]){let k=0;this._elevationContext&&1E5>z&&(this.tmpPoint.x=m.center[0],this.tmpPoint.y=m.center[1],this.tmpPoint.z=m.center[2],k=l.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)-m.center[2]);c.transformObb(m,this.indexSR,n,this.engineSR,k)}return n};h.isNodeVisible=function(m){const n=this.getRenderMbs(m);if(!this.isMBSinExtent(n))return!1;if(!this._useFrustumCulling)return!0;m=this.getVisibilityObb(m);
return a.isSome(m)?u.isVisible(m,this._frustum):f.intersectsSphere(this._frustum,w.wrap(n))};h.isGeometryVisible=function(m){if(!this._useFrustumCulling)return!0;const n=m.geometryObb;return a.isSome(n)?u.isVisible(n,this._frustum):this.isNodeVisible(m)};h.isMBSinExtent=function(m){return this.extent?0!==c.intersectBoundingBoxWithMbs(this.extent,m):!0};h.screenSpaceDiameterMbs=function(m,n){var z=this.getRenderMbs(m);m=Math.sqrt(p.squaredDistance(z,this._camPos));z=m-z[3];this._updateMinMaxDistance(m);
return 0>z?.5*Number.MAX_VALUE:n/z*this._screenSizeFactor};h.calcCameraDistance=function(m){return this.calcCameraDistanceToCenter(m)-this.getRenderMbs(m)[3]};h.calcCameraDistanceToCenter=function(m){m=this.getRenderMbs(m);m=p.distance(m,this._camPos);this._updateMinMaxDistance(m);return m};h.calcAngleDependentLoD=function(m){m=this.getRenderMbs(m);const n=m[3];m=(Math.abs(m[0]*(m[0]-this._camPos[0])+m[1]*(m[1]-this._camPos[1])+m[2]*(m[2]-this._camPos[2]))/p.length(m)+n)/p.distance(m,this._camPos);
return Math.min(1,m)};h.hasLOD=function(m){return 0!==m.lodMetric};h.getDistancePlanarMode=function(m,n){var z=m[0]-n[0];const k=m[1]-n[1];m=m[2]-n[2];z=z*z+k*k;n=n[3];if(z<=n*n)return Math.abs(m);n=Math.sqrt(z)-n;return Math.sqrt(m*m+n*n)};h.getDistanceGlobeMode=function(m,n){var z=p.length(n);const k=p.length(m)-z;p.scale(this._tmp0,m,p.dot(m,n)/p.squaredLength(m));var v=p.squaredDistance(n,this._tmp0),x=n[3];if(v<=x*x)return Math.abs(k);n=p.scale(this._tmp0,n,1/z);z=p.scale(this._tmp1,n,z-x*x/
2/z);v=p.subtract(this._tmp2,m,z);v=p.subtract(this._tmp2,v,p.scale(this._tmp3,n,p.dot(n,v)));z=p.add(this._tmp2,z,p.scale(this._tmp2,v,x/p.length(v)));x=p.distance(m,z);2E5<=k&&(m=p.subtract(this._tmp1,m,z),m=p.dot(m,n)/p.length(m),.08>m&&(m=1E-4),x/=m);return x};h.getDistance=function(m,n){return this.engineSR===y.getSphericalPCPF(this.engineSR)?this.getDistanceGlobeMode(m,n):this.getDistancePlanarMode(m,n)};h._updateMinMaxDistance=function(m){0<m?(this.minDistance=Math.min(this.minDistance,m),
this.maxDistance=Math.max(this.maxDistance,m)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-m))};h.getLodLevel=function(m){if(0===m.lodMetric||!m.resources.hasFeatureData)return 0;if(0===m.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&1>this.progressiveLoadFactor){const n=this.screenspaceErrorBias;return this.evaluateLODmetric(m,this.progressiveLoadFactor*this.screenspaceErrorBias)?this.evaluateLODmetric(m,n)?2:1:0}return this.evaluateLODmetric(m,this.screenspaceErrorBias)?
this.maxLodLevel:0};h.evaluateLODmetric=function(m,n){switch(m.lodMetric){case 2:{const z=this.getRenderMbs(m),k=this.getDistance(this._camPos,z),v=2*k/this._screenSizeFactor;this._updateMinMaxDistance(k+z[3]);return m.maxError*n<=v}case 1:return n=this.screenSpaceDiameterMbs(m,m.mbs[3]*n),this.options.angleDependentLoD&&(n*=this.calcAngleDependentLoD(m)),n<m.maxError;case 3:return 10>this.screenSpaceDiameterMbs(m,m.maxError)*n;case 4:return this.calcCameraDistance(m)>m.maxError*n}return!1};h.distToPOI=
function(m){m=this.getRenderMbs(m);return p.distance(m,this._poi)-m[3]};h.distCameraToPOI=function(){return p.distance(this._camPos,this._poi)};return t}()})},"esri/layers/support/SceneModification":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t){var h;b=h=function(m){function n(k){k=m.call(this,k)||this;k.geometry=null;k.type="clip";return k}a._inheritsLoose(n,m);var z=n.prototype;z.writeGeometry=function(k,v,x,C){if(C.layer&&C.layer.spatialReference&&!C.layer.spatialReference.equals(this.geometry.spatialReference)){if(!u.canProjectWithoutEngine(k.spatialReference,C.layer.spatialReference)){C&&C.messages&&C.messages.push(new y("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:C.layer.spatialReference,context:C}));return}const A=new t;u.projectPolygon(k,A,C.layer.spatialReference);v[x]=A.toJSON(C)}else v[x]=k.toJSON(C);delete v[x].spatialReference};z.clone=function(){return new h({geometry:q.clone(this.geometry),type:this.type})};return n}(r.JSONSupport);p.__decorate([f.property({type:t}),c.persistable()],b.prototype,"geometry",void 0);p.__decorate([d.writer(["web-scene","portal-item"],"geometry")],b.prototype,"writeGeometry",null);p.__decorate([f.property({type:["clip",
"mask","replace"],nonNullable:!0}),c.persistable()],b.prototype,"type",void 0);return b=h=p.__decorate([g.subclass("esri.layers.support.SceneModification")],b)})},"esri/core/accessorSupport/decorators/persistable":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../maybe ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(a,
p,b,r,q,y,f,w,e,l,g,d){function c(z,k,v){const x=w.getOwnPropertyMetadata(k,v);return{type:String,read:(C,A,B)=>{C=d.read(C,A,B);if(x.type===String)return C;if("function"===typeof x.type)return new x.type({url:C})},write:{writer(C,A,B,D){if(D&&D.resources){var E=r.isNone(C)?null:"string"===typeof C?C:C.url;E=E?d.toJSON(E,{...D,verifyItemRelativeUrls:D&&D.verifyItemRelativeUrls?{writtenUrls:D.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null;var G=x.type!==String&&(!q.isMultiOriginJSONMixin(this)||
D&&D.origin&&this.originIdOf(v)>e.nameToId(D.origin));if(D&&D.portalItem&&r.isSome(E)&&!y.isAbsolute(E))if(G){{G=D.portalItem.resourceFromPath(E);const K=h(C,E,D),M=g.getResourceContentExtension(K),H=y.getPathExtension(G.path);M!==H?u(this,v,C,E,A,B,D,z):(t(this,v,G,K,D.resources.toUpdate),A[B]=E)}}else D.resources.toKeep.push({resource:D.portalItem.resourceFromPath(E)}),A[B]=E;else D&&D.portalItem&&(r.isNone(E)||r.isSome(d.itemIdFromResourceUrl(E))||y.isBlobProtocol(E)||G)?u(this,v,C,E,A,B,D,z):
A[B]=E}else A[B]="string"===typeof C?d.toJSON(C,D):C.write({},D)}}}}function u(z,k,v,x,C,A,B,D){const E=f.generateUUID();v=h(v,x,B);const G=y.join(r.get(D,"prefix"),E);D=`${G}.${g.getResourceContentExtension(v)}`;const K=B.portalItem.resourceFromPath(D);y.isBlobProtocol(x)&&B.resources.pendingOperations.push(m(x).then(M=>{K.path=`${G}.${g.getResourceContentExtension(M)}`;C[A]=K.itemRelativeUrl}).catch(()=>{}));t(z,k,K,v,B.resources.toAdd);C[A]=K.itemRelativeUrl}function t(z,k,v,x,C){C.push({resource:v,
content:x,finish:A=>{"string"===typeof z[k]?z[k]=A.url:z[k].url=A.url}})}function h(z,k,v){return"string"===typeof z?{url:k}:new Blob([JSON.stringify(z.toJSON(v))],{type:"application/json"})}function m(z){return n.apply(this,arguments)}function n(){n=b._asyncToGenerator(function*(z){const k=(yield new Promise(function(v,x){a(["../../../request"],function(C){v(Object.freeze({__proto__:null,default:C}))},x)})).default;({data:z}=yield k(z,{responseType:"blob"}));return z});return n.apply(this,arguments)}
p.persistable=function(z){const k=r.isSome(z)&&z.origins?z.origins:[void 0];return(v,x)=>{a:if(r.isSome(z)&&"resource"===z.type)var C=c(z,v,x);else{switch(r.isSome(z)&&z.type?z.type:"other"){case "other":C={read:!0,write:!0};break a;case "url":{const {read:A,write:B}=d.persistableUrlUtils;C={read:A,write:B};break a}}C=void 0}for(const A of k){const B=l.propertyJSONMeta(v,A,x);for(const D in C)B[D]=C[D]}}};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/portal/support/resourceExtension":function(){define(["exports",
"../../core/urlUtils"],function(a,p){const b={},r=b["text/plain"],q={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const y in q)b[q[y]]=y;a.getResourceContentExtension=function(y){y instanceof Blob?y=y.type:(y=p.getPathExtension(y.url),y=q[y]||"text/plain");return b[y]||r};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../chunks/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../../../symbols/PointSymbol3D".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k){r=function(C){function A(D){D=C.call(this,D)||this;D.loadedGraphics=new z.LimitGraphicsMap(5E4);D.slicePlaneEnabled=!1;D._renderingInfo={symbol:new k};D._handles=new y;D._graphicsByNode=new Map;D._scaleVisibility=null;return D}a._inheritsLoose(A,C);var B=A.prototype;B.initialize=function(){this._graphicsCore=new h.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:0,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,
hasZ:!0,hasM:!1});var D=this.view.basemapTerrain;this._scaleVisibility=new m({layerScaleEnabled:!1});this._scaleVisibility.setup(this,this.layer,(G,K,M)=>this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(G,K,M),this._graphicsCore,D);D=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}});const E=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);
this._graphicsCore.setup({labeler:D,deconflictor:E,scaleVisibility:this._scaleVisibility}).then(()=>{this._graphicsCore.startCreateGraphics()}).catch(()=>{});this._handles.add([this.layer.watch("labelingInfo",(G,K)=>{c.diff(G,K)&&this._graphicsCore.updateLabelingInfo()})])};B.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),this._scaleVisibility=null);null!=this._graphicsCore&&(this._graphicsCore.destroy(),
this._graphicsCore=null);this.loadedGraphics.destroy();this.view=null};B.addNodeMeta=function(D,E){let G=0;const K=D.filteredIds,M=D.featureIds.map((H,J)=>{n.boundingBoxTop(J,this.collection,D.objectHandle,x);const O=t.makeDehydratedPoint(0,0,0,this.view.spatialReference);this.view.renderCoordsHelper.fromRenderCoords(x,O);J=E(J,D);let I=!1;f.isNone(K)?I=!0:G<K.length&&H===K[G]&&(I=!0,G++);return{objectId:H,uid:b.generateUID(),attributes:J,visible:I,geometry:O}});this.loadedGraphics.addMany(M);this._graphicsByNode.set(D.node.index,
M)};B.setNodeMetaAttributes=function(D,E){const G=this._graphicsByNode.get(D.node.index),K=Array(G.length);for(let M=0;M<G.length;M++){const H=G[M];H.attributes=E(M,D);K[M]=H.uid}this._graphicsCore.updateLabelingInfo(K)};B.applyFilterChange=function(D){var E=this._graphicsByNode.get(D.node.index);if(E)if(f.isNone(D.filteredIds))for(var G of E)G.visible||(G.visible=!0,v.graphic=G,v.property="visible",v.oldValue=!1,v.newValue=!0,this._graphicsCore.graphicUpdateHandler(v));else{G=0;for(const K of E)E=
K.visible,G<D.filteredIds.length&&K.objectId===D.filteredIds[G]?(K.visible=!0,G++):K.visible=!1,E!==K.visible&&(v.graphic=K,v.property="visible",v.oldValue=E,v.newValue=K.visible,this._graphicsCore.graphicUpdateHandler(v))}};B.removeNodeMeta=function(D){this.loadedGraphics.removeManyByObjectId(D.featureIds)};B.getRenderingInfo=function(){return this._renderingInfo};B.notifyGraphicGeometryChanged=function(){};B.notifyGraphicVisibilityChanged=function(){};a._createClass(A,[{key:"updatePolicy",get:function(){return this._graphicsCore.effectiveUpdatePolicy}},
{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return A}(q);p.__decorate([w.property()],r.prototype,"view",void 0);p.__decorate([w.property()],r.prototype,"layer",void 0);p.__decorate([w.property()],r.prototype,"collection",void 0);p.__decorate([w.property()],r.prototype,"loadedGraphics",void 0);p.__decorate([w.property({aliasOf:"_graphicsCore.updating"})],
r.prototype,"updating",void 0);p.__decorate([w.property()],r.prototype,"slicePlaneEnabled",void 0);p.__decorate([w.property()],r.prototype,"_graphicsCore",void 0);r=p.__decorate([d.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],r);const v={graphic:null,property:null,oldValue:null,newValue:null},x=u.create();return r})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox".split(" "),
function(a,p,b,r,q,y){function f(l,g,d,c){l=g.getComponentAabb(d,l,w);g=g.getObjectTransform(d);for(d=0;8>d;++d)e[0]=d&1?l[0]:l[3],e[1]=d&2?l[1]:l[4],e[2]=d&4?l[2]:l[5],b.transformMat3(e,e,g.rotationScale),b.add(e,e,g.position),c[3*d]=e[0],c[3*d+1]=e[1],c[3*d+2]=e[2];return c}const w=y.create(),e=r.create();a.boundingBoxCornerPoints=f;a.boundingBoxTop=function(l,g,d,c){l=g.getComponentAabb(d,l,w);g=g.getObjectTransform(d);c[0]=0;c[1]=0;c[2]=0;for(d=0;8>d;++d)e[0]=d&1?l[0]:l[3],e[1]=d&2?l[1]:l[4],
e[2]=l[5],b.transformMat3(e,e,g.rotationScale),b.add(e,e,g.position),c[0]+=e[0],c[1]+=e[1],c[2]+=e[2];c[0]/=8;c[1]/=8;c[2]/=8;return c};a.createGetFeatureExtent=function(l,g,d){const c=new Float64Array(24);return u=>{var t=u.meta.featureExtents;if(p.isNone(t)){t=new Float64Array(6*u.meta.featureIds.length);u.meta.featureExtents=t;for(let h=0;h<t.length;h+=6)t[h]=Number.POSITIVE_INFINITY}t=new Float64Array(t.buffer,6*u.index*Float64Array.BYTES_PER_ELEMENT,6);t[0]===Number.POSITIVE_INFINITY&&(f(u.index,
d,u.meta.objectHandle,c),q.projectBuffer(c,g,0,c,l,0,8)?(y.set(t,y.NEGATIVE_INFINITY),y.expandWithBuffer(t,c,0,8)):y.set(t,y.ZERO));return t}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,p,b,r,q){b=function(w){function e(g){var d=w.call(this)||this;d._limit=g;d._all=new q.GraphicsMap;d._active=new f(p._assertThisInitialized(d));
d._pending=new Map;d._handle=d._all.on("change",c=>d._handleChanges(c));return d}p._inheritsLoose(e,w);var l=e.prototype;l.destroy=function(){this._handle.remove()};l.toArray=function(){return this._active.toArray()};l.find=function(g){return this._active.find(g)};l.forEach=function(g){this._active.forEach(g)};l.addMany=function(g){this._all.addMany(g)};l.removeManyByObjectId=function(g){this._all.removeManyByObjectId(g)};l._handleChanges=function(g){let d=g.removed;if(0<this._pending.size){d=[];
for(var c of g.removed)this._pending.delete(c.objectId)||d.push(c)}c=this._limit-this._active.length+d.length;c<g.added.length&&(this._active.removeMany(d),d=[],y.reset(1-this._limit/(this._active.length+g.added.length)),this._active.forEach(t=>{y.sample()&&(d.push(t),this._pending.set(t.objectId,t))}),c=this._limit-this._active.length+d.length);let u=g.added;if(c<g.added.length){u=[];y.reset(c/g.added.length);for(const t of g.added)y.sample()?u.push(t):this._pending.set(t.objectId,t)}g=c-u.length;
0<g&&0<this._pending.size&&(y.reset(g/this._pending.size),this._pending.forEach(t=>{y.sample()&&(u.push(t),this._pending.delete(t.objectId))}));this._active.addAndRemove(u,d)};p._createClass(e,[{key:"length",get:function(){return this._active.length}}]);return e}(b);const y=new (function(){function w(){this.percentage=1;this.last=-1;this.index=0}var e=w.prototype;e.reset=function(l){this.percentage=l;this.last=-1};e.sample=function(){const l=Math.floor(this.index*this.percentage);++this.index;if(l===
this.last)return!1;this.last=l;return!0};return w}());let f=function(){function w(l){this._parent=l;this._map=new Map}var e=w.prototype;e.forEach=function(l){this._map.forEach(g=>l(g))};e.find=function(l){let g;r.someMap(this._map,d=>l(d)?(g=d,!0):!1);return g};e.toArray=function(){return[...this._map.values()]};e.addAndRemove=function(l,g){for(const d of l)this._map.set(d.objectId,d);for(const d of g)this._map.delete(d.objectId);(0<l.length||0<g.length)&&this._parent.emit("change",{added:l,removed:g})};
e.removeMany=function(l){for(const g of l)this._map.delete(g.objectId);0<l.length&&this._parent.emit("change",{added:[],removed:l})};p._createClass(w,[{key:"length",get:function(){return this._map.size}}]);return w}();a.LimitGraphicsMap=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils"],function(a,p,b,r){b=function(q){function y(){var w=
q.apply(this,arguments)||this;w._map=new Map;return w}p._inheritsLoose(y,q);var f=y.prototype;f.clear=function(){if(0<this._map.size){const w=this.toArray();this._map.clear();this.emit("change",{added:[],removed:w})}};f.get=function(w){return this._map.get(w)};f.addMany=function(w){if(0!==w.length){var e=new Set;for(let l=0;l<w.length;l++){const g=w[l],d=g.objectId,c=this._map.get(d);c?(e.add(d),g!==c&&(w[l]=c),++c.refCount):(g.refCount=1,this._map.set(d,g))}w=0<e.size?w.filter(l=>!e.has(l.objectId)):
w;0<w.length&&this.emit("change",{added:w,removed:[]})}};f.removeMany=function(w){const e=[];for(const l of w){w=l.objectId;const g=this._map.get(w);null!=g&&0>=--g.refCount&&(this._map.delete(w),e.push(l))}0<e.length&&this.emit("change",{added:[],removed:e})};f.removeManyByObjectId=function(w){const e=[];for(const l of w)w=this._map.get(l),null!=w&&0>=--w.refCount&&(this._map.delete(l),e.push(w));0<e.length&&this.emit("change",{added:[],removed:e})};f.toArray=function(){return[...this._map.values()]};
f.find=function(w){let e;r.someMap(this._map,l=>w(l)?(e=l,!0):!1);return e};f.forEach=function(w){this._map.forEach(e=>w(e))};p._createClass(y,[{key:"length",get:function(){return this._map.size}}]);return y}(b);a.GraphicsMap=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/PooledArray ../../../core/workers/WorkerHandle ../../../geometry/projection".split(" "),
function(a,p,b,r,q,y){function f(g,d){e.clear();for(var c of g){var u="clip"===c.type?2:"mask"===c.type?1:0;const h=c.geometry;g=m=>m;if(h.spatialReference){if(!y.canProjectWithoutEngine(h.spatialReference,d)){w.warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}g=m=>{y.projectVectorToVector(m,h.spatialReference,l,d);return l}}else h.hasZ||(l[2]=0,g=m=>{l[0]=m[0];l[1]=m[1];return l});e.push(u);e.push(h.rings.length);for(var t of h.rings){e.push(t.length);
for(const m of t)u=g(m),e.push(u[0]),e.push(u[1]),e.push(u[2])}}e.push(3);c=new Float64Array(e.length);for(t=0;t<e.length;++t)c[t]=e.getItemAt(t);return c}const w=b.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");b=function(g){function d(u){return g.call(this,"SceneLayerWorker","process",u,{hasInitialize:!0})||this}p._inheritsLoose(d,g);var c=d.prototype;c.getTransferList=function(u){return[u.geometryBuffer]};c.setModifications=function(u,t,h){u={context:u,modifications:f(t,h),isGeodetic:h.isGeographic};
this.broadcast(u,"setModifications")};c.setLegacySchema=function(u,t){t=JSON.stringify(t);this.broadcast({context:u,jsonSchema:t},"setLegacySchema")};c.destroyContext=function(u){return this.broadcast(u,"destroyContext")};return d}(q.WorkerHandle);const e=new r({deallocator:null}),l=[0,0,0];a.I3SMeshWorkerHandle=b;a.toWasmModification=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerWorker":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/maybe","../../../core/typedArrayUtil","../../../libs/i3s/I3SModule"],function(a,p,b,r,q){function y(){y=p._asyncToGenerator(function*(k){yield h();const v=[k.geometryBuffer];return{result:d(k,v),transferList:v}});return y.apply(this,arguments)}function f(){f=p._asyncToGenerator(function*(k){var v;yield h();const x=[k.geometryBuffer];var {geometryBuffer:C}=k,A=C.byteLength;k=n._malloc(A);A=new Uint8Array(n.HEAPU8.buffer,k,A);A.set(new Uint8Array(C));C=n.dracoDecompressPointCloudData(k,
A.byteLength);n._free(k);if(0<C.error.length)throw`i3s.wasm: ${C.error}`;k=0<(null==(v=C.featureIds)?void 0:v.length)?r.slice(C.featureIds):null;v=r.slice(C.positions);k&&x.push(k.buffer);x.push(v.buffer);return{result:{positions:v,featureIds:k},transferList:x}});return f.apply(this,arguments)}function w(){w=p._asyncToGenerator(function*(k){yield h();c(k);k={buffer:k.buffer};return{result:k,transferList:[k.buffer]}});return w.apply(this,arguments)}function e(){e=p._asyncToGenerator(function*(k){yield h();
g(k)});return e.apply(this,arguments)}function l(){l=p._asyncToGenerator(function*(k){yield h();n.setLegacySchema(k.context,k.jsonSchema)});return l.apply(this,arguments)}function g(k){const v=k.modifications,x=n._malloc(8*v.length),C=new Float64Array(n.HEAPU8.buffer,x,v.length);for(let A=0;A<v.length;++A)C[A]=v[A];n.setModifications(k.context,x,v.length,k.isGeodetic);n._free(x)}function d(k,v){if(!n)return null;const {context:x,localOrigin:C,globalTrafo:A,mbs:B,obb:D,elevationOffset:E,geometryBuffer:G,
geometryDescriptor:K,indexToVertexProjector:M,vertexToRenderProjector:H}=k;var J=n._malloc(G.byteLength),O=n._malloc(33*Float64Array.BYTES_PER_ELEMENT),I=new Uint8Array(n.HEAPU8.buffer,J,G.byteLength);I.set(new Uint8Array(G));var F=new Float64Array(n.HEAPU8.buffer,O,33);t(F,C);var L=F.byteOffset+3*F.BYTES_PER_ELEMENT,N=new Float64Array(F.buffer,L);t(N,A);L+=16*F.BYTES_PER_ELEMENT;N=new Float64Array(F.buffer,L);t(N,B);L+=4*F.BYTES_PER_ELEMENT;b.isSome(D)&&(N=new Float64Array(F.buffer,L),t(N,D.center),
L+=3*F.BYTES_PER_ELEMENT,N=new Float64Array(F.buffer,L),t(N,D.halfSize),L+=3*F.BYTES_PER_ELEMENT,N=new Float64Array(F.buffer,L),t(N,D.quaternion));F={isDraco:!1,isLegacy:!1,color:k.layouts.some(S=>S.some(P=>"color"===P.name)),normal:k.needNormals&&k.layouts.some(S=>S.some(P=>"normalCompressed"===P.name)),uv0:k.layouts.some(S=>S.some(P=>"uv0"===P.name)),uvRegion:k.layouts.some(S=>S.some(P=>"uvRegion"===P.name)),featureIndex:K.featureIndex};I=n.process(x,!!k.obb,J,I.byteLength,K,F,O,E,M,H,k.normalReferenceFrame);
n._free(O);n._free(J);if(0<I.error.length)throw`i3s.wasm: ${I.error}`;if(I.discarded)return null;J=0<I.componentOffsets.length?r.slice(I.componentOffsets):null;O=0<I.featureIds.length?r.slice(I.featureIds):null;F=r.slice(I.interleavedVertedData).buffer;L=1===I.indicesType?r.slice(new Uint16Array(I.indices.buffer,I.indices.byteOffset,I.indices.byteLength/2)):r.slice(new Uint32Array(I.indices.buffer,I.indices.byteOffset,I.indices.byteLength/4));N=r.slice(I.positions);const R=1===I.positionIndicesType?
r.slice(new Uint16Array(I.positionIndices.buffer,I.positionIndices.byteOffset,I.positionIndices.byteLength/2)):r.slice(new Uint32Array(I.positionIndices.buffer,I.positionIndices.byteOffset,I.positionIndices.byteLength/4));k={layout:k.layouts[0],interleavedVertexData:F,indices:L,hasColors:I.hasColors,hasModifications:I.hasModifications,positionData:{data:N,indices:R}};O&&v.push(O.buffer);J&&v.push(J.buffer);v.push(F);v.push(L.buffer);v.push(N.buffer);v.push(R.buffer);return{componentOffsets:J,featureIds:O,
transformedGeometry:k,obb:I.obb}}function c(k){const {context:v,buffer:x}=k;k=n._malloc(x.byteLength);const C=x.byteLength/Float64Array.BYTES_PER_ELEMENT,A=new Float64Array(n.HEAPU8.buffer,k,C),B=new Float64Array(x);A.set(B);n.filterOBBs(v,k,C);B.set(A);n._free(k)}function u(k){n&&n.destroy(k)}function t(k,v){for(let x=0;x<v.length;++x)k[x]=v[x]}function h(){if(n)return Promise.resolve();m||(m=q.get().then(k=>{n=k;m=null}));return m}let m,n;const z={transform:d,destroy:u};a.destroyContext=function(k){u(k)};
a.dracoDecompressPointCloudData=function(k){return f.apply(this,arguments)};a.filterObbsForModifications=function(k){return w.apply(this,arguments)};a.filterObbsForModificationsSync=c;a.initialize=h;a.interpretObbModificationResults=function(k){return 0===k?0:1===k?1:2===k?2:3};a.process=function(k){return y.apply(this,arguments)};a.setLegacySchema=function(k){return l.apply(this,arguments)};a.setModifications=function(k){return e.apply(this,arguments)};a.setModificationsSync=g;a.test=z;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(a,p,b){function r(y){return b.getAssetUrl(`esri/libs/i3s/${y}`)}let q;p.get=function(){q||(q=(new Promise(y=>(new Promise(function(f,w){a(["../../chunks/i3s"],f,w)})).then(function(f){return f.i3s}).then(({default:f})=>{const w=f({locateFile:r,onRuntimeInitialized:()=>y(w)});delete w.then}))).catch(y=>Promise.reject(y)));return q};Object.defineProperty(p,"__esModule",{value:!0})})},
"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils"],function(a){let p=function(){this.ids=new Set;this.paused=!1};return function(){function b({collection:q,forAllFeatures:y,forAllFeaturesOfNode:f}){this.highlights=[];this.collection=q;this.forAllFeatures=y;this.forAllFeaturesOfNode=f}var r=b.prototype;r.destroy=function(){this.highlights.forEach(q=>this.releaseSet(q));this.highlights=null};r.acquireSet=function(){const q=new p;this.highlights.push(q);return{set:q,
handle:{remove:()=>{this.releaseSet(q);a.removeUnordered(this.highlights,q)},pause:()=>{this.releaseSet(q);q.paused=!0},resume:()=>{q.paused=!1;this.initializeSet(q)}}}};r.setFeatureIds=function(q,y){y.forEach(f=>q.ids.add(f));this.initializeSet(q)};r.initializeSet=function(q){this.forAllFeatures((y,f,w)=>{q.ids.has(y)&&this.collection.addComponentHighlight(w.objectHandle,f);return 1})};r.releaseSet=function(q){this.forAllFeatures((y,f,w)=>{q.ids.has(y)&&this.collection.removeComponentHighlight(w.objectHandle,
f);return 1})};r.objectCreated=function(q){this.highlights.forEach(y=>{y.paused||this.forAllFeaturesOfNode(q,(f,w)=>{y.ids.has(f)&&this.collection.addComponentHighlight(q.objectHandle,w);return 1})})};r.objectDeleted=function(q){this.collection.clearHighlights(q.objectHandle)};return b}()})},"esri/views/3d/layers/i3s/I3SAttributeOverrides":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../intl/number ../../../../layers/support/featureQueryAll".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g){const d=f.getLogger("esri.views.3d.layers.i3s.I3SAttributeOverrides");f=function(){function u(h,m){this.layer=h;this.warnMaximumChangedObjectsExceeded=!1;this.changedObjectIds=new Set;this.pendingFetchAbortController=e.createAbortController();this.interactiveEditingSessions=null;this._maximumNumberOfEditOVerrides=5E4;this.memCache=m.getMemCache(`${h.uid}-attribute-overrides`);this.pendingFetchChangedObjectIds=this.fetchChangedObjectIds(this.pendingFetchAbortController.signal);
this.pendingFetchChangedObjectIds.then(()=>this.pendingFetchAbortController=null)}var t=u.prototype;t.destroy=function(){this.layer=null;this.memCache.destroy();this.memCache=null;this.pendingFetchAbortController&&(this.pendingFetchAbortController.abort(),this.pendingFetchAbortController=null);this.pendingFetchChangedObjectIds=null};t.createInteractiveEditSession=function(h){this.changedObjectIds.add(h);w.isNone(this.interactiveEditingSessions)&&(this.interactiveEditingSessions=[]);const m=this.interactiveEditingSessions,
n=new c(h,{rollback:()=>{r.remove(m,n);0===m.length&&(this.interactiveEditingSessions=null)},commit:z=>{for(const [k,v]of z)this.updateValue(h,k,v)}});m.unshift(n);return n};t.apply=function(){var h=p._asyncToGenerator(function*(m,n,z){if(!w.isNone(n)){var {loadedAttributes:k,attributeData:v}=n;if(!w.isNone(k)&&0!==k.length&&!w.isNone(v)&&(yield e.whenOrAbort(this.pendingFetchChangedObjectIds,z),0!==this.changedObjectIds.size)){n={loadedAttributes:k,attributeData:v};var x=this.getOverridesFromCache(m,
n,this.changedObjectIds),{objectIds:C,fieldNames:A}=x;z=yield this.queryOverridesFromAssociatedLayer(C,A,z);w.isNone(z)||this.processOverridesFromAssociatedLayer(m,z,A,n)}}});return function(m,n,z){return h.apply(this,arguments)}}();t.updateValue=function(h,m,n){this.changedObjectIds.add(h);this.cacheValue(h,m,n)};t.cacheValue=function(h,m,n){this.memCache.put(this.getCacheKey(h,m),n,this.memCacheValueSize(n))};t.getOverridesFromCache=function(h,{loadedAttributes:m,attributeData:n},z){const k=new Set,
v=[];for(var x of m)v[x.index]=n[x.name];n=new Set;for(x=0;x<h.length;x++){const C=h[x];if(z.has(C))for(const A of m){const B=this.fromCache(C,A.index);void 0!==B?v[A.index][x]=B:(k.add(C),n.add(A.name))}}return{objectIds:Array.from(k),fieldNames:Array.from(n)}};t.fromCache=function(h,m){const n=this.fromInteractiveEditingSession(h,m);if(void 0!==n)return n;h=this.getCacheKey(h,m);return this.memCache.get(h)};t.fromInteractiveEditingSession=function(h,m){if(!w.isNone(this.interactiveEditingSessions))for(const n of this.interactiveEditingSessions){if(n.objectId!==
h)continue;const z=n.get(m);if(void 0!==z)return z}};t.getCacheKey=function(h,m){return`${h}-${m}`};t.queryOverridesFromAssociatedLayer=function(){var h=p._asyncToGenerator(function*(m,n,z){if(0===m.length||0===n.length)return null;m=m.sort((x,C)=>x-C);this.warnMaximumChangedObjectsExceeded&&(this.warnMaximumChangedObjectsExceeded=!1,this.logMaximumObjectsExceededWarning());const k=w.unwrap(this.layer.associatedLayer),v=k.createQuery();v.where="1\x3d1";v.returnGeometry=!1;v.outFields=[k.objectIdField,
...n];v.cacheHint=!0;v.objectIds=m;n=g.getMaximumQuerySize(k);m=m.length>n?r.splitIntoChunks(m,n).map(x=>{const C=v.clone();C.objectIds=x;return q.resultOrAbort(g.queryAllJSON(k,C,{signal:z}))}):[q.resultOrAbort(g.queryAllJSON(k,v,{signal:z}))];return(yield Promise.all(m)).reduce((x,C)=>x.concat(C.ok?C.value.features:[]),[])});return function(m,n,z){return h.apply(this,arguments)}}();t.logMaximumObjectsExceededWarning=function(){let h=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${l.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`;
const m=this.layer.portalItem;h=m&&m.loaded?h+` (${m.portal.url}/home/item.html?id=${m.id}#settings)`:h+` (${this.layer.parsedUrl.path})`;d.warn("#queryOverrides()",this.layer.title,`${h}.`)};t.processOverridesFromAssociatedLayer=function(h,m,n,{loadedAttributes:z,attributeData:k}){const v=w.unwrap(this.layer.associatedLayer).objectIdField,x=n.map(A=>k[A]),C=new Map(z.map(A=>[A.name,A.index]));z=n.map(A=>C.get(A));h=new Map(Array.from(h,(A,B)=>[A,B]));for(const A of m){m=A.attributes[v];for(let B=
0;B<n.length;B++){const D=z[B],E=h.get(m),G=A.attributes[n[B]];x[B][E]=G;this.cacheValue(m,D,G)}}};t.memCacheValueSize=function(h){return"string"===typeof h?y.estimateStringByteSize(h):y.estimateNumberByteSize()};t.fetchChangedObjectIds=function(){var h=p._asyncToGenerator(function*(m){var n,z,k,v=this.layer;yield v.load({signal:m});this.changedObjectIds.clear();if(!w.isNone(v.associatedLayer)&&null!=(n=v.associatedLayer.capabilities)&&null!=(z=n.operations)&&z.supportsChangeTracking){n=this.getFetchChangedObjectIdsServerGen();
if(w.isNone(n))return null;z=v.associatedLayer.layerId;m=yield q.result(b(`${v.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`${z}`,returnUpdates:!0,returnDeletes:!1,returnInserts:!1,layerServerGens:JSON.stringify([{id:z,serverGen:n}])},timeout:1E4,signal:m}));m=m.ok&&null!=(k=m.value.data)&&k.edits?w.get(m.value.data.edits[0],"objectIds","updates"):null;if(w.isSome(m))for(k=Math.min(this._maximumNumberOfEditOVerrides,m.length),k<m.length&&(this.warnMaximumChangedObjectsExceeded=
!0),m=m.sort((x,C)=>x-C),v=0;v<k;v++)this.changedObjectIds.add(m[v])}});return function(m){return h.apply(this,arguments)}}();t.getFetchChangedObjectIdsServerGen=function(){var h=this.layer;if(w.isSome(h.serviceUpdateTimeStamp)&&w.isSome(h.serviceUpdateTimeStamp.lastUpdate))return h.serviceUpdateTimeStamp.lastUpdate;h=h.associatedLayer;return w.isSome(h)&&w.isSome(h.serverGens)&&w.isSome(h.serverGens.minServerGen)?h.serverGens.minServerGen:null};p._createClass(u,[{key:"test",get:function(){const h=
this;return{changedObjectIds:Array.from(this.changedObjectIds),pendingFetchChangedObjectIds:this.pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return h._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(m){h._maximumNumberOfEditOVerrides=m}}}}]);return u}();let c=function(){function u(h,m){this.objectId=h;this.options=m;this.updates=new Map;this.state=0}var t=u.prototype;t.get=function(h){return this.updates.get(h)};t.set=function(h,m){this.isActive&&this.updates.set(h,
m)};t.rollback=function(){this.isActive&&(this.state=2,this.options.rollback())};t.commit=function(){this.isActive&&(this.state=1,this.options.commit(this.updates),this.updates.clear())};p._createClass(u,[{key:"isActive",get:function(){return 0===this.state}}]);return u}();a.I3SAttributeOverrides=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/featureQueryAll":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../rest/support/Query"],
function(a,p,b,r){function q(){q=p._asyncToGenerator(function*(e,l,g){l=l.clone();e.capabilities.query.supportsMaxRecordCountFactor&&(l.maxRecordCountFactor=w(e));const d=y(e),c=e.capabilities.query.supportsPagination;l.start=0;l.num=d;let u=null;for(;;){const t=yield e.source.queryFeaturesJSON(l,g);b.isNone(u)?u=t:u.features=u.features.concat(t.features);u.exceededTransferLimit=t.exceededTransferLimit;if(!c||!t.exceededTransferLimit)break;l.start+=d}return u});return q.apply(this,arguments)}function y(e){return w(e)*
f(e)}function f(e){return e.capabilities.query.maxRecordCount||2E3}function w(e){return e.capabilities.query.supportsMaxRecordCountFactor?r.MAX_MAX_RECORD_COUNT_FACTOR:1}a.getMaxRecordCountFactor=w;a.getMaximumQuerySize=y;a.getMaximumRecordCount=f;a.queryAllJSON=function(e,l,g){return q.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe",
"../../../../core/scheduling"],function(a,p,b,r){let q=function(){function y(w){this.view=w;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var f=y.prototype;f.stopNodeFading=function(w){null!=w.lodCrossfadeProgress&&(this._numFadingNodes--,w.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=b.removeMaybe(this._preRenderFrameTaskHandle)),this.view.notifyLODUpdate(),this.view.notifyUpdate()))};
f._startNodeFading=function(w,e,l){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=r.addFrameTask({preRender:g=>this._updateAllNodeFading(g)}),this.view.notifyLODUpdate());null==w.lodCrossfadeProgress&&(this._numFadingNodes++,this.view.notifyUpdate());w.lodCrossfadeSignedDuration=l;w.lodCrossfadeProgress=e};f._updateAllNodeFading=function(w){const e=this.view.nodeCrossfadingEnabled;this.view.foreachCrossfadeNode((l,g)=>{if(b.isSome(g)&&b.isSome(g.lodCrossfadeProgress)){const d=g.lodCrossfadeSignedDuration,
c=g.lodCrossfadeProgress+Math.abs(w.deltaTime/d),u=!e||1<=c||0===d,t=(0<d?this.view.fullOpacity:0)-(u?0:0<d?1:-1)*(1-c);u?(this.stopNodeFading(g),0>d&&this.view.markNodeToRemove(l)):g.lodCrossfadeProgress=c;this.view.setNodeOpacityByIndex(l,t)}});this.view.removeMarkedNodes()};f.stopAllNodeFading=function(){this.view.foreachCrossfadeNode((w,e)=>{b.isSome(e)&&b.isSome(e.lodCrossfadeProgress)&&(this.stopNodeFading(e),e=e.lodCrossfadeSignedDuration,0>e&&this.view.markNodeToRemove(w),this.view.setNodeOpacityByIndex(w,
0<e?this.view.fullOpacity:0))});this.view.removeMarkedNodes()};f.fadeNode=function(w,e,l,g){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var d=this.view;const c=d.nodeCrossfadingEnabled,u=0===l?d.fullOpacity:0;g=c?g?0===l?d.lodCrossfadeinDuration:d.lodCrossfadeoutDuration:d.lodCrossfadeUncoveredDuration:0;d=this.view.getNodeOpacityByIndex(w);c&&d!==u&&0<g?this._startNodeFading(e,1-Math.abs(u-d),(0===l?1:-1)*g):(this.stopNodeFading(e),this.view.setNodeOpacityByIndex(w,
u),1===l&&this.view.removeNode(w))};f.isNodeFullyFadedIn=function(w){const e=this.view.getNodeCrossfadeMetaData(w);return b.isSome(e)&&null==e.lodCrossfadeProgress&&this.view.getNodeOpacityByIndex(w)===this.view.fullOpacity};p._createClass(y,[{key:"updating",get:function(){return 0<this._numFadingNodes}}]);return y}();a.I3SCrossfadeHelper=q;a.NodeCrossfadeMetaData=function(){this.lodCrossfadeSignedDuration=0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../webgl-engine/lib/Intersector".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){const m=t.empty(),n=d.create(),z=u.create(),k=u.create(),v=u.create(),x=q.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");b=function(C){function A(D){D=C.call(this,D)||this;D.tmpEvent={spatialReference:null,extent:m,context:"scene"};return D}a._inheritsLoose(A,C);var B=A.prototype;B.initialize=function(){this.view=this.layerView.view;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersector=new h.Intersector(this.view.state.viewingMode);
this.intersector.options.store=0;const D=this.layerView.i3slayer.fullExtent;this.zmin=D.zmin;this.zmax=D.zmax;this.tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};B.getElevation=function(D,E,G,K){z[0]=D;z[1]=E;z[2]=G;if(!this.renderCoordsHelper.toRenderCoords(z,K,z))return x.error("could not project point to compute elevation"),null;D=this.layerView.elevationOffset;E=this.zmin+D;this.renderCoordsHelper.setAltitude(k,this.zmax+D,z);this.renderCoordsHelper.setAltitude(v,E,z);this.intersector.reset(k,
v);this.intersectionHandler.intersect(this.intersector,null,k,v);return this.intersector.results.min.getIntersectionPoint(z)?this.renderCoordsHelper.getAltitude(z):null};B.layerChanged=function(){this.spatialReference&&(this.tmpEvent.extent=this.computeLayerExtent(),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};B.objectChanged=function(D){this.spatialReference&&(this.tmpEvent.extent=this.computeObjectExtent(D),this.tmpEvent.spatialReference=this.spatialReference,
this.emit("elevation-change",this.tmpEvent))};B.computeObjectExtent=function(D){t.empty(m);this._expandExtent(D,m);return m};B.computeLayerExtent=function(){t.empty(m);for(const D of this.layerView.getVisibleNodes())this._expandExtent(D,m);return m};B._expandExtent=function(D,E){var G=D.visibilityObb||D.serviceObbInRenderSR;if(y.isSome(G))for(g.fromQuat(n,G.quaternion),n[12]=G.center[0],n[13]=G.center[1],n[14]=G.center[2],D=0;8>D;++D)z[0]=D&1?G.halfSize[0]:-G.halfSize[0],z[1]=D&2?G.halfSize[1]:-G.halfSize[1],
z[2]=D&4?G.halfSize[2]:-G.halfSize[2],c.transformMat4(z,z,n),this.renderCoordsHelper.fromRenderCoords(z,z,this.spatialReference),t.expand(E,z,E);else{var K=D.renderMbs[3];G=c.copy(k,D.renderMbs);G[0]-=K;G[1]-=K;G[2]-=K;D=c.copy(v,D.renderMbs);D[0]+=K;D[1]+=K;D[2]+=K;for(K=0;8>K;++K)z[0]=K&1?G[0]:D[0],z[1]=K&2?G[1]:D[1],z[2]=K&4?G[2]:D[2],this.renderCoordsHelper.fromRenderCoords(z,z,this.spatialReference),t.expand(E,z,E)}};return A}(r.EventedMixin(b));p.__decorate([f.property({constructOnly:!0})],
b.prototype,"layerView",void 0);p.__decorate([f.property({constructOnly:!0})],b.prototype,"intersectionHandler",void 0);p.__decorate([f.property()],b.prototype,"view",void 0);p.__decorate([f.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],b.prototype,"spatialReference",void 0);return b=p.__decorate([l.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],b)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../support/orientedBoundingBox ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,p,b,r,q,y,f){function w(l,g,d,c=0){c=l[3]+c;const u=g[0]-l[0],t=g[1]-l[1];l=g[2]-l[2];g=d[0];const h=d[1];d=d[2];const m=g*u+h*t+d*l;return 0<=m*m-(g*g+h*h+d*d)*(u*u+t*t+l*l-c*c)}let e=function(){function l(g){this.type="I3S";this.layerUid=g.layerUid;this.sublayerUid=g.sublayerUid;this.collection=g.collection;this.traverseNodeHierarchy=g.traverseNodeHierarchy;this.slicePlane=g.slicePlaneEnabled;this.isGround=g.isGround}l.prototype.intersect=function(g,d,c,u){const t=g.results,h=2===g.options.store,
m=g.ray.direction,n=g.tolerance;let z=x=>x,k=x=>x;const v=f.getVerticalOffsetI3S(g.verticalOffset);b.isSome(v)&&(z=x=>v.applyToMbs(x),k=x=>v.applyToObb(x));this.traverseNodeHierarchy((x,C)=>{if(b.isSome(x.serviceObbInRenderSR)&&!q.intersectLine(k(x.serviceObbInRenderSR),c,m,n))return!1;!C||b.isSome(x.geometryObb)&&!q.intersectLine(k(x.geometryObb),c,m,n)||!b.isSome(x.serviceObbInRenderSR)&&!w(z(x.renderMbs),c,m,n)||this.collection.intersect(C,c,u,n,v,(A,B,D,E)=>{if(0<=B&&(null==d||d(c,u,B))){var G=
K=>{K.intersector=this.type;K.target={type:"external",metadata:{layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:x.index,componentIndex:A}};K.dist=B;r.copy(K.normal,D);K.triangleNr=E};this.isGround&&(null==t.ground.dist||B<t.ground.dist)&&G(t.ground);if(!g.options.isFiltered&&((null==t.min.dist||B<t.min.dist)&&G(t.min),(null==t.max.dist||B>t.max.dist)&&G(t.max),h)){const K=new y.IntersectorResult(g.ray);G(K);g.results.all.push(K)}}});return!0})};p._createClass(l,[{key:"intersectionHandlerId",
get:function(){return this.layerUid}}]);return l}();a.I3SIntersectionHandler=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Error","../../../../core/maybe","../../../../core/promiseUtils"],function(a,p,b,r,q){function y(e){return new Promise((l,g)=>{e.oncomplete=()=>l();e.onerror=()=>g(e.error);e.onabort=()=>g(e.error)})}function f(e){return new Promise((l,g)=>{"done"===
e.readyState?null!=e.error?g(e.error):l(e.result):(e.onsuccess=()=>l(e.result),e.onerror=()=>g(e.error))})}let w=function(){function e(g,d,c=14){this._version=c;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=g;this._storeName=d}var l=e.prototype;l.init=function(){return Promise.resolve().then(()=>{const g=indexedDB.open(this._dbName,this._version);g.onupgradeneeded=
d=>{var c=g.result;const u=g.transaction,t=c.objectStoreNames.contains(this._storeName)?u.objectStore(this._storeName):c.createObjectStore(this._storeName);c=c.objectStoreNames.contains("last_access")?u.objectStore("last_access"):c.createObjectStore("last_access");c.indexNames.contains("date")||c.createIndex("date","date",{unique:!1});c.indexNames.contains("byteSize")||c.createIndex("byteSize","byteSize",{unique:!1});d.oldVersion<this._version&&(t.clear(),c.clear())};return f(g)}).then(g=>{this._destroyed?
g.close():this._db=g})};l.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};l.getHitRate=function(){return this._hit/(this._hit+this._miss)};l.put=function(g,d){return null==this._db?Promise.reject(new b("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>this._put(g,d)).catch(c=>{if(c&&"QuotaExceededError"===c.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=
this._getCacheSize().then(u=>this._removeLeastRecentlyAccessed(d.byteSize+Math.ceil(u*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(g,d));throw c;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(c=>this._removeLeastRecentlyAccessed(c-this.maxByteSize)))})};l.get=function(g,d){if(null==
this._db)return Promise.resolve(null);let c=null;return Promise.resolve().then(()=>{const u=this._db.transaction(this._storeName,"readonly");c=q.onAbort(d,()=>{u.abort()});const t=u.objectStore(this._storeName).get(g);return f(t)}).then(u=>{null==u?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:u.byteSize},g));r.isSome(c)&&c.remove();return u}).catch(()=>{++this._miss;q.throwIfAborted(d);r.isSome(c)&&c.remove();
return null})};l.remove=function(g){var d=this;return null==this._db?Promise.resolve():Promise.resolve().then(p._asyncToGenerator(function*(){const c=d._db.transaction([d._storeName,"last_access"],"readwrite");var u=c.objectStore(d._storeName),t=c.objectStore("last_access");u=u.delete(g);t=t.delete(g);yield Promise.all([f(u),f(t),y(c)])}))};l._put=function(g,d){const c=this._db.transaction([this._storeName,"last_access"],"readwrite");var u=c.objectStore(this._storeName);const t=c.objectStore("last_access");
u=u.put(d,g);g=t.put({date:Date.now(),byteSize:d.byteSize},g);return Promise.all([f(u),f(g),y(c)])};l._removeLeastRecentlyAccessed=function(g){if(!(0>=g)){var d=this._db.transaction([this._storeName,"last_access"],"readwrite"),c=d.objectStore(this._storeName),u=d.objectStore("last_access"),t=0,h=u.index("date").openCursor(null,"next");h.onsuccess=()=>{const m=h.result;null!=m&&(null!=m.value.byteSize&&(t+=m.value.byteSize),c.delete(m.primaryKey),u.delete(m.primaryKey),t<g&&m.continue())};return y(d)}};
l._getCacheSize=function(){const g=this._db.transaction("last_access");let d=0;const c=g.objectStore("last_access").index("byteSize").openKeyCursor();c.onsuccess=()=>{const u=c.result;if(u){var t=u.key;null!=t&&(d+=t);u.continue()}};return y(g).then(()=>d)};p._createClass(e,[{key:"initialized",get:function(){return null!=this._db}}]);return e}();a.IDBCache=w;a.whenRequest=f;a.whenTransaction=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/attributeEditing":function(){define(["exports",
"../../../../core/lang","../../../../core/maybe","../support/attributeUtils"],function(a,p,b,r){function q(l,g){const d=g.edits.updateFeatures;if(!d||0===d.length)return new e;const c=y(g),u=new e;g=new Map;for(let n=0;n<l.attributeStorageInfo.length;n++)g.set(l.attributeStorageInfo[n].name,n);const t=l.fieldsIndex,h=l.objectIdField,m=d.filter(n=>{n=r.attributeLookup(t,n.attributes,h);return c.has(n)});l.forEachNode((n,z)=>{const k=new Set(z);for(const B of m){const D=r.attributeLookup(t,B.attributes,
h);if(!k.has(D))continue;const E=z.indexOf(D);for(const G in B.attributes){var v=l.fieldsIndex.normalizeFieldName(G);var x=u;var C=n.index,A=x.get(C);A?x=A:(A=new w,x.set(C,A),x=A);(C=x.get(v))?v=C:(C=[],x.set(v,C),v=C);v.push({featureIndex:E,featureId:D,value:B.attributes[G]})}}});return u}function y(l){const g=new Set;if(!l.updatedFeatures)return g;for(const d of l.updatedFeatures)null!=d.objectId&&null==d.error&&g.add(d.objectId);return g}const f={setAttribute(){},rollback(){},commit(){}},w=Map,
e=Map;a.createInteractiveEditSession=function(l,g){const d=g.attributes[l.objectIdField];var c=l.sessions.get(d);if(c)return c;const u=p.clone(g.attributes),t=new Set;if(null==d)return f;const h=l.attributeOverrides.createInteractiveEditSession(d),m=new Map;let n=0;c={setAttribute(z,k){if(0===n){var v=l.fieldsIndex.get(z);if(!b.isNone(v)){var x=l.attributeStorageInfo.findIndex(B=>B.name===v.name);if(!(0>x)){h.set(x,k);var C=l.attributeStorageInfo[x],A=!1;t.add(z);l.forEachNode((B,D)=>{var E=m.get(B);
null==E?(D=D.indexOf(d),m.set(B,D)):D=E;if(-1!==D&&(E=l.getAttributeData(B.index))){const G=E[C.name];G&&(G[D]=k,l.setAttributeData(B.index,E,g),A=!0)}});A&&l.clearMemCache()}}}},rollback(){if(0===n){for(const z of t)this.setAttribute(z,u[z]);h.rollback();n=1;l.sessions.delete(d)}},commit(){0===n&&(h.commit(),n=2,l.sessions.delete(d))}};l.sessions.set(d,c);return c};a.processAttributeEdits=function(l,g){g=q(l,g);if(0!==g.size){var d=new Map;for(let u=0;u<l.attributeStorageInfo.length;u++)d.set(l.attributeStorageInfo[u].name,
u);var c=!1;g.forEach((u,t)=>{const h=l.getAttributeData(t);let m=!1;u.forEach((n,z)=>{const k=b.isSome(h)?h[z]:null;z=d.get(z);for(const {featureIndex:v,value:x,featureId:C}of n)k&&(k[v]=x,c=m=!0),l.attributeOverrides.updateValue(C,z,x)});m&&l.setAttributeData(t,h,null)});c&&l.clearMemCache()}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../core/sql/WhereClause ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/webMercatorUtils ./I3SUtil ../../../layers/support/FeatureFilter ../../../../geometry/SpatialReference".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A){function B(){return D.apply(this,arguments)}function D(){D=b._asyncToGenerator(function*(){return N?N:N=yield new Promise(function(V,ca){a(["../../../../geometry/geometryEngine"],V,ca)})});return D.apply(this,arguments)}function E(V,ca){if(e.isNone(V))return null;if("disjoint"===ca&&"polygon"===V.type){const Z=Array(V.rings.length);for(ca=0;ca<V.rings.length;++ca){var ba=k.fromValues(Infinity,Infinity,-Infinity,-Infinity);k.expandWithNestedArray(ba,
V.rings[ca]);Z[ca]={type:"polygon",rings:[V.rings[ca]],spatialReference:V.spatialReference,aabr:ba}}Z.sort((aa,W)=>aa.aabr[0]-W.aabr[0]);const ha=new Set,fa=new f.PositionHint;for(V=0;V<Z.length;++V){const aa=Z[V];for(ca=V+1;ca<Z.length;++ca){ba=Z[ca];if(ba.aabr[0]>=aa.aabr[2])break;ha.add(ba)}ha.forEach(W=>{aa!==W&&(W.aabr[2]<=aa.aabr[0]?ha.delete(W):N.intersects(aa,W)&&(aa.rings=aa.rings.concat(W.rings),k.expand(aa.aabr,W.aabr,aa.aabr),delete aa._geVersion,ha.delete(W),W=f.indexOf(Z,W,Z.length,
fa),Z.splice(W,1)))});ha.add(aa)}for(const aa of Z)delete aa.aabr;return Z}return[V]}function G(V,ca,ba,Z){const ha=H(V,ba);return ca.every(fa=>1!==J(fa,ha,Z))}function K(V,ca,ba,Z,ha,fa,aa){const W=fa[0].spatialReference||Z.spatialReference;if(n.projectBoundingSphere(ca.node.mbs,ha,S,W)){ha=H(S,W);var U=M(aa,Z,W,ba,ca.objectHandle);for(const X of fa){if(0===V.length)break;switch(J(X,ha,aa)){case 1:V.length=0;return;case 0:continue}x.filterInPlace(V,ca.featureIds,T=>F(X,T,U))}}else L.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}
function M(V,ca,ba,Z,ha){ca=ca.renderSpatialReference;const fa=new Map,aa={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:ba};aa.rings[0][3]=aa.rings[0][0];let W,U;switch(V){case "intersects":W=(X,T)=>N.intersects(X,T)?0:2;U=O;break;case "contains":W=(X,T)=>N.contains(X,T)?2:1;U=O;break;default:W=(X,T)=>N.disjoint(X,T)?2:1,U=I}return{collection:Z,object:ha,type:V,maskSR:ba,renderSR:ca,aabbCache:fa,triangle:aa,positions:{indices:null,data:null,stride:0,startIndex:0,
endIndex:0},triangleTest:W,geometryTest:U}}function H(V,ca){const ba={x:V[0],y:V[1],hasZ:!1,hasM:!1,type:"point",spatialReference:ca};V=ca.isWGS84||ca.isWebMercator?N.geodesicBuffer(ba,V[3],1):N.buffer(ba,V[3],1);V.type="polygon";return V}function J(V,ca,ba){switch(ba){case "intersects":case "contains":return O(V,ca);case "disjoint":return I(V,ca)}}function O(V,ca){return N.intersects(V,ca)?N.contains(V,ca)?0:2:1}function I(V,ca){return N.intersects(V,ca)?N.contains(V,ca)?1:2:0}function F(V,ca,ba){const {collection:Z,
object:ha,renderSR:fa,maskSR:aa,geometryTest:W,aabbCache:U}=ba;var X=U.get(ca);if(!X){X=Z.getObjectTransform(ha);Z.getComponentAabb(ha,ca,Q);var T=[[Q[0],Q[1],0],[Q[0],Q[4],0],[Q[3],Q[4],0],[Q[3],Q[1],0]];for(var Y=0;4>Y;++Y)h.transformMat3(T[Y],T[Y],X.rotationScale),h.add(T[Y],T[Y],X.position),n.projectVectorToVector(T[Y],fa,T[Y],aa);X={rings:[T],hasZ:!1,hasM:!1,type:"polygon",spatialReference:aa};X.rings[0][4]=X.rings[0][0];U.set(ca,X)}switch(W(V,X)){case 1:return!1;case 0:return!0}const {triangle:ea,
triangleTest:ia,positions:la}=ba;X=ea.rings[0][0];T=ea.rings[0][1];Y=ea.rings[0][2];const pa=Z.getObjectTransform(ha);Z.getComponentPositions(ha,ca,la);const {indices:ua,data:wa,stride:Fa,startIndex:La,endIndex:Ma}=la;for(ca=La;ca<Ma;ca+=3){const Sa=Fa*ua[ca+0],Ia=Fa*ua[ca+1],va=Fa*ua[ca+2];h.set(X,wa[Sa+0],wa[Sa+1],wa[Sa+2]);h.set(T,wa[Ia+0],wa[Ia+1],wa[Ia+2]);h.set(Y,wa[va+0],wa[va+1],wa[va+2]);h.transformMat3(X,X,pa.rotationScale);h.transformMat3(T,T,pa.rotationScale);h.transformMat3(Y,Y,pa.rotationScale);
h.add(X,X,pa.position);h.add(T,T,pa.position);h.add(Y,Y,pa.position);n.projectVectorToVector(X,fa,X,aa);n.projectVectorToVector(T,fa,T,aa);n.projectVectorToVector(Y,fa,Y,aa);if(!(Math.abs((T[0]-X[0])*(Y[1]-X[1])-(T[1]-X[1])*(Y[0]-X[0]))<P))switch(delete ea._geVersion,ia(V,ea)){case 1:return!1;case 0:return!0}}switch(ba.type){case "intersects":return!1;default:return!0}}const L=w.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");p.I3SMeshViewFilter=function(V){function ca(Z){Z=V.call(this,Z)||
this;Z._projectionEngineLoaded=!1;return Z}b._inheritsLoose(ca,V);var ba=ca.prototype;ba.initialize=function(){g.whenOnce(this,"filter.geometry").then(()=>this.loadAsyncModule(B().then(Z=>{this.destroyed||(this._geometryEngine=Z,this.applyFilters())})))};ba.addFilters=function(Z,ha,fa,aa){const W=this.sortedObjectIds;e.isSome(W)&&Z.push(X=>x.objectIdFilter(W,!0,X));this.addSqlFilter(Z,this.parsedWhereClause);const U=this.parsedGeometry;if(e.isSome(U)){const X=this.spatialRelationship;Z.push((T,Y)=>
K(T,Y,aa,ha,fa,U,X))}};ba.isMBSGeoemtryVisible=function(Z,ha,fa){const aa=this.parsedGeometry;if(e.isSome(aa)){const W=this.spatialRelationship;ha=aa[0].spatialReference||ha;return n.projectBoundingSphere(Z,fa,S,ha)?G(S,aa,ha,W):(L.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0};ca.checkSupport=function(Z){if(Z.timeExtent)return L.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1;Z=Z.spatialRelationship;
return null!=Z&&0<=R.indexOf(Z)?!0:(L.warn(`Filters with spatialRelationship other than ${R.join(", ")} are not supported for mesh scene layers`),!1)};b._createClass(ca,[{key:"sortedObjectIds",get:function(){if(e.isNone(this.filter.objectIds))return null;const Z=new Float64Array(this.filter.objectIds);Z.sort();return Z}},{key:"parsedWhereClause",get:function(){const Z=e.isSome(this.filter)?this.filter.where:null;if(e.isNone(Z)||!Z)return null;try{return m.WhereClause.create(Z,this.layerFieldsIndex)}catch(ha){L.error(`Failed to parse filter where clause: ${ha}`)}return null}},
{key:"parsedGeometry",get:function(){if(e.isNone(this.filter)||!this._geometryEngine)return null;var {geometry:Z}=this.filter;if(e.isNone(Z))return null;const {distance:ha,units:fa}=this.filter,aa=this.spatialRelationship;Z="mesh"===Z.type?Z.extent:Z;if(e.isNone(ha)||0===ha)return E(Z,aa);const W=fa||l.getUnitString(Z.spatialReference);if(Z.spatialReference.isWGS84)return Z=this._geometryEngine.geodesicBuffer(Z,ha,W),E(Z,aa);var U=v.project(Z,A.WGS84);if(e.isSome(U))return Z=v.project(this._geometryEngine.geodesicBuffer(U,
ha,W),Z.spatialReference),E(Z,aa);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(n.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;U=null;try{U=n.project(Z,A.WGS84)}catch(X){}if(U)try{U=n.project(this._geometryEngine.geodesicBuffer(U,ha,W),Z.spatialReference)}catch(X){U=null}U||L.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${Z.spatialReference.wkid}) to WGS84.`);return E(U,aa)}},{key:"spatialRelationship",
get:function(){return e.isSome(this.filter)?this.filter.spatialRelationship:"intersects"}}]);return ca}(y);r.__decorate([d.property({type:C})],p.I3SMeshViewFilter.prototype,"filter",void 0);r.__decorate([d.property()],p.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);r.__decorate([d.property()],p.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);r.__decorate([d.property()],p.I3SMeshViewFilter.prototype,"applyFilters",void 0);r.__decorate([d.property()],p.I3SMeshViewFilter.prototype,"addSqlFilter",
void 0);r.__decorate([d.property({readOnly:!0})],p.I3SMeshViewFilter.prototype,"sortedObjectIds",null);r.__decorate([d.property({readOnly:!0})],p.I3SMeshViewFilter.prototype,"parsedWhereClause",null);r.__decorate([d.property({readOnly:!0})],p.I3SMeshViewFilter.prototype,"parsedGeometry",null);r.__decorate([d.property({readOnly:!0})],p.I3SMeshViewFilter.prototype,"spatialRelationship",null);r.__decorate([d.property()],p.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);r.__decorate([d.property()],
p.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);p.I3SMeshViewFilter=r.__decorate([t.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],p.I3SMeshViewFilter);let N;const R=["contains","intersects","disjoint"],S=[0,0,0,0],P=2**-32,Q=z.create();Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h){const m=u["default"];a.I3SQueryEngine=function(n){function z(v){v=n.call(this,v)||this;v._dataQueryEngineInstance=null;v._handles=new y;return v}p._inheritsLoose(z,n);var k=z.prototype;k.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};k.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&
(this._handles.destroy(),this._handles=null);this._set("layerView",null)};k.executeQueryForCount=function(){var v=p._asyncToGenerator(function*(x,C){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(x),C)});return function(x,C){return v.apply(this,arguments)}}();k.executeQueryForExtent=function(){var v=p._asyncToGenerator(function*(x,C){const {count:A,extent:B}=yield this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(x),C);x=c.fromJSON(B);return{count:A,extent:x}});
return function(x,C){return v.apply(this,arguments)}}();k.executeQueryForIds=function(){var v=p._asyncToGenerator(function*(x,C){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(x),C)});return function(x,C){return v.apply(this,arguments)}}();k.executeQuery=function(){var v=p._asyncToGenerator(function*(x,C){x=this._ensureQueryJSON(x);if(x.returnGeometry)throw new q("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(x.returnCentroid)throw new q("feature-store:unsupported-query",
"returnCentroid is not yet supported for mesh scene layer queries");C=yield this.dataQueryEngine.executeQuery(x,C);C=t.fromJSON(C);C.features.forEach(A=>{A.geometry=null});return C});return function(x,C){return v.apply(this,arguments)}}();k._ensureQueryJSON=function(v){if(f.isNone(v))return this.defaultQueryJSON;const x=v.toJSON();x.outSpatialReference||(v.outSpatialReference=this.spatialReference);return x};k.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const v=this.layer.objectIdField||"OBJECTID",x=this.layer.fields.map(B=>B.toJSON()),C=this.layerView.view.resourceController.scheduler,A=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new m({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:x,timeInfo:null,spatialReference:A,objectIdField:v,featureStore:this.spatialIndex,scheduler:C,priority:this.priority})};p._createClass(z,[{key:"defaultQueryJSON",get:function(){return(new h({outSpatialReference:this.spatialReference})).toJSON()}},
{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);return z}(r);b.__decorate([w.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",void 0);b.__decorate([w.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);b.__decorate([w.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"spatialIndex",void 0);b.__decorate([w.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],a.I3SQueryEngine.prototype,"spatialReference",
void 0);b.__decorate([w.property({readOnly:!0,aliasOf:"layerView.i3slayer"})],a.I3SQueryEngine.prototype,"layer",void 0);b.__decorate([w.property({readOnly:!0})],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=b.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],a.I3SQueryEngine);a["default"]=a.I3SQueryEngine;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("exports ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),
function(a,p,b,r,q,y){let f=function(){function e(g){this.objectIdField=g.objectIdField;this.getFeatureExtent=g.getFeatureExtent}var l=e.prototype;l.getObjectId=function(g){return g.id};l.getAttributes=function(g){const {meta:d,index:c}=g,u={};this.objectIdField&&(u[this.objectIdField]=g.id);g=p.isSome(d.attributeInfo)&&d.attributeInfo.attributeData;if(p.isSome(g))for(const t of Object.keys(g))u[t]=y.getCachedAttributeValue(g[t],c);return u};l.getAttribute=function(g,d){if(d===this.objectIdField)return g.id;
const {meta:c,index:u}=g;g=p.isSome(c.attributeInfo)&&c.attributeInfo.attributeData;return p.isSome(g)?y.getCachedAttributeValue(g[d],u):null};l.getGeometry=function(g){if(g.geometry)return g.geometry;const [d,c,u,t,h]=this.getFeatureExtent(g,w);return new q([5],[d,c,u,t,c,u,t,h,u,d,h,u,d,c,u])};l.getCentroid=function(g,d){if(g.geometry)return r.getCentroidOptimizedGeometry(new q,g.geometry,d.hasZ,d.hasM);const [c,u,t,h,m,n]=this.getFeatureExtent(g,w);return new q([0],[(c+h)/2,(u+m)/2,(t+n)/2])};
l.cloneWithGeometry=function(g,d){const {id:c,index:u,meta:t}=g;return{id:c,index:u,meta:t,geometry:d}};return e}();const w=b.create();a.I3SQueryFeatureAdapter=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u){a.I3SQueryFeatureStore=function(n){function z(v){v=n.call(this,v)||this;v.events=new q;return v}p._inheritsLoose(z,n);var k=z.prototype;k.forEach=function(v){this.forAllFeatures(x=>{v(x);return 1})};k.forEachBounds=function(v,x,C){const A=this.getFeatureExtent;for(const B of v)x(A(B,C))};k.forEachInBounds=function(v,x){this.forAllFeatures(C=>{const A=this.getFeatureExtent(C,h);u.intersects(v,c.toRect(A,m))&&x(C);return 1},C=>{d.projectBoundingSphere(C.node.mbs,
this.sourceSpatialReference,t,this.viewSpatialReference);if(t[0]>=v[0]&&t[2]<=v[2]&&t[1]>=v[1]&&t[3]<=v[3])return 1;C=t[0]-Math.max(v[0],Math.min(t[0],v[2]));const A=t[1]-Math.max(v[1],Math.min(t[1],v[3]));return C*C+A*A<=t[3]*t[3]?1:2})};return z}(r);b.__decorate([y.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);b.__decorate([y.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"forAllFeatures",void 0);b.__decorate([y.property({constructOnly:!0})],
a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);b.__decorate([y.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);b.__decorate([y.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=b.__decorate([l.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);const t=g.create(),h=c.create(),m=u.create();a["default"]=a.I3SQueryFeatureStore;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),function(a,p,b,r,q,y,f,w,e,l){const g=r.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");
a.DefinitionExpressionSceneLayerView=d=>{d=function(c){function u(){var h=c.apply(this,arguments)||this;h._definitionExpressionErrors=0;h._maxDefinitionExpressionErrors=20;h.logError=m=>{h._definitionExpressionErrors<h._maxDefinitionExpressionErrors&&g.error("Error while evaluating definitionExpression: "+m);h._definitionExpressionErrors++;h._definitionExpressionErrors===h._maxDefinitionExpressionErrors&&g.error("Further errors are ignored")};return h}p._inheritsLoose(u,c);var t=u.prototype;t._evaluateClause=
function(h,m){try{return h.testFeature(m)}catch(n){return this.logError(n),!1}};t._addDefinitionExpressionToQuery=function(h){if(!this.parsedDefinitionExpression)return h;const m=this.i3slayer.definitionExpression;h=h.clone();h.where=h.where?`(${m}) AND (${h.where})`:m;return h};p._createClass(u,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const h=e.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);
if(!h.isStandardized)return g.error("definitionExpression is using non standard function"),null;const m=[];l.findFieldsCaseInsensitive(h.fieldNames,this.i3slayer.fields,{missingFields:m});if(0<m.length)return g.error(`definitionExpression references unknown fields: ${m.join(", ")}`),null;this._definitionExpressionErrors=0;return h}catch(h){return g.error("Failed to parse definitionExpression: "+h),null}}},{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:
null}}]);return u}(d);b.__decorate([q.property()],d.prototype,"i3slayer",void 0);b.__decorate([q.property({readOnly:!0})],d.prototype,"parsedDefinitionExpression",null);b.__decorate([q.property({readOnly:!0})],d.prototype,"definitionExpressionFields",null);return d=b.__decorate([w.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],d)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],
function(a,p){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:b,layer:{fieldsIndex:r},requiredFields:q}=this;return b.outFields?p.fixFields(r,[...p.unpackFieldNames(r,b.outFields),...q]):p.fixFields(r,q)}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/AsyncUpdate ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d){function c(h){return u.apply(this,arguments)}function u(){u=p._asyncToGenerator(function*(h){const m=new Set;try{return yield h(m),Array.from(m).sort()}catch(n){return t.error(n),null}});return u.apply(this,arguments)}const t=y.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields");a.SceneLayerViewRequiredFields=function(h){function m(n){return h.call(this,n)||this}p._inheritsLoose(m,h);m.prototype.initialize=function(){this.layer=this.layerView.layer;
this.handles.add([this.autoUpdateAsync("rendererFields",()=>{const {fieldsIndex:n,renderer:z}=this.layer;return z?c(k=>z.collectRequiredFields(k,n)):null}),this.autoUpdateAsync("labelingFields",()=>{const {layer:n}=this;return n.labelsVisible?c(z=>d.collectLabelingFields(z,n)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:n,filter:z}=this.layerView;return c(k=>d.collectFilterFields(k,n,z))})])};p._createClass(m,[{key:"requiredFields",get:function(){const {layerView:{layer:{fieldsIndex:n},
definitionExpressionFields:z},rendererFields:k,labelingFields:v,viewFilterFields:x}=this;return d.fixFields(n,[...f.unwrapOr(z,[]),...f.unwrapOr(k,[]),...f.unwrapOr(v,[]),...f.unwrapOr(x,[])])}}]);return m}(r.AsyncUpdateMixin(q.HandleOwner));b.__decorate([w.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);b.__decorate([w.property()],a.SceneLayerViewRequiredFields.prototype,"layer",void 0);b.__decorate([w.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",
null);b.__decorate([w.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);b.__decorate([w.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);b.__decorate([w.property()],a.SceneLayerViewRequiredFields.prototype,"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=b.__decorate([g.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ./Accessor ./Logger ./accessorSupport/tracking ./accessorSupport/decorators/subclass ./accessorSupport/tracking/SimpleTrackingTarget".split(" "),
function(a,p,b,r,q,y,f,w){function e(g,d){const c=()=>{if(!u||t)return d();u.clear();t=!0;const h=y.runTracked(u,d);t=!1;return h};let u=new w.SimpleTrackingTarget(()=>{u&&!t&&g(c)}),t=!1;g(c);return{remove:()=>{u&&(u.destroy(),u=null)}}}const l=g=>{g=function(d){function c(){var t=d.apply(this,arguments)||this;t.asyncUpdateState=new Map;return t}p._inheritsLoose(c,d);var u=c.prototype;u.autoUpdateAsync=function(t,h){return e(m=>this.updateAsync(t,m),h)};u.updateAsync=function(){var t=p._asyncToGenerator(function*(h,
m){if(!this.startAsyncUpdate(h)){try{const n=yield m();this._set(h,n)}catch(n){q.getLogger(this.declaredClass).warn(`Async update of "${h}" failed. Async update functions should not throw exceptions.`)}this.endAsyncUpdate(h)&&this.updateAsync(h,m)}});return function(h,m){return t.apply(this,arguments)}}();u.startAsyncUpdate=function(t){var h;const m=null!=(h=this.asyncUpdateState.get(t))?h:0;if(m&1)return this.asyncUpdateState.set(t,m|2),!0;this.asyncUpdateState.set(t,m|1);return!1};u.endAsyncUpdate=
function(t){var h;const m=(null!=(h=this.asyncUpdateState.get(t))?h:0)&-2;if(m&2)return this.asyncUpdateState.set(t,m&-3),!0;this.asyncUpdateState.set(t,m);return!1};return c}(g);return g=b.__decorate([f.subclass("esri.core.AsyncUpdate")],g)};a.AsyncUpdate=function(g){function d(){return g.apply(this,arguments)||this}p._inheritsLoose(d,g);return d}(l(r));a.AsyncUpdate=b.__decorate([f.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=l;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/layers/SceneLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/extensions/serializableProperty/reader ../../core/accessorSupport/tracking ./LayerView".split(" "),function(a,p,b,r,q,y,f,w,e){r=function(l){function g(){var c=l.apply(this,arguments)||this;c.layer=null;c.filter=null;return c}a._inheritsLoose(g,
l);var d=g.prototype;d.highlight=function(c){throw Error("Not implemented");};d.queryFeatures=function(c,u){throw Error("Not implemented");};d.queryObjectIds=function(c,u){throw Error("Not implemented");};d.queryFeatureCount=function(c,u){throw Error("Not implemented");};d.createQuery=function(){throw Error("Not implemented");};d.queryExtent=function(c,u){throw Error("Not implemented");};a._createClass(g,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},
set:function(c){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return g}(e);p.__decorate([b.property()],r.prototype,"layer",void 0);p.__decorate([b.property()],r.prototype,"availableFields",null);p.__decorate([b.property()],r.prototype,"maximumNumberOfFeatures",null);p.__decorate([b.property({readOnly:!0})],r.prototype,"maximumNumberOfFeaturesExceeded",null);p.__decorate([b.property()],r.prototype,"filter",void 0);return r})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../renderers/support/renderingInfoUtils ../../../rest/query/operations/zscale ../../../rest/support/Query ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./i3s/attributeEditing ./i3s/I3SAttributeOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/debugFlags ../support/GraphicsMap ../support/orientedBoundingBox ../support/updatingProperties ../../layers/SceneLayerView ../../layers/support/FeatureFilter ../../support/Scheduler".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N,R,S,P){function Q(fa){const aa=fa.attributeInfo;for(let W=0;W<fa.graphics.length;W++){const U=fa.graphics[W];U.attributes||(U.attributes={});if(y.isSome(aa)&&y.isSome(aa.loadedAttributes))for(const {name:X}of aa.loadedAttributes)aa.attributeData[X]&&(U.attributes[X]=K.getCachedAttributeValue(aa.attributeData[X],W))}}const V=q.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D");q=H.defineFieldProperties();A=function(fa){function aa(){var U=
fa.apply(this,arguments)||this;U.type="scene-layer-graphics-3d";U._nodesAddedToStage=new Map;U.drapeSourceType=1;U._queryEngine=null;U._memCache=null;U._interactiveEditingSessions=new Map;U.loadedGraphics=new F.GraphicsMap;U.holeFilling="always";U.progressiveLoadFactor=1;U.supportsHeightUnitConversion=!0;U._coordinatesOutsideExtentErrors=0;U._maxCoordinatesOutsideExtentErrors=20;return U}p._inheritsLoose(aa,fa);var W=aa.prototype;W.initialize=function(){var U;const X=this.layer;this.addResolvingPromise(X.indexInfo);
this._attributeOverrides=new G.I3SAttributeOverrides(this.layer,null==(U=this.view.resourceController)?void 0:U.memoryController);K.checkSpatialReferences(X,this.view.spatialReference,this.view.viewingMode);this.fieldsHelper=new O.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(X,"rangeInfos",T=>this._rangeInfosChanged(T),2);this.updatingHandles.add(X,"renderer",(T,Y)=>this._rendererChange(T,Y));this.updatingHandles.add(this,"parsedDefinitionExpression",()=>this._filterChange());
this.updatingHandles.add(this,"view.floors",()=>this.graphics3d.filterVisibility.filterChanged());this.handles.add(f.init(I,"I3S_TREE_SHOW_TILES",T=>{if(T&&!this._treeDebugger){const Y=this._controller.crsIndex;(new Promise(function(ea,ia){a(["./support/I3STreeDebugger"],ea,ia)})).then(({I3STreeDebugger:ea})=>{!this._treeDebugger&&I.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new ea({lv:this,view:this.view,nodeSR:Y}))})}else T||!this._treeDebugger||I.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),
this._treeDebugger=null)}));this._set("graphics3d",new B({owner:this,layer:X,preferredUpdatePolicy:0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:X.fullExtent,updateClippingExtent:T=>this._updateClippingExtent(T)}));if(this.graphics3d.elevationAlignment)this.graphics3d.elevationAlignment.events.on("invalidate-elevation",T=>this._invalidateElevation(T));
this.supportsHeightUnitConversion&&(this._verticalScale=v.getGeometryZScaler("point",X.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.graphics3d.setup());this._memCache=this.view.resourceController.memoryController.getMemCache(X.uid);this._controller=new z({layerView:this,scaleVisibilityEnabled:!1});K.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new C.I3SPointsWorkerHandle(T=>this.view.resourceController.schedule(T)));this.handles.add(this.layer.on("apply-edits",
T=>this.updatingHandles.addPromise(T.result)));this.handles.add(this.layer.on("edits",T=>this._handleEdits(T)));this.when(()=>{this._queryEngine=new D["default"]({layerView:this,priority:P.TaskPriority.FEATURE_QUERY_ENGINE});this.updatingHandles.add(this,"maximumNumberOfFeatures",T=>this._controller.featureTarget=T,2);this.updatingHandles.add(this,"suspended",T=>{T&&this._removeAllNodeData()})})};W.destroy=function(){this._treeDebugger=y.destroyMaybe(this._treeDebugger);this._attributeOverrides=y.destroyMaybe(this._attributeOverrides);
this._set("graphics3d",y.destroyMaybe(this.graphics3d));this._controller=y.destroyMaybe(this._controller);this._queryEngine=y.destroyMaybe(this._queryEngine);this._worker=y.destroyMaybe(this._worker);this._memCache=y.destroyMaybe(this._memCache);this._nodesAddedToStage.clear();this.fieldsHelper=y.destroyMaybe(this.fieldsHelper)};W.notifyGraphicGeometryChanged=function(U){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(U)};W.notifyGraphicVisibilityChanged=function(U){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(U)};
W.whenGraphicAttributes=function(){var U=p._asyncToGenerator(function*(X,T){return K.whenGraphicAttributes(this.layer,X,this._getObjectIdField(),T,()=>[...this._nodesAddedToStage.values()])});return function(X,T){return U.apply(this,arguments)}}();W.getGraphicFromGraphicUid=function(U){if(!this.loadedGraphics)return null;const X=n.hydrateGraphic(this.loadedGraphics.find(Y=>Y.uid===U),this.layer),T=this._getObjectIdField();if(!X||!X.attributes||!X.attributes[T])return null;X.layer=this.layer;X.sourceLayer=
this.layer;return X};W.whenGraphicBounds=function(U,X){return this.graphics3d.graphicsCore.whenGraphicBounds(U,X)};W.computeAttachmentOrigin=function(U,X){return this.graphics3d.graphicsCore.computeAttachmentOrigin(U,X)};W.canResume=function(){return fa.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};W.isUpdating=function(){return!!(this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating)};W.getRenderingInfo=function(U,X,T){U=k.getRenderingInfo(U,
{renderer:X,arcade:T});y.isSome(U)&&U.color&&(X=U.color,X[0]/=255,X[1]/=255,X[2]/=255);return U};W.getRenderingInfoAsync=function(){var U=p._asyncToGenerator(function*(X,T,Y,ea){return k.getRenderingInfoAsync(X,{renderer:T,arcade:Y,...ea})});return function(X,T,Y,ea){return U.apply(this,arguments)}}();W.highlight=function(U){return this.graphics3d.highlight(U,this.layer.objectIdField)};W.createInteractiveEditSession=function(U){return E.createInteractiveEditSession(this.attributeEditingContext,U)};
W.extractBinaryPointData=function(){var U=p._asyncToGenerator(function*(X,T){X={geometryBuffer:X.geometryBuffer};y.isNone(this._worker)&&(this._worker=new C.I3SPointsWorkerHandle(Y=>this.view.resourceController.schedule(Y)));return this._worker.invoke(X,T).then(Y=>{if(y.isSome(Y))return{positionData:Y.positions,featureIds:Y.featureIds};throw Error("Failed to decompress Draco point data");})});return function(X,T){return U.apply(this,arguments)}}();W.checkExtent=function(U,X){U&&!h.extentContainsCoords3D(U,
X)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&V.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&V.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)};W.addNode=function(){var U=p._asyncToGenerator(function*(X,T,Y){if(!("geometryBuffer"in T&&null!==T.geometryBuffer||"pointData"in T))return Promise.reject();if(this._nodesAddedToStage.has(X.index))V.error("I3S node "+
X.id+" already added");else{var ea=this.layer.fullExtent,ia;if(ia=ea)ea=ea.clone(),ea.xmin-=.5,ea.ymin-=.5,ea.xmax+=.5,ea.ymax+=.5,ea.hasZ&&(ea.zmin-=.5,ea.zmax+=.5),ea.hasM&&(ea.mmin-=.5,ea.mmax+=.5),ia=ea;ea=ia;ia=this._controller.crsVertex;var la=[],pa={graphics:null,featureIds:null,attributeInfo:T.attributeDataInfo,node:X};"geometryBuffer"in T&&null!==T.geometryBuffer?yield this._addNodeBinaryPointData(X,pa,T,ea,la,Y):"pointData"in T&&this._addNodeLegacyPointData(X,pa,T,ea,la);yield this._attributeOverrides.apply(pa.featureIds,
T.attributeDataInfo,Y);X.numFeatures=pa.graphics.length;this._updateNodeMemory(X);Q(pa);0<la.length&&(this.computeObb(X,la,ia),this._controller.updateVisibility(X.index));if(!this._controller.isGeometryVisible(X))return this._cacheNodeData(pa),Promise.resolve();if(this._verticalScale)for(const ua of pa.graphics)this._verticalScale(ua.geometry);this._nodesAddedToStage.set(X.index,pa);this.loadedGraphics.addMany(pa.graphics);this._filterNode(pa);this._treeDebugger&&this._treeDebugger.update();return Promise.resolve()}});
return function(X,T,Y){return U.apply(this,arguments)}}();W.computeObb=function(U,X,T){const Y=this._controller.crsIndex,ea=Y.isGeographic?this.view.renderSpatialReference:Y;u.projectBuffer(X,T,0,X,ea,0,X.length/3);U.serviceObb=L.compute({data:X,size:3});Y.isGeographic&&u.projectVectorToVector(U.serviceObb.center,ea,U.serviceObb.center,Y)};W.isNodeLoaded=function(U){return this._nodesAddedToStage.has(U)};W.isNodeReloading=function(){return!1};W.updateNodeState=function(){};W._addNodeBinaryPointData=
function(){var U=p._asyncToGenerator(function*(X,T,Y,ea,ia,la){var pa=yield this.extractBinaryPointData(Y,la);if(null==pa)return Promise.reject();Y=this._getObjectIdField();la=this._controller.crsVertex;const ua=this.view.spatialReference,wa=this.graphics3d.graphicsCore,{positionData:Fa,featureIds:La}=pa;pa=Fa.length/3;const Ma=[];for(let ta=0;ta<pa;ta++){var Sa=y.isSome(X.serviceObb)?X.serviceObb.center:[0,0,0],Ia=3*ta,va=c.fromValues(Fa[Ia+0],Fa[Ia+1],Fa[Ia+2]);d.add(va,va,Sa);X.serviceObb||ia.push(va[0],
va[1],va[2]);ea&&this.checkExtent(ea,va);Ia=La[ta];Sa={};null!=Ia&&(Sa[Y]=Ia);Ia=null==Ia?r.generateUID():Ia;u.projectBuffer(va,la,0,ba,ua,0,1);va=m.makeDehydratedPoint(ba[0],ba[1],ba[2],ua);var ma=this.loadedGraphics.get(Ia);y.isSome(ma)?(ma.level<X.level&&(Z.property="geometry",Z.graphic=ma,Z.oldValue=y.unwrap(ma.geometry),Z.newValue=va,ma.geometry=va,wa.graphicUpdateHandler(Z)),Ma.push(ma)):(ma=r.generateUID(),Ma.push({objectId:Ia,uid:ma,geometry:va,attributes:Sa,visible:!0,level:X.level}))}T.graphics=
Ma;T.featureIds=La});return function(X,T,Y,ea,ia,la){return U.apply(this,arguments)}}();W._addNodeLegacyPointData=function(U,X,T,Y,ea){const ia=this._getObjectIdField(),la=this._controller.crsVertex,pa=this.view.spatialReference,ua=[0,0,0],wa=[],Fa=[];for(const Sa of T.pointData){T=Sa.featureDataPosition;const Ia=T.length;var La=Sa.geometries&&Sa.geometries[0]||ca[Ia];const va=Sa.featureIds[0];if("points"!==La.params.type)continue;Y&&this.checkExtent(Y,T);const ma={};null!=va&&(ma[ia]=va);const ta=
null==va?r.generateUID():va;let Ea;"Embedded"===La.type&&(Ea=La.params.vertexAttributes.position);for(La=0;La<Ea.length;La+=Ia){for(var Ma=0;Ma<Ia;Ma++)ua[Ma]=T[Ma]+Ea[La+Ma];Ma=3===Ia;U.serviceObb||ea.push(ua[0],ua[1],Ma?ua[2]:0);u.projectBuffer(ua,la,0,ba,pa,0,1);Ma=m.makeDehydratedPoint(ba[0],ba[1],Ma?ba[2]:void 0,pa);const Ca=this.loadedGraphics.get(ta);y.isSome(Ca)?Fa.push(Ca):Fa.push({objectId:ta,uid:r.generateUID(),geometry:Ma,attributes:ma,visible:!0})}wa.push(va)}X.graphics=Fa;X.featureIds=
wa};W._updateNodeMemory=function(U){U.memory=4096+(y.isSome(U.numFeatures)?U.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic:0)};W._cacheNodeData=function(U){const X=U.graphics.reduce((T,Y)=>m.estimateSize(Y)+T,8*U.featureIds.length+1536);this._memCache.put(this._getMemCacheKey(U.node),U,X)};W._getMemCacheKey=function(U){return`${U.index}`};W._removeAllNodeData=function(){this._nodesAddedToStage.forEach(U=>{U&&(this._updateNodeMemory(U.node),this._cacheNodeData(U))});this._nodesAddedToStage.clear();
this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};W.removeNode=function(U){if(U=this._removeNodeStageData(U))this._updateNodeMemory(U.node),this._cacheNodeData(U)};W._removeNodeStageData=function(U){const X=this._nodesAddedToStage.get(U);if(!X)return null;this.loadedGraphics.removeMany(X.graphics);this._nodesAddedToStage.delete(U);this._treeDebugger&&this._treeDebugger.update();return X};W.loadCachedNodeData=function(){var U=p._asyncToGenerator(function*(X){return this._memCache.pop(this._getMemCacheKey(X))});
return function(X){return U.apply(this,arguments)}}();W.addCachedNodeData=function(){var U=p._asyncToGenerator(function*(X,T,Y,ea){if(this._nodesAddedToStage.has(X.index))V.error("I3S node "+X.id+" already added");else return this.loadedGraphics.addMany(T.graphics),this._nodesAddedToStage.set(X.index,T),this._updateNodeMemory(X),yield this.updateAttributes(X.index,Y,ea),this._filterNode(T),this._treeDebugger&&this._treeDebugger.update(),Promise.resolve()});return function(X,T,Y,ea){return U.apply(this,
arguments)}}();W.getLoadedNodeIds=function(){const U=[];this._nodesAddedToStage.forEach(X=>U.push(X.node.id));return U.sort()};W.getVisibleNodes=function(){const U=[];this._nodesAddedToStage.forEach(X=>U.push(X.node));return U};W.getLoadedNodeIndices=function(U){this._nodesAddedToStage.forEach((X,T)=>U.push(T))};W.getLoadedAttributes=function(U){if((U=this._nodesAddedToStage.get(U))&&y.isSome(U.attributeInfo))return U.attributeInfo.loadedAttributes};W.getAttributeData=function(U){if((U=this._nodesAddedToStage.get(U))&&
y.isSome(U.attributeInfo))return U.attributeInfo.attributeData};W.setAttributeData=function(U,X){(U=this._nodesAddedToStage.get(U))&&!y.isNone(U.attributeInfo)&&(U.attributeInfo.attributeData=X,this._attributeValuesChanged(U))};W.updateAttributes=function(){var U=p._asyncToGenerator(function*(X,T,Y){if(X=this._nodesAddedToStage.get(X))yield this._attributeOverrides.apply(X.featureIds,T,Y),X.attributeInfo=T,this._attributeValuesChanged(X)});return function(X,T,Y){return U.apply(this,arguments)}}();
W._attributeValuesChanged=function(U){Q(U);this._filterNode(U);this.graphics3d.graphicsCore.labelsEnabled&&(U=U.graphics.map(X=>X.uid),this.graphics3d.graphicsCore.updateLabelingInfo(U))};W._updateClippingExtent=function(U){this._controller&&this._controller.updateClippingArea(U);return!1};W._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};W._rendererChange=function(){var U=p._asyncToGenerator(function*(X,T){const {layer:{fieldsIndex:Y}}=this,ea=new Set;let ia;X?(yield X.collectRequiredFields(ea,
Y),ia=Array.from(ea).sort()):ia=[];ea.clear();let la;T?(yield T.collectRequiredFields(ea,Y),la=Array.from(ea).sort()):la=[];ia.length===la.length&&ia.every((pa,ua)=>ia[ua]===la[ua])||this._reloadAllNodes()});return function(X,T){return U.apply(this,arguments)}}();W._rangeInfosChanged=function(U){null!=U&&0<U.length&&V.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};W._filterChange=function(){this._nodesAddedToStage.forEach(U=>
this._filterNode(U))};W._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};W._filterNode=function(U){const X=this.parsedDefinitionExpression;for(const T of U.graphics)U=T.visible,T.visible=X?this._evaluateClause(X,T):!0,U!==T.visible&&(Z.graphic=T,Z.property="visible",Z.oldValue=U,Z.newValue=T.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(Z))};W._invalidateElevation=function(U){const X=this._controller.crsIndex;u.projectBoundingRect(U.extent,
U.spatialReference,ha,X);this._controller.updateElevationChanged(ha,X)};W.createQuery=function(){const U={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return y.isSome(this.filter)?this.filter.createQuery(U):new x(U)};W.queryFeatures=function(U,X){return this._queryEngine.executeQuery(this._ensureQuery(U),null==X?void 0:X.signal)};W.queryObjectIds=function(U,X){return this._queryEngine.executeQueryForIds(this._ensureQuery(U),null==X?void 0:X.signal)};W.queryFeatureCount=
function(U,X){return this._queryEngine.executeQueryForCount(this._ensureQuery(U),null==X?void 0:X.signal)};W.queryExtent=function(U,X){return this._queryEngine.executeQueryForExtent(this._ensureQuery(U),null==X?void 0:X.signal)};W._ensureQuery=function(U){return this._addDefinitionExpressionToQuery(y.isNone(U)?this.createQuery():x.from(U))};W.getUsedMemory=function(){const U=this.graphics3d&&this.graphics3d.graphicsCore;return U?U.usedMemory:0};W.getUnloadedMemory=function(){const U=this.graphics3d&&
this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(U?U.unprocessedMemoryEstimate:0))};W.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};W._handleEdits=function(U){E.processAttributeEdits(this.attributeEditingContext,U)};p._createClass(aa,[{key:"requiredFields",get:function(){var U,X;return null!=(U=null==(X=this.fieldsHelper)?void 0:X.requiredFields)?U:[]}},{key:"maximumNumberOfFeatures",get:function(){const U=
this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return U?U.maximumNumberOfFeatures:0},set:function(U){null!=U?(this._override("maximumNumberOfFeatures",U),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.suspended?!1:!!this._controller&&!this._controller.leavesReached}},{key:"hasM",get:function(){return!1}},
{key:"hasZ",get:function(){return!0}},{key:"symbolUpdateType",get:function(){return this.graphics3d.graphicsCore.symbolUpdateType}},{key:"updatePolicy",get:function(){return this.graphics3d.graphicsCore.effectiveUpdatePolicy}},{key:"attributeEditingContext",get:function(){const U=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:U,forEachNode:X=>this._nodesAddedToStage.forEach(T=>X(T.node,T.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo,
attributeOverrides:this._attributeOverrides,getAttributeData:X=>this.getAttributeData(X),setAttributeData:(X,T,Y)=>{this.setAttributeData(X,T);X=this._nodesAddedToStage.get(X);y.isSome(Y)?(Y=this.loadedGraphics.get(Y.attributes[U]),y.isSome(Y)&&this.graphics3d.graphicsCore.recreateGraphics([Y])):y.isSome(X)&&this.graphics3d.graphicsCore.recreateGraphics(X.graphics)},clearMemCache:()=>{}}}},{key:"performanceInfo",get:function(){const U={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,
totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.graphics3d.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(U);return U}},{key:"test",get:function(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,numFeatures:this.loadedGraphics.length}}}]);return aa}(M.DefinitionExpressionSceneLayerView(J.PopupSceneLayerView(A.LayerView3D(R))));b.__decorate([w.property()],A.prototype,"graphics3d",void 0);b.__decorate([w.property({type:S})],
A.prototype,"filter",void 0);b.__decorate([w.property()],A.prototype,"loadedGraphics",void 0);b.__decorate([w.property({aliasOf:"layer"})],A.prototype,"i3slayer",void 0);b.__decorate([w.property()],A.prototype,"_controller",void 0);b.__decorate([w.property()],A.prototype,"updating",void 0);b.__decorate([w.property()],A.prototype,"suspended",void 0);b.__decorate([w.property()],A.prototype,"holeFilling",void 0);b.__decorate([w.property(N.updatingProgress)],A.prototype,"updatingProgress",void 0);b.__decorate([w.property({aliasOf:"_controller.updatingProgress"})],
A.prototype,"updatingProgressValue",void 0);b.__decorate([w.property(q.requiredFields)],A.prototype,"requiredFields",null);b.__decorate([w.property(q.availableFields)],A.prototype,"availableFields",void 0);b.__decorate([w.property()],A.prototype,"fieldsHelper",void 0);b.__decorate([w.property({type:Number})],A.prototype,"maximumNumberOfFeatures",null);b.__decorate([w.property({readOnly:!0})],A.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([w.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],
A.prototype,"lodFactor",void 0);b.__decorate([w.property({readOnly:!0})],A.prototype,"hasM",null);b.__decorate([w.property({readOnly:!0})],A.prototype,"hasZ",null);b=A=b.__decorate([g.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],A);const ca={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},ba=c.create(),Z={graphic:null,property:null,oldValue:null,newValue:null},ha=t.create();return b})},
"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/workers/WorkerHandle"],function(a,p,b){b=function(r){function q(y){return r.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",y,{hasInitialize:!0})||this}p._inheritsLoose(q,r);q.prototype.getTransferList=function(y){return[y.geometryBuffer]};return q}(b.WorkerHandle);a.I3SPointsWorkerHandle=b;Object.defineProperty(a,"__esModule",{value:!0})})},"*noref":1}});
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/scheduling ../core/watchUtils ../core/workers/workers ../core/screenUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../geometry/HeightModelInfo ../geometry/projection ../geometry/projectionEllipsoid ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/scaleUtils ../layers/support/layerUtils ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/SpatialReference ../geometry/Point ../geometry/Extent".split(" "),
function(a,p,b,r,q,y,f,w,e,l,g,d,c,u,t,h,m,n,z,k,v,x,C,A,B,D,E,G,K,M,H,J,O,I,F,L,N,R,S,P,Q,V,ca,ba,Z,ha,fa,aa,W,U,X,T,Y,ea,ia,la,pa,ua,wa,Fa,La,Ma,Sa,Ia,va,ma,ta,Ea,Ca,ka,sa,Ja,Ta,da,qa,ra,Da,Pa,Qa,na,Aa,Ra){function Ua(Ka,Ga){Ka.layerUids||(Ka.layerUids=new Set);Ka.layerUids.add(Ga)}function Wa(Ka,Ga){Ka.graphicUids||(Ka.graphicUids=new Set);Ka.graphicUids.add(Ga)}function ab(Ka,Ga){return h.isSome(Ka)&&G.canProjectWithoutEngine(Ka.spatialReference,Ga)?G.project(Ka,Ga):null}const eb=t.getLogger("esri.views.SceneView");
q=function(Ka){function Ga(za){var Ba=Ka.call(this,za)||this;Ba._userClippingArea=null;Ba._clippingArea=null;Ba._initialDefaultSpatialReference=null;Ba._defaults={};Ba._externallySet={environment:!1};Ba._createGraphicsViewController=null;Ba._resolveWhenReady=[];Ba.propertiesPool=new wa.PropertiesPool({slicePlane:H.BoundedPlaneClass},p._assertThisInitialized(Ba));Ba._resourceController=Ma.newResourceController(p._assertThisInitialized(Ba));Ba._defaultToMapOptions={include:new Set};Ba._defaultHitTestOptions=
{exclude:new Set};Ba.deconflictor=new ha.GraphicsDeconflictor({view:p._assertThisInitialized(Ba)});Ba.labeler=new fa.Labeler({view:p._assertThisInitialized(Ba),deconflictor:Ba.deconflictor.labels});Ba.sharedSymbolResources=null;Ba.basemapTerrain=null;Ba.elevationProvider=null;Ba.camera=null;Ba.canvas=null;Ba.center=null;Ba.constraints=new V["default"];Ba.environmentManager=new ba.SceneViewEnvironmentManager;Ba.extent=null;Ba.floors=new e;Ba.windowDevicePixelRatio=1;Ba.fullOpacity=1;Ba.graphicsView=
null;Ba.groundView=null;Ba.navigating=!1;Ba.map=null;Ba.screenSizePerspectiveEnabled=!0;Ba.state=new U;Ba.scale=null;Ba.spatialReference=null;Ba.isHeightModelInfoRequired=!0;Ba.alphaCompositingEnabled=!1;Ba.supersampleScreenhotsEnabled=!0;Ba.type="3d";Ba.ui=new Pa;Ba._numUpdating=0;Ba._lastUpdateTime=0;Ba.updatingProgress=.5;Ba.viewpoint=null;Ba.zoom=null;Ba.highlightOptions=new pa;k.initialize();za&&za.environment||(Ba._defaults.environment=new ca,Ba.environment=Ba._defaults.environment);za=Va=>
{h.isSome(Va)&&4===Va.type||(Ba.updatingChanged(),Ba.map&&Ba.map.allLayers.forEach(function(){var Ya=p._asyncToGenerator(function*($a){try{yield $a.when()}catch{}Ba.updatingChanged()});return function($a){return Ya.apply(this,arguments)}}()))};Ba.handles.add([z.on(p._assertThisInitialized(Ba),"map.allLayers","after-changes",za,za,za,!0),Ba.allLayerViews.on("after-changes",Va=>Ba._updateUpdatingMonitors(Va)),Ba.watch("map",Va=>{Va&&Va.load&&Va.load().catch(()=>{})})]);Ba.inputManager=new Z({view:p._assertThisInitialized(Ba)});
Ba.stateManager=new X({view:p._assertThisInitialized(Ba),updateDevicePixelRatio:()=>{const Va=window.devicePixelRatio;Va!==Ba.windowDevicePixelRatio&&(Ba.windowDevicePixelRatio=Va,Ba.notifyChange("pixelRatio"))}});return Ba}p._inheritsLoose(Ga,Ka);var Oa=Ga.prototype;Oa.initialize=function(){this.groundView=new L({view:this});this._updateUpdatingMonitors();const za=()=>this._updateDefaultToMapOptions();this.handles.add(z.on(this,"map.allLayers","after-changes",za,za,za));this.updatingHandles.add(this.qualitySettings,
"memoryLimit",Ba=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=Ba)},2);this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",Ba=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=Ba)},2);this.updatingHandles.add(this.qualitySettings,"frameRate",Ba=>n.setFrameDuration(0<Ba?1E3/Math.ceil(Ba):0),2);this.updatingHandles.add(ea,"SCENEVIEW_LOCKING_LOG",Ba=>this.defaultsFromMap.logDebugInformation=Ba,2);this.updatingHandles.add(this,
"map.ground",za,3);this.updatingHandles.add(this,"map.ground.opacity",()=>this._updateDefaultHitTestOptions(),3);this.handles.add(this.watch("spatialReference",()=>this.notifyChange("clippingArea"),!0))};Oa.destroy=function(){this.destroyed||(this.invalidate(),h.isSome(this.activeTool)&&(this.activeTool=null),this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=h.destroyMaybe(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",
null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=h.destroyMaybe(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=h.destroyMaybe(this.groundView))};Oa.installContentCameraReset=function(za={sticky:!1}){return this.stateManager.installContentCameraReset(za)};
Oa.castEnvironment=function(za){return za?za instanceof ca?za:za instanceof Qa?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(za):ca.fromWebsceneEnvironment(za):B.ensureType(ca,za):new ca};Oa.forceAnimationTime=function(za){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=za};Oa.on=function(za,Ba,Va,Ya){return(Va=this.viewEvents.on(za,Ba,Va,Ya))?Va:Ka.prototype.on.call(this,za,Ba)};Oa.hasEventListener=function(za){return Ka.prototype.hasEventListener.call(this,
za)||this.viewEvents.hasHandler(za)};Oa.toMap=function(za,Ba){if(!this.ready)return eb.error("#toMap()","Scene view cannot be used before it is ready"),null;Ba=Ba?this.externalToInternalIntersectOptions(Ba):this._defaultToMapOptions;var Va=h.isSome(Ba.graphics)&&(h.isSome(Ba.graphics.include)||h.isSome(Ba.graphics.exclude));za=qa.isSupportedScreenPointEvent(za)?qa.createScreenPointFromSupportedEvent(this,za):za;za=v.screenPointObjectToArray(za);Ba.enableDraped=Ba.include&&!Ba.include.has(sa.TERRAIN_ID)||
Ba.exclude&&Ba.exclude.has(sa.TERRAIN_ID);const Ya=this.sceneIntersectionHelper,$a=new Ca.Intersector(this.state.viewingMode);$a.options.selectionMode=!0;$a.options.store=Va?2:0;Ya.intersectIntersectorScreen(za,$a,Ba);if(Va){for(const bb of $a.results.all)if(Va=ka.toGraphic(bb,this),h.isNone(Va)||this._testGraphicUidFilter(Ba.graphics,Va))return this._intersectResultToMapPoint(bb);return null}return this._intersectResultToMapPoint($a.results.min)};Oa.toScreen=function(za){if(!this.ready)return eb.error("#toScreen()",
"Scene view cannot be used before it is ready"),null;const Ba=h.unwrapOr(null==za.z&&la.getElevationAtPoint(this.elevationProvider,za),0);G.projectPointToVector(za,db,this.renderSpatialReference,Ba);this.state.camera.projectToScreen(db,lb);return v.createScreenPoint(lb[0],lb[1])};Oa.pixelSizeAt=function(za){if(!this.ready)return eb.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!za)return 0;G.projectPointToVector(za,db,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(db)};
Oa.overlayPixelSizeInMapUnits=function(za){const Ba=this.basemapTerrain.overlayManager;return Ba?Ba.overlayPixelSizeInMapUnits(za):1};Oa.hitTest=function(za,Ba){if(!this.ready)return eb.error("#hitTest()","Scene view cannot be used before it is ready"),null;za=qa.isSupportedScreenPointEvent(za)?qa.createScreenPointFromSupportedEvent(this,za):za;var Va=v.createScreenPointArray(za.x,za.y),Ya=Ba?this.externalToInternalIntersectOptions(Ba):this._defaultHitTestOptions;Ya.requiresGroundFeedback=!0;Ya.enableDraped=
!0;Ba=new Ca.Intersector(this.state.viewingMode);Ba.options.selectionMode=!0;Ba.options.store=2;this.sceneIntersectionHelper.intersectIntersectorScreen(Va,Ba,Ya);Va=this._intersectResultsToHits(Ba.results.all,Ya.graphics);Ya=Ba.results.ground;var $a=ka.toOwner(Ya,this);$a=h.isSome($a)&&"type"in $a&&"integrated-mesh"===$a.type?$a:null;za={screenPoint:za,results:Va,ground:{mapPoint:this._intersectResultToMapPoint(Ya),distance:Ya.hasIntersectionPoint?Ya.distanceInRenderSpace:0,layer:$a}};ea.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&
(za.intersector=Ba);return Promise.resolve(za)};Oa.popupHitTest=function(za){return Ja.hitTestSelectSameDistance(this,za).then(({results:Ba,ground:Va})=>{let Ya=null;!(0===Ba.length||1E-5>Math.abs(Ba[0].distance-Va.distance))||Va.layer&&"integrated-mesh"===Va.layer.type||(Ya=Va.mapPoint);return{results:Ba,screenPoint:za,mapPoint:Ya}})};Oa.goTo=function(za,Ba){return this.updatingHandles.addPromise(this.stateManager.goTo(za,Ba))};Oa.whenLayerView=function(za){return Ka.prototype.whenLayerView.call(this,
za)};Oa.takeScreenshot=function(za){return this.whenReady().then(()=>{const Ba=da.toRenderSettings(za,this);Ba.pixelRatio/=this.pixelRatio;return this._stage.renderView.takeScreenshot(da.screenshotSuperSampleSettings(Ba,this.supersampleScreenhotsEnabled,this.padding))})};Oa.addUpdatingPromise=function(za){return this.updatingHandles.addPromise(za)};Oa.importLayerView=function(za){return Q.layerView3DImporter.importLayerView(za)};Oa.hasLayerViewModule=function(za){return Q.layerView3DImporter.hasLayerViewModule(za)};
Oa.forceDOMReadyCycle=function(){this.forceReadyCycle()};Oa.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};Oa.validate=function(){var za=p._asyncToGenerator(function*(){let Ba=Da.check();u("safari")&&9>u("safari")&&(Ba=new g("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",
{type:"safari",requiredVersion:9,detectedVersion:u("safari")}));if(h.isSome(Ba))throw eb.warn("#validate()",Ba.message),Ba;});return function(){return za.apply(this,arguments)}}();Oa.isSpatialReferenceSupported=function(za,Ba,Va){var Ya=za.isGeographic;const $a=za.isWebMercator,bb=ra.isSpatialReferenceSupported(za,"global"),cb="local"===this.viewingMode,kb=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(kb){if(cb&&Ya&&!ra.isSpatialReferenceSupported(za,
"local"))return Va?Va(`Layer ${Ba.id} is ignored because its spatial reference is not supported in local viewing mode`):eb.warnOnce("Spatial reference defined on view not supported in local viewing mode."),!1;if(!cb&&!bb)return Va?Va(`Layer ${Ba.id} is ignored because its spatial reference is not supported in global viewing mode`):eb.warnOnce("Spatial reference defined on view not supported in global viewing mode."),!1}else if(Ya&&!bb)return Va?Va(`Layer ${Ba.id} is ignored because its spatial reference is geographic but unsupported`):
eb.warnOnce("Spatial reference is geographic but not supported."),!1;if(Ba)if(O.isTiledLayer(Ba)){if(kb?za=null!=ta.getTiledLayerInfo(Ba,za,P.viewingModeFromString(this.viewingMode)).tileInfo:(Ya=ta.getTiledLayerInfo(Ba,za,1),null==Ya.tileInfo&&(Ya=ta.getTiledLayerInfo(Ba,za,2),null!=Ya.tileInfo&&$a&&!this.ready&&(this.viewingMode="local")),za=null!=Ya.tileInfo),!za)return Va&&Va(`Layer ${Ba.id} is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode`),
!1}else if((za.isWGS84||$a)&&!cb)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=za),kb||this.ready||(this.viewingMode="global",Va&&Va(`Viewing mode locked to global due to reprojectable layer ${Ba.id}`)),Va&&Va(`Layer ${Ba.id} is ignored because it supports server-side reprojection`),!1;return!0};Oa.whenReady=function(){return new Promise(za=>{this.ready?za(this):this._resolveWhenReady.push(za)})};Oa.computeMapPointFromVec3d=function(za,Ba){let Va=this.spatialReference||
na.WGS84;G.projectVectorToVector(za,this.renderSpatialReference,za,Va)||(Va=na.WGS84,G.projectVectorToVector(za,this.renderSpatialReference,za,Va));Ba?(Ba.x=za[0],Ba.y=za[1],Ba.z=za[2],Ba.spatialReference=Va):Ba=new Aa(za,Va);return Ba};Oa.trackGraphicState=function(za){if(!za.graphic)return eb.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const Ba=this.getViewForGraphic(za.graphic);let Va=null,Ya=!1;const $a=bb=>{!Ya&&h.isSome(bb)&&"graphics3d"in
bb&&bb.graphics3d&&bb.graphics3d.graphicsCore&&(Va=bb.graphics3d.graphicsCore.trackGraphicState(za))};h.isSome(Ba)?$a(Ba):this.whenViewForGraphic(za.graphic,{waitForLayer:!0}).then(bb=>$a(bb),()=>{}).catch(()=>{});return{remove:()=>{Ya=!0;h.isSome(Va)&&(Va.remove(),Va=null)}}};Oa.highlight=function(za){if(Array.isArray(za))return c.handlesGroup(za.map(Va=>this.highlight(Va)));if(e.isCollection(za))return c.handlesGroup(za.toArray().map(Va=>this.highlight(Va)));const Ba=this.getViewForGraphic(za);
return Ba&&"highlight"in Ba?Ba.highlight(za):c.makeHandle()};Oa.maskOccludee=function(za){if(!za)return eb.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Ba=this.getViewForGraphic(za);let Va=null,Ya=!1;const $a=bb=>{!Ya&&h.isSome(bb)&&"graphics3d"in bb&&Ta.occludeesSupported(bb)&&(Va=bb.maskOccludee(za))};h.isSome(Ba)?$a(Ba):this.whenViewForGraphic(za,{waitForLayer:!0}).then(bb=>$a(bb),()=>{}).catch(()=>{});return{remove:()=>{Ya=!0;h.isSome(Va)&&
(Va.remove(),Va=null)}}};Oa.getViewForGraphic=function(za){return za.layer===this.graphics?this.graphicsView:za.layer?this.allLayerViews.find(Ba=>Ba.layer===za.layer):null};Oa.graphicChanged=function(za){h.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(za)};Oa.whenViewForGraphic=function(){var za=p._asyncToGenerator(function*(Ba,Va){if(Ba.layer===this)return yield z.whenOnce(this,"graphicsView"),this.graphicsView;if(!Ba.layer||!this.map)throw new g("no-view-for-graphic");return Va&&Va.waitForLayer&&
!this.map.allLayers.includes(Ba.layer)?new Promise((Ya,$a)=>{const bb=this.map.allLayers.on("change",cb=>{-1!==cb.added.indexOf(Ba.layer)&&(bb.remove(),this.whenLayerView(Ba.layer).then(Ya,$a))})}):this.whenLayerView(Ba.layer)});return function(Ba,Va){return za.apply(this,arguments)}}();Oa.externalToInternalIntersectOptions=function(za){const Ba=this._externalToInternalRenderItems(za.include,0);za=this._externalToInternalRenderItems(za.exclude,1);return{include:Ba.layerUids,exclude:za.layerUids,graphics:{include:Ba.graphicUids,
exclude:za.graphicUids}}};Oa._intersectResultToMapPoint=function(za,Ba){return za.getIntersectionPoint(db)?(Ba=this.computeMapPointFromVec3d(db,Ba),"TerrainRenderer"===za.intersector&&this.basemapTerrain&&(Ba.z=h.unwrapOr(la.getElevationAtPoint(this.basemapTerrain,Ba),0)),Ba):null};Oa._intersectResultsToHits=function(za,Ba){const Va=[];let Ya=null;for(let cb=0;cb<za.length;cb++){const kb=za[cb];var $a=ka.toOwner(kb,this);if(h.isSome($a)&&($a===this.map.ground||"type"in $a&&"integrated-mesh"===$a.type))break;
$a=ka.toGraphic(kb,this);if(h.isSome($a)){h.isNone(Ya)&&cb!==za.length-1&&(Ya=new Set);if(h.isSome(Ya)){var bb=this._getGraphicFilterUid($a);if(Ya.has(bb))continue;Ya.add(bb)}this._testGraphicUidFilter(Ba,$a)&&(bb=this._intersectResultToMapPoint(kb),Va.push({graphic:$a,mapPoint:bb,distance:kb.distanceInRenderSpace}))}}return Va};Oa._getGraphicFilterUid=function(za){if(za.layer&&"objectIdField"in za.layer){const Ba=za.attributes[za.layer.objectIdField];if(Ba)return`o-${za.layer.id}-${Ba}`}return`u-${za.uid}`};
Oa._testGraphicUidFilter=function(za,Ba){Ba=this._getGraphicFilterUid(Ba);return h.isNone(za)||(h.isNone(za.include)||za.include.has(Ba))&&(h.isNone(za.exclude)||!za.exclude.has(Ba))};Oa._externalToInternalRenderItems=function(za,Ba,Va={layerUids:null,graphicUids:null}){if(!za)return Va;za instanceof y?(Wa(Va,this._getGraphicFilterUid(za)),0===Ba&&(h.isSome(this.graphicsView)&&za.layer===this?Ua(Va,this.graphicsView.graphics3d.layer.id):za.layer&&Ua(Va,za.layer.uid))):"forEach"in za?za.forEach(Ya=>
{Array.isArray(Ya)?this._externalToInternalRenderItems(Ya,Ba,Va):e.isCollection(Ya)?Ya===this.graphics&&h.isSome(this.graphicsView)?Ua(Va,this.graphicsView.graphics3d.layer.id):this._externalToInternalRenderItems(Ya,Ba,Va):Ya instanceof f?Ya===this.map.ground&&Ua(Va,sa.TERRAIN_ID):this._externalToInternalRenderItems(Ya,Ba,Va)}):Ua(Va,za.uid);return Va};Oa._initBasemapTerrain=function(){this._set("basemapTerrain",new ma({view:this}));this._set("elevationProvider",new Y.CombinedElevationProvider({view:this}));
this.elevationProvider.register("ground",this.basemapTerrain)};Oa._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};Oa._initGlobe=function(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new va["default"]({view:this}));this._set("featureTiles",
new W["default"]({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const za=()=>{var Ba=this.basemapTerrain&&this.basemapTerrain.extent;this.clippingArea||Ba?Ba&&this.basemapTerrain.spatialReference?(Ba=h.isSome(this.basemapTerrain.extent)?G.project(M.toExtent(this.basemapTerrain.extent,
this.basemapTerrain.spatialReference),this.spatialReference):null,h.isSome(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(Ba):this.featureTiles.filterExtent=Ba):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(ea,"FEATURE_TILE_TREE_SHOW_TILES",Ba=>{Ba&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(new Promise(function(Va,Ya){a(["./3d/layers/support/FeatureTileTree3DDebugger"],
Va,Ya)})).then(({FeatureTileTree3DDebugger:Va})=>{!this.featureTreeDebugger&&ea.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new Va({view:this}))}):Ba||!this.featureTreeDebugger||ea.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},3),this.updatingHandles.add(this,"clippingArea",za,3),this.updatingHandles.add(this,"basemapTerrain.extent",za,3)],"feature-tiles");this.stateManager.init()};Oa._exitGlobe=function(){this.state&&(this.stateManager.deinit(),
this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};Oa._initCoordinateSystem=function(){if(this.spatialReference){var za=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(za)||this._set("mapCoordsHelper",new ua.MapCoordsHelper(this.map,
za));const Ba=this.state.isGlobal;za=Ba?K.getSphericalPCPF(za):za.isGeographic?na.PlateCarree:za;za!==this.renderSpatialReference&&(this._set("renderCoordsHelper",La.RenderCoordsHelper.create(this.state.viewingMode,za)),Ba||this.handles.add(this.watch("basemapTerrain.extent",Va=>{const Ya=this.renderCoordsHelper.spatialReference;0===Va[0]&&0===Va[1]&&0===Va[2]&&0===Va[3]||!G.projectBoundingRect(Va,this.basemapTerrain.spatialReference,Ha,Ya)||(this.renderCoordsHelper.extent=Ha)},!0),"render-coords-helper"),
this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Ca.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};Oa._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};Oa.updatingChanged=function(){this.notifyChange("updating")};Oa._updateUpdatingMonitors=function(za=null){h.isSome(za)&&
4===za.type||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(Ba=>{Ba.destroyed||(this.handles.add([Ba.watch(["updating","updatingProgress"],()=>this.updatingChanged(),!0)],"updatingMonitors"),Ba.when(()=>this.updatingChanged(),()=>this.updatingChanged()))}),this.updatingChanged())};Oa._renderScreenshotOverlay=function(za,Ba){if(!this.overlay||!this.overlay.hasVisibleItems)return Ba;const Va=za.getContext("2d");Va.putImageData(Ba,0,0);this.overlay.renderCanvas(za);return Va.getImageData(0,
0,Ba.width,Ba.height)};Oa._initStage=function(){var za={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(cb,kb)=>this._renderScreenshotOverlay(cb,kb)}};const Ba=new T.SceneIntersectionHelper(this.state.viewingMode,{forEachLayer:cb=>this._stage.layers.forAll(cb)},this);this._set("sceneIntersectionHelper",Ba);const Va=l.byId(this.surface),{resourceController:Ya,
state:$a,renderSpatialReference:bb}=this;this._stage=new Ea.Stage({resourceController:Ya,container:Va,options:za,state:$a,sceneIntersectionHelper:Ba,renderSR:bb});this._lostWebGLContextHandle=d.on(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new g("webgl-context-lost"));this.handles.add([this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",()=>{this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})},2),this.updatingHandles.add(this.qualitySettings,
"highQualityTransparency",()=>{this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency})},2),z.init(this,"magnifier",cb=>this._stage.renderView.magnifier=cb,!0)],"stage");za=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:pa.toEngineOptions(this.highlightOptions)})};for(const cb of"highlightOptions highlightOptions.color highlightOptions.haloColor highlightOptions.haloOpacity highlightOptions.fillOpacity highlightOptions.shadowOpacity highlightOptions.shadowColor highlightOptions.shadowDifference".split(" "))this.handles.add(this.updatingHandles.add(this,
cb,za),"stage");za();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Ca.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};Oa._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};Oa._initSurface=function(za){this._exitSurface();this.state.init(za,
this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new Ia.SharedSymbolResources({view:this,viewingMode:za,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new aa.ObjectResourceCache})};Oa._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};
Oa._createGraphicsViewIfNeeded=function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=m.createAbortController();var za=()=>{this._createGraphicsViewController=null;this.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(za,za);this.updatingChanged()}};Oa._createGraphicsViewAsync=function(){var za=p._asyncToGenerator(function*(Ba){const Va=
(yield new Promise(function(Ya,$a){a(["./3d/layers/GraphicsView3D"],function(bb){Ya(Object.freeze({__proto__:null,default:bb}))},$a)})).default;m.throwIfAborted(Ba);yield z.whenTrueOnce(this.basemapTerrain,"ready",Ba);this._set("graphicsView",new Va({view:this}))});return function(Ba){return za.apply(this,arguments)}}();Oa._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");
h.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.graphics3d.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))};Oa._startup=function(){var za=P.viewingModeFromString(this.viewingMode);1===za&&(this._clippingArea=null);this._set("ready",!0);this._initSurface(za);this.handles.add(z.on(this,"graphics","after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(za=this.get("map.initialViewProperties.environment"))&&
(this.environment=za);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();za=this._resolveWhenReady;this._resolveWhenReady=[];za.forEach(Ba=>Ba(this))};Oa._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};Oa._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();
if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(sa.TERRAIN_ID);for(const za of this.map.allLayers.items)"integrated-mesh"===za.type&&this._defaultToMapOptions.include.add(za.uid)}};Oa._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(sa.TERRAIN_ID);for(const za of this.map.allLayers.items)"integrated-mesh"===za.type&&1>za.opacity&&this._defaultToMapOptions.exclude.add(za.uid)}};
p._createClass(Ga,[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},{key:"basemapSpatialReference",get:function(){return this.basemapTerrain&&this.basemapTerrain.spatialReference}},{key:"clippingArea",get:function(){if("global"===this.viewingMode)return null;let za=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||h.isNone(za))return this._clippingArea=null;if(!(za instanceof
Ra))return eb.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(za=ab(za,this.spatialReference),h.isNone(za)))return eb.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;za=za.clone();h.isNone(za.intersection(this.groundAndLayersExtent))&&(za.xmin=za.xmax,za.ymin=za.ymax);za.zmin=void 0;za.zmax=void 0;za.equals(this._clippingArea)||(this._clippingArea=za);return this._clippingArea},
set:function(za){this.ready&&"global"===this.viewingMode&&h.isSome(za)?eb.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=za}},{key:"renderDataExtent",get:function(){if(1===this.state.viewingMode)return null;const za=this.renderSpatialReference,Ba=this.dataExtent;return h.isNone(Ba)||h.isNone(za)||Ba.spatialReference.equals(za)?Ba:ab(Ba,za)}},{key:"dataExtent",get:function(){let za=this.groundAndLayersExtent;var Ba=ab(this.clippingArea,this.spatialReference||
na.WGS84);h.isSome(Ba)&&(za=h.isSome(za)?za.intersection(Ba):Ba);Ba=this._get("dataExtent");return h.isSome(za)&&za.equals(Ba)?Ba:za}},{key:"groundAndLayersExtent",get:function(){const za=this.spatialReference||na.WGS84;let Ba;const Va=$a=>{$a=ab($a,za);h.isNone($a)||(h.isSome(Ba)?Ba.union($a):Ba=$a.clone())};var Ya=this.basemapTerrain;if(null!=Ya&&Ya.spatialReference){const $a=Ya.groundExtent;Va(new Ra({xmin:$a[0],ymin:$a[1],zmin:0,xmax:$a[2],ymax:$a[3],zmax:0,spatialReference:Ya.spatialReference}))}this.map&&
this.map.allLayers.forEach($a=>{!$a.fullExtent||"graphics"===$a.type&&$a.internal||Va($a.fullExtent)});if(h.isNone(Ba))return null;Ba.hasZ?(Ba.zmin=Math.min(0,Ba.zmin),Ba.zmax=Math.max(0,Ba.zmax)):(Ba.zmin=0,Ba.zmax=0);Ya=this._get("groundAndLayersExtent");return Ba.equals(Ya)?Ya:Ba}},{key:"environment",set:function(za){za!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",za)}},{key:"pixelRatio",get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},
set:function(za){h.isSome(za)?this._override("pixelRatio",za):this._clearOverride("pixelRatio")}},{key:"maximumPixelRatio",get:function(){let za=Infinity;const {maximumPixelRatio:Ba,maximumRenderResolution:Va}=this.qualitySettings;null!=Ba&&(za=Math.min(za,Ba));null!=Va&&(za=Math.min(za,Va/Math.max(this.width,this.height)));return za},set:function(za){h.isSome(za)?this._override("maximumPixelRatio",za):this._clearOverride("maximumPixelRatio")}},{key:"initialExtentRequired",get:function(){return this.stateManager&&
!this.stateManager.hasInitialView}},{key:"interacting",get:function(){return this.navigating||h.isSome(this.activeTool)}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(h.isNone(this.state)||this.state.stationary)}},{key:"qualityProfile",get:function(){return this._get("qualityProfile")||ia.getDefaultProfile()},set:function(za){ia.isValidProfile(za)&&(ia.apply(za,this.qualitySettings),this._set("qualityProfile",za))}},{key:"slicePlane",set:function(za){this._stage.renderView.setRenderParameters({slicePlane:za});
if(h.isNone(za))this._set("slicePlane",null);else{var Ba=this.propertiesPool.get("slicePlane");H.copy(za,Ba);this._set("slicePlane",Ba)}}},{key:"resolution",get:function(){return null!=this.spatialReference?J.getResolutionForScale(this.scale,this.spatialReference):0}},{key:"heightModelInfo",get:function(){const za=this.getDefaultHeightModelInfo();return null!=za?E.deriveUnitFromSR(za,this.spatialReference):null}},{key:"updating",get:function(){var za,Ba,Va;let Ya=0,$a=this.layerViewManager.updating,
bb=$a?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(cb=>{cb.isFulfilled()?cb.updating&&($a=!0,cb.suspended||ta.isSurfaceLayerView(cb)||(++bb,Ya+=cb.updatingProgress)):++bb});for(const cb of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager])h.isSome(cb)&&cb.updating&&(bb+=.1,Ya+=.05);for(const cb of[this.deconflictor,this.labeler,this.basemapTerrain])h.isSome(cb)&&
cb.updating&&(++bb,Ya+=cb.updatingProgress);($a=!!($a||0<bb||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||null!=(za=this.inputManager)&&za.hasPendingInputs||null!=(Ba=this.map)&&null!=(Va=Ba.allLayers)&&Va.some(cb=>!cb.isFulfilled())))?(this._numUpdating=Math.max(bb,this._numUpdating),Ya+=this._numUpdating-bb):this._numUpdating=0;Ya=0<this._numUpdating?Ya/this._numUpdating:$a?0:1;this._get("updatingProgress")!==Ya&&(za=this._resourceController.scheduler.now,
1>Ya&&(Ba=Math.min((za-this._lastUpdateTime)/2E3,1),Ya=this.updatingProgress*(1-Ba)+Ya*Ba),this._set("updatingProgress",Ya),this._lastUpdateTime=$a&&1>Ya?za:0);return $a}},{key:"viewingMode",get:function(){var za=this.get("map.initialViewProperties.viewingMode");if(za)return za;za=this.spatialReference;return!za||ra.isSpatialReferenceSupported(za,"global")?"global":"local"},set:function(za){this.ready?eb.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(za)?
this._override("viewingMode",za):void 0===za&&this._clearOverride("viewingMode")}},{key:"resourceController",get:function(){return this._resourceController}},{key:"performanceInfo",get:function(){return new Sa(this)}}]);return Ga}(I.BreakpointsOwner(F.DOMContainer(N.PopupView(R))));b.__decorate([x.property()],q.prototype,"_userClippingArea",void 0);b.__decorate([x.property()],q.prototype,"_resourceController",void 0);b.__decorate([x.property()],q.prototype,"_stage",void 0);b.__decorate([x.property({readOnly:!0})],
q.prototype,"deconflictor",void 0);b.__decorate([x.property({readOnly:!0})],q.prototype,"labeler",void 0);b.__decorate([x.property({type:S,readOnly:!0,aliasOf:"state.animation"})],q.prototype,"animation",void 0);b.__decorate([x.property({readOnly:!0})],q.prototype,"basemapTerrain",void 0);b.__decorate([x.property({readOnly:!0})],q.prototype,"elevationProvider",void 0);b.__decorate([x.property({type:r,aliasOf:"stateManager.camera"})],q.prototype,"camera",void 0);b.__decorate([x.property({type:r,aliasOf:"stateManager.contentCamera"})],
q.prototype,"contentCamera",void 0);b.__decorate([x.property({readOnly:!0})],q.prototype,"canvas",void 0);b.__decorate([x.property({type:Aa,aliasOf:"stateManager.center"})],q.prototype,"center",void 0);b.__decorate([x.property({type:Ra})],q.prototype,"clippingArea",null);b.__decorate([x.property({type:V["default"]})],q.prototype,"constraints",void 0);b.__decorate([x.property({type:Ra,readOnly:!0})],q.prototype,"renderDataExtent",null);b.__decorate([x.property({type:Ra,readOnly:!0})],q.prototype,"dataExtent",
null);b.__decorate([x.property({type:Ra,readOnly:!0})],q.prototype,"groundAndLayersExtent",null);b.__decorate([x.property({value:null,type:ca})],q.prototype,"environment",null);b.__decorate([C.cast("environment")],q.prototype,"castEnvironment",null);b.__decorate([x.property({readOnly:!0})],q.prototype,"environmentManager",void 0);b.__decorate([x.property({type:Ra,aliasOf:"stateManager.extent"})],q.prototype,"extent",void 0);b.__decorate([x.property()],q.prototype,"floors",void 0);b.__decorate([x.property({readOnly:!0,
aliasOf:"stateManager.screenCenter"})],q.prototype,"screenCenter",void 0);b.__decorate([x.property({type:Number})],q.prototype,"pixelRatio",null);b.__decorate([x.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],q.prototype,"maximumPixelRatio",null);b.__decorate([x.property({aliasOf:"stateManager.frustum"})],q.prototype,"frustum",void 0);b.__decorate([x.property({type:Number,readOnly:!0})],q.prototype,"fullOpacity",void 0);b.__decorate([x.property({readOnly:!0})],
q.prototype,"graphicsView",void 0);b.__decorate([x.property()],q.prototype,"groundView",void 0);b.__decorate([x.property({type:Boolean})],q.prototype,"initialExtentRequired",null);b.__decorate([x.property({type:Boolean,readOnly:!0})],q.prototype,"interacting",null);b.__decorate([x.property()],q.prototype,"stationary",null);b.__decorate([x.property({aliasOf:"state.navigating"})],q.prototype,"navigating",void 0);b.__decorate([x.property()],q.prototype,"map",void 0);b.__decorate([x.property({readOnly:!0})],
q.prototype,"mapCoordsHelper",void 0);b.__decorate([x.property({aliasOf:"stateManager.padding"})],q.prototype,"padding",void 0);b.__decorate([x.property({type:va["default"],readOnly:!0})],q.prototype,"pointsOfInterest",void 0);b.__decorate([x.property({type:W["default"],readOnly:!0})],q.prototype,"featureTiles",void 0);b.__decorate([x.property()],q.prototype,"featureTreeDebugger",void 0);b.__decorate([x.property({type:Boolean})],q.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([x.property({constructOnly:!0})],
q.prototype,"deactivatedWebGLExtensions",void 0);b.__decorate([x.property({constructOnly:!0})],q.prototype,"debugWebGLExtensions",void 0);b.__decorate([x.property({constructOnly:!0})],q.prototype,"renderCanvas",void 0);b.__decorate([x.property({constructOnly:!0})],q.prototype,"state",void 0);b.__decorate([x.property({readOnly:!0})],q.prototype,"inputManager",void 0);b.__decorate([x.property({readOnly:!0})],q.prototype,"stateManager",void 0);b.__decorate([x.property({type:["low","medium","high"]})],
q.prototype,"qualityProfile",null);b.__decorate([x.property({type:Fa,get(){let Ka=this._get("qualitySettings");Ka||(Ka=new Fa,ia.apply(this.qualityProfile,Ka));return Ka}})],q.prototype,"qualitySettings",void 0);b.__decorate([x.property()],q.prototype,"slicePlane",null);b.__decorate([x.property({dependsOn:["viewingMode"]})],q.prototype,"preconditionsReady",void 0);b.__decorate([x.property({readOnly:!0})],q.prototype,"renderCoordsHelper",void 0);b.__decorate([x.property({readOnly:!0})],q.prototype,
"sceneIntersectionHelper",void 0);b.__decorate([x.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],q.prototype,"resolution",null);b.__decorate([x.property({type:Number,aliasOf:"stateManager.scale"})],q.prototype,"scale",void 0);b.__decorate([x.property({dependsOn:[]})],q.prototype,"heightModelInfo",null);b.__decorate([x.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],q.prototype,"spatialReference",void 0);b.__decorate([x.property({type:Boolean,
constructOnly:!0})],q.prototype,"alphaCompositingEnabled",void 0);b.__decorate([x.property({type:Boolean})],q.prototype,"supersampleScreenhotsEnabled",void 0);b.__decorate([x.property({readOnly:!0})],q.prototype,"type",void 0);b.__decorate([x.property({type:Pa})],q.prototype,"ui",void 0);b.__decorate([x.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs toolViewManager.updating".split(" ")})],
q.prototype,"updating",null);b.__decorate([x.property({type:Number,readOnly:!0,dependsOn:["updating"]})],q.prototype,"updatingProgress",void 0);b.__decorate([x.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],q.prototype,"viewingMode",null);b.__decorate([x.property({type:w,aliasOf:"stateManager.viewpoint"})],q.prototype,"viewpoint",void 0);b.__decorate([x.property({type:Number,aliasOf:"stateManager.zoom"})],q.prototype,"zoom",void 0);b.__decorate([x.property({type:pa})],
q.prototype,"highlightOptions",void 0);q=b.__decorate([A.subclass("esri.views.SceneView")],q);const db=D.create(),lb=v.createScreenPointArray(),Ha=M.create();return q});