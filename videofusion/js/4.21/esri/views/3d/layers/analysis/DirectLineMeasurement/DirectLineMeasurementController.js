// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/Handles ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/Quantity ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/accessorSupport/trackingUtils ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/geometryEngine ../../../../../geometry/Polyline ../../../../../geometry/projection ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/geodesicUtils ../support/UnitNormalizer ../../../support/ElevationProvider".split(" "),
function(f,A,n,E,F,l,p,q,G,v,N,O,P,H,y,B,r,I,J,k,w,z,K,L){f.DirectLineMeasurementController=function(C){function x(a){a=C.call(this,a)||this;a._unitNormalizer=new K.UnitNormalizer;a._handles=new F;a._tempStartPosition=r.create();a._tempEndPosition=r.create();a._tempCornerPosition=r.create();return a}A._inheritsLoose(x,C);var g=x.prototype;g.initialize=function(){this._handles.add(G.whenOnce(this.view,"ready",()=>this._initialize(),!0))};g.destroy=function(){this._handles=p.destroyMaybe(this._handles)};
g._initialize=function(){const a=this.view.spatialReference;var b=w.getSphericalPCPF(a);this._sphericalPCPF=b=b===w.SphericalECEFSpatialReference?w.WGS84ECEFSpatialReference:b;const e=k.canProjectWithoutEngine(a,b);this._unitNormalizer.spatialReference=e?b:a;this._handles.add([y.reactionInit(()=>({viewData:this.viewData,startPoint:this.layer.startPoint}),({viewData:d,startPoint:c})=>{d.elevationAlignedStartPoint=this._applyElevationAlignment(c)}),y.reactionInit(()=>({viewData:this.viewData,endPoint:this.layer.endPoint}),
({viewData:d,endPoint:c})=>{d.elevationAlignedEndPoint=this._applyElevationAlignment(c)}),y.reactionInit(()=>({result:this._computedResult,viewData:this.viewData}),({result:d,viewData:c})=>{c.result=d})])};g._applyElevationAlignment=function(a){if(p.isNone(a)||a.hasZ)return a;a=a.clone();a.z=p.unwrapOr(L.getElevationAtPoint(this.view.elevationProvider,a),0);return a};g._euclideanDistances=function(a,b){var e=a.clone();e.z=b.z;const d=this._tempStartPosition;var c=this._tempEndPosition,m=this._tempCornerPosition,
h=this.view.spatialReference;const D=this._sphericalPCPF;h=k.canProjectWithoutEngine(h,D)?D:h;k.projectPointToVector(a,d,h);k.projectPointToVector(b,c,h);k.projectPointToVector(e,m,h);e=B.distance(d,c);c=B.distance(m,c);a=Math.abs(b.z-a.z);b=M=>this._unitNormalizer.normalizeDistance(M);m=b(e);c=b(c);a=b(a);return{direct:new q(m,"meters"),horizontal:new q(c,"meters"),vertical:new q(a,"meters")}};g._exactGeodesicDistanceAndAngle=function(a,b,e){const d=a.spatialReference;var c=new J({spatialReference:d});
c.addPath([a,b]);c=d.isGeographic&&z.isSupported(d)?z.geodesicLengths([c],"meters")[0]:d.isWebMercator?I.geodesicLength(c,"meters"):void 0;const {distance:m,angle:h}=c?{distance:c,angle:this._fallbackGeodesicAngle(c,d)}:this._fallbackGeodesicDistance(a,b,e);return{distance:new q(m,"meters"),angle:new q(h,"degrees")}};g._fallbackGeodesicAngle=function(a,b){return a/w.getReferenceEllipsoid(b).metersPerDegree};g._fallbackGeodesicDistance=function(a,b,e){if(k.projectPointToWGS84ComparableLonLat(a,t)){k.projectPointToWGS84ComparableLonLat(b,
u);a=l.deg2rad(t[0]);b=l.deg2rad(t[1]);e=l.deg2rad(u[0]);const d=l.deg2rad(u[1]);a=l.acosClamped(Math.sin(b)*Math.sin(d)+Math.cos(b)*Math.cos(d)*Math.cos(Math.abs(e-a)));a=l.rad2deg(a);b={distance:0};z.inverseGeodeticSolver(b,[t[0],t[1]],[u[0],u[1]]);return{distance:b.distance,angle:a}}return{distance:e,angle:this._fallbackGeodesicAngle(e,a.spatialReference)}};A._createClass(x,[{key:"_computedResult",get:function(){const {elevationAlignedStartPoint:a,elevationAlignedEndPoint:b}=this.viewData;if(p.isNone(a)||
p.isNone(b))return null;const e=this._euclideanDistances(a,b),d=this._exactGeodesicDistanceAndAngle(a,b,e.horizontal.value);return{directDistance:e.direct,horizontalDistance:e.horizontal,verticalDistance:e.vertical,geodesicDistance:d.distance,geodesicAngle:d.angle}}}]);return x}(E);n.__decorate([v.property()],f.DirectLineMeasurementController.prototype,"view",void 0);n.__decorate([v.property()],f.DirectLineMeasurementController.prototype,"layer",void 0);n.__decorate([v.property()],f.DirectLineMeasurementController.prototype,
"viewData",void 0);n.__decorate([v.property()],f.DirectLineMeasurementController.prototype,"_computedResult",null);f.DirectLineMeasurementController=n.__decorate([H.subclass("esri.views.3d.layers.analysis.DirectLineMeasurement/DirectLineMeasurementController")],f.DirectLineMeasurementController);const t=r.create(),u=r.create();Object.defineProperty(f,"__esModule",{value:!0})});