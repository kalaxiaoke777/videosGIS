// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../Color ../../../../../core/Accessor ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/accessorSupport/trackingUtils ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../interactive/visualElements/LineVisualElement".split(" "),
function(g,G,t,d,I,J,A,e,u,v,S,T,U,K,B,L,C,h,D){g.LineOfSightView=function(H){function z(a){a=H.call(this,a)||this;a._handle=null;a._analysisHandles=new J;return a}G._inheritsLoose(z,H);var k=z.prototype;k.initialize=function(){this._handle=this._connectAnalyses()};k.destroy=function(){this._handle=u.removeMaybe(this._handle);this._analysisHandles=u.destroyMaybe(this._analysisHandles)};k.createLineOfSightVisualization=function(){var a=this._configuration,b=this._opacity,c={view:this.view,attached:!0,
width:a.outerWidth,innerWidth:a.innerWidth};const f=d.toUnitRGBA(a.visibleOuterColor);e.applyOpacity(f,f,b);const n=d.toUnitRGBA(a.visibleInnerColor);e.applyOpacity(n,n,b);var l=d.toUnitRGBA(a.occludedOuterColor);e.applyOpacity(l,l,b);const m=d.toUnitRGBA(a.occludedInnerColor);e.applyOpacity(m,m,b);const p=d.toUnitRGBA(a.undefinedOuterColor);e.applyOpacity(p,p,b);a=d.toUnitRGBA(a.undefinedInnerColor);e.applyOpacity(a,a,b);b=new D.LineVisualElement({...c,color:f,innerColor:n});l=new D.LineVisualElement({...c,
color:l,innerColor:m});c=new D.LineVisualElement({...c,color:p,innerColor:a});return{visibleLineVisualElement:b,occludedLineVisualElement:l,undefinedLineVisualElement:c}};k.destroyLineOfSightVisualization=function(a){a.visibleLineVisualElement=u.destroyMaybe(a.visibleLineVisualElement);a.occludedLineVisualElement=u.destroyMaybe(a.occludedLineVisualElement);a.undefinedLineVisualElement=u.destroyMaybe(a.undefinedLineVisualElement)};k.updateLineOfSightVisualization=function(a,b){const c=this.visible,
f=this._configuration,{computationResult:n,inputPoints:l}=a,{start:m,end:p,intersection:w,isValid:M,isTargetVisible:N}=n;var {observer:q}=l;a=O;a[12]=q[0];a[13]=q[1];a[14]=q[2];const E=C.subtract(P,m,q),F=C.subtract(Q,p,q);q=C.subtract(R,w,q);const {visibleLineVisualElement:r,occludedLineVisualElement:x,undefinedLineVisualElement:y}=b;c?(r.visible=!0,x.visible=!0,y.visible=!0,r.geometry=null,x.geometry=null,y.geometry=null,M?N?(r.geometry=[[h.fromArray(E),h.fromArray(F)]],r.transform=a,b=d.toUnitRGBA(f.visibleOuterColor),
r.color=e.applyOpacity(b,b,this._opacity)):(r.geometry=[[h.fromArray(E),h.fromArray(q)]],r.transform=a,b=d.toUnitRGBA(f.occludedOuterColor),r.color=e.applyOpacity(b,b,this._opacity),x.geometry=[[h.fromArray(q),h.fromArray(F)]],x.transform=a):(y.geometry=[[h.fromArray(E),h.fromArray(F)]],y.transform=a)):(r.visible=!1,x.visible=!1,y.visible=!1)};k.updateVisualizationOpacity=function(a,b){var c=this._configuration;const f=this._opacity,n=d.toUnitRGBA(c.visibleOuterColor);e.applyOpacity(n,n,f);const l=
d.toUnitRGBA(c.visibleInnerColor);e.applyOpacity(l,l,f);const m=d.toUnitRGBA(c.occludedOuterColor);e.applyOpacity(m,m,f);const p=d.toUnitRGBA(c.occludedInnerColor);e.applyOpacity(p,p,f);const w=d.toUnitRGBA(c.undefinedOuterColor);e.applyOpacity(w,w,f);c=d.toUnitRGBA(c.undefinedInnerColor);e.applyOpacity(c,c,f);b.visibleLineVisualElement.color=a.computationResult.isTargetVisible?n:m;b.visibleLineVisualElement.innerColor=l;b.occludedLineVisualElement.color=m;b.occludedLineVisualElement.innerColor=p;
b.undefinedLineVisualElement.color=w;b.undefinedLineVisualElement.innerColor=c};k.getLineOfSightVisualizationDependencies=function(a){({computationResult:a}=a);const {occludedOuterColor:b,visibleOuterColor:c}=this._configuration;return{computationResult:a,occludedOuterColor:b,visibleOuterColor:c,visible:this.visible}};k._connectAnalysis=function(a){const b=this._analysisHandles;if(!b.has(a)){var c=this.createLineOfSightVisualization();b.add([B.reactionInit(()=>this.getLineOfSightVisualizationDependencies(a),
()=>this.updateLineOfSightVisualization(a,c)),B.reaction(()=>this._opacity,()=>this.updateVisualizationOpacity(a,c)),A.makeHandle(()=>this.destroyLineOfSightVisualization(c))],a)}};k._disconnectAnalysis=function(a){this._analysisHandles.remove(a)};k._connectAnalyses=function(){let a=null;return A.handlesGroup([B.reactionInit(()=>this._analyses,b=>{a=u.removeMaybe(a);a=b.on("change",c=>this._onAnalysesCollectionChange(c));this._onAnalysesCollectionChange({target:b,added:b.items,removed:[],moved:[]})}),
A.makeHandle(()=>a=u.removeMaybe(a))])};k._onAnalysesCollectionChange=function(a){a.added.forEach(b=>this._connectAnalysis(b));a.removed.forEach(b=>this._disconnectAnalysis(b))};G._createClass(z,[{key:"visible",get:function(){return this.layerView.visible&&!this.layerView.suspended}},{key:"_analyses",get:function(){return this.layerView.layerViewData.analyses}},{key:"_configuration",get:function(){return this.layerView.layerViewData.configuration}},{key:"_opacity",get:function(){return this.layerView.fullOpacity}}]);
return z}(I);t.__decorate([v.property({constructOnly:!0})],g.LineOfSightView.prototype,"layer",void 0);t.__decorate([v.property({constructOnly:!0})],g.LineOfSightView.prototype,"layerView",void 0);t.__decorate([v.property({constructOnly:!0})],g.LineOfSightView.prototype,"view",void 0);t.__decorate([v.property({readOnly:!0})],g.LineOfSightView.prototype,"visible",null);t.__decorate([v.property()],g.LineOfSightView.prototype,"_analyses",null);t.__decorate([v.property()],g.LineOfSightView.prototype,
"_configuration",null);t.__decorate([v.property()],g.LineOfSightView.prototype,"_opacity",null);g.LineOfSightView=t.__decorate([K.subclass("esri.views.3d.layers.analysis.LineOfSight.LineOfSightView")],g.LineOfSightView);const P=h.create(),Q=h.create(),R=h.create(),O=L.create();Object.defineProperty(g,"__esModule",{value:!0})});