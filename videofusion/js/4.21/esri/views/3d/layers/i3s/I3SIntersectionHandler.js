// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../support/orientedBoundingBox ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/verticalOffsetUtils".split(" "),function(u,y,n,z,v,A,B){function C(d,a,e,f=0){f=d[3]+f;const h=a[0]-d[0],c=a[1]-d[1];d=a[2]-d[2];a=e[0];const m=e[1];e=e[2];const k=a*h+m*c+e*d;return 0<=k*k-(a*a+m*m+e*e)*(h*h+c*c+d*d-f*f)}let G=function(){function d(a){this.type="I3S";this.layerUid=a.layerUid;this.sublayerUid=
a.sublayerUid;this.collection=a.collection;this.traverseNodeHierarchy=a.traverseNodeHierarchy;this.slicePlane=a.slicePlaneEnabled;this.isGround=a.isGround}d.prototype.intersect=function(a,e,f,h){const c=a.results,m=2===a.options.store,k=a.ray.direction,p=a.tolerance;let w=b=>b,t=b=>b;const q=B.getVerticalOffsetI3S(a.verticalOffset);n.isSome(q)&&(w=b=>q.applyToMbs(b),t=b=>q.applyToObb(b));this.traverseNodeHierarchy((b,x)=>{if(n.isSome(b.serviceObbInRenderSR)&&!v.intersectLine(t(b.serviceObbInRenderSR),
f,k,p))return!1;!x||n.isSome(b.geometryObb)&&!v.intersectLine(t(b.geometryObb),f,k,p)||!n.isSome(b.serviceObbInRenderSR)&&!C(w(b.renderMbs),f,k,p)||this.collection.intersect(x,f,h,p,q,(D,l,E,F)=>{if(0<=l&&(null==e||e(f,h,l))){var r=g=>{g.intersector=this.type;g.target={type:"external",metadata:{layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:b.index,componentIndex:D}};g.dist=l;z.copy(g.normal,E);g.triangleNr=F};this.isGround&&(null==c.ground.dist||l<c.ground.dist)&&r(c.ground);if(!a.options.isFiltered&&
((null==c.min.dist||l<c.min.dist)&&r(c.min),(null==c.max.dist||l>c.max.dist)&&r(c.max),m)){const g=new A.IntersectorResult(a.ray);r(g);a.results.all.push(g)}}});return!0})};y._createClass(d,[{key:"intersectionHandlerId",get:function(){return this.layerUid}}]);return d}();u.I3SIntersectionHandler=G;Object.defineProperty(u,"__esModule",{value:!0})});