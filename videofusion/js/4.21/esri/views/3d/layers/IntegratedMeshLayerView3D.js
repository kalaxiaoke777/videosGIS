// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingRect ./I3SMeshView3D ./LayerView3D ../support/updatingProperties ../../layers/LayerView".split(" "),function(p,e,r,m,f,c,z,A,t,q,k,u,v,w,x){c=function(n){function l(){var a=
n.apply(this,arguments)||this;a.type="integrated-mesh-3d";a.lodFactor=1;a._elevationContext="im";a._isIntegratedMesh=!0;a._supportsLabeling=!1;a.drapeTargetType=1;a._overlayTexOffset=q.fromValues(-1,-1,-1,-1);a._overlayTexScale=q.create();a._overlayColor=null;a._overlayHighlight=null;a._overlayNormal=null;return a}p._inheritsLoose(l,n);var g=l.prototype;g.setDrapingTextures=function(a){this._clearDrapingTexture(0);this._clearDrapingTexture(1);for(const b of a){var h=b.index,d=b.extent;a=b.needsColorWithoutRasterImage?
b.getValidTarget(1):b.hasDrapedFeatureSource?b.getValidTarget(0):null;m.isSome(a)&&0<k.area(d)&&(this._overlayTexOffset[2*h]=-d[0]/k.width(d),this._overlayTexOffset[2*h+1]=-d[1]/k.height(d),this._overlayTexScale[2*h]=1/k.width(d),this._overlayTexScale[2*h+1]=1/k.height(d),h=b.getValidTarget(2),d=b.getValidTarget(3),this._overlayColor=a.getTexture(),this._overlayHighlight=h?h.getTexture():null,this._overlayNormal=d?d.getTexture():null)}this._forAllNodes(b=>m.isSome(b)&&this._collection.updateMaterial(b.objectHandle,
y=>this._updateMaterialOverlay(y)))};g._clearDrapingTexture=function(a){this._overlayTexOffset[2*a]=-1;this._overlayTexOffset[2*a+1]=-1;this._overlayTexScale[2*a]=0;this._overlayTexScale[2*a+1]=0;this._overlayNormal=this._overlayHighlight=this._overlayColor=null};g._updateMaterialOverlay=function(a){a.overlayColor=this._overlayColor;a.overlayHighlight=this._overlayHighlight;a.overlayNormal=this._overlayNormal;a.overlayTexOffset=this._overlayTexOffset;a.overlayTexScale=this._overlayTexScale};g.initialize=
function(){this.updatingHandles.add(this.layer,"modifications",()=>this._loadModifications(),2)};g._createLayerGraphic=function(){const a=new r;a.layer=this.layer;a.sourceLayer=this.layer;return a};g.canResume=function(){return n.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};g._loadModifications=function(){this.handles.remove("modifications");if(m.isNone(this.layer.modifications))this._modifications=[];else{var a=this.layer.modifications;this.handles.add(this.updatingHandles.addOnCollectionChange(a,
()=>this._modifications=a.toArray(),2),"modifications")}};p._createClass(l,[{key:"progressiveLoadFactor",get:function(){return 1<=this.lodFactor?.2:1}}]);return l}(u.I3SMeshView3D(v.LayerView3D(x)));e.__decorate([f.property()],c.prototype,"layer",void 0);e.__decorate([f.property({aliasOf:"layer"})],c.prototype,"i3slayer",void 0);e.__decorate([f.property()],c.prototype,"suspended",void 0);e.__decorate([f.property(w.updatingProgress)],c.prototype,"updatingProgress",void 0);e.__decorate([f.property({readOnly:!0,
aliasOf:"_controller.updatingProgress"})],c.prototype,"updatingProgressValue",void 0);e.__decorate([f.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.integratedMesh.lodFactor"})],c.prototype,"lodFactor",void 0);e.__decorate([f.property({readOnly:!0})],c.prototype,"progressiveLoadFactor",null);return c=e.__decorate([t.subclass("esri.views.3d.layers.SceneLayerView3D")],c)});