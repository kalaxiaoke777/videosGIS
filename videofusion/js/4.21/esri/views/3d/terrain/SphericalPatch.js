// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/frustum ../../../geometry/support/plane ./PatchGeometryFactory ./Tile".split(" "),function(q,u,r,f,t,k,v,w,x,y,n){n=function(m){function p(b,a,d){var c=m.call(this,z)||this;c.obb=Array(8);c.isWebMercator=!1;for(let e=0;8>e;e++)c.obb[e]=t.create();void 0!==b&&c.init(b,a,d);return c}
u._inheritsLoose(p,m);var h=p.prototype;h.init=function(b,a,d){m.prototype.init.call(this,b,a,d);this.isWebMercator=d.tilingScheme.spatialReference.isWebMercator;a=this.ellipsoid.radius;d=this.extentInRadians[0];const c=this.extentInRadians[1],e=this.extentInRadians[2],g=this.extentInRadians[3];b=b[0];const A=r.lerp(c,g,.5),B=r.lerp(d,e,.5);this._edgeLen=(e-d)*Math.cos(0===b?0:Math.min(Math.abs(c),Math.abs(g)))*a;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=a-Math.sqrt(a*a-this._edgeLen2/
4);k.lonLatToSphericalPCPF(this.centerAtSeaLevel,B,A,this.ellipsoid.radius,0);a=t.fromArray(this.centerAtSeaLevel);f.normalize(a,a);this.up=a;this._updateOBB();this.updateRadiusAndCenter()};h.updateRadiusAndCenter=function(){if(0===this.lij[0])f.set(this._center[1],0,0,0),f.set(this._center[0],0,0,0),f.set(this._center[2],0,0,0),this.ellipsoid||(this.ellipsoid=v.getReferenceEllipsoid(this.surface.spatialReference)),this._center[1][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();
const b=Math.max(f.squaredDistance(this._center[1],this.obb[0]),f.squaredDistance(this._center[1],this.obb[1]));this._center[1][3]=Math.sqrt(b)}};h._isVisible=function(b){if(!this.intersectsClippingArea||!w.intersectsSphere(b,this._center[1]))return!1;if(10>this.lij[0])return!0;const a=this.obb;for(let e=0;6>e;e++){var d=4===e,c=b[e];d&&(l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3]-this.surface.view.state.camera.near);d=d?l:c;for(c=0;8>c;c++){const g=a[c];if(0>d[0]*g[0]+d[1]*g[1]+d[2]*g[2]+d[3])break}if(8===
c)return!1}return!0};h.computeElevationBounds=function(){m.prototype.computeElevationBounds.call(this);this._updateOBB()};h.createGeometry=function(b,a){const d=this._isPole(this.lij[1],this.lij[0]);y.createSphericalGlobePatch(b,this.extent,a,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,d);this.setMemoryDirty()};h._updateOBB=function(){var b=this.extentInRadians;const a=this.obb;for(let d=0;2>d;d++){const c=this.elevationBounds[d];let e=4*d;k.lonLatToSphericalPCPF(a[e++],
b[0],b[1],this.ellipsoid.radius,c);k.lonLatToSphericalPCPF(a[e++],b[0],b[3],this.ellipsoid.radius,c);k.lonLatToSphericalPCPF(a[e++],b[2],b[3],this.ellipsoid.radius,c);k.lonLatToSphericalPCPF(a[e++],b[2],b[1],this.ellipsoid.radius,c)}this.isWebMercator&&(b=this._isPole(this.lij[1],this.lij[0]),2===b?(f.set(a[1],0,0,this.ellipsoid.radius),f.set(a[2],0,0,this.ellipsoid.radius),f.set(a[5],0,0,this.ellipsoid.radius),f.set(a[6],0,0,this.ellipsoid.radius)):1===b&&(f.set(a[0],0,0,-this.ellipsoid.radius),
f.set(a[3],0,0,-this.ellipsoid.radius),f.set(a[4],0,0,-this.ellipsoid.radius),f.set(a[7],0,0,-this.ellipsoid.radius)))};h._isPole=function(b,a){let d=0;b===(1<<a)-1&&(d+=1);0===b&&(d+=2);return d};h.intersectsRay=function(b,a,d,c,e){c=this._center[1];d=c[3]+d+.2*this.ellipsoid.radius*Math.abs(e*(this.extentInRadians[3]-this.extentInRadians[1]));var g=c[0]-b[0];e=c[1]-b[1];b=c[2]-b[2];c=(g*a[0]+e*a[1]+b*a[2])/(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);g=a[0]*c-g;e=a[1]*c-e;a=a[2]*c-b;return g*g+e*e+a*a<d*d};
return p}(n["default"]);const z=[128,64,32,16,16,8,8,4],l=x.create();q.SphericalPatch=n;Object.defineProperty(q,"__esModule",{value:!0})});