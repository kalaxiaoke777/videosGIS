// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),function(d,p,e,A,B,C,m,F,
G,H,t,D,g,E,x,y){function z(b,a){return b&&!b.spatialReference.equals(a)?D.projectWithoutEngine(b,b.spatialReference,a):b}d.ExtentHelper=function(b){function a(c){c=b.call(this,c)||this;c._handles=new B;return c}p._inheritsLoose(a,b);var k=a.prototype;k.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};k.destroy=function(){this._handles.destroy();this._handles=null};k._computeStencilEnabledExtents=function(){const c=[];this.layerViews.forEach(f=>
{f=f.layer;"IntegratedMeshLayer"===f.operationalLayerType&&null!=this.viewSpatialReference&&(f=z(f.fullExtent,this.viewSpatialReference),C.isSome(f)&&c.push(g.fromExtent(f)))});return c};p._createClass(a,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}}]);return a}(A);e.__decorate([m.property({readOnly:!0})],
d.ExtentHelper.prototype,"layerViewsExtent",null);e.__decorate([m.property({readOnly:!0})],d.ExtentHelper.prototype,"tiledLayersExtent",null);e.__decorate([m.property({readOnly:!0})],d.ExtentHelper.prototype,"stencilEnabledExtents",null);e.__decorate([m.property()],d.ExtentHelper.prototype,"viewSpatialReference",void 0);e.__decorate([m.property()],d.ExtentHelper.prototype,"tilingScheme",void 0);e.__decorate([m.property()],d.ExtentHelper.prototype,"defaultTiledLayersExtent",void 0);e.__decorate([m.property({constructOnly:!0})],
d.ExtentHelper.prototype,"layers",void 0);e.__decorate([m.property({constructOnly:!0})],d.ExtentHelper.prototype,"layerViews",void 0);d.ExtentHelper=e.__decorate([t.subclass("esri.views.3d.terrain.ExtentHelper")],d.ExtentHelper);let u=function(b){function a(){return b.apply(this,arguments)||this}p._inheritsLoose(a,b);var k=a.prototype;k._computeLayerViewsExtent=function(){return this._globalExtent};k._computeTiledLayersExtent=function(){return this._globalExtent};p._createClass(a,[{key:"_globalExtent",
get:function(){return this.viewSpatialReference.isWebMercator?x.WEBMERCATOR_WORLD_EXTENT:x.GEOGRAPHIC_WORLD_EXTENT}}]);return a}(d.ExtentHelper);u=e.__decorate([t.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],u);let w=function(b){function a(){return b.apply(this,arguments)||this}p._inheritsLoose(a,b);var k=a.prototype;k._computeLayerViewsExtent=function(){const c=g.empty(),f=this.viewSpatialReference;this.layerViews.forEach(h=>{const n=h.layer;!h.isResolved()||"graphics"===n.type&&n.internal||
(h=z("fullExtentInLocalViewSpatialReference"in h&&h.fullExtentInLocalViewSpatialReference||h.layer.fullExtent,f),g.expand(c,h,c))});const l=g.allFinite(c)?c:null,q=this._get("layerViewsExtent");return g.equals(l,q)?q:l};k._computeTiledLayersExtent=function(){const c=this.tilingScheme;if(!c)return null;const f=this.viewSpatialReference,l=g.empty();this.layers.forEach(n=>{if(n.loaded&&E.isTiledLayer(n)){const {tileInfo:v,fullExtent:r}=y.getTiledLayerInfo(n,f,2);(v&&y.isProjectableRasterLayer(n)&&r||
v&&c.compatibleWith(v)&&r&&r.spatialReference.equals(c.spatialReference))&&g.expand(l,r,l)}});g.expand(l,this.defaultTiledLayersExtent,l);const q=g.allFinite(l)?l:null,h=this._get("tiledLayersExtent");return g.equals(q,h)?h:q};return a}(d.ExtentHelper);w=e.__decorate([t.subclass("esri.views.3d.terrain.ExtentHelperLocal")],w);d.create=function(b,a){return 1===b?new u(a):new w(a)};Object.defineProperty(d,"__esModule",{value:!0})});