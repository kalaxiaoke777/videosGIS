// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3f32 ../../../geometry/projectionEllipsoid ./CloudsTechnique ./NoiseTextureAtlas ../webgl-engine/lib/glUtil3D ../../webgl/FramebufferObject".split(" "),function(h,l,e,m,n,p,q,c,r,t,u,v,w){let y=function(){function g(a,b){this._cubeMapSize=2048;this._viewMat3=n.create();this._eye=c.zeros();this._faceRenderFlags=[];
this.viewDirections=[c.fromValues(1,0,0),c.fromValues(-1,0,0),c.fromValues(0,1,0),c.fromValues(0,-1,0),c.fromValues(0,0,1)];this.upDirections=[c.fromValues(0,1,0),c.fromValues(0,1,0),c.fromValues(0,0,-1),c.fromValues(0,0,1),c.fromValues(0,1,0)];this._cloudRadius=0;this._viewMatrix=q.create();this.coverage=.4;this.detailSize=this.cloudSize=this.density=.5;this.smoothness=.7;this.absorption=0;this.cloudHeight=1;this._noiseTextureAtlas=new u.NoiseTextureAtlas(a,b);this._noiseTextureAtlas.render(128,
a);this._frameBufferCube=new w(a,{colorTarget:2,width:this._cubeMapSize,height:this._cubeMapSize},{target:34067,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize});this._vao=v.createQuadVAO(a);this._technique=new t.CloudsTechnique({rctx:a,viewingMode:b.state.viewingMode},null);this._cloudRadius=.5*r.getReferenceEllipsoid(b.spatialReference).radius;this.resetRenderFlags()}var f=g.prototype;f.destroy=function(){this._technique=
e.releaseMaybe(this._technique);this._frameBufferCube=e.disposeMaybe(this._frameBufferCube);this._vao=e.disposeMaybe(this._vao);this._noiseTextureAtlas=e.destroyMaybe(this._noiseTextureAtlas)};f.resetRenderFlags=function(){for(let a=0;5>a;a++)this._faceRenderFlags[a]=!0};f._allRendered=function(){for(let a=0;5>a;a++)if(!0===this._faceRenderFlags[a])return!1;return!0};f.remap=function(a,b,d,k,x){return k+(a-b)*(x-k)/(d-b)};f.render=function(a){if(e.isNone(this._vao)||this._allRendered())return!1;this.resetRenderFlags();
a.setViewport(0,0,this._cubeMapSize,this._cubeMapSize);a.bindFramebuffer(this._frameBufferCube,!1,34069);const b=this._technique.program;a.useProgram(b);b.bindTexture(this._noiseTextureAtlas.textureAtlas,"cloudShapeTexture");b.setUniform1f("cloudRadius",this._cloudRadius);b.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize);b.setUniform1f("power",this._power);b.setUniform1f("sigmaE",this._sigmaE);b.setUniform1f("density",this._density);b.setUniform1f("cloudSize",this._cloudSize);b.setUniform1f("detailSize",
this._detailSize);b.setUniform1f("smoothness",this._smoothness);b.setUniform1f("cloudHeight",this._cloudHeight);b.setUniform1f("coverage",this._coverage);a.bindVAO(this._vao);b.assertCompatibleVertexAttributeLocations(this._vao);this._technique.bindPipelineState(a);for(let d=0;5>d;d++)this._faceRenderFlags[d]&&(p.targetTo(this._viewMatrix,this._eye,this.viewDirections[d],this.upDirections[d]),m.fromMat4(this._viewMat3,this._viewMatrix),b.setUniformMatrix3fv("viewMatrix",this._viewMat3),this._frameBufferCube.framebufferTexture2D(this._frameBufferCube.colorAttachment.glName,
a.gl,36064,34069+d),a.gl.drawArrays(a.gl.TRIANGLE_STRIP,0,4),a.gl.flush(),this._faceRenderFlags[d]=!1);return!0};l._createClass(g,[{key:"coverage",get:function(){return this._coverage},set:function(a){this._coverage=a;this.resetRenderFlags()}},{key:"density",get:function(){return this._density},set:function(a){this._density=this.remap(a,0,1,0,.3);this.resetRenderFlags()}},{key:"cloudSize",get:function(){return this._cloudSize},set:function(a){this._cloudSize=this.remap(Math.max(.01,1-a),0,1,0,.02);
this.resetRenderFlags()}},{key:"detailSize",get:function(){return this._detailSize},set:function(a){this._detailSize=this.remap(Math.max(.01,1-a),0,1,0,.2);this.resetRenderFlags()}},{key:"smoothness",get:function(){return this._smoothness},set:function(a){this._smoothness=this.remap(1-a,0,1,0,.5);this.resetRenderFlags()}},{key:"absorption",get:function(){return this._power},set:function(a){this._sigmaE=1+a;this._power=this.remap(a,0,1,35,70);this.resetRenderFlags()}},{key:"cloudHeight",get:function(){return this._cloudHeight},
set:function(a){this._cloudHeight=this.remap(a,0,1,0,1500);this.resetRenderFlags()}},{key:"test",get:function(){return{power:this._power,density:this._density,cloudHeight:this._cloudHeight,cloudSize:this._cloudSize,detailSize:this._detailSize,smoothness:this._smoothness}}}]);return g}();h.CloudsGenerator=y;Object.defineProperty(h,"__esModule",{value:!0})});