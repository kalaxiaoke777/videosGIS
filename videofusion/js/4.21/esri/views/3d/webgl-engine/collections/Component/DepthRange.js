// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),function(J,F,K,S,T,U,h,x,L,M,w){function G(b,d,a){return h.set(b,d.data[a+0],d.data[a+1],d.data[a+2])}function f(b,d){b.push(d[0]);b.push(d[1]);b.push(d[2])}function V(b,d,a,
q){T.conjugate(N,b.quaternion);h.sub(l,d,b.center);h.transformQuat(l,l,N);const r=8*((l[0]<-b.halfSize[0]?-1:l[0]>b.halfSize[0]?1:0)+3*(l[1]<-b.halfSize[1]?-1:l[1]>b.halfSize[1]?1:0)+9*(l[2]<-b.halfSize[2]?-1:l[2]>b.halfSize[2]?1:0)+13);d=O[r];if(0===d)return d;K.fromQuat(C,b.quaternion);K.scale(C,C,b.halfSize);const p=(k,c)=>{c=O[r+c+1];h.set(k,((c&1)<<1)-1,(c&2)-1,((c&4)>>1)-1);h.transformMat3(k,k,C);return h.add(k,b.center,k)};a.length=0;f(a,p(H,0));f(a,p(P,1));f(a,p(l,2));f(a,p(Q,3));q(a);if(1===
d)return d;a.length=0;f(a,H);f(a,Q);f(a,p(l,4));f(a,p(R,5));q(a);if(2===d)return d;a.length=0;f(a,H);f(a,R);f(a,p(l,6));f(a,P);q(a);return d}const D=new F({allocator:b=>b||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:b=>{b.object=null;return b}}),u=w.empty(),g=x.create(),y=x.create(),W=new F({deallocator:null}),X=new F({deallocator:null}),O=(()=>{const b=new Int8Array(216);let d=0;const a=q=>{for(let r=0;r<q.length;r++)b[d+r]=q[r];d+=8};a([3,0,6,2,3,1,5,4]);a([2,0,2,3,1,5,4,0]);a([3,
1,0,2,3,7,5,4]);a([2,0,1,3,2,6,4,0]);a([1,0,1,3,2,0,0,0]);a([2,1,5,7,3,2,0,0]);a([3,2,0,1,3,7,6,4]);a([2,2,0,1,3,7,6,0]);a([3,3,0,1,5,7,6,2]);a([2,0,1,5,4,6,2,0]);a([1,0,1,5,4,0,0,0]);a([2,1,3,7,5,4,0,0]);a([1,0,2,6,4,0,0,0]);a([0,0,0,0,0,0,0,0]);a([1,1,3,7,5,0,0,0]);a([2,2,3,7,6,4,0,0]);a([1,2,3,7,6,0,0,0]);a([2,3,1,5,7,6,2,0]);a([3,4,0,1,5,7,6,2]);a([2,5,7,6,4,0,1,0]);a([3,5,0,1,3,7,6,4]);a([2,4,5,7,6,2,0,0]);a([1,4,5,7,6,0,0,0]);a([2,5,1,3,7,6,4,0]);a([3,6,0,2,3,7,5,4]);a([2,6,2,3,7,5,4,0]);a([3,
7,6,2,3,1,5,4]);return b})(),C=S.create(),N=U.create(),l=x.create(),H=x.create(),P=x.create(),Q=x.create(),R=x.create();J.computeDepthRange=function(b,d){const a=w.empty(),{eye:q,frustum:r,viewForward:p}=b;d.forAll(k=>{var c=k.obb;const e=h.dot(h.sub(l,c.center,q),p),m=M.projectedRadius(c,p);if(!w.within(a,e-m)||!w.within(a,e+m)){a:{var n=0;for(let v=0;4>v;v++){const t=M.intersectPlane(c,r[v]);if(0<t){c=-1;break a}0===t&&(n|=1<<v)}c=n}-1!==c&&(0===c?(u.far=e+m,u.near=e-m,w.union(a,u)):(n=D.pushNew(),
n.near=e-m,n.far=e+m,n.mask=c,n.object=k))}});for(b=0;b<D.length;b++){const k=D.data[b];w.within(a,k.near)&&w.within(a,k.far)||(u.far=k.far,u.near=Infinity,0===V(k.object.obb,q,W,c=>{var e=X;for(var m=0;4>m&&0<c.length;m++)if(0!==(k.mask&1<<m)){{var n=r[m],v=c,t=e;t.length=0;const I=v.length-3;G(g,v,I);const z=L.signedDistance(n,g);0>=z&&(t.push(g[0]),t.push(g[1]),t.push(g[2]));let E=0,A=z;for(E;E<I;E+=3){G(y,v,E);const B=L.signedDistance(n,y);0>A*B&&(h.lerp(g,y,g,B/(B-A)),f(t,g));0>=B&&f(t,y);A=
B;h.copy(g,y)}0>A*z&&(G(y,v,I),h.lerp(g,y,g,z/(z-A)),f(t,g))}n=c;c=e;e=n}for(e=0;e<c.length;e+=3)h.set(g,c.data[e+0],c.data[e+1],c.data[e+2]),m=h.dot(h.sub(g,g,q),p),u.near=Math.min(u.near,m)})&&(u.near=0),w.union(a,u))}D.length=0;return a};Object.defineProperty(J,"__esModule",{value:!0})});