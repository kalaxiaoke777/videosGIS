// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/maybe ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../../chunks/builtins ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject ../lib/Util".split(" "),function(m,g,n,u,v,w,x,y,z,A,q,B,r){n=function(){function p(a){this._rctx=a;this.cache=new Map}var f=p.prototype;f.dispose=function(){this.cache.forEach(a=>
a.texture=g.disposeMaybe(a.texture));this.cache.clear()};f.acquire=function(a){if(g.isNone(a))return null;const b=this.patternId(a),d=this.cache.get(b);if(d)return d.refCount++,d.bind;const {encodedData:h,sdfNormalizer:k}=this.patternToTextureData(a,2),l=h.length/4,e=l/2,c={refCount:1,texture:null,bind:t=>{g.isNone(c.texture)&&(c.texture=new q(this._rctx,{width:l,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},h));t.bindTexture(c.texture,"stipplePatternTexture");return{pixelSize:e,
sdfNormalizer:k}}};this.cache.set(b,c);return c.bind};f.release=function(a){if(!g.isNone(a)){a=this.patternId(a);var b=this.cache.get(a);b&&(b.refCount--,0===b.refCount&&(g.isSome(b.texture)&&b.texture.dispose(),this.cache.delete(a)))}};f.swap=function(a,b){b=this.acquire(b);this.release(a);return b};f.patternId=function(a){return a.join(",")};f.patternToTextureData=function(a,b){var d=Math.floor(a.reduce((e,c)=>e+c)*b);const h=.5*(a.reduce((e,c)=>Math.max(e,c))+1)*b;d=new Uint8Array(4*d);let k=1,
l=0;for(const e of a){a=e*b;for(let c=0;c<a;c++)r.packFloatRGBA(k*(Math.min(c,a-c)+.5)/h*.5+.5,d,l),l+=4;k=-k}return{encodedData:d,sdfNormalizer:h}};return p}();m.StippleTextureRepository=n;Object.defineProperty(m,"__esModule",{value:!0})});