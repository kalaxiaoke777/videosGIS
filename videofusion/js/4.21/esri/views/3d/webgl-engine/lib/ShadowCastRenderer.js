// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./glUtil3D ../shaders/ShadowCastTechnique ../../../webgl/Util".split(" "),function(d,m,h,k,f,n,e,p){const q=f.fromValues(.01,0,.25,1),l=1/512;f=function(){function g(a,b,r,t){this._techniqueRep=a;this._rctx=b;this._shadowAccumulator=r;this._requestRender=t;this._enabled=!1;this._vao=n.createQuadVAO(b);this._visualizationConfig=new e.ShadowCastTechniqueConfiguration;
this._visualizationConfig.pass=1;this._visualizationConfig.visualization=0;this._visualizeShadowCastTechnique=a.acquire(e.ShadowCastTechnique,this._visualizationConfig);this._visualizationParams={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:q,threshold:.5,bandSize:.1,opacityFromElevation:1}}var c=g.prototype;c.dispose=function(){this._stop();this._vao=h.disposeMaybe(this._vao);this._visualizeShadowCastTechnique=h.disposeMaybe(this._visualizeShadowCastTechnique);this._shadowAccumulator=
null};c.render=function(){this._isRenderingVisualization&&(this._sampleScale=1/this._computedSamples,this._rctx.bindVAO(this._vao),this._rctx.useProgram(this._visualizeShadowCastTechnique.program),this._visualizeShadowCastTechnique.bindPipelineState(this._rctx),this._visualizeShadowCastTechnique.bindPass(this._visualizationParams),this._rctx.drawArrays(this._visualizeShadowCastTechnique.primitiveType,0,p.vertexCount(this._vao,"geometry")))};c.setOptions=function(a){void 0!==a.enabled&&this._setEnabled(a.enabled);
void 0!==a.color&&this._setColor(a.color);void 0!==a.threshold&&(this._threshold=a.threshold);void 0!==a.visualization&&(this._visualization=a.visualization);void 0!==a.bandSize&&(this._bandSize=a.bandSize);void 0!==a.bandsEnabled&&(this._bandsEnabled=a.bandsEnabled)};c._setColor=function(a){k.exactEquals(a,this._visualizationParams.color)||(k.copy(this._visualizationParams.color,a),this._requestRenderIfRunning())};c._setEnabled=function(a){a!==this._enabled&&(a?this._start():this._stop())};c._requestRenderIfRunning=
function(){this._enabled&&this._requestRender()};c._start=function(){this._enabled=!0;this._requestRender()};c._stop=function(){this._enabled=!1;this._requestRender()};m._createClass(g,[{key:"opacityFromElevation",get:function(){return this._visualizationParams.opacityFromElevation},set:function(a){this._visualizationParams.opacityFromElevation=a}},{key:"_isRenderingVisualization",get:function(){return this._enabled&&0<this._computedSamples&&this.opacityFromElevation>l}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},
{key:"_shadowCastTexture",get:function(){return this._shadowAccumulator.shadowCastTexture}},{key:"_sampleScale",get:function(){return this._visualizationParams.sampleScale},set:function(a){this._visualizationParams.sampleScale=a}},{key:"_threshold",get:function(){return this._visualizationParams.threshold},set:function(a){this._threshold!==a&&(this._visualizationParams.threshold=a,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._visualizationConfig.visualization},
set:function(a){if(a!==this._visualization){var b=this._visualizationConfig;b.visualization=a;this._visualizeShadowCastTechnique=this._techniqueRep.releaseAndAcquire(e.ShadowCastTechnique,b,this._visualizeShadowCastTechnique);this._requestRenderIfRunning()}}},{key:"_bandSize",get:function(){return this._visualizationParams.bandSize},set:function(a){a!==this._bandSize&&(this._visualizationParams.bandSize=a,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._visualizationConfig.bandsEnabled},
set:function(a){if(a!==this._bandsEnabled){var b=this._visualizationConfig;b.bandsEnabled=a;this._visualizeShadowCastTechnique=this._techniqueRep.releaseAndAcquire(e.ShadowCastTechnique,b,this._visualizeShadowCastTechnique);this._requestRenderIfRunning()}}}]);return g}();d.ShadowCastRenderer=f;d.shadowCastDisableElevationMax=5E4;d.shadowCastDisableElevationMin=4E4;d.shadowCastDisabledElevationThreshold=l;Object.defineProperty(d,"__esModule",{value:!0})});