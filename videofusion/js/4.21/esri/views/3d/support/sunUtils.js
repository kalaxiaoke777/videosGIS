// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/SunCalc".split(" "),function(z,A,B,R,v,w,x){function M(g,h,l,e){const c=S,d=B.identity(T);if(1===l)x.SunCalc.getPosition(g,0,0,c),v.set(e,0,0,-1),B.rotateX(d,d,-c.azimuth),B.rotateY(d,d,-c.altitude);else{var a=t.planarDirection;l=a.globalAngles;a=(Math.abs(h[2])-a.localAltitude)/(a.globalAltitude-a.localAltitude);a=A.clamp(a,0,1);1>a?(x.SunCalc.getPosition(g,
h[1],h[0],c),c.azimuth=(1-a)*c.azimuth+a*l.azimuth,c.altitude=(1-a)*c.altitude+a*l.altitude):(c.azimuth=l.azimuth,c.altitude=l.altitude);v.set(e,0,-1,0);B.rotateZ(d,d,-c.azimuth);B.rotateX(d,d,-c.altitude)}v.transformMat4(e,e,d)}function k(g,h,l,e){const c=[];for(let d=0;d<l.length;d++)c[d]=(e[d]-l[d])*g/h+l[d];return c}const t={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,
globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},U=w.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258),T=R.create(),S={azimuth:0,altitude:0},N=new Date(0);z.ColorAndIntensity=function(){this.ambient={color:w.fromValues(1,1,1),intensity:.55};this.diffuse={color:w.fromValues(1,1,1),intensity:.55,directionToLightSource:w.clone(U)};this.noonFactor=.5;this.globalFactor=0};z.computeColorAndIntensity=function(g,h,l,e){var c=h[2];v.set(e.ambient.color,1,1,1);e.ambient.intensity=
t.global.ambient;v.set(e.diffuse.color,1,1,1);e.diffuse.intensity=t.global.diffuse;var d=A.clamp((Math.abs(c)-t.local.altitude)/(t.global.altitude-t.local.altitude),0,1);e.globalFactor=d;c=x.SunCalc.getTimes(g,h[1],h[0]);if(1>d){{var a=g.valueOf();if(c.polarException===x.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN){var m=a-36E5*(g.getHours()+48)-6E4*g.getMinutes();var f=m+432E6}else c.polarException===x.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(m=a-2,f=a-1):(m=c.sunrise.valueOf(),f=c.sunset.valueOf());var r=
f-m;var p=m+r/2;var n=r/4;var u=p-n;n=p+n;var b=.06*r;r=m-b/2;m+=b/2;const y=f-b/2,I=f+b/2;f=t.local;const J=[.01,f.ambientAtNight],K=[.8,.8,1],L=[.01,.01,.01],C=[f.diffuseAtTwilight,f.ambientAtTwilight],D=[1,.75,.75],E=[.8,.8,1],F=[.9*f.diffuseAtNoon,f.ambientAtNoon],G=[1,.98,.98],H=[.98,.98,1],O=[f.diffuseAtNoon,f.ambientAtNoon],P=[1,1,1],Q=[1,1,1];f=[0,0];let q=[0,0,0];b=[0,0,0];a<r||a>I?(f=J,q=L,b=K):a<m?(b=m-r,f=k(a-r,b,J,C),q=k(a-r,b,L,D),b=k(a-r,b,K,E)):a<u?(b=u-m,f=k(a-m,b,C,F),q=k(a-m,b,
D,G),b=k(a-m,b,E,H)):a<p?(b=p-u,f=k(a-u,b,F,O),q=k(a-u,b,G,P),b=k(a-u,b,H,Q)):a<n?(b=n-p,f=k(a-p,b,O,F),q=k(a-p,b,P,G),b=k(a-p,b,Q,H)):a<y?(b=y-n,f=k(a-n,b,F,C),q=k(a-n,b,G,D),b=k(a-n,b,H,E)):a<I&&(b=I-y,f=k(a-y,b,C,J),q=k(a-y,b,D,L),b=k(a-y,b,E,K));a=f[0];p=w.fromValues(q[0],q[1],q[2]);u=f[1];n=w.fromValues(b[0],b[1],b[2])}v.lerp(e.ambient.color,n,e.ambient.color,d);e.ambient.intensity=A.lerp(u,e.ambient.intensity,d);v.lerp(e.diffuse.color,p,e.diffuse.color,d);e.diffuse.intensity=A.lerp(a,e.diffuse.intensity,
d)}d=g.valueOf();c.polarException===x.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(a=d-36E5*(g.getHours()+48)-6E4*g.getMinutes(),c=a+432E6):c.polarException===x.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(a=d-2,c=d-1):(a=c.sunrise.valueOf(),c=c.sunset.valueOf());c=1-A.clamp(Math.abs(d-(a+(c-a)/2))/432E5,0,1);e.noonFactor=c;M(g,h,l,e.diffuse.directionToLightSource)};z.computeDirectionsOverTime=function(g,h,l,e,c){g=g.getTime();h=h.getTime()-g;h=Math.floor(h/l)+1;const d=Array(h);for(let a=0;a<h;++a)N.setTime(g+
l*a),d[a]=w.create(),M(N,e,c,d[a]);return d};z.computeShadowsEnabled=function(g,h){return 1===h?!0:Math.abs(g)<t.planarDirection.localAltitude};Object.defineProperty(z,"__esModule",{value:!0})});