// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ./intersectionUtils".split(" "),function(r,H,x,I,y,d,n,t,J,u,z,A,m,B,K){const C=.5*Math.PI,L=C/
Math.PI*180;let G=function(){function D(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:n.create(),direction:n.create()};for(a=0;4>a;a++)this.extent[a]={origin:n.create(),direction:n.create(),cap:{next:null,direction:n.create()}},this.planes[a]=m.create();this.planes[4]=m.create();this.planes[5]=m.create();this.planesWithoutFar=this.planes.slice(0,5)}var p=D.prototype;p.update=function(a,b,c,e=!0){const k=this.extent;this.toRenderBoundingExtent(a,
b,c);d.add(this.center.origin,k[0].origin,k[2].origin);d.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);e||d.scale(this.center.direction,this.center.direction,-1);for(c=0;4>c;c++){const g=k[c];this.renderCoordsHelper.worldUpAtPosition(g.origin,g.direction);const q=k[3===c?0:c+1];g.cap.next=q.origin;d.direction(g.cap.direction,g.origin,q.origin);m.fromVectorsAndPoint(g.direction,g.cap.direction,g.origin,this.planes[c]);
e||d.scale(g.direction,g.direction,-1)}m.fromVectorsAndPoint(k[0].cap.direction,k[1].cap.direction,k[0].origin,this.planes[4]);e?m.negate(this.planes[4],this.planes[5]):(m.copy(this.planes[4],this.planes[5]),m.negate(this.planes[4],this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=b;this.minGlobalAltitude=.9*J.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};p.isVisibleInFrustum=function(a,b,c=!1){if(null==a)return!1;if(1===this.renderCoordsHelper.viewingMode){if(this.maxSpan>
(this.maxSpanSpatialReference.isGeographic?L:C*b))return!0;if(a.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(a)}if(0===this.maxSpan)return b=this.extent[0],!c&&a.intersectsRay(B.wrap(b.origin,b.direction))?!0:!1;for(b=0;b<this.extent.length;b++){var e=this.extent[b];if(!c&&a.intersectsRay(B.wrap(e.origin,e.direction))||a.intersectsLineSegment(A.fromPoints(e.origin,e.cap.next,M),e.cap.direction))return!0}c=c?this.planes:this.planesWithoutFar;for(b=0;b<a.lines.length;b++)if(e=
a.lines[b],K.frustumLineSegment(c,e.origin,e.endpoint,e.direction))return!0;return!1};p.toRenderBoundingExtentGlobal=function(a,b,c){z.center(a,h);h[2]=c;t.computeTranslationToOriginAndRotation(b,h,v,this.renderCoordsHelper.spatialReference);I.invert(E,v);u.empty(f);for(const {x0:e,x1:k,y0:g,y1:q}of N)for(let w=0;5>w;w++){const F=w/4;h[0]=x.lerp(a[e],a[k],F);h[1]=x.lerp(a[g],a[q],F);h[2]=c;t.projectVectorToVector(h,b,h,this.renderCoordsHelper.spatialReference);d.transformMat4(h,h,E);u.expandWithVec3(f,
h)}d.set(this.extent[0].origin,f[0],f[1],f[2]);d.set(this.extent[1].origin,f[3],f[1],f[2]);d.set(this.extent[2].origin,f[3],f[4],f[2]);d.set(this.extent[3].origin,f[0],f[4],f[2]);for(a=0;4>a;++a)d.transformMat4(this.extent[a].origin,this.extent[a].origin,v)};p.toRenderBoundingExtentLocal=function(a,b,c){t.projectBoundingRect(a,b,l,this.renderCoordsHelper.spatialReference);d.set(this.extent[0].origin,l[0],l[1],c);d.set(this.extent[1].origin,l[2],l[1],c);d.set(this.extent[2].origin,l[2],l[3],c);d.set(this.extent[3].origin,
l[0],l[3],c)};p.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(a,b,c);break;case 2:this.toRenderBoundingExtentLocal(a,b,c);break;default:H.neverReached(this.renderCoordsHelper.viewingMode)}};p.isVisibleInFrustumGlobal=function(a){if(0>d.dot(this.center.direction,a.direction))return!0;for(let b=0;4>b;b++)if(0>d.dot(this.extent[b].direction,a.direction))return!0;return!1};return D}();const N=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,
x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],h=n.create(),v=y.create(),E=y.create(),f=u.create(),l=z.create(),M=A.create();r.FrustumExtentIntersection=G;r["default"]=G;Object.defineProperty(r,"__esModule",{value:!0})});