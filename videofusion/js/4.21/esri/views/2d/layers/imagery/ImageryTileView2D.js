// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../engine/RasterTileContainer ./BaseImageryTileSubView2D".split(" "),function(q,k,p,n,e,B,C,v,w,x){e=function(u){function r(){var b=u.apply(this,arguments)||this;b.container=null;b.layer=null;b.tileSize=
null;b.type="raster";b.useWebGLForProcessing=!0;return b}q._inheritsLoose(r,u);var f=r.prototype;f.canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())};f.fetchTile=function(b,a){return this.layer.fetchTile(b.level,b.row,b.col,a)};f.updateTileSource=function(){var b=q._asyncToGenerator(function*(a,c){const {bandIds:l}=this.layer,m=this._getLayerInterpolation(),
g=this.canUseWebGLForProcessing(),{source:d,symbolizerParams:h,globalSymbolizerParams:t,suspended:y,coords:z,resolution:A}=c;({bitmap:a}=a);[a.x,a.y]=z;a.resolution=A;d&&p.isSome(d)&&p.isSome(d.pixelBlock)?(c={extent:d.extent,pixelBlock:d.pixelBlock},a.rawPixelData=c,g?(a.source=d.pixelBlock,a.isRendereredSource=!1):(c=yield this.layer.applyRenderer(c,"stretch"===(null==t?void 0:t.type)?t:null),a.source=c,a.isRendereredSource=!0),a.symbolizerParameters=g?h:null,g?a.transformGrid||(a.transformGrid=
d.transformGrid):a.transformGrid=null):(c=this.createEmptyTilePixelBlock(),a.source=c,a.symbolizerParameters=g?h:null,a.transformGrid=null);a.bandIds=g?l:null;a.width=this.tileSize[0];a.height=this.tileSize[1];a.interpolation=m;a.suspended=y;a.invalidateTexture()});return function(a,c){return b.apply(this,arguments)}}();f.updateTileSymbolizerParameters=function(){var b=q._asyncToGenerator(function*(a,c){const {local:l,global:m}=c;({bandIds:c}=this.layer);const g=this._getLayerInterpolation(),d=this.canUseWebGLForProcessing();
({bitmap:a}=a);const {rawPixelData:h}=a;!d&&p.isSome(h)?(a.source=yield this.layer.applyRenderer(h,"stretch"===(null==m?void 0:m.type)?m:null),a.isRendereredSource=!0):(a.isRendereredSource&&p.isSome(h)&&(a.source=h.pixelBlock),a.isRendereredSource=!1);a.symbolizerParameters=d?m||l:null;a.bandIds=d?c:null;a.interpolation=g;a.suspended=!1});return function(a,c){return b.apply(this,arguments)}}();f.install=function(b,a){this.container=new w.RasterTileContainer(a.tileInfoView);this.container.isCustomTilingScheme=
a.isCustomTilingScheme;b.addChild(this.container)};f.uninstall=function(){this.container.removeAllChildren();this.container.remove()};f._canUseMajorityInterpolationOnDataSource=function(){const {bandCount:b,attributeTable:a,colormap:c,pixelType:l}=this.layer.rasterInfo;return 1===b&&(null!=a||null!=c||"u8"===l||"s8"===l)};f._getLayerInterpolation=function(){var b=this.layer.renderer.type;if("raster-colormap"===b||"unique-value"===b||"class-breaks"===b)return"nearest";({interpolation:b}=this.layer);
const {renderer:a}=this.layer;return"raster-stretch"===a.type&&null!=a.colorRamp?"bilinear"===b||"cubic"===b?"bilinear":"nearest":b};return r}(x.BaseImageryTileSubView2D);k.__decorate([n.property()],e.prototype,"container",void 0);k.__decorate([n.property()],e.prototype,"layer",void 0);k.__decorate([n.property()],e.prototype,"tileSize",void 0);k.__decorate([n.property()],e.prototype,"type",void 0);k.__decorate([n.property()],e.prototype,"useWebGLForProcessing",void 0);return e=k.__decorate([v.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],
e)});