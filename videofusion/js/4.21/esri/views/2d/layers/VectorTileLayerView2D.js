// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/has ../../../../core/ItemCache ../../../../core/promiseUtils ../../../../core/workers/workers ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./TileIndex ./decluttering/debugging ../../tiling/TileKey".split(" "),function(A,F,x,h,q,t,e,c,d,a,b,k,u){const w=new q(10),p=new Map;q=function(){function g(m,y,D){this._vectorTileLayer=m;this._styleRepository=
y;this.devicePixelRatio=D;this._connection=this._glyphMosaic=this._spriteMosaic=null}var l=g.prototype;l.destroy=function(){this._connection&&(this._connection.close(),this._connection=null);this._vectorTileLayer=this._styleRepository=null;this._spriteMosaic&&(this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic=null)};l.start=function(){var m=F._asyncToGenerator(function*(y){const D=this._vectorTileLayer;var B=D.sourceNameToSource;const r=[];for(const z in B)r.push(this._fetchTileMap(B[z],
y));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,y);this._spriteSourcePromise.then(z=>{this._spriteMosaic=new a(1024,1024,250);this._spriteMosaic.setSpriteSource(z)});B=new d(this._styleRepository.glyphs);this._glyphMosaic=new c(1024,1024,B);this._broadcastPromise=e.open("WorkerTileHandler",{client:this,schedule:y.schedule,signal:y.signal}).then(z=>{this._connection=z;return Promise.all(this._connection.broadcast("setStyle",{style:D.currentStyleInfo.style,
vectorTileLayerMaxBuffers:h("vectortilelayer-max-buffers")},y))});return Promise.all(r)});return function(y){return m.apply(this,arguments)}}();l.updateStyle=function(){var m=F._asyncToGenerator(function*(y){yield this._broadcastPromise;return this._broadcastPromise=new Promise((D,B)=>{Promise.all(this._connection.broadcast("updateStyle",y)).then(D,B)})});return function(y){return m.apply(this,arguments)}}();l.setStyle=function(){var m=F._asyncToGenerator(function*(y,D){yield this._broadcastPromise;
this._styleRepository=y;const B=this._vectorTileLayer.sourceNameToSource,r=[];for(const z in B)r.push(this._fetchTileMap(B[z],null));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,null);this._spriteSourcePromise.then(z=>{this._spriteMosaic=new a(1024,1024,250);this._spriteMosaic.setSpriteSource(z)});y=new d(y.glyphs);this._glyphMosaic=new c(1024,1024,y);this._broadcastPromise=new Promise((z,I)=>{Promise.all(this._connection.broadcast("setStyle",{style:D,vectorTileLayerMaxBuffers:h("vectortilelayer-max-buffers")})).then(z,
I)});r.push(this._broadcastPromise);return Promise.all(r)});return function(y,D){return m.apply(this,arguments)}}();l.fetchTileData=function(m,y){return this._getRefKeys(m,y).then(D=>{const B=this._vectorTileLayer.sourceNameToSource,r=[];for(const z in B)r.push(z);return this._getSourcesData(r,D,y)})};l.parseTileData=function(m,y){const D=m&&m.data;if(!D)return Promise.resolve(null);const {sourceName2DataAndRefKey:B,transferList:r}=D;return 0===Object.keys(B).length?Promise.resolve(null):this._broadcastPromise.then(()=>
this._connection.getAvailableClient().then(z=>z.invoke("createTileAndParse",{key:m.key.id,sourceName2DataAndRefKey:B,styleLayerUIDs:m.styleLayerUIDs},{...y,transferList:r}).then(I=>({tileData:I}))))};l.getSprites=function(){var m=F._asyncToGenerator(function*(y){yield this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(y)});return function(y){return m.apply(this,arguments)}}();l.getGlyphs=function(m){return this._glyphMosaic.getGlyphItems(m.font,m.codePoints)};l.perfReport=function({key:m,
milliseconds:y}){k.perfAdd(m,y,"ms")};l._getTilePayload=function(){var m=F._asyncToGenerator(function*(y,D,B){y=u.pool.acquire(y.id);const r=this._vectorTileLayer.sourceNameToSource[D].getSourceTileUrl(y.level,y.row,y.col);u.pool.release(y);try{return{protobuff:yield this.request(r,B),sourceName:D}}catch(z){if(t.isAbortError(z))throw z;return{protobuff:null,sourceName:D}}});return function(y,D,B){return m.apply(this,arguments)}}();l.request=function(m,y){return x(m,{responseType:"array-buffer",...y}).then(({data:D})=>
D)};l._fetchTileMap=function(){var m=F._asyncToGenerator(function*(y,D){if(y.capabilities.operations.supportsTileMap&&y.tileIndex)return Promise.resolve();if(y.tileMapURL){var B=w.get(y.tileMapURL);if(B)y.tileIndex=B;else if(p.has(y.tileMapURL))try{var r=yield p.get(y.tileMapURL);y.tileIndex=new b(r.data)}catch(z){if(t.isAbortError(z))throw z;}else{D=x(y.tileMapURL,D);p.set(y.tileMapURL,D);try{r=yield D,p.delete(y.tileMapURL),w.put(y.tileMapURL,y.tileIndex),y.tileIndex=new b(r.data)}catch(z){if(p.delete(y.tileMapURL),
t.isAbortError(z))throw z;}}}});return function(y,D){return m.apply(this,arguments)}}();l._getRefKeys=function(m,y){const D=this._vectorTileLayer.sourceNameToSource,B=[];for(const r in D){const z=D[r].getRefKey(m,y);B.push(z)}return t.eachAlways(B)};l._getSourcesData=function(m,y,D){const B=[];for(let r=0;r<y.length;r++)if(null==y[r].value||null==m[r])B.push(null);else{const z=this._getTilePayload(y[r].value,m[r],D);B.push(z)}return t.eachAlways(B).then(r=>{const z={},I=[];for(let G=0;G<r.length;G++)r[G].value&&
r[G].value&&r[G].value.protobuff&&0<r[G].value.protobuff.byteLength&&(z[r[G].value.sourceName]={refKey:y[G].value.id,protobuff:r[G].value.protobuff},I.push(r[G].value.protobuff));return{sourceName2DataAndRefKey:z,transferList:I}})};F._createClass(g,[{key:"spriteMosaic",get:function(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}}]);return g}();A.TileHandler=q;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define("../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../../chunks/builtins ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject ./RectangleBinPack ../webgl/Rect".split(" "),
function(A,F,x,h,q,t,e,c,d,a,b,k){return function(){function u(p,g,l){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=p;this.height=g;this._glyphSource=l;this._binPack=new b(p-4,g-4);this._glyphData.push(new Uint8Array(p*g));this._dirties.push(!0);this._textures.push(void 0)}var w=u.prototype;w.getGlyphItems=function(p,g){const l=[],m=this._glyphSource,y=new Set,D=1/256;for(const r of g)y.add(Math.floor(r*
D));const B=[];y.forEach(r=>{if(256>=r){const z=p+r;this._rangePromises.has(z)?B.push(this._rangePromises.get(z)):(r=m.getRange(p,r).then(()=>{this._rangePromises["delete"](z)},()=>{this._rangePromises["delete"](z)}),this._rangePromises.set(z,r),B.push(r))}});return Promise.all(B).then(()=>{let r=this._glyphIndex[p];r||(r={},this._glyphIndex[p]=r);for(const M of g){var z=r[M];if(z){l[M]={sdf:!0,rect:z.rect,metrics:z.metrics,page:z.page,code:M};continue}var I=m.getGlyph(p,M);if(!I||!I.metrics)continue;
z=I.metrics;let L;if(0===z.width)L=new k(0,0,0,0);else{const O=z.width+6,S=z.height+6;var G=O%4?4-O%4:4,J=S%4?4-S%4:4;1===G&&(G=5);1===J&&(J=5);L=this._binPack.allocate(O+G,S+J);L.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new b(this.width-4,this.height-4),L=this._binPack.allocate(O+G,S+J));
G=this._glyphData[this._currentPage];I=I.bitmap;let T;if(I)for(let R=0;R<S;R++){J=O*R;T=this.width*(L.y+R+1)+L.x;for(let H=0;H<O;H++)G[T+H+1]=I[J+H]}}r[M]={rect:L,metrics:z,tileIDs:null,page:this._currentPage};l[M]={sdf:!0,rect:L,metrics:z,page:this._currentPage,code:M};this._dirties[this._currentPage]=!0}return l})};w.removeGlyphs=function(p){for(const g in this._glyphIndex){const l=this._glyphIndex[g];if(!l)continue;let m;for(const y in l)if(m=l[y],m.tileIDs["delete"](p),0===m.tileIDs.size){const D=
this._glyphData[m.page],B=m.rect;let r,z;for(let I=0;I<B.height;I++)for(r=this.width*(B.y+I)+B.x,z=0;z<B.width;z++)D[r+z]=0;delete l[y];this._dirties[m.page]=!0}}};w.bind=function(p,g,l,m=0){this._textures[l]||(this._textures[l]=new d(p,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));const y=this._textures[l];y.setSamplingMode(g);this._dirties[l]&&y.setData(this._glyphData[l]);p.bindTexture(y,m);this._dirties[l]=!1};w.dispose=function(){this._binPack=
null;for(const p of this._textures)p&&p.dispose();this._textures.length=0};return u}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../webgl/Rect"],function(A,F){return function(){function x(q,t){this._height=this._width=0;this._free=[];this._width=q;this._height=t;this._free.push(new F(0,0,q,t))}var h=x.prototype;h.allocate=function(q,t){if(q>this._width||t>this._height)return new F;let e=null,c=-1;for(let d=0;d<this._free.length;++d){const a=
this._free[d];q<=a.width&&t<=a.height&&(null===e||a.y<=e.y&&a.x<=e.x)&&(e=a,c=d)}if(null===e)return new F;this._free.splice(c,1);e.width<e.height?(e.width>q&&this._free.push(new F(e.x+q,e.y,e.width-q,t)),e.height>t&&this._free.push(new F(e.x,e.y+t,e.width,e.height-t))):(e.width>q&&this._free.push(new F(e.x+q,e.y,e.width-q,e.height)),e.height>t&&this._free.push(new F(e.x,e.y+t,q,e.height-t)));return new F(e.x,e.y,q,t)};h.release=function(q){for(let t=0;t<this._free.length;++t){const e=this._free[t];
if(e.y===q.y&&e.height===q.height&&e.x+e.width===q.x)e.width+=q.width;else if(e.x===q.x&&e.width===q.width&&e.y+e.height===q.y)e.height+=q.height;else if(q.y===e.y&&q.height===e.height&&q.x+q.width===e.x)e.x=q.x,e.width+=q.width;else if(q.x===e.x&&q.width===e.width&&q.y+q.height===e.y)e.y=q.y,e.height+=q.height;else continue;this._free.splice(t,1);this.release(q)}this._free.push(q)};A._createClass(x,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);
return x}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(A,F){let x=function(){function q(e){this._metrics=[];this._bitmaps=[];if(e)for(;e.next();)switch(e.tag()){case 1:{const c=e.getMessage();for(;c.next();)switch(c.tag()){case 3:{const d=c.getMessage();let a,b,k,u,w,p,g;for(;d.next();)switch(d.tag()){case 1:a=d.getUInt32();break;case 2:b=d.getBytes();break;case 3:k=d.getUInt32();break;case 4:u=d.getUInt32();break;case 5:w=
d.getSInt32();break;case 6:p=d.getSInt32();break;case 7:g=d.getUInt32();break;default:d.skip()}d.release();a&&(this._metrics[a]={width:k,height:u,left:w,top:p,advance:g},this._bitmaps[a]=b);break}default:c.skip()}c.release();break}default:e.skip()}}var t=q.prototype;t.getMetrics=function(e){return this._metrics[e]};t.getBitmap=function(e){return this._bitmaps[e]};return q}(),h=function(){function q(){this._ranges=[]}var t=q.prototype;t.getRange=function(e){return this._ranges[e]};t.addRange=function(e,
c){this._ranges[e]=c};return q}();return function(){function q(e){this._glyphInfo={};this._baseURL=e}var t=q.prototype;t.getRange=function(e,c){const d=this._getFontStack(e);if(d.getRange(c))return Promise.resolve();const a=256*c,b=a+255;e=this._baseURL.replace("{fontstack}",e).replace("{range}",a+"-"+b);return A(e,{responseType:"array-buffer"}).then(k=>{d.addRange(c,new x(new F(new Uint8Array(k.data),new DataView(k.data))))}).catch(()=>{d.addRange(c,new x)})};t.getGlyph=function(e,c){if(e=this._getFontStack(e)){var d=
Math.floor(c/256);if(!(256<d)&&(e=e.getRange(d)))return{metrics:e.getMetrics(c),bitmap:e.getBitmap(c)}}};t._getFontStack=function(e){let c=this._glyphInfo[e];c||(c=this._glyphInfo[e]=new h);return c};return q}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../../symbols/cim/CIMSymbolHelper ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../../chunks/builtins ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject ./RectangleBinPack ../webgl/Rect".split(" "),
function(A,F,x,h,q,t,e,c,d,a,b,k,u){return function(){function w(g,l,m=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=g||0>=l)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=g;this._pageHeight=l;0<m&&(this._maxItemSize=m);this._binPack=new k(g-4,l-4)}var p=w.prototype;p.dispose=function(){this._binPack=
null;this._mosaicRects={};for(const g of this._textures)g&&g.dispose();this._textures.length=0};p.getWidth=function(g){return g>=this._size.length?-1:this._size[g][0]};p.getHeight=function(g){return g>=this._size.length?-1:this._size[g][1]};p.getPageSize=function(g){return g>=this._size.length?null:this._size[g]};p.setSpriteSource=function(g){this.dispose();this.pixelRatio=g.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new k(this._pageWidth-4,this._pageHeight-4);const l=new Uint32Array(Math.floor(this._pageWidth)*
Math.floor(this._pageHeight));this._mosaicsData[0]=l;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=g};p.getSpriteItem=function(g,l=!1){var m=this._mosaicRects[g];if(m)return m;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let y;g&&g.startsWith("dasharray-")?([m,y]=this._rasterizeDash(g),l=!0):m=this._sprites.getSpriteInfo(g);if(!m||!m.width||!m.height||0>m.width||0>m.height)return null;const D=m.width,B=m.height,
[r,z,I]=this._allocateImage(D,B);if(0>=r.width)return null;this._copy(r,m,z,I,l,y);m={rect:r,width:D,height:B,sdf:m.sdf,simplePattern:!1,pixelRatio:m.pixelRatio,page:z};return this._mosaicRects[g]=m};p.getSpriteItems=function(g){const l={};for(const m of g)l[m.name]=this.getSpriteItem(m.name,m.repeat);return l};p.getMosaicItemPosition=function(g,l){l=(g=this.getSpriteItem(g,l))&&g.rect;if(!l)return null;l.width=g.width;l.height=g.height;return{tl:[l.x+2,l.y+2],br:[l.x+2+g.width,l.y+2+g.height],page:g.page}};
p.bind=function(g,l,m=0,y=0){this._textures[m]||(this._textures[m]=new a(g,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[m][0],height:this._size[m][1]},new Uint8Array(this._mosaicsData[m].buffer)));const D=this._textures[m];D.setSamplingMode(l);this._dirties[m]&&D.setData(new Uint8Array(this._mosaicsData[m].buffer));g.bindTexture(D,y);this._dirties[m]=!1};w._copyBits=function(g,l,m,y,D,B,r,z,I,G,J){let M=y*l+m;r=z*B+r;if(J)for(r-=B,J=-1;J<=G;J++,M=((J+G)%G+y)*l+m,r+=B)for(z=-1;z<=
I;z++)D[r+z]=g[M+(z+I)%I];else for(m=0;m<G;m++){for(y=0;y<I;y++)D[r+y]=g[M+y];M+=l;r+=B}};p._copy=function(g,l,m,y,D,B){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(m>=this._mosaicsData.length)){var r=new Uint32Array(B?B.buffer:this._sprites.image.buffer),z=this._mosaicsData[m];z&&r||console.error("Source or target images are uninitialized!");w._copyBits(r,B?l.width:this._sprites.width,l.x,l.y,z,y[0],g.x+2,g.y+2,l.width,l.height,D);this._dirties[m]=!0}};p._allocateImage=function(g,l){g+=
2;l+=2;var m=Math.max(g,l);if(this._maxItemSize&&this._maxItemSize<m)return m=new u(0,0,g,l),this._mosaicsData.push(new Uint32Array(g*l)),this._dirties.push(!0),this._size.push([g,l]),this._textures.push(void 0),[m,this._mosaicsData.length-1,[g,l]];m=g%4?4-g%4:4;let y=l%4?4-l%4:4;1===m&&(m=5);1===y&&(y=5);m=this._binPack.allocate(g+m,l+y);return 0>=m.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*
this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new k(this._pageWidth-4,this._pageHeight-4),this._allocateImage(g,l)):[m,this._currentPage,[this._pageWidth,this._pageHeight]]};p._rasterizeDash=function(g){var l=g.match(/\[(.*?)\]/);if(!l)return null;l=l[1].split(",").map(Number);g=g.slice(g.lastIndexOf("-")+1);const [m,y,D]=A.SymbolHelper.rasterizeDash(l,g);g=new Uint8Array(m.buffer);return[{x:0,y:0,width:y,height:D,
sdf:!0,pixelRatio:1},g]};return w}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(A,F,x){return function(){function h(t){if(t instanceof F.TilemapCache)this._tilemapCache=t;else if(t&&"index"in t)this._tilemap=t.index;else throw Error("Invalid tilemap!");}var q=h.prototype;q.dataKey=function(t,e){if(this._tilemapCache){const {level:c,row:d,col:a}=t,b=new x(t);return this._tilemapCache.fetchAvailabilityUpsample(c,
d,a,b,e).then(()=>{b.world=t.world;return b}).catch(k=>{if(A.isAbortError(k))throw k;return null})}return this._getIndexedDataKey(t)};q.forEach=function(t,e,c,d,a){this._callback=a;this._maxLevel=e+t;this._forEach(this._tilemap,e,c,d)};q._forEach=function(t,e,c,d){0!==t&&(this._callback(e,c,d),e!==this._maxLevel&&"object"===typeof t&&(this._forEach(t[0],e+1,2*c,2*d),this._forEach(t[1],e+1,2*c,2*d+1),this._forEach(t[2],e+1,2*c+1,2*d),this._forEach(t[3],e+1,2*c+1,2*d+1)))};q._getIndexedDataKey=function(t){const e=
[t];if(0>t.level||0>t.row||0>t.col||0<t.row>>t.level||0<t.col>>t.level)return Promise.resolve(null);for(;0!==t.level;)t=new x(t.level-1,t.row>>1,t.col>>1,t.world),e.push(t);t=this._tilemap;let c=e.pop(),d,a;if(1===t)return Promise.resolve(c);for(;e.length;)if(d=e.pop(),a=(d.col&1)+((d.row&1)<<1),t){if(0===t[a]){c=null;break}if(1===t[a]){c=d;break}c=d;t=t[a]}return Promise.resolve(c)};return h}()})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./Tilemap".split(" "),
function(A,F,x,h,q,t,e,c,d,a,b,k,u,w,p,g,l,m,y){var D;const B=c.getLogger("esri.layers.support.TilemapCache");A.TilemapCache=D=function(r){function z(G){G=r.call(this,G)||this;G._handles=new e;G._pendingTilemapRequests={};G._availableLevels={};G.levels=5;G.cacheByteSize=2097152;G.request=h;G._prefetchingEnabled=!0;return G}F._inheritsLoose(z,r);var I=z.prototype;I.initialize=function(){this._tilemapCache=new d(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],
()=>this._initializeTilemapDefinition()),w.init(this,"layer.tileInfo.lods",G=>this._initializeAvailableLevels(G),!0)]);this._initializeTilemapDefinition()};I.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};I.castLevels=function(G){return 2>=G?(B.error("Minimum levels for Tilemap is 3, but got ",G),3):G};I.fetchTilemap=function(G,J,M,L){if(!this._availableLevels[G])return Promise.reject(new t("tilemap-cache:level-unavailable",`Level ${G} is unavailable in the service`));
const O=this._tmpTilemapDefinition;if(G=this._tilemapFromCache(G,J,M,O))return Promise.resolve(G);const S=L&&L.signal;L={...L,signal:null};return new Promise((T,R)=>{b.onAbort(S,()=>R(b.createAbortError()));const H=y.tilemapDefinitionId(O);let N=this._pendingTilemapRequests[H];if(!N){N=y.Tilemap.fromDefinition(O,L).then(V=>{this._tilemapCache.put(H,V,V.byteSize);return V});const P=()=>delete this._pendingTilemapRequests[H];this._pendingTilemapRequests[H]=N;N.then(P,P)}N.then(T,R)})};I.getAvailability=
function(G,J,M){return this._availableLevels[G]?(G=this._tilemapFromCache(G,J,M,this._tmpTilemapDefinition))?G.getAvailability(J,M):"unknown":"unavailable"};I.getAvailabilityUpsample=function(G,J,M,L){L.level=G;L.row=J;L.col=M;G=this.layer.tileInfo;for(G.updateTileInfo(L);;)if(J=this.getAvailability(L.level,L.row,L.col),"unavailable"===J){if(!G.upsampleTile(L))return"unavailable"}else return J};I.fetchAvailability=function(G,J,M,L){return this._availableLevels[G]?this.fetchTilemap(G,J,M,L).catch(O=>
O).then(O=>{if(O instanceof y.Tilemap)return O=O.getAvailability(J,M),"unavailable"===O?Promise.reject(new t("tile-map:tile-unavailable","Tile is not available",{level:G,row:J,col:M})):O;if(b.isAbortError(O))throw O;return"unknown"}):Promise.reject(new t("tilemap-cache:level-unavailable",`Level ${G} is unavailable in the service`))};I.fetchAvailabilityUpsample=function(G,J,M,L,O){L.level=G;L.row=J;L.col=M;const S=this.layer.tileInfo;S.updateTileInfo(L);const T=this.fetchAvailability(G,J,M,O).catch(R=>
{if(b.isAbortError(R))throw R;if(S.upsampleTile(L))return this.fetchAvailabilityUpsample(L.level,L.row,L.col,L);throw R;});this._fetchAvailabilityUpsamplePrefetch(L.id,G,J,M,O,T);return T};I._fetchAvailabilityUpsamplePrefetch=function(){var G=F._asyncToGenerator(function*(J,M,L,O,S,T){if(this._prefetchingEnabled){var R=`prefetch-${J}`;if(!this._handles.has(R)){var H=b.createAbortController();T.then(()=>H.abort(),()=>H.abort());var N=!1;this._handles.add({remove(){N||(N=!0,H.abort())}},R);yield k.waitTicks(10,
H.signal).catch(()=>{});N||(N=!0,this._handles.remove(R));if(!b.isAborted(H))for(J={id:J,level:M,row:L,col:O},S={...S,signal:H.signal},M=this.layer.tileInfo,L=0;D._prefetches.length<D._maxPrefetch&&M.upsampleTile(J);++L){const P=this.fetchAvailability(J.level,J.row,J.col,S);D._prefetches.push(P);O=()=>{D._prefetches.removeUnordered(P)};P.then(O,O)}}}});return function(J,M,L,O,S,T){return G.apply(this,arguments)}}();I._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var G=this.layer.parsedUrl,
J=G.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:G.path,query:J?u.objectToQuery(J):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};I._tilemapFromCache=function(G,J,M,L){L.level=G;L.row=J-J%this.size;L.col=M-M%this.size;G=y.tilemapDefinitionId(L);return this._tilemapCache.get(G)};I._initializeAvailableLevels=function(G){this._availableLevels={};G&&G.forEach(J=>this._availableLevels[J.level]=
!0)};F._createClass(z,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const G=this;return{get prefetchingEnabled(){return G._prefetchingEnabled},set prefetchingEnabled(J){G._prefetchingEnabled=J},hasTilemap(J,M,L){return!!G._tilemapFromCache(J,M,L,G._tmpTilemapDefinition)}}}}]);return z}(q);A.TilemapCache._maxPrefetch=4;A.TilemapCache._prefetches=new a({initialSize:D._maxPrefetch});x.__decorate([p.property({constructOnly:!0,type:Number})],A.TilemapCache.prototype,"levels",
void 0);x.__decorate([l.cast("levels")],A.TilemapCache.prototype,"castLevels",null);x.__decorate([p.property({readOnly:!0,type:Number})],A.TilemapCache.prototype,"size",null);x.__decorate([p.property({constructOnly:!0,type:Number})],A.TilemapCache.prototype,"cacheByteSize",void 0);x.__decorate([p.property({constructOnly:!0})],A.TilemapCache.prototype,"layer",void 0);x.__decorate([p.property({constructOnly:!0})],A.TilemapCache.prototype,"request",void 0);A.TilemapCache=D=x.__decorate([m.subclass("esri.layers.support.TilemapCache")],
A.TilemapCache);Object.defineProperty(A,"__esModule",{value:!0})})},"esri/layers/support/Tilemap":function(){define(["exports","../../request","../../core/arrayUtils","../../core/Error","../../core/lang"],function(A,F,x,h,q){function t(c){if("vector-tile"===c.service.type)var d=`${c.service.url}/tilemap/${c.level}/${c.row}/${c.col}/${c.width}/${c.height}`;else d=c.service.tileServers,d=`${d&&d.length?d[c.row%d.length]:c.service.url}/tilemap/${c.level}/${c.row}/${c.col}/${c.width}/${c.height}`;(c=
c.service.query)&&(d=`${d}?${c}`);return d}let e=function(){function c(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var d=c.prototype;d.getAvailability=function(a,b){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(b-this.location.left);b=a>>3;const k=this._tileAvailabilityBitSet;return 0>b||b>k.length?"unknown":k[b]&1<<a%8?"available":"unavailable"};d._updateFromData=function(a){let b=
!0,k=!0;const u=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));let w=0;for(let p=0;p<a.length;p++){const g=p%8;a[p]?(k=!1,u[w]|=1<<g):b=!1;7===g&&++w}k?this._allAvailability="unavailable":b?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=u,this.byteSize+=u.length)};c.fromDefinition=function(a,b){const k=a.service.request||F,{row:u,col:w,width:p,height:g}=a,l={query:{f:"json"}};b=b?{...l,...b}:l;return k(t(a),b).then(m=>m.data).catch(m=>
{if(m&&m.details&&422===m.details.httpStatus)return{location:{top:u,left:w,width:p,height:g},valid:!0,data:x.constant(p*g,0)};throw m;}).then(m=>{if(m.location&&(m.location.top!==u||m.location.left!==w||m.location.width!==p||m.location.height!==g))throw new h("tilemap:location-mismatch","Tilemap response for different location than requested",{response:m,definition:{top:u,left:w,width:p,height:g}});return c.fromJSON(m)})};c.fromJSON=function(a){c.validateJSON(a);const b=new c;b.location=Object.freeze(q.clone(a.location));
b._updateFromData(a.data);return Object.freeze(b)};c.validateJSON=function(a){if(!a||!a.location)throw new h("tilemap:missing-location","Location missing from tilemap response");if(!1===a.valid)throw new h("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new h("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new h("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new h("tilemap:data-mismatch",
"Number of data items does not match width/height of tilemap");};return c}();A.Tilemap=e;A["default"]=e;A.tilemapDefinitionId=function(c){return`${c.level}/${c.row}/${c.col}/${c.width}/${c.height}`};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/debugging":function(){define(["exports"],function(A){function F(x,h){return`${Math.round(10*x)/10}${h}`}A.drawColliders=function(x,h){const q=window.COLLISION_XRAY;for(let u=0;u<h.length;++u){const w=!h[u].unique.show;
if(q||!w)for(const p of h[u].colliders){if(!p.enabled)continue;var t=!h[u].unique.parts[p.partIndex].show;if(!q&&t)continue;var e=p.xScreen,c=p.yScreen;const g=p.dxScreen,l=p.dyScreen;x.globalAlpha=w||t?.2:1;t=x;var d=e-1,a=c-1;t.fillStyle="green";t.fillRect(d,a,3,3);t=x;d=e+g;a=c+l;var b=p.width,k=p.height;t.strokeStyle="red";t.strokeRect(d,a,b,k);t=x;e=e+g-1;c=c+l-1;t.fillStyle="blue";t.fillRect(e,c,3,3);x.globalAlpha=1}}};A.drawGridIndex=function(x,h){x.strokeStyle="black";const q=h.cellSize,t=
h.rows,e=h.columns;for(let c=0;c<t;c++){const d=h.cells[c],a=c*q,b=(c+1)*q;for(let k=0;k<e;k++){const u=d[k],w=k*q;x.strokeRect(w,a,(k+1)*q-w,b-a);x.fillText(`cells:${u.length}`,w+4,a+12)}}};A.perfAdd=function(x,h,q){if(window.PERFORMANCE_RECORDING_STORAGE){var t=window.PERFORMANCE_RECORDING_STORAGE;t.perf=t.perf||{};t=t.perf;t[x]=t[x]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:q};t[x].time+=h;t[x].samples.push(h);if(null==t[x].min||h<t[x].min)t[x].min=h;if(null==t[x].max||h>t[x].max)t[x].max=
h}};A.perfClear=function(){window.PERFORMANCE_RECORDING_STORAGE&&(window.PERFORMANCE_RECORDING_STORAGE.perf={})};A.perfElement=function(x){if(!window.PERFORMANCE_RECORDING_STORAGE){var h=document.createElement("div");h.innerHTML="No recorded data is present because performance recording is disabled.";return h}h=document.createElement("div");var q=window.PERFORMANCE_RECORDING_STORAGE.perf;var t='\x3ctable style\x3d"border-collapse: collapse;"\x3e'+`<tr style="text-weight: bold; border-bottom: 1px solid "${x}";"><td>Name</td><td>Total</td><td>Runs</td><td>Average</td><td>Min</td><td>Distribution</td><td>Max</td><td>Histogram (${50} bins)</td></tr>`;
const e=[];for(var c in q)e.push({name:c,value:q[c].time/q[c].samples.length,sortkey:q[c].max});e.sort((w,p)=>-(w.sortkey-p.sortkey));c=e.map(w=>w.name);for(var d of c)t+="\x3ctr\x3e",t+=`<td>${d}</td>`,t+=`<td>${F(q[d].time,q[d].unit)}</td>`,t+=`<td>${q[d].samples.length}</td>`,t+=`<td>${F(q[d].time/q[d].samples.length,q[d].unit)}</td>`,t+=`<td style="text-align: right;">${F(q[d].min,q[d].unit)}</td>`,t+="\x3ctd data-distribution\x3d'1'\x3e\x3c/td\x3e",t+=`<td>${F(q[d].max,q[d].unit)}</td>`,t+="\x3ctd data-histogram\x3d'1'\x3e\x3c/td\x3e",
t+="\x3c/tr\x3e";h.innerHTML=t+"\x3ctable\x3e";t=h.querySelectorAll("td[data-distribution\x3d'1']");d=h.querySelectorAll("td[data-histogram\x3d'1']");for(let w=0;w<t.length;w++){let p=t[w];var a=document.createElement("canvas");a.height=10;a.width=100;var b=a.getContext("2d");b.strokeStyle=x;b.beginPath();b.moveTo(0,5);b.lineTo(100,5);if(q[c[w]].max>q[c[w]].min+.001)for(const g of q[c[w]].samples){var k=(g-q[c[w]].min)/(q[c[w]].max-q[c[w]].min);b.moveTo(100*k,3);b.lineTo(100*k,7)}b.stroke();b.strokeRect((e[w].value-
q[c[w]].min)/(q[c[w]].max-q[c[w]].min)*100-2,0,4,9);p.appendChild(a);p=d[w];{a=Array(50);for(b=0;b<a.length;b++)a[b]=0;for(const l of q[c[w]].samples)b=(l-q[c[w]].min)/(q[c[w]].max-q[c[w]].min),a[1===b?a.length-1:Math.floor(b*a.length)]++;b=document.createElement("canvas");b.height=30;b.width=120;k=b.getContext("2d");k.strokeStyle=x;k.fillStyle=x;let g=0;for(var u=0;u<a.length;u++)g=Math.max(g,a[u]);for(u=0;u<a.length;u++){const l=a[u];k.fillRect(u*b.width/a.length,b.height*(1-l/g),b.width/a.length,
l/g*b.height)}k.beginPath();k.moveTo(0,b.height);k.lineTo(b.width,b.height);k.stroke();p.appendChild(b)}}x=h.querySelectorAll("td");for(q=0;q<x.length;q++)x[q].style.padding="5px";return h};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/LRUCache","../../../../core/maybe","../../tiling/TileCoverage","../../tiling/TileKey"],function(A,F,x,h,q){const t=(c,d)=>c+1/(1<<2*d);let e=function(){function c(a,
b){this._tiles=new Map;this._tileCache=new F(40,k=>k.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=a.acquireTile;this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;this._container=b}var d=c.prototype;d.destroy=function(){for(const [,a]of this._tiles)a.dispose();this._tiles=null;this._tileCache.clear();this._tileCache=null};d.update=function(a){this._updateCacheSize(a);const b=this.tileInfoView;a=b.getTileCoverage(a.state,0,"smallest");const {spans:k,lodInfo:u}=
a,{level:w}=u,p=this._tiles,g=new Set,l=new Set;for(const {row:y,colFrom:D,colTo:B}of k)for(let r=D;r<=B;r++){const z=q.getId(w,y,u.normalizeCol(r),u.getWorldForColumn(r)),I=this._getOrAcquireTile(z);g.add(z);I.processed()?this._addToContainer(I):l.add(new q(z))}for(const [y,D]of p)D.isCoverage=g.has(y);for(var m of l)this._findPlaceholdersForMissingTiles(m,g);m=!1;for(const [y,D]of p)D.neededForCoverage=g.has(y),D.neededForCoverage||D.isHoldingForFade&&b.intersects(a,D.key)&&g.add(y),D.isFading&&
(m=!0);for(const [y]of this._tiles)g.has(y)||this._releaseTile(y);h.pool.release(a);return!m};d.clear=function(){this._tiles.clear();this._tileCache.clear();this._visibleTiles.clear()};d.clearCache=function(){this._tileCache.clear()};d._findPlaceholdersForMissingTiles=function(a,b){var k=[];for(const [,u]of this._tiles)this._addPlaceholderChild(k,u,a,b);k=k.reduce(t,0);1E-6>Math.abs(1-k)||this._addPlaceholderParent(a.id,b)};d._addPlaceholderChild=function(a,b,k,u){if(!(b.key.level<=k.level)&&b.hasData()){{var w=
b.key;const p=w.level-k.level;w=k.row===w.row>>p&&k.col===w.col>>p&&k.world===w.world}w&&(this._addToContainer(b),u.add(b.id),a.push(b.key.level-k.level))}};d._addPlaceholderParent=function(a,b){const k=this._tiles;for(;;){{const [w,p,g,l]=a.split("/");a=parseInt(w,10);a=0===a?null:`${a-1}/${parseInt(p,10)>>1}/${parseInt(g,10)>>1}/${parseInt(l,10)}`}if(!a||b.has(a))break;const u=k.get(a);if(u&&u.hasData()){this._addToContainer(u);b.add(u.id);break}}};d._getOrAcquireTile=function(a){let b=this._tiles.get(a);
if(b)return b;(b=this._tileCache.pop(a))||(b=this.acquireTile(new q(a)));this._tiles.set(a,b);return b};d._releaseTile=function(a){const b=this._tiles.get(a);this.releaseTile(b);this._removeFromContainer(b);this._tiles.delete(a);b.hasData()?this._tileCache.put(a,b,1):b.dispose()};d._addToContainer=function(a){let b;const k=[],u=this._container;if(!u.contains(a)){var w=this._visibleTiles;for(const [,p]of w)this._canConnectDirectly(a,p)&&k.push(p),x.isNone(b)&&this._canConnectDirectly(p,a)&&(b=p);if(x.isSome(b)){for(const p of k)b.childrenTiles.delete(p),
a.childrenTiles.add(p),p.parentTile=a;b.childrenTiles.add(a);a.parentTile=b}else for(const p of k)a.childrenTiles.add(p),p.parentTile=a;w.set(a.id,a);u.addChild(a)}};d._removeFromContainer=function(a){this._visibleTiles.delete(a.id);this._container.removeChild(a);if(x.isSome(a.parentTile)){a.parentTile.childrenTiles.delete(a);for(const b of a.childrenTiles)x.isSome(a.parentTile)&&a.parentTile.childrenTiles.add(b)}for(const b of a.childrenTiles)b.parentTile=a.parentTile;a.parentTile=null;a.childrenTiles.clear()};
d._canConnectDirectly=function(a,b){a=a.key;let {level:k,row:u,col:w,world:p}=b.key;for(b=this._visibleTiles;0<k;){k--;u>>=1;w>>=1;if(a.level===k&&a.row===u&&a.col===w&&a.world===p)return!0;if(b.has(`${k}/${u}/${w}/${p}`))break}return!1};d._updateCacheSize=function(a){a=a.state.size;if(a[0]!==this._viewSize[0]||a[1]!==this._viewSize[1]){var b=Math.ceil(a[0]/512)+1,k=Math.ceil(a[1]/512)+1;this._viewSize[0]=a[0];this._viewSize[1]=a[1];this._tileCache.maxSize=5*b*k}};return c}();A.TileManager=e;Object.defineProperty(A,
"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(A,F,x,h,q,t,e,c){c=function(a){function b(u,w,p,g,l,m,y=null){w=a.call(this,u,w,p,g,l,4096,4096)||this;w._memCache=y;w.type="vector-tile";w._referenced=0;w._hasSymbolBuckets=!1;w._memoryUsedByLayerData=
0;w.layerData=new Map;w.layerCount=0;w.status="loading";w.allSymbolsFadingOut=!1;w.lastOpacityUpdate=0;w.symbols=new Map;w.isCoverage=!1;w.neededForCoverage=!1;w.decluttered=!1;w.invalidating=!1;w.parentTile=null;w.childrenTiles=new Set;w._processed=!1;w._referenced=1;w.styleRepository=m;w.id=u.id;return w}F._inheritsLoose(b,a);var k=b.prototype;k.setData=function(u){this.changeDataImpl(u);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};k.deleteLayerData=function(u){let w=
!1;for(const p of u)this.layerData.has(p)&&(u=this.layerData.get(p),this._memoryUsedByLayerData-=u.memoryUsed,3===u.type&&this.symbols.has(p)&&(this.symbols.delete(p),w=!0),u.destroy(),this.layerData.delete(p),this.layerCount--);x.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData);w&&this.emit("symbols-changed");this.requestRender()};k.processed=function(){return this._processed};k.hasData=function(){return 0<this.layerCount};k.dispose=function(){"unloaded"!==
this.status&&(d.delete(this),b._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};k.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};k.retain=function(){++this._referenced};k.changeDataImpl=function(u){let w=!1;if(u){u=this._createRenderBuckets(u);for(const [p,g]of u)this.layerData.has(p)&&(u=this.layerData.get(p),this._memoryUsedByLayerData-=g.memoryUsed,u.destroy(),
this.layerData.delete(p),this.layerCount--),3===g.type&&(this.symbols.set(p,g.symbols),w=!0),this._memoryUsedByLayerData+=g.memoryUsed,this.layerData.set(p,g),this.layerCount++;x.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const [,p]of this.layerData)3===p.type&&(this._hasSymbolBuckets=!0);w&&this.emit("symbols-changed")};k.attachWithContext=function(u){this.stage={context:u,trashDisplayObject(w){w.processDetach()},
untrashDisplayObject(){return!1}}};k.setTransform=function(u,w){a.prototype.setTransform.call(this,u,w);var p=w/(u.resolution*u.pixelRatio);w=this.width/this.rangeX*p;p*=this.height/this.rangeY;const g=[0,0];u.toScreen(g,[this.x,this.y]);const l=this.transforms.tileUnitsToPixels;h.identity(l);h.translate(l,l,g);h.rotate(l,l,Math.PI*u.rotation/180);h.scale(l,l,[w,p,1])};k._createTransforms=function(){return{dvs:q.create(),tileMat3:q.create(),tileUnitsToPixels:q.create()}};b._destroyRenderBuckets=function(u){if(u){var w=
new Set;u.forEach(p=>{w.has(p)||(p.destroy(),w.add(p))});u.clear()}};k._createRenderBuckets=function(u){const w=new Map,p=new Map;for(const g of u){u=this._deserializeBucket(g,p);for(const l of u.layerUIDs)w.set(l,u)}return w};k._deserializeBucket=function(u,w){let p=w.get(u);if(p)return p;switch((new Uint32Array(u))[0]){case 1:p=new t.FillRenderBucket(u,this.styleRepository);break;case 2:p=new t.LineRenderBucket(u,this.styleRepository);break;case 3:p=new t.SymbolRenderBucket(u,this.styleRepository,
this);break;case 4:p=new t.CircleRenderBucket(u,this.styleRepository)}w.set(u,p);return p};F._createClass(b,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<e.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<e.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===
this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return b}(c.TiledDisplayObject);const d=new Map;A.VectorTile=c;A.printAllocations=function(){d.forEach((a,b)=>{console.log(`\n${b.key}:`);a[0].forEach(k=>console.log(k));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");a[1].forEach(k=>console.log(k))})};Object.defineProperty(A,
"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../../chunks/builtins ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject ./decluttering/util".split(" "),function(A,F,x,h,q,t,e,c,d,a,b,k,u){q=function(){function w(g,
l){this.layerUIDs=[];this.isDestroyed=!1;this.data=g;this.memoryUsed=g.byteLength;let m=1;g=new Uint32Array(g);this.layerUIDs=[];const y=g[m++];for(let D=0;D<y;D++)this.layerUIDs[D]=g[m++];this.bufferDataOffset=m;l&&(this.layer=l.getStyleLayerByUID(this.layerUIDs[0]))}var p=w.prototype;p.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};p.prepareForRendering=function(g){x.isNone(this.data)||(this.doPrepareForRendering(g,this.data,this.bufferDataOffset),this.data=null)};
F._createClass(w,[{key:"isPreparedForRendering",get:function(){return x.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return w}();t=function(w){function p(l,m){m=w.call(this,l,m)||this;m.type=2;m.lineIndexStart=0;m.lineIndexCount=0;l=new Uint32Array(l);let y=m.bufferDataOffset;m.lineIndexStart=l[y++];m.lineIndexCount=l[y++];const D=l[y++];if(0<D){const B=new Map;for(let r=0;r<D;r++){const z=l[y++],I=l[y++],G=l[y++];B.set(z,[I,G])}m.patternMap=B}m.bufferDataOffset=
y;return m}F._inheritsLoose(p,w);var g=p.prototype;g.hasData=function(){return 0<this.lineIndexCount};g.triangleCount=function(){return this.lineIndexCount/3};g.doDestroy=function(){x.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();x.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();x.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};g.doPrepareForRendering=
function(l,m,y){m=new Uint32Array(m);var D=new Int32Array(m.buffer);const B=m[y++];this.lineVertexBuffer=h.createVertex(l,35044,new Int32Array(D.buffer,4*y,B));y+=B;D=m[y++];this.lineIndexBuffer=h.createIndex(l,35044,new Uint32Array(m.buffer,4*y,D));y+=D;y=this.layer.lineMaterial;this.lineVertexArrayObject=new k(l,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return p}(q);e=function(w){function p(l,m){m=w.call(this,l,m)||this;m.type=1;m.fillIndexStart=
0;m.fillIndexCount=0;m.outlineIndexStart=0;m.outlineIndexCount=0;l=new Uint32Array(l);let y=m.bufferDataOffset;m.fillIndexStart=l[y++];m.fillIndexCount=l[y++];m.outlineIndexStart=l[y++];m.outlineIndexCount=l[y++];const D=l[y++];if(0<D){const B=new Map;for(let r=0;r<D;r++){const z=l[y++],I=l[y++],G=l[y++];B.set(z,[I,G])}m.patternMap=B}m.bufferDataOffset=y;return m}F._inheritsLoose(p,w);var g=p.prototype;g.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};g.triangleCount=function(){return(this.fillIndexCount+
this.outlineIndexCount)/3};g.doDestroy=function(){x.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();x.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();x.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;x.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();x.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();x.isSome(this.outlineIndexBuffer)&&
this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};g.doPrepareForRendering=function(l,m,y){m=new Uint32Array(m);var D=new Int32Array(m.buffer),B=m[y++];this.fillVertexBuffer=h.createVertex(l,35044,new Int32Array(D.buffer,4*y,B));y+=B;B=m[y++];this.fillIndexBuffer=h.createIndex(l,35044,new Uint32Array(m.buffer,4*y,B));y+=B;B=m[y++];this.outlineVertexBuffer=h.createVertex(l,35044,new Int32Array(D.buffer,4*y,B));y+=
B;D=m[y++];this.outlineIndexBuffer=h.createIndex(l,35044,new Uint32Array(m.buffer,4*y,D));y+=D;m=this.layer;y=m.fillMaterial;m=m.outlineMaterial;this.fillVertexArrayObject=new k(l,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new k(l,m.getAttributeLocations(),m.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return p}(q);c=function(w){function p(l,m,y){m=w.call(this,l,m)||this;m.type=3;
m.iconPerPageElementsMap=new Map;m.glyphPerPageElementsMap=new Map;m.symbolInstances=[];m.isIconSDF=!1;m.opacityChanged=!1;m.lastOpacityUpdate=0;m.symbols=[];const D=new Uint32Array(l),B=new Int32Array(l);l=new Float32Array(l);let r=m.bufferDataOffset;m.isIconSDF=!!D[r++];var z=D[r++];for(var I=0;I<z;I++){var G=D[r++],J=D[r++],M=D[r++];m.iconPerPageElementsMap.set(G,[J,M])}z=D[r++];for(I=0;I<z;I++)G=D[r++],J=D[r++],M=D[r++],m.glyphPerPageElementsMap.set(G,[J,M]);z=D[r++];I=D[r++];m.iconOpacity=new Int32Array(z);
m.textOpacity=new Int32Array(I);r=u.deserializeSymbols(D,B,l,r,m.symbols,y);m.bufferDataOffset=r;return m}F._inheritsLoose(p,w);var g=p.prototype;g.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};g.triangleCount=function(){let l=0;for(const [,m]of this.iconPerPageElementsMap)l+=m[1];for(const [,m]of this.glyphPerPageElementsMap)l+=m[1];return l/3};g.doDestroy=function(){x.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();x.isSome(this.iconVertexBuffer)&&
this.iconVertexBuffer.dispose();x.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();x.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;x.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();x.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();x.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();x.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();
this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};g.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var l=x.unwrap(this.iconOpacity),m=x.unwrap(this.iconOpacityBuffer);0<l.length&&l.byteLength===m.size&&m.setSubData(l);l=x.unwrap(this.textOpacity);m=x.unwrap(this.textOpacityBuffer);0<l.length&&l.byteLength===m.size&&m.setSubData(l)}};g.doPrepareForRendering=function(l,m,y){m=new Uint32Array(m);var D=new Int32Array(m.buffer),
B=m[y++];this.iconVertexBuffer=h.createVertex(l,35044,new Int32Array(D.buffer,4*y,B));y+=B;B=m[y++];this.iconIndexBuffer=h.createIndex(l,35044,new Uint32Array(m.buffer,4*y,B));y+=B;B=m[y++];this.textVertexBuffer=h.createVertex(l,35044,new Int32Array(D.buffer,4*y,B));y+=B;D=m[y++];this.textIndexBuffer=h.createIndex(l,35044,new Uint32Array(m.buffer,4*y,D));y+=D;this.iconOpacityBuffer=h.createVertex(l,35044,x.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=h.createVertex(l,35044,x.unwrap(this.textOpacity).buffer);
m=this.layer;y=m.iconMaterial;m=m.textMaterial;this.iconVertexArrayObject=new k(l,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new k(l,m.getAttributeLocations(),m.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return p}(q);d=function(w){function p(l,m){m=w.call(this,l,m)||this;m.type=4;m.circleIndexStart=0;m.circleIndexCount=0;l=new Uint32Array(l);
let y=m.bufferDataOffset;m.circleIndexStart=l[y++];m.circleIndexCount=l[y++];m.bufferDataOffset=y;return m}F._inheritsLoose(p,w);var g=p.prototype;g.hasData=function(){return 0<this.circleIndexCount};g.triangleCount=function(){return this.circleIndexCount/3};g.doDestroy=function(){x.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();x.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();x.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=
this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};g.doPrepareForRendering=function(l,m,y){m=new Uint32Array(m);var D=new Int32Array(m.buffer);const B=m[y++];this.circleVertexBuffer=h.createVertex(l,35044,new Int32Array(D.buffer,4*y,B));y+=B;D=m[y++];this.circleIndexBuffer=h.createIndex(l,35044,new Uint32Array(m.buffer,4*y,D));y+=D;y=this.layer.circleMaterial;this.circleVertexArrayObject=new k(l,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.circleVertexBuffer},
this.circleIndexBuffer)};return p}(q);A.CircleRenderBucket=d;A.FillRenderBucket=e;A.LineRenderBucket=t;A.RenderBucketBase=q;A.SymbolRenderBucket=c;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./core"],function(A,F,x,h){let q=function(d){this.tile=d;this.parent=null;this.children=new Set},t=function(){function d(){this.nodes=new Map;
this.roots=new Set}var a=d.prototype;a.create=function(b){const k=new q(b);let u;const w=[];this.nodes.forEach(p=>{this._canConnectDirectly(k,p)&&w.push(p);!u&&this._canConnectDirectly(p,k)&&(u=p)});if(u){for(const p of w)u.children.delete(p),k.children.add(p),p.parent=k;u.children.add(k);k.parent=u}else{this.roots.add(k);for(const p of w)k.children.add(p),p.parent=k,this.roots.delete(p)}this.nodes.set(b.key.id,k);return k};a.destroy=function(b){x.isSome(b.parent)?(b.parent.children.delete(b),b.children.forEach(k=>
{x.isSome(b.parent)&&b.parent.children.add(k)})):this.roots.delete(b);b.children.forEach(k=>{(k.parent=b.parent)||this.roots.add(k)});this.nodes.delete(b.tile.key.id)};a.clear=function(){this.roots.clear();this.nodes.clear()};a._canConnectDirectly=function(b,k){let {level:u,row:w,col:p}=k.tile.key;for({world:k}=k.tile.key;0<u;){u--;w>>=1;p>>=1;if(b.tile.key.level===u&&b.tile.key.row===w&&b.tile.key.col===p&&b.tile.key.world===k)return!0;if(this.nodes.has(`${u}/${w}/${p}/${k}`))break}return!1};return d}(),
e=function(){function d(){this._tileGraph=new t;this._tileArray=null}var a=d.prototype;a.has=function(b){return"string"===typeof b?this._tileGraph.nodes.has(b):this._tileGraph.nodes.has(b.key.id)};a.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(b=>{this._tileArray.push(b.tile)}));return this._tileArray};a.getRoots=function(){const b=[];this._tileGraph.roots.forEach(k=>{b.push(k.tile)});return b};a.getParent=function(b){b=this._tileGraph.nodes.get("string"===
typeof b?b:b.key.id);return x.isSome(b.parent)&&b.parent.tile};a.getChildren=function(b){const k=[];this._tileGraph.nodes.get("string"===typeof b?b:b.key.id).children.forEach(u=>{k.push(u.tile)});return k};a.get=function(b){return this._tileGraph.nodes.get(b).tile};a.removeKey=function(b){b=this._tileGraph.nodes.get(b);this._tileGraph.destroy(b);this._tileArray=null};a.forEach=function(b){this._tileGraph.nodes.forEach((k,u)=>b(k.tile,u))};a.add=function(b){this._tileGraph.create(b);this._tileArray=
null};a.remove=function(b){b=this._tileGraph.nodes.get(b.key.id);this._tileGraph.destroy(b);this._tileArray=null};a.clear=function(){this._tileGraph.clear();this._tileArray=[]};return d}(),c=function(){function d(b,k,u){this._rows=Math.ceil(k/u);this._columns=Math.ceil(b/u);this._cellSize=u;this.cells=Array(this._rows);for(b=0;b<this._rows;b++)for(this.cells[b]=Array(this._columns),k=0;k<this._columns;k++)this.cells[b][k]=[]}var a=d.prototype;a.getCell=function(b,k){k=Math.min(Math.max(Math.floor(k/
this._cellSize),0),this._rows-1);b=Math.min(Math.max(Math.floor(b/this._cellSize),0),this._columns-1);return this.cells[k]&&this.cells[k][b]||null};a.getCellSpan=function(b,k,u,w){return[Math.min(Math.max(Math.floor(b/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(k/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(u/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(w/this._cellSize),0),this.rows-1)]};F._createClass(d,[{key:"cellSize",get:function(){return this._cellSize}},
{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return d}();A.GridIndex=c;A.TileForest=e;A.TileGraph=t;A.TileNode=q;A.deserializeSymbols=function(d,a,b,k,u,w){const p=a[k++];for(let m=0;m<p;m++){const y=new h.VTLSymbol(w);y.xTile=a[k++];y.yTile=a[k++];y.hash=a[k++];y.priority=a[k++];var g=a[k++];for(var l=0;l<g;l++){const D=a[k++],B=a[k++],r=a[k++],z=a[k++],I=!!a[k++],G=a[k++],J=b[k++],M=b[k++],L=a[k++],O=a[k++];y.colliders.push({xTile:D,yTile:B,
dxPixels:r,dyPixels:z,hard:I,partIndex:G,width:L,height:O,minLod:J,maxLod:M})}g=d[k++];for(l=0;l<g;l++)y.textVertexRanges.push([d[k++],d[k++]]);g=d[k++];for(l=0;l<g;l++)y.iconVertexRanges.push([d[k++],d[k++]]);u.push(y)}return k};A.tileCoordChange=function(d,a,b,k,u,w){b-=u;if(0<=b)return(a>>b)+(k-(w<<b))*(d>>b);b=-b;return a-(w-(k<<b))*(d>>b)<<b};A.writeOpacityToBuffers=function(d,a,b){for(const [m,y]of d.symbols){{var k=d,u=a,w=b,p=y;const D=k.layerData.get(m);if(3===D.type){for(const B of p){p=
B.unique;var g=void 0;if(B.selectedForRendering){var l=p.parts[0];g=l.startOpacity;l=l.targetOpacity;k.allSymbolsFadingOut=k.allSymbolsFadingOut&&0===l;g=w?Math.floor(127*g)|l<<7:l?255:0;g|=g<<24|g<<16|g<<8}else g=0;for(const [r,z]of B.iconVertexRanges)for(l=r;l<r+z;l+=4)D.iconOpacity[l/4]=g;B.selectedForRendering?(g=p.parts[1],p=g.startOpacity,g=g.targetOpacity,k.allSymbolsFadingOut=k.allSymbolsFadingOut&&0===g,p=w?Math.floor(127*p)|g<<7:g?255:0,g=p<<24|p<<16|p<<8|p):g=0;for(const [r,z]of B.textVertexRanges)for(p=
r;p<r+z;p+=4)D.textOpacity[p/4]=g}D.lastOpacityUpdate=u;D.opacityChanged=!0}}}};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(A){A.VTLSymbol=function(F){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=F};A.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,
startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../geometry/support/aaBoundingRect ./decluttering/SymbolFader ../webgl/enums ../webgl/RenderableTile ../webgl/TileContainer ../../tiling/TileCoverage ../../tiling/TileKey".split(" "),function(A,F,x,h,q,t,e,
c,d,a,b){function k(u,w){if(u){const p=u.getLayoutProperty("visibility");if(!p||1!==p.getValue()&&(void 0===u.minzoom||u.minzoom<w+1E-6)&&(void 0===u.maxzoom||u.maxzoom>=w-1E-6))return!0}return!1}d=function(u){function w(g){g=u.call(this,g)||this;g._backgroundTiles=[];g._pointToCallbacks=new Map;return g}F._inheritsLoose(w,u);var p=w.prototype;p.destroy=function(){this.removeAllChildren();this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic.dispose(),
this._glyphMosaic=null);x.isSome(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null);this._styleRepository=null;this._backgroundTiles=[];this._pointToCallbacks.clear()};p.setStyleResources=function(g,l,m){this._spriteMosaic=g;this._glyphMosaic=l;this._styleRepository=m;x.isNone(this._symbolFader)&&(g=new t.SymbolFader(this._styleRepository,this.children),g.on("fade-start",()=>{this.emit("fade-start");this.requestRender()}),g.on("fade-complete",()=>{this.emit("fade-complete");this.requestRender()}),
this._symbolFader=g);x.unwrap(this._symbolFader).styleRepository=m};p.deleteStyleLayers=function(g){x.isSome(this._symbolFader)&&this._symbolFader.deleteStyleLayers(g)};p.hitTest=function(){var g=F._asyncToGenerator(function*(l,m){l=[l,m];m=h.createResolver();this._pointToCallbacks.set(l,m);this.requestRender();return m.promise});return function(l,m){return g.apply(this,arguments)}}();p.enterTileInvalidation=function(){for(const g of this.children)g.invalidating=!0};p.createRenderParams=function(g){return{...u.prototype.createRenderParams.call(this,
g),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}};p.doRender=function(g){!this.visible||g.drawPhase!==e.WGLDrawPhase.MAP&&g.drawPhase!==e.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||u.prototype.doRender.call(this,g)};p.addChild=function(g){u.prototype.addChild.call(this,g);x.isSome(this._symbolFader)?this._symbolFader.addTile(g):g.decluttered=!0;this.requestRender();return g};p.removeChild=function(g){x.isSome(this._symbolFader)&&
this._symbolFader.removeTile(g);this.requestRender();return u.prototype.removeChild.call(this,g)};p.renderChildren=function(g){if(g.drawPhase===e.WGLDrawPhase.DEBUG)u.prototype.renderChildren.call(this,g);else if(this._doRender(g),0<this._pointToCallbacks.size){const {context:l}=g,m=l.getBoundFramebufferObject();g.drawPhase=e.WGLDrawPhase.HITTEST;const y=g.painter.effects.hittest;y.bind(g);this._doRender(g);y.draw(g,this._pointToCallbacks);l.bindFramebuffer(m)}};p.removeAllChildren=function(){for(let g=
0;g<this.children.length;g++){const l=this.children[g];x.isSome(this._symbolFader)&&this._symbolFader.removeTile(l);l.dispose()}u.prototype.removeAllChildren.call(this)};p.getStencilTarget=function(){return this.children.filter(g=>g.neededForCoverage&&g.hasData())};p.restartDeclutter=function(){x.isSome(this._symbolFader)&&this._symbolFader.restartDeclutter()};p._doRender=function(g){const {context:l}=g;var m=this._styleRepository;if(m){var y=m.layers,D=!0;g.drawPhase===e.WGLDrawPhase.HITTEST&&(D=
!1);0<m.backgroundBucketIds.length&&(g.renderPass="background",this._renderBackgroundLayers(g,m.backgroundBucketIds));u.prototype.renderChildren.call(this,g);g.drawPhase===e.WGLDrawPhase.MAP&&this._fade(g.displayLevel,g.state);if((m=this.children.filter(r=>r.visible&&r.hasData()))&&0!==m.length){for(var B of m)B.triangleCount=0;l.setStencilWriteMask(0);l.setColorMask(!0,!0,!0,!0);l.setStencilOp(7680,7680,7681);l.setStencilTestEnabled(!0);l.setBlendingEnabled(!1);l.setDepthTestEnabled(!0);l.setDepthWriteEnabled(!0);
l.setDepthFunction(515);l.setClearDepth(1);l.clear(l.gl.DEPTH_BUFFER_BIT);g.renderPass="opaque";for(B=y.length-1;0<=B;B--)this._renderStyleLayer(y[B],g,m);l.setDepthWriteEnabled(!1);l.setBlendingEnabled(D);l.setBlendFunctionSeparate(1,771,1,771);g.renderPass="translucent";for(D=0;D<y.length;D++)this._renderStyleLayer(y[D],g,m);l.setDepthTestEnabled(!1);g.renderPass="symbol";for(D=0;D<y.length;D++)this._renderStyleLayer(y[D],g,m);l.bindVAO();l.setStencilTestEnabled(!0);l.setBlendingEnabled(!0)}}};
p._fade=function(g,l){x.isSome(this._symbolFader)&&(this._symbolFader.update(g,l)||this.requestRender())};p._renderStyleLayer=function(g,l,m){const {painter:y,renderPass:D}=l;if(void 0!==g){var B=g.getLayoutProperty("visibility");if(!B||1!==B.getValue()){switch(g.type){case 0:return;case 1:if("opaque"!==D&&"translucent"!==l.renderPass)return;var r="vtlFill";break;case 2:if("translucent"!==D)return;r="vtlLine";break;case 4:if("symbol"!==D)return;r="vtlCircle";break;case 3:if("symbol"!==D)return;r=
"vtlSymbol"}m=3===g.type?m.filter(z=>z.decluttered):m.filter(z=>z.neededForCoverage);if("vtlSymbol"!==r&&(B=l.displayLevel,0===m.length||void 0!==g.minzoom&&g.minzoom>=B+1E-6||void 0!==g.maxzoom&&g.maxzoom<B-1E-6))return;B=g.uid;l.styleLayerUID=B;l.styleLayer=g;for(const z of m)if(z.layerData.has(B)){y.renderObjects(l,m,r);break}}}};p._renderBackgroundLayers=function(g,l){const {context:m,displayLevel:y,painter:D,state:B}=g,r=this._styleRepository;var z=!1;for(var I of l)if(k(r.getLayerById(I),y)){z=
!0;break}if(z){z=this._tileInfoView.getTileCoverage(g.state,0,"smallest");var {spans:G,lodInfo:J}=z,{level:M}=J,L=q.create();I=[];if(this._renderPasses){var O=this._renderPasses[0];x.isSome(this._clippingInfos)&&(O.brushes[0].prepareState(g,this._clippingInfos[0]),O.brushes[0].drawMany(g,this._clippingInfos))}O=this._backgroundTiles;var S=0;for(const {row:R,colFrom:H,colTo:N}of G)for(let P=H;P<=N;P++){if(S<O.length){var T=O[S];T.key.set(M,R,J.normalizeCol(P),J.getWorldForColumn(P));this._tileInfoView.getTileBounds(L,
T.key,!1);T.x=L[0];T.y=L[3]}else{T=new b(M,R,J.normalizeCol(P),J.getWorldForColumn(P));const V=this._tileInfoView.getTileBounds(q.create(),T);T=new c.RenderableTile(T,V[0],V[3],512,512,4096,4096);O.push(T)}T.setTransform(B,this._tileInfoView.getTileResolution(T.key));I.push(T);S++}m.setStencilWriteMask(0);m.setColorMask(!0,!0,!0,!0);m.setStencilOp(7680,7680,7681);m.setStencilFunction(514,0,255);M=!0;g.drawPhase===e.WGLDrawPhase.HITTEST&&(M=!1);m.setStencilTestEnabled(M);for(const R of l)l=r.getLayerById(R),
k(l,y)&&(g.styleLayerUID=l.uid,g.styleLayer=l,D.renderObjects(g,I,"vtlBackground"));a.pool.release(z)}};return w}(d["default"]);A.VectorTileContainer=d;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../core/maybe ./config ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util".split(" "),function(A,F,x,h,q,t,e,c,d,
a){x=function(b){function k(w,p){var g=b.call(this)||this;g.styleRepository=w;g._tileToHandle=new Map;g._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};g._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};g._completed=!1;g._symbolRepository=new d.SymbolRepository(4096,p,()=>new t.VTLUniqueSymbol);g._symbolDeclutterer=new c.SymbolDeclutterer(p,g._symbolRepository,(l,m,y)=>new e.CollisionJob(l,m,y,g.styleRepository,g._zoom,g._viewState.rotation),(l,m)=>{l.allSymbolsFadingOut=!0;
l.lastOpacityUpdate=m;a.writeOpacityToBuffers(l,m,!0);l.decluttered=!0;l.requestRender()},(l,m)=>g.styleRepository.getStyleLayerByUID(l.styleLayerUID).z-g.styleRepository.getStyleLayerByUID(m.styleLayerUID).z,l=>{l=g.styleRepository.getStyleLayerByUID(l);return g._zoom<l.minzoom||g._zoom>l.maxzoom?!1:(l=l.getLayoutProperty("visibility"))&&1===l.getValue()?!1:!0});return g}F._inheritsLoose(k,b);var u=k.prototype;u.addTile=function(w){w.decluttered=!1;this._tileToHandle.set(w,w.on("symbols-changed",
()=>{this._symbolRepository.add(w);this.restartDeclutter()}));this._symbolRepository.add(w);this.restartDeclutter()};u.removeTile=function(w){const p=this._tileToHandle.get(w);p&&(this._symbolRepository.removeTile(w),this.restartDeclutter(),p.remove(),this._tileToHandle.delete(w))};u.update=function(w,p){this._zoom=w;this._viewState={scale:p.scale,rotation:p.rotation,center:[p.center[0],p.center[1]],size:[p.size[0],p.size[1]]};this._continueDeclutter();return this._completed};u.restartDeclutter=function(){this._completed=
!1;this._symbolDeclutterer.restart();this._notifyUnstable()};u.clear=function(){this._completed=!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(w=>w.remove());this._tileToHandle.clear()};u.deleteStyleLayers=function(w){this._symbolRepository.deleteStyleLayers(w)};u._continueDeclutter=function(){if(!this._completed||this.stale)this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=
this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(q.DECLUTTER_BUDGET))&&this._scheduleNotifyStable()};u._scheduleNotifyStable=function(){h.isSome(this._stableNotificationHandle)&&
clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this.emit("fade-complete")},1.5*q.FADE_DURATION)};u._notifyUnstable=function(){h.isSome(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this.emit("fade-start")};F._createClass(k,[{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||
this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}}]);return k}(x);A.SymbolFader=x;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../chunks/mat3f32","./config","./util"],function(A,F,x,h){let q=function(){function t(c,d,a,b,k,u){this._symbols=c;this._styleRepository=b;this._zoom=
k;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new h.GridIndex(d,a,x.COLLISION_GRID_CELL_SIZE);this._si=Math.sin(Math.PI*u/180);this._co=Math.cos(Math.PI*u/180);for(const w of c)for(const p of w.symbols)this._allNeededMatrices.has(p.tile)||this._allNeededMatrices.set(p.tile,F.clone(p.tile.transforms.tileUnitsToPixels))}var e=t.prototype;e.work=function(c){const d=this._gridIndex,a=performance.now();for(;this._currentLayerCursor<
this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const B=this._symbols[this._currentLayerCursor],r=this._getProperties(B.styleLayerUID);for(;this._currentSymbolCursor<B.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-a>c)return!1;var b=B.symbols[this._currentSymbolCursor];if(!b.unique.show)continue;{var k=b,u=this._si,w=this._co,p=this._allNeededMatrices.get(b.tile),g=this._zoom;const {iconRotationAlignment:M,textRotationAlignment:L,
iconTranslate:O,iconTranslateAnchor:S,textTranslate:T,textTranslateAnchor:R}=r;var l=0;for(const H of k.colliders){const [N,P]=0===H.partIndex?O:T;var m=0===H.partIndex?S:R,y=H.minLod<=g&&g<=H.maxLod;l+=y?0:1;H.enabled=y;H.xScreen=H.xTile*p[0]+H.yTile*p[3]+p[6];H.yScreen=H.xTile*p[1]+H.yTile*p[4]+p[7];0===m?(H.xScreen+=w*N-u*P,H.yScreen+=u*N+w*P):(H.xScreen+=N,H.yScreen+=P);1===(0===H.partIndex?M:L)?(H.dxScreen=H.dxPixels,H.dyScreen=H.dyPixels):(H.dxScreen=w*(H.dxPixels+H.width/2)-u*(H.dyPixels+H.height/
2)-H.width/2,H.dyScreen=u*(H.dxPixels+H.width/2)+w*(H.dyPixels+H.height/2)-H.height/2)}0<k.colliders.length&&l===k.colliders.length&&(k.unique.show=!1)}k=b.unique;if(!k.show)continue;const {iconAllowOverlap:z,iconIgnorePlacement:I,textAllowOverlap:G,textIgnorePlacement:J}=r;for(const M of b.colliders)if(M.enabled&&(u=k.parts[M.partIndex],u.show)){if(w=!(M.partIndex?G:z))a:{w=M.xScreen+M.dxScreen;p=M.yScreen+M.dyScreen;g=w+M.width;l=p+M.height;const [L,O,S,T]=d.getCellSpan(w,p,g,l);for(m=O;m<=T;m++)for(y=
L;y<=S;y++){var D=d.cells[m][y];for(const R of D){D=R.xScreen+R.dxScreen;const H=R.yScreen+R.dyScreen,N=D+R.width,P=H+R.height;if(!(g<D||w>N||l<H||p>P)){w=!0;break a}}}w=!1}w&&(M.hard?k.show=!1:u.show=!1)}if(k.show)for(const M of b.colliders){if(!M.enabled)continue;if(M.partIndex?J:I)continue;if(!k.parts[M.partIndex].show)continue;b=M.xScreen+M.dxScreen;u=M.yScreen+M.dyScreen;const [L,O,S,T]=this._gridIndex.getCellSpan(b,u,b+M.width,u+M.height);for(b=O;b<=T;b++)for(u=L;u<=S;u++)this._gridIndex.cells[b][u].push(M)}}}return!0};
e._getProperties=function(c){var d=this._styleProps.get(c);if(d)return d;d=this._zoom;const a=this._styleRepository.getStyleLayerByUID(c);var b=0!==a.getLayoutValue("symbol-placement",d);let k=a.getLayoutValue("icon-rotation-alignment",d);2===k&&(k=b?0:1);let u=a.getLayoutValue("text-rotation-alignment",d);2===u&&(u=b?0:1);b=a.getPaintValue("icon-translate",d);const w=a.getPaintValue("icon-translate-anchor",d),p=a.getPaintValue("text-translate",d),g=a.getPaintValue("text-translate-anchor",d);d={iconAllowOverlap:a.getLayoutValue("icon-allow-overlap",
d),iconIgnorePlacement:a.getLayoutValue("icon-ignore-placement",d),textAllowOverlap:a.getLayoutValue("text-allow-overlap",d),textIgnorePlacement:a.getLayoutValue("text-ignore-placement",d),iconRotationAlignment:k,textRotationAlignment:u,iconTranslateAnchor:w,iconTranslate:b,textTranslateAnchor:g,textTranslate:p};this._styleProps.set(c,d);return d};return t}();A.CollisionJob=q;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./config"],function(A,F,x,h){function q(e,c){if(e.priority-c.priority)return e.priority-c.priority;const d=e.tile.key,a=c.tile.key;return d.world-a.world?d.world-a.world:d.level-a.level?d.level-a.level:d.row-a.row?d.row-a.row:d.col-a.col?d.col-a.col:e.xTile-c.xTile?e.xTile-c.xTile:e.yTile-c.yTile}let t=function(){function e(d,a,b,k,u,w){this._visibleTiles=d;this._symbolRepository=a;this._createCollisionJob=b;this._assignTileSymbolsOpacity=
k;this._symbolLayerSorter=u;this._isLayerVisible=w;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}var c=e.prototype;c.setScreenSize=function(d,a){this._screenWidth===d&&this._screenHeight===a||this.restart();this._screenWidth=d;this._screenHeight=a};c.restart=function(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=
!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0};c.continue=function(d){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var a=performance.now();if(!this._selectionJob.work(d))return!1;this._selectionJobCompleted=!0;d=Math.max(0,d-(performance.now()-a));if(0===d)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){a=
performance.now();if(!this._collisionJob.work(d))return!1;this._collisionJobCompleted=!0;d=Math.max(0,d-(performance.now()-a));if(0===d)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){a=performance.now();if(!this._opacityJob.work(d))return!1;this._opacityJobCompleted=!0;d=Math.max(0,d-(performance.now()-a));if(0===d)return!1}this._running=!1;return!0};c._createSelectionJob=function(){const d=this._symbolRepository.uniqueSymbols;for(let p=0;p<d.length;p++){const g=
d[p];for(let l=0;l<g.uniqueSymbols.length;l++){const m=g.uniqueSymbols[l];for(const y of m.tileSymbols)y.selectedForRendering=!1}}const a=[];let b=0,k=0;const u=this._isLayerVisible,w=this._symbolLayerSorter;return{work:function(p){const g=performance.now();for(;k<d.length;k++,b=0){const m=d[k];var l=m.styleLayerUID;if(!u(l)){a[k]||(a[k]={styleLayerUID:l,symbols:[]});continue}a[k]=a[k]||{styleLayerUID:l,symbols:[]};const y=a[k];for(;b<m.uniqueSymbols.length;b++){l=m.uniqueSymbols[b];if(99===b%100&&
performance.now()-g>p)return!1;let D=null,B=!1,r=!1;for(const z of l.tileSymbols)if(!r||!B){const I=z.tile;if(!D||I.isCoverage||I.neededForCoverage&&!B){D=z;if(I.neededForCoverage||I.isCoverage)r=!0;I.isCoverage&&(B=!0)}}D.selectedForRendering=!0;if(r){y.symbols.push(D);l.show=!0;for(const z of l.parts)z.show=!0}else l.show=!1}}for(const m of a)m.symbols.sort(q);return!0},get sortedSymbols(){return a.sort(w)}}};c._createOpacityJob=function(){function d(u,w){var p=u.symbols;for(const [,l]of p){var g=
l;p=w;for(const m of g){g=m.unique;for(const y of g.parts)y.startOpacity+=(p-y.startTime)/h.FADE_DURATION*(.5<y.targetOpacity?1:-1),y.startOpacity=Math.min(Math.max(y.startOpacity,0),1),y.startTime=p,y.targetOpacity=g.show&&y.show?1:0}}a(u,w);for(const l of u.childrenTiles)d(l,w)}const a=this._assignTileSymbolsOpacity,b=this._visibleTiles;let k=0;return{work(u){const w=performance.now();for(;k<b.length;k++){if(performance.now()-w>u)return!1;const p=b[k];if(x.isSome(p.parentTile))continue;const g=
performance.now();d(p,g)}return!0}}};F._createClass(e,[{key:"running",get:function(){return this._running}}]);return e}();A.SymbolDeclutterer=t;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./util"],function(A,F,x,h){let q=function(){function t(c,d,a){this.tileCoordRange=c;this._visibleTiles=d;this._createUnique=a;this._tiles=
new Map;this._uniqueSymbolsReferences=new Map}var e=t.prototype;e.add=function(c,d){this._uniqueSymbolLayerArray=null;let a=this._tiles.get(c.id);a||(a={symbols:new Map},this._tiles.set(c.id,a));var b=new Map;if(d)for(var k of d)a.symbols.has(k)&&(b.set(k,a.symbols.get(k)),a.symbols.delete(k));else for(var [u]of c.layerData)a.symbols.has(u)&&(b.set(u,a.symbols.get(u)),a.symbols.delete(u));this._removeSymbols(b);d=c.symbols;b=new Map;for(const [w,p]of d)if(k=p.length,32<=k){u=this.tileCoordRange;do u/=
2,k/=4;while(8<k&&64<u);k=new h.GridIndex(this.tileCoordRange,this.tileCoordRange,u);b.set(w,{flat:p,index:k});a.symbols.set(w,{flat:p,index:k});for(const g of p)k.getCell(g.xTile,g.yTile).push(g)}else b.set(w,{flat:p}),a.symbols.set(w,{flat:p});this._addSymbols(c.key,d)};e.deleteStyleLayers=function(c){this._uniqueSymbolLayerArray=null;for(const [d,a]of this._tiles){const b=new Map;for(const k of c)a.symbols.has(k)&&(b.set(k,a.symbols.get(k)),a.symbols.delete(k));this._removeSymbols(b);0===a.symbols.size&&
this._tiles.delete(d)}};e.removeTile=function(c){this._uniqueSymbolLayerArray=null;const d=this._tiles.get(c.id);if(d){var a=new Map;for(const [b]of c.symbols)d.symbols.has(b)&&(a.set(b,d.symbols.get(b)),d.symbols.delete(b));this._removeSymbols(a);0===d.symbols.size&&this._tiles.delete(c.id)}};e._removeSymbols=function(c){for(const [a,{flat:b}]of c)for(const k of b){c=k.unique;var d=c.tileSymbols;const u=d.length-1;for(let w=0;w<u;w++)if(d[w]===k){d[w]=d[u];break}d.length=u;0===u&&(d=this._uniqueSymbolsReferences.get(a),
d.delete(c),0===d.size&&this._uniqueSymbolsReferences.delete(a));k.unique=null}};e._addSymbols=function(c,d){if(0!==d.size){var a=this._visibleTiles;for(const b of a)b.parentTile||b.key.world!==c.world||b.key.level===c.level&&!b.key.equals(c)||this._matchSymbols(b,c,d);for(const [b,k]of d)for(const u of k)x.isNone(u.unique)&&(c=this._createUnique(),u.unique=c,c.tileSymbols.push(u),d=this._uniqueSymbolsReferences.get(b),d||(d=new Set,this._uniqueSymbolsReferences.set(b,d)),d.add(c))}};e._matchSymbols=
function(c,d,a){if(c.key.level>d.level){var b=c.key.level-d.level;if(c.key.row>>b!==d.row||c.key.col>>b!==d.col)return}if(d.level>c.key.level&&(b=d.level-c.key.level,d.row>>b!==c.key.row||d.col>>b!==c.key.col))return;if(d.equals(c.key))for(var k of c.childrenTiles)this._matchSymbols(k,d,a);else{k=new Map;for(const [p,g]of a){var u=[];for(const m of g)a=h.tileCoordChange(this.tileCoordRange,m.xTile,d.level,d.col,c.key.level,c.key.col),b=h.tileCoordChange(this.tileCoordRange,m.yTile,d.level,d.row,c.key.level,
c.key.row),0<=a&&a<this.tileCoordRange&&0<=b&&b<this.tileCoordRange&&u.push({symbol:m,xTransformed:a,yTransformed:b});a=[];b=c.key.level<d.level?1:1<<c.key.level-d.level;const l=this._tiles.get(c.id).symbols.get(p);if(l){const m=l.flat;for(const y of u){var w=!1;let D;const B=y.xTransformed,r=y.yTransformed;D=x.isSome(l.index)?l.index.getCell(B,r):m;u=y.symbol;const z=u.hash;for(const I of D)if(z===I.hash&&Math.abs(B-I.xTile)<=b&&Math.abs(r-I.yTile)<=b){w=I.unique;u.unique=w;w.tileSymbols.push(u);
w=!0;break}w||a.push(u)}}0<a.length&&k.set(p,a)}for(const p of c.childrenTiles)this._matchSymbols(p,d,k)}};e._createUniqueSymbolLayerArray=function(){var c=this._uniqueSymbolsReferences;const d=Array(c.size);let a=0;for(const [b,k]of c){const u=Array(k.size);c=0;for(const w of k)u[c++]=w;d[a]={styleLayerUID:b,uniqueSymbols:u};a++}return d};F._createClass(t,[{key:"uniqueSymbols",get:function(){x.isNone(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());
return this._uniqueSymbolLayerArray}}]);return t}();A.SymbolRepository=q;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f32","./TiledDisplayObject"],function(A,F,x,h){h=function(q){function t(){return q.apply(this,arguments)||this}F._inheritsLoose(t,q);t.prototype._createTransforms=function(){return{dvs:x.create(),tileMat3:x.create()}};return t}(h.TiledDisplayObject);
A.RenderableTile=h;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleLayer"],function(A){return function(){function F(h,q){this._style=h;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;h.layers||(h.layers=[]);this.version=parseFloat(h.version);this.sprite=q?q.spriteUrl:h.sprite;this.glyphs=q?q.glyphsUrl:h.glyphs;if(this.layers=h.layers.map((t,e,c)=>this._create(t,e,c)))for(q=
0;q<this.layers.length;q++)h=this.layers[q],this._layerByName[h.id.toLowerCase()]=h,this._uidToLayer.set(h.uid,h),0===h.type&&this.backgroundBucketIds.push(h.id);this._identifyRefLayers()}var x=F.prototype;x.isPainterDataDriven=function(h){return(h=this._layerByName[h.toLowerCase()])?h.isPainterDataDriven():!1};x.getStyleLayerId=function(h){return h>=this.layers.length?null:this.layers[h].id};x.getStyleLayerByUID=function(h){h=this._uidToLayer.get(h);return null!=h?h:null};x.getStyleLayerIndex=function(h){return(h=
this._layerByName[h.toLowerCase()])?this.layers.indexOf(h):-1};x.setStyleLayer=function(h,q){if(h&&h.id){var t=this._style;null!=q&&q>=this.layers.length&&(q=this.layers.length-1);var e=!0,c;if(c=this._layerByName[h.id.toLowerCase()]){const d=this.layers.indexOf(c);q||(q=d);q===d?(e=!1,c=F._recreateLayer(h,c),this.layers[q]=c,t.layers[q]=h):(this.layers.splice(d,1),t.layers.splice(d,1),c=this._create(h,q,this.layers),this.layers.splice(q,0,c),t.layers.splice(q,0,h))}else c=this._create(h,q,this.layers),
!q||q>=this.layers.length?(this.layers.push(c),t.layers.push(h)):(this.layers.splice(q,0,c),t.layers.splice(q,0,h));this._layerByName[h.id.toLowerCase()]=c;this._uidToLayer.set(c.uid,c);e&&this._recomputeZValues();this._identifyRefLayers()}};x.getStyleLayer=function(h){return(h=this._layerByName[h.toLowerCase()])?{type:h.typeName,id:h.id,source:h.source,"source-layer":h.sourceLayer,minzoom:h.minzoom,maxzoom:h.maxzoom,filter:h.filter,layout:h.layout,paint:h.paint}:null};x.deleteStyleLayer=function(h){const q=
this._layerByName[h.toLowerCase()];q&&(delete this._layerByName[h.toLowerCase()],this._uidToLayer.delete(q.uid),h=this.layers.indexOf(q),this.layers.splice(h,1),this._style.layers.splice(h,1),this._recomputeZValues(),this._identifyRefLayers())};x.getLayerById=function(h){return this._layerByName[h.toLowerCase()]};x.getLayoutProperties=function(h){return(h=this._layerByName[h.toLowerCase()])?h.layout:null};x.getPaintProperties=function(h){return(h=this._layerByName[h.toLowerCase()])?h.paint:null};
x.setPaintProperties=function(h,q){if(h=this._layerByName[h.toLowerCase()]){var t=F._recreateLayer({type:h.typeName,id:h.id,source:h.source,"source-layer":h.sourceLayer,minzoom:h.minzoom,maxzoom:h.maxzoom,filter:h.filter,layout:h.layout,paint:q},h),e=this.layers.indexOf(h);this.layers[e]=t;this._style.layers[e].paint=q;this._layerByName[h.id.toLowerCase()]=t;this._uidToLayer.set(h.uid,t)}};x.setLayoutProperties=function(h,q){if(h=this._layerByName[h.toLowerCase()]){var t=F._recreateLayer({type:h.typeName,
id:h.id,source:h.source,"source-layer":h.sourceLayer,minzoom:h.minzoom,maxzoom:h.maxzoom,filter:h.filter,layout:q,paint:h.paint},h),e=this.layers.indexOf(h);this.layers[e]=t;this._style.layers[e].layout=q;this._layerByName[h.id.toLowerCase()]=t;this._uidToLayer.set(h.uid,t)}};x.setStyleLayerVisibility=function(h,q){if(h=this._layerByName[h.toLowerCase()]){var t=h.layout||{};t.visibility=q;q=F._recreateLayer({type:h.typeName,id:h.id,source:h.source,"source-layer":h.sourceLayer,minzoom:h.minzoom,maxzoom:h.maxzoom,
filter:h.filter,layout:t,paint:h.paint},h);var e=this.layers.indexOf(h);this.layers[e]=q;this._style.layers[e].layout=t;this._layerByName[h.id.toLowerCase()]=q;this._uidToLayer.set(h.uid,q)}};x.getStyleLayerVisibility=function(h){var q;h=this._layerByName[h.toLowerCase()];if(!h)return"none";h=h.layout;return null!=(q=null==h?void 0:h.visibility)?q:"visible"};x._recomputeZValues=function(){const h=this.layers,q=1/(h.length+1);for(let t=0;t<h.length;t++)h[t].z=1-(1+t)*q};x._identifyRefLayers=function(){const h=
[],q=[];let t=0;for(const b of this.layers){const k=b.layout;if(1===b.type){var e,c=b,d=b.source+"|"+b.sourceLayer;d+=null!=(e="|"+(null==k?void 0:k.visibility))?e:"";d+="|"+b.minzoom;d+="|"+b.maxzoom;d+="|"+JSON.stringify(b.filter);if(c.hasDataDrivenFill||c.hasDataDrivenOutline)d+="|"+t;h.push({key:d,layer:b})}else if(2===b.type){var a;c=b;d=b.source+"|"+b.sourceLayer;d+=null!=(a="|"+(null==k?void 0:k.visibility))?a:"";d+="|"+b.minzoom;d+="|"+b.maxzoom;d+="|"+JSON.stringify(b.filter);d+="|"+(void 0!==
k?k["line-cap"]:"");d+="|"+(void 0!==k?k["line-join"]:"");c.hasDataDrivenLine&&(d+="|"+t);q.push({key:d,layer:b})}++t}this._assignRefLayers(h);this._assignRefLayers(q)};x._assignRefLayers=function(h){h.sort((a,b)=>a.key<b.key?-1:a.key>b.key?1:0);let q,t;const e=h.length;for(let a=0;a<e;a++){const b=h[a];if(b.key===q)b.layer.refLayerId=t;else if(q=b.key,t=b.layer.id,1===b.layer.type){if(!b.layer.getPaintProperty("fill-outline-color"))for(var c=a+1;c<e;c++){var d=h[c];if(d.key===q){if(d.layer.getPaintProperty("fill-outline-color")){h[a]=
d;h[c]=b;t=d.layer.id;break}}else break}}else if(2===b.layer.type)for(c=b.layer,d=a+1;d<e;d++){const k=h[d];if(k.key!==q)break;const u=k.layer;if(c.canUseThinTessellation&&!u.canUseThinTessellation||!c.canUseThinTessellation&&(u.getPaintProperty("line-pattern")||u.getPaintProperty("line-dasharray")))c=u,h[a]=k,h[d]=b,t=k.layer.id}}};x._create=function(h,q,t){q=1-1/(t.length+1)*(1+q);t=this._runningId++;switch(h.type){case "background":return new A.BackgroundStyleLayer(0,h,q,t);case "fill":return new A.FillStyleLayer(1,
h,q,t);case "line":return new A.LineStyleLayer(2,h,q,t);case "symbol":return new A.SymbolStyleLayer(3,h,q,t);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new A.CircleStyleLayer(4,h,q,t)}throw Error("Unknown vector tile layer");};F._recreateLayer=function(h,q){switch(h.type){case "background":return new A.BackgroundStyleLayer(0,h,q.z,q.uid);case "fill":return new A.FillStyleLayer(1,h,q.z,q.uid);case "line":return new A.LineStyleLayer(2,h,q.z,q.uid);case "symbol":return new A.SymbolStyleLayer(3,
h,q.z,q.uid);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new A.CircleStyleLayer(4,h,q.z,q.uid)}};return F}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),
function(A,F,x,h,q,t,e,c,d,a,b){let k=function(){function D(r,z,I,G){this.type=r;this.typeName=z.type;this.id=z.id;this.source=z.source;this.sourceLayer=z["source-layer"];this.minzoom=z.minzoom;this.maxzoom=z.maxzoom;this.filter=z.filter;this.layout=z.layout;this.paint=z.paint;this.z=I;this.uid=G;switch(r){case 0:this._layoutDefinition=d.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=d.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=d.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=d.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=d.StyleDefinition.lineLayoutDefinition;this._paintDefinition=d.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=d.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=d.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=d.StyleDefinition.circleLayoutDefinition,this._paintDefinition=d.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);
this._paintProperties=this._parsePaint(this.paint)}var B=D.prototype;B.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=c.createFilter(this.filter)};B.getLayoutProperty=function(r){return this._layoutProperties[r]};B.getPaintProperty=function(r){return this._paintProperties[r]};B.getLayoutValue=function(r,z,I){let G;const J=this._layoutProperties[r];J&&(G=J.getValue(z,I));void 0===G&&(G=this._layoutDefinition[r]["default"]);return G};B.getPaintValue=
function(r,z,I){let G;const J=this._paintProperties[r];J&&(G=J.getValue(z,I));void 0===G&&(G=this._paintDefinition[r]["default"]);return G};B.isPainterDataDriven=function(){const r=this._paintProperties;if(r)for(const z in r)if(r[z].isDataDriven)return!0;return!1};B._parseLayout=function(r){const z={};for(const I in r){const G=this._layoutDefinition[I];G&&(z[I]=new a(G,r[I]))}return z};B._parsePaint=function(r){const z={};for(const I in r){const G=this._paintDefinition[I];G&&(z[I]=new a(G,r[I]))}return z};
B.computeAttributesKey=function(r,z,I,G){let J=0,M=0;for(const L of z){z=3;if(!L||L!==G){const {isLayout:O,isOptional:S}=I[L];z=O?this.getLayoutProperty(L):this.getPaintProperty(L);z=null!=z&&z.interpolator?2:null!=z&&z.isDataDriven?1:S&&!z?3:0}M|=z<<J;J+=2}return M<<3|r};return D}(),u=function(D){function B(r,z,I,G){r=D.call(this,r,z,I,G)||this;r.backgroundMaterial=new x.VTLBackgroundMaterial(r.computeAttributesKey(0,x.VTLBackgroundMaterial.ATTRIBUTES,x.VTLBackgroundMaterial.ATTRIBUTES_INFO));return r}
F._inheritsLoose(B,D);return B}(k),w=function(D){function B(r,z,I,G){r=D.call(this,r,z,I,G)||this;z=r.getPaintProperty("fill-color");I=r.getPaintProperty("fill-opacity");G=r.getPaintProperty("fill-pattern");r.hasDataDrivenColor=null==z?void 0:z.isDataDriven;r.hasDataDrivenOpacity=null==I?void 0:I.isDataDriven;r.hasDataDrivenFill=r.hasDataDrivenColor||r.hasDataDrivenOpacity||(null==G?void 0:G.isDataDriven);I=r.getPaintProperty("fill-outline-color");r.outlineUsesFillColor=!I;r.hasDataDrivenOutlineColor=
null==I?void 0:I.isDataDriven;r.hasDataDrivenOutline=I?I.isDataDriven:z?z.isDataDriven:!1;r.hasDataDrivenOutline=(I?r.hasDataDrivenOutlineColor:r.hasDataDrivenColor)||r.hasDataDrivenOpacity;r.fillMaterial=new q.VTLFillMaterial(r.computeAttributesKey(1,q.VTLFillMaterial.ATTRIBUTES,q.VTLFillMaterial.ATTRIBUTES_INFO));r.outlineMaterial=new q.VTLOutlineMaterial(r.computeAttributesKey(2,r.outlineUsesFillColor?q.VTLOutlineMaterial.ATTRIBUTES_FILL:q.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,r.outlineUsesFillColor?
q.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:q.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),r.outlineUsesFillColor);return r}F._inheritsLoose(B,D);return B}(k),p=function(D){function B(r,z,I,G){var J,M,L,O,S,T,R,H,N;r=D.call(this,r,z,I,G)||this;z=r.getPaintProperty("line-pattern");r.lineMaterial=new t.VTLLineMaterial(r.computeAttributesKey(3,t.VTLLineMaterial.ATTRIBUTES,t.VTLLineMaterial.ATTRIBUTES_INFO,z?"line-dasharray":""));r.hasDataDrivenLine=(null==(J=r.getPaintProperty("line-blur"))?void 0:J.isDataDriven)||
(null==(M=r.getPaintProperty("line-color"))?void 0:M.isDataDriven)||(null==(L=r.getPaintProperty("line-gap-width"))?void 0:L.isDataDriven)||(null==(O=r.getPaintProperty("line-offset"))?void 0:O.isDataDriven)||(null==(S=r.getPaintProperty("line-opacity"))?void 0:S.isDataDriven)||(null==(T=r.getPaintProperty("line-pattern"))?void 0:T.isDataDriven)||(null==(R=r.getPaintProperty("line-dasharray"))?void 0:R.isDataDriven)||(null==(H=r.getLayoutProperty("line-cap"))?void 0:H.isDataDriven)||(null==(N=r.getPaintProperty("line-width"))?
void 0:N.isDataDriven);r.canUseThinTessellation=!1;!r.hasDataDrivenLine&&(J=r.getPaintProperty("line-width"),!J||"number"===typeof J&&.5*J<b.THIN_LINE_HALF_WIDTH_THRESHOLD)&&(J=r.getPaintProperty("line-offset"),!J||"number"===typeof J&&0===J)&&(r.canUseThinTessellation=!0);return r}F._inheritsLoose(B,D);B.prototype.getDashKey=function(r,z){switch(z){case 0:z="Butt";break;case 1:z="Round";break;case 2:z="Square";break;default:z="Butt"}return`dasharray-[${r.toString()}]-${z}`};return B}(k),g=function(D){function B(r,
z,I,G){var J,M,L,O,S,T,R,H,N,P,V,ba;r=D.call(this,r,z,I,G)||this;r.iconMaterial=new e.VTLIconMaterial(r.computeAttributesKey(4,e.VTLIconMaterial.ATTRIBUTES,e.VTLIconMaterial.ATTRIBUTES_INFO));r.textMaterial=new e.VTLTextMaterial(r.computeAttributesKey(6,e.VTLTextMaterial.ATTRIBUTES,e.VTLTextMaterial.ATTRIBUTES_INFO));r.hasDataDrivenIcon=(null==(J=r.getPaintProperty("icon-color"))?void 0:J.isDataDriven)||(null==(M=r.getPaintProperty("icon-halo-blur"))?void 0:M.isDataDriven)||(null==(L=r.getPaintProperty("icon-halo-color"))?
void 0:L.isDataDriven)||(null==(O=r.getPaintProperty("icon-halo-width"))?void 0:O.isDataDriven)||(null==(S=r.getPaintProperty("icon-opacity"))?void 0:S.isDataDriven)||(null==(T=r.getLayoutProperty("icon-size"))?void 0:T.isDataDriven);r.hasDataDrivenText=(null==(R=r.getPaintProperty("text-color"))?void 0:R.isDataDriven)||(null==(H=r.getPaintProperty("text-halo-blur"))?void 0:H.isDataDriven)||(null==(N=r.getPaintProperty("text-halo-color"))?void 0:N.isDataDriven)||(null==(P=r.getPaintProperty("text-halo-width"))?
void 0:P.isDataDriven)||(null==(V=r.getPaintProperty("text-opacity"))?void 0:V.isDataDriven)||(null==(ba=r.getLayoutProperty("text-size"))?void 0:ba.isDataDriven);return r}F._inheritsLoose(B,D);return B}(k),l=function(D){function B(r,z,I,G){r=D.call(this,r,z,I,G)||this;r.circleMaterial=new h.VTLCircleMaterial(r.computeAttributesKey(5,h.VTLCircleMaterial.ATTRIBUTES,h.VTLCircleMaterial.ATTRIBUTES_INFO));return r}F._inheritsLoose(B,D);return B}(k),m=function(){function D(B,r,z){var I,G,J,M,L;this.allowOverlap=
B.getLayoutValue("icon-allow-overlap",r);this.ignorePlacement=B.getLayoutValue("icon-ignore-placement",r);this.keepUpright=B.getLayoutValue("icon-keep-upright",r);this.optional=B.getLayoutValue("icon-optional",r);this.rotationAlignment=B.getLayoutValue("icon-rotation-alignment",r);2===this.rotationAlignment&&(this.rotationAlignment=z?0:1);z=B.getLayoutProperty("icon-anchor");null!=(I=z)&&I.isDataDriven?this._anchorProp=z:this.anchor=B.getLayoutValue("icon-anchor",r);z=B.getLayoutProperty("icon-offset");
null!=(G=z)&&G.isDataDriven?this._offsetProp=z:this.offset=B.getLayoutValue("icon-offset",r);z=B.getLayoutProperty("icon-padding");null!=(J=z)&&J.isDataDriven?this._paddingProp=z:this.padding=B.getLayoutValue("icon-padding",r);z=B.getLayoutProperty("icon-rotate");null!=(M=z)&&M.isDataDriven?this._rotateProp=z:this.rotate=B.getLayoutValue("icon-rotate",r);z=B.getLayoutProperty("icon-size");null!=(L=z)&&L.isDataDriven?this._sizeProp=z:this.size=B.getLayoutValue("icon-size",r)}D.prototype.update=function(B,
r){this._anchorProp&&(this.anchor=this._anchorProp.getValue(B,r));this._offsetProp&&(this.offset=this._offsetProp.getValue(B,r));this._paddingProp&&(this.padding=this._paddingProp.getValue(B,r));this._rotateProp&&(this.rotate=this._rotateProp.getValue(B,r));this._sizeProp&&(this.size=this._sizeProp.getValue(B,r))};return D}(),y=function(){function D(B,r,z){var I,G,J,M,L,O,S,T,R,H,N;this.allowOverlap=B.getLayoutValue("text-allow-overlap",r);this.ignorePlacement=B.getLayoutValue("text-ignore-placement",
r);this.keepUpright=B.getLayoutValue("text-keep-upright",r);this.optional=B.getLayoutValue("text-optional",r);this.rotationAlignment=B.getLayoutValue("text-rotation-alignment",r);2===this.rotationAlignment&&(this.rotationAlignment=z?0:1);z=B.getLayoutProperty("text-anchor");null!=(I=z)&&I.isDataDriven?this._anchorProp=z:this.anchor=B.getLayoutValue("text-anchor",r);z=B.getLayoutProperty("text-justify");null!=(G=z)&&G.isDataDriven?this._justifyProp=z:this.justify=B.getLayoutValue("text-justify",r);
z=B.getLayoutProperty("text-letter-spacing");null!=(J=z)&&J.isDataDriven?this._letterSpacingProp=z:this.letterSpacing=B.getLayoutValue("text-letter-spacing",r);z=B.getLayoutProperty("text-line-height");null!=(M=z)&&M.isDataDriven?this._lineHeightProp=z:this.lineHeight=B.getLayoutValue("text-line-height",r);z=B.getLayoutProperty("text-max-angle");null!=(L=z)&&L.isDataDriven?this._maxAngleProp=z:this.maxAngle=B.getLayoutValue("text-max-angle",r);z=B.getLayoutProperty("text-max-width");null!=(O=z)&&
O.isDataDriven?this._maxWidthProp=z:this.maxWidth=B.getLayoutValue("text-max-width",r);z=B.getLayoutProperty("text-offset");null!=(S=z)&&S.isDataDriven?this._offsetProp=z:this.offset=B.getLayoutValue("text-offset",r);z=B.getLayoutProperty("text-padding");null!=(T=z)&&T.isDataDriven?this._paddingProp=z:this.padding=B.getLayoutValue("text-padding",r);z=B.getLayoutProperty("text-rotate");null!=(R=z)&&R.isDataDriven?this._rotateProp=z:this.rotate=B.getLayoutValue("text-rotate",r);z=B.getLayoutProperty("text-size");
null!=(H=z)&&H.isDataDriven?this._sizeProp=z:this.size=B.getLayoutValue("text-size",r);z=B.getLayoutProperty("text-writing-mode");null!=(N=z)&&N.isDataDriven?this._writingModeProp=z:this.writingMode=B.getLayoutValue("text-writing-mode",r)}D.prototype.update=function(B,r){this._anchorProp&&(this.anchor=this._anchorProp.getValue(B,r));this._justifyProp&&(this.justify=this._justifyProp.getValue(B,r));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(B,r));this._lineHeightProp&&
(this.lineHeight=this._lineHeightProp.getValue(B,r));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(B,r));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(B,r));this._offsetProp&&(this.offset=this._offsetProp.getValue(B,r));this._paddingProp&&(this.padding=this._paddingProp.getValue(B,r));this._rotateProp&&(this.rotate=this._rotateProp.getValue(B,r));this._sizeProp&&(this.size=this._sizeProp.getValue(B,r));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(B,
r))};return D}();A.BackgroundStyleLayer=u;A.CircleStyleLayer=l;A.FillStyleLayer=w;A.IconLayout=m;A.LineStyleLayer=p;A.StyleLayer=k;A.SymbolStyleLayer=g;A.TextLayout=y;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(A,F,x){x=function(h){function q(e){return h.call(this,e)||this}F._inheritsLoose(q,h);var t=q.prototype;t.geometryInfo=
function(){return q.GEOMETRY_LAYOUT};t.opacityInfo=function(){return null};t.attributes=function(){return q.ATTRIBUTES};t.attributesInfo=function(){return q.ATTRIBUTES_INFO};return q}(x.VTLMaterial);x.ATTRIBUTES=[];x.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}];x.ATTRIBUTES_INFO={};A.VTLBackgroundMaterial=x;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/maybe","../MemoryBuffer"],function(A,F,x,h){let q=function(){function c(a){this._locations=new Map;this._key=a}var d=c.prototype;d.defines=function(){return[]};d.getStride=function(){this._layoutInfo||this._buildAttributesInfo();return this._stride};d.getAttributeLocations=function(){0===this._locations.size&&this._buildAttributesInfo();return this._locations};d.getLayoutInfo=function(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo};d.getEncodingInfos=
function(){this._propertyEncodingInfo||this._buildAttributesInfo();return this._propertyEncodingInfo};d.getUniforms=function(){this._uniforms||this._buildAttributesInfo();return this._uniforms};d.getShaderHeader=function(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader};d.getShaderMain=function(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain};d.setDataUniforms=function(a,b,k,u,w){var p=this.getUniforms();for(const g of p){const {name:l,type:m,getValue:y}=
g;p=y(k,b,u,w);if(null!==p)switch(m){case "float":a.setUniform1f(l,p);break;case "vec2":a.setUniform2fv(l,p);break;case "vec4":a.setUniform4fv(l,p)}}};d.encodeAttributes=function(a,b,k,u){const w=this.attributesInfo(),p=this.getEncodingInfos(),g=[];let l=0,m=0;for(const B of Object.keys(p)){var y,D=p[B];const {type:r,precisionFactor:z,isLayout:I}=w[B],G=I?k.getLayoutProperty(B):k.getPaintProperty(B),J=null==(y=G.interpolator)?void 0:y.getInterpolationRange(b);let M=0;for(const L of D){const {offset:O,
bufferElementsToAdd:S}=L;if(0<S){for(D=0;D<S;D++)g.push(0);l+=m;m=L.bufferElementsToAdd}D=null!=u?u:G.getValue(J?J[M]:b,a);switch(r){case 0:case 1:g[l]|=this._encodeByte(D*(z||1),8*O);break;case 2:case 3:g[l]|=this._encodeShort(D*(z||1),8*O);break;case 4:case 5:g[l]|=this._encodeByte(D*(z||1),8*O);g[l]|=this._encodeByte(D*(z||1),8*O+8);break;case 6:case 7:g[l]|=this._encodeShort(D*(z||1),8*O);g[l]|=this._encodeShort(D*(z||1),8*O+16);break;case 8:case 9:g[l]|=this._encodeByte(D*(z||1),8*O);g[l]|=this._encodeByte(D*
(z||1),8*O+8);g[l]|=this._encodeByte(D*(z||1),8*O+16);g[l]|=this._encodeByte(D*(z||1),8*O+24);break;case 10:g[l]=this._encodeColor(D);break;case 11:case 12:this._encodePattern(l,g,D);break;default:throw Error("Unsupported encoding type");}M++}}return g};d.getAtributeState=function(a){const b=3+2*a;a=0|this._bit(b);return a|=this._bit(b+1)<<1};d._buildAttributesInfo=function(){const a=[],b={};var k={},u=-1;const w=this.attributesInfo();var p=this.attributes();let g=-1;for(const D of p){g++;p=this.getAtributeState(g);
if(0===p||3===p)continue;var l=w[D];const B=[];b[D]=B;l=l.type;for(let r=0;r<p;r++){const {dataType:z,bytesPerElement:I,count:G,normalized:J}=c._encodingInfo[l],M=I*G;let L=k[z];var m=0;!L||4<L.count+G?(u++,L={dataIndex:u,count:0,offset:0},4!==G&&(k[z]=L),a.push({location:-1,name:"a_data_"+u,count:G,type:z,normalized:J}),m=Math.ceil(Math.max(M/4,1))):(m=a[L.dataIndex],m.count+=G,m=Math.ceil(Math.max(m.count*I/4,1))-Math.ceil(Math.max(L.offset/4,1)));B.push({dataIndex:L.dataIndex,offset:L.offset,bufferElementsToAdd:m});
L.offset+=M;L.count+=G}}for(const D of a)switch(D.type){case 5120:case 5121:D.count=4;case 5122:case 5123:D.count+=D.count%2}this._buildVertexBufferLayout(a);k=0;u=this._layoutInfo.geometry;for(var y of u)this._locations.set(y.name,k++);if(y=this._layoutInfo.opacity)for(const D of y)this._locations.set(D.name,k++);this._buildShaderInfo(a,b);this._propertyEncodingInfo=b};d._buildVertexBufferLayout=function(a){const b={};var k=this.geometryInfo();let u=k[0].stride;if(0===a.length)b.geometry=k;else{const w=
[];let p=u;for(const g of a)u+=t(g.type)*g.count;for(const g of k)k={...g},k.stride=u,w.push(k);for(const g of a)w.push({name:g.name,count:g.count,type:g.type,offset:p,stride:u,normalized:g.normalized||!1,divisor:0}),p+=t(g.type)*g.count;b.geometry=w}this.opacityInfo()&&(b.opacity=this.opacityInfo());this._layoutInfo=b;this._stride=u};d._buildShaderInfo=function(a,b){let k="\n",u="\n";const w=[];for(var p of a)k+=`attribute ${this._getType(p.count)} ${p.name};\n`;var g=this.attributes();a=this.attributesInfo();
p=-1;for(const y of g){p++;const {name:D,type:B,precisionFactor:r,isLayout:z}=a[y];g=r&&1!==r?` * ${1/r}`:"";const {bytesPerElement:I,count:G}=c._encodingInfo[B];var l=J=>`a_data_${J.dataIndex}${e(G,J.offset,I)}`;switch(this.getAtributeState(p)){case 0:g=this._getType(G);var m=`u_${D}`;w.push({name:m,type:g,getValue:(J,M,L,O)=>{L=z?J.getLayoutValue(y,M):J.getPaintValue(y,M);if(11===B){J=J.getDashKey(L,J.getLayoutValue("line-cap",M));O=O.getMosaicItemPosition(J,!1);if(x.isNone(O))return null;const {tl:S,
br:T}=O;return[S[0],T[1],T[0],S[1]]}if(12===B){O=O.getMosaicItemPosition(L,-1===y.indexOf("line-"));if(x.isNone(O))return null;const {tl:S,br:T}=O;return[S[0],T[1],T[0],S[1]]}return 10===B?(O=L[3],[O*L[0],O*L[1],O*L[2],O]):L}});k+=`uniform ${g} ${m};\n`;u+=`${g} ${D} = ${m};\n`;break;case 1:m=l(b[y][0]);u+=`${this._getType(G)} ${D} = ${m}${g};\n`;break;case 2:{m=`u_t_${D}`;w.push({name:m,type:"float",getValue:(M,L,O,S)=>(z?M.getLayoutProperty(y):M.getPaintProperty(y)).interpolator.interpolationUniformValue(O,
L)});k+=`uniform float ${m};\n`;const J=l(b[y][0]);l=l(b[y][1]);u+=`${this._getType(G)} ${D} = mix(${J}${g}, ${l}${g}, ${m});\n`}}}this._shaderHeader=k;this._shaderMain=u;this._uniforms=w};d._bit=function(a){return(this._key&1<<a)>>a};d._getType=function(a){switch(a){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");};d._encodeColor=function(a){const b=255*a[3];return h.i8888to32(a[0]*b,a[1]*b,a[2]*b,b)};d._encodePattern=function(a,b,k){if(k&&
k.rect){var u=k.rect,w=k.width;k=k.height;b[a]=this._encodeShort(u.x+2,0);b[a]|=this._encodeShort(u.y+2+k,16);b[a+1]=this._encodeShort(u.x+2+w,0);b[a+1]|=this._encodeShort(u.y+2,16)}};d._encodeByte=function(a,b){return(a&255)<<b};d._encodeShort=function(a,b){return(a&65535)<<b};F._createClass(c,[{key:"key",get:function(){return this._key}},{key:"type",get:function(){return this._key&7}}]);return c}();q._encodingInfo={[0]:{dataType:5120,bytesPerElement:1,count:1,normalized:!1},[1]:{dataType:5121,bytesPerElement:1,
count:1,normalized:!1},[2]:{dataType:5122,bytesPerElement:2,count:1,normalized:!1},[3]:{dataType:5123,bytesPerElement:2,count:1,normalized:!1},[4]:{dataType:5120,bytesPerElement:1,count:2,normalized:!1},[5]:{dataType:5121,bytesPerElement:1,count:2,normalized:!1},[6]:{dataType:5122,bytesPerElement:2,count:2,normalized:!1},[7]:{dataType:5123,bytesPerElement:2,count:2,normalized:!1},[8]:{dataType:5120,bytesPerElement:1,count:4,normalized:!1},[9]:{dataType:5121,bytesPerElement:1,count:4,normalized:!1},
[10]:{dataType:5121,bytesPerElement:1,count:4,normalized:!0},[11]:{dataType:5123,bytesPerElement:2,count:4,normalized:!1},[12]:{dataType:5123,bytesPerElement:2,count:4,normalized:!1}};const t=c=>{switch(c){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1}},e=(c,d,a)=>{d/=a;if(1===c)switch(d){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===c)switch(d){case 0:return".xy";case 1:return".yz";
case 2:return".zw"}else if(3===c)switch(d){case 0:return".xyz";case 1:return".yzw"}return""};A.VTLMaterial=q;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],function(A){return function(){function F(h){this._array=[];0>=h&&console.error("strideInBytes must be positive!");this._stride=h}var x=F.prototype;x.reset=function(){this.array.length=0};x.toBuffer=function(){return(new Uint32Array(this._array)).buffer};
F.i1616to32=function(h,q){return 65535&h|q<<16};F.i8888to32=function(h,q,t,e){return h&255|(q&255)<<8|(t&255)<<16|e<<24};F.i8816to32=function(h,q,t){return h&255|(q&255)<<8|t<<16};A._createClass(F,[{key:"array",get:function(){return this._array}},{key:"index",get:function(){return 4*this._array.length/this._stride}},{key:"itemSize",get:function(){return this._stride}},{key:"sizeInBytes",get:function(){return 4*this._array.length}}]);return F}()})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(A,F,x){x=function(h){function q(e){return h.call(this,e)||this}F._inheritsLoose(q,h);var t=q.prototype;t.geometryInfo=function(){return q.GEOMETRY_LAYOUT};t.opacityInfo=function(){return null};t.attributes=function(){return q.ATTRIBUTES};t.attributesInfo=function(){return q.ATTRIBUTES_INFO};return q}(x.VTLMaterial);x.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");
x.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}];x.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:1},"circle-color":{name:"color",type:10},"circle-opacity":{name:"opacity",type:1,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:1,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:10},"circle-stroke-opacity":{name:"stroke_opacity",type:1,precisionFactor:100},"circle-blur":{name:"blur",type:1,precisionFactor:32}};
A.VTLCircleMaterial=x;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(A,F,x){let h=function(q){function t(c){return q.call(this,c)||this}F._inheritsLoose(t,q);var e=t.prototype;e.geometryInfo=function(){return t.GEOMETRY_LAYOUT};e.opacityInfo=function(){return null};e.attributes=function(){return t.ATTRIBUTES};e.attributesInfo=function(){return t.ATTRIBUTES_INFO};
return t}(x.VTLMaterial);h.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];h.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}];h.ATTRIBUTES_INFO={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100},"fill-pattern":{name:"tlbr",type:12,isOptional:!0}};x=function(q){function t(c,d){c=q.call(this,c)||this;c.usefillColor=d;return c}F._inheritsLoose(t,q);var e=t.prototype;e.geometryInfo=function(){return t.GEOMETRY_LAYOUT};
e.opacityInfo=function(){return null};e.attributes=function(){return this.usefillColor?t.ATTRIBUTES_FILL:t.ATTRIBUTES_OUTLINE};e.attributesInfo=function(){return this.usefillColor?t.ATTRIBUTES_INFO_FILL:t.ATTRIBUTES_INFO_OUTLINE};return t}(x.VTLMaterial);x.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];x.ATTRIBUTES_FILL=["fill-color","fill-opacity"];x.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,
normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}];x.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}};x.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}};A.VTLFillMaterial=h;A.VTLOutlineMaterial=x;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(A,F,x){x=function(h){function q(e){return h.call(this,e)||this}F._inheritsLoose(q,h);var t=q.prototype;t.geometryInfo=function(){return q.GEOMETRY_LAYOUT};t.opacityInfo=function(){return null};t.attributes=function(){return q.ATTRIBUTES};t.attributesInfo=function(){return q.ATTRIBUTES_INFO};return q}(x.VTLMaterial);x.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");
x.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_extrude_offset",count:4,type:5120,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_dir_normal",count:4,type:5120,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:12,stride:16,normalized:!1,divisor:0}];x.ATTRIBUTES_INFO={"line-width":{name:"width",type:1,precisionFactor:2},"line-gap-width":{name:"gap_width",type:1,precisionFactor:2},"line-offset":{name:"offset",
type:0,precisionFactor:2},"line-color":{name:"color",type:10},"line-opacity":{name:"opacity",type:1,precisionFactor:100},"line-blur":{name:"blur",type:1,precisionFactor:4},"line-pattern":{name:"tlbr",type:12,isOptional:!0},"line-dasharray":{name:"tlbr",type:11,isOptional:!0}};A.VTLLineMaterial=x;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],
function(A,F,x){const h=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],q=[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}];let t=function(e){function c(a){return e.call(this,a)||this}
F._inheritsLoose(c,e);var d=c.prototype;d.geometryInfo=function(){return h};d.opacityInfo=function(){return q};d.attributes=function(){return c.ATTRIBUTES};d.attributesInfo=function(){return c.ATTRIBUTES_INFO};return c}(x.VTLMaterial);t.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");t.ATTRIBUTES_INFO={"icon-color":{name:"color",type:10},"icon-opacity":{name:"opacity",type:1,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:10},
"icon-halo-width":{name:"halo_width",type:1,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"icon-size":{name:"size",type:1,precisionFactor:32,isLayout:!0}};x=function(e){function c(a){return e.call(this,a)||this}F._inheritsLoose(c,e);var d=c.prototype;d.geometryInfo=function(){return h};d.opacityInfo=function(){return q};d.attributes=function(){return c.ATTRIBUTES};d.attributesInfo=function(){return c.ATTRIBUTES_INFO};return c}(x.VTLMaterial);x.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");
x.ATTRIBUTES_INFO={"text-color":{name:"color",type:10},"text-opacity":{name:"opacity",type:1,precisionFactor:100},"text-halo-color":{name:"halo_color",type:10},"text-halo-width":{name:"halo_width",type:1,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"text-size":{name:"size",type:1,isLayout:!0}};A.VTLIconMaterial=t;A.VTLTextMaterial=x;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression",
"../expression/types"],function(A,F){return function(){function x(h){this._expression=h}x.prototype.filter=function(h,q){if(!this._expression)return!0;try{return this._expression.evaluate(h,q)}catch(t){return console.log(t.message),!0}};x.createFilter=function(h){if(!h)return null;this.isLegacyFilter(h)&&(h=this.convertLegacyFilter(h));try{const q=A.createExpression(h,null,F.BooleanType);return new x(q)}catch(q){return console.log(q.message),null}};x.isLegacyFilter=function(h){if(!Array.isArray(h)||
0===h.length)return!0;switch(h[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===h.length&&"string"===typeof h[1]&&!Array.isArray(h[2]);case "in":return 3<=h.length&&"string"===typeof h[1]&&!Array.isArray(h[2]);case "!in":return!0;case "any":case "all":for(let q=1;q<h.length;q++)if(!this.isLegacyFilter(h[1]))return!1;return!0;case "none":return!0;case "has":return 2===h.length&&("$id"===h[1]||"$type"===h[1]);case "!has":return!0;default:return!1}};
x.convertLegacyFilter=function(h){if(!Array.isArray(h)||0===h.length)return!0;const q=h[0];if(1===h.length)return"any"!==q;switch(q){case "\x3d\x3d":return x.convertComparison("\x3d\x3d",h[1],h[2]);case "!\x3d":return x.negate(x.convertComparison("\x3d\x3d",h[1],h[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return x.convertComparison(q,h[1],h[2]);case "in":return x.convertIn(h[1],h.slice(2));case "!in":return x.negate(x.convertIn(h[1],h.slice(2)));case "any":case "all":case "none":return x.convertCombining(q,
h.slice(1));case "has":return x.convertHas(h[1]);case "!has":return x.negate(x.convertHas(h[1]));default:throw Error("Unexpected legacy filter.");}};x.convertComparison=function(h,q,t){switch(q){case "$type":return[h,["geometry-type"],t];case "$id":return[h,["id"],t];default:return[h,["get",q],t]}};x.convertIn=function(h,q){switch(h){case "$type":return["in",["geometry-type"],["literal",q]];case "$id":return["in",["id"],["literal",q]];default:return["in",["get",h],["literal",q]]}};x.convertHas=function(h){switch(h){case "$type":return!0;
case "$id":return["has-id"];default:return["has",h]}};x.convertCombining=function(h,q){return[h].concat(q.map(this.convertLegacyFilter))};x.negate=function(h){return["!",h]};return x}()})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../Color ../../../../../core/colorUtils ../../../unitBezier ../GeometryUtils ./types".split(" "),function(A,F,x,h,q,t,e){function c(v,f,n){var C=typeof v;if("string"===
C||"boolean"===C||"number"===C||null===v){if(n)switch(n.kind){case "string":"string"!==C&&(v=ea.toString(v));break;case "number":"number"!==C&&(v=ea.toNumber(v));break;case "color":v=ea.toColor(v)}v=["literal",v]}if(!Array.isArray(v)||0===v.length)throw Error("Expression must be a non empty array");C=v[0];if("string"!==typeof C)throw Error("First element of expression must be a string");const E=ja[C];if(void 0===E)throw Error(`Invalid expression operator "${C}"`);if(!E)throw Error(`Unimplemented expression operator "${C}"`);
return E.parse(v,f,n)}let d=function(){function v(n){this.parent=n;this.vars={}}var f=v.prototype;f.add=function(n,C){this.vars[n]=C};f.get=function(n){return this.vars[n]?this.vars[n]:this.parent?this.parent.get(n):null};return v}(),a=function(){function v(){this.type=e.ValueType}v.parse=function(f){if(1<f.length)throw Error('"id" does not expect arguments');return new v};v.prototype.evaluate=function(f,n){return null==f?void 0:f.id};return v}(),b=function(){function v(){this.type=e.StringType}v.parse=
function(f){if(1<f.length)throw Error('"geometry-type" does not expect arguments');return new v};v.prototype.evaluate=function(f,n){if(!f)return null;switch(f.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}};return v}(),k=function(){function v(){this.type=e.ObjectType}v.parse=function(f){if(1<f.length)throw Error('"properties" does not expect arguments');return new v};v.prototype.evaluate=function(f,n){return null==f?void 0:f.values};return v}(),u=
function(){function v(){this.type=e.NumberType}v.parse=function(f){if(1<f.length)throw Error('"zoom" does not expect arguments');return new v};v.prototype.evaluate=function(f,n){return n};return v}(),w=function(){function v(f,n,C){this.lhs=f;this.rhs=n;this.compare=C;this.type=e.BooleanType}v.parse=function(f,n,C){if(3!==f.length&&4!==f.length)throw Error(`"${f[0]}" expects 2 or 3 arguments`);if(4===f.length)throw Error(`"${f[0]}" collator not supported`);return new v(c(f[1],n),c(f[2],n),C)};v.prototype.evaluate=
function(f,n){return this.compare(this.lhs.evaluate(f,n),this.rhs.evaluate(f,n))};return v}(),p=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){return w.parse(n,C,(E,K)=>E===K)};return f}(w),g=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){return w.parse(n,C,(E,K)=>E!==K)};return f}(w),l=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,
C){return w.parse(n,C,(E,K)=>E<K)};return f}(w),m=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){return w.parse(n,C,(E,K)=>E<=K)};return f}(w),y=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){return w.parse(n,C,(E,K)=>E>K)};return f}(w),D=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){return w.parse(n,C,(E,K)=>E>=K)};return f}(w),
B=function(){function v(f){this.arg=f;this.type=e.BooleanType}v.parse=function(f,n){if(2!==f.length)throw Error('"!" expects 1 argument');return new v(c(f[1],n))};v.prototype.evaluate=function(f,n){return!this.arg.evaluate(f,n)};return v}(),r=function(){function v(f){this.args=f;this.type=e.BooleanType}v.parse=function(f,n){const C=[];for(let E=1;E<f.length;E++)C.push(c(f[E],n));return new v(C)};v.prototype.evaluate=function(f,n){for(const C of this.args)if(!C.evaluate(f,n))return!1;return!0};return v}(),
z=function(){function v(f){this.args=f;this.type=e.BooleanType}v.parse=function(f,n){const C=[];for(let E=1;E<f.length;E++)C.push(c(f[E],n));return new v(C)};v.prototype.evaluate=function(f,n){for(const C of this.args)if(C.evaluate(f,n))return!0;return!1};return v}(),I=function(){function v(f){this.args=f;this.type=e.BooleanType}v.parse=function(f,n){const C=[];for(let E=1;E<f.length;E++)C.push(c(f[E],n));return new v(C)};v.prototype.evaluate=function(f,n){for(const C of this.args)if(C.evaluate(f,
n))return!1;return!0};return v}(),G=function(){function v(f,n,C){this.type=f;this.args=n;this.fallback=C}v.parse=function(f,n,C){if(4>f.length)throw Error('"case" expects at least 3 arguments');if(1===f.length%2)throw Error('"case" expects an odd number of arguments');let E;const K=[];for(let Q=1;Q<f.length-1;Q+=2){const W=c(f[Q],n),U=c(f[Q+1],n,C);E||(E=U.type);K.push({condition:W,output:U})}f=c(f[f.length-1],n,C);E||(E=f.type);return new v(E,K,f)};v.prototype.evaluate=function(f,n){for(const C of this.args)if(C.condition.evaluate(f,
n))return C.output.evaluate(f,n);return this.fallback.evaluate(f,n)};return v}(),J=function(){function v(f,n){this.type=f;this.args=n}v.parse=function(f,n){if(2>f.length)throw Error('"coalesce" expects at least 1 argument');let C;const E=[];for(let K=1;K<f.length;K++){const Q=c(f[K],n);C||(C=Q.type);E.push(Q)}return new v(C,E)};v.prototype.evaluate=function(f,n){for(const C of this.args){const E=C.evaluate(f,n);if(null!==E)return E}return null};return v}(),M=function(){function v(f,n,C,E,K){this.type=
f;this.input=n;this.labels=C;this.outputs=E;this.fallback=K}v.parse=function(f,n){if(3>f.length)throw Error('"match" expects at least 3 arguments');if(0===f.length%2)throw Error('"case" expects an even number of arguments');let C;const E=c(f[1],n),K=[],Q={};let W;for(let Z=2;Z<f.length-1;Z+=2){var U=f[Z];Array.isArray(U)||(U=[U]);for(const fa of U){U=typeof fa;if("string"!==U&&"number"!==U)throw Error('"match" requires string or number literal as labels');if(!W)W=U;else if(U!==W)throw Error('"match" requires labels to have the same type');
Q[fa]=K.length}U=c(f[Z+1],n);C||(C=U.type);K.push(U)}return new v(C,E,Q,K,c(f[f.length-1],n))};v.prototype.evaluate=function(f,n){const C=this.input.evaluate(f,n);return(this.outputs[this.labels[C]]||this.fallback).evaluate(f,n)};return v}(),L=function(){function v(n,C,E,K,Q){this.operator=n;this.type=C;this.interpolation=E;this.input=K;this.stops=Q}v.parse=function(n,C,E){const K=n[0];if(5>n.length)throw Error(`"${K}" expects at least 4 arguments`);const Q=n[1];if(!Array.isArray(Q)||0===Q.length)throw Error(`"${Q}" is not a valid interpolation`);
switch(Q[0]){case "linear":if(1!==Q.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==Q.length||"number"!==typeof Q[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==Q.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var W=1;5>W;W++){var U=Q[W];if("number"!==typeof U||0>U||1<U)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");
}break;default:throw Error(`"${n[0]}" unknown interpolation type "${Q[0]}"`);}if(1!==n.length%2)throw Error(`"${K}" expects an even number of arguments`);W=c(n[2],C,e.NumberType);let Z;"interpolate-hcl"===K||"interpolate-lab"===K?Z=e.ColorType:E&&"value"!==E.kind&&(Z=E);E=[];for(U=3;U<n.length;U+=2){const fa=n[U];if("number"!==typeof fa)throw Error(`"${K}" requires stop inputs as literal numbers`);if(E.length&&E[E.length-1][0]>=fa)throw Error(`"${K}" requires strictly ascending stop inputs`);const ka=
c(n[U+1],C,Z);Z||(Z=ka.type);E.push([fa,ka])}if(Z&&Z!==e.ColorType&&Z!==e.NumberType&&("array"!==Z.kind||Z.itemType!==e.NumberType))throw Error(`"${K}" cannot interpolate type ${e.typeToString(Z)}`);return new v(K,Z,Q,W,E)};var f=v.prototype;f.evaluate=function(n,C){var E=this.stops;if(1===E.length)return E[0][1].evaluate(n,C);var K=this.input.evaluate(n,C);if(K<=E[0][0])return E[0][1].evaluate(n,C);if(K>=E[E.length-1][0])return E[E.length-1][1].evaluate(n,C);let Q=0;for(;++Q<E.length&&!(K<E[Q][0]););
const W=v.interpolationRatio(this.interpolation,K,E[Q-1][0],E[Q][0]);K=E[Q-1][1].evaluate(n,C);const U=E[Q][1].evaluate(n,C);if("interpolate"===this.operator){if("array"===this.type.kind&&Array.isArray(K)&&Array.isArray(U))return K.map((Z,fa)=>t.interpolate(Z,U[fa],W));if("color"===this.type.kind&&K instanceof x&&U instanceof x)return K=new x(K),n=new x(U),new x([t.interpolate(K.r,n.r,W),t.interpolate(K.g,n.g,W),t.interpolate(K.b,n.b,W),t.interpolate(K.a,n.a,W)]);if("number"===this.type.kind&&"number"===
typeof K&&"number"===typeof U)return t.interpolate(K,U,W);throw Error(`"${this.operator}" cannot interpolate type ${e.typeToString(this.type)}`);}if("interpolate-hcl"===this.operator)return n=h.toLCH(K),C=h.toLCH(U),E=C.h-n.h,n=h.toRGB({h:n.h+W*(180<E||-180>E?E-360*Math.round(E/360):E),c:t.interpolate(n.c,C.c,W),l:t.interpolate(n.l,C.l,W)}),new x({a:t.interpolate(K.a,U.a,W),...n});if("interpolate-lab"===this.operator)return n=h.toLAB(K),C=h.toLAB(U),n=h.toRGB({l:t.interpolate(n.l,C.l,W),a:t.interpolate(n.a,
C.a,W),b:t.interpolate(n.b,C.b,W)}),new x({a:t.interpolate(K.a,U.a,W),...n});throw Error(`Unexpected operator "${this.operator}"`);};f.interpolationUniformValue=function(n,C){const E=this.stops;if(1===E.length||n>=E[E.length-1][0])return 0;let K=0;for(;++K<E.length&&!(n<E[K][0]););return v.interpolationRatio(this.interpolation,C,E[K-1][0],E[K][0])};f.getInterpolationRange=function(n){const C=this.stops;if(1===C.length)return n=C[0][0],[n,n];var E=C[C.length-1][0];if(n>=E)return[E,E];for(E=0;++E<C.length&&
!(n<C[E][0]););return[C[E-1][0],C[E][0]]};v.interpolationRatio=function(n,C,E,K){let Q=0;"linear"===n[0]?Q=v.exponentialInterpolationRatio(C,1,E,K):"exponential"===n[0]?Q=v.exponentialInterpolationRatio(C,n[1],E,K):"cubic-bezier"===n[0]&&(Q=q.unitBezier(n[1],n[2],n[3],n[4])(v.exponentialInterpolationRatio(C,1,E,K),1E-5));0>Q?Q=0:1<Q&&(Q=1);return Q};v.exponentialInterpolationRatio=function(n,C,E,K){K-=E;if(0===K)return 0;n-=E;return 1===C?n/K:(C**n-1)/(C**K-1)};return v}(),O=function(){function v(f,
n,C){this.type=f;this.input=n;this.stops=C}v.parse=function(f,n){if(5>f.length)throw Error('"step" expects at least 4 arguments');if(1!==f.length%2)throw Error('"step" expects an even number of arguments');const C=c(f[1],n,e.NumberType);let E;const K=[];K.push([-Infinity,c(f[2],n)]);for(let Q=3;Q<f.length;Q+=2){const W=f[Q];if("number"!==typeof W)throw Error('"step" requires stop inputs as literal numbers');if(K.length&&K[K.length-1][0]>=W)throw Error('"step" requires strictly ascending stop inputs');
const U=c(f[Q+1],n);E||(E=U.type);K.push([W,U])}return new v(E,C,K)};v.prototype.evaluate=function(f,n){const C=this.stops;if(1===C.length)return C[0][1].evaluate(f,n);const E=this.input.evaluate(f,n);let K=0;for(;++K<C.length&&!(E<C[K][0]););return this.stops[K-1][1].evaluate(f,n)};return v}(),S=function(){function v(f,n){this.type=f;this.output=n}v.parse=function(f,n,C){if(4>f.length)throw Error('"let" expects at least 3 arguments');if(1===f.length%2)throw Error('"let" expects an odd number of arguments');
const E=new d(n);for(let K=1;K<f.length-1;K+=2){const Q=f[K];if("string"!==typeof Q)throw Error(`"let" requires a string to define variable names - found ${Q}`);E.add(Q,c(f[K+1],n))}f=c(f[f.length-1],E,C);return new v(f.type,f)};v.prototype.evaluate=function(f,n){return this.output.evaluate(f,n)};return v}(),T=function(){function v(f,n){this.type=f;this.output=n}v.parse=function(f,n,C){if(2!==f.length||"string"!==typeof f[1])throw Error('"var" requires just one literal string argument');n=n.get(f[1]);
if(!n)throw Error(`${f[1]} must be defined before being used in a "var" expression`);return new v(C||e.ValueType,n)};v.prototype.evaluate=function(f,n){return this.output.evaluate(f,n)};return v}(),R=function(){function v(f,n,C){this.type=f;this.index=n;this.array=C}v.parse=function(f,n){if(3!==f.length)throw Error('"at" expects 2 arguments');const C=c(f[1],n,e.NumberType);f=c(f[2],n);return new v(f.type.itemType,C,f)};v.prototype.evaluate=function(f,n){const C=this.index.evaluate(f,n);f=this.array.evaluate(f,
n);if(0>C||C>=f.length)throw Error('"at" index out of bounds');if(C!==Math.floor(C))throw Error('"at" index must be an integer');return f[C]};return v}(),H=function(){function v(f,n){this.key=f;this.obj=n;this.type=e.ValueType}v.parse=function(f,n){let C;switch(f.length){case 2:return C=c(f[1],n),new v(C);case 3:return C=c(f[1],n),f=c(f[2],n),new v(C,f);default:throw Error('"get" expects 1 or 2 arguments');}};v.prototype.evaluate=function(f,n){const C=this.key.evaluate(f,n);return this.obj?this.obj.evaluate(f,
n)[C]:null==f?void 0:f.values[C]};return v}(),N=function(){function v(f,n){this.key=f;this.obj=n;this.type=e.BooleanType}v.parse=function(f,n){let C;switch(f.length){case 2:return C=c(f[1],n),new v(C);case 3:return C=c(f[1],n),f=c(f[2],n),new v(C,f);default:throw Error('"has" expects 1 or 2 arguments');}};v.prototype.evaluate=function(f,n){const C=this.key.evaluate(f,n);return this.obj?(f=this.obj.evaluate(f,n),C in f):!(null==f||!f.values[C])};return v}(),P=function(){function v(f,n){this.key=f;
this.vals=n;this.type=e.BooleanType}v.parse=function(f,n){if(3!==f.length)throw Error('"in" expects 2 arguments');return new v(c(f[1],n),c(f[2],n))};v.prototype.evaluate=function(f,n){const C=this.key.evaluate(f,n);return-1!==this.vals.evaluate(f,n).indexOf(C)};return v}(),V=function(){function v(f,n,C){this.item=f;this.array=n;this.from=C;this.type=e.NumberType}v.parse=function(f,n){if(3>f.length||4<f.length)throw Error('"index-of" expects 3 or 4 arguments');const C=c(f[1],n),E=c(f[2],n);return 4===
f.length?(f=c(f[3],n,e.NumberType),new v(C,E,f)):new v(C,E)};v.prototype.evaluate=function(f,n){const C=this.item.evaluate(f,n),E=this.array.evaluate(f,n);if(this.from){f=this.from.evaluate(f,n);if(f!==Math.floor(f))throw Error('"index-of" index must be an integer');return E.indexOf(C,f)}return E.indexOf(C)};return v}(),ba=function(){function v(f){this.arg=f;this.type=e.NumberType}v.parse=function(f,n){if(2!==f.length)throw Error('"length" expects 2 arguments');f=c(f[1],n);return new v(f)};v.prototype.evaluate=
function(f,n){f=this.arg.evaluate(f,n);if("string"===typeof f||Array.isArray(f))return f.length;throw Error('"length" expects string or array');};return v}(),ca=function(){function v(f,n,C,E){this.type=f;this.array=n;this.from=C;this.to=E}v.parse=function(f,n){if(3>f.length||4<f.length)throw Error('"slice" expects 2 or 3 arguments');const C=c(f[1],n),E=c(f[2],n,e.NumberType);if(E.type!==e.NumberType)throw Error('"slice" index must return a number');if(4===f.length){f=c(f[3],n,e.NumberType);if(f.type!==
e.NumberType)throw Error('"slice" index must return a number');return new v(C.type,C,E,f)}return new v(C.type,C,E)};v.prototype.evaluate=function(f,n){const C=this.array.evaluate(f,n);if(!Array.isArray(C)&&"string"!==typeof C)throw Error('"slice" input must be an array or a string');const E=this.from.evaluate(f,n);if(0>E||E>=C.length)throw Error('"slice" index out of bounds');if(E!==Math.floor(E))throw Error('"slice" index must be an integer');if(this.to){f=this.to.evaluate(f,n);if(0>f||f>=C.length)throw Error('"slice" index out of bounds');
if(f!==Math.floor(f))throw Error('"slice" index must be an integer');return C.slice(E,f)}return C.slice(E)};return v}(),da=function(){function v(){this.type=e.BooleanType}v.parse=function(f){if(1!==f.length)throw Error('"has-id" expects no arguments');return new v};v.prototype.evaluate=function(f,n){return f&&void 0!==f.id};return v}(),X=function(){function v(f,n){this.args=f;this.calculate=n;this.type=e.NumberType}v.parse=function(f,n,C){f=f.slice(1).map(E=>c(E,n));return new v(f,C)};v.prototype.evaluate=
function(f,n){let C;this.args&&(C=this.args.map(E=>E.evaluate(f,n)));return this.calculate(C)};return v}(),aa=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){switch(n.length){case 2:return X.parse(n,C,E=>-E[0]);case 3:return X.parse(n,C,E=>E[0]-E[1]);default:throw Error('"-" expects 1 or 2 arguments');}};return f}(X),la=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){return X.parse(n,
C,E=>{let K=1;for(const Q of E)K*=Q;return K})};return f}(X),ma=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){if(3===n.length)return X.parse(n,C,E=>E[0]/E[1]);throw Error('"/" expects 2 arguments');};return f}(X),na=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){if(3===n.length)return X.parse(n,C,E=>E[0]%E[1]);throw Error('"%" expects 2 arguments');};return f}(X),oa=function(v){function f(){return v.apply(this,
arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){if(3===n.length)return X.parse(n,C,E=>E[0]**E[1]);throw Error('"^" expects 1 or 2 arguments');};return f}(X),pa=function(v){function f(){return v.apply(this,arguments)||this}F._inheritsLoose(f,v);f.parse=function(n,C){return X.parse(n,C,E=>{let K=0;for(const Q of E)K+=Q;return K})};return f}(X),Y=function(){function v(f,n){this.args=f;this.calculate=n;this.type=e.NumberType}v.parse=function(f,n){const C=f.slice(1).map(E=>c(E,n));return new v(C,
v.ops[f[0]])};v.prototype.evaluate=function(f,n){let C;this.args&&(C=this.args.map(E=>E.evaluate(f,n)));return this.calculate(C)};return v}();Y.ops={abs:v=>Math.abs(v[0]),acos:v=>Math.acos(v[0]),asin:v=>Math.asin(v[0]),atan:v=>Math.atan(v[0]),ceil:v=>Math.ceil(v[0]),cos:v=>Math.cos(v[0]),e:()=>Math.E,floor:v=>Math.floor(v[0]),ln:v=>Math.log(v[0]),ln2:()=>Math.LN2,log10:v=>Math.log(v[0])/Math.LN10,log2:v=>Math.log(v[0])/Math.LN2,max:v=>Math.max(...v),min:v=>Math.min(...v),pi:()=>Math.PI,round:v=>Math.round(v[0]),
sin:v=>Math.sin(v[0]),sqrt:v=>Math.sqrt(v[0]),tan:v=>Math.tan(v[0])};let qa=function(){function v(f){this.args=f;this.type=e.StringType}v.parse=function(f,n){return new v(f.slice(1).map(C=>c(C,n)))};v.prototype.evaluate=function(f,n){return this.args.map(C=>C.evaluate(f,n)).join("")};return v}(),ia=function(){function v(f,n){this.arg=f;this.calculate=n;this.type=e.StringType}v.parse=function(f,n){if(2!==f.length)throw Error(`${f[0]} expects 1 argument`);n=c(f[1],n);return new v(n,v.ops[f[0]])};v.prototype.evaluate=
function(f,n){return this.calculate(this.arg.evaluate(f,n))};return v}();ia.ops={downcase:v=>v.toLowerCase(),upcase:v=>v.toUpperCase()};let ra=function(){function v(n){this.args=n;this.type=e.ColorType}v.parse=function(n,C){if(4!==n.length)throw Error('"rgb" expects 3 arguments');n=n.slice(1).map(E=>c(E,C));return new v(n)};var f=v.prototype;f.evaluate=function(n,C){const E=this._validate(this.args[0].evaluate(n,C)),K=this._validate(this.args[1].evaluate(n,C));n=this._validate(this.args[2].evaluate(n,
C));return new x({r:E,g:K,b:n})};f._validate=function(n){if("number"!==typeof n||0>n||255<n)throw Error(`${n}: invalid color component`);return Math.round(n)};return v}(),sa=function(){function v(n){this.args=n;this.type=e.ColorType}v.parse=function(n,C){if(5!==n.length)throw Error('"rgba" expects 4 arguments');n=n.slice(1).map(E=>c(E,C));return new v(n)};var f=v.prototype;f.evaluate=function(n,C){const E=this._validate(this.args[0].evaluate(n,C)),K=this._validate(this.args[1].evaluate(n,C)),Q=this._validate(this.args[2].evaluate(n,
C));n=this._validateAlpha(this.args[3].evaluate(n,C));return new x({r:E,g:K,b:Q,a:n})};f._validate=function(n){if("number"!==typeof n||0>n||255<n)throw Error(`${n}: invalid color component`);return Math.round(n)};f._validateAlpha=function(n){if("number"!==typeof n||0>n||1<n)throw Error(`${n}: invalid alpha color component`);return n};return v}(),ta=function(){function v(f){this.color=f;this.type=e.arrayType(e.NumberType,4)}v.parse=function(f,n){if(2!==f.length)throw Error('"to-rgba" expects 1 argument');
f=c(f[1],n);return new v(f)};v.prototype.evaluate=function(f,n){return(new x(this.color.evaluate(f,n))).toRgba()};return v}(),ha=function(){function v(f,n){this.type=f;this.args=n}v.parse=function(f,n){var C=f[0];if(2>f.length)throw Error(`${C} expects at least one argument`);let E=1,K;if("array"===C){if(2<f.length){switch(f[1]){case "string":K=e.StringType;break;case "number":K=e.NumberType;break;case "boolean":K=e.BooleanType;break;default:throw Error('"array" type argument must be string, number or boolean');
}E++}else K=e.ValueType;if(3<f.length){var Q=f[2];if(null!==Q&&("number"!==typeof Q||0>Q||Q!==Math.floor(Q)))throw Error('"array" length argument must be a positive integer literal');E++}K=e.arrayType(K,Q)}else switch(C){case "string":K=e.StringType;break;case "number":K=e.NumberType;break;case "boolean":K=e.BooleanType;break;case "object":K=e.ObjectType}for(C=[];E<f.length;E++)Q=c(f[E],n),C.push(Q);return new v(K,C)};v.prototype.evaluate=function(f,n){let C;for(const E of this.args){const K=E.evaluate(f,
n);C=e.getType(K);if(e.matchType(C,this.type))return K}throw Error(`Expected ${e.typeToString(this.type)} but got ${e.typeToString(C)}`);};return v}(),ea=function(){function v(f,n){this.type=f;this.args=n}v.parse=function(f,n){var C=f[0];const E=v.types[C];if(E===e.BooleanType||E===e.StringType){if(2!==f.length)throw Error(`${C} expects one argument`);}else if(2>f.length)throw Error(`${C} expects at least one argument`);C=[];for(let K=1;K<f.length;K++){const Q=c(f[K],n);C.push(Q)}return new v(E,C)};
v.prototype.evaluate=function(f,n){if(this.type===e.BooleanType)return!!this.args[0].evaluate(f,n);if(this.type===e.StringType)return e.valueToString(this.args[0].evaluate(f,n));if(this.type===e.NumberType){for(const E of this.args){var C=Number(E.evaluate(f,n));if(!isNaN(C))return C}return null}if(this.type===e.ColorType){for(C of this.args)try{const E=v.toColor(C.evaluate(f,n));if(E instanceof x)return E}catch{}return null}};v.toBoolean=function(f){return!!f};v.toString=function(f){return e.valueToString(f)};
v.toNumber=function(f){const n=Number(f);if(isNaN(n))throw Error(`"${f}" is not a number`);return n};v.toColor=function(f){if(f instanceof x)return f;if("string"===typeof f){const n=x.fromString(f);if(n)return n;throw Error(`"${f}" is not a color`);}if(Array.isArray(f))return x.fromArray(f);throw Error(`"${f}" is not a color`);};return v}();ea.types={"to-boolean":e.BooleanType,"to-color":e.ColorType,"to-number":e.NumberType,"to-string":e.StringType};let ua=function(){function v(f){this.val=f;this.type=
e.getType(f)}v.parse=function(f){if(2!==f.length)throw Error('"literal" expects 1 argument');return new v(f[1])};v.prototype.evaluate=function(f,n){return this.val};return v}(),va=function(){function v(f){this.arg=f;this.type=e.StringType}v.parse=function(f,n){if(2!==f.length)throw Error('"typeof" expects 1 argument');return new v(c(f[1],n))};v.prototype.evaluate=function(f,n){return e.typeToString(e.getType(this.arg.evaluate(f,n)))};return v}();const ja={array:ha,boolean:ha,collator:null,format:null,
image:null,literal:ua,number:ha,"number-format":null,object:ha,string:ha,"to-boolean":ea,"to-color":ea,"to-number":ea,"to-string":ea,typeof:va,accumulated:null,"feature-state":null,"geometry-type":b,id:a,"line-progress":null,properties:k,at:R,get:H,has:N,in:P,"index-of":V,length:ba,slice:ca,"!":B,"!\x3d":g,"\x3c":l,"\x3c\x3d":m,"\x3d\x3d":p,"\x3e":y,"\x3e\x3d":D,all:r,any:z,case:G,coalesce:J,match:M,within:null,interpolate:L,"interpolate-hcl":L,"interpolate-lab":L,step:O,let:S,var:T,concat:qa,downcase:ia,
"is-supported-script":null,"resolved-locale":null,upcase:ia,rgb:ra,rgba:sa,"to-rgba":ta,"-":aa,"*":la,"/":ma,"%":na,"^":oa,"+":pa,abs:Y,acos:Y,asin:Y,atan:Y,ceil:Y,cos:Y,e:Y,floor:Y,ln:Y,ln2:Y,log10:Y,log2:Y,max:Y,min:Y,pi:Y,round:Y,sin:Y,sqrt:Y,tan:Y,zoom:u,"heatmap-density":null,"has-id":da,none:I};A.ALL=r;A.ANY=z;A.Add=pa;A.Assert=ha;A.At=R;A.Calculate=Y;A.Case=G;A.Coalesce=J;A.Coerce=ea;A.Concat=qa;A.Div=ma;A.EQ=p;A.GE=D;A.GT=y;A.GeomType=b;A.Get=H;A.Has=N;A.HasID=da;A.ID=a;A.In=P;A.IndexOf=V;
A.Interpolate=L;A.LE=m;A.LT=l;A.Length=ba;A.Let=S;A.Literal=ua;A.Match=M;A.Mod=na;A.Mul=la;A.NE=g;A.NONE=I;A.NOT=B;A.Pow=oa;A.Properties=k;A.Rgb=ra;A.Rgba=sa;A.Slice=ca;A.Step=O;A.String=ia;A.Sub=aa;A.ToRgba=ta;A.TypeOf=va;A.Var=T;A.Zoom=u;A.createExpression=c;A.ops=ja;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/core/colorUtils":function(){define(["exports"],function(A){function F(a,b){const k=[];let u,w;if(a[0].length!==b.length)throw"dimensions do not match";const p=a.length,g=a[0].length;
let l=0;for(u=0;u<p;u++){for(w=l=0;w<g;w++)l+=a[u][w]*b[w];k.push(l)}return k}function x(a){a=[a.r/255,a.g/255,a.b/255].map(b=>.04045>=b?b/12.92:((b+.055)/1.055)**2.4);a=F(c,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}}function h(a){a=F(d,[a.x/100,a.y/100,a.z/100]).map(b=>Math.min(1,Math.max(.0031308>=b?12.92*b:1.055*b**(1/2.4)-.055,0)));return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function q(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(b=>b>(6/29)**3?b**(1/3):1/3*(29/
6)**2*b+4/29);return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}}function t(a){const b=a.l;a=[(b+16)/116+a.a/500,(b+16)/116,(b+16)/116-a.b/200].map(k=>k>6/29?k**3:3*(6/29)**2*(k-4/29));return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function e(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var b=a.c;var k=a.h;b={l:a.l,a:b*Math.cos(k),b:b*Math.sin(k)};return h(t(b))}if("l"in a&&"a"in a&&"b"in a)return h(t(a));if("x"in a&&"y"in a&&"z"in a)return h(a);if("h"in a&&"s"in
a&&"v"in a){{k=(a.h+360)%360/60;b=a.v/100*255;a=a.s/100*b;const u=a*(1-Math.abs(k%2-1));switch(Math.floor(k)){case 0:k={r:a,g:u,b:0};break;case 1:k={r:u,g:a,b:0};break;case 2:k={r:0,g:a,b:u};break;case 3:k={r:0,g:u,b:a};break;case 4:k={r:u,g:0,b:a};break;case 5:case 6:k={r:a,g:0,b:u};break;default:k={r:0,g:0,b:0}}k.r=Math.round(k.r+b-a);k.g=Math.round(k.g+b-a);k.b=Math.round(k.b+b-a);b=k}return b}return a}const c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],d=[[3.2406,-1.5372,-.4986],
[-.9689,1.8758,.0415],[.0557,-.204,1.057]];A.darken=function(a,b){a=q(x(a));a.l*=1-b;return h(t(a))};A.toHSV=function(a){if("h"in a&&"s"in a&&"v"in a)return a;var b=e(a);{a=b.r;const k=b.g,u=b.b;b=Math.max(a,k,u);const w=b-Math.min(a,k,u);a=0===w?0:b===a?(k-u)/w%6:b===k?(u-a)/w+2:(a-k)/w+4;0>a&&(a+=6);a={h:60*a,s:100*(0===w?0:w/b),v:100/255*b}}return a};A.toLAB=function(a){return"l"in a&&"a"in a&&"b"in a?a:q(x(e(a)))};A.toLCH=function(a){if(!("l"in a&&"c"in a&&"h"in a)){{var b=q(x(e(a)));a=b.l;var k=
b.a;const u=b.b;b=Math.sqrt(k*k+u*u);k=Math.atan2(u,k);k=0<k?k:k+2*Math.PI;a={l:a,c:b,h:k}}}return a};A.toRGB=e;A.toXYZ=function(a){return"x"in a&&"y"in a&&"z"in a?a:x(e(a))};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports"],function(A){function F(c,d){c%=d;return 0<=c?c:c+d}const x=Number.POSITIVE_INFINITY,h=Math.PI,q=128/h,t=256/360,e=1/Math.LN2;A.C_256_TO_RAD=h/128;A.C_2PI=2*h;A.C_DEG_TO_256=t;A.C_DEG_TO_RAD=h/180;
A.C_INFINITY=x;A.C_PI=h;A.C_PI_BY_2=h/2;A.C_RAD_TO_256=q;A.C_SQRT2=1.414213562;A.C_SQRT2_INV=1/1.414213562;A.between=function(c,d,a){return c>=d&&c<=a||c>=a&&c<=d};A.degToByte=function(c){return F(c*t,256)};A.interpolate=function(c,d,a){return c*(1-a)+d*a};A.log2=function(c){return Math.log(c)*e};A.positiveMod=F;A.radToByte=function(c){return F(c*q,256)};A.sqr=function(c){return c*c};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports",
"../../../../../Color"],function(A,F){function x(p,g){return{kind:"array",itemType:p,n:g}}function h(p){if("array"===p.kind){const g=h(p.itemType);return"number"===typeof p.n?`array<${g}, ${p.n}>`:"value"===p.itemType.kind?"array":`array<${g}>`}return p.kind}function q(p){if(null===p)return e;if("string"===typeof p)return d;if("boolean"===typeof p)return a;if("number"===typeof p)return c;if(p instanceof F)return b;if(Array.isArray(p)){let g;for(const l of p){const m=q(l);if(!g)g=m;else if(g!==m){g=
u;break}}return x(g||u,p.length)}return"object"===typeof p?k:u}function t(p,g){if("array"===g.kind)return"array"===p.kind&&(0===p.n&&"value"===p.itemType.kind||t(p.itemType,g.itemType))&&("number"!==typeof g.n||g.n===p.n);if("value"===g.kind)for(const l of w)if(t(p,l))return!0;return g.kind===p.kind}const e={kind:"null"},c={kind:"number"},d={kind:"string"},a={kind:"boolean"},b={kind:"color"},k={kind:"object"},u={kind:"value"},w=[e,c,d,a,b,k,x(u)];A.BooleanType=a;A.ColorType=b;A.NullType=e;A.NumberType=
c;A.ObjectType=k;A.StringType=d;A.ValueType=u;A.arrayType=x;A.getType=q;A.matchType=t;A.typeToString=h;A.valueToString=function(p){if(null===p)return"";const g=typeof p;return"string"===g?p:"number"===g||"boolean"===g?String(p):p instanceof F?p.toString():JSON.stringify(p)};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports"],function(A){let F=function(){};F.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:0}};F.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}};F.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};F.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},
"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",
default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),
default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,
default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],
default:[0]}};F.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}};F.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};F.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,
0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};F.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,
default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}};F.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,
maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",
values:["map","viewport"],default:0}};F.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};
F.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",
values:["map","viewport"],default:0}};A.StyleDefinition=F;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],function(A,F,x,h){return function(){function q(e,c){this.isDataDriven=!1;this.interpolator=null;switch(e.type){case "number":var d=!0;break;case "color":d=!0;break;case "array":d="number"===e.value;break;default:d=!1}null==c&&
(c=e.default);if(Array.isArray(c)&&0<c.length&&x.ops[c[0]]){d={number:h.NumberType,color:h.ColorType,string:h.StringType,boolean:h.BooleanType,enum:h.StringType};try{var a="array"===e.type?h.arrayType(d[e.value]||h.ValueType,e.length):d[e.type];const b=x.createExpression(c,null,a);this.getValue=this._buildExpression(b,e);this.isDataDriven=!0;b instanceof x.Interpolate&&b.input instanceof x.Zoom&&(this.interpolator=b)}catch(b){console.log(b.message),this.getValue=this._buildSimple(e.default)}}else{d&&
"interval"===c.type&&(d=!1);if(a=c&&c.stops&&0<c.stops.length)for(const b of c.stops)b[1]=this._validate(b[1],e);if(this.isDataDriven=c?!!c.property:!1)if(void 0!==c.default&&(c.default=this._validate(c.default,e)),a)switch(c.type){case "identity":this.getValue=this._buildIdentity(c,e);break;case "categorical":this.getValue=this._buildCategorical(c,e);break;default:this.getValue=d?this._buildInterpolate(c,e):this._buildInterval(c,e)}else this.getValue=this._buildIdentity(c,e);else a?this.getValue=
d?this._buildZoomInterpolate(c):this._buildZoomInterval(c):(c=this._validate(c,e),this.getValue=this._buildSimple(c))}}var t=q.prototype;t._validate=function(e,c){if("number"===c.type){if(e<c.minimum)return c.minimum;if(e>c.maximum)return c.maximum}else"color"===c.type?e=q._parseColor(e):"enum"===c.type?"string"===typeof e&&(e=c.values.indexOf(e)):"array"===c.type&&"enum"===c.value?e=e.map(d=>"string"===typeof e?c.values.indexOf(d):d):"string"===c.type&&(e=h.valueToString(e));return e};t._buildSimple=
function(e){return()=>e};t._buildExpression=function(e,c){return(d,a)=>{try{const b=e.evaluate(a,d);return void 0===b?c.default:this._validate(b,c)}catch(b){return console.log(b.message),c.default}}};t._buildIdentity=function(e,c){return(d,a)=>{let b;a&&(b=a.values[e.property]);void 0!==b&&(b=this._validate(b,c));return null!=b?b:void 0!==e.default?e.default:c.default}};t._buildCategorical=function(e,c){return(d,a)=>{let b;a&&(b=a.values[e.property]);b=this._categorical(b,e.stops);return void 0!==
b?b:void 0!==e.default?e.default:c.default}};t._buildInterval=function(e,c){return(d,a)=>{let b;a&&(b=a.values[e.property]);return"number"===typeof b?this._interval(b,e.stops):void 0!==e.default?e.default:c.default}};t._buildInterpolate=function(e,c){return(d,a)=>{let b;a&&(b=a.values[e.property]);return"number"===typeof b?this._interpolate(b,e.stops,e.base||1):void 0!==e.default?e.default:c.default}};t._buildZoomInterpolate=function(e){return c=>this._interpolate(c,e.stops,e.base||1)};t._buildZoomInterval=
function(e){return c=>this._interval(c,e.stops)};t._categorical=function(e,c){const d=c.length;for(let a=0;a<d;a++)if(c[a][0]===e)return c[a][1]};t._interval=function(e,c){const d=c.length;let a=0;for(let b=0;b<d;b++)if(c[b][0]<=e)a=b;else break;return c[a][1]};t._interpolate=function(e,c,d){const a=c.length;for(let u=0;u<a;u++){const w=c[u];if(w[0]<=e)var b=w;else{var k=w;break}}if(b&&k){c=k[0]-b[0];e-=b[0];d=1===d?e/c:(d**e-1)/(d**c-1);if(Array.isArray(b[1])){b=b[1];k=k[1];e=[];for(c=0;c<b.length;c++)e.push(F.interpolate(b[c],
k[c],d));return e}return F.interpolate(b[1],k[1],d)}if(b)return b[1];if(k)return k[1]};q._isEmpty=function(e){for(const c in e)if(e.hasOwnProperty(c))return!1;return!0};q._parseColor=function(e){if(Array.isArray(e))return e;"string"===typeof e&&(e=new A(e));if(e instanceof A&&!this._isEmpty(e))return A.toUnitRGBA(e)};return q}()})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(A,F,x,h,q,t,e,c,d,a,b,k,u,w,p,g){const l=h.ofType({key:"type",base:u,typeMap:{rect:w,path:g,geometry:p}});A.LayerView2DMixin=m=>{m=function(y){function D(){var r=y.apply(this,arguments)||this;r.clips=new l;r.moving=!1;r.attached=!1;r.lastUpdateId=-1;r.updateRequested=!1;return r}F._inheritsLoose(D,y);var B=D.prototype;B.initialize=function(){var r;this.container||(this.container=new k.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=this.clips;
this.handles.add([t.init(this,"suspended",z=>{this.container&&(this.container.visible=!z);this.view&&!z&&this.updateRequested&&this.view.requestUpdate()},!0),t.init(this,["layer.opacity","container"],()=>{if(this.container){var z,I;this.container.opacity=null!=(z=null==(I=this.layer)?void 0:I.opacity)?z:1}},!0),t.init(this,["layer.blendMode"],z=>{this.container&&(this.container.blendMode=z)},!0),t.init(this,["layer.effect"],z=>{this.container&&(this.container.effect=z)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(r=this.view)&&r.whenLayerView?this.view.whenLayerView(this.layer).then(z=>{z!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};B.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};B.isVisibleAtScale=
function(r){var z=!0,I=this.layer;const G=I.minScale;I=I.maxScale;if(null!=G&&null!=I){z=!G;let J=!I;!z&&r<=G&&(z=!0);!J&&r>=I&&(J=!0);z=z&&J}return z};B.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};B.processUpdate=function(r){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",r),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(r)))};B.isUpdating=
function(){return!1};B.isRendering=function(){return!1};B.canResume=function(){return y.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};F._createClass(D,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return D}(m);x.__decorate([e.property({type:l,set(y){y=q.referenceSetter(y,this._get("clips"),l);this._set("clips",y)}})],m.prototype,"clips",void 0);x.__decorate([e.property()],m.prototype,"moving",void 0);
x.__decorate([e.property()],m.prototype,"attached",void 0);x.__decorate([e.property()],m.prototype,"container",void 0);x.__decorate([e.property()],m.prototype,"suspended",void 0);x.__decorate([e.property({readOnly:!0})],m.prototype,"updateParameters",void 0);x.__decorate([e.property()],m.prototype,"updateRequested",void 0);x.__decorate([e.property()],m.prototype,"updating",null);x.__decorate([e.property()],m.prototype,"view",void 0);return m=x.__decorate([b.subclass("esri.views.2d.layers.LayerView2D")],
m)};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),function(A,F,x,h,q,t,e,c){x=function(d){function a(){return d.apply(this,arguments)||this}A._inheritsLoose(a,
d);return a}(x.JSONSupport);return x=F.__decorate([c.subclass("esri.views.layers.support.ClipArea")],x)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(A,F,x,h,q,t,e,c){var d;h=d=function(a){function b(){var k=
a.apply(this,arguments)||this;k.type="rect";k.left=null;k.right=null;k.top=null;k.bottom=null;return k}A._inheritsLoose(b,a);b.prototype.clone=function(){return new d({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};A._createClass(b,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return b}(c);F.__decorate([x.property({type:[Number,String],json:{write:!0}})],h.prototype,"left",void 0);F.__decorate([x.property({type:[Number,String],json:{write:!0}})],h.prototype,
"right",void 0);F.__decorate([x.property({type:[Number,String],json:{write:!0}})],h.prototype,"top",void 0);F.__decorate([x.property({type:[Number,String],json:{write:!0}})],h.prototype,"bottom",void 0);F.__decorate([x.property({readOnly:!0})],h.prototype,"version",null);return h=d=F.__decorate([e.subclass("esri.views.layers.support.ClipRect")],h)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(A,F,x,h,q,t,e,c,d,a,b,k,u){var w;x={base:d,key:"type",typeMap:{extent:k,polygon:u}};b=w=function(p){function g(){var l=p.apply(this,arguments)||this;l.type="geometry";l.geometry=null;return l}A._inheritsLoose(g,p);g.prototype.clone=function(){return new w({geometry:this.geometry.clone()})};A._createClass(g,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return g}(b);F.__decorate([h.property({types:x,json:{read:a.fromJSON,write:!0}})],b.prototype,"geometry",void 0);F.__decorate([h.property({readOnly:!0})],
b.prototype,"version",null);return b=w=F.__decorate([c.subclass("esri.views.layers.support.Geometry")],b)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(A,F,x,h,q,t,e,c){h=function(d){function a(){var b=d.apply(this,
arguments)||this;b.type="path";b.path=[];return b}A._inheritsLoose(a,d);A._createClass(a,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return a}(c);F.__decorate([x.property({type:[[[Number]]],json:{write:!0}})],h.prototype,"path",void 0);F.__decorate([x.property({readOnly:!0})],h.prototype,"version",null);return h=F.__decorate([e.subclass("esri.views.layers.support.Path")],h)})},"esri/views/2d/layers/support/Display":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../engine/Bitmap","../../engine/BitmapContainer"],function(A,F,x,h){h=function(q){function t(c){var d=q.call(this)||this;d.requestRender=d.requestRender.bind(F._assertThisInitialized(d));d._layerView=c;d._canvas=document.createElement("canvas");d._context=d._canvas.getContext("2d");d._bitmap=new x.Bitmap(null,"standard",!1);d.addChild(d._bitmap);return d}F._inheritsLoose(t,q);var e=t.prototype;e.doRender=function(c){const d=c.state,a=this._createCustomRenderParams(c),b=a.pixelRatio,k=this._canvas,
u=this._bitmap;k.width=d.size[0]*b;k.height=d.size[1]*b;u.resolution=d.resolution;u.pixelRatio=b;u.x=d.viewpoint.targetGeometry.x-Math.abs(d.extent.xmax-d.extent.xmin)/2;u.y=d.viewpoint.targetGeometry.y+Math.abs(d.extent.ymax-d.extent.ymin)/2;this._layerView.render(a);u.source=k;u.rotation=d.rotation;q.prototype.doRender.call(this,c)};e._createCustomRenderParams=function(c){const d=window.devicePixelRatio;return{...c,pixelRatio:d,context:this._context,state:{...c.state,pixelRatio:d}}};return t}(h.BitmapContainer);
A.Display=h;A["default"]=h;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(A,F,x,h){return function(q){function t(){var c=q.apply(this,arguments)||this;c._fullCacheLodInfos=null;c._levelByScale={};return c}A._inheritsLoose(t,q);var e=t.prototype;e.getTileParentId=function(c){c=h.pool.acquire(c);const d=0===c.level?null:
h.getId(c.level-1,c.row>>1,c.col>>1,c.world);h.pool.release(c);return d};e.getTileCoverage=function(c,d,a){c=q.prototype.getTileCoverage.call(this,c,d,a);if(!c)return c;const b=1<<c.lodInfo.level;c.spans=c.spans.filter(k=>0<=k.row&&k.row<b);return c};e.scaleToLevel=function(c){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[c])return this._levelByScale[c];{var d=this._fullCacheLodInfos;if(c>d[0].scale)return d[0].level;let a;for(let b=0;b<d.length-1;b++)if(a=
d[b+1],c>a.scale)return d=d[b],d.level+(d.scale-c)/(d.scale-a.scale);return d[d.length-1].level}};e._initializeFullCacheLODs=function(c){c=0===c[0].level?c.map(d=>({level:d.level,resolution:d.resolution,scale:d.scale})):F.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(d=>({level:d.level,resolution:d.resolution,scale:d.scale}));for(let d=0;d<c.length;d++)this._levelByScale[c[d].scale]=c[d].level;this._fullCacheLodInfos=c};return t}(x)})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/support/aaBoundingRect ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/decluttering/debugging ../engine/vectorTiles/style/StyleRepository ./LayerView2D ./support/Display ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),
function(A,F,x,h,q,t,e,c,d,a,b,k,u,w,p,g,l,m,y,D,B,r,z,I,G,J,M){function L(S){if(c.isNone(S))return 0;switch(S.type){case "partial":return Object.keys(S.diff).length;case "complete":return Math.max(Object.keys(S.oldValue).length,Object.keys(S.newValue).length);case "collection":return Object.keys(S.added).length+Object.keys(S.changed).length+Object.keys(S.removed).length}}const O=e.getLogger("esri.views.2d.layers.VectorTileLayerView2D");e=function(S){function T(){var H=S.apply(this,arguments)||this;
H._styleChanges=[];H._handles=new q;H._fetchQueue=null;H._parseQueue=null;H._isTileHandlerReady=!1;H.fading=!1;return H}A._inheritsLoose(T,S);var R=T.prototype;R.initialize=function(){const H=this.layer.tileInfo;if((H&&H.spatialReference).equals(this.view.spatialReference)){var {style:N,spriteUrl:P,glyphsUrl:V}=this.layer.currentStyleInfo;this._styleRepository=new r(N,{spriteUrl:P,glyphsUrl:V});this._tileInfoView=new G(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new D.VectorTileContainer(this._tileInfoView);
this._tileHandler=new l.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1);this.container.addChild(this._vectorTileContainer);this.handles.add([this._vectorTileContainer.on("fade-start",()=>{this.fading=!0;this.notifyChange("updating");this.requestUpdate()}),this._vectorTileContainer.on("fade-complete",()=>{this._collisionBoxesDisplay&&this._collisionBoxesDisplay.requestRender();this.fading=!1;this.notifyChange("updating");this.requestUpdate()}),a.init(this.layer,"symbolCollisionBoxesVisible",
ba=>{ba?(this._collisionBoxesDisplay=new I.Display({render:ca=>this._renderCollisionBoxes(ca.context)}),this.container.addChild(this._collisionBoxesDisplay)):(this.container.removeChild(this._collisionBoxesDisplay),this._collisionBoxesDisplay=null)})])}else this.addResolvingPromise(Promise.reject(new h("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))};R.destroy=function(){var H;this._stop();this.container.removeAllChildren();
this._vectorTileContainer&&(this._vectorTileContainer.destroy(),this._vectorTileContainer=null);null==(H=this._tileHandler)?void 0:H.destroy();this._tileHandler=null};R.hitTest=function(){var H=A._asyncToGenerator(function*(N,P){if(this.suspended||!this._tileHandlerPromise)return null;yield this._tileHandlerPromise;N=yield this._vectorTileContainer.hitTest(N,P);if(!N||0===N.length)return null;N=N[0]-1;var V=this._styleRepository;P=V.getStyleLayerByUID(N);if(!P)return null;V=V.getStyleLayerIndex(P.id);
N=new x({attributes:{layerId:V,layerName:P.id,layerUID:N}});N.layer=this.layer;N.sourceLayer=this.layer;return N});return function(N,P){return H.apply(this,arguments)}}();R.update=function(H){this._tileHandlerPromise&&this._isTileHandlerReady&&(H.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),this._tileHandler.devicePixelRatio=H.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=
H.state,this._parseQueue.state=H.state,this._tileManager.update(H)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))};R.attach=function(){this._start();this._handles.add([this.layer.on("paint-change",H=>{if(H.isDataDriven)this._styleChanges.push({type:0,data:H}),this.notifyChange("updating"),this.requestUpdate();else{const P=this._styleRepository;var N=P.getLayerById(H.layer);N&&(N=3===N.type,P.setPaintProperties(H.layer,H.paint),N&&this._vectorTileContainer.restartDeclutter(),
this._vectorTileContainer.requestRender())}}),this.layer.on("layout-change",H=>{const N=this._styleRepository,P=N.getLayerById(H.layer);if(P){var V=p.diff(P.layout,H.layout);c.isNone(V)||(p.hasDiff(V,"visibility")&&1===L(V)?(N.setLayoutProperties(H.layer,H.layout),3===P.type&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender()):(this._styleChanges.push({type:1,data:H}),this.notifyChange("updating"),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",
H=>{const N=this._styleRepository,P=N.getLayerById(H.layer);P&&(N.setStyleLayerVisibility(H.layer,H.visibility),3===P.type&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())}),this.layer.on("style-layer-change",H=>{this._styleChanges.push({type:2,data:H});this.notifyChange("updating");this.requestUpdate()}),this.layer.on("delete-style-layer",H=>{this._styleChanges.push({type:3,data:H});this.notifyChange("updating");this.requestUpdate()}),this.layer.on("load-style",
()=>this._loadStyle())])};R.detach=function(){this._stop();this._handles.removeAll()};R.moveStart=function(){this.requestUpdate()};R.viewChange=function(){this.requestUpdate()};R.moveEnd=function(){this._collisionBoxesDisplay&&this._vectorTileContainer.restartDeclutter();this.requestUpdate()};R.canResume=function(){let H=S.prototype.canResume.call(this);var N=this.layer;if(H&&N.currentStyleInfo){const P=this.view.scale;(N=N.currentStyleInfo)&&N.layerDefinition&&(N=N.layerDefinition,N.minScale&&N.minScale<
P&&(H=!1),N.maxScale&&N.maxScale>P&&(H=!1))}return H};R.isUpdating=function(){const H=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||0<H.length&&0<H.filter(N=>N.invalidating).length||this.fading};R.acquireTile=function(H){const N=this._createVectorTile(H);this._tileHandlerPromise.then(()=>{this._fetchQueue.push(N.key).then(P=>this._parseQueue.push({key:N.key,data:P})).then(P=>{N.once("attach",
()=>this.requestUpdate());P&&(N.setData(P.tileData),this.requestUpdate(),this.notifyChange("updating"))}).catch(P=>{this.notifyChange("updating");d.isAbortError(P)||O.error(P)})});return N};R.releaseTile=function(H){H=H.key.id;this._fetchQueue.abort(H);this._parseQueue.abort(H);this.requestUpdate()};R._start=function(){this._stop();this._tileManager=new m.TileManager({acquireTile:P=>this.acquireTile(P),releaseTile:P=>this.releaseTile(P),tileInfoView:this._tileInfoView},this._vectorTileContainer);
if(this.layer.currentStyleInfo){var H=new AbortController,N=this._tileHandler.start({signal:H.signal}).then(()=>{this._fetchQueue=new J({tileInfoView:this._tileInfoView,process:(P,V)=>this._getTileData(P,V),concurrency:15});this._parseQueue=new J({tileInfoView:this._tileInfoView,process:(P,V)=>this._parseTileData(P,V),concurrency:8});this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(P=>{this._vectorTileContainer.setStyleResources(P,this._tileHandler.glyphMosaic,
this._styleRepository);this.requestUpdate()});this._tileHandlerAbortController=H;this._tileHandlerPromise=N}};R._stop=function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var H=this._tileHandlerAbortController;H&&H.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileManager&&(this._tileManager.destroy(),this._tileManager=
null);this._vectorTileContainer.removeAllChildren()}};R._getTileData=function(){var H=A._asyncToGenerator(function*(N,P){N=yield this._tileHandler.fetchTileData(N,P);this.notifyChange("updating");return N});return function(N,P){return H.apply(this,arguments)}}();R._parseTileData=function(){var H=A._asyncToGenerator(function*(N,P){return this._tileHandler.parseTileData(N,P)});return function(N,P){return H.apply(this,arguments)}}();R._applyStyleChanges=function(){var H=A._asyncToGenerator(function*(){this._isTileHandlerReady=
!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._tileManager.clearCache();var N=this._styleChanges;try{yield this._tileHandler.updateStyle(N)}catch(X){O.error("error applying vector-tiles style update",X.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0}const P=this._styleRepository,V=[];N.forEach(X=>{3===X.type&&(X=P.getLayerById(X.data.layer))&&V.push(X.uid)});const ba=[];let ca;N.forEach(X=>{const aa=
X.data;switch(X.type){case 0:P.setPaintProperties(aa.layer,aa.paint);ca=aa.layer;break;case 1:P.setLayoutProperties(aa.layer,aa.layout);ca=aa.layer;break;case 3:P.deleteStyleLayer(aa.layer);return;case 2:P.setStyleLayer(aa.layer,aa.index),ca=aa.layer.id}(X=P.getLayerById(ca))&&ba.push(X.uid)});N=this._vectorTileContainer.children;if(0<V.length){this._vectorTileContainer.deleteStyleLayers(V);for(var da of N)da.deleteLayerData(V)}this._fetchQueue.resume();this._parseQueue.resume();if(0<ba.length){da=
[];for(const X of N)N=this._fetchQueue.push(X.key).then(aa=>this._parseQueue.push({key:X.key,data:aa,styleLayerUIDs:ba})).then(aa=>X.setData(aa.tileData)),da.push(N);yield Promise.all(da)}this._styleChanges=[];this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()});return function(){return H.apply(this,arguments)}}();R._loadStyle=function(){var H=A._asyncToGenerator(function*(){const {style:N,spriteUrl:P,glyphsUrl:V}=this.layer.currentStyleInfo;var ba=t.clone(N);this._isTileHandlerReady=
!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this.notifyChange("updating");this._styleRepository=new r(ba,{spriteUrl:P,glyphsUrl:V});this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=d.createAbortController();const {signal:ca}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,ba),yield this._tileHandlerPromise}catch(da){if(!d.isAbortError(da))throw da;
}ca.aborted||(ba=yield this._tileHandler.spriteMosaic,this._vectorTileContainer.setStyleResources(ba,this._tileHandler.glyphMosaic,this._styleRepository));this._fetchQueue.resume();this._parseQueue.resume();this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()});return function(){return H.apply(this,arguments)}}();R._createVectorTile=function(H){const N=this._tileInfoView.getTileBounds(g.create(),H);return new y.VectorTile(H,N[0],N[3],512,512,this._styleRepository)};R._renderCollisionBoxes=
function(H){for(const N of this._vectorTileContainer.children)if(N.symbols){const P=[];for(const [,V]of N.symbols)P.push(...V);B.drawColliders(H,P)}};return T}(z.LayerView2DMixin(M));F.__decorate([b.property()],e.prototype,"_fetchQueue",void 0);F.__decorate([b.property()],e.prototype,"_parseQueue",void 0);F.__decorate([b.property()],e.prototype,"_isTileHandlerReady",void 0);F.__decorate([b.property()],e.prototype,"suspended",void 0);F.__decorate([b.property()],e.prototype,"fading",void 0);F.__decorate([b.property()],
e.prototype,"updating",void 0);return e=F.__decorate([w.subclass("esri.views.2d.layers.VectorTileLayerView2D")],e)});