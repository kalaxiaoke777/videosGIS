// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterDatasets/RawBlockCache":function(){define("exports ../../../geometry ../../../core/maybe ./EphemeralBlockCache ../rasterFunctions/rasterProjectionHelper ../../../geometry/Point".split(" "),function(u,J,m,A,l,v){function w(h,e){if(!H.has(h))return null;h=H.get(h);return null==h[e]?null:h[e]}const H=new Map,C=new A;u.decreaseRefCount=function(h,e,n){if(!H.has(h))return null==e?C.decreaseRefCount(h,n):0;const q=H.get(h);if(null==q[e])return C.decreaseRefCount(h,
n);e=q[e].cache;if(e.has(n)){h=e.get(n);h.refCount--;if(0===h.refCount){e.delete(n);for(e=0;e<q.length;e++)q[e]&&q[e].cache.has(n)&&q[e].cache.delete(n);h.controller&&h.controller.abort()}return h.refCount}return 0};u.deleteBlock=function(h,e,n){if(H.has(h)){var q=H.get(h);null==q[e]?C.deleteBlock(h,n):q[e].cache.delete(n)}else null==e&&C.deleteBlock(h,n)};u.deleteRaster=function(h){H.delete(h)};u.getBlock=function(h,e,n){if(!H.has(h))return null==e?C.getBlock(h,n):null;var q=H.get(h);if(null==q[e]){for(e=
0;e<q.length;e++)if(q[e]&&q[e].cache.has(n))return n=q[e].cache.get(n),n.refCount++,n.block;return C.getBlock(h,n)}h=q[e].cache;if(h.has(n))return n=h.get(n),n.refCount++,n.block;for(let p=0;p<q.length;p++)if(p!==e&&q[p]&&q[p]&&q[p].cache.has(n))return q=q[p].cache.get(n),q.refCount++,h.set(n,q),q.block;return null};u.getRasterId=function(h,e){return null==e?h:`${h}?sliceId=${e}`};u.putBlock=function(h,e,n,q,p=null){if(H.has(h)){var d=H.get(h);if(null==d[e])C.putBlock(h,n,q,p);else{var x={refCount:1,
block:q,isResolved:!1,isRejected:!1,controller:p};q.then(()=>x.isResolved=!0).catch(()=>x.isRejected=!0);d[e].cache.set(n,x)}}else null==e&&C.putBlock(h,n,q,p)};u.register=function(h,e){e={extent:null,rasterInfo:e,cache:new Map};if(H.has(h))return h=H.get(h),h.push(e),h.length-1;H.set(h,[e]);return 0};u.unregister=function(h,e){if(H.has(h)){const n=H.get(h);n[e]=null;n.some(q=>null!=q)||H.delete(h)}};u.update=function(h,e,n,q,p,d,x=null){h=w(h,e);e=h.extent;const {cache:P,rasterInfo:y}=h;if(!e||e.xmin!==
n.xmin||e.xmax!==n.xmax||e.ymin!==n.ymin||e.ymax!==n.ymax){e=n.clone().normalize();var {spatialReference:N,transform:M}=y,K=new Set;for(let k=0;k<e.length;k++){var Q=e[k];if(Q.xmax-Q.xmin<=q||Q.ymax-Q.ymin<=q)continue;var f=l.projectExtent(Q,N,x);m.isSome(M)&&(f=M.inverseTransform(f));var a=new v({x:q,y:q,spatialReference:Q.spatialReference});if(null==p&&(p=l.projectResolution(a,N,Q,x),!p))return;const {pyramidLevel:r,pyramidResolution:z,excessiveReading:B}=l.snapPyramid(p,y,d||"closest");if(B)return;
({storageInfo:Q}=y);var {origin:b}=Q;a=Math.max(0,Math.floor((f.xmin-b.x)/z.x));b=Math.max(0,Math.floor((b.y-f.ymax)/z.y));const D=0<r?Q.pyramidBlockWidth:Q.blockWidth,L=0<r?Q.pyramidBlockHeight:Q.blockHeight;Q=Math.max(0,Math.floor(a/D)-1);var g=Math.max(0,Math.floor(b/L)-1);a=Math.floor((a+Math.ceil((f.xmax-f.xmin)/z.x-.1)-1)/D)+1;f=Math.floor((b+Math.ceil((f.ymax-f.ymin)/z.y-.1)-1)/L)+1;for(b=g;b<=f;b++)for(g=Q;g<=a;g++)K.add(`${r}/${b}/${g}`)}P.forEach((k,r)=>{K.has(r)||(k=P.get(r),(null==k||
k.isResolved||k.isRejected)&&P.delete(r))});h.extent={xmin:n.xmin,ymin:n.ymin,xmax:n.xmax,ymax:n.ymax}}};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){return function(){function u(m=15E3,A=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=m;this._interval=Math.min(m,A)}var J=u.prototype;J.decreaseRefCount=function(m,A){m=m+"/"+A;A=this._cachedBlocks;if(A.has(m)){const l=A.get(m);
l.refCount--;0>=l.refCount&&(A.delete(m),l.controller&&l.controller.abort());return l.refCount}return 0};J.getBlock=function(m,A){m=m+"/"+A;A=this._cachedBlocks;if(A.has(m)){const l=A.get(m);l.ts=Date.now();l.refCount++;A.delete(m);A.set(m,l);return l.block}return null};J.putBlock=function(m,A,l,v=null){const w=this._cachedBlocks;m=m+"/"+A;w.has(m)?(l=w.get(m),l.ts=Date.now(),l.refCount++):w.set(m,{block:l,ts:Date.now(),refCount:1,controller:v});this.trim();this.updateTimer()};J.deleteBlock=function(m,
A){const l=this._cachedBlocks;m=m+"/"+A;l.has(m)&&l.delete(m)};J.updateMaxSize=function(m){this._size=m;this.trim()};J.empty=function(){this._cachedBlocks.clear();this.clearTimer()};J.getCurrentSize=function(){return this._cachedBlocks.size};J.updateTimer=function(){if(null==this._timer){var m=this._cachedBlocks;this._timer=setInterval(()=>{const A=Array.from(m),l=Date.now();for(let v=0;v<A.length;v++)if(A[v][1].ts<=l-this._duration)m.delete(A[v][0]);else break;0===m.size&&this.clearTimer()},this._interval)}};
J.trim=function(){const m=this._cachedBlocks;if(!(-1===this._size||this._size>=m.size)){var A=Array.from(m);for(let l=0;l<A.length-this._size;l++)m.delete(A[l][0])}};J.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)};return u}()})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/webMercatorUtils ../../../geometry/Extent ../../../geometry/Point".split(" "),
function(u,J,m,A,l,v,w,H,C,h){function e(){e=J._asyncToGenerator(function*(){if(w.isLoaded()||!w.isSupported())return null;yield w.load()});return e.apply(this,arguments)}function n(a,b,g,k=null){if(a.spatialReference.equals(b))return a;const r=Q(a.spatialReference,b);if(r&&!w.isLoaded())throw new A("rasterprojectionhelper-projectResolution","projection engine is not loaded");g=g.center;a=new C({xmin:g.x-a.x/2,xmax:g.x+a.x/2,ymin:g.y-a.y/2,ymax:g.y+a.y/2,spatialReference:a.spatialReference});b=r?
w.project(a,b,k):H.project(a,b);return l.isNone(b)?null:{x:b.xmax-b.xmin,y:b.ymax-b.ymin}}function q(a,b=.01){return v.getMetersPerUnitForSR(a)?b/v.getMetersPerUnitForSR(a):0}function p(a,b,g=null,k=!0){const r=a.spatialReference;if(r.equals(b))return a;let z=H.project(a,b);if(l.isNone(z)){if(!w.isLoaded())throw new A("rasterprojectionhelper-projectResolution","projection engine is not loaded");z=w.project(a,b,g)}if(k&&b.isGeographic){const [B,D]=N(r,!0);(b=q(r))&&null!=B&&null!=D&&(Math.abs(a.x-
B)<b&&5E-4>Math.abs(180-z.x)?z.x-=360:Math.abs(a.x-D)<b&&5E-4>Math.abs(180+z.x)&&(z.x+=360))}return z}function d(a){const b=y(a[0].spatialReference);if(2>a.length||!l.isSome(b))return a[0];let {xmin:g,xmax:k,ymin:r,ymax:z}=a[0];for(let B=1;B<a.length;B++){const D=a[B];k=D.xmax+b*B;r=Math.min(r,D.ymin);z=Math.max(z,D.ymax)}return new C({xmin:g,xmax:k,ymin:r,ymax:z,spatialReference:a[0].spatialReference})}function x(a,b,g=null,k=!0){if(a.spatialReference.equals(b))return a;const r=K(a),z=y(a.spatialReference,
!0);if(!l.isSome(z)||0===r)return P(a,b,g,k);a=a.clone().normalize().map(B=>P(B,b,g,k));return d(a)}function P(a,b,g=null,k=!0){const r=a.spatialReference;if(r.equals(b))return a;if(Q(r,b)&&!w.isLoaded())throw new A("rasterprojectionhelper-projectExtent","projection engine is not loaded");let z=H.project(a,b);l.isNone(z)&&(z=w.project(a,b,g));let [B,D]=N(r,!0);z&&k&&r.isWebMercator&&b.isGeographic&&null!=B&&null!=D&&(.001>Math.abs(a.xmin-B)&&1E3<Math.abs(D-a.xmax)&&5E-4>Math.abs(180-z.xmax)&&(z.xmin=
-180,k=[],k.push(new h(a.xmax,a.ymin,r)),k.push(new h(a.xmax,(a.ymin+a.ymax)/2,r)),k.push(new h(a.xmax,a.ymax,r)),k=k.map(L=>p(L,b,g)).filter(L=>!isNaN(null==L?void 0:L.x)).map(L=>L.x),z.xmax=Math.max.apply(null,k)),.001>Math.abs(a.xmax-D)&&1E3<Math.abs(B-a.xmin)&&5E-4>Math.abs(180+z.xmin)&&(z.xmax=180,k=[],k.push(new h(a.xmin,a.ymin,r)),k.push(new h(a.xmin,(a.ymin+a.ymax)/2,r)),k.push(new h(a.xmin,a.ymax,r)),a=k.map(L=>p(L,b,g)).filter(L=>!isNaN(null==L?void 0:L.x)).map(L=>L.x),z.xmin=Math.min.apply(null,
a)));[B,D]=N(b,!0);(a=q(b))&&null!=B&&null!=D&&(Math.abs(z.xmin-B)<a&&(z.xmin=B),Math.abs(z.xmax-D)<a&&(z.xmax=D));return z}function y(a,b=!1){return a.isWebMercator?2*(b?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*f[a.wkid]||null}function N(a,b=!1){const g=[];a=y(a,b);l.isSome(a)&&(g.push(-a/2),g.push(a/2));return g}function M(a,b,g,k){a=(a-b)/g;0!==a-Math.floor(a)?a=Math.floor(a):k&&--a;return a}function K(a,b=!1){const g=y(a.spatialReference);if(!l.isSome(g))return 0;const k=
b?0:-(g/2);b=M(a.xmax,k,g,!0);a=M(a.xmin,k,g,!1);return b-a}const Q=function(a,b){const g=(a.isWGS84||a.isWebMercator)&&(b.isWGS84||b.isWebMercator);return!(a.equals(b)||g)},f={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3832:3339584.723798206,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,8858:7396237.374497803,8859:2465412.4581659334,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,
53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53025:7276828.3848298555,53031:1.0384677558821043E7,53034:2.001508679602057E7,53036:7389443.187332862,53037:2463147.729110953,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54025:7311399.09166516,54031:1.0396310810074743E7,54034:2.0037508342789244E7,
54050:808820.9223376509,54053:1920897.3915568967,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7,102038:4297258.582585486,102299:5013965.117483125};u.computeProjectedScales=function(a,b,g=512,k=!0){const {extent:r,spatialReference:z,pixelSize:B}=a,D=n(new h({x:B.x,y:B.y,spatialReference:z}),b,r);if(null==D)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var L=(D.x+D.y)/2,G=v.getMetersPerUnitForSR(b);
L=L*G*96*39.37;const I=b.isGeographic?256/g*2.958287637958547E8:256/g*5.91657527591555E8;g="vector-magdir"===a.dataType||"vector-uv"===a.dataType;const E=x(r,b);g||k&&(b.isGeographic||b.isWebMercator)&&(g=0>E.xmin*E.xmax);k=L;if(g)k=I,a=b.isGeographic?1.341104507446289E-6:.29858214164761665,G=96*a*G*39.37,b=n(new h({x:a,y:a,spatialReference:{wkid:b.isGeographic?4326:3857}}),z,E),b.x*=k/G,b.y*=k/G;else{b={x:B.x,y:B.y};a=Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2);for(G=0;k<.5005*I&&
G<a;)G++,k*=2,b.x*=2,b.y*=2;1.001>=Math.max(k,I)/Math.min(k,I)&&(k=I)}a=[k];G=[{x:b.x,y:b.y}];for(L=Math.min(70.5310735,L)/1.001;k>=L;)k/=2,b.x/=2,b.y/=2,a.push(k),G.push({x:b.x,y:b.y});return{projectedPixelSize:D,scales:a,srcResolutions:G,isCustomTilingScheme:!g}};u.defaultGridSpacing=32;u.getDefaultDatumTransformationForDataset=function(a,b,g){if(!Q(a.spatialReference,b))return null;if(!w.isLoaded())throw new A("rasterprojectionhelper-projectResolution","projection engine is not loaded");return g?
w.getTransformation(b,a.spatialReference,a):w.getTransformation(a.spatialReference,b,a)};u.getProjectionOffsetGrid=function(a,b,g,k=null,r=null,z=!1,B=[32,32]){if(Q(a.spatialReference,b.spatialReference)&&!w.isLoaded())throw new A("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(a&&b&&g))return null;const {xmin:D,ymin:L,xmax:G,ymax:I}=a;var E=a.spatialReference,c=b.spatialReference,t=y(c);z=z||"gcs-shift"===(null==r?void 0:r.type);var F=B[0]*g.x,R=B[1]*g.y;g=Math.ceil((G-
D)/F-.1/B[0])+1;a=Math.ceil((I-L)/R-.1/B[1])+1;const O=[];let S=!1;for(var U=0;U<g;U++){var V=[];for(var T=0;T<a;T++){var W=new h({x:D+F*U,y:I-R*T,spatialReference:E});W=p(W,c,k);r&&(W=r.inverseTransform(W));V.push(W);0<U&&z&&W&&X[T]&&l.isSome(t)&&W.x<X[T].x&&(W.x+=t);W?(O.push((W.x-b.xmin)/(b.xmax-b.xmin)),O.push((b.ymax-W.y)/(b.ymax-b.ymin))):(O.push(NaN),O.push(NaN),S=!0)}var X=V}b=[Math.abs((O[0]+O[4]+O[4*g]+O[4*g+4])/4-O[2*a+2]),Math.abs((O[1]+O[5]+O[4*a+1]+O[4*a+5])/4-O[2*a+3])];k=new Float32Array((g-
1)*(a-1)*12);r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);z=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(X=0;X<g-1;X++){for(E=0;E<a-1;E++){V=X*a*2+2*E;F=O[V];c=O[V+1];var Y=O[V+2],Z=O[V+3];V+=2*a;R=O[V];t=O[V+1];U=O[V+2];V=O[V+3];T=0;W=12*(E*(g-1)+X);for(let aa=0;3>aa;aa++)k[W++]=r[T++]*F+r[T++]*Y+r[T++]*U;T=0;for(Y=0;3>Y;Y++)k[W++]=r[T++]*c+r[T++]*Z+r[T++]*V;T=0;for(Z=0;3>Z;Z++)k[W++]=z[T++]*F+z[T++]*R+z[T++]*U;T=0;for(F=0;3>F;F++)k[W++]=z[T++]*c+z[T++]*t+z[T++]*V}if(S)for(E=0;E<k.length;E++)isNaN(k[E])&&
(k[E]=-1)}return{offsets:O,error:b,coefficients:k,spacing:B,size:[g-1,a-1]}};u.getRasterDatasetAlignmentInfo=function(a){const b=a.storageInfo.origin.x,g=y(a.spatialReference,!0);if(!l.isSome(g))return{originX:b,halfWorldWidth:null,pyramidsInfo:null};const k=g/2,{nativePixelSize:r,storageInfo:z,extent:B}=a,{maximumPyramidLevel:D,blockWidth:L,pyramidScalingFactor:G}=z;let I=r.x;const E=[];a=l.isSome(a.transform)&&"gcs-shift"===a.transform.type;const c=b+k,t=a?g-b:k-b;for(let F=0;F<=D;F++){const R=
(B.xmax-b)/I/L,O=(g/2-b)/I/L;E.push({resolutionX:I,blockWidth:L,datsetColumnCount:0===R-Math.floor(R)?R:Math.ceil(R),worldColumnCountFromOrigin:0===O-Math.floor(O)?O:Math.ceil(O),leftMargin:Math.round(c/I)%L,rightPadding:(L-Math.round(t/I)%L)%L,originColumnOffset:Math.floor(c/I/L)});I*=G}return{originX:b,halfWorldWidth:k,pyramidsInfo:E,hasGCSSShiftTransform:a}};u.getWorldWrapCount=K;u.load=function(){return e.apply(this,arguments)};u.projectExtent=x;u.projectPoint=p;u.projectResolution=n;u.snapExtent=
function(a){a=a.clone().normalize();return 1===a.length?a[0]:d(a)};u.snapPyramid=function(a,b,g){const {storageInfo:k,pixelSize:r}=b;let z=!1;var {pyramidResolutions:B}=k;if(l.isSome(B)&&B.length){a=(a.x+a.y)/2;var D=B[B.length-1];D=(D.x+D.y)/2;var L=(r.x+r.y)/2;if(a<=L)var G=0;else if(a>=D)G=B.length,z=8<a/D;else{D=L;for(let I=1;I<=B.length;I++){L=(B[I-1].x+B[I-1].y)/2;if(a<=L){a===L?G=I:"down"===g?(G=I-1,z=8<a/D):G="up"===g?I:a-D>L-a||2<a/D?I:I-1;break}D=L}}g=0===G?r:B[G-1];return{pyramidLevel:G,
pyramidResolution:new h({x:g.x,y:g.y,spatialReference:b.spatialReference}),excessiveReading:z}}G=Math.log(a.x/r.x)/Math.LN2;a=Math.log(a.y/r.y)/Math.LN2;B=b.storageInfo.maximumPyramidLevel||0;G="down"===g?Math.floor(Math.min(G,a)):"up"===g?Math.ceil(Math.max(G,a)):Math.round((G+a)/2);0>G?G=0:G>B&&(z=G>B+3,G=B);g=2**G;b=new h({x:g*b.nativePixelSize.x,y:g*b.nativePixelSize.y,spatialReference:b.spatialReference});return{pyramidLevel:G,pyramidResolution:b,excessiveReading:z}};Object.defineProperty(u,
"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(u,J,m,A,l,v,w,H,C,h,e,n,q,p,d,x){const P=A.ofType({key:"type",base:q,typeMap:{rect:p,path:x,geometry:d}});u.LayerView2DMixin=y=>{y=function(N){function M(){var Q=N.apply(this,arguments)||this;Q.clips=new P;Q.moving=!1;Q.attached=!1;Q.lastUpdateId=-1;Q.updateRequested=!1;return Q}J._inheritsLoose(M,N);var K=M.prototype;K.initialize=function(){var Q;this.container||(this.container=new n.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=this.clips;
this.handles.add([v.init(this,"suspended",f=>{this.container&&(this.container.visible=!f);this.view&&!f&&this.updateRequested&&this.view.requestUpdate()},!0),v.init(this,["layer.opacity","container"],()=>{if(this.container){var f,a;this.container.opacity=null!=(f=null==(a=this.layer)?void 0:a.opacity)?f:1}},!0),v.init(this,["layer.blendMode"],f=>{this.container&&(this.container.blendMode=f)},!0),v.init(this,["layer.effect"],f=>{this.container&&(this.container.effect=f)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(Q=this.view)&&Q.whenLayerView?this.view.whenLayerView(this.layer).then(f=>{f!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};K.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};K.isVisibleAtScale=
function(Q){var f=!0,a=this.layer;const b=a.minScale;a=a.maxScale;if(null!=b&&null!=a){f=!b;let g=!a;!f&&Q<=b&&(f=!0);!g&&Q>=a&&(g=!0);f=f&&g}return f};K.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};K.processUpdate=function(Q){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",Q),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(Q)))};K.isUpdating=
function(){return!1};K.isRendering=function(){return!1};K.canResume=function(){return N.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};J._createClass(M,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return M}(y);m.__decorate([w.property({type:P,set(N){N=l.referenceSetter(N,this._get("clips"),P);this._set("clips",N)}})],y.prototype,"clips",void 0);m.__decorate([w.property()],y.prototype,"moving",void 0);
m.__decorate([w.property()],y.prototype,"attached",void 0);m.__decorate([w.property()],y.prototype,"container",void 0);m.__decorate([w.property()],y.prototype,"suspended",void 0);m.__decorate([w.property({readOnly:!0})],y.prototype,"updateParameters",void 0);m.__decorate([w.property()],y.prototype,"updateRequested",void 0);m.__decorate([w.property()],y.prototype,"updating",null);m.__decorate([w.property()],y.prototype,"view",void 0);return y=m.__decorate([e.subclass("esri.views.2d.layers.LayerView2D")],
y)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),function(u,J,m,A,l,v,w,H){m=function(C){function h(){return C.apply(this,arguments)||this}u._inheritsLoose(h,
C);return h}(m.JSONSupport);return m=J.__decorate([H.subclass("esri.views.layers.support.ClipArea")],m)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(u,J,m,A,l,v,w,H){var C;A=C=function(h){function e(){var n=
h.apply(this,arguments)||this;n.type="rect";n.left=null;n.right=null;n.top=null;n.bottom=null;return n}u._inheritsLoose(e,h);e.prototype.clone=function(){return new C({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};u._createClass(e,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return e}(H);J.__decorate([m.property({type:[Number,String],json:{write:!0}})],A.prototype,"left",void 0);J.__decorate([m.property({type:[Number,String],json:{write:!0}})],A.prototype,
"right",void 0);J.__decorate([m.property({type:[Number,String],json:{write:!0}})],A.prototype,"top",void 0);J.__decorate([m.property({type:[Number,String],json:{write:!0}})],A.prototype,"bottom",void 0);J.__decorate([m.property({readOnly:!0})],A.prototype,"version",null);return A=C=J.__decorate([w.subclass("esri.views.layers.support.ClipRect")],A)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(u,J,m,A,l,v,w,H,C,h,e,n,q){var p;m={base:C,key:"type",typeMap:{extent:n,polygon:q}};e=p=function(d){function x(){var P=d.apply(this,arguments)||this;P.type="geometry";P.geometry=null;return P}u._inheritsLoose(x,d);x.prototype.clone=function(){return new p({geometry:this.geometry.clone()})};u._createClass(x,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return x}(e);J.__decorate([A.property({types:m,json:{read:h.fromJSON,write:!0}})],e.prototype,"geometry",void 0);J.__decorate([A.property({readOnly:!0})],
e.prototype,"version",null);return e=p=J.__decorate([H.subclass("esri.views.layers.support.Geometry")],e)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(u,J,m,A,l,v,w,H){A=function(C){function h(){var e=C.apply(this,
arguments)||this;e.type="path";e.path=[];return e}u._inheritsLoose(h,C);u._createClass(h,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return h}(H);J.__decorate([m.property({type:[[[Number]]],json:{write:!0}})],A.prototype,"path",void 0);J.__decorate([m.property({readOnly:!0})],A.prototype,"version",null);return A=J.__decorate([w.subclass("esri.views.layers.support.Path")],A)})},"esri/views/2d/layers/imagery/ImageryTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../engine/RasterTileContainer ./BaseImageryTileSubView2D".split(" "),
function(u,J,m,A,l,v,w,H,C,h){l=function(e){function n(){var p=e.apply(this,arguments)||this;p.container=null;p.layer=null;p.tileSize=null;p.type="raster";p.useWebGLForProcessing=!0;return p}u._inheritsLoose(n,e);var q=n.prototype;q.canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())};q.fetchTile=function(p,d){return this.layer.fetchTile(p.level,p.row,
p.col,d)};q.updateTileSource=function(){var p=u._asyncToGenerator(function*(d,x){const {bandIds:P}=this.layer,y=this._getLayerInterpolation(),N=this.canUseWebGLForProcessing(),{source:M,symbolizerParams:K,globalSymbolizerParams:Q,suspended:f,coords:a,resolution:b}=x;({bitmap:d}=d);[d.x,d.y]=a;d.resolution=b;M&&m.isSome(M)&&m.isSome(M.pixelBlock)?(x={extent:M.extent,pixelBlock:M.pixelBlock},d.rawPixelData=x,N?(d.source=M.pixelBlock,d.isRendereredSource=!1):(x=yield this.layer.applyRenderer(x,"stretch"===
(null==Q?void 0:Q.type)?Q:null),d.source=x,d.isRendereredSource=!0),d.symbolizerParameters=N?K:null,N?d.transformGrid||(d.transformGrid=M.transformGrid):d.transformGrid=null):(x=this.createEmptyTilePixelBlock(),d.source=x,d.symbolizerParameters=N?K:null,d.transformGrid=null);d.bandIds=N?P:null;d.width=this.tileSize[0];d.height=this.tileSize[1];d.interpolation=y;d.suspended=f;d.invalidateTexture()});return function(d,x){return p.apply(this,arguments)}}();q.updateTileSymbolizerParameters=function(){var p=
u._asyncToGenerator(function*(d,x){const {local:P,global:y}=x;({bandIds:x}=this.layer);const N=this._getLayerInterpolation(),M=this.canUseWebGLForProcessing();({bitmap:d}=d);const {rawPixelData:K}=d;!M&&m.isSome(K)?(d.source=yield this.layer.applyRenderer(K,"stretch"===(null==y?void 0:y.type)?y:null),d.isRendereredSource=!0):(d.isRendereredSource&&m.isSome(K)&&(d.source=K.pixelBlock),d.isRendereredSource=!1);d.symbolizerParameters=M?y||P:null;d.bandIds=M?x:null;d.interpolation=N;d.suspended=!1});
return function(d,x){return p.apply(this,arguments)}}();q.install=function(p,d){this.container=new C.RasterTileContainer(d.tileInfoView);this.container.isCustomTilingScheme=d.isCustomTilingScheme;p.addChild(this.container)};q.uninstall=function(){this.container.removeAllChildren();this.container.remove()};q._canUseMajorityInterpolationOnDataSource=function(){const {bandCount:p,attributeTable:d,colormap:x,pixelType:P}=this.layer.rasterInfo;return 1===p&&(null!=d||null!=x||"u8"===P||"s8"===P)};q._getLayerInterpolation=
function(){var p=this.layer.renderer.type;if("raster-colormap"===p||"unique-value"===p||"class-breaks"===p)return"nearest";({interpolation:p}=this.layer);const {renderer:d}=this.layer;return"raster-stretch"===d.type&&null!=d.colorRamp?"bilinear"===p||"cubic"===p?"bilinear":"nearest":p};return n}(h.BaseImageryTileSubView2D);J.__decorate([A.property()],l.prototype,"container",void 0);J.__decorate([A.property()],l.prototype,"layer",void 0);J.__decorate([A.property()],l.prototype,"tileSize",void 0);J.__decorate([A.property()],
l.prototype,"type",void 0);J.__decorate([A.property()],l.prototype,"useWebGLForProcessing",void 0);return l=J.__decorate([H.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],l)})},"esri/views/2d/engine/RasterTileContainer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ../viewpointUtils ./brushes ./RasterTile ./webgl/enums ./webgl/TileContainer".split(" "),function(u,J,m,A,l,v,w,H){H=function(C){function h(){var n=C.apply(this,
arguments)||this;n.isCustomTilingScheme=!1;return n}J._inheritsLoose(h,C);var e=h.prototype;e.createTile=function(n){const q=this._getTileBounds(n),[p,d]=this._tileInfoView.tileInfo.size;return new v.RasterTile(n,q[0],q[3],p,d)};e.destroyTile=function(){};e.prepareRenderPasses=function(n){const q=n.registerRenderPass({name:"imagery (tile)",brushes:[l.brushes.raster],target:()=>this.children.map(p=>p.bitmap),drawPhase:w.WGLDrawPhase.MAP});return[...C.prototype.prepareRenderPasses.call(this,n),q]};
e.doRender=function(n){this.visible&&n.drawPhase===w.WGLDrawPhase.MAP&&C.prototype.doRender.call(this,n)};e._getTileBounds=function(n){const q=this._tileInfoView.getTileBounds(m.create(),n);if(this.isCustomTilingScheme&&n.world){var {tileInfo:p}=this._tileInfoView,d=A.getWorldWidth(p.spatialReference);if(d){const {resolution:x}=p.lodAt(n.level);p=(d=d/x%p.size[0])?(p.size[0]-d)*x:0;q[0]-=p*n.world;q[2]-=p*n.world}}return q};return h}(H["default"]);u.RasterTileContainer=H;Object.defineProperty(u,"__esModule",
{value:!0})})},"esri/views/2d/engine/RasterTile":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/mat3f32","./RasterBitmap","./webgl/TiledDisplayObject"],function(u,J,m,A,l){l=function(v){function w(C,h,e,n,q,p=null){var d=v.call(this,C,h,e,n,q)||this;d.bitmap=new A.RasterBitmap(p,null,null);d.bitmap.coordScale=[n,q];d.bitmap.once("isReady",()=>d.ready());return d}J._inheritsLoose(w,v);var H=w.prototype;H.destroy=function(){v.prototype.destroy.call(this);this.bitmap.destroy();
this.stage=this.bitmap=null};H.setTransform=function(C,h){v.prototype.setTransform.call(this,C,h);this.bitmap.transforms.dvs=this.transforms.dvs};H._createTransforms=function(){return{dvs:m.create(),tileMat3:m.create()}};H.onAttach=function(){this.bitmap.stage=this.stage};H.onDetach=function(){this.bitmap.stage=null};J._createClass(w,[{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(C){this.bitmap.stencilRef=C}}]);return w}(l.TiledDisplayObject);u.RasterTile=l;Object.defineProperty(u,
"__esModule",{value:!0})})},"esri/views/2d/layers/imagery/BaseImageryTileSubView2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/PixelBlock".split(" "),function(u,J,m,A,l,v,w,
H,C,h,e){u.BaseImageryTileSubView2D=function(n){function q(){var d=n.apply(this,arguments)||this;d._emptyTilePixelBlock=null;d.container=null;d.layer=null;d.tileSize=null;d.useWebGLForProcessing=!0;return d}J._inheritsLoose(q,n);var p=q.prototype;p.fetchTile=function(d,x){return this.layer.fetchTile(d.level,d.row,d.col,x)};p.createEmptyTilePixelBlock=function(d=null){const x=null==d||d.join(",")===this.tileSize.join(",");if(x&&l.isSome(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;d=
d||this.tileSize;const [P,y]=d;d=new e({width:P,height:y,pixels:[new Uint8Array(P*y)],mask:new Uint8Array(P*y),pixelType:"u8"});x&&(this._emptyTilePixelBlock=d);return d};return q}(A);m.__decorate([v.property()],u.BaseImageryTileSubView2D.prototype,"container",void 0);m.__decorate([v.property()],u.BaseImageryTileSubView2D.prototype,"layer",void 0);m.__decorate([v.property()],u.BaseImageryTileSubView2D.prototype,"tileSize",void 0);m.__decorate([v.property()],u.BaseImageryTileSubView2D.prototype,"type",
void 0);m.__decorate([v.property()],u.BaseImageryTileSubView2D.prototype,"useWebGLForProcessing",void 0);u.BaseImageryTileSubView2D=m.__decorate([h.subclass("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],u.BaseImageryTileSubView2D);Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/2d/layers/imagery/VectorFieldTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/RasterVFTileContainer ./BaseImageryTileSubView2D".split(" "),
function(u,J,m,A,l,v,w,H,C,h,e){l=function(n){function q(){var d=n.apply(this,arguments)||this;d._handle=null;d.container=null;d.layer=null;d.tileSize=null;d.type="rasterVF";d.useWebGLForProcessing=!0;return d}u._inheritsLoose(q,n);var p=q.prototype;p.canUseWebGLForProcessing=function(){return!1};p.fetchTile=function(){var d=u._asyncToGenerator(function*(x,P){x=yield this.layer.fetchTile(x.level,x.row,x.col,P);"vector-magdir"===this.layer.rasterInfo.dataType&&null!=x&&x.pixelBlock&&(x.pixelBlock=
yield this.layer.convertVectorFieldData(x.pixelBlock,P));return x});return function(x,P){return d.apply(this,arguments)}}();p.updateTileSource=function(d,x){const P=x.symbolizerParams,{tileData:y}=d;y.key=d.key;y.width=this.tileSize[0];y.height=this.tileSize[1];({symbolTileSize:d}=P);({source:x}=x);y.offset=this._getTileSymbolOffset(y.key,d);m.isSome(x)&&m.isSome(x.pixelBlock)?(y.rawPixelData={extent:x.extent,pixelBlock:x.pixelBlock},y.source=this._sampleVectorFieldData(x.pixelBlock,P,y.offset)):
(x=this.createEmptyTilePixelBlock([Math.round((this.tileSize[0]-y.offset[0])/d),Math.round((this.tileSize[1]-y.offset[1])/d)]),y.source=x);y.symbolizerParameters=P;y.invalidateVAO();return Promise.resolve(null)};p.updateTileSymbolizerParameters=function(d,x){var P;x=x.local;const {symbolTileSize:y}=x;({tileData:d}=d);d.offset=this._getTileSymbolOffset(d.key,y);const N=d.symbolizerParameters.symbolTileSize;d.symbolizerParameters=x;m.isSome(null==(P=d.rawPixelData)?void 0:P.pixelBlock)&&N!==y&&(d.source=
this._sampleVectorFieldData(d.rawPixelData.pixelBlock,d.symbolizerParameters,d.offset));return Promise.resolve(null)};p.install=function(d,x){this.container=new h.RasterVFTileContainer(x.tileInfoView);this.container.isCustomTilingScheme=x.isCustomTilingScheme;this._updateSymbolType(this.layer.renderer);this._handle=this.layer.watch("renderer",P=>this._updateSymbolType(P));d.addChild(this.container)};p.uninstall=function(){this.container.removeAllChildren();this._handle.remove();this._handle=null;
this.container.remove()};p._getTileSymbolOffset=function(d,x){const P=d.col*this.tileSize[0]%x;d=d.row*this.tileSize[1]%x;return[P>x/2?x-P:-P,d>x/2?x-d:-d]};p._sampleVectorFieldData=function(d,x,P){({symbolTileSize:x}=x);return C.sampleVectorField(d,"vector-uv",x,P)};p._updateSymbolType=function(d){"vector-field"===d.type&&(this.container.symbolTypes="wind-barb"===d.style?["scalar","triangle"]:"simple-scalar"===d.style?["scalar"]:["triangle"])};return q}(e.BaseImageryTileSubView2D);J.__decorate([A.property()],
l.prototype,"container",void 0);J.__decorate([A.property()],l.prototype,"layer",void 0);J.__decorate([A.property()],l.prototype,"tileSize",void 0);J.__decorate([A.property()],l.prototype,"type",void 0);J.__decorate([A.property()],l.prototype,"useWebGLForProcessing",void 0);return l=J.__decorate([H.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],l)})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../../../core/maybe","../PixelBlock",
"./pixelUtils"],function(u,J,m,A,l){function v(f,a){return d.get(f)/d.get(a)||1}function w(f,a="geographic"){const [b,g]=f;f=Math.sqrt(b*b+g*g);let k=Math.atan2(g,b)*x;k=(360+k)%360;"geographic"===a&&(k=(450-k)%360);return[f,k]}function H(f,a="geographic"){let b=f[1];"geographic"===a&&(b=(450-b)%360);b%=360;f=f[0];return[f*Math.cos(b/x),f*Math.sin(b/x)]}function C(f=0,a=Math.PI,b=!0){b&&(a=(2*Math.PI-a)%(2*Math.PI));var g=b?-1:1;b=5*g;const k=20*g,r=25*g;g*=2;let [z,B]=[5,0-k],[D,L]=[z+2,B],[G,I]=
[D-0,L+g],[E,c]=[-5,0-r],[t,F]=[E+0,c-g];f=Math.ceil(f/5);let R=Math.floor(f/10);f-=8*R;const O=[],S=[];for(let ba=0;ba<f/2;ba++,R--){0>=R&&1===f%2&&ba===(f-1)/2&&(E=0,t=E+0,c=(c+B)/2,F=c-g);const [ha,ia]=h(E,c,a,45);if(0<R){const [ca,da]=h(D,c,a,45),[ea,fa]=h(z,B,a,45);O.push(ca);O.push(da);O.push(ha);O.push(ia);O.push(ea);O.push(fa)}else{const [ca,da]=h(D,L,a,45),[ea,fa]=h(G,I,a,45),[ja,ka]=h(t,F,a,45);S.push(ha);S.push(ia);S.push(ja);S.push(ka);S.push(ea);S.push(fa);S.push(ca);S.push(da)}c+=b;
B+=b;L+=b;I+=b;F+=b}const [U,V]=h(5,0+k,a,45),[T,W]=h(7,0+k,a,45),[X,Y]=h(5,0-r,a,45),[Z,aa]=h(7,0-r,a,45);return{pennants:O,barbs:S,shaft:[U,V,T,W,X,Y,Z,aa]}}function h(f,a,b,g=1){return[Math.sqrt(f*f+a*a)/g,(2*Math.PI+(2*Math.PI+Math.atan2(a,f))%(2*Math.PI)-b)%(2*Math.PI)]}function e(f,a,b,g){b=v(g||"knots",b);for(g=1;g<a.length;g++)if(g===a.length-1){if(f<a[g]*b)break}else if(f<=a[g]*b)break;return Math.min(g-1,a.length-2)}function n(f,a,b,g,k){let r=0;switch(a){case "beaufort_kn":r=e(f,N,"knots",
b);break;case "beaufort_km":r=e(f,N,"kilometer-per-hour",b);break;case "beaufort_ft":r=e(f,N,"feet-per-second",b);break;case "beaufort_m":r=e(f,N,"meter-per-second",b);break;case "classified_arrow":r=e(f,k,g,b);break;case "ocean_current_m":r=e(f,M,"meter-per-second",b);break;case "ocean_current_kn":r=e(f,K,"knots",b)}return r}function q(f,a){const {style:b,inputUnit:g,outputUnit:k,breakValues:r}=a;a=P.fromJSON(g);const z=P.fromJSON(k);let B=0,D=0;const {width:L,height:G,mask:I}=f,E=f.pixels[0];f=
f.pixels[1];var c=I?I.filter(O=>0<O).length:L*G;const t=new Float32Array(42*c);c=new Uint32Array(15*c);for(let O=0;O<G;O++)for(let S=0;S<L;S++){var F=O*L+S;if(!I||I[O*L+S]){var R;const U=null!=(R=(f[F]+360)%360/180*Math.PI)?R:2*Math.PI*Math.random(),V=n(E[F],b,a,z,r);for(let T=0;T<y.length;T+=2)t[B++]=(S+.5)/L,t[B++]=(O+.5)/G,t[B++]=y[T],t[B++]=y[T+1]+U,t[B++]=V,t[B++]=E[F];F=7*(B/42-1);c[D++]=F;c[D++]=F+1;c[D++]=F+2;c[D++]=F+0;c[D++]=F+4;c[D++]=F+3;c[D++]=F+0;c[D++]=F+2;c[D++]=F+3;c[D++]=F+2;c[D++]=
F+5;c[D++]=F+3;c[D++]=F+5;c[D++]=F+6;c[D++]=F+3}}return{vertexData:t,indexData:c}}function p(f,a){let b=0,g=0;const {width:k,height:r,mask:z}=f;f=f.pixels[0];const B=[],D=[];a="wind_speed"===a.style?5:Number.MAX_VALUE;for(let G=0;G<r;G++)for(let I=0;I<k;I++){var L=G*k+I;if((!z||z[G*k+I])&&f[L]<a){for(let E=0;4>E;E++)B[b++]=(I+.5)/k,B[b++]=(G+.5)/r,B[b++]=2>E?-.5:.5,B[b++]=0===E%2?-.5:.5,B[b++]=0,B[b++]=f[L];L=4*(b/24-1);D[g++]=L;D[g++]=L+1;D[g++]=L+2;D[g++]=L+1;D[g++]=L+2;D[g++]=L+3}}return{vertexData:new Float32Array(B),
indexData:new Uint32Array(D)}}const d=new Map;d.set("meter-per-second",1);d.set("kilometer-per-hour",.277778);d.set("knots",.514444);d.set("feet-per-second",.3048);d.set("mile-per-hour",.44704);const x=180/Math.PI,P=new J.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),y=function(f=0,a=0,b=Math.PI,g=!0){g&&(b=(2*Math.PI-b)%(2*Math.PI));g=g?-1:1;const k=-7*g,r=-2*g,z=
-16*g,[B,D]=h(0,a+13*g,b,29),[L,G]=h(f-5.5,a+k,b,29),[I,E]=h(f+5.5,a+k,b,29),[c,t]=h(f-1.5,a+r,b,29),[F,R]=h(f+1.5,a+r,b,29),[O,S]=h(f-1.5,a+z,b,29),[U,V]=h(f+1.5,a+z,b,29);return[B,D,L,G,c,t,F,R,I,E,O,S,U,V]}(0,0,0),N=[0,1,3,6,10,16,21,27,33,40,47,55,63],M=[0,.5,1,1.5,2],K=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],Q=[];u.convertVectorFieldData=function(f,a,b="geographic",g=1){if(!l.isValidPixelBlock(f))return f;const {pixels:k,width:r,height:z}=f;var B=r*z;const D=k[0],L=k[1],G=A.createEmptyBand(f.pixelType,
B);B=A.createEmptyBand(f.pixelType,B);let I=0;for(let E=0;E<z;E++)for(let c=0;c<r;c++)"vector-uv"===a?([G[I],B[I]]=w([D[I],L[I]],b),G[I]*=g):([G[I],B[I]]=H([D[I],L[I]],b),G[I]*=g,B[I]*=g),I++;f=new A({pixelType:f.pixelType,width:f.width,height:f.height,mask:f.mask,validPixelCount:f.validPixelCount,maskIsAlpha:f.maskIsAlpha,pixels:[G,B]});f.updateStatistics();return f};u.convertVectorFieldUnit=function(f,a,b=1){if(1===b||!l.isValidPixelBlock(f))return f;f=f.clone();const {pixels:g,width:k,height:r}=
f,z=g[0],B=g[1];let D=0;for(let L=0;L<r;L++)for(let G=0;G<k;G++)"vector-uv"===a?(z[D]*=b,B[D]*=b):z[D]*=b,D++;f.updateStatistics();return f};u.createVFMesh=function(f,a){if("simple_scalar"===a.style)var b=p(f,a);else if("wind_speed"===a.style){{if(0===Q.length)for(var g=0;30>g;g++)Q.push(C(5*g,0));a=P.fromJSON(a.inputUnit);a=v(a,"knots");const {width:B,height:D,mask:L}=f;g=f.pixels[0];f=f.pixels[1];const G=[],I=[];let E=0,c=0;for(let t=0;t<D;t++)for(let F=0;F<B;F++){var k=t*B+F,r=g[k]*a;if((!L||L[t*
B+F])&&5<=r){const R=null!=(b=(f[k]+360)%360/180*Math.PI)?b:2*Math.PI*Math.random(),{pennants:O,barbs:S,shaft:U}=Q[Math.min(Math.floor(r/5),29)];if(0===O.length+S.length)continue;k=G.length/6;const V=(F+.5)/B,T=(t+.5)/D;for(var z=0;z<O.length;z+=2)G[E++]=V,G[E++]=T,G[E++]=O[z],G[E++]=O[z+1]+R,G[E++]=0,G[E++]=r;for(z=0;z<S.length;z+=2)G[E++]=V,G[E++]=T,G[E++]=S[z],G[E++]=S[z+1]+R,G[E++]=0,G[E++]=r;for(z=0;z<U.length;z+=2)G[E++]=V,G[E++]=T,G[E++]=U[z],G[E++]=U[z+1]+R,G[E++]=0,G[E++]=r;for(r=0;r<O.length/
6;r++)I[c++]=k,I[c++]=k+1,I[c++]=k+2,k+=3;for(r=0;r<S.length/8;r++)I[c++]=k,I[c++]=k+1,I[c++]=k+2,I[c++]=k+1,I[c++]=k+2,I[c++]=k+3,k+=4;I[c++]=k+0;I[c++]=k+1;I[c++]=k+2;I[c++]=k+1;I[c++]=k+3;I[c++]=k+2;k+=4}}b={vertexData:new Float32Array(G),indexData:new Uint32Array(I)}}}else b=q(f,a);return b};u.createVFMeshScalar=p;u.getUnitConversionFactor=v;u.sampleVectorField=function(f,a,b,g=[0,0],k=.5){const {width:r,height:z,mask:B}=f,[D,L]=f.pixels,[G,I]=g;f=Math.round((r-G)/b);g=Math.round((z-I)/b);var E=
f*g;const c=new Float32Array(E),t=new Float32Array(E);E=new Uint8Array(E);a="vector-uv"===a;for(let R=0;R<g;R++)for(let O=0;O<f;O++){let S=0;const U=R*f+O,V=Math.max(0,R*b+I),T=Math.max(0,O*b+G),W=Math.min(z,V+b),X=Math.min(r,T+b);for(let Y=V;Y<W;Y++)for(let Z=T;Z<X;Z++){var F=Y*r+Z;if(!B||B[F]){S++;F=a?[D[F],L[F]]:[D[F],(360+L[F])%360];const [aa,ba]=a?F:H(F);c[U]+=aa;t[U]+=ba}}if(S>=(W-V)*(X-T)*(1-k)){E[U]=1;const [Y,Z]=w([c[U]/S,t[U]/S]);c[U]=Y;t[U]=Z}else E[U]=0,c[U]=0,t[U]=0}b=new A({width:f,
height:g,pixels:[c,t],mask:E});b.updateStatistics();return b};u.snapImageToSymbolTile=function(f,a,b,g,k){if(!m.isSome(k)||!k.spatialReference.equals(f.spatialReference))return{extent:f,width:a,height:b,resolution:f.width/a};const r=k.xmin;k=k.ymax;g=Math.max(g||0,30);a=((f.xmax-f.xmin)/Math.ceil(1/g*a)+(f.ymax-f.ymin)/Math.ceil(1/g*b))/2;f.xmin=r+Math.floor((f.xmin-r)/a)*a;f.xmax=r+Math.ceil((f.xmax-r)/a)*a;f.ymin=k+Math.floor((f.ymin-k)/a)*a;f.ymax=k+Math.ceil((f.ymax-k)/a)*a;return{extent:f,width:Math.round(f.width/
a),height:Math.round(f.height/a),resolution:a}};u.unitKebabDict=P;u.uvComponentToVector=w;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterVFTileContainer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ./RasterVFTile ./webgl/enums ./webgl/TileContainer ./webgl/brushes/raster/BrushVectorField".split(" "),function(u,J,m,A,l,v,w){v=function(H){function C(){var e=H.apply(this,arguments)||this;e.isCustomTilingScheme=
!1;e.symbolTypes=["triangle"];return e}J._inheritsLoose(C,H);var h=C.prototype;h.createTile=function(e){const n=this._tileInfoView.getTileBounds(m.create(),e),[q,p]=this._tileInfoView.tileInfo.size;return new A.RasterVFTile(e,n[0],n[3],q,p)};h.destroyTile=function(){};h.prepareRenderPasses=function(e){const n=e.registerRenderPass({name:"imagery (vf tile)",brushes:[w],target:()=>this.children.map(q=>q.tileData),drawPhase:l.WGLDrawPhase.MAP});return[...H.prototype.prepareRenderPasses.call(this,e),n]};
h.doRender=function(e){this.visible&&e.drawPhase===l.WGLDrawPhase.MAP&&this.symbolTypes.forEach(n=>{e.renderPass=n;H.prototype.doRender.call(this,e)})};return C}(v["default"]);u.RasterVFTileContainer=v;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterVFTile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat3 ../../../chunks/mat3f32 ./RasterVFDisplayObject ./webgl/TiledDisplayObject".split(" "),function(u,J,m,A,l,v){v=function(w){function H(h,
e,n,q,p,d=null){var x=w.call(this,h,e,n,q,p)||this;x.tileData=new l.RasterVFDisplayObject(d);x.tileData.coordScale=[q,p];x.tileData.once("isReady",()=>x.ready());return x}J._inheritsLoose(H,w);var C=H.prototype;C.destroy=function(){w.prototype.destroy.call(this);this.tileData.destroy();this.stage=this.tileData=null};C._createTransforms=function(){return{dvs:A.create(),tileMat3:A.create()}};C.setTransform=function(h,e){w.prototype.setTransform.call(this,h,e);const n=e/(h.resolution*h.pixelRatio),q=
this.transforms.tileMat3,[p,d]=this.tileData.offset,[x,P]=h.toScreenNoRotation([0,0],[this.x+p*e,this.y-d*e]);({symbolTileSize:e}=this.tileData.symbolizerParameters);m.set(q,Math.round((this.width-this.tileData.offset[0])/e)*e/this.rangeX*n,0,0,0,Math.round((this.height-this.tileData.offset[1])/e)*e/this.rangeY*n,0,x,P,1);m.multiply(this.transforms.dvs,h.displayViewMat3,q);this.tileData.transforms.dvs=this.transforms.dvs};C.onAttach=function(){this.tileData.stage=this.stage};C.onDetach=function(){this.tileData.stage=
null};J._createClass(H,[{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(h){this.tileData.stencilRef=h}}]);return H}(v.TiledDisplayObject);u.RasterVFTile=v;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterVFDisplayObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ../../../core/maybe ../../../chunks/mat3f32 ../../../layers/support/rasterFunctions/vectorFieldUtils ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/checkWebGLError ../../webgl/enums ../../../chunks/builtins ../../webgl/renderState ../../webgl/Texture ../../webgl/VertexArrayObject ./DisplayObject ./webgl/Utils".split(" "),
function(u,J,m,A,l,v,w,H,C,h,e,n,q,p,d,x){m=function(P){function y(M=null){var K=P.call(this)||this;K._source=null;K._symbolizerParameters=null;K._vaoInvalidated=!0;K.coordScale=[1,1];K.height=null;K.stencilRef=0;K.rawPixelData=null;K.width=null;K.source=M;return K}J._inheritsLoose(y,P);var N=y.prototype;N.destroy=function(){if(A.isSome(this.vaoData)){var M,K;null==(M=this.vaoData.magdir)?void 0:M.vao.dispose();null==(K=this.vaoData.scalar)?void 0:K.vao.dispose();this.vaoData=null}};N.invalidateVAO=
function(){if(!this._vaoInvalidated&&A.isSome(this.vaoData)){var M,K;null==(M=this.vaoData.magdir)?void 0:M.vao.dispose();null==(K=this.vaoData.scalar)?void 0:K.vao.dispose();this.vaoData=null;this._vaoInvalidated=!0;this.requestRender()}};N.updateVectorFieldVAO=function(M){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(A.isSome(this.source)&&!A.isSome(this.vaoData)){var {style:K}=this.symbolizerParameters;switch(K){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":K=
v.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(M.context,K)};break;case "simple_scalar":K=v.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(M.context,K)};break;case "wind_speed":{K=v.createVFMesh(this.source,this.symbolizerParameters);K=this._createVectorFieldVAO(M.context,K);const Q=v.createVFMeshScalar(this.source,this.symbolizerParameters);M=this._createVectorFieldVAO(M.context,Q);this.vaoData=
{magdir:K,scalar:M}}}}this.ready();this.requestRender()}};N._createTransforms=function(){return{dvs:l.create()}};N.onAttach=function(){this.invalidateVAO()};N.onDetach=function(){this.invalidateVAO()};N._createVectorFieldVAO=function(M,K){const {vertexData:Q,indexData:f}=K;K=w.createVertex(M,35044,new Float32Array(Q));const a=w.createIndex(M,35044,new Uint32Array(f)),b=x.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",
count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new p(M,b.attributes,b.bufferLayouts,{geometry:K},a),elementCount:f.length}};J._createClass(y,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(M){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(M)&&(this._symbolizerParameters=M,this.invalidateVAO())}},{key:"source",get:function(){return this._source},set:function(M){this._source=M;this.invalidateVAO()}}]);
return y}(d.DisplayObject);u.RasterVFDisplayObject=m;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/ImageryTileLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(u,J,m,A,l,v,w,H,C,h,e,n,q){H=p=>{p=function(d){function x(){var y=d.apply(this,arguments)||this;y._rasterFieldPrefix="Raster.";y.layer=null;y.view=null;y.fullExtent=null;y.tileInfo=null;y.datumTransformation=null;return y}J._inheritsLoose(x,d);var P=x.prototype;P.fetchPopupFeatures=function(){var y=J._asyncToGenerator(function*(N,M){const {layer:K}=this;if(!N)return Promise.reject(new l("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:K}));var {popupEnabled:Q}=
K;M=q.getFetchPopupTemplate(K,M);if(!Q||!v.isSome(M))throw new l("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:Q,popupTemplate:M});Q=[];const {value:f,magdirValue:a}=yield K.identify(N);let b="";if(f&&f.length){var g,k;b="imagery-tile"===K.type&&K.hasStandardTime()&&null!=f[0]?f.map(z=>K.getStandardTimeValue(z)).join(", "):f.join(", ");N={ObjectId:0};N["Raster.ServicePixelValue"]=this._formatAttributeValue(b,"Raster.ServicePixelValue");if((M=
null==(g=K.rasterInfo)?void 0:null==(k=g.attributeTable)?void 0:k.features)&&0<M.length&&(g=M.filter(z=>String(z.attributes.value||z.attributes.Value||z.attributes.VALUE)===b),0<g.length&&(g=g[0])))for(var r in g.attributes)g.attributes.hasOwnProperty(r)&&(k=this._rasterFieldPrefix+r,N[k]=this._formatAttributeValue(g.attributes[r],k));r=K.rasterInfo.dataType;if("vector-magdir"===r||"vector-uv"===r)N["Raster.Magnitude"]=null==a?void 0:a[0],N["Raster.Direction"]=null==a?void 0:a[1];r=new A(this.fullExtent.clone(),
null,N);r.layer=K;r.sourceLayer=r.layer;Q.push(r)}return Q});return function(N,M){return y.apply(this,arguments)}}();P.updateFullExtent=function(){var y=this.layer.tileInfo;let N;y&&y.spatialReference||(N=new l("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));y=n.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!1);y=n.projectExtent(this.layer.fullExtent,this.view.spatialReference,y);null==y&&(N=new l("layerview:projection-not-supported",
"The layer extent cannot be projected to the view's spatial reference",{layer:this.layer}));this._set("fullExtent",y);this.datumTransformation||(this.datumTransformation=n.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0));return N?Promise.reject(N):Promise.resolve()};P._formatAttributeValue=function(y,N){if("string"===typeof y&&(N=(N=this._getFieldInfo(this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,N))&&N.format)){let M,K;return-1<y.trim().indexOf(",")?
(M=",",K=M+" ",this._formatDelimitedString(y,M,K,N)):-1<y.trim().indexOf(" ")?(M=K=" ",this._formatDelimitedString(y,M,K,N)):this._formatNumberFromString(y,N)}return y};P._getFieldInfo=function(y,N){if(y&&y.length&&N){var M=N.toLowerCase(),K=void 0;y.some(Q=>!Q.fieldName||Q.fieldName.toLowerCase()!==M&&Q.fieldName.toLowerCase()!==M.replace(/ /g,"_")?!1:(K=Q,!0));return K}};P._formatDelimitedString=function(y,N,M,K){return y&&N&&M&&K?y.trim().split(N).map(Q=>this._formatNumberFromString(Q,K)).join(M):
y};P._formatNumberFromString=function(y,N){if(!y||!N)return y;const M=Number(y);return isNaN(M)?y:N.format(M)};J._createClass(x,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}}]);return x}(p);m.__decorate([w.property()],p.prototype,"layer",void 0);m.__decorate([w.property()],p.prototype,"view",void 0);m.__decorate([w.property()],p.prototype,"fullExtent",void 0);m.__decorate([w.property()],
p.prototype,"tileInfo",void 0);m.__decorate([w.property({readOnly:!0})],p.prototype,"hasTilingEffects",null);return p=m.__decorate([e.subclass("esri.views.layers.ImageryTileLayerView")],p)};u.ImageryTileLayerView=H;u["default"]=H;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(u,J,m,A){function l(){l=J._asyncToGenerator(function*(v,
w=v.popupTemplate){if(!m.isSome(w))return[];const H=yield w.getRequiredFields(v.fieldsIndex);({lastEditInfoEnabled:w}=w);const {objectIdField:C,typeIdField:h,globalIdField:e,relationships:n}=v;if(H.includes("*"))return["*"];w=w?yield A.getFeatureEditFields(v):[];const q=A.fixFields(v.fieldsIndex,[...H,...w]);h&&q.push(h);q&&C&&v.fieldsIndex.has(C)&&-1===q.indexOf(C)&&q.push(C);q&&e&&v.fieldsIndex.has(e)&&-1===q.indexOf(e)&&q.push(e);n&&n.forEach(p=>{({keyField:p}=p);q&&p&&v.fieldsIndex.has(p)&&-1===
q.indexOf(p)&&q.push(p)});return q});return l.apply(this,arguments)}u.getFetchPopupTemplate=function(v,w){return v.popupTemplate?v.popupTemplate:m.isSome(w)&&w.defaultPopupTemplateEnabled&&m.isSome(v.defaultPopupTemplate)?v.defaultPopupTemplate:null};u.getRequiredFields=function(v){return l.apply(this,arguments)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/RefreshableLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(u,J,m,A,l,v,w,H,C,h){H=e=>{e=function(n){function q(){return n.apply(this,arguments)||this}J._inheritsLoose(q,n);q.prototype.initialize=function(){this.handles.add(v.on(this,"layer","refresh",()=>{this.doRefresh().catch(p=>{l.isAbortError(p)||A.getLogger(this.declaredClass).error(p)})}),"RefreshableLayerView")};return q}(e);m.__decorate([w.property()],e.prototype,"layer",void 0);return e=m.__decorate([h.subclass("esri.layers.mixins.RefreshableLayerView")],e)};u.RefreshableLayerView=H;u["default"]=
H;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/support/drapedUtils":function(){define("exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils ../../geometry/Extent".split(" "),function(u,J,m,A,l,v){function w(C,h,e,n=new v){let q;if("2d"===e.type)q=h*e.resolution;else if("3d"===e.type){var p=e.overlayPixelSizeInMapUnits(C),d=e.basemapSpatialReference;q=m.isSome(d)&&!d.equals(e.spatialReference)?A.getMetersPerUnitForSR(d)/A.getMetersPerUnitForSR(e.spatialReference):
h*p}h=C.x-q;p=C.y-q;d=C.x+q;C=C.y+q;({spatialReference:e}=e);n.xmin=Math.min(h,d);n.ymin=Math.min(p,C);n.xmax=Math.max(h,d);n.ymax=Math.max(p,C);n.spatialReference=e;return n}const H=new v;u.createQueryGeometry=w;u.intersectsDrapedGeometry=function(C,h,e){C=e.toMap(C);if(m.isNone(C))return!1;const n=l.calculateTolerance();return w(C,n,e,H).intersects(h)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(u){function J(l,
v){return v?"xoffset"in v&&v.xoffset?Math.max(l,Math.abs(v.xoffset)):"yoffset"in v&&v.yoffset?Math.max(l,Math.abs(v.yoffset||0)):l:l}function m(l,v){if("number"===typeof l)return l;if(l&&l.stops&&l.stops.length){{l=l.stops;let w=v=0;for(let H=0;H<l.length;H++){const C=l[H].size;"number"===typeof C&&(v+=C,w++)}l=v/w}return l}return v}function A(l,v){if(!v)return l;v=v.filter(C=>"size"===C.type).map(C=>{const {maxSize:h,minSize:e}=C;return(m(h,l)+m(e,l))/2});let w=0;const H=v.length;if(0===H)return l;
for(let C=0;C<H;C++)w+=v[C];return Math.max(Math.floor(w/H),l)}u.calculateTolerance=function(l){const v=l&&l.renderer;l="touch"===(l&&l.event&&l.event.pointerType)?9:6;if(!v)return l;l="visualVariables"in v?A(l,v.visualVariables):l;if("simple"===v.type)return J(l,v.symbol);if("unique-value"===v.type){let w=l;v.uniqueValueInfos.forEach(H=>{w=J(w,H.symbol)});return w}if("class-breaks"===v.type){let w=l;v.classBreakInfos.forEach(H=>{w=J(w,H.symbol)});return w}return l};Object.defineProperty(u,"__esModule",
{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/support/TileInfo ../../../layers/support/rasterDatasets/RawBlockCache ../../../layers/support/rasterFunctions/pixelUtils ../../../layers/support/rasterFunctions/rasterProjectionHelper ./LayerView2D ./imagery/ImageryTileView2D ./imagery/VectorFieldTileView2D ../tiling/TileInfoView ../tiling/TileQueue ../tiling/TileStrategy ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../support/drapedUtils ../../webgl/capabilities ../../../geometry/Extent ../../../geometry/Point".split(" "),function(u,
J,m,A,l,v,w,H,C,h,e,n,q,p,d,x,P,y,N,M,K,Q,f,a,b,g,k,r,z,B){const D=l.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),L=[0,0];m=function(G){function I(){var c=G.apply(this,arguments)||this;c._tileStrategy=null;c._tileInfoView=null;c._fetchQueue=null;c._blockCacheRegistryUrl=null;c._blockCacheRegistryId=null;c._srcResolutions=null;c._previousLOD=null;c._needBlockCacheUpdate=!1;c._globalSymbolizerParams=null;c._symbolizerParams=null;c._abortController=null;c._globalUpdateRequested=!1;c._isCustomTilingScheme=
!1;c.subview=null;c._redrawOrRefetch=w.debounce((t,F)=>t?c.doRefresh():c._redrawImage(F));return c}u._inheritsLoose(I,G);var E=I.prototype;E.initialize=function(){const c=this.updateFullExtent();this.addResolvingPromise(c)};E.hitTest=function(c,t){if(this.suspended)return Promise.resolve(null);c=this.view.toMap(H.createScreenPoint(c,t));return Promise.resolve(new A({attributes:{},geometry:c}))};E.update=function(c){this._fetchQueue.pause();this._fetchQueue.state=c.state;this._tileStrategy.update(c);
this._fetchQueue.resume();const {extent:t,resolution:F,scale:R}=c.state;c=this._tileInfoView.getClosestInfoForScale(R);if(this.layer.raster){var O;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const S=this._srcResolutions[c.level],U=t.toJSON?t:z.fromJSON(t);d.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,U,F,S,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1;(null==(O=this._previousLOD)?void 0:O.level)!==c.level&&(this._previousLOD=c,null==this._symbolizerParams||
this.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}this.notifyChange("updating")};E.attach=function(){this.layer.increaseRasterJobHandlerUsage();r().supportsTextureFloat||(this.useWebGLForProcessing=!1);this._initializeTileInfo();this._tileInfoView=new K(this.tileInfo,this.fullExtent);var c=this._computeFetchConcurrency();this._fetchQueue=new Q({tileInfoView:this._tileInfoView,concurrency:c,process:(t,F)=>this.fetchTile(t,F)});c=this._getCacheSize(this.useProgressiveUpdate);
this._tileStrategy=new f({cachePolicy:"purge",acquireTile:t=>this.acquireTile(t),releaseTile:t=>this.releaseTile(t),cacheSize:c,tileInfoView:this._tileInfoView});this._updatesubview();this.handles.add([C.watch(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(t,F,R)=>{const O="multidimensionalDefinition"===R;t="interpolation"===R&&("majority"===t||"majority"===F)&&this._canUseMajorityInterpolationOnDataSource();(F="renderer"===R&&"vector-field"===F.type!==("vector-field"===
F.type))&&this._updatesubview();this._redrawOrRefetch(O||t||F).catch(S=>{w.isAbortError(S)||D.error(S)})}),C.init(this,["layer.blendMode"],t=>{this.subview&&(this.subview.container.blendMode=t)},!0),C.init(this,["layer.effect"],t=>{this.subview&&(this.subview.container.effect=t)},!0)],"attach");this._updateBlockCacheRegistry()};E.detach=function(){var c;this.handles.remove("attach");this.layer.decreaseRasterJobHandlerUsage();null==(c=this.subview)?void 0:c.uninstall();this._tileStrategy.destroy();
this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null;d.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId)};E.moveStart=function(){this.requestUpdate()};E.viewChange=function(){this.requestUpdate()};E.moveEnd=function(){if(this.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),this._abortController=w.createAbortController(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>
{this._globalUpdateRequested=!1;this.requestUpdate()});const c=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(c);this.requestUpdate()};E.createFetchPopupFeaturesQueryGeometry=function(c,t){return k.createQueryGeometry(c,t,this.view)};E.doRefresh=function(){var c=u._asyncToGenerator(function*(){if(!this.suspended){yield this.layer.updateRenderer();this._updateSymbolizerParams();this._updateBlockCacheRegistry(!0);this._fetchQueue.reset();var t=[];this._tileStrategy.tiles.forEach(F=>
t.push(this._enqueueTileFetch(F)));yield w.eachAlways(t);this.notifyChange("updating")}});return function(){return c.apply(this,arguments)}}();E.isUpdating=function(){return 0<this._fetchQueue.length||this._globalUpdateRequested};E.acquireTile=function(c){c=this.subview.container.createTile(c);this._enqueueTileFetch(c);this.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate;return c};E.releaseTile=function(c){var t;this._fetchQueue.abort(c.key.id);
null==(t=this.subview)?void 0:t.container.removeChild(c);c.once("detach",()=>{c.destroy();this.requestUpdate()});this.requestUpdate()};E.fetchTile=function(c,t){t=!v.isNone(t)&&t.signal;const F=this.subview.canUseWebGLForProcessing();t={allowPartialFill:!0,tileInfo:this.tileInfo,signal:v.unwrap(t),registryId:this._blockCacheRegistryId,requestRawData:F,srcResolution:this._srcResolutions[c.level],datumTransformation:this.datumTransformation,interpolation:F?"nearest":this.layer.interpolation};return this.subview.fetchTile(c,
t)};E._updatesubview=function(){var c=this._isVectorField()?"rasterVF":"raster";if(this.subview){if(this.subview.type===c)return;this.subview.uninstall()}const {layer:t}=this;c=new ("rasterVF"===c?M:N)({layer:t,tileSize:this.tileInfo.size,useWebGLForProcessing:this.useWebGLForProcessing});c.install(this.container,{tileInfoView:this._tileInfoView,isCustomTilingScheme:this._isCustomTilingScheme});c.container.blendMode=t.blendMode;c.container.effect=t.effect;this.subview=c};E._isVectorField=function(){return"vector-field"===
this.layer.renderer.type};E._getCacheSize=function(c){return c?40:0};E._initializeTileInfo=function(){var c=this.view.spatialReference;const t=new B({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:c}),{scales:F,srcResolutions:R,isCustomTilingScheme:O}=P.computeProjectedScales(this.layer.rasterInfo,c);c=p.create({spatialReference:c,size:512,scales:F});if(0===c.origin.x||c.origin.x>t.x)c.origin=t;this._isCustomTilingScheme=O;this._set("tileInfo",c);this._srcResolutions=null!=R?R:[]};
E._computeFetchConcurrency=function(){var {blockBoundary:c}=this.layer.rasterInfo.storageInfo;c=c[c.length-1];return 64<(c.maxCol-c.minCol+1)*(c.maxRow-c.minRow+1)?2:10};E._enqueueTileFetch=function(){var c=u._asyncToGenerator(function*(t,F){if(!this._fetchQueue.has(t.key.id)){try{const R=yield this._fetchQueue.push(t.key),{bandIds:O}=this.layer;let S=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.moving&&0===this._fetchQueue.length){S=
!1;try{yield this._redrawImage(this._abortController&&this._abortController.signal)}catch(T){w.isAbortError(T)&&D.error(T)}this._globalUpdateRequested=!1}!this.subview.canUseWebGLForProcessing()&&!this._isVectorField()||this.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const U=this._tileInfoView.getTileCoords(L,t.key),V=this._tileInfoView.getTileResolution(t.key);yield this.subview.updateTileSource(t,{source:R,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,
suspended:S,bandIds:O,coords:U,resolution:V});t.once("attach",()=>this.requestUpdate());this.subview.container.addChild(t)}catch(R){w.isAbortError(R)||D.error(R)}this.requestUpdate()}});return function(t,F){return c.apply(this,arguments)}}();E._redrawImage=function(){var c=u._asyncToGenerator(function*(t){var F=this;0!==this.subview.container.children.length&&(yield this.layer.updateRenderer(),this.hasTilingEffects?yield this._updateGlobalSymbolizerParams(t):(this._updateSymbolizerParams(),this._globalSymbolizerParams=
null),t=this.subview.container.children.map(function(){var R=u._asyncToGenerator(function*(O){return F.subview.updateTileSymbolizerParameters(O,{local:F._symbolizerParams,global:F._globalSymbolizerParams})});return function(O){return R.apply(this,arguments)}}()),yield w.eachAlways(t),this.container.requestRender())});return function(t){return c.apply(this,arguments)}}();E._updateGlobalSymbolizerParams=function(){var c=u._asyncToGenerator(function*(t){(t=yield this.layer.fetchPixels(this.view.extent,
this.view.width,this.view.height,{srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:t}))&&t.pixelBlock&&(t=this.layer.symbolizer.generateWebGLParameters({pixelBlock:x.extractBands(t.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds}),!this.subview.canUseWebGLForProcessing()&&t&&"stretch"===t.type&&this.layer.renderer&&
"raster-stretch"===this.layer.renderer.type&&(t.factor=t.factor.map(F=>255*F),t.outMin=Math.round(255*t.outMin),t.outMax=Math.round(255*t.outMax)),this._globalSymbolizerParams=t)});return function(t){return c.apply(this,arguments)}}();E._updateSymbolizerParams=function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})};
E._updateBlockCacheRegistry=function(c=!1){const {url:t,rasterInfo:F,multidimensionalDefinition:R,raster:O}=this.layer;var S=null!=F&&F.multidimensionalInfo?O.getSliceIndex(R):null;S=d.getRasterId(t,S);S!==this._blockCacheRegistryUrl&&(null!=this._blockCacheRegistryUrl&&d.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=d.register(S,this.layer.raster.rasterInfo),c&&(c=this._tileInfoView.getClosestInfoForScale(this.view.scale),d.update(S,this._blockCacheRegistryId,
this.view.extent,this.view.resolution,this._srcResolutions[c.level],this.layer.raster.ioConfig.sampling)),this._blockCacheRegistryUrl=S)};E._canUseMajorityInterpolationOnDataSource=function(){const {bandCount:c,attributeTable:t,colormap:F,pixelType:R}=this.layer.rasterInfo;return 1===c&&(null!=t||null!=F||"u8"===R||"s8"===R)};u._createClass(I,[{key:"useWebGLForProcessing",get:function(){var c;return null!=(c=this._get("useWebGLForProcessing"))?c:!0},set:function(c){this.subview&&(this.subview.useWebGLForProcessing=
c);this._set("useWebGLForProcessing",c)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")?!0:this._get("useProgressiveUpdate")},set:function(c){if(this._tileStrategy&&this.useProgressiveUpdate!==c){var t;this._tileStrategy.destroy();null==(t=this.subview)?void 0:t.container.removeAllChildren();t=this._getCacheSize(c);this._tileStrategy=new f({cachePolicy:"purge",acquireTile:F=>this.acquireTile(F),releaseTile:F=>this.releaseTile(F),cacheSize:t,tileInfoView:this._tileInfoView});
this._set("useProgressiveUpdate",c);this.requestUpdate()}}}]);return I}(a.ImageryTileLayerView(g.RefreshableLayerView(y.LayerView2DMixin(b))));J.__decorate([h.property()],m.prototype,"subview",void 0);J.__decorate([h.property()],m.prototype,"useWebGLForProcessing",null);J.__decorate([h.property()],m.prototype,"useProgressiveUpdate",null);return m=J.__decorate([q.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],m)});