// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/has ./core/accessorSupport/ensureType ./core/Logger ./core/accessorSupport/decorators/subclass".split(" "),function(h,p,f,l,q,k,t,n){var g;f=g=function(w){function u(){var r=w.apply(this,arguments)||this;r.isAggregate=!0;return r}h._inheritsLoose(u,w);var m=u.prototype;m.getEffectivePopupTemplate=function(r){return this.popupTemplate?
this.popupTemplate:(r=this.sourceLayer&&this.sourceLayer.featureReduction)&&"popupTemplate"in r&&r.popupEnabled?r.popupTemplate:null};m.getObjectId=function(){return this.objectId};m.clone=function(){return new g({objectId:this.objectId,...this.cloneProperties()})};return u}(f);p.__decorate([l.property({type:Boolean})],f.prototype,"isAggregate",void 0);p.__decorate([l.property({type:Number,json:{read:!0}})],f.prototype,"objectId",void 0);return f=g=p.__decorate([n.subclass("esri.AggregateGraphic")],
f)})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(h){function p(q,k){return k?"xoffset"in k&&k.xoffset?Math.max(q,Math.abs(k.xoffset)):"yoffset"in k&&k.yoffset?Math.max(q,Math.abs(k.yoffset||0)):q:q}function f(q,k){if("number"===typeof q)return q;if(q&&q.stops&&q.stops.length){{q=q.stops;let t=k=0;for(let n=0;n<q.length;n++){const g=q[n].size;"number"===typeof g&&(k+=g,t++)}q=k/t}return q}return k}function l(q,k){if(!k)return q;k=k.filter(g=>"size"===g.type).map(g=>
{const {maxSize:w,minSize:u}=g;return(f(w,q)+f(u,q))/2});let t=0;const n=k.length;if(0===n)return q;for(let g=0;g<n;g++)t+=k[g];return Math.max(Math.floor(t/n),q)}h.calculateTolerance=function(q){const k=q&&q.renderer;q="touch"===(q&&q.event&&q.event.pointerType)?9:6;if(!k)return q;q="visualVariables"in k?l(q,k.visualVariables):q;if("simple"===k.type)return p(q,k.symbol);if("unique-value"===k.type){let t=q;k.uniqueValueInfos.forEach(n=>{t=p(t,n.symbol)});return t}if("class-breaks"===k.type){let t=
q;k.classBreakInfos.forEach(n=>{t=p(t,n.symbol)});return t}return q};Object.defineProperty(h,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(h,p,f,l,q,k,t,n,g,w,u,m,r,d,e,y){const B=l.ofType({key:"type",base:r,typeMap:{rect:d,path:y,geometry:e}});h.LayerView2DMixin=C=>{C=function(E){function H(){var G=E.apply(this,arguments)||this;G.clips=new B;G.moving=!1;G.attached=!1;G.lastUpdateId=-1;G.updateRequested=!1;return G}p._inheritsLoose(H,E);var J=H.prototype;J.initialize=function(){var G;this.container||(this.container=new m.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=this.clips;
this.handles.add([k.init(this,"suspended",I=>{this.container&&(this.container.visible=!I);this.view&&!I&&this.updateRequested&&this.view.requestUpdate()},!0),k.init(this,["layer.opacity","container"],()=>{if(this.container){var I,L;this.container.opacity=null!=(I=null==(L=this.layer)?void 0:L.opacity)?I:1}},!0),k.init(this,["layer.blendMode"],I=>{this.container&&(this.container.blendMode=I)},!0),k.init(this,["layer.effect"],I=>{this.container&&(this.container.effect=I)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(G=this.view)&&G.whenLayerView?this.view.whenLayerView(this.layer).then(I=>{I!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};J.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};J.isVisibleAtScale=
function(G){var I=!0,L=this.layer;const M=L.minScale;L=L.maxScale;if(null!=M&&null!=L){I=!M;let z=!L;!I&&G<=M&&(I=!0);!z&&G>=L&&(z=!0);I=I&&z}return I};J.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};J.processUpdate=function(G){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",G),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(G)))};J.isUpdating=
function(){return!1};J.isRendering=function(){return!1};J.canResume=function(){return E.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};p._createClass(H,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return H}(C);f.__decorate([t.property({type:B,set(E){E=q.referenceSetter(E,this._get("clips"),B);this._set("clips",E)}})],C.prototype,"clips",void 0);f.__decorate([t.property()],C.prototype,"moving",void 0);
f.__decorate([t.property()],C.prototype,"attached",void 0);f.__decorate([t.property()],C.prototype,"container",void 0);f.__decorate([t.property()],C.prototype,"suspended",void 0);f.__decorate([t.property({readOnly:!0})],C.prototype,"updateParameters",void 0);f.__decorate([t.property()],C.prototype,"updateRequested",void 0);f.__decorate([t.property()],C.prototype,"updating",null);f.__decorate([t.property()],C.prototype,"view",void 0);return C=f.__decorate([u.subclass("esri.views.2d.layers.LayerView2D")],
C)};Object.defineProperty(h,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),function(h,p,f,l,q,k,t,n){f=function(g){function w(){return g.apply(this,arguments)||this}h._inheritsLoose(w,
g);return w}(f.JSONSupport);return f=p.__decorate([n.subclass("esri.views.layers.support.ClipArea")],f)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(h,p,f,l,q,k,t,n){var g;l=g=function(w){function u(){var m=
w.apply(this,arguments)||this;m.type="rect";m.left=null;m.right=null;m.top=null;m.bottom=null;return m}h._inheritsLoose(u,w);u.prototype.clone=function(){return new g({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};h._createClass(u,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return u}(n);p.__decorate([f.property({type:[Number,String],json:{write:!0}})],l.prototype,"left",void 0);p.__decorate([f.property({type:[Number,String],json:{write:!0}})],l.prototype,
"right",void 0);p.__decorate([f.property({type:[Number,String],json:{write:!0}})],l.prototype,"top",void 0);p.__decorate([f.property({type:[Number,String],json:{write:!0}})],l.prototype,"bottom",void 0);p.__decorate([f.property({readOnly:!0})],l.prototype,"version",null);return l=g=p.__decorate([t.subclass("esri.views.layers.support.ClipRect")],l)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(h,p,f,l,q,k,t,n,g,w,u,m,r){var d;f={base:g,key:"type",typeMap:{extent:m,polygon:r}};u=d=function(e){function y(){var B=e.apply(this,arguments)||this;B.type="geometry";B.geometry=null;return B}h._inheritsLoose(y,e);y.prototype.clone=function(){return new d({geometry:this.geometry.clone()})};h._createClass(y,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return y}(u);p.__decorate([l.property({types:f,json:{read:w.fromJSON,write:!0}})],u.prototype,"geometry",void 0);p.__decorate([l.property({readOnly:!0})],
u.prototype,"version",null);return u=d=p.__decorate([n.subclass("esri.views.layers.support.Geometry")],u)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(h,p,f,l,q,k,t,n){l=function(g){function w(){var u=g.apply(this,
arguments)||this;u.type="path";u.path=[];return u}h._inheritsLoose(w,g);h._createClass(w,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return w}(n);p.__decorate([f.property({type:[[[Number]]],json:{write:!0}})],l.prototype,"path",void 0);p.__decorate([f.property({readOnly:!0})],l.prototype,"version",null);return l=p.__decorate([t.subclass("esri.views.layers.support.Path")],l)})},"esri/views/2d/layers/features/tileRenderers":function(){define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers"],
function(h,p,f){function l(){l=f._asyncToGenerator(function*(q,k){if(!q)return null;switch(q.type){case "class-breaks":case "simple":case "unique-value":case "dot-density":case "dictionary":return new (yield new Promise(function(t,n){h(["./tileRenderers/SymbolTileRenderer"],function(g){t(Object.freeze({__proto__:null,default:g}))},n)})).default(k);case "heatmap":return new (yield new Promise(function(t,n){h(["./tileRenderers/HeatmapTileRenderer"],function(g){t(Object.freeze({__proto__:null,default:g}))},
n)})).default(k)}});return l.apply(this,arguments)}p.createOrReuseTileRenderer=function(q,k){return l.apply(this,arguments)};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),
function(h,p,f,l,q,k,t,n,g){function w(d){return d.some(e=>e.globalId)}function u(d){return d.filter(e=>!e.error).map(e=>{var y;return null!=(y=e.objectId)?y:e.globalId})}function m(d,e){d=new Set(d);for(const y of e.values())d.add(y);return d}function r(d,e){d=new Set(d);for(const y of e.values())d.delete(y);return d}f=function(d){function e(B){var C=d.call(this)||this;C._hasGlobalIds=!1;C._queueProcessor=new g.QueueProcessor({concurrency:1,process:B.process});return C}h._inheritsLoose(e,d);var y=
e.prototype;y.destroy=function(){this._queueProcessor.clear()};y.push=function(B){const C=this._queueProcessor;var E=C.last();switch(B.type){case "update":case "refresh":if((null==E?void 0:E.type)===B.type)return;C.push(B).finally(()=>this.notifyChange("updating"));break;case "edit":(E="processed-edit"===(null==E?void 0:E.type)?E:null)&&C.popLast();B=this._mergeEdits(E,B);for(const H of B)C.push(H).finally(()=>this.notifyChange("updating"))}this.notifyChange("updating")};y._mergeEdits=function(B,
C){var E,H;const {addedFeatures:J,deletedFeatures:G,updatedFeatures:I}=C.edits;if(this._hasGlobalIds=this._hasGlobalIds||w(J)||w(I)||w(G))return C=[...J,...I],[B,{type:"processed-edit",edits:{addOrModified:C,removed:G}}];C=new Set(u(null!=(E=null==B?void 0:B.edits.addOrModified)?E:[]));B=new Set(u(null!=(H=null==B?void 0:B.edits.removed)?H:[]));H=new Set([...u(J),...u(I)]);E=new Set(u(G));C=Array.from(m(r(C,E),H)).map(L=>({objectId:L}));B=Array.from(m(r(B,H),E)).map(L=>({objectId:L}));return[{type:"processed-edit",
edits:{addOrModified:C,removed:B}}]};h._createClass(e,[{key:"updating",get:function(){return 0<this._queueProcessor.length}}]);return e}(f);p.__decorate([l.property({readOnly:!0})],f.prototype,"updating",null);return f=p.__decorate([n.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],f)})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/workers/workers ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(h,p,f,l,q,k,t,n,g,w){f=function(u){function m(d){d=u.call(this,d)||this;d._startupResolver=l.createResolver();d.isReady=!1;return d}h._inheritsLoose(m,u);var r=m.prototype;r.initialize=function(){this._controller=l.createAbortController();this.addResolvingPromise(this._startWorker(this._controller.signal))};r.destroy=function(){this._controller.abort();this._connection&&this._connection.close()};r.startup=function(){var d=h._asyncToGenerator(function*(e,y,B,C){yield this.when();var E=this._controller.signal;
E=Array.isArray(B.source)?{transferList:B.source,signal:E}:void 0;e=e.tileInfo.toJSON();yield this._connection.invoke("startup",{service:B,config:y,tileInfo:e,tiles:C},E);this._startupResolver.resolve();this._set("isReady",!0)});return function(e,y,B,C){return d.apply(this,arguments)}}();r.updateTiles=function(){var d=h._asyncToGenerator(function*(e){yield this._startupResolver.promise;return l.ignoreAbortErrors(this._connection.invoke("updateTiles",e))});return function(e){return d.apply(this,arguments)}}();
r.update=function(){var d=h._asyncToGenerator(function*(e){e={config:e};yield this._startupResolver.promise;return this._connection.invoke("update",e)});return function(e){return d.apply(this,arguments)}}();r.applyUpdate=function(){var d=h._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("applyUpdate",e)});return function(e){return d.apply(this,arguments)}}();r.setHighlight=function(){var d=h._asyncToGenerator(function*(e){yield this._startupResolver.promise;
return l.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",e))});return function(e){return d.apply(this,arguments)}}();r.refresh=function(){var d=h._asyncToGenerator(function*(){yield this._startupResolver.promise;return l.ignoreAbortErrors(this._connection.invoke("controller.refresh"))});return function(){return d.apply(this,arguments)}}();r.querySummaryStatistics=function(){var d=h._asyncToGenerator(function*(e,y,B){yield this._startupResolver.promise;return this._connection.invoke("controller.querySummaryStatistics",
{query:e.toJSON(),params:y},B)});return function(e,y,B){return d.apply(this,arguments)}}();r.queryFeatures=function(){var d=h._asyncToGenerator(function*(e,y){yield this._startupResolver.promise;return this._connection.invoke("controller.queryFeatures",e.toJSON(),y)});return function(e,y){return d.apply(this,arguments)}}();r.queryObjectIds=function(){var d=h._asyncToGenerator(function*(e,y){yield this._startupResolver.promise;return this._connection.invoke("controller.queryObjectIds",e.toJSON(),y)});
return function(e,y){return d.apply(this,arguments)}}();r.queryFeatureCount=function(){var d=h._asyncToGenerator(function*(e,y){yield this._startupResolver.promise;return this._connection.invoke("controller.queryFeatureCount",e.toJSON(),y)});return function(e,y){return d.apply(this,arguments)}}();r.queryExtent=function(){var d=h._asyncToGenerator(function*(e,y){return this._connection.invoke("controller.queryExtent",e.toJSON(),y)});return function(e,y){return d.apply(this,arguments)}}();r.queryLatestObservations=
function(){var d=h._asyncToGenerator(function*(e,y){yield this._startupResolver.promise;return this._connection.invoke("controller.queryLatestObservations",e.toJSON(),y)});return function(e,y){return d.apply(this,arguments)}}();r.queryStatistics=function(){var d=h._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.queryStatistics",e)});return function(e){return d.apply(this,arguments)}}();r.getObjectId=function(){var d=h._asyncToGenerator(function*(e){yield this._startupResolver.promise;
return this._connection.invoke("controller.getObjectId",e)});return function(e){return d.apply(this,arguments)}}();r.getDisplayId=function(){var d=h._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.getDisplayId",e)});return function(e){return d.apply(this,arguments)}}();r.getFeature=function(){var d=h._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.getFeature",e)});return function(e){return d.apply(this,
arguments)}}();r.getAggregate=function(){var d=h._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.getAggregate",e)});return function(e){return d.apply(this,arguments)}}();r.getAggregates=function(){var d=h._asyncToGenerator(function*(){yield this._startupResolver.promise;return this._connection.invoke("controller.getAggregates")});return function(){return d.apply(this,arguments)}}();r.getAggregateValueRanges=function(){var d=h._asyncToGenerator(function*(){yield this._startupResolver.promise;
return this._connection.invoke("controller.getAggregateValueRanges")});return function(){return d.apply(this,arguments)}}();r.mapValidDisplayIds=function(){var d=h._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.mapValidDisplayIds",e)});return function(e){return d.apply(this,arguments)}}();r.onEdits=function(){var d=h._asyncToGenerator(function*(e){yield this._startupResolver.promise;return l.ignoreAbortErrors(this._connection.invoke("controller.onEdits",
e))});return function(e){return d.apply(this,arguments)}}();r.enableEvent=function(){var d=h._asyncToGenerator(function*(e,y){yield this._startupResolver.promise;return l.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:e,value:y}))});return function(e,y){return d.apply(this,arguments)}}();r._startWorker=function(){var d=h._asyncToGenerator(function*(e){try{this._connection=yield q.open("Pipeline",{client:this.client,strategy:"dedicated",signal:e})}catch(y){l.throwIfNotAbortError(y)}});
return function(e){return d.apply(this,arguments)}}();h._createClass(m,[{key:"tileRenderer",set:function(d){this.client.tileRenderer=d}},{key:"closed",get:function(){return this._connection.closed}}]);return m}(f.EsriPromise);p.__decorate([k.property()],f.prototype,"isReady",void 0);p.__decorate([k.property()],f.prototype,"client",void 0);p.__decorate([k.property()],f.prototype,"tileRenderer",null);return f=p.__decorate([w.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],f)})},"esri/views/2d/tiling/TileManager":function(){define(["exports",
"../../../core/maybe","./TileCoverage","./TileKey"],function(h,p,f,l){let q=function(){function k(n){this._tiles=new Map;this.buffer=0;this.acquireTile=n.acquireTile;this.releaseTile=n.releaseTile;this.tileInfoView=n.tileInfoView;this.buffer=n.buffer}var t=k.prototype;t.destroy=function(){};t.clear=function(){this._tiles.forEach(n=>this._releaseTile(n))};t.tileKeys=function(){const n=[];this._tiles.forEach((g,w)=>n.push(w));return n};t.update=function(n){n=this.tileInfoView.getTileCoverage(n.state,
this.buffer,"closest");const {spans:g,lodInfo:w}=n,{level:u}=w,m=[],r=[],d=new Set,e=new Set;for(const {row:y,colFrom:B,colTo:C}of g)for(let E=B;E<=C;E++){const H=l.getId(u,y,w.normalizeCol(E),w.getWorldForColumn(E)),J=this._getOrAcquireTile(m,H);d.add(H);J.isReady?J.visible=!0:e.add(J.key)}e.forEach(y=>this._addPlaceholders(d,y));this._tiles.forEach(y=>{d.has(y.key.id)||(r.push(y.key.id),this._releaseTile(y))});f.pool.release(n);return{hasMissingTiles:0<e.size,added:m,removed:r}};t._getOrAcquireTile=
function(n,g){if(!this._tiles.has(g)){const w=this.acquireTile(new l(g));n.push(g);this._tiles.set(g,w);w.visible=!1}return this._tiles.get(g)};t._getTile=function(n){return this._tiles.get(n)};t._releaseTile=function(n){this._tiles.delete(n.key.id);this.releaseTile(n)};t._addPlaceholders=function(n,g){const w=this._addPlaceholderChildren(n,g);1E-6>Math.abs(1-w)||this._addPlaceholderParent(n,g)||(this._getTile(g.id).visible=!0)};t._addPlaceholderChildren=function(n,g){let w=0;this._tiles.forEach(u=>
{w+=this._addPlaceholderChild(n,u,g)});return w};t._addPlaceholderChild=function(n,g,w){if(g.key.level<=w.level||!g.hasData||!w.contains(g.key))return 0;g.visible=!0;n.add(g.key.id);return 1/(1<<2*(g.key.level-w.level))};t._addPlaceholderParent=function(n,g){g=g.getParentKey();let w=0,u=null;for(;p.isSome(g);){if(n.has(g.id))return!0;const m=this._getTile(g.id);if(null!=m&&m.isReady)return m.visible=!0,n.add(m.key.id),!0;null!=m&&m.hasData&&m.patchCount>w&&(w=m.patchCount,u=m);g=g.getParentKey()}return u?
(u.visible=!0,n.add(u.key.id),!0):!1};return k}();h.TileManager=q;Object.defineProperty(h,"__esModule",{value:!0})})},"esri/views/layers/FeatureLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/fieldUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/FeatureEffect ./support/FeatureFilter ./support/popupUtils ../support/floorFilterUtils".split(" "),
function(h,p,f,l,q,k,t,n,g,w,u,m,r,d,e,y,B,C,E,H){const J=q.getLogger("esri.views.layers.FeatureLayerView");q=G=>{G=function(I){function L(...z){z=I.call(this,...z)||this;z._updatingRequiredFieldsPromise=null;z.effect=null;z.filter=null;z.timeExtent=null;z.layer=null;z.requiredFields=[];z.view=null;return z}p._inheritsLoose(L,I);var M=L.prototype;M.initialize=function(){n.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter effect layer.timeInfo layer.floorInfo timeExtent".split(" "),
()=>this._handleRequiredFieldsChange(),!0);n.on(this,"view.floors","change",()=>this._handleRequiredFieldsChange());n.on(this,"layer.sublayer","change",()=>this._handleRequiredFieldsChange())};M.highlight=function(z){throw Error("missing implementation");};M.createQuery=function(){var z={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};z=k.isSome(this.filter)?this.filter.createQuery(z):new e(z);if("feature"===this.layer.type){const F=H.getFloorFilterClause(this);k.isSome(F)&&
(z.where=z.where?`(${z.where}) AND (${F})`:F)}k.isSome(this.timeExtent)&&(z.timeExtent=k.isSome(z.timeExtent)?z.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return z};M.queryFeatures=function(z,F){throw Error("missing implementation");};M.queryObjectIds=function(z,F){throw Error("missing implementation");};M.queryFeatureCount=function(z,F){throw Error("missing implementation");};M.queryExtent=function(z,F){throw Error("missing implementation");};M._loadArcadeModules=function(z){if(z.get("expressionInfos.length"))return y.loadArcade()};
M._handleRequiredFieldsChange=function(){const z=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",z);z.then(()=>{this._updatingRequiredFieldsPromise===z&&this._set("_updatingRequiredFieldsPromise",null)})};M._updateRequiredFields=function(){var z=p._asyncToGenerator(function*(){if(this.layer&&this.view){var F="3d"===this.view.type,{layer:A,layer:{fieldsIndex:U,objectIdField:Q}}=this,O="renderer"in A&&A.renderer,R="orderBy"in A&&A.orderBy,V=A.featureReduction,N=new Set;O=yield t.eachAlways([O?
O.collectRequiredFields(N,U):null,d.collectLabelingFields(N,A),F?d.collectElevationFields(N,A):null,k.isSome(this.filter)?d.collectFilterFields(N,A,this.filter):null,this.effect?d.collectFilterFields(N,A,this.effect.filter):null,V?d.collectFeatureReductionFields(N,A,V):null,R?d.collectOrderByInfos(N,A,R):null]);A.timeInfo&&this.timeExtent&&d.collectFields(N,A.fieldsIndex,[A.timeInfo.startField,A.timeInfo.endField]);"feature"===A.type&&A.floorInfo&&d.collectFields(N,A.fieldsIndex,[A.floorInfo.floorField]);
"subtype-group"===A.type&&(d.collectField(N,U,A.subtypeField),R=A.sublayers.map(Z=>{var ea;return Promise.all([null==(ea=Z.renderer)?void 0:ea.collectRequiredFields(N,U),d.collectLabelingFields(N,Z)])}),yield t.eachAlways(R));for(const Z of O)Z.error&&J.error(Z.error);d.collectField(N,U,Q);F&&"displayField"in A&&A.displayField&&d.collectField(N,U,A.displayField);F=Array.from(N).sort();this._set("requiredFields",F)}});return function(){return z.apply(this,arguments)}}();M.validateFetchPopupFeatures=
function(z){if(k.isNone(z))return null;for(const F of z.clientGraphics){const A=F.layer;if("popupEnabled"in A&&!A.popupEnabled)return new l("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:A});if("popupTemplate"in A&&!E.getFetchPopupTemplate(A,z))return new l("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:A})}};M.fetchClientPopupFeatures=function(){var z=p._asyncToGenerator(function*(F){var A=k.isSome(F)?F.clientGraphics:null;if(!A||0===A.length)return Promise.resolve([]);
const U=[],Q=[],O=yield this.createPopupQuery(F);for(const V of A){var {layer:R}=V;if(!("popupEnabled"in R))continue;A=d.unpackFieldNames(this.layer.fieldsIndex,O.outFields);R=E.getFetchPopupTemplate(R,F);if(!k.isSome(R))continue;const N=yield this._loadArcadeModules(R);N&&N.arcadeUtils.hasGeometryOperations(R)||!d.featureHasFields(A,V)?Q.push(V):U.push(V)}if("stream"===this.layer.type||0===Q.length)return Promise.resolve(U);O.objectIds=Q.map(V=>V.attributes[this.layer.objectIdField]);return this.layer.queryFeatures(O).then(V=>
U.concat(V.features)).catch(()=>Q)});return function(F){return z.apply(this,arguments)}}();M.createPopupQuery=function(){var z=p._asyncToGenerator(function*(F){const A=this.layer.createQuery(),U=new Set;var Q=!1,O=k.isSome(F)&&F.clientGraphics?F.clientGraphics.map(R=>R.layer):[this.layer];for(const R of O)if("popupEnabled"in R&&(O=E.getFetchPopupTemplate(R,F),k.isSome(O))){Q=(Q=yield this._loadArcadeModules(O))&&Q.arcadeUtils.hasGeometryOperations(O);Q=!("point"!==this.layer.geometryType&&!Q);O=yield E.getRequiredFields(this.layer,
O);for(const V of O)U.add(V)}A.returnGeometry=Q;A.returnZ=Q;A.returnM=Q;A.outFields=Array.from(U);A.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(F=H.getFloorFilterClause(this),k.isSome(F)&&(A.where=A.where?`(${A.where}) AND (${F})`:F));return A});return function(F){return z.apply(this,arguments)}}();M.canResume=function(){return!I.prototype.canResume.call(this)||k.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};p._createClass(L,[{key:"availableFields",get:function(){const {layer:z,
layer:{fieldsIndex:F},requiredFields:A}=this;return"outFields"in z&&z.outFields?d.fixFields(F,[...d.unpackFieldNames(F,z.outFields),...A]):d.fixFields(F,A)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(z){J.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return L}(G);f.__decorate([g.property()],G.prototype,"_updatingRequiredFieldsPromise",void 0);f.__decorate([g.property({readOnly:!0})],
G.prototype,"availableFields",null);f.__decorate([g.property({type:B})],G.prototype,"effect",void 0);f.__decorate([g.property({type:C})],G.prototype,"filter",void 0);f.__decorate([g.property(r.combinedViewLayerTimeExtentProperty)],G.prototype,"timeExtent",void 0);f.__decorate([g.property()],G.prototype,"layer",void 0);f.__decorate([g.property({type:Number})],G.prototype,"maximumNumberOfFeatures",null);f.__decorate([g.property({readOnly:!0,type:Boolean})],G.prototype,"maximumNumberOfFeaturesExceeded",
null);f.__decorate([g.property({readOnly:!0})],G.prototype,"requiredFields",void 0);f.__decorate([g.property()],G.prototype,"suspended",void 0);f.__decorate([g.property()],G.prototype,"view",void 0);return G=f.__decorate([m.subclass("esri.views.layers.FeatureLayerView")],G)};h.FeatureLayerView=q;h["default"]=q;Object.defineProperty(h,"__esModule",{value:!0})})},"esri/views/layers/support/FeatureEffect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./FeatureFilter".split(" "),
function(h,p,f,l,q,k,t,n,g){var w;f=w=function(u){function m(){var r=u.apply(this,arguments)||this;r.filter=null;r.includedEffect=null;r.excludedEffect=null;r.excludedLabelsVisible=!1;return r}h._inheritsLoose(m,u);m.prototype.clone=function(){return new w({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};return m}(f.JSONSupport);p.__decorate([l.property({type:g,json:{write:!0}})],f.prototype,
"filter",void 0);p.__decorate([l.property({json:{write:!0}})],f.prototype,"includedEffect",void 0);p.__decorate([l.property({json:{write:!0}})],f.prototype,"excludedEffect",void 0);p.__decorate([l.property({type:Boolean,json:{write:!0}})],f.prototype,"excludedLabelsVisible",void 0);return f=w=p.__decorate([n.subclass("esri.views.layers.support.FeatureEffect")],f)})},"esri/views/layers/support/FeatureFilter":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../TimeExtent ../../../core/jsonMap ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ../../../geometry/support/jsonUtils ../../../rest/support/Query".split(" "),
function(h,p,f,l,q,k,t,n,g,w,u,m,r,d,e){var y;g=new q.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});q=new q.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});k=y=function(B){function C(H){H=B.call(this,H)||this;H.where=null;H.geometry=null;H.spatialRelationship="intersects";H.hiddenIds=new Set;H.distance=void 0;H.objectIds=null;H.units=null;H.timeExtent=null;H.enabled=!1;return H}h._inheritsLoose(C,B);var E=C.prototype;E.writeWhere=function(H,J){J.where=H||"1\x3d1"};E.enable=function(){this._set("enabled",!0)};
E.createQuery=function(H={}){const {where:J,geometry:G,spatialRelationship:I,timeExtent:L,objectIds:M,units:z,distance:F}=this;return new e({geometry:t.clone(G),objectIds:t.clone(M),spatialRelationship:I,timeExtent:t.clone(L),where:J,units:z,distance:F,...H})};E.clone=function(){const {where:H,geometry:J,spatialRelationship:G,hiddenIds:I,timeExtent:L,objectIds:M,units:z,distance:F}=this,A=new Set;I.forEach(U=>A.add(U));return new y({geometry:t.clone(J),hiddenIds:A,objectIds:t.clone(M),spatialRelationship:G,
timeExtent:t.clone(L),where:H,units:z,distance:F})};return C}(k.JSONSupport);p.__decorate([n.property({type:String})],k.prototype,"where",void 0);p.__decorate([r.writer("where")],k.prototype,"writeWhere",null);p.__decorate([n.property({types:f.geometryTypes,json:{read:d.fromJSON,write:!0}})],k.prototype,"geometry",void 0);p.__decorate([n.property({type:String,json:{read:{source:"spatialRel",reader:g.read},write:{target:"spatialRel",writer:g.write}}})],k.prototype,"spatialRelationship",void 0);p.__decorate([n.property({json:{write:(B,
C,E)=>C[E]=Array.from(B),read:B=>new Set(B)}})],k.prototype,"hiddenIds",void 0);p.__decorate([n.property({type:Number,json:{write:{overridePolicy(B){return{enabled:0<B}}}}})],k.prototype,"distance",void 0);p.__decorate([n.property({type:[Number],json:{write:!0}})],k.prototype,"objectIds",void 0);p.__decorate([n.property({type:String,json:{read:q.read,write:{writer:q.write,overridePolicy(B){return{enabled:B&&0<this.distance}}}}})],k.prototype,"units",void 0);p.__decorate([n.property({type:l,json:{write:!0}})],
k.prototype,"timeExtent",void 0);p.__decorate([n.property({readOnly:!0})],k.prototype,"enabled",void 0);return k=y=p.__decorate([m.subclass("esri.views.layers.support.FeatureFilter")],k)})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(h,p,f,l){function q(){q=p._asyncToGenerator(function*(k,t=k.popupTemplate){if(!f.isSome(t))return[];const n=yield t.getRequiredFields(k.fieldsIndex);
({lastEditInfoEnabled:t}=t);const {objectIdField:g,typeIdField:w,globalIdField:u,relationships:m}=k;if(n.includes("*"))return["*"];t=t?yield l.getFeatureEditFields(k):[];const r=l.fixFields(k.fieldsIndex,[...n,...t]);w&&r.push(w);r&&g&&k.fieldsIndex.has(g)&&-1===r.indexOf(g)&&r.push(g);r&&u&&k.fieldsIndex.has(u)&&-1===r.indexOf(u)&&r.push(u);m&&m.forEach(d=>{({keyField:d}=d);r&&d&&k.fieldsIndex.has(d)&&-1===r.indexOf(d)&&r.push(d)});return r});return q.apply(this,arguments)}h.getFetchPopupTemplate=
function(k,t){return k.popupTemplate?k.popupTemplate:f.isSome(t)&&t.defaultPopupTemplateEnabled&&f.isSome(k.defaultPopupTemplate)?k.defaultPopupTemplate:null};h.getRequiredFields=function(k){return q.apply(this,arguments)};Object.defineProperty(h,"__esModule",{value:!0})})},"esri/views/support/floorFilterUtils":function(){define(["exports"],function(h){function p(f,l){if(null==f||!f.length)return null;f=f.filter(q=>""!==q).map(q=>`'${q}'`);f.push("''");return`${l} IN (${f.join(",")}) OR ${l} IS NULL`}
h.combineFloorsDefinitionExpression=function(f,l){({definitionExpression:l}=l);return f?l?`(${l}) AND (${f})`:f:l};h.getFloorFilterClause=function(f){var l;const q=f.layer;return"floorInfo"in q&&null!=(l=q.floorInfo)&&l.floorField&&"floors"in f.view?p(f.view.floors,q.floorInfo.floorField):null};h.getLayerFloorFilterClause=function(f,l){var q;return"floorInfo"in l&&null!=(q=l.floorInfo)&&q.floorField?p(f,l.floorInfo.floorField):null};Object.defineProperty(h,"__esModule",{value:!0})})},"esri/views/layers/RefreshableLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(h,p,f,l,q,k,t,n,g,w){n=u=>{u=function(m){function r(){return m.apply(this,arguments)||this}p._inheritsLoose(r,m);r.prototype.initialize=function(){this.handles.add(k.on(this,"layer","refresh",()=>{this.doRefresh().catch(d=>{q.isAbortError(d)||l.getLogger(this.declaredClass).error(d)})}),"RefreshableLayerView")};return r}(u);f.__decorate([t.property()],u.prototype,"layer",void 0);return u=f.__decorate([w.subclass("esri.layers.mixins.RefreshableLayerView")],u)};h.RefreshableLayerView=n;h["default"]=
n;Object.defineProperty(h,"__esModule",{value:!0})})},"esri/views/support/drapedUtils":function(){define("exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils ../../geometry/Extent".split(" "),function(h,p,f,l,q,k){function t(g,w,u,m=new k){let r;if("2d"===u.type)r=w*u.resolution;else if("3d"===u.type){var d=u.overlayPixelSizeInMapUnits(g),e=u.basemapSpatialReference;r=f.isSome(e)&&!e.equals(u.spatialReference)?l.getMetersPerUnitForSR(e)/l.getMetersPerUnitForSR(u.spatialReference):
w*d}w=g.x-r;d=g.y-r;e=g.x+r;g=g.y+r;({spatialReference:u}=u);m.xmin=Math.min(w,e);m.ymin=Math.min(d,g);m.xmax=Math.max(w,e);m.ymax=Math.max(d,g);m.spatialReference=u;return m}const n=new k;h.createQueryGeometry=t;h.intersectsDrapedGeometry=function(g,w,u){g=u.toMap(g);if(f.isNone(g))return!1;const m=q.calculateTolerance();return t(g,m,u,n).intersects(w)};Object.defineProperty(h,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/effects/EffectList ../../../renderers/support/clickToleranceUtils ../../../rest/support/FeatureSet ../../../rest/support/Query ../engine/webgl/definitions ./LayerView2D ./features/schemaUtils ./features/tileRenderers ./features/support/pixelBuffering ./support/clusterUtils ./support/FeatureCommandQueue ./support/FeatureLayerProxy ./support/util ../tiling/TileManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/support/FeatureFilter ../../layers/support/FeatureEffect ../../support/drapedUtils ../../webgl/capabilities ../../../geometry/Extent".split(" "),function(h,
p,f,l,q,k,t,n,g,w,u,m,r,d,e,y,B,C,E,H,J,G,I,L,M,z,F,A,U,Q,O,R,V,N,Z,ea,ma,ka,na){function la(da){return da&&"openPorts"in da}const ba=u.getLogger("esri.views.2d.layers.FeatureLayerView2D");l=function(da){function fa(){var a=da.apply(this,arguments)||this;a._pipelineIsUpdating=!0;a._commandsQueue=new A({process:b=>{switch(b.type){case "processed-edit":return a._doEdit(b);case "refresh":return a._doRefresh();case "update":return a._doUpdate()}}});a._visibilityOverrides=new Set;a._effect=null;a._highlightIds=
new Map;a._lastPixelBuffer=0;a._updateHighlight=r.debounce(h._asyncToGenerator(function*(){return a._proxy.setHighlight(Array.from(a._highlightIds.keys()))}));a._uploadsLocked=!1;a._needsClusterSizeUpdate=!1;a.filter=null;a.effectLists={included:new C["default"],excluded:new C["default"]};return a}h._inheritsLoose(fa,da);var x=fa.prototype;x.destroy=function(){var a,b;m.andThen(this._updateClusterSizeTask,c=>c.remove());null==(a=this._proxy)?void 0:a.destroy();null==(b=this.tileRenderer)?void 0:b.destroy();
this._commandsQueue.destroy()};x.initialize=function(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()]));this.handles.add([this.on("valueRangesChanged",a=>{this._set("_aggregateValueRanges",a.valueRanges)}),d.init(this,"effect",a=>{this.effectLists.included.effect=null==a?void 0:a.includedEffect}),d.init(this,"effect",a=>{this.effectLists.excluded.effect=null==a?void 0:a.excludedEffect})])};x._initProxy=function(){var a=h._asyncToGenerator(function*(){if("isTable"in
this.layer&&this.layer.isTable)throw new n("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});this._proxy&&this._proxy.destroy();const b=this._createClientOptions();this._set("_proxy",new U({client:b}));return this._proxy.when()});return function(){return a.apply(this,arguments)}}();x._initServiceOptions=function(){var a=h._asyncToGenerator(function*(){this._set("_serviceOptions",yield this._createServiceOptions())});return function(){return a.apply(this,
arguments)}}();x.highlight=function(a){let b;a instanceof q?b=[a.getObjectId()]:"number"===typeof a||"string"===typeof a?b=[a]:t.isCollection(a)?b=a.map(c=>c&&c.getAttribute(this.layer.objectIdField)).toArray():Array.isArray(a)&&0<a.length&&(b="number"===typeof a[0]||"string"===typeof a[0]?a:a.map(c=>c&&c.getAttribute(this.layer.objectIdField)));if(!b||!b.length)return{remove:()=>{}};b=b.filter(c=>null!=c);this._addHighlight(b);return{remove:()=>this._removeHighlight(b)}};x.hasHighlight=function(){return!!this._highlightIds.size};
x.hitTest=function(a,b){return this._hitTest(a,b)};x.queryAggregates=function(){var a=h._asyncToGenerator(function*(){return(yield this._proxy.getAggregates()).map(b=>f.fromJSON(b))});return function(){return a.apply(this,arguments)}}();x.queryStatistics=function(){return this._proxy.queryStatistics()};x.querySummaryStatistics=function(){var a=h._asyncToGenerator(function*(b,c,v){const D={...c};if(c.valueExpression){var K;D.viewInfoParams={viewingMode:"map",scale:this.view.scale,spatialReference:null==
(K=this.view.spatialReference)?void 0:K.toJSON()}}return this._proxy.querySummaryStatistics(this._cleanUpQuery(b),D,v)});return function(b,c,v){return a.apply(this,arguments)}}();x.queryFeatures=function(a,b){return this.queryFeaturesJSON(a,b).then(c=>{c=H.fromJSON(c);c.features.forEach(v=>this._setLayersForFeature(v));return c})};x.queryFeaturesJSON=function(a,b){return this._proxy.queryFeatures(this._cleanUpQuery(a),b)};x.queryObjectIds=function(a,b){return this._proxy.queryObjectIds(this._cleanUpQuery(a),
b)};x.queryFeatureCount=function(a,b){return this._proxy.queryFeatureCount(this._cleanUpQuery(a),b)};x.queryExtent=function(a,b){return this._proxy.queryExtent(this._cleanUpQuery(a),b).then(c=>({count:c.count,extent:na.fromJSON(c.extent)}))};x.setVisibility=function(a,b){b?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._update()};x.update=function(a){if(this._tileStrategy&&this.tileRenderer){var {hasMissingTiles:b,added:c,removed:v}=this._tileStrategy.update(a);(c.length||
v.length)&&this._proxy.updateTiles({added:c,removed:v});b&&this.requestUpdate();this.notifyChange("updating")}};x.attach=function(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._tileStrategy=new O.TileManager({acquireTile:a=>this._acquireTile(a),releaseTile:a=>this._releaseTile(a),tileInfoView:this.view.featuresTilingScheme,buffer:0});this.handles.add(d.init(this,"renderingConfigHash",()=>this._update()),"attach");"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",
a=>this._edit(a)),"attach")};x.detach=function(){this.container.removeAllChildren();this.handles.remove("attach");this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null);this._tileRendererHash=null};x.moveStart=function(){this.requestUpdate()};x.viewChange=function(){this.requestUpdate()};x.moveEnd=function(){this.requestUpdate()};x.fetchPopupFeatures=function(){var a=h._asyncToGenerator(function*(b,
c){if(m.isSome(c)&&c.clientGraphics.length){var v=c.clientGraphics[0];if(v instanceof f)return[v];c.clientGraphics=c.clientGraphics.filter(D=>{({layer:D}=D);const K="popupTemplate"in D&&D.popupTemplate,W=this.view.popup.defaultPopupTemplateEnabled;return"popupEnabled"in D&&D.popupEnabled&&(K||W)})}if(v=this.validateFetchPopupFeatures(c))throw v;if(m.isSome(c)&&0===c.clientGraphics.length)return[];v=this.fetchClientPopupFeatures(c);if(!b)return v;b=this._fetchServicePopupFeatures(b,c);return r.eachAlwaysValues([v,
b]).then(k.flatten)});return function(b,c){return a.apply(this,arguments)}}();x._fetchServicePopupFeatures=function(){var a=h._asyncToGenerator(function*(b,c){if("stream"===this.layer.type||"ogc-feature"===this.layer.type)return[];const v=yield this.createPopupQuery(c),{layer:D}=this;var K="renderer"in D&&D.renderer;const W=m.isSome(c)?c.event:null;K=E.calculateTolerance({renderer:K,event:W});v.geometry=this.createFetchPopupFeaturesQueryGeometry(b,K);const S=new Set,{objectIdField:X}=D;if(b=m.isSome(c)?
c.clientGraphics:null)for(const P of b)S.add(P.attributes[X]);return D.queryFeatures(v).then(P=>P.features.filter(T=>!S.has(T.attributes[X])))});return function(b,c){return a.apply(this,arguments)}}();x.createFetchPopupFeaturesQueryGeometry=function(a,b){return ma.createQueryGeometry(a,b,this.view)};x.isUpdating=function(){var a;const b="renderer"in this.layer&&null!=this.layer.renderer,c=this._commandsQueue.updating,v=null!=this._updatingRequiredFieldsPromise,D=!this._proxy||!this._proxy.isReady,
K=this._pipelineIsUpdating,W=null===this.tileRenderer||(null==(a=this.tileRenderer)?void 0:a.updating);a=b&&(c||v||D||K||W);g("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${a}\n  -> hasRenderer ${b}\n  -> hasPendingCommand ${c}\n  -> updatingRequiredFields ${v}\n  -> updatingProxy ${D}\n  -> updatingPipeline ${K}\n  -> updatingTileRenderer ${W}\n`);return a};x._createClientOptions=function(){return{setUpdating:a=>{this._set("_pipelineIsUpdating",a)},emitEvent:a=>{this.emit(a.name,a.event)}}};
x._detectQueryMode=function(){var a=h._asyncToGenerator(function*(b){if("path"in b&&("feature"===this.layer.type||"subtype-group"===this.layer.type)&&"point"===this.layer.geometryType&&this.layer.capabilities.query.supportsPagination&&!this.layer.capabilities.operations.supportsEditing&&g("featurelayer-snapshot-enabled"))try{const c=yield this.layer.queryFeatureCount(),v=g("featurelayer-snapshot-point-min-threshold");if(c<=v)return{mode:"snapshot",featureCount:c};const D=g("featurelayer-snapshot-point-max-threshold"),
K=g("featurelayer-snapshot-point-coverage"),W=this.view.extent,S=this.layer.fullExtent,X=null==S?void 0:S.clone().intersection(W),P=m.isSome(X)?X.width*X.height:0,T=(null==S?NaN:S.width)*(null==S?NaN:S.height);b=0===T?0:P/T;if(c<=D&&b>=K)return{mode:"snapshot",featureCount:c}}catch(c){ba.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:c})}return{mode:"on-demand"}});return function(b){return a.apply(this,arguments)}}();x._createServiceOptions=function(){var a=
h._asyncToGenerator(function*(){var b,c=this.layer;if("stream"===c.type)return null;const {capabilities:v,objectIdField:D}=c,K=c.fields.map(ca=>ca.toJSON()),W=c.fullExtent&&c.fullExtent.toJSON(),S=Q.toJSONGeometryType(c.geometryType),X=c.timeInfo&&c.timeInfo.toJSON()||null,P=c.spatialReference?c.spatialReference.toJSON():null,T="feature"===c.type?c.globalIdField:null;let Y;"ogc-feature"===c.type?Y=c.source.getFeatureDefinition():la(c.source)?Y=yield c.source.openPorts():c.parsedUrl&&(Y=w.clone(c.parsedUrl),
"dynamicDataSource"in c&&c.dynamicDataSource&&(Y.query={layer:JSON.stringify({source:c.dynamicDataSource})}));c="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone;const aa=null!=(b="subtypeField"in this.layer&&this.layer.subtypeField)?b:null,{mode:ia,featureCount:ja}=yield this._detectQueryMode(Y);b=this.layer.objectIdField;if("feature"===this.layer.type&&m.isSome(this.layer.orderBy)&&this.layer.orderBy.length){const ca=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field;
ca&&(b=ca)}return{type:ia,timeReferenceUnknownClient:c,subtypeField:aa,featureCount:ja,globalIdField:T,maxRecordCount:v.query.maxRecordCount,tileMaxRecordCount:v.query.tileMaxRecordCount,capabilities:v,fields:K,fullExtent:W,geometryType:S,objectIdField:D,source:Y,timeInfo:X,spatialReference:P,orderByFields:b}});return function(){return a.apply(this,arguments)}}();x._createMemoryServiceOptions=function(){var a=h._asyncToGenerator(function*(b){b=yield b.openPorts();return{...this._createServiceOptions(),
type:"memory",source:b}});return function(b){return a.apply(this,arguments)}}();x._cleanUpQuery=function(a){a=J.from(a)||this.createQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};x._update=function(){var a=h._asyncToGenerator(function*(){return this._commandsQueue.push({type:"update"})});return function(){return a.apply(this,arguments)}}();x._edit=function(){var a=h._asyncToGenerator(function*(b){if(this._validateEdit(b))return this._commandsQueue.push({type:"edit",
edits:b})});return function(b){return a.apply(this,arguments)}}();x.doRefresh=function(){var a=h._asyncToGenerator(function*(){return this._commandsQueue.push({type:"refresh"})});return function(){return a.apply(this,arguments)}}();x._validateEdit=function(a){const b="globalIdField"in this.layer&&this.layer.globalIdField,c=a.deletedFeatures.some(D=>-1===D.objectId||!D.objectId),v=b&&this.availableFields.includes(b);return c&&!v?(ba.error(new n("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${b} to be included the layer's outFields for updates to be reflected on the map`)),
null):a};x._doUpdate=function(){var a=h._asyncToGenerator(function*(){try{if(!this.destroyed&&this._hasRequiredSupport(this.layer)&&this._tileStrategy){var {effect:b,filter:c}=this;yield this._updateRequiredFields();var {renderer:v}=this._getEffectiveRenderer();this._set("_effectiveRenderer",v);var D=this._createSchemaConfig(),K=Q.toJSONGeometryType(this.layer.geometryType),W=yield z.computePxBuffer(v,K,this.layer.featureReduction),S=this._createConfiguration(D,c,b);this._lastPixelBuffer=0===W?0:
Math.max(W,this._lastPixelBuffer);S.schema.source.pixelBuffer=this._lastPixelBuffer;var X=this._createTileRendererHash(v);if(X!==this._tileRendererHash){yield this._initTileRenderer(v);const P=this._serviceOptions;this.effects.forEach(aa=>m.isSome(aa)&&m.isSome(aa.filter)&&aa.filter.enable());this.tileRenderer.onConfigUpdate(v);const T={added:this._tileStrategy.tileKeys(),removed:[]},Y=this.layer;"stream"!==Y.type&&la(Y.source)&&(P.source=yield Y.source.openPorts());"stream"===Y.type&&(yield this._initServiceOptions());
yield this._proxy.startup(this.view.featuresTilingScheme,S,P,T);this.hasHighlight()&&(yield this._proxy.setHighlight(Array.from(this._highlightIds.keys())));yield this._onceTilesUpdated();this.tileRenderer.onConfigUpdate(v)}else{const P=yield this._proxy.update(S);(P.mesh||P.targets.aggregate)&&this._lockGPUUploads();try{yield this._proxy.applyUpdate(P)}catch(T){r.isAbortError(T)||ba.error(T)}(P.mesh||P.targets.aggregate)&&this._unlockGPUUploads();this.effects.forEach(T=>m.isSome(T)&&m.isSome(T.filter)&&
T.filter.enable());this.tileRenderer.onConfigUpdate(v);this._updateClusterSizeVariable();this._forceAttributeTextureUpload()}this._tileRendererHash=X;this.tileRenderer.invalidateLabels();this.requestUpdate()}}catch(P){}});return function(){return a.apply(this,arguments)}}();x._doEdit=function(){var a=h._asyncToGenerator(function*(b){try{yield this._proxy.onEdits(b)}catch(c){r.isAbortError(c)}});return function(b){return a.apply(this,arguments)}}();x._doRefresh=function(){var a=h._asyncToGenerator(function*(){this._lockGPUUploads();
try{yield this._proxy.refresh()}catch(b){r.isAbortError(b)}this._unlockGPUUploads()});return function(){return a.apply(this,arguments)}}();x._updateClusterSizeVariable=function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)};x._createUpdateClusterSizeTask=function(a,b){var c=this;return this.watch("_aggregateValueRanges",function(){var v=h._asyncToGenerator(function*(D){c._updateClusterEffectiveRendererSizeVariable(a,b,D);
c._needsClusterSizeUpdate=!0;c._uploadsLocked||c._updateClusterSizeVariable()});return function(D){return v.apply(this,arguments)}}())};x._updateClusterEffectiveRendererSizeVariable=function(){var a=h._asyncToGenerator(function*(b,c,v){if(b.dynamicClusterSize&&"visualVariables"in b&&b.visualVariables){var D=F.findSizeVV(b.visualVariables);m.isSome(D)&&"cluster_count"===D.field&&(D=b.visualVariables.indexOf(D),b.visualVariables[D]=F.createClusterCountSizeVariable(c,v),b=b.clone(),b.dynamicClusterSize=
!0,this._set("_effectiveRenderer",b))}});return function(b,c,v){return a.apply(this,arguments)}}();x._getEffectiveRenderer=function(){var a="renderer"in this.layer&&this.layer.renderer;const b=this.layer.featureReduction;m.isSome(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null);if(b&&"cluster"===b.type&&F.isClusterCompatibleRenderer(a)){const c=[];a=F.createClusterRenderer(c,a,b,this._aggregateValueRanges);m.andThen(this._updateClusterSizeTask,
v=>v.remove());this._updateClusterSizeTask=this._createUpdateClusterSizeTask(a,b);return{renderer:a,aggregateFields:c,featureReduction:b}}return{renderer:a,aggregateFields:[],featureReduction:null}};x._acquireTile=function(a){a=this.tileRenderer.acquireTile(a);a.once("attach",()=>{this.requestUpdate()});return a};x._releaseTile=function(a){this.tileRenderer.releaseTile(a)};x._initTileRenderer=function(){var a=h._asyncToGenerator(function*(b){const c=yield M.createOrReuseTileRenderer(b,{layerView:this,
tileInfoView:this.view.featuresTilingScheme,layer:this.layer});this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null);if(this.destroyed)return null;this._proxy.tileRenderer=c;this._set("tileRenderer",c);this.tileRenderer.install(this.container);this.tileRenderer.onConfigUpdate(b);this.requestUpdate();return this.tileRenderer});return function(b){return a.apply(this,arguments)}}();x._createTileRendererHash=function(a){return`${"heatmap"===
a.type?"heatmap":"symbol"}.${"dot-density"===a.type}`};x._createFeatureDataHash=function(a,b,c){a=a.getAttributeHash();b=JSON.stringify(b);c=m.isSome(c)&&JSON.stringify(c.filter);const v=JSON.stringify(this.timeExtent);let D="";this._visibilityOverrides.forEach(K=>D+=K);return`${a}.${b}.${c}.${v}.${D}`};x._injectOverrides=function(a){var b=m.isSome(a)?a.timeExtent:null;b=m.isSome(this.timeExtent)&&m.isSome(b)?this.timeExtent.intersection(b):this.timeExtent||b;var c=null;const v="floorInfo"in this.layer&&
this.layer.floorInfo;v&&(c=m.isSome(a)&&a.where,c=this._addFloorFilterClause(c));if(!this._visibilityOverrides.size&&!b&&!v)return a;a=m.isSome(a)&&a.clone()||new Z;a.hiddenIds=this._visibilityOverrides;a.timeExtent=b;c&&(a.where=c);return a};x._addFloorFilterClause=function(a){var b=this.layer;a=a||"";if("floorInfo"in b&&b.floorInfo){var c,v=this.view.floors;if(!v||!v.length)return a;null!=(c=b.floorInfo.viewAllLevelIds)&&c.length&&(v=b.floorInfo.viewAllLevelIds);c=v.filter(D=>""!==D).map(D=>"'"+
D+"'");c.push("''");b=b.floorInfo.floorField;v="("+b+" IN ({ids}) OR "+b+" IS NULL)";v=v.replace("{ids}",c.join(", "));m.isSome(a)&&a.includes(b)&&(c=new RegExp("AND \\("+b+".*NULL\\)","g"),a=a.replace(c,""),c=new RegExp("\\("+b+".*NULL\\)","g"),a=a.replace(c,""),a=a.replace(/\s+/g," ").trim());a=""!==a?"("+a+") AND "+v:v}return""!==a?a:null};x._createConfiguration=function(a,b,c){const v="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,D="feature"===
this.layer.type?this.layer.gdbVersion:void 0,K=Array(G.MAX_FILTERS);b=this._injectOverrides(b);K[0]=m.isSome(b)?b.toJSON():null;K[1]=m.isSome(c)&&c.filter?c.filter.toJSON():null;a=L.createSchema(a);if(m.isNone(a))return null;c=ka();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:D,historicMoment:v,devicePixelRatio:window.devicePixelRatio||1,filters:K,schema:a,supportsTextureFloat:c.supportsTextureFloat,maxTextureSize:c.maxTextureSize}};x._hasRequiredSupport=
function(a){var b;return"renderer"in a&&"dot-density"===(null==(b=a.renderer)?void 0:b.type)&&!ka().supportsTextureFloat?(ba.error(new n("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1):!0};x._onceTilesUpdated=function(){this.requestUpdate();return d.whenFalseOnce(this,"_pipelineIsUpdating",!1)};x._lockGPUUploads=function(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())};x._unlockGPUUploads=function(){this.tileRenderer&&
(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())};x._forceAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()};x._createSchemaConfig=function(){return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,
historicMoment:"feature"===this.layer.type?this.layer.historicMoment:null,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,effect:this.effect,filter:this.filter,gdbVersion:"feature"===this.layer.type?this.layer.gdbVersion:null,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:{..."customParameters"in this.layer?this.layer.customParameters:
void 0,token:"apiKey"in this.layer?this.layer.apiKey:void 0}}};x._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?(a=this._highlightIds.get(b),this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight().catch(b=>{r.isAbortError(b)||ba.error(b)})};x._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight().catch(b=>{r.isAbortError(b)||
ba.error(b)})};x._setLayersForFeature=function(a){const b=this.layer;a.layer=b;a.sourceLayer=b};x._createHittestResult=function(a){this._setLayersForFeature(a);m.isSome(a.geometry)&&(a.geometry.spatialReference=this.view.spatialReference);return a};x._hitTest=function(){var a=h._asyncToGenerator(function*(b,c){if(this.suspended||!this.tileRenderer)return null;b=yield this.tileRenderer.hitTest(b,c);if(0===b.length)return yield r.after(1),null;b=b[0];if(1!==(b&2147483648)>>>31)return b=yield this._proxy.getFeature(b),
m.andThen(b,v=>this._createHittestResult(q.fromJSON(v)));b=yield this._proxy.getAggregate(b);return m.isNone(b)?null:m.isSome(b.referenceId)?(b=yield this._proxy.getFeature(b.referenceId),m.andThen(b,v=>this._createHittestResult(q.fromJSON(v)))):this._createHittestResult(f.fromJSON(b))});return function(b,c){return a.apply(this,arguments)}}();h._createClass(fa,[{key:"orderByFields",get:function(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}},{key:"labelsVisible",
get:function(){const a="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&a.some(b=>b.labelingInfo&&b.labelsVisible)}},{key:"effect",get:function(){return m.unwrapOr(this._effect,null)},set:function(a){const b=this._effect;m.isSome(b)&&m.isSome(b.filter)&&b.filter.enabled&&m.isSome(a)&&m.isSome(a.filter)&&a.filter.enable();this._effect=a;this.notifyChange("effect")}},{key:"effects",get:function(){return this.effect&&[this.effect]||[]}},{key:"queryMode",
get:function(){return this._serviceOptions.type}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;const a=this.availableFields;var b=this.layer;const c=this.view.floors,{definitionExpression:v}=b,D="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,K="renderer"in b&&b.renderer,W="feature"===b.type?b.gdbVersion:void 0,S="feature"===b.type&&b.historicMoment?b.historicMoment.getTime():void 0,{timeExtent:X}=this,P="customParameters"in b?JSON.stringify(b.customParameters):
void 0,T="apiKey"in b?b.apiKey:void 0,Y="stream"===b.type?`${JSON.stringify(b.geometryDefinition)}${b.definitionExpression}`:null,aa=JSON.stringify(this.clips);b=b.featureReduction&&b.featureReduction.toJSON();const ia="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),ja="sublayers"in this.layer&&this.layer.sublayers.items.reduce((ca,ha)=>ca+`${ha.visible?1:0}.${JSON.stringify(ha.renderer)}.${ha.labelsVisible}\n.${JSON.stringify(ha.labelingInfo)}`,"");return JSON.stringify({orderBy:ia,sublayerHash:ja,
filterHash:m.isSome(this.filter)&&this.filter.toJSON(),effectHash:m.isSome(this.effect)&&this.effect.toJSON(),streamFilter:Y,gdbVersion:W,definitionExpression:v,historicMoment:S,availableFields:a,renderer:K,labelingInfo:D,timeExtent:X,floors:c,clipsHash:aa,featureReduction:b,customParameters:P,apiKey:T})}},{key:"hasEffects",get:function(){return this.effectLists.included.hasEffects||this.effectLists.excluded.hasEffects}},{key:"hasFilter",get:function(){const a=!!("floorInfo"in this.layer&&this.layer.floorInfo&&
this.view.floors&&this.view.floors.length);return!!this.filter||a||!!this._visibilityOverrides.size||!!this.timeExtent}}]);return fa}(R.FeatureLayerView(N.RefreshableLayerView(I.LayerView2DMixin(V))));p.__decorate([e.property()],l.prototype,"_serviceOptions",void 0);p.__decorate([e.property()],l.prototype,"_proxy",void 0);p.__decorate([e.property()],l.prototype,"_pipelineIsUpdating",void 0);p.__decorate([e.property()],l.prototype,"_effectiveRenderer",void 0);p.__decorate([e.property()],l.prototype,
"_aggregateValueRanges",void 0);p.__decorate([e.property()],l.prototype,"_commandsQueue",void 0);p.__decorate([e.property()],l.prototype,"labelsVisible",null);p.__decorate([e.property({type:Z})],l.prototype,"filter",void 0);p.__decorate([e.property({type:ea})],l.prototype,"effect",null);p.__decorate([e.property({readOnly:!0})],l.prototype,"effects",null);p.__decorate([e.property({readOnly:!0})],l.prototype,"queryMode",null);p.__decorate([e.property()],l.prototype,"renderingConfigHash",null);p.__decorate([e.property()],
l.prototype,"tileRenderer",void 0);p.__decorate([e.property()],l.prototype,"updating",void 0);return l=p.__decorate([B.subclass("esri.views.2d.layers.FeatureLayerView2D")],l)});