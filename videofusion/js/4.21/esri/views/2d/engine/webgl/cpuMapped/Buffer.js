// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../webgl/BufferObject ../../../../webgl/FramebufferObject ../../../../../core/has ../../../../webgl/checkWebGLError ../../../../webgl/enums ../../../../../chunks/builtins ../../../../webgl/renderState ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ./FreeList".split(" "),function(l,p,f,m,n,r,t,u,v,w,x,y,q){n=function(){function k(a,c,b){c=new Uint32Array(c*b);this.strideInt=b;this.bufferType=
a;this.dirty={start:Infinity,end:0};this.gpu=null;this._cpu=c;this.clear()}var d=k.prototype;d.destroy=function(){f.andThen(this.gpu,a=>a.dispose())};d.clear=function(){this.dirty.start=Infinity;this.dirty.end=0;this.freeList=new q.FreeList({start:0,end:this._cpu.length/this.strideInt});this.fillPointer=0};d.ensure=function(a){if(!(this.maxAvailableSpace()>=a)&&(a*=this.strideInt,a>this._cpu.length-this.fillPointer)){f.isSome(this.gpu)&&(this.gpu=null);a=Math.round(1.5*(this._cpu.length+a));const c=
new Uint32Array(a),b=this._cpu.length/this.strideInt;this.freeList.free(b,a/this.strideInt-b);c.set(this._cpu);this._cpu=c}};d.set=function(a,c){this._cpu[a]!==c&&(this._cpu[a]=c,this.dirty.start=Math.min(a,this.dirty.start),this.dirty.end=Math.max(a,this.dirty.end))};d.getBuffer=function(){this._cpu2&&this._cpu2.length===this._cpu.length||(this._cpu2=this._cpu.slice());this._cpu2.set(this._cpu);return this._cpu2};d.maxAvailableSpace=function(){return this.freeList.maxAvailableSpace()};d.insert=function(a,
c,b,g){const e=b*this.strideInt;a=new Uint32Array(a,c*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,e);b=f.unwrapOrThrow(this.freeList.firstFit(b),"First fit region must be defined")*this.strideInt;c=b/this.strideInt-c;if(0!==g)for(let h=0;h<a.length;h++)a[h]+=g;this._cpu.set(a,b);this.dirty.start=Math.min(this.dirty.start,b);this.dirty.end=Math.max(this.dirty.end,b+e);this.fillPointer=Math.max(this.fillPointer,b+e);return c};d.free=function(a,c,b){const g=a*this.strideInt,e=(a+c)*this.strideInt;if(!0===
b)for(b=a;b!==a+c;b++)this._cpu[b*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,g);this.dirty.end=Math.max(this.dirty.end,e);this.freeList.free(a,c)};d.upload=function(a){this.dirty.end&&(f.isNone(this.gpu)?this.gpu=this._createBuffer(a):this.gpu.setSubData(this._cpu,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=Infinity,this.dirty.end=0)};d._createBuffer=function(a){return"index"===this.bufferType?m.createIndex(a,35048,this._cpu):m.createVertex(a,35048,
this._cpu)};p._createClass(k,[{key:"elementSize",get:function(){return this._cpu.length/this.strideInt}},{key:"bufferSize",get:function(){return this._cpu.length/this.strideInt}}]);return k}();l.Buffer=n;Object.defineProperty(l,"__esModule",{value:!0})});