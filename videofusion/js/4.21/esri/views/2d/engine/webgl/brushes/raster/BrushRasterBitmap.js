// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../RasterBitmap","../../VertexStream","../WGLBrush","../../../../../webgl/rasterUtils"],function(p,q,r,t,d){return function(n){function l(){var a=n.apply(this,arguments)||this;a._desc={lut:{vsPath:"raster/lut",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])},stretch:{vsPath:"raster/stretch",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])},hillshade:{vsPath:"raster/hillshade",
fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])}};a._rendererUniformInfos=new Map;return a}p._inheritsLoose(l,n);var g=l.prototype;g.dispose=function(){this._quad&&this._quad.dispose()};g.prepareState=function({context:a},c){a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,c.stencilRef,255)};g.draw=function(a,c){var b;if(q.hasSource(c)&&!c.suspended){a.timeline.begin(this.name);
var e=!(null!=(b=a.context.capabilities.textureFloat)&&b.textureFloatLinear);c.updateTexture(a);b=this.getShaderVariations(c,e);b=a.painter.materialManager.getProgram(a,this._desc[c.symbolizerParameters.type],b);this.drawWithProgram(a.context,b,c);a.timeline.end(this.name)}};g.drawWithProgram=function(a,c,b,e=1,m=[0,0],h=!1){this._quad||(this._quad=new r(a,[0,0,1,0,0,1,1,1]));const {symbolizerParameters:f,transformGrid:u,width:v,height:w,opacity:x}=b;var k=f.type;a.useProgram(c);const y=this.getShaderVariations(b);
k=this.getUniformInfos(k,a,c,y);const {names:z,textures:A}=b.getTextures();d.setTextures(a,c,z,A);a=d.getBasicGridUniforms(e,m);h=d.getCommonUniforms(u,[v,w],[b.source.width,b.source.height],x,h);d.setUniforms(c,k,{u_coordScale:b.coordScale,u_dvsMat3:b.transforms.dvs,...a,...h});if(f.colormap){const {colormap:B,colormapOffset:C}=f;b=d.getColormapUniforms(B,C);d.setUniforms(c,k,b)}"stretch"===f.type?(b=d.getStretchUniforms(f),d.setUniforms(c,k,b)):"hillshade"===f.type&&(b=d.getShadedReliefUniforms(f),
d.setUniforms(c,k,b));this._quad.draw()};g.getUniformInfos=function(a,c,b,e){a=0<e.length?a+"-"+e.join("-"):a;if(this._rendererUniformInfos.has(a))return this._rendererUniformInfos.get(a);c=d.getUniformLocationInfos(c,b);this._rendererUniformInfos.set(a,c);return c};g.getShaderVariations=function(a,c=!1){const b=[],{interpolation:e}=a,{type:m,colormap:h}=a.symbolizerParameters;"cubic"===e?b.push("bicubic"):"bilinear"===e&&"stretch"===m&&null!=h?(b.push("bilinear"),b.push("nnedge")):c&&"bilinear"===
e&&b.push("bilinear");a.isRendereredSource?b.push("noop"):h&&b.push("applyColormap");a.transformGrid&&b.push("applyProjection");return b};return l}(t)});