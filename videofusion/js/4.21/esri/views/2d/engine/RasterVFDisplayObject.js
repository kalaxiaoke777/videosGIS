// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ../../../core/maybe ../../../chunks/mat3f32 ../../../layers/support/rasterFunctions/vectorFieldUtils ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/checkWebGLError ../../webgl/enums ../../../chunks/builtins ../../webgl/renderState ../../webgl/Texture ../../webgl/VertexArrayObject ./DisplayObject ./webgl/Utils".split(" "),function(h,k,l,d,r,e,m,x,y,z,A,B,C,t,u,v){l=function(n){function f(b=null){var a=n.call(this)||
this;a._source=null;a._symbolizerParameters=null;a._vaoInvalidated=!0;a.coordScale=[1,1];a.height=null;a.stencilRef=0;a.rawPixelData=null;a.width=null;a.source=b;return a}k._inheritsLoose(f,n);var c=f.prototype;c.destroy=function(){if(d.isSome(this.vaoData)){var b,a;null==(b=this.vaoData.magdir)?void 0:b.vao.dispose();null==(a=this.vaoData.scalar)?void 0:a.vao.dispose();this.vaoData=null}};c.invalidateVAO=function(){if(!this._vaoInvalidated&&d.isSome(this.vaoData)){var b,a;null==(b=this.vaoData.magdir)?
void 0:b.vao.dispose();null==(a=this.vaoData.scalar)?void 0:a.vao.dispose();this.vaoData=null;this._vaoInvalidated=!0;this.requestRender()}};c.updateVectorFieldVAO=function(b){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(d.isSome(this.source)&&!d.isSome(this.vaoData)){var {style:a}=this.symbolizerParameters;switch(a){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":a=
e.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(b.context,a)};break;case "simple_scalar":a=e.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(b.context,a)};break;case "wind_speed":{a=e.createVFMesh(this.source,this.symbolizerParameters);a=this._createVectorFieldVAO(b.context,a);const g=e.createVFMeshScalar(this.source,this.symbolizerParameters);b=this._createVectorFieldVAO(b.context,g);this.vaoData=
{magdir:a,scalar:b}}}}this.ready();this.requestRender()}};c._createTransforms=function(){return{dvs:r.create()}};c.onAttach=function(){this.invalidateVAO()};c.onDetach=function(){this.invalidateVAO()};c._createVectorFieldVAO=function(b,a){const {vertexData:g,indexData:p}=a;a=m.createVertex(b,35044,new Float32Array(g));const w=m.createIndex(b,35044,new Uint32Array(p)),q=v.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",
count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new t(b,q.attributes,q.bufferLayouts,{geometry:a},w),elementCount:p.length}};k._createClass(f,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(b){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(b)&&(this._symbolizerParameters=b,this.invalidateVAO())}},{key:"source",get:function(){return this._source},set:function(b){this._source=b;this.invalidateVAO()}}]);
return f}(u.DisplayObject);h.RasterVFDisplayObject=l;Object.defineProperty(h,"__esModule",{value:!0})});