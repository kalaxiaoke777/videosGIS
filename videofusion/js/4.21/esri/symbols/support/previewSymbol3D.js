// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../assets ../../core/colorUtils ../../core/has ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),function(z,K,L,M,ea,N,S,x,T,w,A,U,V,u,B,W,O){function y(a){const b=a.outline;var c=x.isSome(a.material)?a.material.color:null;c=x.isSome(c)?c.toHex():null;if(x.isNone(b)||
"none"===b.pattern)return"fill"===a.type&&"#ffffff"===c?{color:"#bdc3c7",width:.75}:null;c=w.pt2px(b.size)||0;return{color:"rgba("+(x.isSome(b.color)?b.color.toRgba():"255,255,255,1")+")",width:Math.min(c,80),style:"pattern"in a?A.dekebabifyLineStyle(b.pattern):null,join:"butt",cap:b.patternCap}}function X(a,b){var c=b&&b.resource;c=c&&c.href;if(a.thumbnail&&a.thumbnail.url)return Promise.resolve(a.thumbnail.url);if(c&&"object"!==b.type)return Promise.resolve(O.getIconHref(a,b));const e=L.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png");
return a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?W.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal},"webRef").catch(n=>n).then(n=>{var v;return(null==n?void 0:null==(v=n.thumbnail)?void 0:v.url)||e}):Promise.resolve(e)}function G(a,b=1){const c=a.a;a=M.toHSV(a);const {r:e,g:n,b:v}=M.toRGB({h:a.h,s:a.s/b,v:100-(100-a.v)/b});return[e,n,v,c]}function C(a){return"water"===a.type?x.isNone(a.color)?null:a.color:x.isNone(a.material)||x.isNone(a.material.color)?null:
a.material.color}function g(a,b=0){var c=C(a);if(!c){if("fill"===a.type)return null;b=u.adjustColorComponentBrightness(A.defaultThematicColor.r,b);return[b,b,b,100]}a=c.toRgba();for(c=0;3>c;c++)a[c]=u.adjustColorComponentBrightness(a[c],b);return a}function P(a,b){return H.apply(this,arguments)}function H(){H=K._asyncToGenerator(function*(a,b){a=a.style;return"none"===a?null:{type:"pattern",x:0,y:0,src:yield A.getPatternUrlWithColor(L.getAssetUrl(`esri/symbols/patterns/${a}.png`),b.toCss(!0)),width:5,
height:5}});return H.apply(this,arguments)}function Q(a){return a.outline?y(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function R(a,b){a=C(a);if(!a)return null;let c;c="rgba("+(u.adjustColorComponentBrightness(a.r,b)+",");c+=u.adjustColorComponentBrightness(a.g,b)+",";c+=u.adjustColorComponentBrightness(a.b,b)+",";return c+a.a+");"}function I(a,b){b=R(a,b);if(!b)return{};if("pattern"in a&&"none"===a.pattern)return null;const c=Math.min(a.size?w.pt2px(a.size):.75,80);return{color:b,width:c,style:"pattern"in
a?A.dekebabifyLineStyle(a.pattern):null,cap:"cap"in a?a.cap:null,join:"join"in a?"miter"===a.join?w.pt2px(2):a.join:null}}function D(a,b,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function Y(a){const b=a.depth,c=a.height;return(a=a.width)&&b&&c&&a===b&&a<c}function Z(a,b,c){const e=[];if(!a)return e;switch(a.type){case "icon":switch(a.resource&&a.resource.primitive||U.defaultPrimitive){case "circle":e.push({shape:{type:"circle",
cx:0,cy:0,r:.5*b},fill:g(a,0),stroke:y(a)});break;case "square":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:y(a)});break;case "triangle":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:y(a)});break;case "cross":e.push({shape:{type:"path",path:[{command:"M",
values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]}]},stroke:Q(a)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]}]},stroke:Q(a)});break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:g(a,
0),stroke:y(a)})}break;case "object":switch(a.resource&&a.resource.primitive||V.defaultPrimitive){case "cone":var n=g(a,0);a=g(a,-.6);a=D(n,a,c?20:b);b=u.getConeShapes(b,c);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:a});break;case "inverted-cone":c=g(a,0);a=g(a,-.6);a=D(c,a,b);b=u.getInvertedConeShapes(b);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:c});break;case "cube":b=u.getCubeShapes(b,c);e.push({shape:b[0],fill:g(a,0)});e.push({shape:b[1],fill:g(a,-.3)});e.push({shape:b[2],fill:g(a,
-.5)});break;case "cylinder":{n=g(a,0);const v=g(a,-.6);n=D(n,v,c?20:b);b=u.getCylinderShapes(b,c);e.push({shape:b[0],fill:n});e.push({shape:b[1],fill:n});e.push({shape:b[2],fill:g(a,0)});break}case "diamond":b=u.getDiamondShapes(b);e.push({shape:b[0],fill:g(a,-.3)});e.push({shape:b[1],fill:g(a,0)});e.push({shape:b[2],fill:g(a,-.3)});e.push({shape:b[3],fill:g(a,-.7)});break;case "sphere":c=g(a,0);a=g(a,-.6);a=D(c,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},
fill:a});break;case "tetrahedron":b=u.getTetrahedronShapes(b),e.push({shape:b[0],fill:g(a,-.3)}),e.push({shape:b[1],fill:g(a,0)}),e.push({shape:b[2],fill:g(a,-.6)})}}return e}function aa(a,b){const c=b&&b.size?w.pt2px(b.size):null,e=b&&b.maxSize?w.pt2px(b.maxSize):null,n=b&&b.disableUpsampling,v=a.symbolLayers,q=[];let p=0,r=0;const d=v.getItemAt(v.length-1);let l;d&&"icon"===d.type&&(l=d.size&&w.pt2px(d.size));v.forEach(f=>{if("icon"===f.type||"object"===f.type){var h="icon"===f.type?f.size&&w.pt2px(f.size):
0,k=c||h?Math.ceil(Math.min(c||h,e||120)):22;if(f&&f.resource&&f.resource.href){var t=X(a,f).then(function(m){const E=f.get("material.color");var F="icon"===f.type?"multiply":"tint";return B.tintImageWithColor(m,k,E,F,n)}).then(function(m){const E=m.width,F=m.height;p=Math.max(p,E);r=Math.max(r,F);return[{shape:{type:"image",x:0,y:0,width:E,height:F,src:m.url},fill:null,stroke:null}]});q.push(t)}else{let m=k;"icon"===f.type&&l&&c&&(m=h/l*k);h="tall"===(null==b?void 0:b.symbolConfig)||(null==b?void 0:
null==(t=b.symbolConfig)?void 0:t.isTall)||("object"===f.type?Y(f):!1);p=Math.max(p,h?20:m);r=Math.max(r,m);q.push(Promise.resolve(Z(f,m,h)))}}});return T.eachAlways(q).then(function(f){const h=[];f.forEach(function(k){k.value?h.push(k.value):k.error&&ba.warn("error while building swatchInfo!",k.error)});return B.renderSymbol(h,[p,r],{node:b&&b.node,scale:!1,opacity:b&&b.opacity})})}function ca(a,b){const c=a.symbolLayers,e=[];a=O.isVolumetricSymbol(a);const n=b&&b.size?w.pt2px(b.size):null,v=(b&&
b.maxSize?w.pt2px(b.maxSize):null)||80;let q=0,p=0,r;c.forEach((d,l)=>{if(d&&("line"===d.type||"path"===d.type)){var f=[];switch(d.type){case "line":var h=I(d,0);if(x.isNone(h))break;var k=h&&h.width||0;0===l&&(r=k);d=Math.min(n||k,v);l=0===l?d:n?k/r*d:d;k=20<l?2*l:40;p=Math.max(p,l);q=Math.max(q,k);h.width=l;f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[q,.5*p]}]},stroke:h});break;case "path":h=Math.min(n||22,v);l=g(d,0);k=g(d,-.2);var t=R(d,-.4);t=t?{color:t,
width:1}:{};if("quad"===d.profile){const m=d.width;d=d.height;d=u.getPathSymbolShapes(m&&d?m/d:1,0===d,0===m);t={...t,join:"bevel"};f.push({shape:d[0],fill:k,stroke:t});f.push({shape:d[1],fill:k,stroke:t});f.push({shape:d[2],fill:l,stroke:t})}else f.push({shape:u.shapes.pathSymbol3DLayer[0],fill:k,stroke:t}),f.push({shape:u.shapes.pathSymbol3DLayer[1],fill:l,stroke:t});q=p=Math.max(p,h)}e.push(f)}});return Promise.resolve(B.renderSymbol(e,[q,p],{node:b&&b.node,scale:a,opacity:b&&b.opacity}))}function da(a,
b){return J.apply(this,arguments)}function J(){J=K._asyncToGenerator(function*(a,b){const c="mesh-3d"===a.type;a=a.symbolLayers;var e=b&&b.size?w.pt2px(b.size):null;const n=b&&b.maxSize?w.pt2px(b.maxSize):null;e=e||22;const v=[];let q=0,p=0;var r=!1;for(let t=0;t<a.length;t++){var d=a.getItemAt(t);const m=[];if(!c||"fill"===d.type){var l=u.shapes.fill[0];switch(d.type){case "fill":var f=y(d);r=Math.min(e,n||120);q=Math.max(q,r);p=Math.max(p,r);r=!0;var h=g(d,0),k="pattern"in d&&d.pattern;d=C(d);!c&&
x.isSome(k)&&"style"===k.type&&"solid"!==k.style&&d&&(h=yield P(k,d));m.push({shape:l,fill:h,stroke:f});break;case "line":d=I(d,0);if(x.isNone(d))break;d={stroke:d,shape:l};q=Math.max(q,22);p=Math.max(p,22);m.push(d);break;case "extrude":l={join:"round",width:1,...I(d,-.4)};f=g(d,0);d=g(d,-.2);h=Math.min(e,n||120);k=u.getExtrudeSymbolShapes(h);l.width=1;m.push({shape:k[0],fill:d,stroke:l});m.push({shape:k[1],fill:d,stroke:l});m.push({shape:k[2],fill:f,stroke:l});d=22*.7+.5*h;q=Math.max(q,22);p=Math.max(p,
d);break;case "water":r=C(d),d=G(r),l=G(r,2),f=G(r,3),h=u.getWaterSymbolShapes(),r=!0,m.push({shape:h[0],fill:d}),m.push({shape:h[1],fill:l}),m.push({shape:h[2],fill:f}),d=Math.min(e,n||120),q=Math.max(q,d),p=Math.max(p,d)}v.push(m)}}return Promise.resolve(B.renderSymbol(v,[q,p],{node:b&&b.node,scale:r,opacity:b&&b.opacity}))});return J.apply(this,arguments)}const ba=S.getLogger("esri.symbols.support.previewSymbol3D");z.getPatternDescriptor=P;z.getSymbolLayerFill=g;z.previewSymbol3D=function(a,b){if(0===
a.symbolLayers.length)return Promise.reject(new N("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(a.type){case "point-3d":return aa(a,b);case "line-3d":return ca(a,b);case "polygon-3d":case "mesh-3d":return da(a,b)}return Promise.reject(new N("symbolPreview: swatchInfo3D","symbol not supported."))};Object.defineProperty(z,"__esModule",{value:!0})});