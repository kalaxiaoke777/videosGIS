// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Color ../../../request ../../../core/MapUtils ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../MeshComponent ../MeshMaterialMetallicRoughness ../MeshTexture ../MeshVertexAttributes ../buffer/BufferView ../../../chunks/vec32 ../../../chunks/vec42 ../buffer/utils ./georeference ../../../views/3d/glTF/DefaultLoadingContext ../../../views/3d/glTF/loader ../../../views/3d/glTF/internal/indexUtils ../../../views/3d/webgl-engine/lib/geometryDataUtils ../../../views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../../chunks/vec33 ../../../chunks/vec43 ../../../chunks/vec22".split(" "),
function(D,E,F,N,G,f,H,I,O,P,Q,R,S,T,n,x,z,v,U,V,W,A,X,Y,J,y,K){function B(){B=E._asyncToGenerator(function*(a,b,g){var c=new V.DefaultLoadingContext(Z(g));b=(yield W.load(c,b,g,!0)).model;c=b.lods.shift();const d=new Map,e=new Map;b.textures.forEach((p,t)=>d.set(t,new S({data:p.data,wrap:aa(p.parameters.wrap)})));b.materials.forEach((p,t)=>e.set(t,ba(p,d)));b=ca(c);for(var l of b.parts)da(b,l,e);const {position:r,normal:m,tangent:h,color:q,texCoord0:k}=b.vertexAttributes;l={position:r.typedBuffer,
normal:f.isSome(m)?m.typedBuffer:null,tangent:f.isSome(h)?h.typedBuffer:null,uv:f.isSome(k)?k.typedBuffer:null,color:f.isSome(q)?q.typedBuffer:null};g=U.georeferenceByTransform(l,a,g);return{transform:g.transform,components:b.components,spatialReference:a.spatialReference,vertexAttributes:new T["default"]({position:g.vertexAttributes.position,normal:g.vertexAttributes.normal,tangent:g.vertexAttributes.tangent,color:l.color,uv:l.uv})}});return B.apply(this,arguments)}function Z(a){return null!=a&&
a.resolveFile?{busy:!1,request:function(){var b=E._asyncToGenerator(function*(g,c,d){g=a.resolveFile(g);return(yield N(g,{responseType:"image"===c?"image":"binary"===c?"array-buffer":"json",signal:f.isSome(d)?d.signal:null})).data});return function(g,c,d){return b.apply(this,arguments)}}()}:null}function w(a,b){if(f.isNone(a))return"-";a=a.typedBuffer;return`${G.getOrCreateMapValue(b,a.buffer,()=>b.size)}/${a.byteOffset}/${a.byteLength}`}function ea(a){return f.isSome(a)?a.toString():"-"}function ca(a){let b=
0;var g=!1,c=!1,d=!1,e=!1;const l=new Map,r=new Map,m=[];for(const h of a.parts){const {attributes:{position:q,normal:k,color:p,tangent:t,texCoord0:L}}=h;a=`\n      ${w(q,l)}/\n      ${w(k,l)}/\n      ${w(p,l)}/\n      ${w(t,l)}/\n      ${w(L,l)}/\n      ${ea(h.transform)}\n    `;let C=!1;a=G.getOrCreateMapValue(r,a,()=>{C=!0;return{start:b,length:q.count}});C&&(b+=q.count);k&&(d=!0);p&&(g=!0);t&&(c=!0);L&&(e=!0);m.push({gltf:h,writeVertices:C,region:a})}return{vertexAttributes:{position:v.createBuffer(n.BufferViewVec3f64,
b),normal:d?v.createBuffer(n.BufferViewVec3f,b):null,tangent:c?v.createBuffer(n.BufferViewVec4f,b):null,color:g?v.createBuffer(n.BufferViewVec4u8,b):null,texCoord0:e?v.createBuffer(n.BufferViewVec2f,b):null},parts:m,components:[]}}function ba(a,b){const g=new F(fa(a.color,a.opacity)),c=a.emissiveFactor?new F(ha(a.emissiveFactor)):null;var d=f.unwrap(f.applySome(a.textureColor,h=>b.get(h))),e=f.unwrap(f.applySome(a.textureNormal,h=>b.get(h))),l=f.unwrap(f.applySome(a.textureEmissive,h=>b.get(h))),
r=f.unwrap(f.applySome(a.textureOcclusion,h=>b.get(h)));a:{switch(a.alphaMode){case "OPAQUE":var m="opaque";break a;case "MASK":m="mask";break a;case "BLEND":m="blend";break a}m=void 0}return new R({color:g,colorTexture:d,normalTexture:e,emissiveColor:c,emissiveTexture:l,occlusionTexture:r,alphaMode:m,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided,metallic:a.metallicFactor,roughness:a.roughnessFactor,metallicRoughnessTexture:f.unwrap(f.applySome(a.textureMetallicRoughness,h=>b.get(h)))})}function da(a,
b,g){if(b.writeVertices){{const {position:l,normal:r,tangent:m,color:h,texCoord0:q}=a.vertexAttributes;var c=b.region.start;const {attributes:k,transform:p}=b.gltf;var d=k.position.count;x.transformMat4(l.slice(c,d),k.position,p);if(f.isSome(k.normal)&&f.isSome(r)){var e=H.normalFromMat4(I.create(),p);x.transformMat3(r.slice(c,d),k.normal,e)}else f.isSome(r)&&J.fill(r,0,0,1,{dstIndex:c,count:d});f.isSome(k.tangent)&&f.isSome(m)?(e=H.normalFromMat4(I.create(),p),z.transformMat3(m.slice(c,d),k.tangent,
e)):f.isSome(m)&&y.fill(m,0,0,1,1,{dstIndex:c,count:d});f.isSome(k.texCoord0)&&f.isSome(q)?K.normalizeIntegerBuffer(q.slice(c,d),k.texCoord0):f.isSome(q)&&K.fill(q,0,0,{dstIndex:c,count:d});f.isSome(k.color)&&f.isSome(h)?(e=k.color,c=h.slice(c,d),4===e.elementCount?e instanceof n.BufferViewVec4f?z.scale(c,e,255):e instanceof n.BufferViewVec4u8?y.copy(c,e):e instanceof n.BufferViewVec4u16&&z.shiftRight(c,e,8):(y.fill(c,255,255,255,255),c=n.BufferViewVec3u8.fromTypedArray(c.typedBuffer,c.typedBufferStride),
e instanceof n.BufferViewVec3f?x.scale(c,e,255):e instanceof n.BufferViewVec3u8?J.copy(c,e):e instanceof n.BufferViewVec3u16&&x.shiftRight(c,e,8))):f.isSome(h)&&y.fill(h.slice(c,d),255,255,255,255)}}c=b.gltf;a:{d=c.indices||c.attributes.position.count;switch(c.primitiveType){case 4:d=A.trianglesToTriangles(d,X.generateIndexArray);break a;case 5:d=A.triangleStripToTriangles(d);break a;case 6:d=A.triangleFanToTriangles(d);break a}d=void 0}if(b=b.region.start)for(e=0;e<d.length;e++)d[e]+=b;a.components.push(new Q({faces:d,
material:g.get(c.material),trustSourceNormals:!0}))}function aa(a){return{horizontal:M(a.s),vertical:M(a.t)}}function M(a){switch(a){case 33071:return"clamp";case 33648:return"mirror";case 10497:return"repeat"}}function u(a){return 255*a**(1/Y.COLOR_GAMMA)}function fa(a,b){return P.fromValues(u(a[0]),u(a[1]),u(a[2]),b)}function ha(a){return O.fromValues(u(a[0]),u(a[1]),u(a[2]))}D.loadGLTFMesh=function(a,b,g){return B.apply(this,arguments)};Object.defineProperty(D,"__esModule",{value:!0})});