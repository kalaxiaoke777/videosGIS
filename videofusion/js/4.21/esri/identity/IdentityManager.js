// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
require({cache:{"esri/identity/IdentityManagerBase":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../config ../kernel ../request ../core/Error ../core/Evented ../core/events ../core/global ../core/lang ../core/object ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ./IdentityForm ./IdentityModal ./OAuthCredential ./OAuthInfo ./ServerInfo".split(" "),
function(y,t,n,l,r,H,z,U,I,V,G,w,P,B,L,F,ca,la,fa,da,T,ha,ia,Y){const Z={},ja=Q=>{const O=(new B.Url(Q.owningSystemUrl)).host;Q=(new B.Url(Q.server)).host;const p=/.+\.arcgis\.com$/i;return p.test(O)&&p.test(Q)},ma=(Q,O)=>!!(ja(Q)&&O&&O.some(p=>p.test(Q.server)));let ka=null,ea=null;try{ka=window.localStorage,ea=window.sessionStorage}catch{}F=function(Q){function O(){var a=Q.call(this)||this;a._portalConfig=V.esriGeowConfig;a.serverInfos=[];a.oAuthInfos=[];a.credentials=[];a._soReqs=[];a._xoReqs=
[];a._portals=[];a.defaultOAuthInfo=null;a.defaultTokenValidity=60;a.dialog=null;a.formConstructor=da;a.tokenValidity=null;a.normalizeWebTierAuth=!1;a._appOrigin="null"!==window.origin?window.origin:window.location.origin;a._appUrlObj=B.urlToObject(window.location.href);a._busy=null;a._rejectOnPersistedPageShow=!1;a._oAuthHash=null;a._gwTokenUrl="/sharing/rest/generateToken";a._agsRest="/rest/services";a._agsPortal=/\/sharing(\/|$)/i;a._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i;a._adminSvcs=
/\/rest\/admin\/services(\/|$)/i;a._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},
{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}];a._legacyFed=[];a._regexSDirUrl=/http.+\/rest\/services\/?/gi;a._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi;
a._gwUser=/http.+\/users\/([^\/]+)\/?.*/i;a._gwItem=/http.+\/items\/([^\/]+)\/?.*/i;a._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i;a._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i;a._createDefaultOAuthInfo=!0;a._hasTestedIfAppIsOnPortal=!1;a._getOAuthHash();window.addEventListener("pageshow",b=>{a._pageShowHandler(b)});return a}t._inheritsLoose(O,Q);var p=O.prototype;p.registerServers=function(a){const b=this.serverInfos;b?(a=a.filter(c=>!this.findServerInfo(c.server)),this.serverInfos=b.concat(a)):
this.serverInfos=a;a.forEach(c=>{c.owningSystemUrl&&this._portals.push(c.owningSystemUrl);c.hasPortal&&this._portals.push(c.server)})};p.registerOAuthInfos=function(a){const b=this.oAuthInfos;if(b){for(const c of a){const d=this.findOAuthInfo(c.portalUrl);d&&b.splice(b.indexOf(d),1)}this.oAuthInfos=b.concat(a)}else this.oAuthInfos=a};p.registerToken=function(a){a={...a};const b=this._sanitizeUrl(a.server),c=this._isServerRsrc(b);let d=this.findServerInfo(b),e=!0,g;d||(d=new Y,d.server=this._getServerInstanceRoot(b),
c?d.hasServer=!0:(d.tokenServiceUrl=this._getTokenSvcUrl(b),d.hasPortal=!0),this.registerServers([d]));(g=this._findCredential(b))?(delete a.server,Object.assign(g,a),e=!1):(g=new y.Credential({userId:a.userId,server:d.server,token:a.token,expires:a.expires,ssl:a.ssl,scope:c?"server":"portal"}),g.resources=[b],this.credentials.push(g));g.emitTokenChange(!1);e||g.refreshServerTokens()};p.toJSON=function(){return G.fixJson({serverInfos:this.serverInfos.map(a=>a.toJSON()),oAuthInfos:this.oAuthInfos.map(a=>
a.toJSON()),credentials:this.credentials.map(a=>a.toJSON())})};p.initialize=function(a){if(a){"string"===typeof a&&(a=JSON.parse(a));var b=a.serverInfos,c=a.oAuthInfos;a=a.credentials;if(b){const d=[];b.forEach(e=>{e.server&&e.tokenServiceUrl&&d.push(e.declaredClass?e:new Y(e))});d.length&&this.registerServers(d)}if(c){const d=[];c.forEach(e=>{e.appId&&d.push(e.declaredClass?e:new ia(e))});d.length&&this.registerOAuthInfos(d)}a&&a.forEach(d=>{d.server&&d.token&&d.expires&&d.expires>Date.now()&&(d=
d.declaredClass?d:new y.Credential(d),d.emitTokenChange(),this.credentials.push(d))})}};p.findServerInfo=function(a){let b;a=this._sanitizeUrl(a);for(const c of this.serverInfos)if(this._hasSameServerInstance(c.server,a)){b=c;break}return b};p.findOAuthInfo=function(a){let b;a=this._sanitizeUrl(a);for(const c of this.oAuthInfos)if(this._hasSameServerInstance(c.portalUrl,a)){b=c;break}return b};p.findCredential=function(a,b){let c;a=this._sanitizeUrl(a);const d=this._isServerRsrc(a)?"server":"portal";
if(b)for(const e of this.credentials){if(this._hasSameServerInstance(e.server,a)&&b===e.userId&&e.scope===d){c=e;break}}else for(const e of this.credentials)if(this._hasSameServerInstance(e.server,a)&&-1!==this._getIdenticalSvcIdx(a,e)&&e.scope===d){c=e;break}return c};p.getCredential=function(a,b){let c=!0;if(b){var d=!!b.token;var e=b.error;c=!1!==b.prompt}b={...b};a=this._sanitizeUrl(a);const g=P.createAbortController(),m=P.createResolver();if(b.signal)P.onAbort(b.signal,()=>{g.abort()});P.onAbort(g,
()=>{m.reject(new z("identity-manager:user-aborted","ABORTED"))});if(P.isAborted(g))return m.promise;b.signal=g.signal;const u=this._isAdminResource(a);if((d=d?this.findCredential(a):null)&&e&&e.details&&498===e.details.httpStatus)d.destroy();else if(d)return a=new z("identity-manager:not-authorized","You are currently signed in as: '"+d.userId+"'. You do not have access to this resource: "+a,{error:e}),m.reject(a),m.promise;if(e=this._findCredential(a,b))return m.resolve(e),m.promise;let f=this.findServerInfo(a);
if(f)!f.hasServer&&this._isServerRsrc(a)&&(f._restInfoPms=this._getTokenSvcUrl(a),f.hasServer=!0);else{e=this._getTokenSvcUrl(a);if(!e)return a=new z("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),m.reject(a),m.promise;f=new Y;f.server=this._getServerInstanceRoot(a);"string"===typeof e?(f.tokenServiceUrl=e,f.hasPortal=!0):(f._restInfoPms=e,f.hasServer=!0);this.registerServers([f])}f.hasPortal&&void 0===f._selfReq&&(c||B.hasSameOrigin(f.tokenServiceUrl,
this._appOrigin)||this._gwDomains.some(k=>k.tokenServiceUrl===f.tokenServiceUrl))&&(f._selfReq={owningTenant:b&&b.owningTenant,selfDfd:this._getPortalSelf(f.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),a)});return this._enqueue(a,f,b,m,u)};p.getResourceName=function(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&a.replace(this._gwItem,"$1")||
this._gwGroup.test(a)&&a.replace(this._gwGroup,"$1")||""};p.generateToken=function(a,b,c){const d=this._rePortalTokenSvc.test(a.tokenServiceUrl),e=new B.Url(this._appOrigin);var g=a.shortLivedTokenValidity;let m,u,f,k,x,q,D;b&&(D=this.tokenValidity||g||this.defaultTokenValidity,D>g&&0<g&&(D=g));c&&(m=c.isAdmin,u=c.serverUrl,f=c.token,x=c.signal,q=c.ssl,a.customParameters=c.customParameters);m?g=a.adminTokenServiceUrl:(g=a.tokenServiceUrl,k=new B.Url(g.toLowerCase()),a.webTierAuth&&null!=c&&c.serverUrl&&
!q&&"http"===e.scheme&&(B.hasSameOrigin(e.uri,g,!0)||"https"===k.scheme&&e.host===k.host&&"7080"===e.port&&"7443"===k.port)&&(g=g.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));c={query:{request:"getToken",username:null==b?void 0:b.username,password:null==b?void 0:b.password,serverUrl:u,token:f,expiration:D,referer:m||d?this._appOrigin:null,client:m?"referer":null,f:"json",...a.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(a,c),signal:x,...null==c?void 0:c.ioArgs};
d||(c.withCredentials=!1);return H(g,c).then(C=>{C=C.data;if(!C||!C.token)return new z("identity-manager:authentication-failed","Unable to generate token");const v=a.server;Z[v]||(Z[v]={});b&&(Z[v][b.username]=b.password);C.validity=D;return C})};p.isBusy=function(){return!!this._busy};p.checkSignInStatus=function(a){return this.checkAppAccess(a,"").then(b=>b.credential)};p.checkAppAccess=function(a,b,c){let d=!1;return this.getCredential(a,{prompt:!1}).then(e=>{let g;const m={f:"json"};if("portal"===
e.scope)if(b&&(this._doPortalSignIn(a)||c&&c.force))g=e.server+"/sharing/rest/oauth2/validateAppAccess",m.client_id=b;else if(e.token)g=e.server+"/sharing/rest";else return{credential:e};else if(e.token)g=e.server+"/rest/services";else return{credential:e};e.token&&(m.token=e.token);return H(g,{query:m,authMode:"anonymous"}).then(u=>{if(!1===u.data.valid)throw new z("identity-manager:not-authorized",`You are currently signed in as: '${e.userId}'.`,u.data);d=!!u.data.viewOnlyUserTypeApp;return{credential:e}}).catch(u=>
{if("identity-manager:not-authorized"===u.name)throw u;u=u.details&&u.details.httpStatus;if(498===u)throw e.destroy(),new z("identity-manager:not-authenticated","User is not signed in.");if(400===u)throw new z("identity-manager:invalid-request");return{credential:e}})}).then(e=>({credential:e.credential,viewOnly:d}))};p.setOAuthResponseHash=function(a){var b;const c=this._oAuthDfd;this._oAuthDfd=null;if(c&&a)if(clearInterval(this._oAuthIntervalId),null==(b=this._oAuthOnHashHandle)?void 0:b.remove(),
"#"===a.charAt(0)&&(a=a.substring(1)),a=B.queryToObject(a),a.error)b="access_denied"===a.error,a=new z(b?"identity-manager:user-aborted":"identity-manager:authentication-failed",b?"ABORTED":"OAuth: "+a.error+" - "+a.error_description),c.reject(a);else{b=c.oinfo_;const d=b._oAuthCred,e=new y.Credential({userId:a.username,server:c.sinfo_.server,token:a.access_token,expires:Date.now()+1E3*Number(a.expires_in),ssl:"true"===a.ssl,_oAuthCred:d});b.userId=e.userId;d.storage=a.persist?ka:ea;d.token=e.token;
d.expires=e.expires;d.userId=e.userId;d.ssl=e.ssl;d.save();c.resolve(e)}};p.setOAuthRedirectionHandler=function(a){this._oAuthRedirectFunc=a};p.setProtocolErrorHandler=function(a){this._protocolFunc=a};p.signIn=function(a,b,c={}){const d=P.createResolver(),e=()=>{var x,q,D,C,v;null==(x=u)?void 0:x.remove();null==(q=f)?void 0:q.remove();null==(D=k)?void 0:D.remove();null==(C=m)?void 0:C.destroy();null==(v=this.dialog)?void 0:v.destroy();this.dialog=m=u=f=k=null},g=()=>{e();this._oAuthDfd=null;d.reject(new z("identity-manager:user-aborted",
"ABORTED"))};if(c.signal)P.onAbort(c.signal,()=>{g()});let m=new this.formConstructor;m.resource=this.getResourceName(a);m.server=b.server;this.dialog=new T;this.dialog.content=m;this.dialog.open=!0;this.emit("dialog-create");let u=m.on("cancel",g),f=this.dialog.watch("open",g),k=m.on("submit",x=>{this.generateToken(b,x,{isAdmin:c.isAdmin,signal:c.signal}).then(q=>{e();q=new y.Credential({userId:x.username,server:b.server,token:q.token,expires:null!=q.expires?Number(q.expires):null,ssl:!!q.ssl,isAdmin:c.isAdmin,
validity:q.validity});d.resolve(q)}).catch(q=>{m.error=q;m.signingIn=!1})});return d.promise};p.oAuthSignIn=function(a,b,c,d){const e=this._oAuthDfd=P.createResolver();if(null!=d&&d.signal)P.onAbort(d.signal,()=>{const q=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;q&&!q.closed?q.close():this.dialog&&m()});e.resUrl_=a;e.sinfo_=b;e.oinfo_=c;d=!d||!1!==d.oAuthPopupConfirmation;if(!c.popup||!d)return this._doOAuthSignIn(a,b,c),e.promise;const g=new this.formConstructor;g.oAuthPrompt=!0;g.server=b.server;
this.dialog=new T;this.dialog.content=g;this.dialog.open=!0;this.emit("dialog-create");const m=()=>{x();this._oAuthDfd=null;e.reject(new z("identity-manager:user-aborted","ABORTED"))},u=g.on("cancel",m),f=this.dialog.watch("open",m),k=g.on("submit",()=>{x();this._doOAuthSignIn(a,b,c)}),x=()=>{u.remove();f.remove();k.remove();g.destroy();this.dialog.destroy();this.dialog=null};return e.promise};p.destroyCredentials=function(){this.credentials&&this.credentials.slice().forEach(a=>{a.destroy()});this.emit("credentials-destroy")};
p.enablePostMessageAuth=function(a="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove();this._postMessageAuthHandle=I.on(window,"message",b=>{var c;if((b.origin===this._appOrigin||b.origin.endsWith(".arcgis.com"))&&"arcgis:auth:requestCredential"===(null==(c=b.data)?void 0:c.type)){const d=b.source;this.getCredential(a).then(e=>{d.postMessage({type:"arcgis:auth:credential",credential:{expires:e.expires,server:e.server,ssl:e.ssl,token:e.token,userId:e.userId}},
b.origin)}).catch(e=>{d.postMessage({type:"arcgis:auth:error",error:{name:e.name,message:e.message}},b.origin)})}})};p.disablePostMessageAuth=function(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)};p._getOAuthHash=function(){var a=window.location.hash;if(a){"#"===a.charAt(0)&&(a=a.substring(1));a=B.queryToObject(a);let b=!1;if(a.access_token&&a.expires_in&&a.state&&a.hasOwnProperty("username"))try{a.state=JSON.parse(a.state),"object"===typeof a.state&&
a.state.portalUrl&&(this._oAuthHash=a,b=!0)}catch{}else a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(b=!0));b&&(window.location.hash="object"===typeof a.state&&a.state.hash||"")}};p._pageShowHandler=function(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=new z("identity-manager:user-aborted","ABORTED"),this._errbackFunc(a))};p._findCredential=function(a,b){let c=-1,d,e,g;const m=b&&b.token;
b=b&&b.resource;const u=this._isServerRsrc(a)?"server":"portal",f=this.credentials.filter(k=>this._hasSameServerInstance(k.server,a)&&k.scope===u);a=b||a;if(f.length)if(1===f.length)if(b=f[0],e=(d=(g=this.findServerInfo(b.server))&&g.owningSystemUrl)&&this.findCredential(d,b.userId),c=this._getIdenticalSvcIdx(a,b),m)-1!==c&&(b.resources.splice(c,1),this._removeResource(a,e));else return-1===c&&b.resources.push(a),this._addResource(a,e),b;else{let k,x;f.some(q=>{x=this._getIdenticalSvcIdx(a,q);return-1!==
x?(k=q,e=(d=(g=this.findServerInfo(k.server))&&g.owningSystemUrl)&&this.findCredential(d,k.userId),c=x,!0):!1});if(m)k&&(k.resources.splice(c,1),this._removeResource(a,e));else if(k)return this._addResource(a,e),k}};p._findOAuthInfo=function(a){let b=this.findOAuthInfo(a);if(!b)for(const c of this.oAuthInfos)if(this._isIdProvider(c.portalUrl,a)){b=c;break}return b};p._addResource=function(a,b){b&&-1===this._getIdenticalSvcIdx(a,b)&&b.resources.push(a)};p._removeResource=function(a,b){let c=-1;b&&
(c=this._getIdenticalSvcIdx(a,b),-1<c&&b.resources.splice(c,1))};p._useProxy=function(a,b){return b&&b.isAdmin&&!B.hasSameOrigin(a.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(a.tokenServiceUrl)&&"10.1"===String(a.currentVersion)&&!B.hasSameOrigin(a.tokenServiceUrl,this._appOrigin)};p._getOrigin=function(a){a=new B.Url(a);return a.scheme+"://"+a.host+(null!=a.port?":"+a.port:"")};p._getServerInstanceRoot=function(a){const b=a.toLowerCase();let c=b.indexOf(this._agsRest);-1===c&&this._isAdminResource(a)&&
(c=this._agsAdmin.test(a)?a.replace(this._agsAdmin,"$1").length:a.search(this._adminSvcs));-1===c&&(c=b.indexOf("/sharing"));-1===c&&"/"===b.substr(-1)&&(c=b.length-1);return-1<c?a.substring(0,c):a};p._hasSameServerInstance=function(a,b){"/"===a.substr(-1)&&(a=a.slice(0,-1));a=a.toLowerCase();b=this._getServerInstanceRoot(b).toLowerCase();a=this._normalizeAGOLorgDomain(a);b=this._normalizeAGOLorgDomain(b);a=a.substr(a.indexOf(":"));b=b.substr(b.indexOf(":"));return a===b};p._normalizeAGOLorgDomain=
function(a){const b=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,c=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,d=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;b.test(a)?a=a.replace(b,"https://www.arcgis.com"):c.test(a)?a=a.replace(c,"https://devext.arcgis.com"):d.test(a)&&(a=a.replace(d,"https://qaext.arcgis.com"));return a};p._sanitizeUrl=function(a){const b=(l.request.proxyUrl||"").toLowerCase(),c=b?a.toLowerCase().indexOf(b+"?"):-1;-1!==c&&(a=a.substring(c+b.length+
1));a=B.normalize(a);return B.urlToObject(a).path};p._isRESTService=function(a){return-1<a.indexOf(this._agsRest)};p._isAdminResource=function(a){return this._agsAdmin.test(a)||this._adminSvcs.test(a)};p._isServerRsrc=function(a){return this._isRESTService(a)||this._isAdminResource(a)};p._isIdenticalService=function(a,b){if(this._isRESTService(a)&&this._isRESTService(b)){a=this._getSuffix(a).toLowerCase();b=this._getSuffix(b).toLowerCase();var c=a===b;c||(c=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi,
c=a.replace(c,"$1")===b.replace(c,"$1"))}else this._isAdminResource(a)&&this._isAdminResource(b)?c=!0:this._isServerRsrc(a)||this._isServerRsrc(b)||!this._isPortalDomain(a)||(c=!0);return c};p._isPortalDomain=function(a){const b=new B.Url(a.toLowerCase());a=this._portalConfig;let c=this._gwDomains.some(d=>d.regex.test(b.uri));!c&&a&&(c=this._hasSameServerInstance(this._getServerInstanceRoot(a.restBaseUrl),b.uri));c||l.portalUrl&&(c=B.hasSameOrigin(b,l.portalUrl,!0));c||(c=this._portals.some(d=>this._hasSameServerInstance(d,
b.uri)));return c=c||this._agsPortal.test(b.path)};p._isIdProvider=function(a,b){let c=-1,d=-1;this._gwDomains.forEach((g,m)=>{-1===c&&g.regex.test(a)&&(c=m);-1===d&&g.regex.test(b)&&(d=m)});let e=!1;if(-1<c&&-1<d)if(0===c||4===c){if(0===d||4===d)e=!0}else if(1===c){if(1===d||2===d)e=!0}else 2===c?2===d&&(e=!0):3===c&&3===d&&(e=!0);if(!e){const g=this.findServerInfo(b),m=g&&g.owningSystemUrl;m&&ja(g)&&this._isPortalDomain(m)&&this._isIdProvider(a,m)&&(e=!0)}return e};p._getIdenticalSvcIdx=function(a,
b){let c=-1;for(let d=0;d<b.resources.length;d++)if(this._isIdenticalService(a,b.resources[d])){c=d;break}return c};p._getSuffix=function(a){return a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")};p._getTokenSvcUrl=function(a){if(this._isRESTService(a)||this._isAdminResource(a)){var b=this._getServerInstanceRoot(a);var c=b+"/admin/generateToken";a=b+"/rest/info";b=H(a,{query:{f:"json"}}).then(d=>d.data);return{adminUrl:c,promise:b}}if(this._isPortalDomain(a)){let d="";this._gwDomains.some(e=>
{e.regex.test(a)&&(d=e.tokenServiceUrl);return!!d});d||this._portals.some(e=>{this._hasSameServerInstance(e,a)&&(d=e+this._gwTokenUrl);return!!d});d||(c=a.toLowerCase().indexOf("/sharing"),-1!==c&&(d=a.substring(0,c)+this._gwTokenUrl));d||(d=this._getOrigin(a)+this._gwTokenUrl);d&&(c=(new B.Url(a)).port,/^http:\/\//i.test(a)&&"7080"===c&&(d=d.replace(/:7080/i,":7443")),d=d.replace(/http:/i,"https:"));return d}if(-1!==a.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"};
p._exchangeToken=function(a,b,c){return H(`${a}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:b,token:c}}).then(d=>d.data.token)};p._getPlatformSelf=function(a,b){return H(`${a}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":b,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json"},withCredentials:!0}).then(c=>c.data)};p._getPortalSelf=function(a,b){let c;this._gwDomains.some(d=>
{d.regex.test(a)&&(c=d.customBaseUrl);return!!c});if(c)return Promise.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:c,portalMode:"multitenant",supportsOAuth:!0});this._appOrigin.startsWith("https:")?a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(b)&&(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return H(a,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(d=>d.data)};p._doPortalSignIn=function(a){const b=this._portalConfig,c=window.location.href,
d=this.findServerInfo(a);return(b||this._isPortalDomain(c))&&(d?d.hasPortal||d.owningSystemUrl&&this._isPortalDomain(d.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(c,a)||b&&(this._hasSameServerInstance(this._getServerInstanceRoot(b.restBaseUrl),a)||this._isIdProvider(b.restBaseUrl,a))||B.hasSameOrigin(c,a,!0))?!0:!1};p._checkProtocol=function(a,b,c,d){let e=!0;d=d?b.adminTokenServiceUrl:b.tokenServiceUrl;d.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&
B.getProxyRule(d)&&(e=this._protocolFunc?!!this._protocolFunc({resourceUrl:a,serverInfo:b}):!1,e||(a=new z("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection."),c(a)));return e};p._enqueue=function(a,b,c,d,e,g){d||(d=P.createResolver());d.resUrl_=a;d.sinfo_=b;d.options_=c;d.admin_=e;d.refresh_=g;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),
this._soReqs.push(d)):this._xoReqs.push(d):this._doSignIn(d);return d.promise};p._doSignIn=function(a){this._busy=a;this._rejectOnPersistedPageShow=!1;const b=f=>{var k=a.options_&&a.options_.resource;const x=a.resUrl_,q=a.refresh_;let D=!1;-1===this.credentials.indexOf(f)&&(q&&-1!==this.credentials.indexOf(q)?(q.userId=f.userId,q.token=f.token,q.expires=f.expires,q.validity=f.validity,q.ssl=f.ssl,q.creationTime=f.creationTime,D=!0,f=q):this.credentials.push(f));f.resources||(f.resources=[]);f.resources.push(k||
x);f.scope=this._isServerRsrc(x)?"server":"portal";f.emitTokenChange();k=this._soReqs;const C={};this._soReqs=[];k.forEach(v=>{if(!this._isIdenticalService(x,v.resUrl_)){const J=this._getSuffix(v.resUrl_);C[J]||(C[J]=!0,f.resources.push(v.resUrl_))}});a.resolve(f);k.forEach(v=>{this._hasSameServerInstance(this._getServerInstanceRoot(x),v.resUrl_)?v.resolve(f):this._soReqs.push(v)});this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;D||this.emit("credential-create",{credential:f});this._soReqs.length?this._doSignIn(this._soReqs.shift()):
this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},c=f=>{a.reject(f);this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},d=(f,k,x,q)=>{var D,C;const v=a.sinfo_,J=!a.options_||!1!==a.options_.prompt,R=v.hasPortal&&this._findOAuthInfo(a.resUrl_);let M,X;if(f)b(new y.Credential({userId:f,server:v.server,token:x||null,expires:null!=q?Number(q):null,ssl:!!k}));else if(window!==window.parent&&
null!=(D=this._appUrlObj.query)&&D["arcgis-auth-origin"]&&null!=(C=this._appUrlObj.query)&&C["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),a.resUrl_)){var na;window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const E=I.on(window,"message",S=>{S.source===window.parent&&S.data&&("arcgis:auth:credential"===S.data.type?(E.remove(),b(new y.Credential(S.data.credential))):
"arcgis:auth:error"===S.data.type&&(E.remove(),c(z.fromJSON(S.data.error))))});P.onAbort(null==(na=a.options_)?void 0:na.signal,()=>{E.remove()})}else if(R){let E=R._oAuthCred;E||(f=new ha(R,ka),k=new ha(R,ea),f.isValid()&&k.isValid()?f.expires>k.expires?(E=f,k.destroy()):(E=k,f.destroy()):E=f.isValid()?f:k,R._oAuthCred=E);if(E.isValid())M=new y.Credential({userId:E.userId,server:v.server,token:E.token,expires:E.expires,ssl:E.ssl,_oAuthCred:E}),R.appId!==E.appId&&this._doPortalSignIn(a.resUrl_)?a._pendingDfd=
this._exchangeToken(M.server,R.appId,M.token).then(S=>{M.token=S;E.token=S;E.save();b(M)}).catch(()=>{b(M)}):b(M);else if(this._oAuthHash&&this._hasSameServerInstance(R.portalUrl,this._oAuthHash.state.portalUrl))f=this._oAuthHash,M=new y.Credential({userId:f.username,server:v.server,token:f.access_token,expires:Date.now()+1E3*Number(f.expires_in),ssl:"true"===f.ssl,oAuthState:f.state,_oAuthCred:E}),R.userId=M.userId,E.storage=f.persist?ka:ea,E.token=M.token,E.expires=M.expires,E.userId=M.userId,E.ssl=
M.ssl,E.save(),this._oAuthHash=null,b(M);else{const S=()=>{J?a._pendingDfd=this.oAuthSignIn(a.resUrl_,v,R,a.options_).then(b,c):(X=new z("identity-manager:not-authenticated","User is not signed in."),c(X))};this._doPortalSignIn(a.resUrl_)?a._pendingDfd=this._getPlatformSelf(v.server,R.appId).then(({portalUrl:oa,token:pa,username:qa})=>{!oa||B.hasSameOrigin(oa,this._appOrigin,!0)?(M=new y.Credential({server:v.server,userId:qa,token:pa}),b(M)):S()}).catch(S):S()}}else J?this._checkProtocol(a.resUrl_,
v,c,a.admin_)&&(f=a.options_,a.admin_&&(f=f||{},f.isAdmin=!0),a._pendingDfd=this.signIn(a.resUrl_,v,f).then(b,c)):(X=new z("identity-manager:not-authenticated","User is not signed in."),c(X))},e=()=>{const f=a.sinfo_;var k=f.owningSystemUrl;const x=a.options_;let q,D,C,v;x&&(q=x.token,D=x.error,C=x.prompt);v=this._findCredential(k,{token:q,resource:a.resUrl_});if(!v)for(const J of this.credentials)if(this._isIdProvider(k,J.server)){v=J;break}v?(k=this.findCredential(a.resUrl_,v.userId))?b(k):ma(f,
this._legacyFed)?(k=v.toJSON(),k.server=f.server,k.resources=null,b(new y.Credential(k))):(a._pendingDfd=this.generateToken(this.findServerInfo(v.server),null,{serverUrl:a.resUrl_,token:v.token,signal:a.options_.signal,ssl:v.ssl})).then(J=>{b(new y.Credential({userId:v.userId,server:f.server,token:J.token,expires:null!=J.expires?Number(J.expires):null,ssl:!!J.ssl,isAdmin:a.admin_,validity:J.validity}))},c):(this._busy=null,q&&(a.options_.token=null),(a._pendingDfd=this.getCredential(k.replace(/\/?$/,
"/sharing"),{resource:a.resUrl_,owningTenant:f.owningTenant,signal:a.options_.signal,token:q,error:D,prompt:C})).then(()=>{this._enqueue(a.resUrl_,a.sinfo_,a.options_,a,a.admin_)},J=>{a.resUrl_=a.sinfo_=a.refresh_=null;a.reject(J)}))};this._errbackFunc=c;const g=a.sinfo_.owningSystemUrl,m=this._isServerRsrc(a.resUrl_),u=a.sinfo_._restInfoPms;u?u.promise.then(f=>{const k=a.sinfo_;k._restInfoPms&&(k.adminTokenServiceUrl=k._restInfoPms.adminUrl,k._restInfoPms=null,k.tokenServiceUrl=w.getDeepValue("authInfo.tokenServicesUrl",
f)||w.getDeepValue("authInfo.tokenServiceUrl",f)||w.getDeepValue("tokenServiceUrl",f),k.shortLivedTokenValidity=w.getDeepValue("authInfo.shortLivedTokenValidity",f),k.currentVersion=f.currentVersion,k.owningTenant=f.owningTenant,(f=k.owningSystemUrl=f.owningSystemUrl)&&this._portals.push(f));m&&k.owningSystemUrl?e():d()},()=>{a.sinfo_._restInfoPms=null;const f=new z("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");c(f)}):m&&g?e():a.sinfo_._selfReq?
a.sinfo_._selfReq.selfDfd.then(f=>{const k={};let x,q,D,C;f&&(x=f.user&&f.user.username,k.username=x,k.allSSL=f.allSSL,q=f.supportsOAuth,D=f.currentVersion,"multitenant"===f.portalMode&&(C=f.customBaseUrl));a.sinfo_.webTierAuth=!!x;return x&&this.normalizeWebTierAuth?this.generateToken(a.sinfo_,null,{ssl:k.allSSL}).catch(()=>null).then(v=>{k.portalToken=v&&v.token;k.tokenExpiration=v&&v.expires;return k}):!x&&q&&4.4<=parseFloat(D)&&!this._findOAuthInfo(a.resUrl_)?this._generateOAuthInfo({portalUrl:a.sinfo_.server,
customBaseUrl:C,owningTenant:a.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>k):k}).catch(()=>null).then(f=>{a.sinfo_._selfReq=null;f?d(f.username,f.allSSL,f.portalToken,f.tokenExpiration):d()}):d()};p._generateOAuthInfo=function(a){let b,c=a.portalUrl;const d=a.customBaseUrl,e=a.owningTenant;if(a=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){b=window.location.href;let g=b.indexOf("?");-1<g&&(b=b.slice(0,g));g=b.search(/\/(apps|home)\//);b=-1<g?b.slice(0,
g):null}a&&b?(this._hasTestedIfAppIsOnPortal=!0,a=H(b+"/sharing/rest",{query:{f:"json"}}).then(()=>{this.defaultOAuthInfo=new ia({appId:"arcgisonline",popupCallbackUrl:b+"/home/oauth-callback.html"})})):a=Promise.resolve();return a.then(()=>{if(this.defaultOAuthInfo)return c=c.replace(/^http:/i,"https:"),H(c+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:e,client_id:this.defaultOAuthInfo.appId,redirect_uri:B.makeAbsolute(this.defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(g=>{if(g.data.valid){const m=
this.defaultOAuthInfo.clone();m.portalUrl=g.data.urlKey&&d?"https://"+g.data.urlKey.toLowerCase()+"."+d:c;m.popup=window!==window.top||!(B.hasSameOrigin(c,this._appOrigin)||this._gwDomains.some(u=>u.regex.test(c)&&u.regex.test(this._appOrigin)));this.oAuthInfos.push(m)}})})};p._doOAuthSignIn=function(a,b,c){var d={portalUrl:c.portalUrl};!c.popup&&c.preserveUrlHash&&window.location.hash&&(d.hash=window.location.hash);d={client_id:c.appId,response_type:"token",state:JSON.stringify(d),expiration:c.expiration,
locale:c.locale,redirect_uri:c.popup?B.makeAbsolute(c.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};c.forceLogin&&(d.force_login=!0);c.forceUserId&&c.userId&&(d.prepopulatedusername=c.userId);!c.popup&&this._doPortalSignIn(a)&&(d.redirectToUserOrgUrl=!0);const e=c.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",g=e+"?"+B.objectToQuery(d);if(c.popup){const m=window.open(g,"esriJSAPIOAuth",c.popupWindowFeatures);m?(m.focus(),this._oAuthDfd.oAuthWin_=m,this._oAuthIntervalId=
setInterval(()=>{if(m.closed){clearInterval(this._oAuthIntervalId);this._oAuthOnHashHandle.remove();const u=this._oAuthDfd;if(u){const f=new z("identity-manager:user-aborted","ABORTED");u.reject(f)}}},500),this._oAuthOnHashHandle=I.on(V,"arcgis:auth:hash",u=>{this.setOAuthResponseHash(u.detail)})):(a=new z("identity-manager:popup-blocked","ABORTED"),this._oAuthDfd.reject(a))}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:d,authorizeUrl:e,resourceUrl:a,
serverInfo:b,oAuthInfo:c}):window.location.href=g};return O}(U);F.prototype.declaredClass="esri.identity.IdentityManagerBase";y.Credential=function(Q){function O(a){var b=Q.call(this,a)||this;b._oAuthCred=null;b.tokenRefreshBuffer=2;a&&a._oAuthCred&&(b._oAuthCred=a._oAuthCred);return b}t._inheritsLoose(O,Q);var p=O.prototype;p.initialize=function(){this.resources=this.resources||[];null==this.creationTime&&(this.creationTime=Date.now())};p.refreshToken=function(){const a=r.id.findServerInfo(this.server),
b=a&&a.owningSystemUrl,c=!!b&&"server"===this.scope,d=c&&ma(a,r.id._legacyFed);var e=a.webTierAuth;const g=e&&r.id.normalizeWebTierAuth;var m=Z[this.server];m=m&&m[this.userId];let u=this.resources&&this.resources[0],f=c&&r.id.findServerInfo(b),k={username:this.userId,password:m},x;if(!e||g)if(c&&!f&&r.id.serverInfos.some(q=>{r.id._isIdProvider(b,q.server)&&(f=q);return!!f}),e=f&&r.id.findCredential(f.server,this.userId),!c||e)if(d)e.refreshToken();else{if(c)x={serverUrl:u,token:e&&e.token,ssl:e&&
e.ssl};else if(g)k=null,x={ssl:this.ssl};else if(m)this.isAdmin&&(x={isAdmin:!0});else{let q;u&&(u=r.id._sanitizeUrl(u),this._enqueued=1,q=r.id._enqueue(u,a,null,null,this.isAdmin,this),q.then(()=>{this._enqueued=0;this.refreshServerTokens()}).catch(()=>{this._enqueued=0}));return q}return r.id.generateToken(c?f:a,c?null:k,x).then(q=>{this.token=q.token;this.expires=null!=q.expires?Number(q.expires):null;this.creationTime=Date.now();this.validity=q.validity;this.emitTokenChange();this.refreshServerTokens()}).catch(()=>
{})}};p.refreshServerTokens=function(){"portal"===this.scope&&r.id.credentials.forEach(a=>{const b=r.id.findServerInfo(a.server),c=b&&b.owningSystemUrl;a!==this&&a.userId===this.userId&&c&&"server"===a.scope&&(r.id._hasSameServerInstance(this.server,c)||r.id._isIdProvider(c,this.server))&&(ma(b,r.id._legacyFed)?(a.token=this.token,a.expires=this.expires,a.creationTime=this.creationTime,a.validity=this.validity,a.emitTokenChange()):a.refreshToken())})};p.emitTokenChange=function(a){clearTimeout(this._refreshTimer);
var b=this.server&&r.id.findServerInfo(this.server);const c=(b=b&&b.owningSystemUrl)&&r.id.findServerInfo(b);!1===a||b&&"portal"!==this.scope&&(!c||!c.webTierAuth||r.id.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer();this.emit("token-change")};p.destroy=function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const a=r.id.credentials.indexOf(this);
-1<a&&r.id.credentials.splice(a,1);this.emitTokenChange();this.emit("destroy")};p.toJSON=function(){const a=G.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),b=this.resources;b&&0<b.length&&(a.resources=b.slice());return a};p._startRefreshTimer=function(){clearTimeout(this._refreshTimer);const a=6E4*this.tokenRefreshBuffer,b=2**31-1;let c=(this.validity?this.creationTime+
6E4*this.validity:this.expires)-Date.now();0>c?c=0:c>b&&(c=b);this._refreshTimer=setTimeout(this.refreshToken.bind(this),c>a?c-a:c)};return O}(U.EventedAccessor);n.__decorate([L.property()],y.Credential.prototype,"creationTime",void 0);n.__decorate([L.property()],y.Credential.prototype,"expires",void 0);n.__decorate([L.property()],y.Credential.prototype,"isAdmin",void 0);n.__decorate([L.property()],y.Credential.prototype,"oAuthState",void 0);n.__decorate([L.property()],y.Credential.prototype,"resources",
void 0);n.__decorate([L.property()],y.Credential.prototype,"scope",void 0);n.__decorate([L.property()],y.Credential.prototype,"server",void 0);n.__decorate([L.property()],y.Credential.prototype,"ssl",void 0);n.__decorate([L.property()],y.Credential.prototype,"token",void 0);n.__decorate([L.property()],y.Credential.prototype,"tokenRefreshBuffer",void 0);n.__decorate([L.property()],y.Credential.prototype,"userId",void 0);n.__decorate([L.property()],y.Credential.prototype,"validity",void 0);y.Credential=
n.__decorate([fa.subclass("esri.identity.Credential")],y.Credential);y.IdentityManagerBase=F;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/identity/IdentityForm":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/subclass ../intl/substitute ../widgets/Widget ../widgets/support/widgetUtils ../widgets/support/decorators/messageBundle ../widgets/support/jsxFactory".split(" "),
function(y,t,n,l,r,H,z,U,I,V,G,w){l=function(P){function B(F,ca){F=P.call(this,F,ca)||this;F._usernameInputNode=null;F._passwordInputNode=null;F.messages=null;F.signingIn=!1;F.server=null;F.resource=null;F.error=null;F.oAuthPrompt=!1;return F}y._inheritsLoose(B,P);var L=B.prototype;L.render=function(){const {error:F,server:ca,resource:la,signingIn:fa,oAuthPrompt:da,messages:T}=this,ha=w.tsx("div",{class:"esri-identity-form__group"},U.substitute(da?T.oAuthInfo:T.info,{server:/\.arcgis\.com/i.test(ca)?
"ArcGIS Online":ca,resource:`(${la||T.lblItem})`})),ia=da?null:w.tsx("div",{class:"esri-identity-form__group",key:"username"},w.tsx("label",{class:"esri-identity-form__label"},T.lblUser,w.tsx("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:V.storeNode,"data-node-ref":"_usernameInputNode",class:"esri-input"}))),Y=da?null:w.tsx("div",{class:"esri-identity-form__group",key:"password"},w.tsx("label",{class:"esri-identity-form__label"},T.lblPwd,w.tsx("input",
{value:"",required:!0,type:"password",bind:this,afterCreate:V.storeNode,"data-node-ref":"_passwordInputNode",class:"esri-input"}))),Z=w.tsx("div",{class:this.classes("esri-identity-form__group","esri-identity-form__footer")},w.tsx("input",{type:"submit",disabled:!!fa,value:fa?T.lblSigning:T.lblOk,class:"esri-button"}),w.tsx("input",{type:"button",value:T.lblCancel,bind:this,onclick:this._cancel,class:this.classes("esri-button","esri-button--secondary")})),ja=F?w.tsx("div",null,F.details&&F.details.httpStatus?
T.invalidUser:T.noAuthService):null;return w.tsx("form",{class:"esri-identity-form",bind:this,onsubmit:this._submit},ha,ja,ia,Y,Z)};L._cancel=function(){this._set("signingIn",!1);this._usernameInputNode&&(this._usernameInputNode.value="");this._passwordInputNode&&(this._passwordInputNode.value="");this.emit("cancel")};L._submit=function(F){F.preventDefault();this._set("signingIn",!0);this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&
this._passwordInputNode.value})};return B}(I);t.__decorate([n.property(),G.messageBundle("esri/identity/t9n/identity")],l.prototype,"messages",void 0);t.__decorate([n.property()],l.prototype,"signingIn",void 0);t.__decorate([n.property()],l.prototype,"server",void 0);t.__decorate([n.property()],l.prototype,"resource",void 0);t.__decorate([n.property()],l.prototype,"error",void 0);t.__decorate([n.property()],l.prototype,"oAuthPrompt",void 0);return l=t.__decorate([z.subclass("esri.identity.IdentityForm")],
l)})},"esri/identity/IdentityModal":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/handleUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/subclass ../widgets/Widget ../widgets/support/widget ../widgets/support/decorators/messageBundle ../widgets/support/jsxFactory".split(" "),function(y,t,n,l,r,H,z,U,I,V,G,w){function P(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=
Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}));c.push.apply(c,d)}return c}function B(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?P(Object(c),!0).forEach(function(d){var e=c[d];d in a?Object.defineProperty(a,d,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[d]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):P(Object(c)).forEach(function(d){Object.defineProperty(a,
d,Object.getOwnPropertyDescriptor(c,d))})}return a}r='input select textarea a[href] button [tabindex] audio[controls] video[controls] [contenteditable]:not([contenteditable\x3d"false"]) details\x3esummary:first-of-type details'.split(" ");var L=r.join(","),F="undefined"===typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,ca=function(a,b,c){var d=Array.prototype.slice.apply(a.querySelectorAll(L));b&&F.call(a,L)&&d.unshift(a);
return d=d.filter(c)},la=function(a){var b=parseInt(a.getAttribute("tabindex"),10);return isNaN(b)?"true"===a.contentEditable||("AUDIO"===a.nodeName||"VIDEO"===a.nodeName||"DETAILS"===a.nodeName)&&null===a.getAttribute("tabindex")?0:a.tabIndex:b},fa=function(a,b){return a.tabIndex===b.tabIndex?a.documentOrder-b.documentOrder:a.tabIndex-b.tabIndex},da=function(a){return"DETAILS"===a.tagName&&Array.prototype.slice.apply(a.children).some(function(b){return"SUMMARY"===b.tagName})},T=function(a,b){for(var c=
0;c<a.length;c++)if(a[c].checked&&a[c].form===b)return a[c]},ha=function(a){if(!a.name)return!0;var b=a.form||a.ownerDocument,c=function(e){return b.querySelectorAll('input[type\x3d"radio"][name\x3d"'+e+'"]')};if("undefined"!==typeof window&&"undefined"!==typeof window.CSS&&"function"===typeof window.CSS.escape)var d=c(window.CSS.escape(a.name));else try{d=c(a.name)}catch(e){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",
e.message),!1}c=T(d,a.form);return!c||c===a},ia=function(a,b){if("hidden"===getComputedStyle(a).visibility)return!0;var c=F.call(a,"details\x3esummary:first-of-type")?a.parentElement:a;if(F.call(c,"details:not([open]) *"))return!0;if(!b||"full"===b)for(;a;){if("none"===getComputedStyle(a).display)return!0;a=a.parentElement}else if("non-zero-area"===b)return a=a.getBoundingClientRect(),b=a.height,0===a.width&&0===b;return!1},Y=function(a,b){var c;(c=b.disabled)||(c="INPUT"===b.tagName&&"hidden"===
b.type);if(!(a=c||ia(b,a.displayCheck)||da(b)))a:{if("INPUT"===b.tagName||"SELECT"===b.tagName||"TEXTAREA"===b.tagName||"BUTTON"===b.tagName)for(a=b.parentElement;a;){if("FIELDSET"===a.tagName&&a.disabled){for(c=0;c<a.children.length;c++){var d=a.children.item(c);if("LEGEND"===d.tagName){if(d.contains(b)){a=!1;break a}break}}a=!0;break a}a=a.parentElement}a=!1}return a?!1:!0},Z=function(a,b){(a=!Y(a,b))||(a="INPUT"===b.tagName&&"radio"===b.type&&!ha(b));return a||0>la(b)?!1:!0},ja=function(a,b){b=
b||{};var c=[],d=[];ca(a,b.includeContainer,Z.bind(null,b)).forEach(function(e,g){var m=la(e);0===m?c.push(e):d.push({documentOrder:g,tabIndex:m,node:e})});return d.sort(fa).map(function(e){return e.node}).concat(c)},ma=r.concat("iframe").join(","),ka=function(a,b){b=b||{};if(!a)throw Error("No node provided");return!1===F.call(a,ma)?!1:Y(b,a)},ea=function(){var a=[];return{activateTrap:function(b){if(0<a.length){var c=a[a.length-1];c!==b&&c.pause()}c=a.indexOf(b);-1!==c&&a.splice(c,1);a.push(b)},
deactivateTrap:function(b){b=a.indexOf(b);-1!==b&&a.splice(b,1);0<a.length&&a[a.length-1].unpause()}}}(),Q=function(a,b){var c=-1;a.every(function(d,e){return b(d)?(c=e,!1):!0});return c},O=function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return"function"===typeof a?a.apply(void 0,c):a},p=function(a,b){var c=document,d=B({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},b),e=[],g=[],m=null,u=null,f=!1,k=!1,x=void 0,q=function(K,h,A){return K&&
void 0!==K[h]?K[h]:d[A||h]},D=function(K){return e.some(function(h){return h.contains(K)})},C=function(K){var h=d[K];if(!h)return null;var A=h;if("string"===typeof h&&(A=c.querySelector(h),!A))throw Error("`".concat(K,"` refers to no known node"));if("function"===typeof h&&(A=h(),!A))throw Error("`".concat(K,"` did not return a node"));return A},v=function(){if(!1===q({},"initialFocus"))return!1;var K=null!==C("initialFocus")?C("initialFocus"):D(c.activeElement)?c.activeElement:(K=g[0])&&K.firstTabbableNode||
C("fallbackFocus");if(!K)throw Error("Your focus-trap needs to have at least one focusable element");return K},J=function(){g=e.map(function(K){var h=ja(K);if(0<h.length)return{container:K,firstTabbableNode:h[0],lastTabbableNode:h[h.length-1]}}).filter(function(K){return!!K});if(0>=g.length&&!C("fallbackFocus"))throw Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");},R=function A(h){!1!==h&&h!==c.activeElement&&(h&&h.focus?(h.focus({preventScroll:!!d.preventScroll}),
u=h,h.tagName&&"input"===h.tagName.toLowerCase()&&"function"===typeof h.select&&h.select()):A(v()))},M=function(h){var A=C("setReturnFocus");return A?A:h},X=function(h){D(h.target)||(O(d.clickOutsideDeactivates,h)?aa.deactivate({returnFocus:d.returnFocusOnDeactivate&&!ka(h.target)}):O(d.allowOutsideClick,h)||h.preventDefault())},na=function(h){var A=D(h.target);A||h.target instanceof Document?A&&(u=h.target):(h.stopImmediatePropagation(),R(u||v()))},E=function(h){J();var A=null;if(0<g.length){var W=
Q(g,function(ba){return ba.container.contains(h.target)});if(0>W)A=h.shiftKey?g[g.length-1].lastTabbableNode:g[0].firstTabbableNode;else if(h.shiftKey){var N=Q(g,function(ba){return h.target===ba.firstTabbableNode});0>N&&g[W].container===h.target&&(N=W);0<=N&&(A=g[0===N?g.length-1:N-1].lastTabbableNode)}else N=Q(g,function(ba){return h.target===ba.lastTabbableNode}),0>N&&g[W].container===h.target&&(N=W),0<=N&&(A=g[N===g.length-1?0:N+1].firstTabbableNode)}else A=C("fallbackFocus");A&&(h.preventDefault(),
R(A))},S=function(h){"Escape"!==h.key&&"Esc"!==h.key&&27!==h.keyCode||!1===O(d.escapeDeactivates)?"Tab"!==h.key&&9!==h.keyCode||E(h):(h.preventDefault(),aa.deactivate())},oa=function(h){O(d.clickOutsideDeactivates,h)||D(h.target)||O(d.allowOutsideClick,h)||(h.preventDefault(),h.stopImmediatePropagation())},pa=function(){if(f)return ea.activateTrap(aa),x=d.delayInitialFocus?setTimeout(function(){R(v())},0):R(v()),c.addEventListener("focusin",na,!0),c.addEventListener("mousedown",X,{capture:!0,passive:!1}),
c.addEventListener("touchstart",X,{capture:!0,passive:!1}),c.addEventListener("click",oa,{capture:!0,passive:!1}),c.addEventListener("keydown",S,{capture:!0,passive:!1}),aa},qa=function(){if(f)return c.removeEventListener("focusin",na,!0),c.removeEventListener("mousedown",X,!0),c.removeEventListener("touchstart",X,!0),c.removeEventListener("click",oa,!0),c.removeEventListener("keydown",S,!0),aa};var aa={activate:function(h){if(f)return this;var A=q(h,"onActivate"),W=q(h,"onPostActivate"),N=q(h,"checkCanFocusTrap");
N||J();f=!0;k=!1;m=c.activeElement;A&&A();h=function(){N&&J();pa();W&&W()};if(N)return N(e.concat()).then(h,h),this;h();return this},deactivate:function(h){if(!f)return this;clearTimeout(x);x=void 0;qa();k=f=!1;ea.deactivateTrap(aa);var A=q(h,"onDeactivate"),W=q(h,"onPostDeactivate"),N=q(h,"checkCanReturnFocus");A&&A();var ba=q(h,"returnFocus","returnFocusOnDeactivate");h=function(){setTimeout(function(){ba&&R(M(m));W&&W()},0)};if(ba&&N)return N(M(m)).then(h,h),this;h();return this},pause:function(){if(k||
!f)return this;k=!0;qa();return this},unpause:function(){if(!k||!f)return this;k=!1;J();pa();return this},updateContainerElements:function(h){e=[].concat(h).filter(Boolean).map(function(A){return"string"===typeof A?c.querySelector(A):A});f&&J();return this}};aa.updateContainerElements(a);return aa};I=function(a){function b(d,e){var g=a.call(this,d,e)||this;g.container=document.createElement("div");g.content=null;g.open=!1;g._close=()=>{g.open=!1};document.body.appendChild(g.container);g.own(g.watch("open",
()=>g._toggleFocusTrap()));return g}y._inheritsLoose(b,a);var c=b.prototype;c.destroy=function(){this._destroyFocusTrap()};c.render=function(){var d=this.id;const {open:e,content:g,title:m,messages:u}=this;var f=e&&!!g;const k={["esri-identity-modal--open"]:f,["esri-identity-modal--closed"]:!f},x=w.tsx("button",{class:"esri-identity-modal__close-button","aria-label":u.close,title:u.close,bind:this,onclick:this._close},w.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})),q=`${d}_title`;d=
`${d}_content`;const D=m?w.tsx("h1",{id:q,class:"esri-identity-modal__title"},m):null;f=f?w.tsx("div",{bind:this,class:"esri-identity-modal__dialog",role:"dialog","aria-labelledby":q,"aria-describedby":d,afterCreate:this._createFocusTrap},x,D,this._renderContent(d)):null;return w.tsx("div",{tabIndex:-1,class:this.classes("esri-identity-modal",k)},f)};c._destroyFocusTrap=function(){var d;null==(d=this._focusTrap)?void 0:d.deactivate({onDeactivate:null});this._focusTrap=null};c._toggleFocusTrap=function(){const {_focusTrap:d,
open:e}=this;d&&(e?d.activate():d.deactivate())};c._createFocusTrap=function(d){this._destroyFocusTrap();const e=requestAnimationFrame(()=>{this._focusTrap=p(d,{initialFocus:"input",onDeactivate:this._close});this._toggleFocusTrap()});this.own(n.makeHandle(()=>cancelAnimationFrame(e)))};c._renderContent=function(d){const e=this.content;return"string"===typeof e?w.tsx("div",{class:"esri-identity-modal__content",id:d,innerHTML:e}):V.isWidget(e)?w.tsx("div",{class:"esri-identity-modal__content",id:d},
e.render()):e instanceof HTMLElement?w.tsx("div",{class:"esri-identity-modal__content",id:d,bind:e,afterCreate:this._attachToNode}):null};c._attachToNode=function(d){d.appendChild(this)};return b}(I);t.__decorate([l.property({readOnly:!0})],I.prototype,"container",void 0);t.__decorate([l.property()],I.prototype,"content",void 0);t.__decorate([l.property()],I.prototype,"open",void 0);t.__decorate([l.property(),G.messageBundle("esri/t9n/common")],I.prototype,"messages",void 0);t.__decorate([l.property({aliasOf:"messages.auth.signIn"})],
I.prototype,"title",void 0);return I=t.__decorate([U.subclass("esri.identity.IdentityModal")],I)})},"esri/identity/OAuthCredential":function(){define(function(){let y=function(){function t(l,r){this.userId=this.token=this.ssl=this.expires=this.appId=this.storage=this.oAuthInfo=null;this.oAuthInfo=l;this.storage=r;this._init()}var n=t.prototype;n.isValid=function(){let l=!1;if(this.oAuthInfo&&this.token&&this.userId){const r=Date.now();this.expires>r&&(this.expires-r)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&
(l=!0)}return l};n.save=function(){if(this.storage){var l=this._load(),r=this.oAuthInfo;if(r&&r.authNamespace&&r.portalUrl){let H=l[r.authNamespace];H||(H=l[r.authNamespace]={});H[r.portalUrl]={appId:this.appId=r.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(l))}catch(z){console.log(z)}}}};n.destroy=function(){const l=this._load(),r=this.oAuthInfo;if(r&&r.appId&&r.portalUrl&&this.token&&this.expires>Date.now()){var H=
r.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken";const z=new FormData;z.append("f","json");z.append("auth_token",this.token);z.append("client_id",r.appId);z.append("token_type_hint","access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(H,z);else{const U=new XMLHttpRequest;U.open("POST",H);U.send(z)}}if(r&&r.authNamespace&&r.portalUrl&&this.storage&&(H=l[r.authNamespace])){delete H[r.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(l))}catch(z){console.log(z)}}r&&
(this.oAuthInfo=r._oAuthCred=null)};n._init=function(){var l=this._load();const r=this.oAuthInfo;r&&r.authNamespace&&r.portalUrl&&(l=l[r.authNamespace])&&(l=l[r.portalUrl])&&(this.appId=l.appId,this.expires=l.expires,this.ssl=l.ssl,this.token=l.token,this.userId=l.userId)};n._load=function(){let l={};if(this.storage){const r=this.storage.getItem("esriJSAPIOAuth");if(r)try{l=JSON.parse(r)}catch(H){console.log(H)}}return l};return t}();y.prototype.declaredClass="esri.identity.OAuthCredential";return y})},
"esri/identity/OAuthInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/subclass".split(" "),function(y,t,n,l,r,H,z,U){var I;n=I=function(V){function G(w){w=V.call(this,w)||this;w._oAuthCred=null;w.appId=null;w.authNamespace="/";w.expiration=20160;w.forceLogin=!1;w.forceUserId=!1;w.locale=null;w.minTimeUntilExpiration=
30;w.popup=!1;w.popupCallbackUrl="oauth-callback.html";w.popupWindowFeatures="height\x3d490,width\x3d800,resizable,scrollbars,status";w.portalUrl="https://www.arcgis.com";w.preserveUrlHash=!1;w.userId=null;return w}y._inheritsLoose(G,V);G.prototype.clone=function(){return I.fromJSON(this.toJSON())};return G}(n.JSONSupport);t.__decorate([l.property({json:{write:!0}})],n.prototype,"appId",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"authNamespace",void 0);t.__decorate([l.property({json:{write:!0}})],
n.prototype,"expiration",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"forceLogin",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"forceUserId",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"locale",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"minTimeUntilExpiration",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"popup",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"popupCallbackUrl",
void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"popupWindowFeatures",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"portalUrl",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"preserveUrlHash",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"userId",void 0);return n=I=t.__decorate([U.subclass("esri.identity.OAuthInfo")],n)})},"esri/identity/ServerInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/accessorSupport/decorators/subclass".split(" "),
function(y,t,n,l,r,H,z,U){n=function(I){function V(G){G=I.call(this,G)||this;G.adminTokenServiceUrl=null;G.currentVersion=null;G.hasPortal=null;G.hasServer=null;G.owningSystemUrl=null;G.owningTenant=null;G.server=null;G.shortLivedTokenValidity=null;G.tokenServiceUrl=null;G.webTierAuth=null;return G}y._inheritsLoose(V,I);return V}(n.JSONSupport);t.__decorate([l.property({json:{write:!0}})],n.prototype,"adminTokenServiceUrl",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"currentVersion",
void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"hasPortal",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"hasServer",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"owningSystemUrl",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"owningTenant",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"server",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"shortLivedTokenValidity",void 0);t.__decorate([l.property({json:{write:!0}})],
n.prototype,"tokenServiceUrl",void 0);t.__decorate([l.property({json:{write:!0}})],n.prototype,"webTierAuth",void 0);return n=t.__decorate([U.subclass("esri.identity.ServerInfo")],n)})},"*noref":1}});define(["../chunks/_rollupPluginBabelHelpers","../kernel","./IdentityManagerBase"],function(y,t,n){n=function(l){function r(){return l.apply(this,arguments)||this}y._inheritsLoose(r,l);return r}(n.IdentityManagerBase);n.prototype.declaredClass="esri.identity.IdentityManager";n=new n;t.setId(n);return n});