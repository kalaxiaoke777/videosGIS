// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Error ../../core/Handles ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../views/interactive/interactiveToolUtils".split(" "),function(c,l,d,t,u,v,e,m,q,f,A,B,C,w,x){c.InteractiveToolViewModel=function(r){function n(a){var b=
r.call(this,a)||this;b.tool=null;b._baseHandles=new v;b._loggedUnsupportedErrorOnce=!1;b._toolCreationTask=null;a&&null!=a.visible&&(b.visible=a.visible);return b}l._inheritsLoose(n,r);var k=n.prototype;k.initialize=function(){this._baseHandles.add(q.init(this,["view.ready","isSupported"],()=>{this.view&&this.view.ready&&!this.supported&&!this._loggedUnsupportedErrorOnce&&(this.logError(this.unsupportedErrorMessage),this._loggedUnsupportedErrorOnce=!0)}))};k.destroy=function(){this.removeTool();this.view=
null;this._baseHandles=e.destroyMaybe(this._baseHandles)};k.createTool=function(){var a=l._asyncToGenerator(function*(){var b=this;e.isSome(this.tool)&&this.tool.rejectCreation("Tool creation was interrupted by another tool being created.");this.removeTool();if(!this.supported)return Promise.reject(new u("tool:create","The view does not support the tool.",this.unsupportedErrorMessage));this._toolCreationTask=m.createTask(function(){var z=l._asyncToGenerator(function*(p){yield b.view.whenReady();m.throwIfAborted(p,
"Tool creation was interrupted by another tool being created.");var h=b.createToolParams();const y=x.evaluateToolConstructorArguments(h.constructorArguments);h=new h.toolConstructor({visible:b.visible,...y,view:b.view});yield h.whenCreationStarted();m.isAborted(p)&&h.rejectCreation("Tool creation was interrupted by another tool being created.");m.throwIfAborted(p,"Tool creation was interrupted by another tool being created.");return h});return function(p){return z.apply(this,arguments)}}());const g=
yield this._toolCreationTask.promise;this._set("tool",g);this.view.addAndActivateTool(g);q.whenOnce(g,"completed").then(()=>{g.active&&(this.view.activeTool=null)})});return function(){return a.apply(this,arguments)}}();k.removeTool=function(){this._toolCreationTask=e.abortMaybe(this._toolCreationTask);e.isNone(this.tool)||(this.view&&this.view.tools&&this.view.tools.remove(this.tool),this.tool.rejectCreation("Rejecting creation because tool is removed."),this.tool.destroyed||this.tool.destroy(),
this._set("tool",null))};k.logError=function(...a){this.logger.error(...a)};l._createClass(n,[{key:"supported",get:function(){return!this.view||this.view.type===this.supportedViewType}},{key:"view",get:function(){return this._get("view")},set:function(a){a!==this.view&&(this.removeTool(),this._set("view",a),this._baseHandles.remove("tools"),a&&this._baseHandles.add(a.tools.on("change",b=>{if(this.tool)for(const g of b.removed)if(this.tool===g){g.destroyed||g.destroy();this._set("tool",null);break}}),
"tools"))}},{key:"visible",set:function(a){this._set("visible",a);e.isSome(this.tool)&&(this.tool.visible=a);a||(this._toolCreationTask=e.abortMaybe(this._toolCreationTask))}},{key:"active",get:function(){return e.isSome(this._toolCreationTask)||e.isSome(this.tool)&&this.tool.active}},{key:"disabled",get:function(){return!this.view||!this.view.ready||!this.supported}},{key:"creatingTool",get:function(){return e.isSome(this._toolCreationTask)}}]);return n}(t);d.__decorate([f.property({constructOnly:!0})],
c.InteractiveToolViewModel.prototype,"tool",void 0);d.__decorate([f.property()],c.InteractiveToolViewModel.prototype,"supported",null);d.__decorate([f.property({value:null})],c.InteractiveToolViewModel.prototype,"view",null);d.__decorate([f.property({type:Boolean,value:!0})],c.InteractiveToolViewModel.prototype,"visible",null);d.__decorate([f.property()],c.InteractiveToolViewModel.prototype,"active",null);d.__decorate([f.property()],c.InteractiveToolViewModel.prototype,"disabled",null);d.__decorate([f.property()],
c.InteractiveToolViewModel.prototype,"_toolCreationTask",void 0);d.__decorate([f.property({readOnly:!0})],c.InteractiveToolViewModel.prototype,"creatingTool",null);c.InteractiveToolViewModel=d.__decorate([w.subclass("esri.widgets.support.InteractiveToolViewModel")],c.InteractiveToolViewModel);Object.defineProperty(c,"__esModule",{value:!0})});