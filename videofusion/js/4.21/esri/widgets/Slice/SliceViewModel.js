// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/collectionUtils ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../../layers/SliceLayer ../../views/3d/interactive/analysisTools/slice/SliceTool ../support/InteractiveToolViewModel".split(" "),
function(h,f,m,n,q,c,b,r,t,u,v,B,C,g,w,x,y,z){const A=c.getLogger("esri.widgets.Slice.SliceViewModel"),l=new Set;c=function(p){function k(a){a=p.call(this,a)||this;a.layerView=null;a.logger=A;a.supportedViewType="3d";a.unsupportedErrorMessage="SliceViewModel is only supported in 3D views.";a.handles=new q;a.model=new x({listMode:"hide"});a.shape=null;a.tiltEnabled=!1;a.ready=!1;l.add(h._assertThisInitialized(a));return a}h._inheritsLoose(k,p);var e=k.prototype;e.initialize=function(){this.handles.add(this.watch("shape",
(a,d)=>{b.isNone(d)&&b.isSome(a)?b.isNone(this.tool)&&!this.creatingTool&&this.createTool():b.isSome(d)&&b.isNone(a)&&this.removeTool()},!0));this.handles.add(this.watch("tiltEnabled",a=>this._updateToolOrRecreate(d=>d.tiltEnabled=a),!0));this.handles.add(t.react(()=>({view:this.view,ready:b.isSome(this.view)&&this.view.ready}),({view:a})=>{this._disconnectFromView();this._connectToView(a)},{sync:!0}));this._connectToView(this.view)};e.destroy=function(){this._disconnectFromView();l.delete(this);
this.handles=b.destroyMaybe(this.handles)};e.start=function(){var a=h._asyncToGenerator(function*(){this.removeTool();this.ready||(yield u.whenTrueOnce(this,"ready"));l.forEach(d=>{d.view===this.view&&d!==this&&d.clear()});return this.createTool()});return function(){return a.apply(this,arguments)}}();e.clear=function(){this.removeTool();this.excludeGroundSurface=!1;this.excludedLayers=new m};e.removeSliceAndStart=function(){this.removeTool();this.shape=null;return this.start()};e.enterExcludeLayerMode=
function(){b.isSome(this.tool)&&this.tool.enterExcludeLayerMode()};e.exitExcludeLayerMode=function(){b.isSome(this.tool)&&this.tool.exitExcludeLayerMode()};e._updateToolOrRecreate=function(a){b.isSome(this.tool)?a(this.tool):this.creatingTool&&r.ignoreAbortErrors(this.createTool())};e.createToolParams=function(){return{toolConstructor:y,constructorArguments:()=>({tiltEnabled:this.tiltEnabled,analysis:this.model})}};e._connectToView=function(a){!b.isNone(a)&&a.ready&&(a.map.layers.includes(this.model)||
a.map.layers.add(this.model),"3d"===a.type&&a.whenLayerView(this.model).then(d=>{this.destroyed||a!==this.view||(d.layerViewData.excludeGroundSurface=this.excludeGroundSurface,d.layerViewData.excludedLayers=this.excludedLayers,this.layerView=d,this.ready=!0)}))};e._disconnectFromView=function(){this.ready=!1;null!=this.view&&(this.view.map.remove(this.model),this.layerView=null)};h._createClass(k,[{key:"state",get:function(){return this.disabled||!this.ready?"disabled":b.isNone(this.tool)||"pending"===
this.tool.toolState?"ready":this.tool.state}},{key:"excludedLayers",get:function(){return b.isSome(this.layerView)?this.layerView.layerViewData.excludedLayers:this._get("excludedLayers")||new m},set:function(a){this._set("excludedLayers",n.referenceSetter(a,this.excludedLayers));b.isSome(this.layerView)&&(this.layerView.layerViewData.excludedLayers=a)}},{key:"excludeGroundSurface",get:function(){return b.isSome(this.layerView)?this.layerView.layerViewData.excludeGroundSurface:this._get("excludeGroundSurface")||
!1},set:function(a){this._set("excludeGroundSurface",a);b.isSome(this.layerView)&&(this.layerView.layerViewData.excludeGroundSurface=a)}}]);return k}(z.InteractiveToolViewModel);f.__decorate([g.property()],c.prototype,"layerView",void 0);f.__decorate([g.property({readOnly:!0})],c.prototype,"state",null);f.__decorate([g.property()],c.prototype,"model",void 0);f.__decorate([g.property({aliasOf:"model.plane"})],c.prototype,"shape",void 0);f.__decorate([g.property({aliasOf:"model.tiltEnabled"})],c.prototype,
"tiltEnabled",void 0);f.__decorate([v.aliasOf("tool.layersMode")],c.prototype,"layersMode",void 0);f.__decorate([g.property({cast:n.castForReferenceSetter})],c.prototype,"excludedLayers",null);f.__decorate([g.property({nonNullable:!0})],c.prototype,"excludeGroundSurface",null);f.__decorate([g.property()],c.prototype,"ready",void 0);return c=f.__decorate([w.subclass("esri.widgets.slice.SliceViewModel")],c)});