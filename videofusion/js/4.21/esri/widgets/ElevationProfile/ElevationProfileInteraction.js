// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Accessor ../../core/Handles ../../core/handleUtils ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../layers/GraphicsLayer ../../symbols/CIMSymbol ../../symbols/SimpleLineSymbol ../../views/DOMContainer ./support/geometryUtils ../Sketch/SketchViewModel".split(" "),
function(b,w,k,y,z,A,q,d,r,m,l,N,O,P,B,C,D,E,F,x,G){function H(g){return x.isPolyline(g)?(g=g.clone(),g.paths=[g.paths[0].slice(0,-1)],g):g}b.State=void 0;(function(g){g.Ready="ready";g.Creating="creating";g.Reshaping="reshaping";g.ReshapingDisabled="rehsaping-disabled";g.Selecting="selecting";g.Selected="selected"})(b.State||(b.State={}));b.ElevationProfileInteraction=function(g){function t(a){a=g.call(this,a)||this;a.state=b.State.Ready;a._handles=new A;a._pendingStartOptions=null;a._previousInputInfo=
null;a._shouldRemoveLastPoint=!1;a._sketchedGraphics=new WeakSet;a._creationToolPromise=null;a._updateToolPromise=null;a._updateDisabled=!1;return a}w._inheritsLoose(t,g);var e=t.prototype;e.initialize=function(){this._handles.add(m.react(()=>({view:this.tool.viewModel.view,visible:this.tool.visible}),({view:a,visible:c})=>{d.isSome(a)&&c?this._attach(a):this._detach()},m.SYNC_AND_IMMEDIATE),"view")};e.destroy=function(){this._detach();this._handles=d.destroyMaybe(this._handles)};e.start=function(a=
{mode:"sketch"}){if(this.tool.editable){var c=this._view;if(d.isNone(c)||!c.ready)this._pendingStartOptions=a;else switch(this._pendingStartOptions=null,this._stopInteraction(),d.isNone(this._previousInputInfo)&&this._storePreviousInput(this._input),this._setSketchedGraphic(null),a.mode){case "sketch":this._set("state",b.State.Creating);this._startCreationInteraction();break;case "select":this._set("state",b.State.Selecting),this._startSelectionInteraction()}}};e.stop=function(){this._pendingStartOptions=
null;this._stopInteractionAndUpdate();this._clearPreviousInput()};e.cancel=function(){this._pendingStartOptions=null;this._stopInteractionAndUpdate();this._restorePreviousInput()};e.clear=function(){this._stopInteractionAndUpdate();this._set("state",b.State.Ready);this._clearPreviousInput();this._pendingStartOptions=this._input=null};e.isSketchedGraphic=function(a){return d.isSome(a)&&this._sketchedGraphics.has(a)};e._attach=function(a){this._detach();this._graphicsLayer=new C({listMode:"hide",internal:!0,
elevationInfo:{mode:"3d"===a.type?"relative-to-ground":"on-the-ground",offset:null}});var c="2d"===a.type?new D({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[0,0,0,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[255,255,255,
255]}]}}}):new E({color:[0,0,0,0]});this._sketchVM=new G({layer:this._graphicsLayer,view:a,defaultCreateOptions:{mode:"click",hasZ:!1},updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{shapeOperation:"none"},enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:c,updatePolylineSymbol:c,activeLineSymbol:c});this._handles.add([m.reactTruthy(()=>a.ready,()=>d.applySome(this._pendingStartOptions,
f=>this.start(f)),m.SYNC_AND_IMMEDIATE),m.react(()=>[this._input,this._visibleAndEditable],()=>this._update(),m.SYNC_AND_IMMEDIATE),m.react(()=>({map:a.map,graphicsLayer:this._graphicsLayer}),({map:f,graphicsLayer:h})=>{d.isSome(f)&&d.isSome(h)&&f.add(h);this._update()},m.SYNC_AND_IMMEDIATE)],"main")};e._detach=function(){this._handles.remove("main");this._sketchVM=d.destroyMaybe(this._sketchVM);this._updateToolPromise=this._creationToolPromise=null;const a=d.applySome(this._view,f=>f.map),c=this._graphicsLayer;
d.isSome(a)&&d.isSome(c)&&a.remove(c);this._graphicsLayer=d.destroyMaybe(this._graphicsLayer);this._shouldRemoveLastPoint=!1;this._set("state",b.State.Ready)};e._startCreationInteraction=function(){this._stopInteractionAndUpdate();const a=this._sketchVM;if(!d.isNone(this._view)&&!d.isNone(a)){this._shouldRemoveLastPoint=!1;var c=a.on("create",f=>{const h=f.graphic;switch(f.state){case "complete":this._shouldRemoveLastPoint=!1;this._setSketchedGraphic(h);this._stopInteractionAndUpdate();this._clearPreviousInput();
break;case "cancel":this.cancel();break;case "active":this._setSketchedGraphic(h);"cursor-update"===f.toolEventInfo.type&&(this._shouldRemoveLastPoint=!0);break;case "start":this._setSketchedGraphic(h)}});this._handles.remove("interaction");this._handles.add(q.makeHandle(()=>{c.remove();const f=this.canStopCreating,h=d.applySome(this._geometry,n=>n.clone());a.cancel();this._creationToolPromise=null;d.isNone(h)||!f?this._input=null:this._shouldRemoveLastPoint&&this._setSketchedGraphic(new y({geometry:H(h)}))}),
"interaction");this._creationToolPromise=r.ignoreAbortErrors(a.create("polyline"))}};e._startReshapeInteraction=function(){this._stopInteraction();const a=this._sketchVM;if(!d.isNone(this._view)&&!d.isNone(a)){var c=a.on("update",f=>{const h=f.graphics[0];switch(f.state){case "complete":this._setSketchedGraphic(h);this._stopInteractionAndUpdate();this._clearPreviousInput();break;case "active":this._setSketchedGraphic(h);break;case "start":this._setSketchedGraphic(h)}});this._handles.remove("interaction");
this._handles.add(q.makeHandle(()=>{c.remove();a.cancel();this._updateToolPromise=null}),"interaction");d.applySome(this._input,f=>{f.visible=!0;this._updateToolPromise=r.ignoreAbortErrors(a.update(f,{tool:"reshape"}))})}};e._startSelectionInteraction=function(){var a=this;this._stopInteraction();const c=this._view;if(!d.isNone(c)){var f=c.cursor,h=q.makeHandle(()=>c.cursor=f);c.cursor="crosshair";c.popup.close();var n=null,I=q.makeHandle(()=>d.abortMaybe(n)),L=c.on("immediate-click",p=>{p.preventDefault();
p.stopPropagation();d.abortMaybe(n);n=r.createTask(function(){var K=w._asyncToGenerator(function*(u){const {results:J}=yield c.hitTest(p);r.throwIfAborted(u);if(u=J.map(v=>v.graphic).find(v=>d.isSome(v.geometry)&&"polyline"===v.geometry.type))a._input=u,a._clearPreviousInput(),a._stopInteractionAndUpdate()});return function(u){return K.apply(this,arguments)}}())}),M=c.on("key-down",p=>{"Escape"===p.key&&this.cancel()});this._handles.remove("interaction");this._handles.add([L,M,I,h],"interaction");
c.ready&&F.isDOMContainer(c)&&c.focus()}};e._stopInteraction=function(){this._handles.remove("interaction")};e._stopInteractionAndUpdate=function(){this._handles.has("interaction")&&(this._updateDisabled=!0,this._stopInteraction(),this._updateDisabled=!1,this._triggerUpdate())};e._triggerUpdate=function(){this._set("state",b.State.Ready);this._update()};e._update=function(){if(!this._updateDisabled){var a=this.state;if(a===b.State.Selecting)this.stop();else{if(this._visibleAndEditable){if(a===b.State.Creating||
a===b.State.Reshaping&&this.isSketchedGraphic(this._input))return}else this.cancel();this._set("state",this._getNextState());this._updateVisuals()}}};e._getNextState=function(){return d.isNone(this._input)?b.State.Ready:this.isSketchedGraphic(this._input)?this.state===b.State.Creating?b.State.Creating:this._visibleAndEditable?b.State.Reshaping:b.State.ReshapingDisabled:b.State.Selected};e._updateVisuals=function(){switch(this.state){case b.State.Reshaping:this._startReshapeInteraction();break;case b.State.ReshapingDisabled:{this._stopInteractionAndUpdate();
const a=this._input;d.isSome(a)&&this.isSketchedGraphic(a)&&(a.visible=!1);break}case b.State.Ready:case b.State.Selected:this._stopInteractionAndUpdate()}this._updateSketchedGraphic()};e._storePreviousInput=function(a){this._previousInputInfo={graphic:a}};e._restorePreviousInput=function(){const a=this._previousInputInfo;d.isNone(a)||(this._clearPreviousInput(),this._input=a.graphic,this._triggerUpdate())};e._clearPreviousInput=function(){this._previousInputInfo=null};e._updateSketchedGraphic=function(){var a=
this._graphicsLayer;if(!d.isNone(a)){a=a.graphics;var c=this._input;if(d.isNone(c)||!this.isSketchedGraphic(c))a.removeAll();else if(-1!==a.indexOf(c)){if(1!==a.length){const f=a.filter(h=>h!==c);a.removeMany(f)}}else a.removeAll(),a.add(c)}};e._setSketchedGraphic=function(a){d.isSome(a)&&this._sketchedGraphics.add(a);this._input=a;this._updateSketchedGraphic()};w._createClass(t,[{key:"canStopCreating",get:function(){const a=this._geometry,c=this._shouldRemoveLastPoint?3:2;return x.isPolyline(a)&&
0<a.paths.length&&a.paths[0].length>=c}},{key:"_input",get:function(){return this.tool.viewModel.input},set:function(a){this.tool.viewModel.input=a}},{key:"_geometry",get:function(){return d.applySome(this._input,a=>a.geometry)}},{key:"_visibleAndEditable",get:function(){return this.tool.visible&&this.tool.editable}},{key:"_view",get:function(){return this.tool.viewModel.view}},{key:"test",get:function(){return{sketchVM:this._sketchVM,toolPromise:Promise.all([d.unwrapOr(this._creationToolPromise,
Promise.resolve()),d.unwrapOr(this._updateToolPromise,Promise.resolve())])}}}]);return t}(z);k.__decorate([l.property({nonNullable:!0})],b.ElevationProfileInteraction.prototype,"state",void 0);k.__decorate([l.property({nonNullable:!0})],b.ElevationProfileInteraction.prototype,"tool",void 0);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"canStopCreating",null);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_graphicsLayer",void 0);k.__decorate([l.property()],
b.ElevationProfileInteraction.prototype,"_sketchVM",void 0);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_input",null);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_geometry",null);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_visibleAndEditable",null);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_view",null);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_shouldRemoveLastPoint",void 0);
b.ElevationProfileInteraction=k.__decorate([B.subclass("esri.widgets.ElevationProfile.ElevationProfileInteraction")],b.ElevationProfileInteraction);Object.defineProperty(b,"__esModule",{value:!0})});