// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../intl/date ../../intl/number ../../layers/support/CodedValueDomain ../../layers/support/fieldUtils ../FeatureForm/InputField ./Grid/EditorColumn ../support/DatePicker ../support/TimePicker ../support/widgetUtils".split(" "),function(u,h,k,g,P,Q,E,x,A,F,v,G,H,I,
J,B){const K=x.convertDateFormatToIntlOptions("short-date-short-time"),L=x.convertDateFormatToIntlOptions("short-date"),M=A.convertNumberFormatToIntlOptions({digitSeparator:!0,places:null});g=function(C){function y(b){var a=C.call(this,b)||this;a._inputField=null;a.alias=null;a.cellValueFormatFunction=({rowData:c,value:d})=>{if(a.formatFunction){const {config:n,field:q}=u._assertThisInitialized(a);return a.formatFunction({config:n,field:q,value:B.renderingSanitizer.sanitize(d)})}if(null===d)return"\x26nbsp;";
const {config:f,field:e,type:m}=u._assertThisInitialized(a);({item:{feature:c}}=c);if(c=a._getDomainForFeature(c))return a._getComputedDomain(d,c);if("date"===m){var l;c=null!=f&&null!=(l=f.format)&&l.dateFormat?x.convertDateFormatToIntlOptions(f.format.dateFormat):!1===(null==f?void 0:f.includeTime)?L:K;l=a.layer;l="feature"===(null==l?void 0:l.type)&&a.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null;return d?x.formatDate(d,{...c,...l}):null}return v.isNumericField(e)?(l=null!=f&&f.format?A.convertNumberFormatToIntlOptions(f.format):
M,A.formatNumber(parseFloat(d),l)):B.renderingSanitizer.sanitize(d)};a.cellValueValidatorFunction=({oldValue:c,value:d})=>c!==d;a.config=null;a.defaultValue=null;a.description=null;a.editingEnabled=!1;a.field=null;a.formatFunction=null;a.headerRenderFunction=c=>{const {root:d}=c,{editable:f,editingEnabled:e,headerMenuEnabled:m,sortable:l}=u._assertThisInitialized(a);a.removeCellContent(d);d.classList.add("esri-field-column__header-content");e&&!f&&d.appendChild(a.createLockedElement());if(l)a.headerSorterRenderFunction(c);
else{const {header:n,path:q}=u._assertThisInitialized(a),w=document.createElement("div");w.innerHTML=n||q;d.appendChild(w)}m&&a.headerMenuRenderFunction(c)};a.inputRenderFunction=({root:c,column:d,rowData:f})=>{var e,m;if((null==(e=a.activeEditInfo)||!e.updating)&&a.editable){var l=a.getCellValue(d,f);e=a.createInputElement({root:c,column:d,rowData:f,value:l});a._set("activeEditInfo",{column:d,input:e,root:c,rowData:f,updating:!0,oldValue:l});"date"===a.type?a._renderDateEditors(l,c,e):(d=a.createInputContainer(),
d.appendChild(e),a.removeCellContent(c),c.appendChild(d),e.focus(),e instanceof HTMLInputElement&&e.select(),null==(m=a.grid)?void 0:m.notifyResize())}};a.layer=null;a.menuConfig=null;a.name=null;a.nullable=!0;a.parseInputValueFunction=({input:c})=>{c=c.value;const {required:d,type:f}=a._inputField;return d||""!==c?"number"===f||"date"===f?parseFloat(c):c:null};a.type=null;a.updateRowItemFunction=({rowData:c,column:d,value:f})=>{c.item.feature.attributes[d.path]=f};return a}u._inheritsLoose(y,C);
var p=y.prototype;p.createInputElement=function({rowData:b,value:a}){({item:b}=b);if(!b||!b.feature)return null;this._inputField=this._setUpInputField(b.feature,a);const {field:c,maxLength:d,required:f}=this;({domain:b}=this._inputField);let e=null;"coded-value"===(null==b?void 0:b.type)?(e=this._createSelectElement(a,b.codedValues.map(({code:n,name:q})=>({value:n,name:q})),this._inputField),e.onchange=()=>{e.onblur=null;l()}):(e=document.createElement("input"),e.type=v.isNumericField(c)?"number":
"text",-1<d&&(e.maxLength=d));e.classList.add("esri-field-column__cell-input");e.value=a;e.required=f;let m=!1;e.onkeydown=n=>{m="Escape"===n.key};e.onblur=()=>{e.onblur=null;l()};const l=()=>{m?this.cancel():this.submit();this._inputField=null};return e};p.createInputContainer=function(){const b=document.createElement("div");b.classList.add("esri-field-column__cell__input-container");return b};p.createLockedElement=function(){const b=document.createElement("div");b.classList.add("esri-icon-locked");
return b};p.getCellValue=function({path:b},{item:a}){var c,d,f;return null!=(c=null==a?void 0:null==(d=a.feature)?void 0:null==(f=d.attributes)?void 0:f[b])?c:null};p._renderDateEditors=function(b,a,c){var d;const {config:f,messagesCommon:e}=this;var m=b?new Date(b):new Date(Date.now());const l=new I({dateInputEnabled:!0,value:m}),n=new J({value:m});c.value=m.getTime().toString();let q=!b;const w=()=>{q=!0;const t=this._getCombinedDateTime(l.value,n.value);c.value=t.getTime().toString()},N=()=>{q?
this.submit():this.cancel()},O=()=>{c.value=null;this.submit()};l.watch("value",()=>w());n.watch("value",()=>w());var r=document.createElement("div");const D=document.createElement("div");l.container=r;n.container=D;b=document.createElement("button");b.classList.add("esri-field-column__button","esri-icon-save");b.onclick=()=>N();b.title=null==e?void 0:e.save;m=document.createElement("button");m.classList.add("esri-field-column__button","esri-icon-trash");m.onclick=()=>O();m.title=null==e?void 0:e.clear;
const z=document.createElement("div");z.classList.add("esri-field-column__cell__date-input-wrapper");z.appendChild(r);!1!==f.includeTime&&z.appendChild(D);r=document.createElement("div");r.classList.add("esri-field-column__cell__date-input-container");r.appendChild(z);r.appendChild(b);r.appendChild(m);l.when(()=>{var t;return null==(t=this.grid)?void 0:t.notifyResize()});n.when(()=>{var t;return null==(t=this.grid)?void 0:t.notifyResize()});this.removeCellContent(a);a.appendChild(r);null==(d=this.grid)?
void 0:d.notifyResize()};p._createSelectElement=function(b,a,c){let d=!1;a=a.map(e=>{e.value===b&&(d=!0);const m=document.createElement("option");m.text=e.name;m.value=e.value;return m});if(null!=b&&""!==b&&!d){const e=document.createElement("option");e.text=b;e.value=b;a.unshift(e)}c.required||null!=c.value||(c=document.createElement("option"),c.value="",a.unshift(c));const f=document.createElement("select");a.forEach(e=>f.add(e));f.value=b;return f};p._setUpInputField=function(b,a){const {config:c,
field:d,layer:f}=this;b=new G({config:c,feature:b,field:d,layer:f,group:null,messages:null});b.set("value",a);return b};p._isDomainCompatible=function(b){const {field:a}=this;if(b&&"coded-value"===b.type){const c=typeof b.codedValues[0].code;if("string"===c&&v.isStringField(a)||"number"===c&&v.isNumericField(a))return!0}return b&&"range"===b.type&&v.isNumericField(a)?!0:!1};p._getDomainForFeature=function(b){const {layer:a,name:c}=this;if("wfs"===a.type||"geojson"===a.type)return null;var {typeIdField:d}=
a;const f=d===c,e=this.get("field.domain");if(f&&!e)return new F({name:"__internal-type-based-coded-value-domain__",codedValues:a.types.map(({id:m,name:l})=>({code:m,name:l}))});b=d&&a.getFieldDomain(c,{feature:b})||e;d=this.get("config.domain");return this._isDomainCompatible(d)?d:b};p._getComputedDomain=function(b,a){return a?"range"===a.type?b:"coded-value"===a.type?(a=a.codedValues.filter(c=>c.hasOwnProperty("code")&&c.code===b))&&a.length?a[0].name:b:null:null};p._getCombinedDateTime=function(b,
a){return new Date(b.getFullYear(),b.getMonth(),b.getDate(),a.getHours(),a.getMinutes(),a.getSeconds())};u._createClass(y,[{key:"editable",get:function(){var b;if(this.editingEnabled){var a,c;return this.config?!1===this.config.editable?!1:null==(a=this.field)?void 0:a.editable:null==(c=this.field)?void 0:c.editable}return this.config?!0===this.config.editable&&(null==(b=this.field)?void 0:b.editable):!1}},{key:"header",get:function(){var b;return(null==(b=this.config)?void 0:b.label)||this.alias||
this.path||null}},{key:"hidden",get:function(){const {config:b}=this;return!1===(null==b?void 0:b.visible)||this._get("hidden")||!1},set:function(b){this._set("hidden",b)}},{key:"loadingMessage",get:function(){var b;return(null==(b=this.messages)?void 0:b.loading)||"..."}},{key:"maxLength",get:function(){var b,a;const c=null==(b=this.field)?void 0:b.length;b=null==(a=this.config)?void 0:a.maxLength;return!isNaN(b)&&-1<=b&&(-1===c||b<=c)?b:c}},{key:"path",get:function(){var b;return(null==(b=this.field)?
void 0:b.name)||null}},{key:"required",get:function(){const b=this.get("field.nullable"),a=this.get("config.required");return this.editable&&(!b||!0===a)}},{key:"sortable",get:function(){var b;return!1!==(null==(b=this.config)?void 0:b.sortable)}}]);return y}(H);h.__decorate([k.property({readOnly:!0,aliasOf:"field.alias"})],g.prototype,"alias",void 0);h.__decorate([k.property()],g.prototype,"cellValueFormatFunction",void 0);h.__decorate([k.property()],g.prototype,"cellValueValidatorFunction",void 0);
h.__decorate([k.property()],g.prototype,"config",void 0);h.__decorate([k.property({readOnly:!0,aliasOf:"field.defaultValue"})],g.prototype,"defaultValue",void 0);h.__decorate([k.property({readOnly:!0,aliasOf:"field.description"})],g.prototype,"description",void 0);h.__decorate([k.property({readOnly:!0})],g.prototype,"editable",null);h.__decorate([k.property()],g.prototype,"editingEnabled",void 0);h.__decorate([k.property()],g.prototype,"field",void 0);h.__decorate([k.property()],g.prototype,"formatFunction",
void 0);h.__decorate([k.property({readOnly:!0})],g.prototype,"header",null);h.__decorate([k.property()],g.prototype,"hidden",null);h.__decorate([k.property()],g.prototype,"headerRenderFunction",void 0);h.__decorate([k.property()],g.prototype,"inputRenderFunction",void 0);h.__decorate([k.property()],g.prototype,"layer",void 0);h.__decorate([k.property({readOnly:!0})],g.prototype,"loadingMessage",null);h.__decorate([k.property()],g.prototype,"maxLength",null);h.__decorate([k.property({readOnly:!0,aliasOf:"config.menuConfig"})],
g.prototype,"menuConfig",void 0);h.__decorate([k.property({readOnly:!0,aliasOf:"field.name"})],g.prototype,"name",void 0);h.__decorate([k.property({readOnly:!0,aliasOf:"field.nullable"})],g.prototype,"nullable",void 0);h.__decorate([k.property()],g.prototype,"parseInputValueFunction",void 0);h.__decorate([k.property({readOnly:!0})],g.prototype,"path",null);h.__decorate([k.property({readOnly:!0})],g.prototype,"required",null);h.__decorate([k.property()],g.prototype,"sortable",null);h.__decorate([k.property({readOnly:!0,
aliasOf:"field.type"})],g.prototype,"type",void 0);h.__decorate([k.property()],g.prototype,"updateRowItemFunction",void 0);return g=h.__decorate([E.subclass("esri.widgets.FeatureTable.FieldColumn")],g)});