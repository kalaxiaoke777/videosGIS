// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/Accessor ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/coordinateFormatter ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ./coordinateConversionUtils ../../../geometry/SpatialReference".split(" "),
function(t,g,f,w,p,x,k,B,C,D,y,l,u,z,A,h,q){f=function(v){function n(a){a=v.call(this,a)||this;a.conversionInfo=null;a.coordinateSegments=null;a.defaultPattern=null;a.name=null;a.viewModel=null;return a}t._inheritsLoose(n,v);var m=n.prototype;m.convert=function(a,b){if(!h.isValidPoint(a))return Promise.reject(new p("format:invalid-point","Could not convert invalid point.",{point:a}));const d=this.get("conversionInfo.convert");return d?Promise.resolve().then(()=>d(a)):this._project(a,this.spatialReference,
b).then(e=>this._getCoordinate(e).then(c=>({location:e,coordinate:c})))};m.getConversionStrategy=function(){const a=this._viewSpatialReference;return this.get("conversionInfo.convert")||this.get("viewModel.formatterAvailable")||"xy"===this.name&&(a.isWebMercator||a.isWGS84)||"basemap"===this.name?"client":"server"};m.getDisplayCoordinate=function(a){if(!a)return null;if(!this.coordinateSegments||!this.currentPattern)return a;let b=this.currentPattern;a=this._getSegmentMatches(a,!1);for(let d=this.coordinateSegments.length-
1;0<=d;d--)b=b.replace(this.coordinateSegments[d].alias,a[d]);return b};m.parseUserInput=function(a){let b=this.defaultPattern.replace(this._additionalCharactersPattern,"");a=a.replace(this._additionalCharactersPattern,"");a=this._getSegmentMatches(a,!0);for(let d=this.coordinateSegments.length-1;0<=d;d--)b=b.replace(this.coordinateSegments[d].alias,a[d]);return b};m._getSegmentMatches=function(a,b){const d=[];for(let r=0;r<this.coordinateSegments.length;r++){var e=this.coordinateSegments[r],c=a.match(e.searchPattern);
c?(c=c[0],a=a.replace(c,"").trim(),e.substitution&&(e=b?e.substitution.input(c):e.substitution.output(c))&&(c=e),d.push(c)):d.push("")}return d};m.reverseConvert=function(a){const b=this.parseUserInput(a),d=this.get("conversionInfo.reverseConvert"),e=h.isSupportedNotation(this.name);let c;if(d)c=d(b);else if("xy"===this.name||"basemap"===this.name)c=h.fromXY(b,this.spatialReference);else if(this.viewModel.formatterAvailable)switch(this.name){case "dd":case "ddm":case "dms":c=l.fromLatitudeLongitude(b,
this.spatialReference);break;case "mgrs":c=l.fromMgrs(b,this.spatialReference,"automatic");break;case "utm":c=l.fromUtm(b,this.spatialReference,"latitude-band-indicators");break;case "usng":c=l.fromUsng(b,this.spatialReference);break;default:c=null}else if(e)return h.fromGeoCoordinateString({coordinate:b,spatialReference:this.spatialReference,formatName:this.name,geometryServicePromise:this.get("viewModel.geometryServicePromise")});return c?this._project(c,this._viewSpatialReference):Promise.reject(new p("format:invalid-input",
"Could not parse input into point.",{userInput:a}))};m._getCoordinate=function(a){var b=this.get("viewModel.view.scale");if(!h.isValidPoint(a))return Promise.reject(new p("format:invalid-point","Could not transform invalid point into coordinate.",{point:a}));if(this.get("viewModel.formatterAvailable")||"basemap"===this.name||"xy"===this.name)switch(this.name){case "dd":case "ddm":case "dms":return b=h.getDegreePrecision(b),Promise.resolve(l.toLatitudeLongitude(a,this.name,b));case "mgrs":return Promise.resolve(l.toMgrs(a,
"automatic",5,!1));case "usng":return Promise.resolve(l.toUsng(a,5,!1));case "utm":return Promise.resolve(l.toUtm(a,"latitude-band-indicators",!0));default:return Promise.resolve(h.pointToCoordinate(a,b))}return h.isSupportedNotation(this.name)?h.toGeoCoordinateString({formatName:this.name,location:a,geometryServicePromise:this.get("viewModel.geometryServicePromise")}):Promise.resolve(h.pointToCoordinate(a,b))};m._project=function(a,b,d){if(z.equals(a.spatialReference,b)||!b)return Promise.resolve(a);
if(this.get("viewModel.formatterAvailable")&&u.isLoaded())return Promise.resolve(u.project(a,b));if(!this.get("viewModel.formatterAvailable")){const e=A.project(a,b);return x.isSome(e)?Promise.resolve(e):h.project({location:a,spatialReference:b,geometryServicePromise:this.get("viewModel.geometryServicePromise"),scale:this.get("viewModel.view.scale")},d).then(c=>c.location)}return null};t._createClass(n,[{key:"currentPattern",get:function(){return this._get("currentPattern")||this._get("defaultPattern")},
set:function(a){this._set("currentPattern",a)}},{key:"hasDisplayProperties",get:function(){return!(!this.defaultPattern||!this.coordinateSegments)}},{key:"spatialReference",get:function(){const a=this.get("conversionInfo.spatialReference")||q.WGS84;return"basemap"===this.name?this._viewSpatialReference:a},set:function(a){void 0===a&&this._clearOverride("spatialReference");this._override("spatialReference",a)}},{key:"_viewSpatialReference",get:function(){return this.get("viewModel.view.spatialReference")||
q.WGS84}},{key:"_additionalCharactersPattern",get:function(){var a=this.get("coordinateSegments");if(!a)return null;a=a.map(b=>b.alias);a=this.currentPattern.replace(new RegExp(`["nsew${a.join()}]`,"gi"),"").replace(/ /g,"");return new RegExp(`[${a}]`,"g")}}]);return n}(w);g.__decorate([k.property()],f.prototype,"conversionInfo",void 0);g.__decorate([k.property()],f.prototype,"coordinateSegments",void 0);g.__decorate([k.property()],f.prototype,"currentPattern",null);g.__decorate([k.property()],f.prototype,
"defaultPattern",void 0);g.__decorate([k.property({readOnly:!0})],f.prototype,"hasDisplayProperties",null);g.__decorate([k.property()],f.prototype,"name",void 0);g.__decorate([k.property({type:q})],f.prototype,"spatialReference",null);g.__decorate([k.property()],f.prototype,"viewModel",void 0);g.__decorate([k.property({readOnly:!0})],f.prototype,"_viewSpatialReference",null);g.__decorate([k.property({readOnly:!0})],f.prototype,"_additionalCharactersPattern",null);return f=g.__decorate([y.subclass("esri.widgets.CoordinateConversion.support.Format")],
f)});