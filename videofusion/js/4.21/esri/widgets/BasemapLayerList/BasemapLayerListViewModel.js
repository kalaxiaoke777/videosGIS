// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/Evented ../../core/HandleOwner ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../LayerList/ListItem".split(" "),function(k,h,f,y,z,n,l,m,D,E,F,A,u){const p=f.ofType(u);f=function(v){function q(b){var a=v.call(this,b)||this;a.baseItems=
new p;a.baseListItemCreatedFunction=null;a.referenceListItemCreatedFunction=null;a.referenceItems=new p;a.view=null;a._callReferenceListItemsCreatedDebounced=n.debounce(function(){var c=k._asyncToGenerator(function*(d){return a._callListItemsCreated({items:d,type:"reference"})});return function(d){return c.apply(this,arguments)}}(),300);a._callBaseListItemsCreatedDebounced=n.debounce(function(){var c=k._asyncToGenerator(function*(d){return a._callListItemsCreated({items:d,type:"base"})});return function(d){return c.apply(this,
arguments)}}(),300);a._compileBaseList=a._compileBaseList.bind(k._assertThisInitialized(a));a._compileReferenceList=a._compileReferenceList.bind(k._assertThisInitialized(a));return a}k._inheritsLoose(q,v);var e=q.prototype;e.initialize=function(){this.handles.add(l.init(this,["view.map.basemap","view","view.ready","view.basemapView"],()=>this._watchBasemapLayers()),"view")};e.destroy=function(){this.view=null;this.baseItems.removeAll();this.referenceItems.removeAll()};e.triggerAction=function(b,a){b&&
!b.disabled&&this.emit("trigger-action",{action:b,item:a})};e.transferListItem=function({listItem:b,from:a,to:c,newIndex:d}){const {referenceItems:g,baseItems:w}=this,{layer:x}=b,r=this.get("view.map.basemap.baseLayers"),t=this.get("view.map.basemap.referenceLayers");if(r&&t&&a!==c){var B="reference"===c?g:w,C="reference"===a?t:r;c="reference"===c?t:r;("reference"===a?g:w).remove(b);C.remove(x);B.add(b,d);c.add(x,d)}};e._createItemChangeHandles=function({items:b,key:a,callback:c}){const {handles:d}=
this;d.remove(a);c();b&&d.add(b.on("change",()=>c()),a)};e._watchItemProperties=function({item:b,type:a}){this.handles.add([b.children.on("change",()=>{this._callListItemCreatedChildren({type:a,childItems:b.children})})],`children-change-${b.uid}`)};e._callListItemCreatedChildren=function({childItems:b,type:a}){b.forEach(c=>this._callListItemCreated({type:a,item:c}))};e._callListItemCreated=function({item:b,type:a}){const c={item:b};"base"===a&&"function"===typeof this.baseListItemCreatedFunction&&
this.baseListItemCreatedFunction.call(null,c);"reference"===a&&"function"===typeof this.referenceListItemCreatedFunction&&this.referenceListItemCreatedFunction.call(null,c);this._callListItemCreatedChildren({type:a,childItems:b.children})};e._createListItem=function({layer:b,type:a}){const {view:c}=this;b=new u({layer:b,view:c});this._watchItemProperties({type:a,item:b});return b};e._watchLayersListMode=function({layers:b,key:a,callback:c}){const {handles:d}=this;d.remove(a);b&&b.forEach(g=>{d.add(l.watch(g,
"listMode",()=>c()),a)})};e._compileListItems=function({layers:b,items:a,key:c,type:d,callback:g}){this._watchLayersListMode({layers:b,key:c,callback:g});this._createNewItems({type:d,items:a,layers:b});this._removeItems({items:a,layers:b});this._sortItems(a,b);this._beforeCallListItemsCreated({items:a,type:d})};e._beforeCallListItemsCreated=function(){var b=k._asyncToGenerator(function*({items:a,type:c}){return"reference"===c?this._callReferenceListItemsCreatedDebounced(a).catch(n.throwIfNotAbortError):
"base"===c?this._callBaseListItemsCreatedDebounced(a).catch(n.throwIfNotAbortError):null});return function(a){return b.apply(this,arguments)}}();e._callListItemsCreated=function(){var b=k._asyncToGenerator(function*({items:a,type:c}){var d;yield null==(d=this.view)?void 0:d.when();a.forEach(g=>this._callListItemCreated({type:c,item:g}))});return function(a){return b.apply(this,arguments)}}();e._compileReferenceList=function(){const {referenceItems:b}=this,a=this.get("view.map.basemap.referenceLayers");
this._compileListItems({type:"reference",layers:a,items:b,key:"base-layers-list-mode",callback:this._compileReferenceList})};e._compileBaseList=function(){const {baseItems:b}=this,a=this.get("view.map.basemap.baseLayers");this._compileListItems({type:"base",layers:a,items:b,key:"reference-layers-list-mode",callback:this._compileBaseList})};e._compileLists=function(){this._compileReferenceList();this._compileBaseList()};e._createNewItems=function({items:b,layers:a,type:c}){a&&a.forEach(d=>{b.find(g=>
g.layer===d)||b.add(this._createListItem({type:c,layer:d}))})};e._removeItems=function({items:b,layers:a}){const {handles:c}=this;b&&b.forEach(d=>{!d||a&&a.find(g=>d.layer===g)||(c.remove(`children-change-${d.uid}`),b.remove(d))})};e._sortItems=function(b,a){b&&b.sort((c,d)=>{c=a.indexOf(c.layer);d=a.indexOf(d.layer);return c>d?-1:c<d?1:0})};e._watchBasemapLayers=function(){const {handles:b,view:a}=this;b.remove(["base-layers","reference-layers","basemap","base-layer-views","reference-layer-views"]);
this._compileLists();a&&a.ready&&b.add([l.init(this,"view.map.basemap.baseLayers",c=>this._createItemChangeHandles({items:c,key:"base-layers",callback:this._compileBaseList})),l.init(this,"view.map.basemap.referenceLayers",c=>this._createItemChangeHandles({items:c,key:"reference-layers",callback:this._compileReferenceList})),l.init(this,"view.basemapView.baseLayerViews",c=>this._createItemChangeHandles({items:c,key:"base-layer-views",callback:this._compileBaseList})),l.init(this,"view.basemapView.referenceLayerViews",
c=>this._createItemChangeHandles({items:c,key:"reference-layer-views",callback:this._compileReferenceList})),l.init(this,"baseListItemCreatedFunction",()=>this._compileBaseList()),l.init(this,"referenceListItemCreatedFunction",()=>this._compileReferenceList())],"basemap")};k._createClass(q,[{key:"basemapTitle",get:function(){return this.get("view.map.basemap.title")||null},set:function(b){void 0===b?this._clearOverride("basemapTitle"):this._override("basemapTitle",b)}},{key:"state",get:function(){return this.get("view.ready")?
"ready":this.get("view")?"loading":"disabled"}}]);return q}(z.HandleOwnerMixin(y.EventedAccessor));h.__decorate([m.property({type:p})],f.prototype,"baseItems",void 0);h.__decorate([m.property()],f.prototype,"basemapTitle",null);h.__decorate([m.property()],f.prototype,"baseListItemCreatedFunction",void 0);h.__decorate([m.property()],f.prototype,"referenceListItemCreatedFunction",void 0);h.__decorate([m.property({type:p})],f.prototype,"referenceItems",void 0);h.__decorate([m.property({readOnly:!0})],
f.prototype,"state",null);h.__decorate([m.property()],f.prototype,"view",void 0);h.__decorate([m.property()],f.prototype,"transferListItem",null);return f=h.__decorate([A.subclass("esri.widgets.BasemapLayerList.BasemapLayerListViewModel")],f)});