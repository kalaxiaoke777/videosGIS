// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.21/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/Evented ../../core/Handles ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ./ListItem ./support/layerListUtils".split(" "),function(l,m,h,y,z,u,n,q,B,C,D,A,v,t){const w=h.ofType(v);h=function(x){function r(a){var b=x.call(this,a)||this;
b._handles=new z;b.listItemCreatedFunction=null;b.operationalItems=new w;b.view=null;b._callListItemsCreatedDebounced=u.debounce(l._asyncToGenerator(function*(){return b._callListItemsCreated()}),300);return b}l._inheritsLoose(r,x);var d=r.prototype;d.initialize=function(){this._handles.add(n.init(this,["view","view.ready"],()=>this._viewHandles()),"view")};d.destroy=function(){this._handles.destroy();this.view=this._handles=null;this.operationalItems.removeAll()};d.triggerAction=function(a,b){a&&
!a.disabled&&this.emit("trigger-action",{action:a,item:b})};d.moveListItem=function(a,b,c,e){var f,g;const p=null==a?void 0:a.layer;if(p){var k=null==(f=this.view)?void 0:null==(g=f.map)?void 0:g.layers;f=b?t.getItemLayers(b):k;k=c?t.getItemLayers(c):k;f&&k&&({operationalItems:g}=this,b=(null==b?void 0:b.children)||g,g=(null==c?void 0:c.children)||g,e=k.length-e,a.parent=c||null,b.includes(a)&&b.remove(a),f.includes(p)&&f.remove(p),g.includes(a)||g.add(a,e),k.includes(p)||k.add(p,e))}};d._createLayerViewHandles=
function(a){const {_handles:b}=this;b.remove("layer-views");this._compileList();a&&b.add(a.on("change",()=>this._compileList()),"layer-views")};d._createMapLayerHandles=function(a){const {_handles:b}=this;b.remove("map-layers");this._compileList();a&&b.add(a.on("change",()=>this._compileList()),"map-layers")};d._watchItemProperties=function(a){this._handles.add([a.children.on("change",()=>{this._callListItemCreatedChildren(a.children)})],`children-change-${a.uid}`)};d._callListItemCreatedChildren=
function(a){a.forEach(b=>this._callListItemCreated(b))};d._callListItemCreated=function(a){"function"===typeof this.listItemCreatedFunction&&this.listItemCreatedFunction.call(null,{item:a});this._callListItemCreatedChildren(a.children)};d._createListItem=function(a){const {view:b}=this;a=new v({layer:a,view:b});this._watchItemProperties(a);return a};d._removeAllItems=function(){const {_handles:a,operationalItems:b}=this;b.forEach(c=>{a.remove(`children-change-${c.uid}`)});b.removeAll()};d._getViewableLayers=
function(a){if(a)return a.filter(b=>"hide"!==t.findLayerListMode(b))};d._watchLayersListMode=function(a){const {_handles:b}=this;b.remove("layer-list-mode");a&&a.forEach(c=>{b.add(n.watch(c,"listMode",()=>this._compileList()),"layer-list-mode")})};d._compileList=function(){var a=this.get("view.map.layers");this._watchLayersListMode(a);(a=this._getViewableLayers(a))&&a.length?(this._createNewItems(a),this._removeItems(a),this._sortItems(a),this._beforeCallListItemsCreated()):this._removeAllItems()};
d._beforeCallListItemsCreated=function(){var a=l._asyncToGenerator(function*(){return this._callListItemsCreatedDebounced().catch(u.throwIfNotAbortError)});return function(){return a.apply(this,arguments)}}();d._callListItemsCreated=function(){var a=l._asyncToGenerator(function*(){var b;yield null==(b=this.view)?void 0:b.when();this.operationalItems.forEach(c=>this._callListItemCreated(c))});return function(){return a.apply(this,arguments)}}();d._createNewItems=function(a){const {operationalItems:b}=
this;a.forEach(c=>{b.find(e=>e.layer===c)||b.add(this._createListItem(c))})};d._removeItems=function(a){const {_handles:b,operationalItems:c}=this,e=[];c.forEach(f=>{f&&a&&a.find(g=>f.layer===g)||(b.remove(`children-change-${f.uid}`),e.push(f))});c.removeMany(e)};d._sortItems=function(a){const {operationalItems:b}=this;b.sort((c,e)=>{c=a.indexOf(c.layer);e=a.indexOf(e.layer);return c>e?-1:c<e?1:0})};d._viewHandles=function(){const {_handles:a,view:b}=this;a.remove(["map-layers","layer-views","view-layers"]);
this._compileList();b&&b.ready&&a.add([n.init(this,"view.map.allLayers",c=>this._createMapLayerHandles(c)),n.init(this,"view.allLayerViews",c=>this._createLayerViewHandles(c)),n.init(this,"listItemCreatedFunction",()=>this._compileList())],"view-layers")};l._createClass(r,[{key:"state",get:function(){const a=this.get("view");return this.get("view.ready")?"ready":a?"loading":"disabled"}}]);return r}(y.EventedAccessor);m.__decorate([q.property()],h.prototype,"listItemCreatedFunction",void 0);m.__decorate([q.property({type:w})],
h.prototype,"operationalItems",void 0);m.__decorate([q.property({readOnly:!0})],h.prototype,"state",null);m.__decorate([q.property()],h.prototype,"view",void 0);return h=m.__decorate([A.subclass("esri.widgets.LayerList.LayerListViewModel")],h)});