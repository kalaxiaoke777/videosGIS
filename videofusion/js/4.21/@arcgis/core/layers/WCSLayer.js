/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../core/Error.js";import{i as o,b as s,u as i}from"../core/lang.js";import{M as r}from"../chunks/MultiOriginJSONSupport.js";import{aliasOf as n}from"../core/accessorSupport/decorators/aliasOf.js";import"../chunks/ensureType.js";import"../chunks/Logger.js";import{property as a}from"../core/accessorSupport/decorators/property.js";import{subclass as l}from"../core/accessorSupport/decorators/subclass.js";import p from"./Layer.js";import{B as m}from"../chunks/BlendLayer.js";import{C as c}from"../chunks/CustomParametersMixin.js";import{g as u,b as d,a as h,e as f,f as g,i as y,h as b,B as v,I as j}from"../chunks/xmlUtilities.js";import{O as x}from"../chunks/OperationalLayer.js";import{P as w}from"../chunks/PortalLayer.js";import{R as C}from"../chunks/RefreshableLayer.js";import{S}from"../chunks/ScaleRangeLayer.js";import{p as k}from"../chunks/commonProperties2.js";import I from"./support/Field.js";import"../geometry.js";import{isAbortError as D}from"../core/promiseUtils.js";import L from"./support/DimensionalDefinition.js";import{c as R}from"../chunks/wmsUtils.js";import O from"../geometry/Extent.js";import T from"../geometry/Polygon.js";import P from"./support/RasterInfo.js";import{n as M}from"../chunks/pixelUtils.js";import{createPopupTemplate as E}from"../support/popupUtils.js";import"../chunks/Message.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/metadata.js";import"../chunks/handleUtils.js";import"../chunks/ArrayPool.js";import"../chunks/arrayUtils.js";import"../core/scheduling.js";import"../chunks/ReadOnlyMultiOriginJSONSupport.js";import"../chunks/JSONSupport.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/Evented.js";import"../chunks/Identifiable.js";import"../chunks/Loadable.js";import"../chunks/Promise.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/Multipoint.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../chunks/zmUtils.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../chunks/jsonMap.js";import"../geometry/support/jsonUtils.js";import"../chunks/parser.js";import"../chunks/colorUtils.js";import"../chunks/screenUtils.js";import"../chunks/mat4f32.js";import"../chunks/mat4.js";import"../chunks/common.js";import"../chunks/_commonjsHelpers.js";import"../rasterRenderers.js";import"../renderers/ClassBreaksRenderer.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../chunks/enumeration.js";import"./support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/mathUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../core/Collection.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../intl.js";import"../chunks/number.js";import"../chunks/locale.js";import"../chunks/assets.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../chunks/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../Graphic.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../chunks/chartMediaInfoUtils.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/compilerUtils.js";import"../chunks/lengthUtils.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../renderers/support/ClassBreakInfo.js";import"../symbols/support/jsonUtils.js";import"../chunks/symbolConversion.js";import"../chunks/commonProperties.js";import"../renderers/RasterColormapRenderer.js";import"../renderers/support/ColormapInfo.js";import"../chunks/colorRampUtils.js";import"../chunks/colorUtils2.js";import"../renderers/RasterShadedReliefRenderer.js";import"../renderers/RasterStretchRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../chunks/devEnvironmentUtils.js";import"../renderers/VectorFieldRenderer.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/vectorFieldUtils.js";import"./support/PixelBlock.js";import"../chunks/utils2.js";import"../chunks/asyncUtils.js";import"../chunks/ItemCache.js";import"../chunks/MemCache.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils3.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/RasterJobHandler.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../core/workers/RemoteClient.js";import"./support/TileInfo.js";import"./support/LOD.js";import"../chunks/rasterRendererHelper.js";import"../chunks/generateRendererUtils.js";import"../chunks/RasterSymbolizer.js";import"../chunks/LercCodec.js";import"../chunks/RawBlockCache.js";import"../chunks/rasterProjectionHelper.js";import"../geometry/projection.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../support/timeUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/domains.js";import"./support/CodedValueDomain.js";import"./support/Domain.js";import"./support/InheritedDomain.js";import"./support/RangeDomain.js";import"../chunks/fieldType.js";function U(e){const t=function(e){var t,o;const s=null==(t=e.getHeader("Content-Type"))?void 0:t.split(";");if(!(null!=(o=null==s?void 0:s[0].trim())?o:"").startsWith("multipart/"))return null;const i={boundary:"",start:"",type:""};for(let e=1;e<s.length;e++){const t=s[e].split("="),o=t[1].trim();i[t[0].trim()]=o.startsWith('"')?o.slice(1,t[1].length-1):o}return i}(e);if(!t)return{isMultipart:!1,data:null};const o=t.boundary?function(e,t,o=0){const s="--"+t.boundary,i=[];for(let e=0;e<s.length;e++)i.push(s.charCodeAt(e));const r=[],n="\n--"+t.boundary+"--";for(let e=0;e<n.length;e++)r.push(n.charCodeAt(e));const a=[10],l=[13,10],p=[],m=i.length,c=new Uint8Array(e,o),u=Math.min(5e4,c.length-m);let d=0,h=0;for(let e=0;e<u;e++){for(h=0;h<m&&c[e+h]===i[h];h++);h===m&&(d&&p.push(A(c.subarray(d,e),t)),e+=m-1,c[e+1]===a[0]?e+=1:c[e+1]===l[0]&&c[e+2]===l[1]&&(e+=2),d=e+1)}const f=r.length;for(let e=c.length-f-10;e<c.length-f;e++){for(h=0;h<f&&c[e+h]===r[h];h++);if(h===f){p.push(A(c.subarray(d,e),t));break}}return p}(e.data,t,0):null;return{isMultipart:!0,data:o}}function A(e,t){const o=String.fromCharCode.apply(null,e.subarray(0,Math.min(300,e.length))).split("\n"),s=Math.min(o.length,7),i={contentDisposition:"inline"};let r=0;for(let a=0;a<s;a++){var n;if(o[a].length<4)r=r+o[a].length+1;else if("content"===o[a].slice(0,7).toLowerCase()){if(r=r+o[a].length+1,-1===o[a].indexOf(":"))continue;const e=o[a].substring(0,o[a].indexOf(":")).trim(),t=o[a].substring(o[a].indexOf(":")+1).trim();switch(e.toLowerCase()){case"content-type":i.contentType=t;break;case"content-description":i.contentDescription=t;break;case"content-transfer-encoding":i.contentTransferEncoding=t;break;case"content-id":i.contentID=t;break;case"content-disposition":i.contentDisposition=t;break;case"content-location":i.contentLocation=t}}else{if(i.contentDisposition.toLowerCase().indexOf("inline")>-1&&o[a].length>=4&&(null==(n=i.contentType)?void 0:n.toLowerCase().indexOf("image"))>-1){let t=!0;if(i.contentType.toLowerCase().indexOf("tif")>0&&(t=73===e[r]&&73===e[r+1]||77===e[r]&&77===e[r+1]),t){const t=new ArrayBuffer(e.length-r);new Uint8Array(t).set(e.subarray(r,e.length)),i.contentData=t}break}if((""===t.start||i.contentID===t.start)&&i.contentType){if(i.contentType.indexOf("text")>-1||i.contentType.indexOf("xml")>-1){i.contentData=String.fromCharCode.apply(null,e.subarray(r,e.length));break}i.contentData=e.subarray(r,e.length)}}}return i}function F(e){return e.indexOf("?")===e.length-1?e.substring(0,e.length-1):e}function $(e){const t={};for(let o=0;o<e.childNodes.length;o++){const s=e.childNodes[o];if(1!==s.nodeType)continue;const i=b(s).toLowerCase();switch(i){case"title":case"abstract":t[i]=u(s);break;case"identifier":t.id=u(s);break;case"wgs84boundingbox":{const e=f(s,"LowerCorner"),o=f(s,"UpperCorner");t.lonLatEnvelope=new O({xmin:e[0],ymin:e[1],xmax:o[0],ymax:o[1],spatialReference:{wkid:4326}})}break;case"coveragesummary":t.coverageSummaries=t.coverageSummaries||[],t.coverageSummaries.push($(s))}}return t}function V(e,t){if(e.coverageSummaries)for(let o=0;o<e.coverageSummaries.length;o++)e.coverageSummaries[o].abstract=e.coverageSummaries[o].abstract||e.abstract,e.coverageSummaries[o].lonLatEnvelope=e.coverageSummaries[o].lonLatEnvelope||e.lonLatEnvelope,e.coverageSummaries[o].title=e.coverageSummaries[o].title||e.title,V(e.coverageSummaries[o],t);null!=e.id&&t.push(e)}function G(e){const t=d(e.querySelector("Operation[name=GetCapabilities]"),"Get").getAttribute("xlink:href")||"",o=d(e.querySelector("Operation[name=DescribeCoverage]"),"Get").getAttribute("xlink:href")||"",s=d(e.querySelector("Operation[name=GetCoverage]"),"Get").getAttribute("xlink:href")||"";return{getCapabilities:F(t),describeCoverage:F(o),getCoverage:F(s)}}function N(e,o=null){let s=null;if("string"==typeof e){s=(new DOMParser).parseFromString(e,"text/xml")}else s=e;const i=s.documentElement.getAttribute("version"),r=(i||o||"1.0.0").slice(0,3);let n;if("2.0"===r)n=function(e){const t=d(e,"ServiceIdentification"),o=u(t,"Title"),s=g(t,"ServiceTypeVersion"),i=g(t,"Profile"),r=G(d(e,"OperationsMetadata")),n=h(e,"Contents/CoverageSummary"),a=[];for(let e=0;e<n.length;e++){const t=n[e],o=u(t,"CoverageId"),s=d(t,"WGS84BoundingBox");let i;if(s){const e=f(s,"LowerCorner"),t=f(s,"UpperCorner");i=new O({xmin:e[0],ymin:e[1],xmax:t[0],ymax:t[1],spatialReference:{wkid:4326}})}a.push({id:o,lonLatEnvelope:i})}const l=d(e,"ServiceMetadata");return{name:o,supportedVersions:s,supportedFormats:g(l,"formatSupported"),supportedInterpolations:g(l,"interpolationSupported"),onlineResources:r,profiles:i,coverages:a}}(s);else if("1.1"===r)n=function(e){const t=u(e,"ServiceIdentification/Title"),o=g(e,"ServiceIdentification/ServiceTypeVersion"),s=G(d(e,"OperationsMetadata")),i=[],r=d(e,"Contents");for(let e=0;e<r.childNodes.length;e++){const t=r.childNodes[e];1===t.nodeType&&y(t,"CoverageSummary")&&V($(t),i)}return{name:t,onlineResources:s,coverages:i,supportedVersions:o,supportedFormats:g(r,"SupportedFormat")}}(s);else{if("1.0"!==r)throw new t("wcsraster:parsecapabilities","the capabilities version is not supported");n=function(e){var t,o,s;const i=u(e,"Service/name"),r=d(e,"Capability"),n=null!=(t=d(r,"GetCapabilities/Get/OnlineResource").getAttribute("xlink:href"))?t:"",a=null!=(o=d(r,"DescribeCoverage/Get/OnlineResource").getAttribute("xlink:href"))?o:"",l=null!=(s=d(r,"GetCoverage/Get/OnlineResource").getAttribute("xlink:href"))?s:"",p={getCapabilities:F(n),describeCoverage:F(a),getCoverage:F(l)},m=h(e,"CoverageOfferingBrief"),c=[];for(let e=0;e<m.length;e++){const t=m[e],o=u(t,"name"),s=h(t,"pos"),i=f(s[0]),r=f(s[1]),n=new O({xmin:i[0],ymin:i[1],xmax:r[0],ymax:r[1],spatialReference:{wkid:4326}});c.push({id:o,lonLatEnvelope:n})}return{name:i,onlineResources:p,coverages:c,supportedVersions:["1.0.0"]}}(s)}return n.capabilitiesVersion=i,n}function B(e,t){const o=g(e,"1.0.0"===t?"interpolationMethod":"InterpolationMethod"),s="1.0.0"===t?e.getAttribute("default"):u(e,"InterpolationMethods/Default");return null!=s?[s].concat(o.filter((e=>e.toLowerCase()!==s.toLowerCase()))):o}function _(e){return null==e?["nearest"]:e.map((e=>{const t=e.toLowerCase();return t.indexOf("nearest")>-1?"nearest":t.indexOf("linear")>-1?"bilinear":t.indexOf("cubic")>-1?"cubic":null})).filter((e=>!!e))}function q(e){const t=h(e,"pos"),o=f(t[0]),s=f(t[1]);return new O({xmin:o[0],ymin:o[1],xmax:s[0],ymax:s[1],spatialReference:{wkid:4326}})}function W(e){const t=[],o=h(e,"RangeSet");let s=[];for(let e=0;e<o.length;e++){const i=u(o[e],"name"),r=u(o[e],"label"),n=[],a=h(o[e],"AxisDescription");for(let e=0;e<a.length;e++){const t=u(a[e],"name"),o=u(a[e],"label"),i=g(a[e],"singleValue");if(0===i.length){const t=u(a[e],"min"),o=u(a[e],"max"),s=Number(u(a[e],"res"))||1;if(null!==t&&null!==o)for(let e=parseInt(t,10);e<=parseInt(o,10);e+=s)i.push(e.toString())}"band"===t.toLowerCase()&&(s=i),n.push({name:t,label:o,values:i})}t.push({name:i,label:r,axis:n})}return{rangeSet:t,bandNames:s}}function z(e){const t=h(e,"timeposition");if(t.length>0){const e=[];for(let o=0;o<t.length;o++)e.push(new Date(u(t[o])));return{begin:e[0],end:e[e.length-1],values:e}}const o=d(e,"timePeriod")||d(e,"TimePeriod");if(o){return{begin:new Date(u(o,"beginPosition")||u(o,"BeginPosition")),end:new Date(u(o,"endPosition")||u(o,"EndPosition")),...function(e=null){if(!e)return{resolution:null,units:null};let t=e.toUpperCase();const o=["Y","M","D"],s=["H","M","S"],i=["Years","Months","Days","Hours","Minutes","Seconds"];let r,n,a;return-1===t.indexOf("PT")?(t=t.slice(1),a=o.findIndex((e=>t.indexOf(e)>-1)),a>-1&&(r=i[a]),n=parseFloat(t.substring(0,t.length-1))):(t=t.slice(2),a=s.findIndex((e=>t.indexOf(e)>-1)),r=i[3+a],n=parseFloat(t.substring(0,t.length-1))),{resolution:n,units:r}}(u(o,"timeResolution")||u(o,"TimeResolution"))}}return null}function H(e){const t=d(e,"spatialDomain"),o=d(t,"Envelope")||d(t,"EnvelopeWithTimePeriod"),s=o.getAttribute("srsName").split(":"),i=s[s.length-1],r=h(o,"pos"),n=f(r[0]),a=f(r[1]),l=parseInt(i,10),p=isNaN(l)?null:{wkid:l},m=new O({xmin:n[0],ymin:n[1],xmax:a[0],ymax:a[1],spatialReference:p}),c=d(t,"RectifiedGrid"),g=u(c,"low").split(" "),y=u(c,"high").split(" "),b=parseInt(y[0],10)-parseInt(g[0],10)+1,v=parseInt(y[1],10)-parseInt(g[1],10)+1,j=f(t,"origin/pos"),x=h(t,"offsetVector"),w={envelope:m,columns:b,rows:v,offset:{x:parseFloat(u(x[0]).split(" ")[0]),y:parseFloat(u(x[1]).split(" ")[1])},origin:{x:j[0],y:j[1]}},C=d(e,"temporalDomain")||d(e,"TemporalDomain");return{spatialDomain:w,temporalDomain:C?z(C):null}}function J(e){const t=[],o=h(e,"Field");let s=[];for(let e=0;e<o.length;e++){const i=u(o[e],"Identifier"),r=u(o[e],"Description"),n=u(o[e],"Definition"),a=u(o[e],"Abstract"),l=u(o[e],"Title"),p=B(o[e],"1.1.0"),m=[],c=h(o[e],"Axis");for(let e=0;e<c.length;e++){const t=c[e].getAttribute("identifier"),o=u(c[e],"UOM"),i=u(c[e],"DataType"),r=g(c[e],"Key");"band"===t.toLowerCase()&&(s=r),m.push({identifier:t,uom:o,dataType:i,values:r})}t.push({identifier:i,description:r,definition:n,abstract:a,title:l,supportedInterpolations:p,axis:m})}return{rangeSet:t,bandNames:s}}function Y(e){var t;const o=d(e,"SpatialDomain"),s=d(o,"GridCRS"),i=u(s,"GridBaseCRS"),r=u(s,"GridOrigin"),n=null!=(t=null==r?void 0:r.split(" ").map((e=>parseFloat(e))))?t:[0,0],a=f(s,"GridOffsets"),l=h(o,"BoundingBox");let p,m,c,g;for(let e=0;e<l.length;e++){var y;const t=null==(y=l[e].getAttribute("crs"))?void 0:y.toLowerCase();if(null!=t)if(t.indexOf("imagecrs")>-1){const t=f(l[e],"LowerCorner"),o=f(l[e],"UpperCorner");p=o[0]-t[0]+1,m=o[1]-t[1]+1}else if(t.indexOf("epsg")>0){const o=t.split(":");c=parseInt(o[o.length-1],10);const s=f(l[e],"LowerCorner"),i=f(l[e],"UpperCorner");g=new O({xmin:s[0],ymin:s[1],xmax:i[0],ymax:i[1],spatialReference:{wkid:c}})}}const b=p>m,v=g.xmax-g.xmin>g.ymax-g.ymin;let j=!1;R(c)&&(b===v?j=!1:(j=!0,g=new O({xmin:g.ymin,ymin:g.xmin,xmax:g.ymax,ymax:g.xmax,spatialReference:{wkid:c}})));const x={columns:p,rows:m,origin:{x:n[0],y:n[1]},offset:{x:a[0],y:a[1]},gridBaseCRS:i,envelope:g,useEPSGAxis:j},w=d(e,"temporalDomain")||d(e,"TemporalDomain");return{spatialDomain:x,temporalDomain:w?z(w):null}}function Q(e,t){const o=[],s=[],i={supportedFormats:o,supportedCRSs:s,version:"1.1"};let r;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if(1!==n.nodeType)continue;const a=b(n).toLowerCase();switch(a){case"title":case"abstract":case"identifier":i[a]=u(n);break;case"supportedformat":{const e=u(n);-1===o.indexOf(e)&&o.push(e)}break;case"supportedcrs":{const e=u(n);-1===s.indexOf(e)&&s.push(e)}break;case"range":{const e=J(n);i.range=e.rangeSet,r=e.bandNames}break;case"domain":i.domain=Y(n)}}const n=_(i.range[0].supportedInterpolations),{identifier:a,abstract:l,title:p,domain:m,range:c}=i,d={x:Math.abs(m.spatialDomain.offset.x),y:Math.abs(m.spatialDomain.offset.y)},h=function(e,t){const o=e.filter((e=>-1===e.identifier.toLowerCase().indexOf("field_1")&&!e.axis.some((e=>"band"===e.identifier.toLowerCase())))),s=[];if(o.length&&o.forEach((e=>{var t,o;const i=e.axis.map((e=>{const t=e.values.map((t=>"ISO8601"===e.uom?-1===(t=t.trim()).toLowerCase().indexOf("z")?new Date(t+"Z").getTime():new Date(t).getTime():parseFloat(t.trim()))),o=[Math.min.apply(null,t),Math.max.apply(null,t)];return{name:e.identifier.trim(),description:"",field:e.identifier.trim(),unit:e.uom?e.uom.trim():"",hasRegularIntervals:!1,values:t,extent:o}}));s.push({name:e.identifier.trim(),description:null!=(t=null==(o=e.description)?void 0:o.trim())?t:"",unit:"",dimensions:i})})),t.temporalDomain){const{begin:e,end:o,values:i,units:r,resolution:n}=t.temporalDomain;s.some((e=>e.dimensions.some((e=>"stdtime"===e.name.toLowerCase()))))||s.forEach((t=>{t.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:null==i?void 0:i.map((e=>e.getTime())),hasRegularIntervals:!i,interval:n,intervalUnit:r,extent:[e.getTime(),o.getTime()]})}))}return s.length?{variables:s}:null}(c,m),f=new P({width:m.spatialDomain.columns,height:m.spatialDomain.rows,pixelSize:d,extent:m.spatialDomain.envelope,spatialReference:m.spatialDomain.envelope.spatialReference,bandCount:r.length||1,multidimensionalInfo:h});return{id:a,title:i.title,description:l||p,lonLatEnvelope:null,bandNames:r,rasterInfo:f,supportedFormats:o,supportedInterpolations:n,coverageDescription:i,version:t,useEPSGAxis:m.spatialDomain.useEPSGAxis}}function K(e){const t=d(e,"Envelope")||d(e,"EnvelopeWithTimePeriod"),o=t.getAttribute("srsName"),s=o.slice(o.lastIndexOf("/")+1),i=t.getAttribute("axisLabels").split(" ").map((e=>e.trim())).filter((e=>""!==e.trim())),r=f(t,"lowerCorner"),n=f(t,"upperCorner"),a=!["y","lat","latitude","north","nor","n","b"].some((e=>e===i[0].toLowerCase()));let l;const p=parseInt(s,10),m=isNaN(p)?null:{wkid:p};l=new O(a?{xmin:r[0],ymin:r[1],xmax:n[0],ymax:n[1],spatialReference:m}:{xmin:r[1],ymin:r[0],xmax:n[1],ymax:n[0],spatialReference:m});const c={mins:r,maxs:n},h=t.getAttribute("uomLabels").trim().split(" ");let g,b;return y(t,"EnvelopeWithTimePeriod")&&(g=new Date(u(e,"beginPosition")||u(e,"BeginPosition")),b=new Date(u(e,"endPosition")||u(e,"EndPosition"))),{envelope:l,axisLabels:i,uomLabels:h.length?h:null,envelopeAllDims:c,beginPosition:g,endPosition:b,isEastFirst:a}}function Z(e){const t=[],o=h(e,"DataRecord"),s=[];for(let e=0;e<o.length;e++){const r=h(o[e],"field"),n=[];for(let e=0;e<r.length;e++){var i;const t=r[e].getAttribute("name"),o=u(r[e],"description")||"",a=(null==(i=d(r[e],"uom"))?void 0:i.getAttribute("code"))||"",l=f(r[e],"interval");t.toLowerCase().indexOf("band")>-1&&s.push(t),n.push({name:t,description:o,uom:a,allowedValues:l})}t.push(n)}return{rangeType:t,bandNames:s}}function X(e){let t=1,o="";const s=.01;return Math.abs(e-1/24)<1/24*s?o="Hours":Math.abs(e-1)<.01?o="Days":e<1?(t=Math.round(24*e),o="Hours"):e>27.99&&e<31.01||Math.round(e/30)<12?o="Months":e>364.99&&e<366.01&&(o="Years"),{interval:t,intervalUnit:o}}function ee(e,t){const o=d(e,"RectifiedGrid"),s=f(o,"low"),i=f(o,"high"),r=[];for(let e=0;e<s.length;e++)r.push(i[e]-s[e]+1);const n=u(o,"axisLabels").split(" "),a=f(o,"origin/pos"),l=h(o,"offsetVector"),p=[];for(let e=0;e<l.length;e++){const t=f(l[e]),o=t.findIndex((e=>0!==e));p[o]=t[o]}const m=t||n;let c,g,y;return["y","lat","latitude","north","nor","n","b"].some((e=>e===m[0].toLowerCase()))?(c=r[1],g=r[0],y={y:Math.abs(p[0]),x:Math.abs(p[1])}):(c=r[0],g=r[1],y={x:Math.abs(p[0]),y:Math.abs(p[1])}),{columns:c,rows:g,origin:a,offset:p,resolution:y,gridSamples:r,axisLabels:n}}function te(e){const t=d(e,"EarthObservation");if(!t)return null;const o=d(t,"phenomenonTime"),s=o?z(o):null,i=d(t,"phenomenonTime"),r=i?z(i):null,n=u(t,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");let a=null;if(n){const e=n.split(" ").map((e=>e.trim())).filter((e=>null!=e&&""!==e));if(e.length){const t=[];for(let o=0;o<e.length/2;o+=2)t.push(e[o],e[o+1]);a=new T({rings:[t],spatialReference:{wkid:4326}})}}return{observation:{phonomenonTime:s,resultTime:r,footprint:a,identifier:u(e,"metaDataProperty/EarthObservationMetaData/identifier"),acquisitionType:u(e,"metaDataProperty/EarthObservationMetaData/acquisitionType"),status:u(e,"metaDataProperty/EarthObservationMetaData/status")}}}function oe(e){const t={version:"2.0"};let o=[];for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i];if(1===r.nodeType)if(y(r,"coverageId"))t.coverageId=u(r);else if(y(r,"ServiceParameters"))t.serviceParameters={supportedFormats:g(r,"nativeFormat")};else if(y(r,"boundedBy"))t.boundedBy=K(r);else if(y(r,"rangeType")){const e=Z(r);t.rangeType=e.rangeType,o=e.bandNames}else if(y(r,"domainSet")){var s;t.domainSet=ee(r,null==(s=t.boundedBy)?void 0:s.axisLabels)}else if(y(r,"metadata")){const e=d(r,"EOMetadata");t.eoMetadata=e?te(e):null}}const{coverageId:i,boundedBy:r,domainSet:n,rangeType:a,serviceParameters:l}=t,p=function(e,t,o){const s=[];for(let t=0;t<e.length;t++){const o=e[t];for(let e=0;e<o.length;e++)-1===o[e].name.toLowerCase().indexOf("band")&&s.push(o[e])}const i=[];if(s.length){const e=[];for(let s=2;s<o.axisLabels.length;s++){const i=(t.uomLabels&&t.uomLabels.length)>s?t.uomLabels[s]:"",r=o.axisLabels[s].toLowerCase().indexOf("time")>-1||"iso8601"===i.toLowerCase()||"oledatetime"===i.toLowerCase();let n,a;if(r){const e=X(o.offset[s]);n=e.interval,a=e.intervalUnit}else n=o.offset[s],a=i;const l=[];r?(l.push((new Date).setTime(24*(t.envelopeAllDims.mins[s]-25569)*3600*1e3)),l.push((new Date).setTime(24*(t.envelopeAllDims.maxs[s]-25569)*3600*1e3))):(l.push(t.envelopeAllDims.mins[s]),l.push(t.envelopeAllDims.maxs[s])),e.push({name:o.axisLabels[s].trim(),description:o.axisLabels[s].trim(),unit:t.uomLabels&&t.uomLabels.length>s?t.uomLabels[s].trim():"",hasRegularIntervals:!0,extent:l,interval:n,intervalUnit:a})}if(s.forEach((t=>{var o,s;return i.push({name:t.name.trim(),description:null!=(o=null==(s=t.description)?void 0:s.trim())?o:"",unit:t.uom.trim(),dimensions:e})})),i.length)return{variables:i}}return null}(a,r,n);return{id:i,title:i,description:i,lonLatEnvelope:null,bandNames:o,rasterInfo:new P({width:n.columns,height:n.rows,pixelSize:n.resolution,extent:r.envelope,spatialReference:r.envelope.spatialReference,bandCount:o.length||1,multidimensionalInfo:p}),supportedFormats:l.supportedFormats,supportedInterpolations:null,coverageDescription:t,version:"2.0.1",useEPSGAxis:!1}}function se(e,t){let o=null;if("string"==typeof e){o=(new DOMParser).parseFromString(e,"text/xml")}else o=e;if("1.0.0"===t){return h(o,"CoverageOffering").map((e=>function(e){const t={version:"1.0"};let o=[];for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i];if(1===r.nodeType)if(y(r,"description"))t.description=u(r);else if(y(r,"name"))t.name=u(r);else if(y(r,"label"))t.label=u(r);else if(y(r,"supportedFormats"))t.supportedFormats=g(r,"formats");else if(y(r,"supportedCRSs"))t.supportedCRSs={requestResponseCRSs:g(s=r,"requestResponseCRSs").map((e=>e.split(":")[1])),nativeCRSs:g(s,"nativeCRSs").map((e=>e.split(":")[1]))};else if(y(r,"supportedInterpolations"))t.supportedInterpolations=B(r,"1.0.0");else if(y(r,"lonLatEnvelope"))t.lonLatEnvelope=q(r);else if(y(r,"rangeSet")){const e=W(r);t.rangeSet=e.rangeSet,o=e.bandNames}else y(r,"domainSet")&&(t.domainSet=H(r))}var s;const i=_(t.supportedInterpolations),{name:r,description:n,label:a,lonLatEnvelope:l,supportedFormats:p}=t,{spatialDomain:m}=t.domainSet,c={x:Math.abs(m.offset.x),y:Math.abs(m.offset.y)},d=new P({width:m.columns,height:m.rows,pixelSize:c,extent:m.envelope,spatialReference:m.envelope.spatialReference,bandCount:o.length||1});return{id:r,title:t.name,description:n||a,lonLatEnvelope:l,rasterInfo:d,bandNames:o,supportedFormats:p,supportedInterpolations:i,coverageDescription:t,version:"1.0.0",useEPSGAxis:!1}}(e)))}const s=h(o,"CoverageDescription");return"1.1.0"===t||"1.1.1"===t||"1.1.2"===t?s.map((e=>Q(e,t))):s.map((e=>oe(e)))}const ie=["nearest neighbor","bilinear","bicubic"],re=["nearest","linear","cubic"];let ne=class extends v{constructor(){super(...arguments),this.datasetFormat="WCSServer"}async open(e){await this.init();const o=null==e?void 0:e.signal,s=await this._getCapabilities(o);if(this.capabilities=s,!this.version){var i;let e=null==(i=s.capabilitiesVersion)?void 0:i.slice(0,3);"2.0"===e||"1.1"===e||"1.0"===e?this.version=s.capabilitiesVersion:(e=s.supportedVersions.find((e=>"2.0.1"===e))||s.supportedVersions.find((e=>"2.0"===e.slice(0,3)))||s.supportedVersions.find((e=>"1.1"===e.slice(0,3)))||s.supportedVersions.find((e=>"1.0"===e.slice(0,3)))||"1.0.0",this.version=e)}null==this.coverageId&&(this.coverageId=s.coverages[0].id);const r=s.coverages.filter((e=>e.id===this.coverageId))[0];if(null==r)throw new t("wcsraster-open",`the coverageId ${this.coverageId} does not exist in capabilities`);const n=await this._describeCoverage(o);this.coverageInfo=n[0],"2.0"===this.version.slice(0,3)&&(this.coverageInfo.lonLatEnvelope=r.lonLatEnvelope,this.coverageInfo.supportedInterpolations=_(s.supportedInterpolations)),this.datasetName=this.coverageInfo.title;const{rasterInfo:a}=this.coverageInfo;if(this.createRemoteDatasetStorageInfo(a,512,512),this._set("rasterInfo",a),null==a.spatialReference)throw new t("wcsraster-open",`coverage without spatial referernce is not supported: ${this.coverageId}`);const{pixelType:l,bandCount:p}=await this._getPixelTypeAndBandCount(o);a.pixelType=l,1===a.bandCount&&p>1&&(a.bandCount=p),this.updateTileInfo()}async fetchRawTile(e,i,r,n={}){if(this.isBlockOutside(e,i,r))return null;const{nativePixelSize:a,spatialReference:l}=this.rasterInfo,p=2**e,m=a.x*p,c=a.y*p,{blockWidth:u,blockHeight:d}=this.getBlockWidthHeight(e),{origin:h}=this.rasterInfo.storageInfo.tileInfo,f=this.getTileExtent({x:m,y:c},i,r,h,l,[u,d]),g=this.rasterInfo.extent,y=f.xmax>g.xmax||f.ymin<g.ymin;let b=f,v=u,j=d;if(y&&(b=f.clone().intersection(g),o(b)&&(v=Math.floor((b.xmax-b.xmin)/m),j=Math.floor((b.ymax-b.ymin)/c),b.xmax=b.xmin+m*v,b.ymin=b.ymax-c*j)),s(b)||v<=1||j<=1)return null;const x=await this._getCoverage(b,v,j,p,n);if(!x)return null;const w=await this.decodePixelBlock(x,{width:v,height:j,planes:null,pixelType:null});if(w&&(w.width!==v||w.height!==j))throw new t("wcsraster-fetch",`the reponse has unexpected dimension width: ${w.width}, height: {pixelBlock.height}`);return y?M(w,{x:0,y:0},{width:d,height:d}):w}async _getCapabilities(e){const o={service:"WCS",request:"GetCapabilities"};this.version&&(o.version=this.version,o.acceptVersions=this.version);try{const{data:t}=await this.request(this.url,{query:o,responseType:"xml",signal:e});return N(t)}catch(e){if(!D(e))throw new t("wcslayer:open","wcs capabilities is not valid or supported");throw e}}async _describeCoverage(e){const o={service:"WCS",request:"DescribeCoverage",version:this.version},s=this.version.slice(0,3);"1.0"===s?o.coverage=this.coverageId:"1.1"===s?o.identifiers=this.coverageId:"2.0"===s&&(o.coverageId=this.coverageId);try{const{data:t}=await this.request(this.url,{query:o,responseType:"xml",signal:e});return se(t,this.version)}catch(e){if(!D(e))throw new t("wcslayer:open","wcs coverage description is not valid or supported");throw e}}async _getPixelTypeAndBandCount(e){const{pixelSize:s,extent:r,multidimensionalInfo:n}=this.rasterInfo,a=r.center,l=new O({xmin:a.x-s.x,xmax:a.x+s.x,ymin:a.y-s.y,ymax:a.y+s.y,spatialReference:r.spatialReference});let p;if(o(n)){const e=n.variables[0];p=[],e.dimensions.forEach((t=>{p.push(new L({variableName:e.name,dimensionName:t.name,values:t.hasRegularIntervals?t.extent[0]:t.values[0],isSlice:!0}))}))}const m=await this._getCoverage(l,2,2,1,{multidimensionalDefinition:p,signal:i(e)});if(!m)throw new t("wcsraster-open","unable to determine pixel type");const c=await this.decodePixelBlock(m,{width:2,height:2,planes:null,pixelType:null});return{pixelType:c.pixelType,bandCount:c.getPlaneCount()}}async _getCoverage(e,o,s,i,r){const{coverageDescription:n}=this.coverageInfo,{version:a}=n,l="2.0"===n.version?this._getCoverage201Parameters(e,o,s,i,r,n):"1.1"===n.version?this._getCoverage110Parameters(e,o,s,r,n):this._getCoverage100Parameters(e,o,s,r),p="2.0"===n.version?await this.request(this._constructWCS201Url(l),{signal:r.signal,responseType:"array-buffer"}):await this.request(this.url,{query:l,signal:r.signal,responseType:"array-buffer"});if("1.0"===a)return p.data;const m=U(p);if(m.isMultipart&&m.data){const e=m.data.filter((e=>{var t;return(null==(t=e.contentType)?void 0:t.toLowerCase().includes("image"))&&null!=e.contentData}))[0];return null==e?void 0:e.contentData}if(this.ioConfig.allowAnyMediaType)return p.data;throw new t("wcsraster:getcoverage","response is not a valid coverage, multipart response is expected")}_getInterpolationIndex(e){return-1===this.coverageInfo.supportedInterpolations.indexOf(e)||"nearest"===e?0:"bilinear"===e?1:"cubic"===e?2:0}_getCoverage100Parameters(e,t,o,s){const i=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`,r=e.spatialReference.wkid,n=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().indexOf("tiff")>-1))||"GEOTIFF",{bandIds:a,interpolation:l}=s,p=this._getInterpolationIndex(l),m=a?a.map((e=>this.coverageInfo.bandNames[e])):null,c=ie[p];return{service:"WCS",request:"GetCoverage",version:this.version,coverage:this.coverageId,format:n,crs:`EPSG:${r}`,bbox:i,width:t,height:o,interpolation:c,band:null==m?void 0:m.join(",")}}_getCoverage110Parameters(e,t,o,s,i){var r;const{multidimensionalDefinition:n,bandIds:a,interpolation:l}=s,p=e.spatialReference.wkid,m=`urn:ogc:def:crs:EPSG::${p}`,c=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().indexOf("tiff")>-1))||"image/tiff",u=this._getInterpolationIndex(l),d=re[u],h=null==l||0===(null==(r=this.coverageInfo.supportedInterpolations)?void 0:r.indexOf(l)),f=i.domain.spatialDomain,g=f.origin.x<=f.envelope.xmin&&f.origin.y<=f.envelope.ymin,y=e.width/t,b=e.height/o*(g?1:-1),v=g?[e.xmin,e.ymin]:[e.xmin,e.ymax],j=f.useEPSGAxis&&R(p),x=j?`${v[1]},${v[0]}`:`${v[0]},${v[1]}`,w=j?`${b},0,0,${y}`:`${y},0,0,${b}`,C=y/2,S=e.xmin+C,k=e.xmax-C,I=Math.abs(b)/2,D=e.ymin+I,L=e.ymax-I,O=j?`${D},${S},${L},${k},${m}`:`${S},${D},${k},${L},${m}`,T=i.range.filter((e=>e.axis.some((e=>e.identifier.toLowerCase().indexOf("band")>-1))))[0];let P,M=T&&d&&a?h?`${T.identifier}[${T.axis[0].identifier}[${a.join(",")}]]`:`${T.identifier}:${d}[${T.axis[0].identifier}[${a.join(",")}]]`:null;if(null!=n&&n.length)for(let e=0;e<n.length;e++){let t=n[e].values;const o=n[e].dimensionName.toLowerCase(),s=n[e].variableName.toLowerCase();if(t.length>0)if(t[0]instanceof Array&&(t=t[0]),"stdtime"===o)P=t.map((e=>this._convertToISOTime(e))).join(",");else{const e=i.range.filter((e=>e.identifier.toLowerCase()===s))[0];if(e){const s=e.axis.filter((e=>e.identifier.toLowerCase()===o))[0];s&&(M=h?e.identifier+"["+s.identifier+"["+t.join(",")+"]]":e.identifier+":"+d+"["+s.identifier+"["+t.join(",")+"]]")}}}return{service:"WCS",request:"GetCoverage",version:this.version,identifier:this.coverageId,format:c,crs:`EPSG:${p}`,boundingbox:O,gridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",gridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",gridOrigin:x,gridOffsets:w,gridBaseCRS:m,timeSequence:P,rangeSubset:M}}_convertToISOTime(e,t=!1){return(t?new Date(24*(e-25569)*60*60*1e3):new Date(e)).toISOString()}_getCoverage201Parameters(e,t,o,s,i,r){const{multidimensionalDefinition:n,interpolation:a}=i,l=this._getInterpolationIndex(a);let p=null;const{supportedInterpolations:m}=this.capabilities;if(null!=m&&m.length)switch(l){case 0:p=m.find((e=>e.includes("nearest")));break;case 1:p=m.find((e=>e.includes("linear")));break;case 2:p=m.find((e=>e.includes("cubic")||e.includes("quadratic")))}const c=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().indexOf("tiff")>-1))||"image/tiff",{bandNames:u}=this.coverageInfo,{boundedBy:d,domainSet:h,rangeType:f}=r,g=d.isEastFirst?0:1,y=1-g,{axisLabels:b}=d,v=b[g],j=b[y],x=`http://www.opengis.net/def/crs/EPSG/0/${e.spatialReference.wkid}`,w=x,C=[];C.push(`${v}(${e.xmin},${e.xmax})`),C.push(`${j}(${e.ymin},${e.ymax})`);const S=[];if(b.length>2)for(let e=2;e<b.length;e++){const t=h.origin[e];if(b[e].toLowerCase().indexOf("time")>-1){let o=t.toString();d.uomLabels[e].toLowerCase().indexOf("ole")>-1&&(S.push(b[e]),o=this._convertToISOTime(t,!0)),C.push(b[e]+",http://www.opengis.net("+o+")")}else C.push(b[e]+",http://www.opengis.net("+t+")")}let k=null;if(null!=n&&n.length){const e=[];f.forEach((t=>t.forEach((t=>e.push(t.name)))));const t=[];for(let o=0;o<n.length;o++){const s=b.find((e=>e===n[o].dimensionName)),i=e.find((e=>e===n[o].variableName));if(-1===t.indexOf(i)&&t.push(i),s){let e=n[o].values;if(e.length>0){Array.isArray(e[0])&&(e=e[0]);let t="";t=s.toLowerCase().indexOf("time")>-1?e.map((e=>this._convertToISOTime(e))).join(","):e.join(",");const o=C.findIndex((e=>0===e.indexOf(s+",http://www.opengis.net")));-1===o&&C.push(s+",http://www.opengis.net("+t+")"),-1!==o&&-1===C[o].indexOf("("+t+")")&&C.splice(o,1,s+",http://www.opengis.net("+t+")")}}}t.length&&(k=t.join(","))}else if(null!=u&&u.length){k=(i.bandIds?i.bandIds.map((e=>u[e])):u).join(",")}const I=C.join("&subset="),D=!(r.domainSet.axisLabels.join("")===r.boundedBy.axisLabels.join(""))&&!1!==this.ioConfig.allowScaleFactor,L=D?null:`${v}(${t}),${j}(${o})`,R=D?1/s:null;return{service:"WCS",request:"GetCoverage",version:this.version,coverageId:this.coverageId,rangesubset:k,interpolation:p,scaleSize:L,scaleFactor:R,subset:I,format:c,mediaType:this.ioConfig.allowAnyMediaType?null:"multipart/related",outputcrs:x,subsettingcrs:w}}_constructWCS201Url(e){const t={...this.ioConfig.customFetchParameters,...e},o=[];Object.keys(t).forEach((e=>{const s=t[e];null!=s&&("subset"===e?s.split("&subset=").forEach((e=>{e&&o.push(`subset=${encodeURIComponent(e)}`)})):o.push(`${e}=${encodeURIComponent(s)}`))}));return`${encodeURI(this.url)}?${o.join("&")}`}};e([a({type:String,json:{write:!0}})],ne.prototype,"datasetFormat",void 0),e([a()],ne.prototype,"tileType",void 0),e([a({type:String,json:{write:!0}})],ne.prototype,"version",void 0),e([a({type:String,json:{write:!0}})],ne.prototype,"coverageId",void 0),ne=e([l("esri.layers.support.rasterDatasets.ImageServerRaster")],ne);var ae=ne;let le=class extends(m(S(x(w(c(j(C(r(p))))))))){constructor(...e){super(...e),this.coverageId=null,this.coverageInfo=null,this.version=null,this.isReference=null,this.type="wcs",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=o(e)?e.signal:null;return this.addResolvingPromise(this._openRaster(t)),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){return[new I({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})]}createPopupTemplate(e){return E({fields:this.rasterFields,title:this.title},e)}async _openRaster(e){const o=new ae({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters}});if(await o.open({signal:e}),!o.rasterInfo)throw o.destroy(),new t("wcs-layer:load","cannot load resources on "+this.url);null==this.title&&this.setAtOrigin("title",o.datasetName,"service"),null==this.coverageId&&this.setAtOrigin("coverageId",o.coverageInfo.id,"service"),this.raster=o,this._configDefaultSettings(),this.watch("customParameters",(e=>this.raster.ioConfig.customFetchParameters=e))}};e([a({json:{write:!0}})],le.prototype,"coverageId",void 0),e([a({readOnly:!0}),n("raster.coverageInfo")],le.prototype,"coverageInfo",void 0),e([a()],le.prototype,"version",void 0),e([a()],le.prototype,"isReference",void 0),e([a({readOnly:!0})],le.prototype,"type",void 0),e([a(k)],le.prototype,"popupEnabled",void 0),e([a()],le.prototype,"popupTemplate",void 0),e([a({readOnly:!0})],le.prototype,"defaultPopupTemplate",null),e([a({readOnly:!0,type:[I]})],le.prototype,"fields",void 0),e([a({readOnly:!0,type:[I]})],le.prototype,"rasterFields",null),le=e([l("esri.layers.WCSLayer")],le);var pe=le;export{pe as default};
