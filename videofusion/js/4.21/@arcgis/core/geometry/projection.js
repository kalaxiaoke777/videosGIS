/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import n from"../core/Error.js";import{k as e,g as t,s as r,n as s,l as u,c as l,m as o,r as a,b as i,o as c}from"../chunks/mathUtils.js";import{b as f,u as p,i as h}from"../core/lang.js";import{throwIfAborted as m}from"../core/promiseUtils.js";import{a as d}from"../chunks/unitUtils.js";import{i as j,t as M,a as R}from"../chunks/mat4.js";import k from"./Extent.js";import g from"./Multipoint.js";import{p as w,i as y,l as E}from"../chunks/pe.js";import I from"./Point.js";import P from"./Polygon.js";import x from"./Polyline.js";import{S,W as T,a as b,b as C}from"../chunks/projectionEllipsoid.js";import{a as F}from"../chunks/aaBoundingRect.js";import{e as U,a as q,m as z}from"../chunks/Ellipsoid.js";import{e as A}from"../chunks/geodesicConstants.js";import G from"./support/GeographicTransformation.js";import{e as v,j as W,a as Z,i as _,k as B,f as L,h as N}from"./SpatialReference.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/Message.js";import"../chunks/common.js";import"../chunks/jsonMap.js";import"../chunks/tslib.es6.js";import"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import"../chunks/metadata.js";import"../chunks/handleUtils.js";import"../core/accessorSupport/decorators/subclass.js";import"./Geometry.js";import"../chunks/JSONSupport.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/ArrayPool.js";import"../chunks/arrayUtils.js";import"../core/scheduling.js";import"../chunks/reader.js";import"../chunks/writer.js";import"./support/webMercatorUtils.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/zmUtils.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/extentUtils.js";import"./support/GeographicTransformationStep.js";let J=null,K=null,O=null,V={};function X(){return!!J&&y()}function D(){return!0}function H(n){return f(O)&&(O=Promise.all([E(),import("../chunks/geometryEngineBase.js").then((function(n){return n.g})),import("../chunks/hydrated.js")])),O.then((([,e,{hydratedAdapter:t}])=>{m(n),K=t,J=e.default,J._enableProjection(w)}))}function Q(n,e,t=null){return Array.isArray(n)?0===n.length?[]:Y(K,n,n[0].spatialReference,e,t):Y(K,[n],n.spatialReference,e,t)[0]}function Y(n,e,t,r,s=null){if(f(t)||f(r))return e;if(rn(t,r,s))return e.map((n=>p(ln(n,t,r))));if(f(s)){const n=G.cacheKey(t,r);void 0!==V[n]?s=V[n]:(s=$(t,r,null),f(s)&&(s=new G),V[n]=s)}if(f(J))throw new en;return J._project(n,e,t,r,s)}function $(n,e,t=null){if(f(J))throw new en;if(f(n)||f(e))return null;const r=J._getTransformation(K,n,e,t,null==t?void 0:t.spatialReference);return null!==r?G.fromGE(r):null}function nn(n,e,t=null){if(f(J))throw new en;const r=J._getTransformationBySuitability(K,n,e,t,null==t?void 0:t.spatialReference);if(null!==r){const n=[];for(const e of r)n.push(G.fromGE(e));return n}return[]}class en extends n{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function tn(){J=null,K=null,O=null,V={}}function rn(n,e,t){return!t&&(!!v(n,e)||W(n)&&W(e)&&!!ce(n,e,de))}async function sn(n,e,t,r){if(!X())if(Array.isArray(n)){for(const{source:e,dest:t,geographicTransformation:s}of n)if(!rn(e,t,s))return H(r)}else if(!rn(n,e,t))return H(r)}function un(n,e){switch(ce(n,e,de)){case vn:return"copy3";case Yn:return"wgs84ToSphericalECEF";case Ln:return"wgs84ToWebMercator";case Kn:return"wgs84ToPlateCarree";case ue:return"wgs84ToWGS84ECEF";case Wn:return"webMercatorToWGS84";case Zn:return"webMercatorToSphericalECEF";case _n:return"webMercatorToWGS84ECEF";case le:return"wgs84ECEFToWGS84";case oe:return"wgs84ECEFToSphericalECEF";case ae:return"wgs84ECEFToWebMercator";case te:return"sphericalECEFToWGS84";case re:return"sphericalECEFToWebMercator";case ee:return"sphericalMarsPCPFToMars2000";case ne:return"sphericalMoonPCPFToMoon2000";case se:return"sphericalECEFToWGS84ECEF";case Qn:return"mars2000ToSphericalPCPF";case Hn:return"moon2000ToSphericalPCPF";default:return null}}function ln(n,e,t){return n?"x"in n?an(n,e,new I,t,0):"xmin"in n?Mn(n,e,new k,t,0):"rings"in n?dn(n,e,new P,t,0):"paths"in n?hn(n,e,new x,t,0):"points"in n?fn(n,e,new g,t,0):null:null}function on(n,e,t=e.spatialReference,r=0){return!f(t)&&h(an(n,n.spatialReference,e,t,r))}function an(n,e,t,r,s){ye[0]=n.x,ye[1]=n.y;const u=n.z;return ye[2]=void 0!==u?u:s,Pn(ye,e,0,ye,r,0,1)?(t.x=ye[0],t.y=ye[1],t.spatialReference=r,void 0===u?(t.z=void 0,t.hasZ=!1):(t.z=ye[2],t.hasZ=!0),void 0===n.m?(t.m=void 0,t.hasM=!1):(t.m=n.m,t.hasM=!0),t):null}function cn(n,e,t=e.spatialReference,r=0){return!f(t)&&h(fn(n,n.spatialReference,e,t,r))}function fn(n,e,t,r,s){const{points:u,hasZ:l,hasM:o}=n,a=[],i=u.length,c=[];for(const n of u)c.push(n[0],n[1],l?n[2]:s);if(!Pn(c,e,0,c,r,0,i))return null;for(let n=0;n<i;++n){const e=3*n,t=c[e],r=c[e+1];l&&o?a.push([t,r,c[e+2],u[n][3]]):l?a.push([t,r,c[e+2]]):o?a.push([t,r,u[n][2]]):a.push([t,r])}return t.points=a,t.spatialReference=r,t.hasZ=l,t.hasM=o,t}function pn(n,e,t=e.spatialReference,r=0){return h(t)&&h(hn(n,n.spatialReference,e,t,r))}function hn(n,e,t,r,s){const{paths:u,hasZ:l,hasM:o}=n,a=[];return Sn(u,l,o,e,a,r,s)?(t.paths=a,t.spatialReference=r,t.hasZ=l,t.hasM=o,t):null}function mn(n,e,t=e.spatialReference,r=0){return h(t)&&h(dn(n,n.spatialReference,e,t,r))}function dn(n,e,t,r,s){const{rings:u,hasZ:l,hasM:o}=n,a=[];return Sn(u,l,o,e,a,r,s)?(t.rings=a,t.spatialReference=r,t.hasZ=l,t.hasM=o,t):null}function jn(n,e,t=e.spatialReference,r=0){return h(t)&&h(Mn(n,n.spatialReference,e,t,r))}function Mn(n,e,t,r,s){const{xmin:u,ymin:l,xmax:o,ymax:a,hasZ:i,hasM:c}=n;if(!wn(u,l,i?n.zmin:s,e,ye,r))return null;t.xmin=ye[0],t.ymin=ye[1],i&&(t.zmin=ye[2]);return wn(o,a,i?n.zmax:s,e,ye,r)?(t.xmax=ye[0],t.ymax=ye[1],i&&(t.zmax=ye[2]),c&&(t.mmin=n.mmin,t.mmax=n.mmax),t.spatialReference=r,t):null}function Rn(n,e,t){if(f(e)||f(t))return null;const r=new I({spatialReference:t});return Pn(n,e,0,ye,t,0,1)?(r.x=ye[0],r.y=ye[1],r.z=ye[2],r):null}function kn(n,e,t){return Pn(n,e,0,ye,t.spatialReference,0,1)?(t.x=ye[0],t.y=ye[1],t.z=ye[2],t):null}function gn(n,e,t,r=0){ye[0]=n.x,ye[1]=n.y;const s=n.z;return ye[2]=void 0!==s?s:r,Pn(ye,n.spatialReference,0,e,t,0,1)}function wn(n,e,t,r,s,u){return ke[0]=n,ke[1]=e,ke[2]=t,Pn(ke,r,0,s,u,0,1)}function yn(n,e,t,r){return!(f(e)||f(r)||n.length<2)&&(2===n.length&&(ke[0]=n[0],ke[1]=n[1],ke[2]=0,n=ke),Pn(n,e,0,t,r,0,1))}function En(n,e){ye[0]=n.x,ye[1]=n.y;const t=n.z;return ye[2]=void 0!==t?t:0,In(ye,n.spatialReference,e)}function In(n,e,t){return function(n,e,t){if(f(e))return!1;const r=Gn(e,he),s=ie[r][6];if(f(s))return!1;s(n,0,ke,0),t!==ke&&(t[0]=ke[0],t[1]=ke[1],t.length>2&&(t[2]=ke[2]));return!0}(n,e,t)}function Pn(n,e,t,r,s,u,l=1){const o=ce(e,s,de);if(f(o))return!1;if(o===vn){if(n===r&&t===u)return!0;const e=t+3*l;for(let s=t,l=u;s<e;s++,l++)r[l]=n[s];return!0}const a=t+3*l;for(let e=t,s=u;e<a;e+=3,s+=3)o(n,e,r,s);return!0}function xn(n,u,l,o,a){e(ye,n),t(Ee,n,u),yn(ye,l,ye,a),yn(Ee,l,Ee,a),r(o,Ee,ye),s(o,o)}function Sn(n,e,t,r,s,u,l=0){const o=new Array;for(const t of n)for(const n of t)o.push(n[0],n[1],e?n[2]:l);if(!Pn(o,r,0,o,u,0,o.length/3))return!1;let a=0;s.length=0;for(const r of n){const n=new Array;for(const s of r)e&&t?n.push([o[a++],o[a++],o[a++],s[3]]):e?n.push([o[a++],o[a++],o[a++]]):t?(n.push([o[a++],o[a++],s[2]]),a++):(n.push([o[a++],o[a++]]),a++);s.push(n)}return!0}function Tn(n,e,t,r){if(f(e)||f(r))return!1;const s=fe(e,r,je);if(s.projector===vn)return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],!0;if(f(s.projector))return!1;const{source:u,dest:l}=s;if(3===l.spatialReferenceId){const e=ie[u.spatialReferenceId][2];return!f(e)&&(e(n,0,ge,0),Ln(ge,0,t,0),t[3]=bn(ge[1],n[2],n[3],U.radius),!0)}if(2!==u.spatialReferenceId&&5!==u.spatialReferenceId||12!==l.spatialReferenceId)s.projector(n,0,t,0),t[3]=n[3]*u.metersPerUnit/l.metersPerUnit;else{const e=ie[u.spatialReferenceId][1],r=ie[1][12];let l=n[3];h(e)&&h(r)&&(l=bn(n[1],n[2],n[3],U.radius)),s.projector(n,0,t,0),t[3]=l}return!0}function bn(n,e,t,r){const s=Math.abs(Me*n)+Math.asin(t/(r+e));return s>=Math.PI/2?Number.MAX_VALUE:t/Math.cos(s)}function Cn(n,e,t,r){return null!=n&&(v(e,r)?(F(t,n),!0):(ke[0]=n[0],ke[1]=n[1],ke[2]=0,!!Pn(ke,e,0,ke,r,0,1)&&(t[0]=ke[0],t[1]=ke[1],ke[0]=n[2],ke[1]=n[3],ke[2]=0,!!Pn(ke,e,0,ke,r,0,1)&&(t[2]=ke[0],t[3]=ke[1],!0))))}function Fn(n,e,t,r){if(f(e)||f(r))return!1;const s=Gn(e,he),l=Gn(r,me);if(s===l&&0!==s||v(e,r))return t[0]=1,t[1]=1,t[2]=1,!0;if(1===s){const e=u(n),r=e/Math.sqrt(n[0]*n[0]+n[1]*n[1]),s=e/U.radius;if(3===l)return t[0]=r*s,t[1]=r*s,t[2]=1,!0;if(2===l||5===l){const n=180/(U.radius*Math.PI);return t[0]=n*r*s,t[1]=n*s,t[2]=1,!0}}else if(12===s&&(2===l||5===l))return t[0]=Jn,t[1]=Jn,t[2]=1,!0;return!1}function Un(n,e,t,r){if(f(n)||f(r))return!1;const s=Gn(n,he),u=Gn(r,me);if(s===u&&!qn(u)&&(0!==s||v(n,r)))return j(t),M(t,t,e),!0;if(qn(u)){const n=ie[s][11],r=ie[11][u];return!f(n)&&!f(r)&&(n(e,0,ge,0),r(ge,0,we,0),zn(Me*ge[0],Me*ge[1],t),t[12]=we[0],t[13]=we[1],t[14]=we[2],!0)}if(!(3!==u&&12!==u||2!==s&&1!==s)){const n=ie[s][11],r=ie[11][u];return!f(n)&&!f(r)&&(n(e,0,ge,0),r(ge,0,we,0),2===s?j(t):An(Me*ge[0],Me*ge[1],t),t[12]=we[0],t[13]=we[1],t[14]=we[2],!0)}return!1}function qn(n){return 1===n||7===n||9===n}function zn(n,e,t){const r=Math.sin(n),s=Math.cos(n),u=Math.sin(e),l=Math.cos(e),o=t;return o[0]=-r,o[4]=-u*s,o[8]=l*s,o[12]=0,o[1]=s,o[5]=-u*r,o[9]=l*r,o[13]=0,o[2]=0,o[6]=l,o[10]=u,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1,o}function An(n,e,t){return zn(n,e,t),R(t,t),t}function Gn(n,e){return e.spatialReference===n?e.spatialReferenceId:(e.spatialReference=n,"metersPerUnit"in e&&(e.metersPerUnit=d(n,1)),n.wkt===S.wkt?e.spatialReferenceId=1:Z(n)?e.spatialReferenceId=2:_(n)?e.spatialReferenceId=3:B(n)?e.spatialReferenceId=12:n.wkt===T.wkt?e.spatialReferenceId=4:4490===n.wkid?e.spatialReferenceId=5:n.wkt===b.wkt?e.spatialReferenceId=7:n.wkt===C.wkt?e.spatialReferenceId=9:L(n)?e.spatialReferenceId=8:N(n)?e.spatialReferenceId=10:e.spatialReferenceId=0)}function vn(n,e,t,r){n!==t&&(t[r++]=n[e++],t[r++]=n[e++],t[r]=n[e])}function Wn(n,e,t,r){t[r++]=Re*(n[e++]/U.radius),t[r++]=Re*(Math.PI/2-2*Math.atan(Math.exp(-n[e++]/U.radius))),t[r]=n[e]}function Zn(n,e,t,r){Wn(n,e,t,r),Yn(t,r,t,r)}function _n(n,e,t,r){Wn(n,e,t,r),ue(t,r,t,r)}function Bn(n,e,t,r,s){const u=.4999999*Math.PI,o=l(Me*n[e+1],-u,u),a=Math.sin(o);t[r++]=Me*n[e]*s.radius,t[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),t[r]=n[e+2]}function Ln(n,e,t,r){Bn(n,e,t,r,U)}const Nn=U.radius*Math.PI/180,Jn=180/(U.radius*Math.PI);function Kn(n,e,t,r){t[r]=n[e]*Nn,t[r+1]=n[e+1]*Nn,t[r+2]=n[e+2]}function On(n,e,t,r){t[r]=n[e]*Jn,t[r+1]=n[e+1]*Jn,t[r+2]=n[e+2]}function Vn(n){if(f(n))return!1;const e=Gn(n,he);return!!ie[e][6]}function Xn(n,e,t,r,s=0){const u=r+s,l=Math.cos(t);n[0]=Math.cos(e)*l*u,n[1]=Math.sin(e)*l*u,n[2]=Math.sin(t)*u}function Dn(n,e,t,r,s){const u=s+n[e+2],l=Me*n[e+1],o=Me*n[e],a=Math.cos(l);t[r++]=Math.cos(o)*a*u,t[r++]=Math.sin(o)*a*u,t[r]=Math.sin(l)*u}function Hn(n,e,t,r){Dn(n,e,t,r,q.radius)}function Qn(n,e,t,r){Dn(n,e,t,r,z.radius)}function Yn(n,e,t,r){Dn(n,e,t,r,U.radius)}function $n(n,e,t,r,s){const u=n[e],l=n[e+1],o=n[e+2],a=Math.sqrt(u*u+l*l+o*o),i=c(o/(0===a?1:a)),f=Math.atan2(l,u);t[r++]=Re*f,t[r++]=Re*i,t[r]=a-s}function ne(n,e,t,r){$n(n,e,t,r,q.radius)}function ee(n,e,t,r){$n(n,e,t,r,z.radius)}function te(n,e,t,r){$n(n,e,t,r,U.radius)}function re(n,e,t,r){te(n,e,t,r),Ln(t,r,t,r)}function se(n,e,t,r){te(n,e,t,r),ue(t,r,t,r)}function ue(n,e,t,r){!function(n,e,t,r,s){const u=Me*n[e],l=Me*n[e+1],o=n[e+2],a=Math.sin(l),i=Math.cos(l),c=s.radius/Math.sqrt(1-s.eccentricitySquared*a*a);t[r++]=(c+o)*i*Math.cos(u),t[r++]=(c+o)*i*Math.sin(u),t[r++]=(c*(1-s.eccentricitySquared)+o)*a}(n,e,t,r,U)}function le(n,e,t,r){const s=A,u=n[e],l=n[e+1],o=n[e+2];let a,i,c,f,p,h,m,d,j,M,R,k,g,w,y,E,I,P,x,S,T;a=Math.abs(o),i=u*u+l*l,c=Math.sqrt(i),f=i+o*o,p=Math.sqrt(f),S=Math.atan2(l,u),h=o*o/f,m=i/f,w=s.a2/p,y=s.a3-s.a4/p,m>.3?(d=a/p*(1+m*(s.a1+w+h*y)/p),x=Math.asin(d),M=d*d,j=Math.sqrt(1-M)):(j=c/p*(1-h*(s.a5-w-m*y)/p),x=Math.acos(j),M=1-j*j,d=Math.sqrt(M)),R=1-U.eccentricitySquared*M,k=U.radius/Math.sqrt(R),g=s.a6*k,w=c-k*j,y=a-g*d,I=j*w+d*y,E=j*y-d*w,P=E/(g/R+I),x+=P,T=I+E*P/2,o<0&&(x=-x),t[r++]=Re*S,t[r++]=Re*x,t[r]=T}function oe(n,e,t,r){le(n,e,t,r),Yn(t,r,t,r)}function ae(n,e,t,r){le(n,e,t,r),Ln(t,r,t,r)}const ie={2:{5:null,8:null,10:null,11:vn,6:vn,1:Yn,7:null,9:null,0:null,3:Ln,12:Kn,2:vn,4:ue},5:{5:vn,8:null,10:null,11:vn,6:vn,1:Yn,7:null,9:null,0:null,3:null,12:Kn,2:null,4:ue},8:{5:null,8:vn,10:null,11:vn,6:null,1:null,7:Qn,9:null,0:null,3:null,12:null,2:null,4:null},10:{5:null,8:null,10:vn,11:vn,6:null,1:null,7:null,9:Hn,0:null,3:null,12:null,2:null,4:null},3:{5:null,8:null,10:null,11:Wn,6:Wn,1:Zn,7:null,9:null,0:null,3:vn,12:function(n,e,t,r){Wn(n,e,t,r),Kn(t,r,t,r)},2:Wn,4:_n},4:{5:le,8:null,10:null,11:le,6:le,1:oe,7:null,9:null,0:null,3:ae,12:function(n,e,t,r){le(n,e,t,r),Kn(t,r,t,r)},2:le,4:vn},1:{5:te,8:null,10:null,11:te,6:te,1:vn,7:null,9:null,0:null,3:re,12:function(n,e,t,r){te(n,e,t,r),Kn(t,r,t,r)},2:te,4:se},7:{5:null,8:ee,10:null,11:ee,6:null,1:null,7:vn,9:null,0:null,3:null,12:null,2:null,4:null},9:{5:null,8:null,10:ne,11:ne,6:null,1:null,7:null,9:vn,0:null,3:null,12:null,2:null,4:null},0:{5:null,8:null,10:null,11:null,6:null,1:null,7:null,9:null,0:vn,3:null,12:null,2:null,4:null},11:{5:vn,8:vn,10:vn,11:vn,6:vn,1:Yn,7:Qn,9:Hn,0:null,3:Ln,12:Kn,2:vn,4:ue},6:{5:null,8:null,10:null,11:vn,6:vn,1:Yn,7:null,9:null,0:null,3:null,12:Kn,2:vn,4:ue},12:{5:On,8:null,10:null,11:On,6:On,1:function(n,e,t,r){On(n,e,t,r),Yn(t,r,t,r)},7:null,9:null,0:null,3:function(n,e,t,r){On(n,e,t,r),Ln(t,r,t,r)},12:vn,2:On,4:function(n,e,t,r){On(n,e,t,r),ue(t,r,t,r)}}};function ce(n,e,t=pe()){return f(n)||f(e)?null:fe(n,e,t).projector}function fe(n,e,t){if(f(n)||f(e)||t.source.spatialReference===n&&t.dest.spatialReference===e)return t;const r=Gn(n,t.source),s=Gn(e,t.dest);return 0===r&&0===s?v(n,e)?t.projector=vn:t.projector=null:t.projector=ie[r][s],t}function pe(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:vn}}const he={spatialReference:null,spatialReferenceId:0},me={spatialReference:null,spatialReferenceId:0},de=pe(),je=pe(),Me=o(1),Re=a(1),ke=i(),ge=i(),we=i(),ye=i(),Ee=i();export{Vn as canProjectToWGS84ComparableLonLat,rn as canProjectWithoutEngine,zn as computeENUToSphericalPCPFLocalRotation,An as computeSphericalPCPFToENULocalRotation,Un as computeTranslationToOriginAndRotation,un as getProjectorName,$ as getTransformation,nn as getTransformations,sn as initializeProjection,X as isLoaded,D as isSupported,H as load,Fn as localLinearScaleFactors,Xn as lonLatToSphericalPCPF,Bn as lonLatToWebMercatorComparable,Q as project,Cn as projectBoundingRect,Tn as projectBoundingSphere,Pn as projectBuffer,xn as projectDirection,jn as projectExtent,Y as projectMany,cn as projectMultipoint,on as projectPoint,gn as projectPointToVector,En as projectPointToWGS84ComparableLonLat,mn as projectPolygon,pn as projectPolyline,kn as projectVectorToDehydratedPoint,Rn as projectVectorToPoint,yn as projectVectorToVector,In as projectVectorToWGS84ComparableLonLat,ln as projectWithoutEngine,wn as projectXYZToVector,$n as sphericalPCPFtoLonLatElevation,tn as unload};
