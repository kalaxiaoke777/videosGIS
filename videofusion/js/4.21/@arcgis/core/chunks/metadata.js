/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{clone as r,a as t}from"../core/lang.js";import{h as e}from"./handleUtils.js";function n(r){return r?r.__accessor__?r.__accessor__:r.propertyInvalidated?r:null:null}function a(r,t){return null!=r&&r.metadatas&&null!=r.metadatas[t]}function o(r,t,e){if(e){return s(r,t,{policy:e,path:""})}return s(r,t,null)}function s(e,n,a){return n?Object.keys(n).reduce((function(e,o){let c=null,u="merge";if(a&&(c=a.path?`${a.path}.${o}`:o,u=a.policy(c)),"replace"===u)return e[o]=n[o],e;if(void 0===e[o])return e[o]=r(n[o]),e;let i=e[o],l=n[o];if(i===l)return e;if(Array.isArray(l)||Array.isArray(e))i=i?Array.isArray(i)?e[o]=i.concat():e[o]=[i]:e[o]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach((r=>{-1===i.indexOf(r)&&i.push(r)})));else if(l&&"object"==typeof l)if(a){const r=a.path;a.path=t(c),e[o]=s(i,l,a),a.path=r}else e[o]=s(i,l,null);else e.hasOwnProperty(o)&&!n.hasOwnProperty(o)||(e[o]=l);return e}),e||{}):e}function c(r){return Array.isArray(r)?r:r.split(".")}function u(r){return r.indexOf(",")>-1?r.split(",").map((r=>r.trim())):[r.trim()]}function i(r,t,n,a){const o=function(r){if(Array.isArray(r)){const t=[];for(const e of r)t.push(...u(e));return t}return u(r)}(t);if(1!==o.length){const t=o.map((t=>a(r,t,n)));return e(t)}return a(r,o[0],n)}function l(r){let t=!1;return()=>{t||(t=!0,r())}}class f{constructor(r){this.autoDestroy=!1,this.properties=r}}function p(e){let n=e.constructor.__accessorMetadata__;const a=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(n){if(!a){const t=Object.create(n.properties),a=n.autoDestroy;for(const e in t)t[e]=r(t[e]);n=new f(t),n.autoDestroy=a,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:n,enumerable:!1,configurable:!0,writable:!0})}}else n=new f({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:n,enumerable:!1,configurable:!0,writable:!0});return t(e.constructor.__accessorMetadata__)}function y(r,t){const e=function(r){return p(r).properties}(r);let n=e[t];return n||(n=e[t]={}),n}function _(r,t){return o(r,t,h)}const d=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function h(r){return d.test(r)?"replace":"merge"}export{y as a,_ as b,p as c,i as d,n as g,a as i,o as m,l as o,c as p};
