/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{a as t,b as r,h as e}from"./colorUtils.js";import n from"../core/Error.js";import{p as a}from"./screenUtils.js";import{c as o}from"./mat4f32.js";import{a as u,h as s}from"./mat4.js";import{c as i}from"./_commonjsHelpers.js";class c{constructor(t,r,e){this.strength=t,this.radius=r,this.threshold=e,this.type="bloom"}interpolate(t,r,e){this.strength=d(t.strength,r.strength,e),this.radius=d(t.radius,r.radius,e),this.threshold=d(t.threshold,r.threshold,e)}clone(){return new c(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:g(this.radius),strength:this.strength,threshold:this.threshold}}}class l{constructor(t){this.radius=t,this.type="blur"}interpolate(t,r,e){this.radius=Math.round(d(t.radius,r.radius,e))}clone(){return new l(this.radius)}toJSON(){return{type:"blur",radius:g(this.radius)}}}class h{constructor(t,r){this.type=t,this.amount=r,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,e){this.amount=d(t.amount,r.amount,e),this._updateMatrix()}clone(){return new h(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||o();switch(this.type){case"brightness":this._colorMatrix=((t,r)=>{const e=s(t,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1);return u(e,e)})(t,this.amount);break;case"contrast":this._colorMatrix=((t,r)=>{const e=s(t,r,0,0,.5-.5*r,0,r,0,.5-.5*r,0,0,r,.5-.5*r,0,0,0,1);return u(e,e)})(t,this.amount);break;case"grayscale":this._colorMatrix=((t,r)=>{const e=1-r,n=s(t,.2126+.7874*e,.7152-.7152*e,.0722-.0722*e,0,.2126-.2126*e,.7152+.2848*e,.0722-.0722*e,0,.2126-.2126*e,.7152-.7152*e,.0722+.9278*e,0,0,0,0,1);return u(n,n)})(t,this.amount);break;case"invert":this._colorMatrix=((t,r)=>{const e=1-2*r,n=s(t,e,0,0,r,0,e,0,r,0,0,e,r,0,0,0,1);return u(n,n)})(t,this.amount);break;case"saturate":this._colorMatrix=((t,r)=>{const e=s(t,.213+.787*r,.715-.715*r,.072-.072*r,0,.213-.213*r,.715+.285*r,.072-.072*r,0,.213-.213*r,.715-.715*r,.072+.928*r,0,0,0,0,1);return u(e,e)})(t,this.amount);break;case"sepia":this._colorMatrix=((t,r)=>{const e=1-r,n=s(t,.393+.607*e,.769-.769*e,.189-.189*e,0,.349-.349*e,.686+.314*e,.168-.168*e,0,.272-.272*e,.534-.534*e,.131+.869*e,0,0,0,0,1);return u(n,n)})(t,this.amount)}}}class f{constructor(t,r,e,n){this.offsetX=t,this.offsetY=r,this.blurRadius=e,this.color=n,this.type="drop-shadow"}interpolate(t,r,e){this.offsetX=d(t.offsetX,r.offsetX,e),this.offsetY=d(t.offsetY,r.offsetY,e),this.blurRadius=d(t.blurRadius,r.blurRadius,e),this.color[0]=Math.round(d(t.color[0],r.color[0],e)),this.color[1]=Math.round(d(t.color[1],r.color[1],e)),this.color[2]=Math.round(d(t.color[2],r.color[2],e)),this.color[3]=d(t.color[3],r.color[3],e)}clone(){return new f(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:g(this.offsetX),yoffset:g(this.offsetY),blurRadius:g(this.blurRadius),color:t}}}class p{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,e){this.angle=d(t.angle,r.angle,e),this._updateMatrix()}clone(){return new p(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||o();this._colorMatrix=((t,r)=>{const e=Math.sin(r*Math.PI/180),n=Math.cos(r*Math.PI/180),a=s(t,.213+.787*n-.213*e,.715-.715*n-.715*e,.072-.072*n+.928*e,0,.213-.213*n+.143*e,.715+.285*n+.14*e,.072-.072*n-.283*e,0,.213-.213*n-.787*e,.715-.715*n+.715*e,.072+.928*n+.072*e,0,0,0,0,1);return u(a,a)})(t,this.angle)}}class m{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,r,e){this.amount=d(t.amount,r.amount,e)}clone(){return new m(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function d(t,r,e){return t+(r-t)*e}function g(t){return Math.round(1e3*a(t))/1e3}var y,v={exports:{}};function x(t){let r;try{r=t?v.exports.parse(t):[]}catch(r){return{input:t,parsedFunctions:[],effects:[],error:new n("effect:invalid-syntax","Invalid effect syntax",{input:t,error:r})}}const e={input:t,parsedFunctions:r,effects:[],error:null};try{for(const t of r)e.effects.push(w(t))}catch(t){e.effects.length=0,e.error=t}return e}function w(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(t){let r=1;A(t.parameters,1),1===t.parameters.length&&(r=F(t.parameters[0]));return new h(t.name,r)}(t);case"opacity":return function(t){let r=1;A(t.parameters,1),1===t.parameters.length&&(r=F(t.parameters[0]));return new m(r)}(t);case"hue-rotate":return function(t){let r=0;A(t.parameters,1),1===t.parameters.length&&(function(t){if("quantity"!==t.type||(0!==t.value||null!==t.unit)&&null==_[t.unit])throw new n("effect:type-error",`Expected <angle>, Actual: ${b(t)}`,{term:t})}(e=t.parameters[0]),r=e.value*_[e.unit]||0);var e;return new p(r)}(t);case"blur":return function(t){let r=0;A(t.parameters,1),1===t.parameters.length&&(r=R(t.parameters[0]),M(r,t.parameters[0]));return new l(r)}(t);case"drop-shadow":return function(t){const r=[];let e;for(const a of t.parameters)if("color"===a.type){if(r.length&&Object.freeze(r),e)throw new n("effect:type-error","Accepts only one color",{});e=S(a)}else{const t=R(a);if(Object.isFrozen(r))throw new n("effect:type-error","<length> parameters not consecutive",{lengths:r});r.push(t),3===r.length&&M(t,a)}if(r.length<2||r.length>3)throw new n("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${r.length}}`,{lengths:r});return new f(r[0],r[1],r[2]||0,e||$("black"))}(t);case"bloom":return function(t){let r=1,e=0,n=0;A(t.parameters,3),t.parameters[0]&&(r=F(t.parameters[0]));t.parameters[1]&&(e=R(t.parameters[1]),M(e,t.parameters[1]));t.parameters[2]&&(n=F(t.parameters[2]));return new c(r,e,n)}(t)}}catch(r){throw r.details.filter=t,r}throw new n("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function A(t,r){if(t.length>r)throw new n("effect:type-error",`Function supports up to ${r} parameters, Actual: ${t.length}`,{parameters:t})}function b(t){return"color"===t.type?"<color>":C[t.unit]?"<length>":_[t.unit]?"<angle>":"%"===t.unit?"<percentage>":"<double>"}function M(t,r){if(t<0)throw new n("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:r})}(y=v).exports&&(y.exports=function(){function t(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}function r(t,e,n,a){this.message=t,this.expected=e,this.found=n,this.location=a,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r)}function e(t,e){e=void 0!==e?e:{};var n,a={},o={start:Dt},u=Dt,s=Tt("none"),i="none",c=qt("none",!1),l=function(){return[]},h=")",f=qt(")",!1),p=function(t,r){return{type:"function",name:t,parameters:r||[]}},m=",",d=qt(",",!1),g=function(t,r){return r.length>0?ir(t,r,3):[t]},y=function(t){return{type:"quantity",value:t.value,unit:t.unit}},v=function(t){return{type:"color",colorType:t.type,value:t.value}},x=Tt("whitespace"),w=/^[ \t\n\r]/,A=It([" ","\t","\n","\r"],!1,!1),b=Tt("function"),M="(",_=qt("(",!1),C=function(t){return t},F=Tt("identifier"),E=/^[a-z\-]/,R=It([["a","z"],"-"],!1,!1),S=function(){return Yt()},$=Tt("percentage"),j="%",k=qt("%",!1),O=function(t){return{value:t,unit:"%"}},N=Tt("length"),J="px",X=qt("px",!1),Y=function(t){return{value:t,unit:"px"}},q="cm",I=qt("cm",!1),z=function(t){return{value:t,unit:"cm"}},T="mm",P=qt("mm",!1),U=function(t){return{value:t,unit:"mm"}},H="in",B=qt("in",!1),D=function(t){return{value:t,unit:"in"}},G="pt",K=qt("pt",!1),L=function(t){return{value:t,unit:"pt"}},Q="pc",V=qt("pc",!1),W=function(t){return{value:t,unit:"pc"}},Z=Tt("angle"),tt="deg",rt=qt("deg",!1),et=function(t){return{value:t,unit:"deg"}},nt="rad",at=qt("rad",!1),ot=function(t){return{value:t,unit:"rad"}},ut="grad",st=qt("grad",!1),it=function(t){return{value:t,unit:"grad"}},ct="turn",lt=qt("turn",!1),ht=function(t){return{value:t,unit:"turn"}},ft=Tt("number"),pt=function(t){return{value:t,unit:null}},mt=Tt("color"),dt="#",gt=qt("#",!1),yt=/^[0-9a-fA-F]/,vt=It([["0","9"],["a","f"],["A","F"]],!1,!1),xt=function(){return{type:"hex",value:Yt()}},wt=function(t){return{type:"function",value:t}},At=function(){return{type:"named",value:Yt()}},bt=/^[+\-]/,Mt=It(["+","-"],!1,!1),_t=/^[0-9]/,Ct=It([["0","9"]],!1,!1),Ft=".",Et=qt(".",!1),Rt="e",St=qt("e",!1),$t=function(){return parseFloat(Yt())},jt=0,kt=0,Ot=[{line:1,column:1}],Nt=0,Jt=[],Xt=0;if("startRule"in e){if(!(e.startRule in o))throw new Error("Can't start parsing from rule \""+e.startRule+'".');u=o[e.startRule]}function Yt(){return t.substring(kt,jt)}function qt(t,r){return{type:"literal",text:t,ignoreCase:r}}function It(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function zt(){return{type:"end"}}function Tt(t){return{type:"other",description:t}}function Pt(r){var e,n=Ot[r];if(n)return n;for(e=r-1;!Ot[e];)e--;for(n={line:(n=Ot[e]).line,column:n.column};e<r;)10===t.charCodeAt(e)?(n.line++,n.column=1):n.column++,e++;return Ot[r]=n,n}function Ut(t,r){var e=Pt(t),n=Pt(r);return{start:{offset:t,line:e.line,column:e.column},end:{offset:r,line:n.line,column:n.column}}}function Ht(t){jt<Nt||(jt>Nt&&(Nt=jt,Jt=[]),Jt.push(t))}function Bt(t,e,n){return new r(r.buildMessage(t,e),t,e,n)}function Dt(){var t;return(t=Gt())===a&&(t=Kt()),t}function Gt(){var r,e;return Xt++,r=jt,Wt()!==a?(t.substr(jt,4)===i?(e=i,jt+=4):(e=a,0===Xt&&Ht(c)),e!==a&&Wt()!==a?(kt=r,r=l()):(jt=r,r=a)):(jt=r,r=a),Xt--,r===a&&0===Xt&&Ht(s),r}function Kt(){var t,r;if(t=[],(r=Lt())!==a)for(;r!==a;)t.push(r),r=Lt();else t=a;return t}function Lt(){var r,e,n,o;return r=jt,Wt()!==a&&(e=Zt())!==a&&Wt()!==a?((n=Qt())===a&&(n=null),n!==a&&Wt()!==a?(41===t.charCodeAt(jt)?(o=h,jt++):(o=a,0===Xt&&Ht(f)),o!==a&&Wt()!==a?(kt=r,r=p(e,n)):(jt=r,r=a)):(jt=r,r=a)):(jt=r,r=a),r}function Qt(){var r,e,n,o,u,s,i,c;if(r=jt,(e=Vt())!==a){for(n=[],o=jt,(u=Wt())!==a?(44===t.charCodeAt(jt)?(s=m,jt++):(s=a,0===Xt&&Ht(d)),s===a&&(s=null),s!==a&&(i=Wt())!==a&&(c=Vt())!==a?o=u=[u,s,i,c]:(jt=o,o=a)):(jt=o,o=a);o!==a;)n.push(o),o=jt,(u=Wt())!==a?(44===t.charCodeAt(jt)?(s=m,jt++):(s=a,0===Xt&&Ht(d)),s===a&&(s=null),s!==a&&(i=Wt())!==a&&(c=Vt())!==a?o=u=[u,s,i,c]:(jt=o,o=a)):(jt=o,o=a);n!==a?(kt=r,r=e=g(e,n)):(jt=r,r=a)}else jt=r,r=a;return r}function Vt(){var t,r;return t=jt,(r=rr())===a&&(r=er())===a&&(r=nr())===a&&(r=ar()),r!==a&&(kt=t,r=y(r)),(t=r)===a&&(t=jt,(r=or())!==a&&(kt=t,r=v(r)),t=r),t}function Wt(){var r,e;for(Xt++,r=[],w.test(t.charAt(jt))?(e=t.charAt(jt),jt++):(e=a,0===Xt&&Ht(A));e!==a;)r.push(e),w.test(t.charAt(jt))?(e=t.charAt(jt),jt++):(e=a,0===Xt&&Ht(A));return Xt--,r===a&&(e=a,0===Xt&&Ht(x)),r}function Zt(){var r,e,n;return Xt++,r=jt,(e=tr())!==a?(40===t.charCodeAt(jt)?(n=M,jt++):(n=a,0===Xt&&Ht(_)),n!==a?(kt=r,r=e=C(e)):(jt=r,r=a)):(jt=r,r=a),Xt--,r===a&&(e=a,0===Xt&&Ht(b)),r}function tr(){var r,e,n;if(Xt++,r=jt,e=[],E.test(t.charAt(jt))?(n=t.charAt(jt),jt++):(n=a,0===Xt&&Ht(R)),n!==a)for(;n!==a;)e.push(n),E.test(t.charAt(jt))?(n=t.charAt(jt),jt++):(n=a,0===Xt&&Ht(R));else e=a;return e!==a&&(kt=r,e=S()),Xt--,(r=e)===a&&(e=a,0===Xt&&Ht(F)),r}function rr(){var r,e,n;return Xt++,r=jt,Wt()!==a&&(e=ur())!==a?(37===t.charCodeAt(jt)?(n=j,jt++):(n=a,0===Xt&&Ht(k)),n!==a?(kt=r,r=O(e)):(jt=r,r=a)):(jt=r,r=a),Xt--,r===a&&0===Xt&&Ht($),r}function er(){var r,e,n;return Xt++,r=jt,Wt()!==a&&(e=ur())!==a?(t.substr(jt,2)===J?(n=J,jt+=2):(n=a,0===Xt&&Ht(X)),n!==a?(kt=r,r=Y(e)):(jt=r,r=a)):(jt=r,r=a),r===a&&(r=jt,Wt()!==a&&(e=ur())!==a?(t.substr(jt,2)===q?(n=q,jt+=2):(n=a,0===Xt&&Ht(I)),n!==a?(kt=r,r=z(e)):(jt=r,r=a)):(jt=r,r=a),r===a&&(r=jt,Wt()!==a&&(e=ur())!==a?(t.substr(jt,2)===T?(n=T,jt+=2):(n=a,0===Xt&&Ht(P)),n!==a?(kt=r,r=U(e)):(jt=r,r=a)):(jt=r,r=a),r===a&&(r=jt,Wt()!==a&&(e=ur())!==a?(t.substr(jt,2)===H?(n=H,jt+=2):(n=a,0===Xt&&Ht(B)),n!==a?(kt=r,r=D(e)):(jt=r,r=a)):(jt=r,r=a),r===a&&(r=jt,Wt()!==a&&(e=ur())!==a?(t.substr(jt,2)===G?(n=G,jt+=2):(n=a,0===Xt&&Ht(K)),n!==a?(kt=r,r=L(e)):(jt=r,r=a)):(jt=r,r=a),r===a&&(r=jt,Wt()!==a&&(e=ur())!==a?(t.substr(jt,2)===Q?(n=Q,jt+=2):(n=a,0===Xt&&Ht(V)),n!==a?(kt=r,r=W(e)):(jt=r,r=a)):(jt=r,r=a)))))),Xt--,r===a&&0===Xt&&Ht(N),r}function nr(){var r,e,n;return Xt++,r=jt,(e=ur())!==a?(t.substr(jt,3)===tt?(n=tt,jt+=3):(n=a,0===Xt&&Ht(rt)),n!==a?(kt=r,r=e=et(e)):(jt=r,r=a)):(jt=r,r=a),r===a&&(r=jt,(e=ur())!==a?(t.substr(jt,3)===nt?(n=nt,jt+=3):(n=a,0===Xt&&Ht(at)),n!==a?(kt=r,r=e=ot(e)):(jt=r,r=a)):(jt=r,r=a),r===a&&(r=jt,(e=ur())!==a?(t.substr(jt,4)===ut?(n=ut,jt+=4):(n=a,0===Xt&&Ht(st)),n!==a?(kt=r,r=e=it(e)):(jt=r,r=a)):(jt=r,r=a),r===a&&(r=jt,(e=ur())!==a?(t.substr(jt,4)===ct?(n=ct,jt+=4):(n=a,0===Xt&&Ht(lt)),n!==a?(kt=r,r=e=ht(e)):(jt=r,r=a)):(jt=r,r=a)))),Xt--,r===a&&(e=a,0===Xt&&Ht(Z)),r}function ar(){var t,r;return Xt++,t=jt,Wt()!==a&&(r=ur())!==a?(kt=t,t=pt(r)):(jt=t,t=a),Xt--,t===a&&0===Xt&&Ht(ft),t}function or(){var r,e,n,o;if(Xt++,r=jt,35===t.charCodeAt(jt)?(e=dt,jt++):(e=a,0===Xt&&Ht(gt)),e!==a){if(n=[],yt.test(t.charAt(jt))?(o=t.charAt(jt),jt++):(o=a,0===Xt&&Ht(vt)),o!==a)for(;o!==a;)n.push(o),yt.test(t.charAt(jt))?(o=t.charAt(jt),jt++):(o=a,0===Xt&&Ht(vt));else n=a;n!==a?(kt=r,r=e=xt()):(jt=r,r=a)}else jt=r,r=a;return r===a&&(r=jt,(e=Lt())!==a&&(kt=r,e=wt(e)),(r=e)===a&&(r=jt,(e=tr())!==a&&(kt=r,e=At()),r=e)),Xt--,r===a&&(e=a,0===Xt&&Ht(mt)),r}function ur(){var r,e,n,o,u,s,i,c;if(r=jt,bt.test(t.charAt(jt))?(e=t.charAt(jt),jt++):(e=a,0===Xt&&Ht(Mt)),e===a&&(e=null),e!==a){for(n=jt,o=[],_t.test(t.charAt(jt))?(u=t.charAt(jt),jt++):(u=a,0===Xt&&Ht(Ct));u!==a;)o.push(u),_t.test(t.charAt(jt))?(u=t.charAt(jt),jt++):(u=a,0===Xt&&Ht(Ct));if(o!==a)if(46===t.charCodeAt(jt)?(u=Ft,jt++):(u=a,0===Xt&&Ht(Et)),u!==a){if(s=[],_t.test(t.charAt(jt))?(i=t.charAt(jt),jt++):(i=a,0===Xt&&Ht(Ct)),i!==a)for(;i!==a;)s.push(i),_t.test(t.charAt(jt))?(i=t.charAt(jt),jt++):(i=a,0===Xt&&Ht(Ct));else s=a;s!==a?n=o=[o,u,s]:(jt=n,n=a)}else jt=n,n=a;else jt=n,n=a;if(n===a)if(n=[],_t.test(t.charAt(jt))?(o=t.charAt(jt),jt++):(o=a,0===Xt&&Ht(Ct)),o!==a)for(;o!==a;)n.push(o),_t.test(t.charAt(jt))?(o=t.charAt(jt),jt++):(o=a,0===Xt&&Ht(Ct));else n=a;if(n!==a){if(o=jt,101===t.charCodeAt(jt)?(u=Rt,jt++):(u=a,0===Xt&&Ht(St)),u!==a)if(bt.test(t.charAt(jt))?(s=t.charAt(jt),jt++):(s=a,0===Xt&&Ht(Mt)),s===a&&(s=null),s!==a){if(i=[],_t.test(t.charAt(jt))?(c=t.charAt(jt),jt++):(c=a,0===Xt&&Ht(Ct)),c!==a)for(;c!==a;)i.push(c),_t.test(t.charAt(jt))?(c=t.charAt(jt),jt++):(c=a,0===Xt&&Ht(Ct));else i=a;i!==a?o=u=[u,s,i]:(jt=o,o=a)}else jt=o,o=a;else jt=o,o=a;o===a&&(o=null),o!==a?(kt=r,r=e=$t()):(jt=r,r=a)}else jt=r,r=a}else jt=r,r=a;return r}function sr(t,r){return t.map((function(t){return t[r]}))}function ir(t,r,e){return[t].concat(sr(r,e))}if((n=u())!==a&&jt===t.length)return n;throw n!==a&&jt<t.length&&Ht(zt()),Bt(Jt,Nt<t.length?t.charAt(Nt):null,Nt<t.length?Ut(Nt,Nt+1):Ut(Nt,Nt))}return t(r,Error),r.buildMessage=function(t,r){var e={literal:function(t){return'"'+a(t.text)+'"'},class:function(t){var r,e="";for(r=0;r<t.parts.length;r++)e+=t.parts[r]instanceof Array?o(t.parts[r][0])+"-"+o(t.parts[r][1]):o(t.parts[r]);return"["+(t.inverted?"^":"")+e+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function a(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function u(t){return e[t.type](t)}function s(t){var r,e,n=new Array(t.length);for(r=0;r<t.length;r++)n[r]=u(t[r]);if(n.sort(),n.length>0){for(r=1,e=1;r<n.length;r++)n[r-1]!==n[r]&&(n[e]=n[r],e++);n.length=e}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}function i(t){return t?'"'+a(t)+'"':"end of input"}return"Expected "+s(t)+" but "+i(r)+" found."},{SyntaxError:r,parse:e}}());const _={deg:1,grad:.9,rad:180/Math.PI,turn:360};const C={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function F(t){!function(t){if("quantity"!==t.type||null!==t.unit&&"%"!==t.unit)throw new n("effect:type-error",`Expected <double> or <percentage>, Actual: ${b(t)}`,{term:t})}(t);const r=t.value;return M(r,t),"%"===t.unit?.01*r:r}function E(t){return function(t){if("quantity"!==t.type||null!==t.unit)throw new n("effect:type-error",`Expected <double>, Actual: ${b(t)}`,{term:t})}(t),M(t.value,t),t.value}function R(t){return function(t){if("quantity"!==t.type||(0!==t.value||null!==t.unit)&&null==C[t.unit])throw new n("effect:type-error",`Expected <length>, Actual: ${b(t)}`,{term:t})}(t),t.value*C[t.unit]||0}function S(r){switch(r.colorType){case"hex":return t(r.value);case"named":return $(r.value);case"function":return function(t){if(A(t.parameters,4),j.test(t.name))return[F(t.parameters[0]),F(t.parameters[1]),F(t.parameters[2]),t.parameters[3]?F(t.parameters[3]):1];if(k.test(t.name))return e(E(t.parameters[0]),F(t.parameters[1]),F(t.parameters[2]),t.parameters[3]?F(t.parameters[3]):1);throw new n("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}(r.value)}}function $(t){const e=r(t);if(!e)throw new n("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return e}const j=/^rgba?/i,k=/^hsla?/i;export{c as B,h as C,f as D,p as H,m as O,l as a,x as p};
