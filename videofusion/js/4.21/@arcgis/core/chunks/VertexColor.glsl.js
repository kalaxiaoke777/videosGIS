/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{u as e}from"./mat4.js";import{g as t,b as o,e as r,a as f}from"./BufferView.js";import{a as s}from"./Util.js";import{g as i}from"./OutputDepth.glsl.js";function n(e,t,o,r){const f=o.typedBuffer,s=o.typedBufferStride,i=e.length;r*=s;for(let o=0;o<i;++o){const i=2*e[o];f[r]=t[i],f[r+1]=t[i+1],r+=s}}function l(e,t,o,r,f){const s=o.typedBuffer,i=o.typedBufferStride,n=e.length;if(r*=i,null==f||1===f)for(let o=0;o<n;++o){const f=3*e[o];s[r]=t[f],s[r+1]=t[f+1],s[r+2]=t[f+2],r+=i}else for(let o=0;o<n;++o){const n=3*e[o];for(let e=0;e<f;++e)s[r]=t[n],s[r+1]=t[n+1],s[r+2]=t[n+2],r+=i}}function c(e,t,o,r,f=1){const s=o.typedBuffer,i=o.typedBufferStride,n=e.length;if(r*=i,1===f)for(let o=0;o<n;++o){const f=4*e[o];s[r]=t[f],s[r+1]=t[f+1],s[r+2]=t[f+2],s[r+3]=t[f+3],r+=i}else for(let o=0;o<n;++o){const n=4*e[o];for(let e=0;e<f;++e)s[r]=t[n],s[r+1]=t[n+1],s[r+2]=t[n+2],s[r+3]=t[n+3],r+=i}}function a(e,t,o,r,f,s=1){if(!o)return void l(e,t,r,f,s);const i=r.typedBuffer,n=r.typedBufferStride,c=e.length,a=o[0],d=o[1],u=o[2],p=o[4],g=o[5],v=o[6],y=o[8],B=o[9],m=o[10],h=o[12],b=o[13],z=o[14];if(f*=n,1===s)for(let o=0;o<c;++o){const r=3*e[o],s=t[r],l=t[r+1],c=t[r+2];i[f]=a*s+p*l+y*c+h,i[f+1]=d*s+g*l+B*c+b,i[f+2]=u*s+v*l+m*c+z,f+=n}else for(let o=0;o<c;++o){const r=3*e[o],l=t[r],c=t[r+1],x=t[r+2],C=a*l+p*c+y*x+h,w=d*l+g*c+B*x+b,S=u*l+v*c+m*x+z;for(let e=0;e<s;++e)i[f]=C,i[f+1]=w,i[f+2]=S,f+=n}}function d(t,o,r,f,s,i=1){if(!r)return void l(t,o,f,s,i);const n=r,c=f.typedBuffer,a=f.typedBufferStride,d=t.length,u=n[0],p=n[1],g=n[2],v=n[4],y=n[5],B=n[6],m=n[8],h=n[9],b=n[10],z=!e(n),x=1e-6,C=.999999;if(s*=a,1===i)for(let e=0;e<d;++e){const r=3*t[e],f=o[r],i=o[r+1],n=o[r+2];let l=u*f+v*i+m*n,d=p*f+y*i+h*n,w=g*f+B*i+b*n;if(z){const e=l*l+d*d+w*w;if(e<C&&e>x){const t=1/Math.sqrt(e);l*=t,d*=t,w*=t}}c[s+0]=l,c[s+1]=d,c[s+2]=w,s+=a}else for(let e=0;e<d;++e){const r=3*t[e],f=o[r],n=o[r+1],l=o[r+2];let d=u*f+v*n+m*l,w=p*f+y*n+h*l,S=g*f+B*n+b*l;if(z){const e=d*d+w*w+S*S;if(e<C&&e>x){const t=1/Math.sqrt(e);d*=t,w*=t,S*=t}}for(let e=0;e<i;++e)c[s+0]=d,c[s+1]=w,c[s+2]=S,s+=a}}function u(t,o,r,f,s,i=1){if(!r)return void c(t,o,f,s,i);const n=r,l=f.typedBuffer,a=f.typedBufferStride,d=t.length,u=n[0],p=n[1],g=n[2],v=n[4],y=n[5],B=n[6],m=n[8],h=n[9],b=n[10],z=!e(n),x=1e-6,C=.999999;if(s*=a,1===i)for(let e=0;e<d;++e){const r=4*t[e],f=o[r],i=o[r+1],n=o[r+2],c=o[r+3];let d=u*f+v*i+m*n,w=p*f+y*i+h*n,S=g*f+B*i+b*n;if(z){const e=d*d+w*w+S*S;if(e<C&&e>x){const t=1/Math.sqrt(e);d*=t,w*=t,S*=t}}l[s+0]=d,l[s+1]=w,l[s+2]=S,l[s+3]=c,s+=a}else for(let e=0;e<d;++e){const r=4*t[e],f=o[r],n=o[r+1],c=o[r+2],d=o[r+3];let w=u*f+v*n+m*c,S=p*f+y*n+h*c,k=g*f+B*n+b*c;if(z){const e=w*w+S*S+k*k;if(e<C&&e>x){const t=1/Math.sqrt(e);w*=t,S*=t,k*=t}}for(let e=0;e<i;++e)l[s+0]=w,l[s+1]=S,l[s+2]=k,l[s+3]=d,s+=a}}function p(e,t,o,r,f,s=1){const i=r.typedBuffer,n=r.typedBufferStride,l=e.length;if(f*=n,1===s){if(4===o)for(let o=0;o<l;++o){const r=4*e[o];i[f]=t[r],i[f+1]=t[r+1],i[f+2]=t[r+2],i[f+3]=t[r+3],f+=n}else if(3===o)for(let o=0;o<l;++o){const r=3*e[o];i[f]=t[r],i[f+1]=t[r+1],i[f+2]=t[r+2],i[f+3]=255,f+=n}}else if(4===o)for(let o=0;o<l;++o){const r=4*e[o];for(let e=0;e<s;++e)i[f]=t[r],i[f+1]=t[r+1],i[f+2]=t[r+2],i[f+3]=t[r+3],f+=n}else if(3===o)for(let o=0;o<l;++o){const r=3*e[o];for(let e=0;e<s;++e)i[f]=t[r],i[f+1]=t[r+1],i[f+2]=t[r+2],i[f+3]=255,f+=n}}function g(e,i,l,c,g,v){for(const y of i.fieldNames){const i=e.vertexAttributes.get(y),B=e.indices.get(y);if(i&&B)switch(y){case"position":{s(3===i.size);const e=g.getField(y,f);e&&a(B,i.data,l,e,v);break}case"normal":{s(3===i.size);const e=g.getField(y,f);e&&d(B,i.data,c,e,v);break}case"uv0":{s(2===i.size);const e=g.getField(y,r);e&&n(B,i.data,e,v);break}case"color":{s(3===i.size||4===i.size);const e=g.getField(y,o);e&&p(B,i.data,i.size,e,v);break}case"symbolColor":{s(3===i.size||4===i.size);const e=g.getField(y,o);e&&p(B,i.data,i.size,e,v);break}case"tangent":{s(4===i.size);const e=g.getField(y,t);e&&u(B,i.data,c,e,v);break}}}}function v(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(i`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(i`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(i`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}export{v as V,d as a,c as b,g as c,p as d,a as w};
