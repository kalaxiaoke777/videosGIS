/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{i as e}from"../core/lang.js";import{urlToObject as r,removeTrailingSlash as t,removeQueryParameters as s,join as n,Url as i,makeAbsolute as a}from"../core/urlUtils.js";import{w as l}from"./persistableUrlUtils.js";const o={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},u=Object.values(o),c=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${u.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),f=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${u.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),p=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function v(e){return!!c.test(e)}function d(e){const t=r(e),s=t.path.match(c)||t.path.match(f);if(!s)return null;const[,n,i,a,l]=s,u=i.indexOf("/");return{title:w(-1!==u?i.slice(u+1):i),serverType:o[a.toLowerCase()],sublayer:null!=l&&""!==l?parseInt(l,10):null,url:{path:n}}}function m(e){const t=r(e).path.match(p);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function w(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function h(r,t){const s=[];if(r){const t=d(r);e(t)&&t.title&&s.push(t.title)}if(t){const e=w(t);s.push(e)}if(2===s.length){if(-1!==s[0].toLowerCase().indexOf(s[1].toLowerCase()))return s[0];if(-1!==s[1].toLowerCase().indexOf(s[0].toLowerCase()))return s[1]}return s.join(" - ")}function y(e){if(!e)return!1;const r=-1!==(e=e.toLowerCase()).indexOf(".arcgis.com/"),t=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features");return r&&t}function g(e,r){return e?t(s(e,r)):e}function x(n){let{url:i}=n;if(!i)return{url:i};i=s(i,n.logger);const a=r(i),l=d(a.path);let o;if(e(l))null!=l.sublayer&&null==n.layer.layerId&&(o=l.sublayer),i=l.url.path;else if(n.nonStandardUrlAllowed){const r=m(a.path);e(r)&&(i=r.serviceUrl,o=r.sublayerId)}return{url:t(i),layerId:o}}function O(e,r,t,s,i){l(r,s,"url",i),s.url&&null!=e.layerId&&(s.url=n(s.url,t,e.layerId.toString()))}function S(e){if(!e)return!1;const r=e.toLowerCase(),t=-1!==r.indexOf("/services/"),s=-1!==r.indexOf("/mapserver/wmsserver"),n=-1!==r.indexOf("/imageserver/wmsserver"),i=-1!==r.indexOf("/wmsserver");return t&&(s||n||i)}function b(e){if(!e)return!1;const r=new i(a(e)).authority.toLowerCase();return"server.arcgisonline.com"===r||"services.arcgisonline.com"===r}export{x as a,y as b,w as c,v as d,S as e,m as f,b as i,d as p,g as s,h as t,O as w};
