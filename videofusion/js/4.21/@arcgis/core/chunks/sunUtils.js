/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{e as t,j as n,h as e,U as i,c as o,t as a,u as r,b as u}from"./mathUtils.js";import{i as s,b as l,k as c,r as f}from"./mat4.js";import{c as d}from"./mat4f64.js";var m,h,g={exports:{}};m=g,h=function(){var t=Math.PI,n=Math.sin,e=Math.cos,i=Math.tan,o=Math.asin,a=Math.atan2,r=Math.acos,u=t/180,s=864e5,l=2440588,c=2451545,f={dec:0,ra:0};function d(t){return t.valueOf()/s-.5+l}function m(t){return new Date((t+.5-l)*s)}function h(t){return d(t)-c}var g=23.4397*u;function A(t,o){return a(n(t)*e(g)-i(o)*n(g),e(t))}function b(t,i){return o(n(i)*e(g)+e(i)*n(g)*n(t))}function N(t,o,r){return a(n(t),e(t)*n(o)-i(r)*e(o))}function O(t,i,a){return o(n(i)*n(a)+e(i)*e(a)*e(t))}function P(t,n){return u*(280.16+360.9856235*t)-n}function T(t){return u*(357.5291+.98560028*t)}function M(t){return u*(1.9148*n(t)+.02*n(2*t)+3e-4*n(3*t))}function E(n,e){return n+e+102.9372*u+t}function I(t,n){var e=T(t),i=E(e,M(e));return n||(n={dec:0,ra:0}),n.dec=b(i,0),n.ra=A(i,0),n}var p={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,n,e,i){var o=u*-e,a=u*n,r=h(t),s=I(r,f),l=P(r,o)-s.ra;return i||(i={azimuth:0,altitude:0}),i.azimuth=N(l,a,s.dec),i.altitude=O(l,a,s.dec),i}},v=[[-.83,"sunrise","sunset"]];p.addTime=function(t,n,e){v.push([t,n,e])};var L=9e-4;function _(n,e){return Math.round(n-L-e/(2*t))}function y(n,e,i){return L+(n+e)/(2*t)+i}function R(t,e,i){return c+t+.0053*n(e)-.0069*n(2*i)}function z(t,i,o){return r((n(t)-n(i)*n(o))/(e(i)*e(o)))}function x(t){var i=u*(134.963+13.064993*t),o=u*(93.272+13.22935*t),a=u*(218.316+13.176396*t)+6.289*u*n(i),r=5.128*u*n(o),s=385001-20905*e(i);return{ra:A(a,r),dec:b(a,r),dist:s}}return p.getTimes=function(t,i,o){var a=u*-o,r=u*i,s=_(h(t),a),l=y(0,a,s),c=T(l),f=M(c),d=E(c,f),g=b(d,0),A=R(l,c,d);function N(t){return R(y(z(t,r,g),a,s),c,d)}function O(t){var i=(n(t)-n(r)*n(g))/(e(r)*e(g));return i<-1?p.POLAR_EXCEPTION.MIDNIGHT_SUN:i>1?p.POLAR_EXCEPTION.POLAR_NIGHT:p.POLAR_EXCEPTION.NORMAL}var P,I,L,x,C,D={solarNoon:m(A),nadir:m(A-.5),polarException:p.POLAR_EXCEPTION.NORMAL};for(P=0,I=v.length;P<I;P+=1)C=A-((x=N((L=v[P])[0]*u))-A),D[L[1]]=m(C),D[L[2]]=m(x);return D.polarException=O(v[0][0]*u),D},p.getMoonPosition=function(t,n,e){var o=u*-e,a=u*n,r=h(t),s=x(r),l=P(r,o)-s.ra,c=O(l,a,s.dec);return c+=.017*u/i(c+10.26*u/(c+5.1*u)),{azimuth:N(l,a,s.dec),altitude:c,distance:s.dist}},p.getMoonFraction=function(t){var i=h(t),o=I(i),u=x(i),s=149598e3,l=r(n(o.dec)*n(u.dec)+e(o.dec)*e(u.dec)*e(o.ra-u.ra)),c=a(s*n(l),u.dist-s*e(l));return(1+e(c))/2},p}(),void 0!==h&&(m.exports=h);var A=g.exports;const b={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8e5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function N(a,r,u,s){const l=r[2];t(s.ambient.color,1,1,1),s.ambient.intensity=b.global.ambient,t(s.diffuse.color,1,1,1),s.diffuse.intensity=b.global.diffuse;const c=o((Math.abs(l)-b.local.altitude)/(b.global.altitude-b.local.altitude),0,1);s.globalFactor=c;const f=A.getTimes(a,r[1],r[0]);if(c<1){const t=function(t,e){const i=t.valueOf();let o,a;e.polarException===A.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):e.polarException===A.POLAR_EXCEPTION.POLAR_NIGHT?(o=i-2,a=i-1):(o=e.sunrise.valueOf(),a=e.sunset.valueOf());const r=a-o,u=o+r/2,s=r/4,l=u-s,c=u+s,f=.06*r,d=o-f/2,m=o+f/2,h=a-f/2,g=a+f/2,N=b.local,O=[.01,N.ambientAtNight],P=[.8,.8,1],T=[.01,.01,.01],M=[N.diffuseAtTwilight,N.ambientAtTwilight],E=[1,.75,.75],I=[.8,.8,1],p=[.9*N.diffuseAtNoon,N.ambientAtNoon],L=[1,.98,.98],_=[.98,.98,1],y=[N.diffuseAtNoon,N.ambientAtNoon],R=[1,1,1],z=[1,1,1],x=p,C=L,D=_,H=M,X=E,G=I;let w,S,U=[0,0],F=[0,0,0],j=[0,0,0];i<d||i>g?(U=O,F=T,j=P,S="night"):i<m?(w=m-d,U=v(i-d,w,O,M),F=v(i-d,w,T,E),j=v(i-d,w,P,I),S="sun rising"):i<l?(w=l-m,U=v(i-m,w,M,p),F=v(i-m,w,E,L),j=v(i-m,w,I,_),S="early morning"):i<u?(w=u-l,U=v(i-l,w,p,y),F=v(i-l,w,L,R),j=v(i-l,w,_,z),S="late morning"):i<c?(w=c-u,U=v(i-u,w,y,x),F=v(i-u,w,R,C),j=v(i-u,w,z,D),S="early afternoon"):i<h?(w=h-c,U=v(i-c,w,x,H),F=v(i-c,w,C,X),j=v(i-c,w,D,G),S="late afternoon"):i<g&&(w=g-h,U=v(i-h,w,H,O),F=v(i-h,w,X,T),j=v(i-h,w,G,P),S="sun setting");return{diffuse:{intensity:U[0],color:n(F[0],F[1],F[2])},ambient:{intensity:U[1],color:n(j[0],j[1],j[2])},timeOfDay:S}}(a,f);e(s.ambient.color,t.ambient.color,s.ambient.color,c),s.ambient.intensity=i(t.ambient.intensity,s.ambient.intensity,c),e(s.diffuse.color,t.diffuse.color,s.diffuse.color,c),s.diffuse.intensity=i(t.diffuse.intensity,s.diffuse.intensity,c)}s.noonFactor=function(t,n){const e=t.valueOf();let i,a;n.polarException===A.POLAR_EXCEPTION.MIDNIGHT_SUN?(i=e-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=i+432e6):n.polarException===A.POLAR_EXCEPTION.POLAR_NIGHT?(i=e-2,a=e-1):(i=n.sunrise.valueOf(),a=n.sunset.valueOf());const r=i+(a-i)/2;return 1-o(Math.abs(e-r)/432e5,0,1)}(a,f),O(a,r,u,s.diffuse.directionToLightSource)}function O(n,e,i,r){const u=p,d=s(I);if(1===i)A.getPosition(n,0,0,u),t(r,0,0,-1),l(d,d,-u.azimuth),c(d,d,-u.altitude),a(r,r,d);else{const i=b.planarDirection,s=i.globalAngles,c=e[2];let m=(Math.abs(c)-i.localAltitude)/(i.globalAltitude-i.localAltitude);m=o(m,0,1),m<1?(A.getPosition(n,e[1],e[0],u),u.azimuth=(1-m)*u.azimuth+m*s.azimuth,u.altitude=(1-m)*u.altitude+m*s.altitude):(u.azimuth=s.azimuth,u.altitude=s.altitude),t(r,0,-1,0),f(d,d,-u.azimuth),l(d,d,-u.altitude),a(r,r,d)}}function P(t,n){if(1===n)return!0;const e=b.planarDirection;return Math.abs(t)<e.localAltitude}function T(t,n,e,i,o){const a=t.getTime(),r=n.getTime()-a,s=Math.floor(r/e)+1,l=new Array(s);for(let t=0;t<s;++t)L.setTime(a+e*t),l[t]=u(),O(L,i,o,l[t]);return l}const M=n(.5773502691896258,-.5773502691896258,.5773502691896258);class E{constructor(){this.ambient={color:n(1,1,1),intensity:.55},this.diffuse={color:n(1,1,1),intensity:.55,directionToLightSource:r(M)},this.noonFactor=.5,this.globalFactor=0}}const I=d(),p={azimuth:0,altitude:0};function v(t,n,e,i){const o=[];for(let a=0;a<e.length;a++)o[a]=(i[a]-e[a])*t/n+e[a];return o}const L=new Date(0);export{E as C,A as S,P as a,T as b,N as c};
