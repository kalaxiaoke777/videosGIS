/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{b as t}from"../core/lang.js";import{L as n}from"./Logger.js";import{d as r,l as s,i as e,n as o,a as i,b as a,f as c,B as u,k as f,s as g,g as l,w as m,t as h,C as d,D as p,e as y}from"./mathUtils.js";import{i as M,c as j}from"./mat4.js";import{a as A,f as b}from"./vec4f64.js";import{d as R}from"./ray.js";import{b as S,s as v}from"./vectorStacks.js";function w(t,n,s){const e=r(t,n)/r(t,t);return c(s,t,e)}function x(t,n){return r(t,n)/s(t)}function C(t,n){const o=r(t,n)/(s(t)*s(n));return-e(o)}function P(t,n,s){o(_,t),o(k,n);const a=r(_,k),c=e(a),u=i(_,_,k);return r(u,s)<0?2*Math.PI-c:c}const _=a(),k=a(),L=n.getLogger("esri.geometry.support.sphere");function q(){return A()}function E(t,n=q()){return u(n,t)}function O(t,n){return b(t[0],t[1],t[2],n)}function T(t){return t}function z(t){t[0]=t[1]=t[2]=t[3]=0}function B(t){return t}function D(t){return Array.isArray(t)?t[3]:t}function I(t){return Array.isArray(t)?t:X}function U(t,n,r,s){return b(t,n,r,s)}function V(n,s,e){if(t(s))return!1;const o=g(S.get(),s.origin,I(n)),i=r(s.direction,s.direction),a=2*r(s.direction,o),u=a*a-4*i*(r(o,o)-n[3]*n[3]);if(u<0)return!1;const f=Math.sqrt(u);let m=(-a-f)/(2*i);const h=(-a+f)/(2*i);return(m<0||h<m&&h>0)&&(m=h),!(m<0)&&(e&&l(e,s.origin,c(S.get(),s.direction,m)),!0)}function F(t,n){return V(t,n,null)}function G(t,n,r){const e=S.get(),o=v.get();i(e,n.origin,n.direction);const a=D(t);i(r,e,n.origin),c(r,r,1/s(r)*a);const u=K(t,n.origin),f=C(n.origin,r);return M(o),j(o,o,f+u,e),h(r,r,o),r}function H(t,n,r){const e=g(S.get(),n,I(t)),o=c(S.get(),e,t[3]/s(e));return l(r,o,I(t))}function J(t,n){const r=g(S.get(),n,I(t)),s=d(r),e=t[3]*t[3];return Math.sqrt(Math.abs(s-e))}function K(t,n){const r=g(S.get(),n,I(t)),o=s(r),i=D(t),a=i+Math.abs(i-o);return e(i/a)}const N=a();function Q(t,n,r,s){const e=g(N,n,I(t));switch(r){case 0:{const t=p(e,N)[2];return y(s,-Math.sin(t),Math.cos(t),0)}case 1:{const t=p(e,N),n=t[1],r=t[2],o=Math.sin(n);return y(s,-o*Math.cos(r),-o*Math.sin(r),Math.cos(n))}case 2:return o(s,e);default:return}}function W(t,n){const r=g(Y,n,I(t));return s(r)-t[3]}const X=a(),Y=a();var Z=Object.freeze({__proto__:null,create:q,copy:E,fromCenterAndRadius:O,wrap:T,clear:z,fromRadius:B,getRadius:D,getCenter:I,fromValues:U,elevate:function(t,n,r){return t!==r&&f(r,t),r[3]=t[3]+n,r},setExtent:function(t,n,r){return L.error("sphere.setExtent is not yet supported"),t===r?r:E(t,r)},intersectRay:V,intersectsRay:F,intersectRayClosestSilhouette:function(t,n,r){if(V(t,n,r))return r;const e=G(t,n,S.get());return l(r,n.origin,c(S.get(),n.direction,m(n.origin,e)/s(n.direction))),r},closestPointOnSilhouette:G,closestPoint:function(t,n,r){return V(t,n,r)?r:(R(n,I(t),r),H(t,r,r))},projectPoint:H,distanceToSilhouette:J,angleToSilhouette:K,axisAt:Q,altitudeAt:W,setAltitudeAt:function(t,n,r,s){const e=W(t,n),o=Q(t,n,2,Y),i=c(Y,o,r-e);return l(s,n,i)}});export{z as a,C as b,q as c,G as d,B as e,O as f,U as g,J as h,V as i,I as j,P as k,D as l,E as m,F as n,w as o,x as p,Z as s,T as w};
